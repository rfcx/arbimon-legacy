<div ng-show="invalid">
    
    <h4> 
        <a class="btn btn-primary" ui-sref="analysis.models" ui-sref-active="active">
            <i class="fa fa-arrow-left"></i> 
            back
        </a>
        Model not found
    </h4>
</div>



<div ng-show="data">   
    <div class="row">
        <div class="col-xs-12">
            <a class="btn btn-primary" ui-sref="analysis.models" ui-sref-active="active">
                <i class="fa fa-arrow-left"></i> 
                back
            </a>
        </div>
    </div>
    
    <div class="row" >
        <div class="col-xs-12" >
            <div class="model-info-column">
                <h3>Model details</h3>  
                <div class="model-info-column">
                    <table class="table">
                        <tr>
                            <td><strong>Name:</strong></td>
                            <td class="hidelongtext widthtd"> {{ data.modelmname }}</td>
                        </tr>
                        <tr>
                            <td><strong>Type:</strong></td>
                            <td> {{ data.modelmtname }}</td>
                        </tr>
                        <tr>
                            <td><strong>Creation date:</strong> </td>
                            <td>{{ data.modelmdc }} {{ data.modelmtime }}</td>
                        </tr>
                        <tr>
                            <td><strong>Last updated:</strong></td>
                            <td> {{ data.lastupdate }} {{ data.lasttime }}</td>
                        </tr>
                        <tr>
                            <td><strong>Creator:</strong></td>
                            <td> {{ data.modelmuser }}</td>
                        </tr>
                        <tr>
                            <td><strong>Species:</strong></td>
                            <td> {{ data.species }}</td>
                        </tr>
                        <tr>
                            <td><strong>Sound:</strong></td>
                            <td> {{ data.songtype }}</td>
                        </tr>
                    </table>
                    <div data-ng-hide="true">
                        {{ data.modelmodel_id }}
                    </div>
                </div>
            </div>
            <div class="model-info-column" >
                <div class="model-info-column">
                    <h3>Training set</h3>
                    <table class="table">
                        <tr>
                            <td><strong>Name:</strong></td>
                            <td class="hidelongtext widthtd"> {{ data.trainingName }}</td>
                        </tr>
                        <tr>
                            <td><strong>Creation date:</strong></td>
                            <td><span ng-bind="data.trainingDate"></span> <span ng-bind="data.trainingTime"></span></td>
                        </tr>
                        <tr>
                            <td><strong>Pattern ROI Count:</strong></td>
                            <td>{{ data.roicount }}</td>
                        </tr>
                        <!-- 
                        <tr>
                            <td>
                                Pattern Low Frequency: 
                            </td><td><span ng-bind="data.lfreq"></span>hz</td>
                        </tr>
                        <tr>
                            <td>
                                Pattern High Frequency: 
                            </td><td><span ng-bind="data.hfreq"></span>Hz</td>
                        </tr>
                        -->
                        <tr>
                            <td><strong>Pattern Bandwidth:</strong></td>
                            <td>{{ data.bw }}Hz</td>
                        </tr>
                    </table>
                </div>
                <div class="model-info-column">
                    <h4>Training set pattern:</h4>
                    <div id="zoomDiv" class="zoomDivClass">
                            <b>Zoom</b>: <button ng-click="zoomout()" class="btn btn-default btn-xs"><i class="fa fa-search-minus" ></i></button>
                            <button ng-click="zoomin()" class="btn btn-default btn-xs"><i class="fa fa-search-plus" ></i></button>
                    </div>
                    <div class="model-pattern">
                        <div class="yaxiscontainer" >
                            <div id="yaxis" class="yaxisrelative">
                                <div >{{data.hfreq}}Hz-</div>
                                <div style="position: absolute;bottom: -18px;">{{data.lfreq}}Hz-</div>
                            </div>
                        </div>
                        <div id="patternDivMain" class="patternDiv">
                            <div class="patternWidth">
                                <img id="paternImage" ng-src="{{data.png}}"  style="margin-left:16px;width:100%;height:auto;min-height:0px;"/>
                            </div>
                            <div class="patternWidthAxis">
                                <div style="position:absolute;left:15px;">0s</div>
                                <div style="position:absolute;right:-20px;">{{ data.rlength }}s</div>
                            </div>
                        </div>

                    </div>    
                </div>
            </div>
        </div>
        
        <div class="col-xs-12">
            <h3>Model validation details</h3>
            <div class="model-info-column">
                
                <div class="">
                    <strong>Total validations used:</strong> {{data.all}}
                </div>
                <div class="" >
                    <div class="model-info-column">  
                        <table class="table">
                            <tr>
                                <td><strong>Present:</strong></td>
                                <td>{{data.p}}</td>
                            </tr>
                            <tr>
                                <td>In fitting:</td>
                                <td>{{ data.tp }}</td>
                            </tr>
                            <tr>
                                <td>In verification:</td>
                                <td>{{ data.vp }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="model-info-column">
                        <table class="table">
                            <tr>
                                <td><strong>Absent:</strong></td>
                                <td>{{data.np}}</td>
                            </tr>
                            <tr>
                                <td>In fitting:</td>
                                <td>{{ data.tnp }}</td>
                            </tr>
                            <tr>
                                <td>In verification:</td>
                                <td>{{ data.vnp }}</td>
                            </tr>
                        </table>         
                    </div>
                </div>
            </div>
            <div class="model-info-column">
                <strong>Statistics</strong>
                <table class="table">
                    <tr>
                        <td><strong>Accuracy:</strong></td>
                        <td>{{ data.accuracy }}</td>
                    </tr>
                    <tr>
                        <td><strong>Precision:</strong></td>
                        <td>{{ data.precision }}</td>
                    </tr>
                    <tr ng-show="data.sensitivity != null"> 
                        <td><strong>Sensitivity:</strong></td>
                        <td>{{ data.sensitivity }}</td>
                    </tr>
                    <tr ng-show="data.specificity != null"> 
                        <td><strong>Specificity:</strong></td>
                        <td>{{ data.specificity }}</td>
                    </tr>
                </table>
            </div>
            <div class="model-info-column">
                <div class="top-buffer" ng-show="data.tpos != null">
                    <strong>Confusion matrix:</strong>
                </div>
                <div class="confusion-matrix" ng-show="data.tpos !== null">
                    <table>
                        <tbody>
                            <tr>
                                <td></td>
                                <td colspan="2"><strong>Predicted</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Actual</strong></td>
                                <td><small><em>P</em></small></td>
                                <td><small><em>A</em></small></td>
                            </tr>
                            <tr>
                                <td ><small><em>P</em></small></td>
                                <td class=""> {{ data.tpos }}</td>
                                <td class="">{{ data.fneg }}</td>                
                            </tr>
                            <tr class="">
                                <td ><small><em>A</em></small></td>
                                <td class="">{{ data.fpos }}</td>
                                <td class="">{{ data.tneg }}</td>                
                            </tr>
                        </tbody>
                    </table>
                    <div>
                        <small><em>P = Present, A = Absent</em></small>
                    </div>
                </div>
            </div>
            
        </div>
        <div class="col-xs-12" ng-show="currentThresholdRounded >=0.0" >
            <h3>Threshold details</h3>
            <div class="model-info-column" >
                    <strong>Saved threshold:</strong> {{databaseThreshold}}<br>
                    <strong>Suggested threshold:</strong> {{suggestedThreshold}}<br>
                    <strong>Current threshold:</strong> {{currentThresholdRounded}}
                    <div style="padding: 5px 0px;">
                        <label>New threshold:</label>
                        <input type="text" 
                            ng-model="newthres"
                            class="form-control input-sm" 
                            aria-describedby="enter new threshold" 
                            style="width:50px; display:inline-block">
                    </div>
                    <button class="btn btn-default" ng-click="recalculate()">
                        Recalculate
                    </button>
                    <button class="btn btn-default" ng-click="saveThreshold()">
                        Save current threshold
                    </button>
                    <p><small>{{messageSaved}}</small></p>
            </div>
            <div class="model-info-column" >
                <strong>Statistics</strong>
                <table class="table">
                    <tr>
                        <td><strong>Accuracy:</strong></td>
                        <td>{{ thres.accuracy }}</td>
                    </tr>
                    <tr>
                        <td><strong>Precision:</strong></td>
                        <td>{{ thres.precision }}</td>
                    </tr>
                    <tr ng-show="data.sensitivity != null"> 
                        <td><strong>Sensitivity:</strong></td>
                        <td>{{ thres.sensitivity }}</td>
                    </tr>
                    <tr ng-show="data.specificity != null"> 
                        <td><strong>Specificity:</strong></td>
                        <td>{{ thres.specificity }}</td>
                    </tr>
                </table>
            </div>
            <div class="model-info-column" >
                <div class="top-buffer" ng-show="data.tpos != null">
                    <strong>Confusion matrix:</strong>
                </div>
                <div class="confusion-matrix" ng-show="data.tpos !== null">
                    <table>
                        <tbody>
                            <tr>
                                <td></td>
                                <td colspan="2"><strong>Predicted</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Actual</strong></td>
                                <td><small><em>P</em></small></td>
                                <td><small><em>A</em></small></td>
                            </tr>
                            <tr>
                                <td ><small><em>P</em></small></td>
                                <td class=""> {{ thres.tpos }}</td>
                                <td class="">{{ thres.fneg }}</td>                
                            </tr>
                            <tr class="">
                                <td ><small><em>A</em></small></td>
                                <td class="">{{ thres.fpos }}</td>
                                <td class="">{{ thres.tneg }}</td>                
                            </tr>
                        </tbody>
                    </table>
                    <div>
                        <small><em>P = Present, A = Absent</em></small>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    <div class="row" ng-hide="showModelValidations">
        <div ng-hide="invalid">
            <h4>The current model was computed using a previous version of the Arbimon2 App.<br>
            The validation list feature is not available.</h4>
        </div>
    </div>
    <div class="row" ng-show="valiDetails && showModelValidations">      
        <div ng-hide="loadingValidations" class="col-sm-12 col-lg-8" ng-show="showValidationsTable">
            <h3 class="inlineh3">
                Validations 
                <div class="btn btn-default" 
                    ng-csv="getValidations()" 
                    filename="matrixValues.csv"  
                    csv-header="['Site', 'Date', 'User presence','Model presence','Threshold presence' ,'Threshold value']">
                    <i class="fa fa-download"
                        tooltip="Download Values in CSV" 
                        tooltip-placement="bottom">
                    </i>
                </div>
            </h3>
            <small><em>(Click in the recording row to show recording details)</em></small>
            <a2-table  fields="fields" rows="validationsData" no-checkbox on-select="recDetails(row)"></a2-table>  
        </div>
        <div ng-show="loadingValidations" class="col-sm-12 col-lg-8" ng-show="showValidationsTable">
            <h3 class="inlineh3">
                Loading data 
            </h3>
            <loader></loader>
        </div>
        <div class="col-sm-12 col-lg-6" ng-hide="showValidationsTable">
            <div class="" ng-hide="showValidationsTable">
                <h3>
                    Validation Recording Detail
                    <div class="btn-group">
                        <button class="btn btn-default" 
                            ng-click="closeRecValidationsDetails()" >
                             <i class="fa fa-arrow-left"></i> 
                            Back
                        </button>
                        <button class="btn btn-default" 
                            ng-click="gotoRec()" >
                             <i class="fa fa-cubes"></i> 
                            Open in Visualizer
                        </button>
                    </div>
                </h3>
                <div class="row">
                    <div class="col-sm-4">
                        <p><b>Date:</b> {{recNameInVectorViewDate}}</p>
                    </div>
                    <div class="col-sm-2">
                        <p><b>Site:</b> {{recNameInVectorViewSite}}</p>
                    </div>
                    <div class="col-sm-2">
                        <p><b>User:</b> {{recNameInVectorViewUser}}</p>
                    </div>
                    <div class="col-sm-2">
                        <p><b>Model:</b> {{recNameInVectorViewModel}}</p>
                    </div>
                    <div class="col-sm-2">
                        <p><b>Threshold:</b> {{recNameInVectorViewTh}}</p>
                    </div>
                </div>
            </div>
            <div class="axisWrapper">
                <div class="yaxisWrapper">
                    <div class="yAxishighvalue">{{data.maxvRounded}}</div>
                    <div class="lowaxis2">0.0</div>
                </div>
                <div class="vectorWrapper"><a2-vectorchart minvect="data.minv" maxvect="data.maxv" vector-data="selectedVectWatch"></a2-vectorchart></div>
            </div>
            <div class="cleardiv"></div>
            <div class="axisWrapper">
                <div class="yaxisWrapper vertical-text2">
                    Hertz
                </div>
                <div class="vectorWrapper"><img class="sm-result-thumb" ng-src="{{selectedUrl}}"/></div>
                <div class="seconds-div-center"><small>Seconds</small></div>
            </div>
        </div>
    </div>
        
</div>
