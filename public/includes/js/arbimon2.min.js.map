{"version":3,"sources":["admin.js","app.js","citizen-scientist.js","home.js","login.js","orders.js","register.js","reset-password.js","user-settings.js","visualizer.js","a2services/api-service.js","a2services/audio-event-detection-service.js","a2services/audio-event-detections-clustering-service.js","a2services/citizen-scientist-admin-service.js","a2services/citizen-scientist-expert-service.js","a2services/citizen-scientist-service.js","a2services/classi-service.js","a2services/clustering-jobs-service.js","a2services/cnn-service.js","a2services/download-resource.js","a2services/index.js","a2services/local-store.js","a2services/models-service.js","a2services/news-service.js","a2services/open-modal.js","a2services/patternmatching-service.js","a2services/playlists-service.js","a2services/project-service.js","a2services/promised-resolve.js","a2services/serialize-promised-fn.js","a2services/sites-service.js","a2services/soundscape-composition.js","a2services/soundscapes-service.js","a2services/species-service.js","a2services/tags-service.js","a2services/templates-service.js","a2services/training-sets-service.js","a2services/uploads-service.js","a2services/users-service.js","filters/a2-filters.js","filters/as-csv.js","filters/caps.js","filters/page-number-to-title.js","filters/page-title-to-number.js","filters/project-url.js","filters/range.js","filters/round.js","filters/time-from-now.js","orders/change-project-plan.js","orders/create-project.js","orders/order-summary.js","orders/order-utils.js","orders/orders-service.js","orders/plan-capacity.js","orders/plan-selection.js","orders/process-order.js","orders/project-order-service.js","orders/shipping-form.js","orders/tier-select.js","directives/a2-auto-close-on-outside-click.js","directives/a2-dropdown.js","directives/a2-on-resize.js","directives/a2-palette-drawer.js","directives/a2-percentage-bars.js","directives/a2-require-non-empty.js","directives/a2-sidenav.js","directives/a2-table.js","directives/a2-tags.js","directives/a2directives.js","directives/a2forms.js","directives/a2qrjs.js","directives/c3-charts.js","directives/error-message.js","directives/frequency_filter_range_control.js","directives/g-recaptcha.js","directives/news-feed-item.js","directives/plotly-plotter.js","directives/search-bar.js","directives/validation-dropdown.js","directives/warning-banner.js","services/a2gmaps.js","services/a2heremaps.js","services/a2permissions.js","services/a2utils-browser-metrics.js","services/a2utils.js","services/app-listings.js","services/colorscale-gradients.js","services/countries.js","services/humane.js","services/plot-maker.js","services/plot-specs.js","services/plotly-defaults.js","services/url-updater-service.js","utils/external-api-loader.js","utils/global-anonymous-function.js","utils/q-promisify.js","admin/jobs/index.js","admin/dashboard/data-service.js","admin/dashboard/index.js","admin/dashboard/plotter-controller.js","admin/users/list.js","admin/projects/codes.js","admin/projects/index.js","admin/projects/list.js","directives/a2-audio-bar/a2-audio-bar.js","directives/a2-switch/index.js","directives/external/facebook-login-button.js","directives/external/google-login-button.js","app/analysis/index.js","app/audiodata/index.js","app/audiodata/sites.js","app/audiodata/soundscape-composition-classes.js","app/audiodata/species.js","app/audiodata/training-sets.js","app/jobs/index.js","app/citizen-scientist/index.js","app/dashboard/index.js","app/settings/index.js","app/visualizer/audioplayer.js","app/visualizer/layers.js","app/visualizer/services.js","app/visualizer/soundscape-tags.js","app/visualizer/spectrogram.js","app/visualizer/validator.js","app/visualizer/visualizer-sidebar.js","app/visualizer/visualizer.js","app/visualizer/zoom.js","app/analysis/audio-event-detection/index.js","app/analysis/audio-event-detection/new-modal.js","app/analysis/audio-event-detections-clustering/index.js","app/analysis/cnn/index.js","app/analysis/clustering-jobs/index.js","app/analysis/patternmatching/index.js","app/analysis/random-forest-models/index.js","app/audiodata/playlists/playlist-arithmetic.js","app/audiodata/playlists/playlists.js","app/analysis/soundscapes/index.js","app/audiodata/recordings/data-export-parameters.js","app/audiodata/recordings/filter-parameters.js","app/audiodata/recordings/recordings.js","app/audiodata/templates/templates.js","app/citizen-scientist/admin/index.js","app/audiodata/uploads/index.js","app/audiodata/uploads/processing.js","app/audiodata/uploads/upload.js","app/citizen-scientist/my-stats/index.js","app/citizen-scientist/expert/index.js","app/citizen-scientist/patternmatching/index.js","app/visualizer/browser/browser.js","app/visualizer/browser/common.js","app/visualizer/dialog/dialog.js","app/visualizer/layers/recording-tags-layer.js","app/visualizer/layers/soundscape-compositions-tool.js","app/visualizer/layers/templates.js","app/visualizer/visobjects/audio-event-detection.js","app/visualizer/visobjects/common.js","app/visualizer/visobjects/recording.js","app/visualizer/visobjects/soundscape.js","app/visualizer/visobjects/visobjects.js","app/analysis/random-forest-models/classification/index.js","app/analysis/random-forest-models/models/index.js","app/citizen-scientist/admin/classification-stats/index.js","app/citizen-scientist/admin/user-stats/index.js","app/citizen-scientist/admin/settings/index.js","app/visualizer/browser/audio-event-detections/audio-event-detections.js","app/visualizer/browser/recordings/recordings.js","app/visualizer/browser/soundscapes/soundscapes.js","app/visualizer/layers/annotation-layer/annotation-layer.js","app/visualizer/layers/audio-events-layer/audio-events-layer.js","app/visualizer/layers/base-image-layer/base-image-layer.js","app/visualizer/layers/recording-soundscape-region-tags/recording-soundscape-region-tags.js","app/visualizer/layers/data-plot-layer/data-plot-layer.js","app/visualizer/layers/soundscapes/soundscapes.js","app/visualizer/layers/recordings/recordings.js","app/visualizer/layers/species-presence/species-presence.js","app/visualizer/layers/training-data/roi-set.js","app/visualizer/layers/training-data/training-sets.js","app/visualizer/layers/zoom-input-layer/zoom-input-layer.js","app/visualizer/browser/recordings/by-site/recordings_by_site.js","app/visualizer/browser/recordings/by-playlist/recordings_by_playlist.js","app/visualizer/layers/soundscapes/regions/soundscape-regions.js","app/visualizer/layers/soundscapes/info/soundscape-info.js"],"names":["angular","module","controller","$scope","$state","e","console","error","provider","this","setEventHandlers","$get","service","init","filter","a2","run","$rootScope","Angularytics","a2UserPermit","notify","Math","$on","to","params","name","startsWith","document","getElementsByTagName","classList","add","remove","isFunction","allowAccess","allowed","undefined","preventDefault","go","config","$urlRouterProvider","$locationProvider","AngularyticsProvider","a2GoogleMapsLoaderProvider","a2InjectedData","setAPIKey","googleAPI","key","html5Mode","otherwise","Project","$window","getInfo","data","bioAnalyticsBaseUrl","reportsEnabled","reports_enabled","getUrlFor","page","projectUrl","getUrl","citizenScientistUser","all","length","includes","can","isSuper","isAppPage","location","pathname","onCitizenScientistPage","title","getData","$http","get","then","projects","recordings","description","jobs","species","$localStorage","a2order","$q","$injector","homeSummaryStatsData","getSummaryData","summary_item","resolve","invoke","getProjectSelectCache","JSON","parse","getItem","setProjectSelectCache","psCache","setItem","stringify","summaryDataLoading","list_summary_data","summary_data","map","allData","bind","isExplorePage","loadProjectList","isFeatured","isAnonymousGuest","isMyProjects","include_location","publicTemplates","featured","type","isLoading","highlightedProjects","success","forEach","p","lastAccessed","id","lat","lon","zoom","mapUrl","mapbox_access_token","item","project","url","projectTemplates","templatesTotal","count","recCount","speciesCount","createProject","result","message","log","selectProject","is_enabled","Date","getTime","assign","valueShortScale","value","formattedNumber","numeral","format","x","split","slice","replace","$modal","login","path","search","post","username","password","captcha","captchaResp","captchaNeeded","showCaptcha","resetCaptcha","redirect","oAuthLogin","user","oauthData","token","getAuthResponse","id_token","authResponse","accessToken","response","catch","status","showEnableOAuthModal","modalData","open","templateUrl","oauthType","messages","authorizeMessage","btnOk","btnCancel","controllerAs","authorized","extend","authorize","hash","loginUrl","encodeURIComponent","$timeout","$interval","testUsername","usernameOk","usernameErr","testUserTimeout","cancel","regis","$error","required","pattern","available","testEmail","emailOk","emailErr","testEmailTimeout","email","invalid","register","$event","passResult","valid","terms_accepted","captchaNotNeeded","loading","newsletter","completed","msg","changePassword","request","requestComplete","reset","copy","save","userData","lastname","oauth","err","serverError","factory","$location","returnData","a2APIServiceClass","prefix","prototype","apiRoute","when","delete","put","nrm","exec","absUrl","projectName","apiURLPrefix","a2APIService","api","getProjectName","getList","getAlgorithmsList","getStatisticsList","getDataStatisticsList","getDataAggregatesList","getDataFor","aed","y","z","args","statistic","join","savePlotFor","new","defaultName","algorithm","parameters","statistics","playlist","list","opts","callback","create","validate","unvalidate","jobId","getClassificationStats","speciesId","getUserStats","userId","getUserStatsExportUrl","getCSExportUrl","pattern_matching_id","per_user","filename","getSettings","setSettings","settings","getPatternMatchings","getPatternMatchingDetailsFor","patternMatchingId","getPatternMatchingRoisFor","limit","offset","options","query","Object","keys","option","validatePatternMatchingRois","rois","validation","patternMatching","getMyStats","saveData","saveState","getState","getDetails","classificationId","getResultDetails","first","getRecVector","recId","classificationData","$httpParamSerializer","getJobDetails","clusteringJobId","getClusteringDetails","job_id","getRoisDetails","rec_id","perSite","perDate","exportClusteringROIs","getAudioUrlFor","aedId","audioEventDetections","listROIs","species_id","site_id","listROIsBySpecies","listResults","listModels","getDetailsFor","cnnId","getRoisFor","countROIsBySpecies","countROIsBySites","countROIsBySpeciesSites","getExportUrl","roi","cnn_result_roi_id","validateRois","resource_url","a","element","attr","appendTo","setTimeout","click","localStorage","openedModel","modelState","s","isModelOpen","getFormInfo","findById","modelId","modelData","getValidationResults","setThreshold","thresholdValue","m","t","loadPage","index","loadFormats","$openModalProvider","defs","define","modalName","modalDef","overrides","getPatternMatchingsTotal","getSitesListFor","jobName","cls","update","filterPlaylistLimit","playlistParams","$emit","combine","expression","getRecordingPosition","recording","r","getPreviousRecording","getNextRecording","rename","playlistIds","playlists","method","event","handler","attachAedToPlaylist","playlist_id","nameRe","getProjectById","projectId","project_id","updateInfo","info","getUsage","getSites","getClasses","getRecs","tags","flat","getRecCounts","project_url","getRecordingData","filters","projection","show","param","serializedParams","species_name","grouped","getSitesExportUrl","getRecTotalQty","getProjectTotalSpecies","getProjectTimeBounds","getRecordings","Function","getRecordingAvailability","getOneRecording","getRecordingInfo","validateRecording","recExists","exists","downloadRecording","addClass","projectClass","removeClasses","projectClasses","getUsers","getRoles","addUser","removeUser","changeUserRole","getModels","getClassi","validationsCount","validationBySpeciesSong","songtypeId","sound_id","getProjectsList","ownershipType","removeProject","resolveMap","context","fn","series","Array","call","arguments","apply","listPublished","import","site","sites","getLogFiles","getSiteLogDataDates","d","defer","reject","promise","getSiteLogDataUrl","from","period","test","getSiteLogData","rows","trim","line","getListOfAssets","generateToken","revokeToken","getClassList","tally","isSystemClass","groupByType","reduce","_","typeId","push","removeClass","scClassid","getAnnotationsFor","visobject","annotate","annotation","Error","getAmplitudeReferences","caption","soundscapeId","getSCIdx","getNormVector","getList2","setVisualizationOptions","addRegion","bbox","sampleRegion","region","soundscape","soundscape_id","raw","getRegion","getRecordingTags","addRecordingTag","tag","removeRecordingTag","getRegions","findIndices","soundscapeData","q","songs","searchId","song","songtype_id","isTaggableType","isTaggableResource","obj","getFor","getForType","resourceType","deleteFor","tagId","addFor","tag_id","text","t0","f0","t1","f1","showRecordingUri","template_data","template","templateId","getImage","tset_data","edit","trainingSetId","addData","recording_uri","getDataImage","dataId","getTypes","getRois","getSpecies","removeRoi","roiId","getProcessingList","checkStatus","items","getInfoForId","user_id","delimiter","v","input","toUpperCase","page_number","page_title","isFinite","step","sign","stepSign","i","val","precision","fmt","moment","fromNow","orderData","$modalInstance","a2orderUtils","today","recorderQty","getOrdersContact","ordersContact","paymentsStatus","autoPaymentsEnabled","payments_enable","currentPlan","storage","storage_limit","processing","processing_limit","duration","plan_period","tier","activation","plan_activated","creation","plan_created","due","setFullYear","getFullYear","mode","plan","usage","minUsage","min_usage","upgrade","action","enterShippingAddress","reviewOrder","dismiss","ProjectOrderService","isValid","makeOrder","order","hasCoupon","isPaidProject","placeOrder","close","address","shipping","changeItems","changePlan","editAddress","submit","waiting","approvalUrl","monthsUntilDue","acticationDate","currentMonth","totalMonths","getMonth","getDate","cache","checkCouponCode","code","recorder","priceWithPlan","priceNoPlan","formOpener","view","modalOptions","backdrop","directive","restrict","scope","disabled","minutes","link","attrs","enabled","freePlan","cost","coupon","class","payload","recorderOptions","planMinutes","planYears","upgradeOnly","hasCouponCode","planData","yearOptions","$watch","updatePlan","planStarts","monthsLeft","ceil","recorderCap","floor","availablePlans","reOrderId","orderId","invoice","item_list","amount","number","orderNumber","shipping_address","notFound","needApproval","approvalLink","alreadyProcessed","errorOcurred","$filter","currencyFilter","merge","freeProjectLimit","nameExists","urlExists","recorderCost","projectCostLimit","countries","verify","shipping_cost","disableFree","$document","getElementPath","ancestors","parentElement","require","$attrs","dropdownController","closeDropdown","evt","isOpen","target","htmlIdx","indexOf","documentElement","toggleElementIdx","toggleElement","elementIdx","dropdownMenu","toggle","$$phase","$apply","$set","unbind","$compile","masterTemplate","compile","tpl","cloneNode","itemTpl","children","selectedItemTpl","elementHtml","html","append","empty","compiledTpl","clone","linkElement","ngModelCtrl","select","$selectedItem","$setViewValue","$render","$viewValue","Watcher","watchers","watch","scheduleAnimationFrame","animationFramePending","triggered","watcher","width","clientWidth","height","clientHeight","destroy","splice","requestAnimationFrame","newWatcher","$parse","a2OnResizeService","onResize","a2OnResize","newSize","a2Soundscapes","palette","$element","draw","pal","ctx","getContext","fillStyle","fillRect","a2SidenavBarService","total","colors","DEFAULT_COLORS","numberFilter","getColorClass","getTotal","b","asPercent","rounding","elm","ctrl","$validators","modelValue","viewValue","$isEmpty","$observe","$validate","enableSidenavBar","disableSidenavBar","$log","a2EventEmitter","SidenavBar","events","getSidenavBar","enable","emit","disable","on","listener","off","registerAnchor","onEnabled","onDisabled","bar","sidebar","unregisterAnchor","nodeName","toLowerCase","_name","$templateCache","compileFields","toArray","field","detach","tdclass","content","tooltip","compileSelectExpand","selectExpand","fieldCount","find","$","selected","onSelect","onCheck","checked","dateFormat","numberDecimals","tplHead","tplFilters","tplBody","hasFilters","fields","hasCheckbox","noCheckbox","hasSelection","noSelect","a2TableCtrl","tableScope","$parent","$new","row","initialize","a2TableController","noCheck","sortKey","defaultSort","updateChecked","setRows","cmpel","$destroy","__onSelect","__onCheck","onFilterChanged","shift","keycomp","visible","toggleAll","allFalse","checkall","check","$index","lastChecked","shiftKey","keyboardSel","sel","currentTarget","after","sortBy","fieldIndex","sort","reverse","a2TagsModule","linkTo","tagType","tcTag","_0","_1","_2","tagName","tagLink","tagElement","closest","hide","expr","UP_PARENT_SPECIAL","times","createPseudo","seed","matches","_3","_4","dups","nodeType","parentNode","di","de","match","needsContext","RegExp","source","onkeyup","mkFunction","locals","a2InfiniteScrollDistance","a2InfiniteScrollDisabled","a2InfiniteScrollImmediateCheck","pscope","fnBind","fnUnbind","a2Scroll","a2ScrollOn","scrollElement","a2InfiniteScroll","a2InfiniteScrollRefraction","scrollHandler","dispose","anchors","addAnchor","anchorElement","removeAnchor","$controller","scrollHeight","scrollTop","time","refraction","a2ScrollController","counter","poc","tElement","tAttrs","_$persistence_","ptag","persisted","_$persistence_tag_","stopPropagation","$broadcast","updateHeight","h","top","resize","hideText","d3","ngModel","maxDate","minDate","year","dateCount","onYearChanged","onDateChanged","disableEmpty","setYear","old_year","setDate","date","old_date","popup","is_a_popup","insertAfter","css","weekOfMonth","firstDay","toString","monthOffset","getDay","monthName","format2Date","txt","computeMax","computeMin","days","svg","cal","legend","prev","next","scale","labels","icon","threshold","domain","range","selectAll","enter","cubesize","drawCounts","classed","hasClass","calendar","exit","mon","months","computeMaxMinDateFromCounts","dateCounts","stats","dateFmt","min","max","$attr","img","new_src","image","Image","onload","src","a2TrainingSets","trainingSet","datum","resolve_null_uri","urikey","resolving","datum2","uri","anchor","keep_position","a2KeepPosition","a2InsertIn","replaceChild","reposition_element","comp_pos","el","po","offsetParent","ao","position","left","parents","each","$e","scroll","is","visibility","drawChart","padding","right","bottom","getY","getX","yMin","yMax","tMin","tMax","lineColor","xScale","linear","yScale","interpolate","symbol","xAxis","axis","ticks","yAxis","orient","dataG","totalLength","node","getTotalLength","transition","delay","ease","body","coords","mouse","style","round","values","color","Number","normalize","columns","c3","makeChart","axes","celem","bindto","generate","chart","o","n","load","addSaveBtn","wrap","parentEl","parent","saveBtn","onDirtySaveFN","$name","$modelValue","$setPristine","removeSaveBtn","unwrap","a2BsNgModelOnDirtySaveButton","$viewChangeListeners","$dirty","dataURIToBinaryBuffer","dataURI","base64Index","base64","substring","atob","rawLength","array","Uint8Array","ArrayBuffer","charCodeAt","buffer","getCanvasBlob","canvas","toBlob","blob","toDataURL","BlobBuilder","WebKitBlobBuilder","bb","getBlob","Blob","createObjectURL","URL","revokeObjectURL","webkitURL","revoke","canvasObjectURL","$debounce","computeHash","w","createAxisData","prec","unit","dTick","w1","h1","font","strokeStyle","lineWidth","clearRect","lblSize","loopCt","tW","measureText","textAlign","textBaseline","beginPath","moveTo","lineTo","stroke","strokeText","drawAxisOnImg","axisDataPromise","promiseCache","axisData","elementSize","redrawAxis","selector","targetpos","pageX","pageY","onErrorSrc","loadZXCVBN","createElement","async","insertBefore","attachEvent","addEventListener","userInputs","getValidation","confirm","requiredScore","minLength","maxLength","testConfirm","pass","score","ok","testPass","zxcvbn","waitForZxcvbn","mesgs","size","shields","urlPattern","deriveUrlFromName","nameChanged","urlChanged","good","errorName","errorUrl","is_private","qr","level","imgSrc","filterMin","filterMax","maxFreq","detectMouseUp","pressed","detectMouseMove","detectMouseDown","buttons","which","className","eloff","container","ammount","sitekey","theme","resetWidget","waitForRecaptcha","grecaptcha","widgetId","render","resetTimeout","a2NewsService","parseFormat","lastidx","matchidx","RE_INTERP","startidx","lastIndex","substr","parsedFormatsPromise","formats","news","parsedFormats","PlotlyDefaults","plotlyPlotMaker","layout","mergeData","mergeLayout","Plotly","newPlot","resizeWatcher","relayout","old","projectsLoading","isUnsafe","findProject","empty_option","label","val_options","by_val","updateLabel","$$lastCommittedViewValue","loadScript","cb_name","google","script","apiKey","protocol","appendChild","constant","a2HereMarkerTextIconTemplate","loadOneScript","H","makeTextIcon","DomIcon","platform","Platform","app_id","appId","app_code","appCode","useHTTPS","loadPromise","setAPIIdAndCode","userPermit","permits","permit","permissions","super","isRfcx","rfcxUser","isAuthorized","isProjectMember","getUserEmail","userEmail","has","feature","features","perm","isArray","metrics","border","margin","inner","outer","overflow","scrollLeft","scrollSize","linker","linkers","tmp_promise","l","idx","make","item_name","newValue","utc","timezone","tz","arr","currentPage","limitPerPage","rate","timeoutPromise","qDefer","debouncePromise","self","a2LookaheadHelper","searchCompare","includeSearch","pop","unshift","searchPromote","EventlistManager","get_event_def","send","eventdef","oneTime","listeners","fired","Species","newVal","oldVal","Songtypes","songtype","$inheritFrom","classdef","constructor","static","window","qc","object","app","g","j","ColorscaleGradients","gradients","grad","len","humane","timeout","baseCls","spawn","addnCls","start","defaults","makeHeatmapPlot","plot","hoverinfo","colorbar","xaxis","boundsmode","ticksuffix","units","yaxis","matrix","bins","makeBarPlot","orientation","a2BrowserMetrics","gutter","axis_sizew","axis_sizeh","legend_axis_w","legend_width","legend_gutter","axis_lead","set","newDefaults","PlotlyDefaultDefaults","PlotSpecs","titlefont","family","tickfont","showLink","sendData","displaylogo","displayModeBar","scrollZoom","modeBarButtonsToRemove","plot_bgcolor","paper_bgcolor","dragmode","thickness","heatmap","colorscale","clear","url2","qidx","_t_","re","a2UrlUpdate","externalApiLoaderProvider","apis","getCachedModule","def","namespace","loader","globalAnonymousFunction","head","jsonpCallback","onerror","addApi","apiName","externalApiLoader","ct","wrapperFn","$qPromisify","cb","$stateProvider","state","findJobs","getTags","key1","value1","key2","value2","states","types","activeJobs","initParams","job_types","argument","jobsStatus","jobTypes","getPlotData","convertToCSV","objArray","str","exportCSVFile","headers","fileTitle","jsonObject","csv","exportedFilenmae","navigator","msSaveBlob","download","setAttribute","removeChild","itemsFormatted","firstname","plots","UserStatsExport","newUsers","newProjects","Jobs","allUsers","allSites","allProjects","newSites","getSystemSettings","setSetting","setting","toggleSetting","AdminDashboardDataService","mk_time_range_fn","delta","fromdt","todt","get_by_tag","make_setter","selattr","refresh_logs","time_ranges","periods","sampling","granularity","time_range","set_series","set_time_range","set_period","load_data","make_chart_struct","marker","datetime","activity","chart_data","LoaderFactory","AdminProjectsCodesService","newInstance","createNewCode","projectsList","AdminProjectsListService","usersList","AdminUsersListService","lockToUser","lockProject","tieProcessingWithRecordings","computeProcessingAmount","processingCountChanged","loadCodes","showHash","Loader","valueStore","abstract","views","detail","notifyProjectUpdated","projectObject","setProject","projectData","getProjectInfo","getProjectSites","getProjectRecordingCount","updateProject","handleAedToggle","clustering_enabled","aed_enabled","project_type_id","current_plan","storage_usage","processing_usage","citizen_scientist_enabled","cnn_enabled","pattern_matching_enabled","duration_period","loadUrl","play","a2AudioPlayer","audio_player","expanded","collapseTimeoutInterval","setGain","deregHandlers","onLoadUrl","onDestroy","setCollapseTimer","collapseTimer","seekPercent","percent","setCurrentTime","resource","gain","pause","stop","toggleExpanded","restict","onText","offText","facebook_api","onSignedIn","onError","signIn","FB","auth2","client_id","google_oauth_client","cookiepolicy","analysis","deepStateRedirect","sticky","audiodata","attrHandler","files","$anchorScroll","a2Sites","a2GoogleMapsLoader","$downloadResource","parseSitesFromCsv","allText","allTextLines","createSites","Promise","markers","editing","creating","show_path","logs","deployment","sortByLastUpdated","set_show","maps","Map","getElementById","center","lng","mapTypeId","MapTypeId","SATELLITE","minZoom","fitBounds","mapHeader","mapHeaderPosition","getBoundingClientRect","bounds","LatLngBounds","LatLng","Marker","temp","setDraggable","panTo","setZoom","addListener","latLng","scrollTo","setMapOnAll","bookmark","yOffset","onScroll","scrollPos","scrollY","scrolledPastHeader","getMapHeaderTop","topOffset","offsetHeigh","scrollMap","sortByKeywordArray","originalSites","keyword","updated_at","setMap","clearMarkers","showMarkers","deleteMarkers","importSite","setPosition","setTitle","exportSites","status_controller","onLogsRefreshed","logParams","new_show","concat","transitionTo","current","siteForm","$invalid","tempObj","attrArray","locationArray","del","delAllEmptySites","siteIds","rec_count","show_state_param","has_logs","activate","published","$item","showAssetsCarousel","showCarousel","images","active","capitalizeFirstLetter","string","charAt","external_id","assets","asset","meta","reader","FileReader","readAsText","confirmRevoke","genToken","token_created_on","created","base64token","expires","dontRefreshLogs","itemGroup","group","tick","selected_site","plot_uri","a2SoundscapeCompositionService","newClass","canManageClasses","classes","addNewClass","groupType","scClass","classGroup","scientific_name","speciesClasses","songtype_name","message2","classesIds","project_classes","songtypes","searchSpecies","clearTimeout","results","lastSet","lastPage","lastRoi","lastRoiSet","viewState","lastSpecie","lastSongtype","getLastSet","ls","lp","lr","lrs","vs","sp","sg","setLastSet","setLastPage","setLastRoi","setLastRoiSet","setViewState","setLastSpecies","valsp","valsg","a2TrainingSetHistory","roi_index","pages","details","detailedView","currentrois","roisPerpage","loaderDisplay","getROIVisualizerUrl","projecturl","setROI","setPage","setROISet","nextROI","prevROI","nextPage","prevPage","affectedRows","closeSetDetails","showSetDetails","getTrainingSetList","trainingSets","date_created","tset","selectTrainingSet","addNewTrainingSet","validations","speciesData","setupExportUrl","export_url","exportTSReport","setDetailedView","editSelectedTrainingSet","speciesClass","editedTrainingSet","finally","deleteSelectedTrainingSet","JobsData","showClassifications","showTrainings","showSoundscapes","successInfo","showSuccesss","errorInfo","showErrors","infoInfo","showInfo","updateFlags","showSuccess","showError","hideJob","updateJobs","getJobTypes","job_types_id","for","c","getJobs","new_jobs","startTimer","cancelTimer","showActiveJobs","showEmptyList","showLoader","titlen","vl","modalInstance","opened","job","percentage","isCompleted","isProcessing","isWaiting","openJob","href","intervalPromise","last3Months","job_type_id","geturl","cancelInterval","citizen-scientist","a2Templates","$templateFetch","a2PatternMatching","done","isSpeciesLoading","speciesQty","recsQty","templateQty","pmQty","accessCheck","plan_due","deleteProject","userToAdd","curQuery","users","roles","findUser","inviteUser","user_email","invite","showInvitationPopup","noResults","changeRole","role","rolename","role_id","_this","isDataValid","A2AudioObject","a2Playlists","gain_levels","freq_filter","is_playing","is_muted","has_recording","has_next_recording","has_prev_recording","resource_params","isPopupOpened","isSavingPlaylist","playlistData","clustersData","f","fmin","fmax","minFreq","discard","setFrequencyFilter","getVolume","audio","volume","getCurrentTime","currentTime","togglePopup","isPlaylistDataValid","playlistName","closePopup","savePlaylist","playlist_name","aedIdsIncluded","_load_resource","pk","k","onCompleteListeners","load_promise","mute","muted","prev_recording","next_recording","form","display","loadAudio","deferred","Audio","interval","_check_current_time","nativeAudio","paused","canPlay","complete","restart","discarded","setVolume","unmutedVolume","setPlaybackRate","playbackRate","setMuting","muting","setProgress","progress","layer_types","layer_type","layer","layer_key","layer_url","layer_tmp","layer_el","type_array","addLayerType","layerType","lt","layers","VisualizerCtrl","__new_layer__","layer_def","layer_maker","cname","warn","__check_type","reqtype","curtype","check_requirements","req","browsetype","visobject_type","votype","selection","that","sidebar_visible","spectrogram_visible","display_sidebar","display_spectrogram","spectrogram","training_set_types","tst","editor","min_eps","scalex","scaley","points","tracer","make_new_bbox","add_tracer_point","add_point","similars","pt","dx","dy","tmp_points","pts_x","pts_y","x1","y1","x2","y2","resolve_tag","label_classes","default_colors_by_type","species_sound","clsprefix","resolve_species_tag","closeable","showCount","onClose","$viewport","$el","affix_c","affix_left","affix_right","affix_align_h","affix_top","affix_bottom","affix_align_v","a2AffixCompute","doLayout","fix_scroll_center","components","visualizer_root","y_axis","x_axis","component","$li","li","doXAxisLayout","doYAxisLayout","doLegendLayout","scroll_center","viewport","onScrolling","d3_x_axis","spec_h","layout_tmp","make_axis","d3_y_axis","d3_legend","preserveAspectRatio","xlink:href","tmp","onPlaying","max_s_h","max_s_w","s1","sec2px","s2","hz1","hz2px","hz2","hz","onMouseMove","elOff","pointer","sec","x2sec","y2hz","tick_format","tickFormat","unit_format","getRecordingPlaybackTime","oldValue","pbh","sl","slw","$root","$eloff","$roff","a2VisualizerSpectrogramAffixed","newval","oldval","class2key","project_class","pc","add_validation","present","presentReview","presentAed","load_project_classes","taxons","taxon","byTaxon","is_selected","sel_range","Infinity","taxonSpecies","si","se","ctrlKey","key_idx","sel_pc_id","determinedFrom","val_state","showDropdown","transclude","closed","toggleSidebar","visualizer","clusters","idA","squash","idB","idC","lc","whenBrowserIsAvailable","parseAnnotations","locman","__expected","sync","update_path","updateParams","all_params","pv","dont_sync","path_changed","browserAvailable","__onBrowserAvailable__","notifyBrowserAvailable","a2VisualizerLayers","itemSelection","a2SpectrogramClick2Zoom","VisualizerObjectTypes","VisualizerLayout","a2VisualizerLocationManager","initial_state_params","annotationsString","annotations","comps","parsed","comp","pair","addLayer","fullfillsRequirements","isSidebarVisible","isSpectrogramVisible","canDisplayInSidebar","canDisplayInSpectrogram","set_location","click2zoom","getLayers","setVisObject","isUploading","visobject_location","visobject_loader","getLoader","loading_visobject","getCaptionFor","boxes","removeFromLocalStorage","setYScaleOptions","getSelectedFrequencyCache","originalScale","deselectFrequencyOptions","yAxisOptions","scaleCache","convertedScale","max_freq","resizeYScale","span","sampling_rate","makeClass","VisualizerLayoutSpecs","align_to_interval","align","unit_interval","u","get_domain","make_scale","ordinal","dd","dr","linear_interpolate","levels","def_sec2px","def_hz2px","max_sec2px","max_hz2px","interval_align","seconds","hertz","sec2x","hz2y","dsec2width","seconds1","seconds2","inclusive","dhz2height","eh","ehi","ehe","apply_spectrogram","avail_w","scalelegend","avail_h","zoom_levels_x","levelx","zoom_levels_y","levely","zoom_sec2px","zoom_hz2px","spec_w","has_legend","sh","sw","root","apply_plotted","a22PointBBoxEditor","toggle_active","zoom_out","zoom_reset","cp","lzoom","zoom_x","zoom_y","zoom_level_x","zoom_level_y","horizontal","switched","set_by_mouse","track","trackpos","px","py","$promisedResolve","$openModal","reload","audioEventDetectionsList","AudioEventDetectionService","onSubmit","fltr","AudioEventDetectionParametersEditTemplateUrls","algorithmsList","statisticsList","getDefaultName","notifyAedAlgorithmChanged","algorithmParametersTemplate","recomputeDefaultName","a2AudioEventDetectionsClustering","loadAudioEventDetections","showRefreshBtn","dataExtended","aedCount","audioEventDetectionsOriginal","audioEventDetectionsData","onSelectedJob","first_playlist_recording","createNewClusteringModel","deleteAedJob","aedJob","ret","modArr","indx","findIndex","deletingloader","areaThreshold","amplitudeThreshold","durationThreshold","bandwidthThreshold","filterSize","minFrequency","maxFrequency","isRfcxUser","errorJobLimit","checkLimit","toggleDetails","newJob","clusteringModel","totalRecordings","isJobValid","isNotDefined","showNameWarning","showPlaylistLimitWarning","showFrequencyWarning","ngTableParams","a2CNN","$stateParams","selectedCNNId","initTable","acsDesc","tableConfig","sorting","tableParams","$defer","infopanedata","filteredData","cnnOriginal","orderedData","orderBy","cnnsData","loadCNNs","createNewCNN","deleteCNN","cnn","selectItem","selectedPatternMatchingId","project_name","models","lambdas","model","lambda","cnn_id","onSetDetailedView","onGoBack","a2AudioBarService","lists","thumbnails","thumbnailClass","CNNExportUrl","exportCnnReport","viewType","mainResults","counts","selectFn","validated","resultsROIs","refreshDetails","job_details","bySpecies","dataIn","dataOut","byROIs","thresh","over_thresh","byROIsbySpecies","bySite","byRecordings","recording_id","thumbnail","species_list","bySpeciesHist","speciesTimes","speciesName","getHours","getMinutes","plotShown","showHist","speciesInfo","trace","xbins","end","tickformat","getRecordingVisualizerUrl","getRoiVisualizerUrl","box","getTemplateVisualizerUrl","playRoiAudio","force","loadROIPage","moveROIPage","setSpecies","site_name","roi_species_counts","getSpeciesCounts","roi_species_sites_counts","roi_sites_counts","getSitesCounts","count_all_species","N","all_species","count_all_sites","all_site","setSite","rois_species","roiIds","headerTop","header","species_sites_matrix","roi_site_counts","roi_site_counts_dict","sitesAcc","onSearchChanged","switchView","specie","count_all","all_sites","detailType","freqMin","freqMax","gridContext","a2ClusteringJobs","selectedClusteringJobId","showViewGridPage","getProjectData","isProjectDisabled","loadClusteringJobs","clusteringJobsOriginal","clusteringJobsData","clusteringJob","clustering_job_id","createNewClusteringJob","deleteClusteringJob","toggleMenu","selectedCluster","frequencyFilter","currentMin","currentMax","decrementClusters","selectCluster","incrementClusters","shapes","shape","fillcolor","selection.line.color","selection.line.opacity","selection.line.stroke-width","getShapePoints","isFilteredClusters","sortFilteredData","selectedAedList","ind","isEmpty","countAudioEventDetected","aedsDetected","clustersDetected","countClustersDetected","drawClusteringPoints","getColor","rgb","originalData","xref","yref","x0","y0","opacity","cluster","offsetWidth","showlegend","side","xanchor","itemclick","stroke-width","resetSelect","redraw","hoverdistance","dragLayer","getElementsByClassName","xAxisRangeStart","fullData","$scope.layout.shapes[i].line.color","$scope.layout.shapes[i].line.stroke-width","point","curveNumber","pointNumber","onGridViewSelected","showClustersInVisualizer","selectedClusters","aedDataInfo","recIds","aed_id","time_min","freq_low","time_max","freq_high","tempPlaylistData","showDetailsPage","gridViewSelected","openFreqFilterModal","frequency","useFrequencyFilterData","sum","res","x_coord","y_coord","aed_info","parseInt","filterData","has_previous_filter","remove_filter","apply_filter","saving","aed_job","minPoints","distanceThreshold","maxClusterSize","accessExportReport","isExporting","errMess","changedUserEmail","isSquareSize","allRois","selectedRois","paginationSettings","totalItems","totalPages","selectedFilterData","aedData","speciesLoading","isShiftKeyHolding","gridData","markBoxesAsSelected","updateInputState","setCurrentPage","showPagination","isFilterChanged","getStatusForEmptyData","isRoisLoading","groupedData","entries","entry","matched","getRoisDetailsSegment","combineRoisPerCluster","roisPerCluster","exportReport","openExportPopup","listParams","groupRoisBySpecies","ids","grids","speciesObj","aeds","frequency_min","frequency_max","toggleBoxSize","recIdsIncluded","isValidationAccessible","setValidation","isClearValidation","markBoxesWithCurrentValidation","unselectBoxes","getSelectedDetectionIds","isSelected","getCombinedDetections","combinedDetections","toggleDetection","selectedDetectionIds","firstInx","secondInx","det","arrayOfIndx","filteredDetections","_det","inputs","querySelectorAll","indeterminate","totalJobs","source_project_uri","patternmatchingId","loadPatternMatchings","pmName","splitAllSites","patternmatchingsOriginal","patternmatchingsData","resetPagination","isShowSearch","createNewPatternMatching","deletePatternMatching","sitesList","sitesListBatchSize","sitesBatches","paginationTotal","fetchDetails","loadSitesList","loadData","templateParameters","Threshold","Matches/Recording","Matches/Site","persite","recalculateSiteListBatch","patternMatchingExportUrl","exportPmReport","sitesTotal","splitSitesListIntoBatches","batches","getCountPerSite","countPerSite","recalculateTotalItems","absent","shouldRecalculate","setSiteBookmark","scorePerSite","shouldGetPerSite","getSiteBatchIndexBySiteId","siteId","batch","getSiteBatchBySiteId","batchIndex","getSiteBatchByPageNumber","combOpts","offsetCalc","pageNumber","parseRoisResult","sitename","siteBookmark","siteBatch","playTemplateAudio","setRoi","forEachRoi","val_delta","0","1","null","templates","createPatternMatching","isSaving","warningMessage","getTemplates","getPlaylists","isWarningMessage","onExpressionSelected","requires","onSelected","$interpolate","operations","nameTemplate","removeOnInvalidateHandler","updateNamePlaceholder","operation","term1","term2","namePlaceholder","playlist1","playlist2","operate","pname","pl","pid","soundscapesOriginal","soundscapesData","filtered","loadSoundscapes","stateData","deleteSoundscape","createNewSoundscape","amplitudeReferences","showDetails","plist","exportSoundscape","buttonEnableFlag","datasubmit","aggregation","thresholdReference","bin","bandwidth","nameMsg","aggregationValue","tr","nv","buttonEnable","aggregations","aggr","aggre","svgContainer","axisScale","tickValues","afterGetAmplitudeReferences","setAmplitudeReference","amplitudeReference","thresholdInvPercent","lineData","peaks","MARGINS","vis","xRange","yRange","tickSize","tickSubdivide","drawAmpThreshold","ampThresh","yval","peaki","peakText","banwidthValue","xval","lineFunc","WIDTH","showDownload","chartOptions","ACI","NP","indices","min_t","onExport","identifier","placeholder","preselected","badges","vals_present","vals_absent","a2Tags","cl","recordingDataFieldTypes","parameter_set","parameter_set_list","allLists","listByValue","checkSelectedValue","selectedItem","resetFilters","isDisabled","isRecordingEmpty","exportData","recTotal","onApplyFilters","applyFilters","getFilters","fetchOptions","a2Classi","_1_get","attribute","_1_mapper","mapFn","staticMonths","staticDays","day","staticHours","hour","_1_get_value_mapper","_1_get_id_mapper","_1_get_tag_id_mapper","_1_get_flags_mapper","findObjectWith","classification_results","model_only","flags","equiv","model_th","th","presence","sites_ids","years","hours","classifications","soundscape_composition","soundscape_composition_annotation","filterDefs","filterDef","vals","getRecordingsStatsPerSite","proms","recAv","levelIds","getFilterOptions","currentLevel","child","siteObj","itemCount","month","minute","setRecStatsStatic","maxYear","minYear","toISOString","tagsObj","computeClassificationResultsOptions","haveThreshold","old_crs","crs_key","new_crs","cr","new_cr","selectedRecId","checkedRec","getSearchParameters","output","searchRecs","expect","recs","totalRecs","rec","date_range","min_date","max_date","sortRecs","reloadList","exportPermit","createPlaylist","isDisableDeleteRecs","deleteRecordings","imported","note","deleteAllRecordings","importedCount","importedSites","combineCheckedRecordings","selectRec","setLimitPerPage","exportRecordings","changePlaylistName","isExportingRecs","changeUserEmail","loadImage","customSrc","isAdding","currentTab","pagination","goToSourceProject","reloadPage","deleteTemplate","confirmed","toggleTab","access","addTemplate","source_project_id","a2UploadsService","bytes","newBytes","pow","String","uploads","AppListingsService","verifyAndUpload","uploading","_verifyAndUpload","uploader","queue","file","isError","errorMsg","isSuccess","isDuplicate","upload","onSuccess","isCheckingStatus","queueJobToCheckStatus","uploadingFiles","getUploadingFiles","userFiles","fileObj","filesToCheck","uploadUrl","uploadId","userFile","makeSuccessItem","isUploaded","checkUploadingFiles","checkStatusInterval","uploaderAppListing","stopQueue","getUploader","fileTimezone","utcDiff","selectSite","local","utcOffset","isStartUploadDisabled","isLimitExceeded","randomString","random","uploaderApps","mac","windows","qItem","onErrorItem","onSuccessItem","getProgress","removeCompleted","getCountOfUploaded","uploaded","clearQueue","onProgressAll","FileUploader","returnValue","a2CitizenScientistService","Users","vars","_var","groupStats","overall","__","a2CitizenScientistExpertService","cnp","expertSearch","compositeValidation","expert_val","expert_validated","consensus_val","consensus_validated","cs_val_present","cs_val_not_present","arg","onExpertSearchChanged","cs_validated","conflict_unresolved","conflict_resolved","oldtag","newtag","cs_conflict_resolved","cs_conflict_unresolved","expert_consensus_absent","expert_consensus_present","nextMatch","prevMatch","cs_total","cs_absent","cs_present","onVisObject","browser","waitForInitialized","vobject_type","$p","$eo","$po","$dt","animate","selectVisObject","selectPreviousVisObject","selectNextVisObject","setBrowserLocation","setBrowserAnnotations","clearRecordingData","notifyVisobjUpdated","serializePromisedFn","BrowserLOVOs","BrowserVisObjects","$grouping","visobjectTypes","dates","auto","visobj","lovo","initialized","waitForInitializedDefer","setBrowserType","$list","default","$type","currentRecording","setLOVO","recordingsBySite","updateRecording","setVisObj","new_$type","old_$type","a2Browser","differ","deactivate","get_location","cachedLocation","object_type","vobj","auto_select","previous","loc","lovos_def","resolve_location","visobjects","lovos","lovodef","groups","setArray","getXSide","getXCoord","getTransform","getYTranslation","asrelativeoffset","layer_typesProvider","hide_visibility","makeTagsIndex","groupByBbox","bboxes","bboxIdx","bbox_key","lookaheadHelper","spectrogramTags","tagsIndex","bboxTags","bboxTagsIndex","setVisobject","loadTags","searchedTags","searchTags","getProjectTags","onTagListChanged","tagUpdate","determineTagUpdate","updateTags","onBBoxTagListChanged","oldTagsIndex","toDelete","updateResponse","resetBboxTags","classesByType","classTypes","annotationToolbar","classId","scclassId","loadAnnotations","recordingTemplates","getTemplatesPromise","updateState","goToSpeciesPage","make_new_roi","get_placeholder_name","submitting","template_name","new_template","VisualizerObjectTypesProvider","$loader","VisualizerObjectAudioEventDetectionTypeLoader","aggregates","statisticsInfo","getParameters","_aggregates","_statistics","AudioEventDetection","selectData","tod","y_max","fetch","zoomable","data_selection","savePlot","getCaption","typeDef","VisualizerObjectRecordingTypeLoader","khz_format","extra","sample_rate","tiles","tile","legacy","streamId","datetime_utc","valueOf","ds","audioUrl","VisualizerObjectSoundscapeTypeLoader","khz_unit_fmt","time_of_day","time_unit","unit_fmt","day_of_month","day_of_year","month_in_year","localeData","_months","day_of_week","_weekdays","unknown","agg","max_t","min_f","max_f","v0","min_value","v1","visual_max_value","max_value","normalized","dt","df","dv","bin_size","visual_palette","dhz","crisp","classificationsOriginal","classificationsData","capitalize","loadClassifications","muser","showClassificationDetails","classi","model_id","windowClass","ClassiInfo","createNewClassification","deleteClassification","a2Models","loadClassifiedRec","classiData","maxPerPage","dataRec","maxVal","vector","htresDeci","recVect","minv","maxv","maxvRounded","gotoc","where","toggleRecDetails","showMore","csvUrl","table","errCount","modelInfo","recselected","showselection","datas","classifier","selectedSites","vectorData","minvect","maxvect","loadingflag","drawVector","xStep","modelsDataOrig","modelsData","loadModels","deleteModel","model_name","validationdata","newModel","trainings","training","totalValidations","presentValidations","absentsValidations","usePresentTraining","useNotPresentTraining","usePresentValidation","useNotPresentValidation","jobDisabled","totalPresentValidation","totalNotPresentValidation","disableCreateButton","training_set_id","model_type_id","tp","tn","vp","vn","scopeExited","getVectors","waitinFunction","currRec","vmax","vmin","allMax","allMin","vectorNoMax","allYesMax","showValidationsTable","loadingValidations","showModelValidations","messageSaved","suggestedThreshold","isNaN","ii","jj","searchTh","thresholdObject","precisionObject","accuracyObject","sensitivityObject","specificityObject","sumObject","tries","computeStats","thres","accuracy","sensitivity","specificity","precisionMaxIndices","sensitivityMaxIndices","accuracyMaxIndices","specificityMaxIndices","accum","currentThreshold","tpos","fpos","tneg","fneg","trupositive","falsepositives","truenegatives","falsenegative","saveThreshold","recalculate","parseFloat","newthres","zoomout","zoomin","isExport","getValidations","recDetails","closeRecValidationsDetails","gotoRec","rurl","a2CitizenScientistAdminService","loadForSpecies","loadingForSpecies","speciesStats","userStatsExportUrl","setUser","loadForUser","loadingForUser","userStats","patternmatchings","pm","citizen_scientist","cs_expert","consensus_number","BrowserVisObjectsProvider","BrowserLOVOsProvider","cardTemplate","a2ArrayLOVO","audioEventDetection","audioEventDetections_lovo","scd","scid","regionid","soundscapes","caption2","soundscapes_lovo","audioEvents","clusteringEvents","isAudioEventsPlaylist","selectedAudioEventJob","clusterPlaylists","isPlaylist","toggleAudioEvents","isJobsBoxes","audioEventJobs","borderColor","hexToRGB","backgroundColor","hex","isHighlightTitle","fetchAudioEvents","freq_min","freq_max","sidebar_only","tagid","explorerUrl","speciesPresence","isRemoving","checkSpectroWidth","leftBox","widthBox","widthSpectro","confirmPopup","pattern_matching_roi_id","fetchSpeciesPresence","aedValidations","training_set_typesProvider","has_layout","layer_item","new_modal","collect_new_tset_data","sdata","sval","typedef","roi_set","fetchData","tsetId","new_tset_data","tset_type","tset_list","training_sets","add_new_tset","new_tset","fetchTsetData","cont_name","a2VisualizerSpectrogramTrainingSetData","type_def","loadingClasses","loadingTypes","tset_types","$cacheFactory","finished","loadNext","vaxis","equals","rbDateAvailabilityCache","a2RecordingsBySiteLOVO","siteInfo","refreshing","display_year","date_counts","datepickerMode","get_counts_for","availability","fetch_counts","fetching","avail","site_years","year_months","month_days","akey","fetch_year_range","records","utcdateaslocal","recdate","getTimezoneOffset","set_site","set_date","make_lovo","site_match","set_dates_display_year","new_display_year","year_range","yearpickOpen","a2Pager","PageSize","BlockSize","whole_list","paging","item_count","page_size","block_size","block_tracks_page","on_page","load_page","set_page","playlist_info","append_extras","find_local","found_rec","page_for","last_page","set_options","resolve_value","last","current_page","is_at_first_page","is_at_last_page","show_block","last_page_block","block","current_page_block","is_at_first_page_block","is_at_last_page_block","current_page_block_first_page","current_page_block_last_page","has_page","a2PlaylistLOVO","pld","resolve_link","plid","recid","set_playlist","bbox2string","names","view_playlist","regions","sample","quantize","xi","yi","selbox","view_samples","sc","vdata","form_data","edit_visual_scale","palettes","visual_max","threshold_type","amplitude","amplitudeThresholdType","visualMax","scidx","norm_vector","ampTh","getMaxAmplitude","pallen1","_cl","cell","act","al","ali","ale","__maxAmplitude","maxAmp","cellMax","_soundscape","_scidx","_normalized","_norm_vector"],"mappings":"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AAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAM1wb5Q,UAAW,SAAUgO,GACnB,GAAI6C,GAAOF,EAAoBC,UAAU5C,GACrC8C,EAAMD,EAAKrvC,OAAS,CACxB,OAAOqvC,GAAK/sC,IAAI,SAAU4X,EAAGoF,GAC3B,OAAQA,EAAIgwB,EAAKp1B,MAIvB,OAAOi1B,KCvBTjzC,QAAQC,OAAO,qBAAsBW,QAAQ,aAAA,QAAa,SAAU4D,GAClE,GAAIsmB,EACJ,QACErmB,IAAK,SAAUmM,GACb,GAAIka,EAAW,MAAOla,GAASka,EAC/BtmB,GAAMC,IAAI,yBAAyByC,QAAQ,SAAU9D,GACnD0nB,EAAY1nB,EACZwN,EAASka,UCPjB9qB,QAAQC,OAAO,aAAcoO,QAAQ,UAAA,UAAU,SAAUnL,GACvD,GAAImwC,GAASnwC,EAAQmwC,MAiBrB,OAhBAA,GAAOC,QAAU,IACjBD,EAAOE,QAAU,kBACjBF,EAAO9yC,MAAQ8yC,EAAOG,OACpBC,QAASJ,EAAOE,QAAU,WAE5BF,EAAOv6B,KAAOu6B,EAAOG,OACnBC,QAASJ,EAAOE,QAAU,UAE5BF,EAAOnsC,QAAUmsC,EAAOG,OACtBC,QAASJ,EAAOE,QAAU,aAG5BF,EAAOjlC,YAAc,WACnBilC,EAAO9yC,MAAM,oCAGR8yC,KClBTrzC,QAAQC,OAAO,mCAAoCW,QAAQ,kBAAmB,WAC5E,GAAIsrC,IACFnP,MAAO,SAAe2W,EAAOzrC,EAAOgb,GAGlC,IAAK,GAFDjF,MAEKoF,EAAI,EAAGla,EAAIwqC,EAAOtwB,EAAInb,IAASmb,EAAGla,GAAK+Z,EAC9CjF,EAAEE,KAAKhV,EAGT,OAAO8U,IAETouB,UAAW,SAAmBhpC,EAAMuwC,GAClC,OAAQvwC,OAAYgD,IAAI,SAAUq4B,GAChC,MAAOz+B,SAAQwqB,MAAMxqB,QAAQ8N,KAAK6lC,EAASlV,EAAM13B,WAAc03B,MAGnE4N,YAAa,SAAqBF,EAAQwH,GACxC,MAAO3zC,SAAQwqB,MAAMxqB,QAAQ8N,KAAK6lC,EAASxH,QAASA,IAEtDyH,gBAAiB,SAAU1qC,EAAG4G,EAAGC,EAAG3M,EAAMkB,GACxC,GAAIuvC,IACFzwC,MACE2D,KAAM,UACN+sC,UAAW,QACXC,UACEzvC,MAAOyL,EAAEzL,QAIb6nC,QACE7nC,MAAOA,EACP0vC,OACEC,WAAY,OACZ3vC,MAAO4E,EAAE5E,MACT4vC,WAAYhrC,EAAEirC,OAAS,IAEzBC,OACEH,WAAY,OACZ3vC,MAAOwL,EAAExL,MACT4vC,WAAYpkC,EAAEqkC,OAAS,KAqB7B,OAhBI/wC,GAAKia,MACPw2B,EAAKzwC,KAAK8F,EAAI9F,EAAKia,KAAKjX,IAAI,SAAU4X,GACpC,MAAO5a,GAAK8F,EAAE40B,IAAM16B,EAAK8F,EAAE+Z,KAAOjF,EAAE9U,IAEtC2qC,EAAKzwC,KAAK0M,EAAI1M,EAAKia,KAAKjX,IAAI,SAAU4X,GACpC,MAAO5a,GAAK0M,EAAEguB,IAAM16B,EAAK0M,EAAEmT,KAAOjF,EAAElO,IAEtC+jC,EAAKzwC,KAAK2M,EAAI3M,EAAKia,KAAKjX,IAAI,SAAU4X,GACpC,MAAOA,GAAEjO,KAEF3M,EAAKixC,SACdR,EAAKzwC,KAAK8F,EAAIgjC,EAAgBnP,MAAM35B,EAAK8F,EAAE40B,IAAK16B,EAAK8F,EAAEorC,KAAMlxC,EAAK8F,EAAE+Z,MACpE4wB,EAAKzwC,KAAK0M,EAAIo8B,EAAgBnP,MAAM35B,EAAK0M,EAAEguB,IAAK16B,EAAK0M,EAAEwkC,KAAMlxC,EAAK0M,EAAEmT,MACpE4wB,EAAKzwC,KAAK2M,EAAI3M,EAAKixC,QAGdR,GAETU,YAAa,SAAUrrC,EAAG4G,EAAG1M,EAAMkB,GACjC,GAAIuvC,IACFzwC,MACEoxC,YAAa,IACbztC,KAAM,OAERolC,QACE7nC,MAAOA,EACP0vC,OACEC,WAAY,OACZ3vC,MAAO4E,EAAE5E,MACT4vC,WAAYhrC,EAAEirC,OAAS,IAEzBC,OACEH,WAAY,OACZ3vC,MAAOwL,EAAExL,QAiBf,OAZIlB,GAAKia,MACPw2B,EAAKzwC,KAAK8F,EAAI9F,EAAKia,KAAKjX,IAAI,SAAU4X,GACpC,MAAO5a,GAAK8F,EAAE40B,IAAM16B,EAAK8F,EAAE+Z,KAAOjF,EAAE9U,IAEtC2qC,EAAKzwC,KAAK0M,EAAI1M,EAAKia,KAAKjX,IAAI,SAAU4X,GACpC,MAAOA,GAAEjO,KAEF3M,EAAKixC,SACdR,EAAKzwC,KAAK8F,EAAIgjC,EAAgBnP,MAAM35B,EAAK8F,EAAE40B,IAAK16B,EAAK8F,EAAEorC,KAAMlxC,EAAK8F,EAAE+Z,MACpE4wB,EAAKzwC,KAAK0M,EAAI1M,EAAKixC,OAAO,IAGrBR,GAGX,OAAO3H,KCjGTlsC,QAAQC,OAAO,iBAAkB,6BAA6BoO,QAAQ,aAAA,mBAAa,SAAUomC,GAC3F,OACEC,OAAQD,EAAiBxE,WAAW1hB,OACpComB,WAAY,GACZC,WAAY,GACZC,cAAe,GACfC,aAAc,GACdC,cAAe,GACfC,UAAW,OCRfh1C,QAAQC,OAAO,8BAA+B,gBAAiB,oCAAoCO,SAAS,iBAAkB,WAC5H,GAAIyrC,IACF0H,YACAsB,IAAK,SAAUC,EAAazpC,GAExBwgC,EAAe0H,SADbloC,EACwBzL,QAAQwqB,MAAMmpB,SAAUuB,GAExBA,GAG9Bv0C,MAAA,wBAAM,SAAUw0C,GACd,MAAOn1C,SAAQwqB,MAAM2qB,EAAuBlJ,EAAe0H,YAG/D,OAAO1H,KACNrrC,QAAQ,yBAAA,YAAA,sBAAyB,SAAUw0C,EAAWnC,GACvD,GAAIU,IACF0B,WACEC,OAAQ,iDACRnM,KAAM,QAERoM,UACED,OAAQ,aACRnM,KAAM,OACN/G,MAAO,QAmCX,OAhCAuR,GAASrxC,QACPkzC,UAAU,EACVC,UAAU,EACVC,aAAa,EACbC,gBAAgB,EAChBC,YAAY,EACZC,wBAAyB,kBAAmB,gBAE9ClC,EAASxH,QACP6H,OACEqB,UAAW1B,EAAS0B,UACpBE,SAAU5B,EAAS4B,SACnBnT,MAAO,QAETgS,OACEiB,UAAW1B,EAAS0B,UACpBE,SAAU5B,EAAS4B,SACnBnT,MAAO,QAGT0T,aAAc,UACdC,cAAe,UACfC,SAAU,OAEZrC,EAASI,UACPwB,SAAU5B,EAAS4B,SACnBU,UAAWb,EAAUN,aAAeM,EAAUP,eAEhDlB,EAASuC,SACPC,WAAYlD,EAAoB3Q,UAAU,GAC1CyR,SAAUJ,EAASI,UAEdJ,KC3DT3zC,QAAQC,OAAO,4BAA6BoO,QAAQ,cAAe,WACjE,OACE8Y,SACA1Y,OAAQ,MACR2nC,MAAO,WACL31C,KAAK0mB,UAEP7P,OAAQ,SAAUxP,GAChBA,EAAMrH,KAAKgE,IAAIqD,EACf,IACIuuC,GADAC,EAAOxuC,EAAIgkB,QAAQ,KAGnByqB,GAAM,GAAI7tC,OAAOC,SAErB,IAAI2tC,GAAQ,EAAG,CACb,GAAIE,GAAK,GAAI3e,QAAO,QAAUp3B,KAAKgO,OAAS,WACxC2D,EAAQtK,EAAI8jC,OAAO0K,EAAO,EAI5BD,GAHMG,EAAGxnC,KAAKoD,GAGPtK,EAAI8jC,OAAO,EAAG0K,GAAQ,IAAMlkC,EAAM/I,QAAQmtC,EAAI/1C,KAAKgO,OAAS,IAAM8nC,GAElEzuC,EAAM,IAAMrH,KAAKgO,OAAS,IAAM8nC,MAGzCF,GAAOvuC,EAAM,IAAMrH,KAAKgO,OAAS,IAAM8nC,CAGzC91C,MAAK0mB,MAAMrf,GAAOuuC,EAClBtjB,EAAE,SAAWjrB,EAAM,MAAMyN,KAAK,MAAO,IAAIA,KAAK,MAAO8gC,IAEvD5xC,IAAK,SAAUqD,GAGb,IAFA,GAAIuuC,GAEGA,EAAO51C,KAAK0mB,MAAMrf,IACvBA,EAAMuuC,CAGR,OAAOvuC,OAGVhH,OAAO,gBAAA,cAAgB,SAAU21C,GAClC,MAAO,UAAU3uC,GACf,MAAO2uC,GAAYhyC,IAAIqD,OC3C3B9H,QAAQC,OAAO,gCAAiC,uCAAuCO,SAAS,oBAAqB,WACnH,GAAIk2C,IACFC,QACAhD,UACEiD,iBAAkB,UAAW,SAAU1zC,GACrC,MAAOA,GAAQzC,KAAKo2C,IAAIC,aAE1BC,QAAS,UAAW,KAAM,0BAA2B,SAAU7zC,EAASgC,EAAI8xC,GAC1E,GAAI3nC,GAAM5O,IACV,OAAOyE,GAAG,SAAUK,EAASuX,GAC3B,GAAIhV,GAAMuH,EAAIwnC,IAAI/uC,IACdylC,EAASrqC,EAAQvB,SAASqmC,cAAc,SAC5ChoC,SAAQsV,QAAQpS,EAAQvB,SAASs1C,MAAM9pB,OAAOogB,GAE1Cl+B,EAAIwnC,IAAIK,cACVpvC,IAAQ,KAAKqV,KAAKrV,GAAO,IAAM,KAAOuH,EAAIwnC,IAAIK,cAAgB,IAAMF,EAAwBzxC,GAC1FwsC,SAAS,IACRzqC,GAEHimC,EAAOlP,OAAS94B,EAGlBgoC,EAAO4J,QAAU,WACfr6B,KAGFywB,EAAOjP,IAAMx2B,OAInBsvC,OAAQ,SAAUC,EAASR,GACzBH,EAA0BC,KAAKU,IAC7B51C,KAAM41C,EACNR,IAAK72C,QAAQyL,UAAWirC,EAA0B/C,SAAUkD,KAGhEl2C,MAAA,KAAA,YAAM,SAAUuE,EAAIC,GAClB,GAAImyC,IACFrU,KAAM,SAAUoU,GACd,GAAIhoC,GAAMqnC,EAA0BC,KAAKU,EAEzC,OAAKhoC,IAIAA,EAAIpP,SACPoP,EAAIpP,OAASkF,EAAUK,OAAO6J,EAAIwnC,IAAID,gBAAiBvnC,IAGpDA,EAAI0N,UACH1N,EAAIpP,OACNoP,EAAI0N,QAAU7X,EAAGK,QAAQ8J,EAAIpP,SAE7BoP,EAAI0N,QAAU7X,EAAGK,UAEb8J,EAAIwnC,IAAIxT,SACVh0B,EAAI0N,QAAU1N,EAAI0N,QAAQrY,KAAK,WAC7B,MAAO4yC,GAAkBrU,KAAK5zB,EAAIwnC,IAAIxT,UACrC3+B,KAAK,WACN2K,EAAIg0B,OAASqT,EAA0BC,KAAKtnC,EAAIwnC,IAAIxT,WAIxDh0B,EAAI0N,QAAU1N,EAAI0N,QAAQrY,KAAK,WAC7B,MAAOS,GAAUK,OAAO6J,EAAIwnC,IAAIE,OAAQ1nC,KACvC3K,KAAK,WACN2K,EAAIpP,OAASkF,EAAUK,OAAO6J,EAAIwnC,IAAID,gBAAiBvnC,KACtD3K,KAAK,WACN,GAAI2K,EAAIwnC,IAAIxY,OACV,MAAOl5B,GAAUK,OAAO6J,EAAIwnC,IAAIxY,OAAQhvB,KAEzC3K,KAAK,WACN,MAAO2K,GAAIpP,WAKVoP,EAAI0N,SAnCF7X,EAAG4X,OAAO,yCAA2Cu6B,IAsClE,OAAOC,KAGX,OAAOZ,KCnFT12C,QAAQC,OAAO,yCAA0CoO,QAAQ,2BAAA,UAA2B,SAAUnL,GACpG,GAAIq0C,GAAK,CACT,OAAO,UAAUv7B,EAAI7J,GAEnB,GAAIqlC,GAAY,WACVrlC,GAAWA,EAAQ4/B,SACrByF,EAAUz1C,SAGZia,EAAGK,MAAM5b,KAAMyb,MAAMxN,UAAUtF,MAAM+S,KAAKC,YAY5C,OATAo7B,GAAUlwC,GAAK,WAAaiwC,IAC5Br0C,EAAQs0C,EAAUlwC,IAAMkwC,EAExBA,EAAUz1C,OAAS,WACbmB,EAAQs0C,EAAUlwC,KAAOkwC,SACpBt0C,GAAQs0C,EAAUlwC,KAItBkwC,MCrBXx3C,QAAQC,OAAO,2BAA4BoO,QAAQ,eAAA,KAAe,SAAUnJ,GAC1E,QAASuyC,KAGP,GAAIznC,GAAOkM,MAAMxN,UAAUtF,MAAM+S,KAAKC,WAClCJ,EAAKhM,EAAKglB,OACd,OAAO9vB,GAAG,SAAUK,EAASuX,GAC3B9M,EAAKkO,KAAK,SAAU/P,EAAKrF,GACnBqF,EACF2O,IAEAvX,EAAQuD,KAGZkT,EAAGK,MAAM,KAAMrM,KAgBnB,MAZAynC,GAAYjyC,OAAS,WAGnB,GAAIwK,GAAOkM,MAAMxN,UAAUtF,MAAM+S,KAAKC,WAClCy2B,EAAS7iC,EAAKglB,QACd5c,EAASpI,EAAKglB,OAClB,OAAOyiB,GAAY,SAAUC,GAC3B1nC,EAAKkO,KAAKw5B,GACV7E,EAAOz6B,GAAQiE,MAAMw2B,EAAQ7iC,MAI1BynC,KC9BTz3C,QAAQC,OAAO,iBAAkB,YAAa,uBAAuBqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACpGA,EAAmBS,UAAU,cAC7B20C,EAAeC,MAAM,QACnB9vC,IAAK,QACL5H,WAAY,gBACZ+K,YAAa,8BAEd/K,WAAW,iBAAA,SAAA,QAAA,YAAA,UAAiB,SAAUC,EAAQqE,EAAOuH,EAAW9I,GAOjE9C,EAAO03C,SAAW,WAChB,GAAIzlC,MACA0lC,EAAU,qCAEV33C,GAAOqB,OAAOiI,QAEhBtJ,EAAOqB,OAAOiI,OAAOJ,QAAQyuC,EAAS,SAAUngB,EAAOogB,EAAMC,EAAQC,EAAMC,GAGzE,GAAIp1C,GAAMi1C,GAAcE,EACpBnvC,EAAQkvC,GAAkBE,CACzB9lC,GAAMtP,KAAMsP,EAAMtP,OACvBsP,EAAMtP,GAAKob,KAAKpV,KAIhB3I,EAAOqB,OAAO22C,SAChB/lC,EAAM+lC,OAASh4C,EAAOqB,OAAO22C,OAAO/xC,IAAI,SAAU0P,GAChD,MAAOA,GAAErU,QAITtB,EAAOqB,OAAO42C,QAChBhmC,EAAMgmC,MAAQj4C,EAAOqB,OAAO42C,MAAMhyC,IAAI,SAAUoQ,GAC9C,MAAOA,GAAElP,MAIb9C,EAAMC,IAAI,eACRjD,OAAQ4Q,IACPlL,QAAQ,SAAU9D,GACnBjD,EAAOk4C,WAAaj1C,KAIxBjD,EAAOm4C,WAAa,WAClBn4C,EAAOqB,QACLiI,OAAQ,gBAIZtJ,EAAOo4C,aACPp4C,EAAOg4C,SACL12C,KAAM,UACN2gC,MAAO,QACP1oB,MAAM,IAENjY,KAAM,eACN2gC,MAAO,OACP1oB,MAAM,IAENjY,KAAM,QACN2gC,MAAO,UACP1oB,MAAM,IAENjY,KAAM,aACN2gC,MAAO,QACP1oB,MAAM,IAENjY,KAAM,YACN2gC,MAAO,QACP1oB,MAAM,IAENjY,KAAM,QACN2gC,MAAO,MACP1oB,MAAM,IAENjY,KAAM,WACN2gC,MAAO,OACP1oB,MAAM,IAENjY,KAAM,UACN2gC,MAAO,OACP1oB,MAAM,IAERvZ,EAAOm4C,aAjFe,SAAUE,GAC9Bh0C,EAAMC,IAAI,oBAAoByC,QAAQ,SAAU9D,GAC9CjD,EAAOs4C,WAAar1C,OAiFxBoB,EAAMC,IAAI,mBAAmByC,QAAQ,SAAUwxC,GAC7C,GAAI7oB,IAAU,UAAW,UAAW,UAAW,UAAW,UAC1D1vB,GAAO0vB,SAEP,KAAK,GAAIzM,GAAI,EAAGA,EAAIs1B,EAAS50C,OAAQsf,IAAK,CACxC,GAAI5M,GAAIkiC,EAASt1B,EACjBjjB,GAAO0vB,OAAOrZ,EAAE/U,MAAQouB,EAAOzM,EAAIyM,EAAO/rB,QAG5C3D,EAAOo4C,UAAYG,IAErBv4C,EAAO03C,cCtGT73C,QAAQC,OAAO,sCAAuCW,QAAQ,6BAAA,KAA6B,SAAUsE,GACnG,OACEyzC,YAAa,SAAU18B,EAAQgB,EAAM1b,EAAI2b,GACvC,MAAOhY,GAAG0J,KAAK,kCAAoCqN,EAAS,MAAQiB,EAAS,SAAWD,EAAKtU,UAAY,OAASpH,EAAGoH,gBCH3H3I,QAAQC,OAAO,sBAAuB,YAAa,eAAgB,WAAY,cAAe,gBAAiB,qBAAsB,SAAU,YAAa,kCAAmC,0CAA0CqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACxQA,EAAmBS,UAAU,cAC7B20C,EAAeC,MAAM,aACnB9vC,IAAK,aACL5H,WAAY,mCACZ+K,YAAa,mCAEd/K,WAAW,sBAAA,SAAA,QAAA,KAAA,cAAsB,SAAUC,EAAQqE,EAAOU,EAAIi0B,GAwD/D,QAASyf,GAAaC,GAIpB,IAAK,GAHDtU,GAA2B,gBAAZsU,GAAuBnzC,KAAKC,MAAMkzC,GAAYA,EAC7DC,EAAM,GAED11B,EAAI,EAAGA,EAAImhB,EAAMzgC,OAAQsf,IAAK,CACrC,GAAI7F,GAAO,EAEX,KAAK,GAAI7G,KAAS6tB,GAAMnhB,GACV,IAAR7F,IAAYA,GAAQ,KACxBA,GAAQgnB,EAAMnhB,GAAG1M,EAGnBoiC,IAAOv7B,EAAO,OAGhB,MAAOu7B,GAGT,QAASC,GAAcC,EAASz2B,EAAO02B,GACjCD,GACFz2B,EAAMkvB,QAAQuH,EAIhB,IAAIE,GAAaxzC,KAAKM,UAAUuc,GAC5B42B,EAAMP,EAAaM,GACnBE,EAAmBH,EAAY,QAAU,aACzClU,EAAO,GAAIM,OAAM8T,IACnBpyC,KAAM,2BAGR,IAAIsyC,UAAUC,WAEZD,UAAUC,WAAWvU,EAAMqU,OACtB,CACL,GAAIlxB,GAAOvmB,SAASqmC,cAAc,IAElC,QAAsB7lC,KAAlB+lB,EAAKqxB,SAAwB,CAC/B,GAAIzxC,GAAMy9B,IAAID,gBAAgBP,EAC9B7c,GAAKsxB,aAAa,OAAQ1xC,GAC1BogB,EAAKsxB,aAAa,WAAYJ,GAC9BlxB,EAAK+Z,MAAMhC,WAAa,SACxBt+B,SAASmgC,KAAK4L,YAAYxlB,GAC1BA,EAAKxS,QACL/T,SAASmgC,KAAK2X,YAAYvxB,KAKhC,QAASqxB,GAASn2C,GAChB,GAAI41C,IACFv3C,KAAM,OACNqL,MAAO,SAEL4sC,IAEJt2C,GAAK+D,QAAQ,SAAUS,GACrB8xC,EAAex7B,MACbzc,KAAMmG,EAAK+xC,UAAY,IAAM/xC,EAAKqG,SAClCnB,MAAOlF,EAAKkF,UAGhBisC,EAAcC,EAASU,EAAgB,SArHzCv5C,EAAOy5C,MAAQzgB,EAAY,mCACzBh5B,OAAUA,IAGZA,EAAO05C,gBAAkB,WACvBr1C,EAAMC,IAAI,oBAAoByC,QAAQ,SAAU9D,GAC9Cm2C,EAASn2C,MAIboB,EAAMC,IAAI,0BAA0ByC,QAAQ,SAAU9D,GACpDjD,EAAO25C,SAAW12C,EAAK02C,SACvB35C,EAAO45C,YAAc32C,EAAK22C,YAC1B55C,EAAO65C,KAAO52C,EAAKq1C,WACnBt4C,EAAO85C,SAAW72C,EAAK62C,SACvB95C,EAAO+5C,SAAW92C,EAAK82C,SACvB/5C,EAAOg6C,YAAc/2C,EAAK+2C,YAC1Bh6C,EAAOi6C,SAAWh3C,EAAKg3C,WAGzBj6C,EAAOk6C,kBAAoB,WACzB71C,EAAMC,IAAI,0BAA0ByC,QAAQ,SAAU9D,GACpDjD,EAAOyR,SAAWxO,KAItBjD,EAAOk6C,oBAEPl6C,EAAOm6C,WAAa,SAAUC,EAASzxC,GACrC,GAAI8T,GAAI1X,EAAG2X,OAkBX,OAhBK09B,GAGH/1C,EAAMsK,IAAI,0BACRyrC,QAASA,EACTzxC,MAAOA,IACN5B,QAAQ,SAAU9D,GACnBjD,EAAOk6C,oBACPz9B,EAAErX,QAAQnC,EAAKm3C,MACdh6C,MAAM,SAAU6C,GACjB9C,QAAQC,MAAM6C,GACdjD,EAAOk6C,oBACPz9B,EAAEE,OAAO1Z,KAXXwZ,EAAErX,UAeGqX,EAAEG,SAGX5c,EAAOq6C,cAAgB,SAAUD,GAC/B,GAAIzxC,GAAoC,MAA5B3I,EAAOyR,SAAS2oC,GAAmB,MAAQ,IACvD,OAAO95C,MAAK65C,WAAWC,EAASzxC,OC5DpC9I,QAAQC,OAAO,yCAA0C,qBAAsB,kCAAmC,gCAAgCC,WAAW,mCAAA,SAAA,UAAA,KAAA,4BAAmC,SAAUC,EAAQ+C,EAASgC,EAAIu1C,GAC7N,QAASC,GAAiBz9B,EAAM09B,GAC9B,MAAO,YACL,GAAIC,GAAiB,OAAR39B,EAAgB,GAAIvU,MAAS,GAAIA,MAAKuU,GAC/C49B,EAAO,GAAInyC,MAAKkyC,EAAOjyC,UAAYgyC,EAEvC,IAAIA,EAAQ,EAAG,CACb,GAAInkC,GAAIokC,CACRA,GAASC,EACTA,EAAOrkC,EAGT,OAAQokC,EAAQC,IAIpB,QAASC,GAAWjK,EAAKlxB,GACvB,MAAOkxB,GAAI/vC,OAAO,SAAUoI,GAC1B,MAAOA,GAAEyW,KAAOA,IACfqV,QAGL,QAAS+lB,GAAY5oC,GACnB,GAAIoD,GAAOpD,EAAQ/O,KACf43C,EAAU7oC,EAAQwjB,KAAOpgB,EACzBshC,EAAM1kC,EAAQ0kC,GAClB,OAAO,UAAa/tC,GAelB,MAdoB,gBAATA,KACTA,EAAQgyC,EAAWr6C,KAAK2C,KAAKmS,GAAOzM,IAGjCA,IACHA,EAAQgyC,EAAWr6C,KAAK2C,KAAKmS,GAAOshC,IAGtCp2C,KAAKuyB,SAASgoB,GAAWlyC,EAErBA,EAAMuT,OACRvT,EAAMuT,MAAM5b,MAGPA,KAAKw6C,gBAIhBx6C,KAAK2C,MACH6Y,SACE0D,IAAK,WACLle,KAAM,WACNm7B,KAAM,mBAIRse,cACEv7B,IAAK,SACLoB,KAAM,YACNgc,MAAO2d,EAAiB,OAAO,QAE/B/6B,IAAK,SACLoB,KAAM,eACNgc,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,SACLoB,KAAM;oBACNgc,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,UACLoB,KAAM,gBACNgc,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,UACLoB,KAAM,gBACNgc,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,SACLoB,KAAM,cACNgc,MAAO2d,EAAiB,OAAO,UAE/B/6B,IAAK,SACLoB,KAAM,YACNgc,MAAO2d,EAAiB,OAAO,UAE/B/6B,IAAK,UACLoB,KAAM,eACNgc,MAAO2d,EAAiB,OAAO,WAE/B/6B,IAAK,UACLoB,KAAM,aACNgc,MAAO2d,EAAiB,OAAO,WAEjCS,UACEx7B,IAAK,WACLoB,KAAM,WACNq6B,SAAU,QACVC,YAAa,MAEb17B,IAAK,YACLoB,KAAM,YACNq6B,SAAU,SACVC,YAAa,MAEb17B,IAAK,aACLoB,KAAM,aACNq6B,SAAU,UACVC,YAAa,MAEb17B,IAAK,aACLoB,KAAM,aACNq6B,SAAU,UACVC,YAAa,OAEb17B,IAAK,SACLoB,KAAM,SACNq6B,SAAU,SACVC,YAAa,OAEb17B,IAAK,UACLoB,KAAM,UACNq6B,SAAU,UACVC,YAAa,QAEb17B,IAAK,UACLoB,KAAM,UACNq6B,SAAU,UACVC,YAAa,QAEb17B,IAAK,QACLoB,KAAM,QACNq6B,SAAU,QACVC,YAAa,SAKjB56C,KAAK6M,WACL7M,KAAKuyB,UACH/W,OAAQ6+B,EAAWr6C,KAAK2C,KAAK6Y,OAAQ,YACrCq/B,WAAYR,EAAWr6C,KAAK2C,KAAK83C,YAAa,UAC9Ch+B,OAAQ49B,EAAWr6C,KAAK2C,KAAK+3C,QAAS,UAExC16C,KAAK86C,WAAaR,GAChB33C,KAAM,SACNuyB,IAAK,SACLkhB,IAAK,aAEPp2C,KAAK+6C,eAAiBT,GACpB33C,KAAM,cACNuyB,IAAK,aACLkhB,IAAK,WAEPp2C,KAAKg7C,WAAaV,GAChB33C,KAAM,UACNuyB,IAAK,SACLkhB,IAAK,UAGPp2C,KAAKi7C,UAAY,SAAUz/B,EAAQ8gB,EAAO7f,GACxC,GAAI5P,GAAU7M,KAAK6M,OAEnB,OADAA,GAAQlK,MAAO,EACRq3C,EAA0B9B,YAAY18B,EAAO0D,IAAKod,EAAM,GAAIA,EAAM,GAAI7f,EAAOk+B,UAAU12C,KAAK,SAAUtB,GAE3G,MADAkK,GAAQlK,MAAO,GAEb8F,EAAG,WACHpB,IAAK1E,MAKX3C,KAAKk7C,kBAAoB,SAAUv4C,GACjC,MAAO8B,GAAG,SAAUK,EAASuX,GAC3B5Z,EAAQopC,OAAO9R,GAAG2e,IAAI/1C,EAAK0E,IAAK,SAAUqG,EAAK/K,GACzC+K,EACF2O,EAAO3O,GACE/K,GACTmC,EAAQnC,OAGXsB,KAAK,SAAUtB,GAChB3C,KAAKqiC,OACH1/B,OACE2D,KAAM,UACNoe,KAAM,QACNy2B,QACExZ,MAAO,WAETl5B,EAAG9F,EAAKgD,IAAI,SAAU4X,GACpB,MAAO,IAAItV,OAAMsV,EAAE69B,UAAUjgB,aAE/B9rB,EAAG1M,EAAKgD,IAAI,SAAU4X,GACpB,OAAQA,EAAE89B,aAGd3P,QACE6H,OACEC,WAAY,QAEdG,OACEH,WAAY,UAalB3zC,QAAQiI,IAAI9H,KAAKqiC,QACjBx8B,KAAK7F,QAGTA,KAAKw6C,aAAe,WAClB,GAAIr+B,GAAI1X,EAAG2X,QACPE,EAAUH,EAAEG,OAChBH,GAAErX,SACF,IAAI0W,GAASxb,KAAKuyB,SAAS/W,OACvBq/B,EAAa76C,KAAKuyB,SAASsoB,WAC3Bp+B,EAASzc,KAAKuyB,SAAS9V,MAE3B,IAAIjB,GAAUq/B,GAAcp+B,EAAQ,CAClC,GAAI6f,GAAQue,EAAWve,QACnBse,EAAcn+B,EAAOm+B,WACzBt+B,GAAUH,EAAEG,QAAQrY,KAAK,WAOvB,MANIuX,GAAO7Y,OACL6Y,EAAO7Y,KAAK8Z,QAAUA,GAAYjB,EAAO7Y,KAAK25B,MAAM,GAAKse,GAAete,EAAM,IAAMA,EAAM,IAAM9gB,EAAO7Y,KAAK25B,MAAM,GAAKse,IACzHp/B,EAAO7Y,KAAO,OAIb6Y,EAAO7Y,KAUH6Y,EAAO7Y,KAAKA,KATZ3C,KAAKi7C,UAAUz/B,EAAQ8gB,EAAO7f,GAAQxY,KAAK,SAAUtB,GAM1D,MALA6Y,GAAO7Y,MACLA,KAAMA,EACN25B,MAAOA,EACP7f,OAAQA,GAEHjB,EAAO7Y,KAAKA,QAKvBkD,KAAK7F,OAAOiE,KAAK,SAAUq3C,GAC3Bz7C,QAAQiI,IAAI,gBAAiBwzC,GAEzBA,GACFt7C,KAAKk7C,kBAAkBI,IAEzBz1C,KAAK7F,OAGT,MAAOsc,IAGT7X,EAAG0J,OAAOlK,KAAKjE,KAAKw6C,aAAa30C,KAAK7F,UChQxCT,QAAQC,OAAO,uBAAwB,YAAa,eAAgB,WAAY,cAAe,qBAAsB,SAAU,cAe9HW,QAAQ,yBAAA,QAAyB,SAAU4D,GAC1C,OACE+K,QAAS,WACP,MAAO/K,GAAMC,IAAI,gBAAgBC,KAAK,SAAUiG,GAC9C,MAAOA,GAASvH,YCnBxBpD,QAAQC,OAAO,2BAA4B,YAAa,gBAAiB,eAAgB,WAAY,cAAe,qBAAsB,SAAU,YAAa,yBAA0B,wBAAwBqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAClPo1C,EAAeC,MAAM,kBACnB9vC,IAAK,SACL5H,WAAY,uCACZ+K,YAAa,kCAEd/K,WAAW,0BAAA,SAAA,SAAA,gBAAA,4BAA0B,SAAUoJ,EAAQlI,EAAQ46C,EAAeC,GAC/E,GAAIlF,GAASiF,EAAcE,aAC3Bz7C,MAAKs2C,OAASA,EAEdt2C,KAAK07C,cAAgB,WACnB,MAAO7yC,GAAO0B,MACZC,YAAa,sCACb1F,SACE62C,cAAA,2BAAc,SAAUC,GACtB,MAAOA,GAAyB9sC,YAElC+sC,WAAA,wBAAW,SAAUC,GACnB,MAAOA,GAAsBhtC,aAGjCrP,YAAA,eAAA,YAAY,SAAUk8C,EAAcE,GAClC77C,KAAK27C,aAAeA,EACpB37C,KAAK67C,UAAYA,EACjB77C,KAAK2C,MACHo5C,eAAYr6C,GACZs6C,gBAAat6C,GACbsiB,SAAU,EACV7f,WAAY,IACZ2f,WAAY,IACZm4B,6BAA6B,GAG/Bj8C,KAAKk8C,wBAA0B,WACzBl8C,KAAK2C,KAAKs5C,8BACZj8C,KAAK2C,KAAKmhB,WAAoC,IAAvB9jB,KAAK2C,KAAKwB,aAIrCnE,KAAKm8C,uBAAyB,WAC5Bn8C,KAAK2C,KAAKs5C,6BAA8B,KAG5CnxC,aAAc,UACblD,OAAO3D,KAAKu3C,EAA0BE,eAAez3C,KAAK,WAC3DqyC,EAAO9T,KAAKxiC,KAAM,QAASw7C,EAA0BY,cACrDv2C,KAAK7F,QAGTA,KAAKq8C,SAAW,SAAUz1B,GACxB,MAAO/d,GAAO0B,MACZC,YAAa,iCACb1F,SACE8hB,KAAM,WACJ,MAAOA,KAGXnnB,YAAA,OAAY,SAAUmnB,GACpB5mB,KAAK4mB,KAAOA,IAEd9b,aAAc,WAMlBwrC,EAAO9T,KAAKxiC,KAAM,QAASw7C,EAA0BY,gBACpDj8C,QAAQ,6BAAA,QAA6B,SAAU4D,GAChD,OACEq4C,UAAW,WACT,MAAOr4C,GAAMC,IAAI,yBAAyBC,KAAK,SAAUiG,GACvD,MAAOA,GAASvH,QAGpB+4C,cAAe,SAAU/4C,GAEvB,MADA9C,SAAQiI,IAAI,gBAAiBnF,GACtBoB,EAAMkF,KAAK,yBAChBU,KAAMhH,EAAKo5C,YAAcp5C,EAAKo5C,WAAWl1C,GACzCO,QAASzE,EAAKq5C,aAAer5C,EAAKq5C,YAAYn1C,GAC9C1C,WAAYxB,EAAKwB,WACjB6f,SAAUrhB,EAAKqhB,SACfF,WAAYnhB,EAAKmhB,aAChB7f,KAAK,SAAUtB,GAChB,MAAOA,GAAKuH,gBAIjB0D,QAAQ,iBAAA,KAAiB,SAAUnJ,GACpC,QAAS63C,KACPt8C,KAAK6M,WAoBP,MAjBAyvC,GAAOruC,WACLu0B,KAAM,SAAU+Z,EAAYl6C,EAAKia,GAE/B,MADAtc,MAAK6M,QAAQxK,IAAO,EACbia,EAAQrY,KAAK,SAAUoE,GAO5B,MANArI,MAAK6M,QAAQxK,IAAO,EAEhBk6C,IACFA,EAAWl6C,GAAOgG,GAGbA,GACPxC,KAAK7F,MAAO,SAAU0N,GAEtB,KADA1N,MAAK6M,QAAQxK,IAAO,EACdqL,GACN7H,KAAK7F,UAITy7C,YAAa,WACX,MAAO,IAAIa,QC/GjB/8C,QAAQC,OAAO,qBAAsB,YAAa,qBAAsB,yBAA0B,4BAA4BqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC7JA,EAAmBS,UAAU,cAC7B20C,EAAeC,MAAM,YACnB9vC,IAAK,YACLm1C,UAAU,EACVhyC,YAAa,kCCLjBjL,QAAQC,OAAO,0BAA2B,YAAa,eAAgB,WAAY,cAAe,qBAAsB,mCAAoC,SAAU,cAAcqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACnNo1C,EAAeC,MAAM,iBACnB9vC,IAAK,GACL5H,WAAY,sCACZ+K,YAAa,8BACZ2sC,MAAM,wBACP9vC,IAAK,QACLo1C,OACEC,QACElyC,YAAa,mCACb/K,WAAY,mDAIjBA,WAAW,yBAAA,SAAA,SAAA,2BAAyB,SAAUC,EAAQC,EAAQi8C,GAC/D57C,KAAK2zB,WAAa,WAChBioB,EAAyB9sC,UAAU7K,KAAK,SAAUtB,GAGhD,GAFA3C,KAAKkE,SAAWvB,EAEZhD,EAAOoB,OAAOsG,IAAK,CACrB,GAAIA,GAAM1H,EAAOoB,OAAOsG,GACxBrH,MAAKuyB,SAAWvyB,KAAKkE,SAASoZ,OAAO,SAAUC,EAAGnW,GAChD,MAAOA,GAAQC,KAAOA,EAAMD,EAAUmW,GACrC,QAEL1X,KAAK7F,QAGTA,KAAKgtB,OAAS,SAAU5lB,GACtB,MAAOzH,GAAOiC,GAAG,wBACfyF,IAAKD,EAAQC,OAIjBrH,KAAK28C,qBAAuB,SAAUv1C,GACpC,GAAIw1C,GAAgB58C,KAAKkE,SAASoZ,OAAO,SAAUC,EAAG5W,EAAGmuB,GACvD,MAAOnuB,GAAEwR,YAAc/Q,EAAQ+Q,WAAa/Q,EAAUmW,GACrD,KACHhe,SAAQwqB,MAAM6yB,EAAex1C,IAG/BpH,KAAK2zB,gBACJl0B,WAAW,+BAAA,SAAA,SAAA,KAAA,SAAA,2BAA+B,SAAUC,EAAQC,EAAQ8E,EAAI9D,EAAQi7C,GACjF57C,KAAK2zB,WAAa,WAChB9zB,QAAQiI,IAAI,SAAUnI,GACtBK,KAAK68C,YACHx1C,IAAK1H,EAAOoB,OAAOsG,OAIvBrH,KAAK68C,WAAa,SAAUC,GAC1B,MAAOr4C,GAAGrB,KAAKw4C,EAAyBmB,eAAeD,GAAclB,EAAyBoB,gBAAgBF,GAAclB,EAAyBqB,yBAAyBH,KAAe74C,KAAK,SAAUb,GAC1MpD,KAAKoH,QAAUhE,EAAI,GACnBpD,KAAKoH,QAAQY,WAAuC,EAA1BhI,KAAKoH,QAAQY,WACvChI,KAAKgc,MAAQ5Y,EAAI,GACjBpD,KAAKyH,SAAWrE,EAAI,IACpByC,KAAK7F,QAGTA,KAAK2lB,MAAQ,WACXhmB,EAAOiC,GAAG,kBAGZ5B,KAAKsN,KAAO,WACV,MAAOsuC,GAAyBsB,cAAcl9C,KAAKoH,SAASnD,KAAK,SAAUmD,GACzEpH,KAAKoH,QAAUA,EACfzG,EAAOmH,IAAI,WAAaV,EAAQpG,KAAO,mBACvC6E,KAAK7F,OAAOmK,MAAM,SAAUuD,GAC5B/M,EAAOb,MAAM4N,MAIjB1N,KAAKm9C,gBAAkB,WACrBn9C,KAAKoH,QAAQg2C,mBAAqBp9C,KAAKoH,QAAQi2C,aAGjDr9C,KAAK2zB,gBACJxzB,QAAQ,4BAAA,QAA4B,SAAU4D,GAC/C,OACE+K,QAAS,WACP,MAAO/K,GAAMC,IAAI,mBAAmBC,KAAK,SAAUiG,GACjD,MAAOA,GAASvH,QAGpBo6C,eAAgB,SAAU31C,GACxB,MAAOrD,GAAMC,IAAI,gBAAkBoD,EAAQC,IAAM,SAASpD,KAAK,SAAUiG,GACvE,GAAIvH,GAAOuH,EAASvH,IAEpB,OADAA,GAAKqF,aAAerF,EAAKqF,WAClBrF,KAGXq6C,gBAAiB,SAAU51C,GACzB,MAAOrD,GAAMC,IAAI,gBAAkBoD,EAAQC,IAAM,UAAUpD,KAAK,SAAUiG,GACxE,MAAOA,GAASvH,QAGpBs6C,yBAA0B,SAAU71C,GAClC,MAAOrD,GAAMC,IAAI,gBAAkBoD,EAAQC,IAAM,qBAAqBpD,KAAK,SAAUiG,GACnF,MAAOA,GAASvH,KAAK6E,SAGzB01C,cAAe,SAAU91C,GACvB,GAAI01C,IACF3kC,WAAY/Q,EAAQ+Q,WACpBnX,KAAMoG,EAAQpG,KACdqG,IAAKD,EAAQC,IACbjD,YAAagD,EAAQhD,YACrBk5C,gBAAiBl2C,EAAQk2C,gBACzBnU,WAAY/hC,EAAQ+hC,WACpBnhC,WAAYZ,EAAQY,WACpBu1C,aAAcn2C,EAAQm2C,aACtBC,cAAep2C,EAAQo2C,cACvBC,iBAAkBr2C,EAAQq2C,iBAC1BC,4BAA6Bt2C,EAAQs2C,0BACrCC,cAAev2C,EAAQu2C,YACvBC,2BAA4Bx2C,EAAQw2C,yBACpCP,cAAej2C,EAAQi2C,YACvBD,qBAAsBh2C,EAAQg2C,mBAC9Bt6C,kBAAmBsE,EAAQtE,gBAC3B6hB,MACET,KAAM9c,EAAQ8c,KACdN,QAASxc,EAAQyc,cACjBC,WAAY1c,EAAQ2c,iBACpBI,WAAY/c,EAAQgd,eACpBy5B,gBAAiBz2C,EAAQ6c,aAG7B,OAAOlgB,GAAMsK,IAAI,mBAAqBjH,EAAQ+Q,YAC5C/Q,QAAS01C,IACR74C,KAAK,SAAUiG,GAChB,MAAOA,GAASvH,YC1HxBpD,QAAQC,OAAO,0BAA2B,WAAY,uBAAwB,+BAA+B4nB,UAAU,cAAA,sBAAA,SAAc,SAAU8H,EAAqBd,GAClK,OACE/G,SAAU,IACV7c,YAAa,6CACb8c,SACA1e,SAAS,EACTnJ,WAAY,mCAEbmO,QAAQ,qBAAA,aAAqB,SAAUpN,GACxC,OACEs9C,QAAS,SAAUz2C,EAAK02C,GACtBv9C,EAAWi5B,WAAW,qBACpBpyB,IAAKA,EACL02C,KAAMA,SAIXt+C,WAAW,kBAAA,SAAA,UAAA,gBAAA,WAAA,KAAA,gBAAkB,SAAUC,EAAQmqB,EAASm0B,EAAe3yC,EAAU5G,EAAIF,GACtFqN,OAAOzJ,OAAOnI,MACZ2zB,WAAY,WACV3zB,KAAKi+C,aAAe,GAAID,GAAct+C,GACtCM,KAAKk+C,UAAW,EAChBl+C,KAAKm+C,wBAA0B,IAC/Bn+C,KAAK6M,SAAU,EACf7M,KAAKi+C,aAAaG,QAAQ75C,EAAcY,QAAQ,wBAA0B,GAC1EnF,KAAKq+C,iBACLr+C,KAAKq+C,cAAc5gC,KAAK/d,EAAOmB,IAAI,oBAAqBb,KAAKs+C,UAAUz4C,KAAK7F,QAC5EA,KAAKq+C,cAAc5gC,KAAK/d,EAAOmB,IAAI,WAAYb,KAAKu+C,UAAU14C,KAAK7F,SAErEs+C,UAAW,SAAU1mC,EAAOlG,GAC1B1R,KAAK89C,QAAQpsC,IAEf6sC,UAAW,YACRv+C,KAAKq+C,mBAAqB33C,QAAQ,SAAU6U,GAC3CA,OAGJijC,iBAAkB,WACZx+C,KAAKy+C,eACPpzC,EAASM,OAAO3L,KAAKy+C,eAGnBz+C,KAAKm+C,0BACPn+C,KAAKy+C,cAAgBpzC,EAAS,WAC5BrL,KAAKk+C,UAAW,GAChBr4C,KAAK7F,MAAOA,KAAKm+C,2BAGvBO,YAAa,SAAUC,GACrB,MAAO3+C,MAAKi+C,aAAaW,eAAeD,EAAU3+C,KAAKi+C,aAAaY,SAAS76B,WAE/Eo6B,QAAS,SAAUU,GAGjB,MAFA9+C,MAAKw+C,mBACLj6C,EAAce,QAAQ,sBAAuBw5C,GACtC9+C,KAAKi+C,aAAaG,QAAQU,IAEnCf,KAAM,WAEJ,MADA/9C,MAAKw+C,mBACEx+C,KAAKi+C,aAAaF,QAE3BgB,MAAO,WAEL,MADA/+C,MAAKw+C,mBACEx+C,KAAKi+C,aAAac,SAE3BC,KAAM,WAEJ,MADAh/C,MAAKw+C,mBACEx+C,KAAKi+C,aAAae,QAE3BC,eAAgB,WACdj/C,KAAKk+C,UAAYl+C,KAAKk+C,SAElBl+C,KAAKk+C,UACPl+C,KAAKw+C,oBAGTV,QAAS,SAAUpsC,GACjBA,EAAUA,KACV,MAAMrK,GAAMqK,EAAQrK,IACd02C,EAAOrsC,EAAQqsC,UAAyBr8C,KAAjBgQ,EAAQqsC,IAErC,OAAK12C,IAILrH,KAAK6M,SAAU,EACf7M,KAAKk+C,UAAW,EACTl+C,KAAKi+C,aAAazb,KAAKn7B,GAAKpD,KAAK,WAGtC,GAFAjE,KAAK6M,SAAU,EAEXkxC,EACF,MAAO/9C,MAAK+9C,QAEdl4C,KAAK7F,OAAOmK,MAAM,SAAUvK,GAC5BI,KAAK6M,SAAU,EACf7M,KAAKF,MAAQF,EACbC,QAAQC,MAAMF,IACdiG,KAAK7F,QAfEyE,EAAGK,aAkBhB9E,KAAK2zB,WAAW3zB,SC3GlBT,QAAQC,OAAO,kCAAmC4nB,UAAU,WAAY,WACtE,OACE83B,QAAS,IACT10C,YAAa,sCACbqgB,QAAS,UACTvD,OACE63B,OAAQ,IACRC,QAAS,IACT73B,SAAU,KAEZE,KAAM,SAAUH,EAAOzS,EAAS6S,EAAOqF,GACrCzF,EAAMqE,OAAS,SAAU/T,GACvB0P,EAAMjf,OAASif,EAAMjf,MACrB0kB,EAAYG,cAAc5F,EAAMjf,MAAOuP,GAASA,EAAMtR,OAGxDymB,EAAYI,QAAU,WACpB7F,EAAMjf,QAAU0kB,EAAYK,gBCjBpC7tB,QAAQC,OAAO,kCAAmC,WAAY,qCAAsC,+BAAgC,qBAAqBqC,QAAA,4BAAO,SAAUo0C,GACxKA,EAA0BU,OAAO,YAC/BtvC,IAAK,sCACLgvC,UAAW,KACXzY,QAAS,iBAAkB,SAAU17B,GACnClC,KAAKR,OAAOY,KAAK8B,EAAem9C,qBAGnCj4B,UAAU,yBAAA,UAAA,KAAA,WAAA,iBAAA,oBAAyB,SAAU3kB,EAASgC,EAAI4G,EAAUnJ,EAAgB20C,GACrF,OACExvB,SAAU,IACV7c,YAAa,kDACb8c,OACEg4B,WAAY,KACZC,QAAS,MAEX93B,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9B7S,EAAQyX,SAAS,uBAAuBnS,SAAStF,EAAQ,GAAGm1B,WAC5Dn1B,EAAQ,GAAGm1B,UAAY,GAEvB1iB,EAAMk4B,OAAS,WACb3I,EAAkBrU,KAAK,YAAYv+B,KAAK,SAAUw7C,GAChDA,EAAG32C,MAAM,SAAUoB,GACO,cAApBA,EAASE,QACXvK,QAAQiI,IAAIoC,GACZod,EAAMg4B,YACJ31C,KAAMO,KAECA,EAASE,SAEpBkd,MAAO,iCC9BnB/nB,QAAQC,OAAO,gCAAiC,WAAY,uBAAwB,qCAAsC,+BAAgC,qBAAqBqC,QAAA,4BAAO,SAAUo0C,GAC9LA,EAA0BU,OAAO,cAC/BtvC,IAAK,uCACLgvC,UAAW,OACXI,cAAe,WAEjBR,EAA0BU,OAAO,oBAC/B/T,OAAQ,aACR0T,QAAS,cAAe,SAAUU,GAChC,MAAOA,GAAYjyC,OAAO/E,KAAK4iC,OAAOpjC,OAAQ,OAAQ,WAExDo+B,QAAS,iBAAkB,SAAU17B,GACnC,GAAIw9C,GAAQ1/C,KAAKR,OAAOY,MACtBu/C,UAAWz9C,EAAe09C,oBAC1BC,aAAc,sBAEhB,OAAOH,GAAMz7C,KAAK,WAChBjE,KAAKR,OAAOkgD,MAAQA,GACpB75C,KAAK7F,SAETm2C,gBAAiB,WACf,MAAOn2C,MAAK4iC,QAAU5iC,KAAK4iC,OAAOpjC,QAAUQ,KAAK4iC,OAAOpjC,OAAOkgD,YAGlEt4B,UAAU,uBAAA,UAAA,KAAA,WAAA,0BAAA,iBAAA,oBAAuB,SAAU3kB,EAASgC,EAAI4G,EAAUkrC,EAAyBr0C,EAAgB20C,GAC5G,OACExvB,SAAU,IACV7c,YAAa,gDACb8c,OACEg4B,WAAY,KACZC,QAAS,MAEX93B,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9B7S,EAAQyX,SAAS,qBAAqBnS,SAAStF,EAAQ,GAAGm1B,WAC1Dn1B,EAAQ,GAAGm1B,UAAY,GAEvB1iB,EAAMk4B,OAAS,WACb3I,EAAkBrU,KAAK,oBAAoBv+B,KAAK,SAAUy7C,GACxDA,EAAMA,MAAMF,SAASv7C,KAAK,SAAU0F,GAClC2d,EAAMg4B,YACJ31C,KAAMA,KAEP,SAAU7J,GACXwnB,EAAMi4B,SACJz/C,MAAOA,cC5CrBP,QAAQC,OAAO,eAAgB,8BAA+B,yBAA0B,mCAAoC,kBAAmB,0BAA2B,oCAAqC,gDAAiD,8BAA+B,YAAa,sBAAuB,eAAeqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACjXA,EAAmBqM,KAAK,YAAa,4BAA6B,6BAClE+oC,EAAeC,MAAM,YACnB9vC,IAAK,YACLo1C,OACEqD,UACErgD,WAAY,kCACZ+K,YAAa,6BAGjBu1C,mBAAmB,EACnBC,QAAQ,OAETvgD,WAAW,qBAAA,SAAA,UAAA,eAAqB,SAAUC,EAAQ8C,EAAS9B,GAC5D8B,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,OCfrB9Y,QAAQC,OAAO,gBAAiB,YAAa,sBAAuB,2BAA4B,yBAA0B,qBAAsB,uBAAwB,uBAAwB,0BAA2B,6BAA8B,yBAA0B,yBAA0B,gDAAgDqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC5XA,EAAmBqM,KAAK,aAAc,oBACtC+oC,EAAeC,MAAM,aACnB9vC,IAAK,aACLo1C,OACEwD,WACExgD,WAAY,mCACZ+K,YAAa,8BAGjBu1C,mBAAmB,EACnBC,QAAQ,IACP7I,MAAM,mBACP9vC,IAAK,mBACL5H,WAAY,YACZ+K,YAAa,8BACZ2sC,MAAM,qBACP9vC,IAAK,WACL5H,WAAY,cACZ+K,YAAa,gCACZ2sC,MAAM,0BACP9vC,IAAK,0BACL5H,WAAY,iCACZ+K,YAAa,yCAEd/K,WAAW,sBAAA,SAAA,UAAA,eAAsB,SAAUC,EAAQ8C,EAAS9B,GAC7D8B,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,OC3BrB9Y,QAAQC,OAAO,sBAAuB,cAAe,gBAAiB,eAAgB,SAAU,WAAY,gBAAiB,mBAAmB4nB,UAAU,cAAe,SAAU,SAAUgH,GAC3L,OACEvD,QAAS,UACTxD,SAAU,IACVI,KAAM,SAAU/nB,EAAQmV,EAAS6S,GAC/B,GAAIw4B,GAAc9xB,EAAO1G,EAAM,YAE3B7P,EAAU,SAAUjY,GACtBF,EAAOmsB,OAAO,WACZq0B,EAAYxgD,GACV8M,OAAQ5M,EACRugD,MAAOvgD,EAAEurB,OAAOg1B,UAKtBtrC,GAAQ,GAAG8yB,iBAAiB,SAAU9vB,GAAS,QAGjDpY,WAAW,aAAA,SAAA,SAAA,gBAAA,UAAA,SAAA,SAAA,UAAA,UAAA,cAAA,KAAA,eAAA,qBAAA,oBAAa,SAAUC,EAAQC,EAAQygD,EAAe59C,EAASqG,EAAQlI,EAAQ0/C,EAAS59C,EAASi2B,EAAaj0B,EAAI/D,EAAc4/C,EAAoBC,GAkOjK,QAASC,GAAkBC,GACzB,GAAIC,GAAeD,EAAQ/3C,MAAM,WAC7B6vC,EAAUmI,EAAa,GAAGh4C,MAAM,IAEpC,MAAK6vC,EAAQj1C,SAAS,SAAYi1C,EAAQj1C,SAAS,QAAWi1C,EAAQj1C,SAAS,QAAWi1C,EAAQj1C,SAAS,QACzG,OAAO,CAKT,KAAK,GAFD0Y,MAEK2G,EAAI,EAAGA,EAAI+9B,EAAar9C,OAAQsf,IAAK,CAC5C,GAAIhgB,GAAO+9C,EAAa/9B,GAAGja,MAAM,IAEjC,IAAI/F,EAAKU,QAAUk1C,EAAQl1C,OAAQ,CAGjC,IAAK,GAFD0Y,MAEKw2B,EAAI,EAAGA,EAAIgG,EAAQl1C,OAAQkvC,IAAK,CACvC,GAAmB,QAAfgG,EAAQhG,KAAiB5vC,EAAK4vC,GAAK,IAAM5vC,EAAK4vC,IAAM,IACtD,MAAO5xC,GAAOmH,IAAI,iDAGpB,IAAmB,QAAfywC,EAAQhG,KAAiB5vC,EAAK4vC,GAAK,KAAO5vC,EAAK4vC,IAAM,KACvD,MAAO5xC,GAAOmH,IAAI,oDAGpBiU,GAAKw8B,EAAQhG,IAAM5vC,EAAK4vC,GAG1Bv2B,EAAMyB,KAAK1B,IAIf,MAAOC,GAGT,QAAS2kC,GAAY3kC,GACnB,MAAO4kC,SAAQx9C,IAAI4Y,EAAMrW,IAAI,SAAUoW,GACrC,MAAO,IAAI6kC,SAAQ,SAAU97C,EAASuX,GACpCgkC,EAAQjwC,OAAO2L,EAAM,SAAUpZ,GACzBA,EAAK7C,MACPuc,EAAO1Z,EAAK7C,OAEZgF,WA3QVpF,EAAOmN,SAAU,EACjBnN,EAAOmhD,WACPnhD,EAAOsJ,OAAS,GAChBtJ,EAAOohD,SAAU,EACjBphD,EAAOqhD,UAAW,EAClBv+C,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,GAEnB,IAAI1R,IACFoV,KAAMpc,EAAOoB,OAAOgb,KACpB9C,KAAMtZ,EAAOoB,OAAOkY,KAGlBtS,GAAEsS,OACJtS,EAAEq6C,UAAYr6C,EAAEsS,KAAKvQ,MAAM,KAC3B/B,EAAEsS,KAAOtS,EAAEq6C,UAAUzsB,SAGvB/xB,EAAQ+V,UACN/Q,OAAO,EACPy5C,MAAM,EACNC,YAAY,GACX,SAAUllC,GAIX,GAHAtc,EAAOyhD,kBAAkBnlC,GACzBtc,EAAOmN,SAAU,EAEblG,EAAEoV,KAAM,CACV,GAAIA,GAAOC,EAAM3b,OAAO,SAAUgV,GAChC,MAAOA,GAAExO,IAAMF,EAAEoV,OAChBwY,OAECxY,IAAQA,EAAKlV,IACfnH,EAAOw1B,IAAInZ,GAAM9X,KAAK,WAChB0C,EAAEsS,MACJvZ,EAAO0hD,SAASz6C,EAAEsS,KAAMtS,EAAEq6C,aAMlCV,EAAmBr8C,KAAK,SAAU4oC,GAChCntC,EAAOiG,IAAM,GAAIknC,GAAOwU,KAAKC,IAAI7+C,EAAQvB,SAASqgD,eAAe,YAC/DC,QACE16C,IAAK,EACL26C,IAAK,GAEPC,UAAW7U,EAAOwU,KAAKM,UAAUC,UACjC56C,KAAM,EACN66C,QAAS,IAEXniD,EAAOoiD,cAETpiD,EAAOqiD,UAAYt/C,EAAQvB,SAASqgD,eAAe,aACnD7hD,EAAOsiD,kBAAoBD,UAAUE,0BAGvCviD,EAAOoiD,UAAY,WACjB,KAAMI,GAAS,GAAIrV,QAAOwU,KAAKc,YAC/B5iD,SAAQmH,QAAQhH,EAAOsc,MAAO,SAAUD,GACtC,KAAIA,EAAKjV,IAAM,IAAMiV,EAAKjV,KAAO,IAAMiV,EAAKhV,IAAM,KAAOgV,EAAKhV,KAAO,KAArE,CAIA,GAAIo0C,EACJ,MAAMlc,GAAW,GAAI4N,QAAOwU,KAAKe,OAAOrmC,EAAKjV,IAAKiV,EAAKhV,IAGrDo0C,GADEz7C,EAAO6yB,UAAY7yB,EAAO6yB,SAAS1rB,KAAOkV,EAAKlV,GACxC,GAAIgmC,QAAOwU,KAAKgB,QACvBpjB,SAAUA,EACVp7B,MAAOkY,EAAK/a,KACZm7B,MACE90B,IAAK,qFAIA,GAAIwlC,QAAOwU,KAAKgB,QACvBpjB,SAAUA,EACVp7B,MAAOkY,EAAK/a,QAKXtB,EAAOohD,SAAWphD,EAAOqhD,WAAarhD,EAAO4iD,MAAQ5iD,EAAO4iD,KAAKz7C,KAAOkV,EAAKlV,KAChFs0C,EAAOoH,cAAa,GACpB7iD,EAAOiG,IAAI68C,MAAMvjB,GACjBv/B,EAAOiG,IAAI88C,QAAQ,GACnB5V,OAAOwU,KAAKzpC,MAAM8qC,YAAYvH,EAAQ,UAAW,SAAUlc,GACzDv/B,EAAOmsB,OAAO,WACZnsB,EAAO4iD,KAAKx7C,IAAMm4B,EAAS0jB,OAAO77C,MAClCpH,EAAO4iD,KAAKv7C,IAAMk4B,EAAS0jB,OAAOlB,WAKxCtG,EAAOuH,YAAY,QAAS,WAC1BhjD,EAAOw1B,IAAInZ,GACXrc,EAAOkjD,SAAS7mC,EAAKlV,MAEvBnH,EAAOmhD,QAAQpjC,KAAK09B,GACpB+G,EAAOl3C,OAAOi0B,MAEhBv/B,EAAOiG,IAAIm8C,UAAUI,GAEjBxiD,EAAOmhD,QAAQx9C,QACjB3D,EAAOmjD,YAAYnjD,EAAOiG,MAM9BjG,EAAOkjD,SAAW,SAAU/7C,GAC1B,KAAMi8C,GAAW,QAAUj8C,CAC3Bu5C,GAAc2C,QAAU,GACxBljD,QAAQiI,IAAIg7C,GACZ1C,EAAc0C,IAGhBpjD,EAAOsjD,SAAW,SAAUx2C,EAAQksB,GAClC14B,KAAKi4B,cAAgBS,EAAYT,cACjCj4B,KAAKijD,UAAYvqB,EAAYT,cAAcirB,QAC3CxjD,EAAOujD,UAAYjjD,KAAKijD,UACxBvjD,EAAOyjD,mBAAqBnjD,KAAKijD,UAAY,KAG/CvjD,EAAO0jD,gBAAkB,WAIvB,GAAI1jD,EAAOsiD,kBAAmB,CAC5B,KAAMqB,GAAY3jD,EAAOsiD,kBAAkBpoB,IAAMl6B,EAAOqiD,UAAUuB,WAClE,OAAOD,GAAY,EAJC,QAImBA,EAClC,MALe,SAQxB3jD,EAAO6jD,UAAY,SAAU/2C,EAAQksB,GACnC,MAAOh5B,GAAOuZ,KAAKtT,MAA0B,IAAnBjG,EAAOohD,UAAyC,IAApBphD,EAAOqhD,UAAsBrhD,EAAOsc,OAAStc,EAAOsc,MAAM3Y,OAAS,IAAM3D,EAAOujD,WACrIvjD,EAAO40B,gBAAkB,WAC1B50B,EAAOsc,MAAQtc,EAAO8jD,mBAAmB9jD,EAAO+jD,cAAe/jD,EAAOsJ,SAGxEtJ,EAAO8jD,mBAAqB,SAAU1f,EAAO4f,GAC3C,MAAI5f,KAAUA,EAAMzgC,UACbygC,EAAMzjC,OAAO,SAAU8G,GAE5B,MAAOA,GAAKnG,KAAKwwB,cAAcluB,SAASogD,EAAQlyB,iBAC/C+D,KAAK,SAAU3gB,EAAG6a,GAEnB,MAAI7a,GAAE5T,KAAKwwB,cAAcnG,QAAQq4B,EAAQlyB,eAAiB/B,EAAEzuB,KAAKwwB,cAAcnG,QAAQq4B,EAAQlyB,eACtF,EACE5c,EAAE5T,KAAKwwB,cAAcnG,QAAQq4B,EAAQlyB,eAAiB/B,EAAEzuB,KAAKwwB,cAAcnG,QAAQq4B,EAAQlyB,gBAC5F,EAEJ5c,EAAE5T,KAAOyuB,EAAEzuB,KAAa,GAAe,KAKjDtB,EAAOyhD,kBAAoB,SAAUnlC,GACnCtc,EAAOsc,MAAQA,EAAMuZ,KAAK,SAAU3gB,EAAG6a,GACrC,MAAO7a,GAAE+uC,WAAal0B,EAAEk0B,WAAa,GAAK,IAE5CjkD,EAAO+jD,cAAgB/jD,EAAOsc,OAIhCtc,EAAOmjD,YAAc,SAAUl9C,GAC7B,IAAK,GAAIgd,GAAI,EAAGA,EAAIjjB,EAAOmhD,QAAQx9C,OAAQsf,IACzCjjB,EAAOmhD,QAAQl+B,GAAGihC,OAAOj+C,IAK7BjG,EAAOmkD,aAAe,WACpBnkD,EAAOmjD,YAAY,OAIrBnjD,EAAOokD,YAAc,SAAUn+C,GAC7BjG,EAAOmjD,YAAYl9C,IAIrBjG,EAAOqkD,cAAgB,WACrBrkD,EAAOmkD,eACPnkD,EAAOmhD,YAGTnhD,EAAOohD,SAAU,EAEjBphD,EAAOskD,WAAa,WAClB,IAAKtjD,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,0CAIK+I,GAAO0B,MACzBC,YAAa,6BACb/K,WAAY,2BAEAmI,OAAO3D,KAAK,SAAUiG,GAElC,KAAM8R,GAAQwkC,EAAkBt2C,EAEhC,KAAK8R,EAEH,WADArb,GAAOb,MAAM,2BAKf6gD,GAAY3kC,GAAO/X,KAAK,WACtBtD,EAAOmH,IAAI,iBAEXtF,EAAQ+V,UACN/Q,OAAO,EACPy5C,MAAM,EACNC,YAAY,GACX,SAAUllC,GACXtc,EAAOyhD,kBAAkBnlC,OAE1B7R,MAAM,SAAUrK,GACjBa,EAAOb,MAAM,UAAYA,QAwD/BJ,EAAOimB,MAAQ,WACbjmB,EAAOqhD,UAAW,EAClBrhD,EAAOohD,SAAU,EAEbphD,EAAOy7C,QACTmF,EAAmBr8C,KAAK,SAAU4oC,GAChC,GAAI5N,GAAW,GAAI4N,GAAOwU,KAAKe,OAAO1iD,EAAO6yB,UAAY7yB,EAAO6yB,SAASzrB,IAAKpH,EAAO6yB,UAAY7yB,EAAO6yB,SAASxrB,IACjHrH,GAAOy7C,OAAOoH,cAAa,GAC3B7iD,EAAOy7C,OAAO8I,YAAYhlB,GAC1Bv/B,EAAOy7C,OAAO+I,SAASxkD,EAAO6yB,UAAY7yB,EAAO6yB,SAASvxB,SAKhEtB,EAAOykD,YAAc,WACnB,MAAIzjD,GAAa8C,UAAkB+8C,EAAkB/9C,EAAQ8W,qBAEzD5Y,EAAa0C,MAAQ1C,EAAa0C,IAAIC,SAAW3C,EAAa6C,IAAI,iBAC7D5C,EAAOb,MAAM,kDACfygD,GAAkB/9C,EAAQ8W,sBAGnC5Z,EAAO0kD,kBAAoB1rB,EAAY,+BACrCh5B,OAAUA,GAEZ,IAAI2kD,GAAkB3kD,EAAO0kD,kBAAkBtzB,GAAG,iBAAkB,SAAUwzB,GAC5E,GAAI5kD,EAAOuZ,KAAK7O,OAAQ,CACtB,GAAIm6C,IAAY5kD,EAAOoB,OAAOkY,KAAKvQ,MAAM,KAAKC,MAAM,EAAG,IAAI67C,OAAOF,GAAW70C,KAAK,IAClF5P,SAAQiI,IAAI,YAAaw8C,EAAWC,GACpC5kD,EAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD,MACjC+a,KAAMpc,EAAOoB,OAAOgb,KACpB9C,KAAMsrC,IAEN5jD,QAAQ,MAIdjB,GAAOmB,IAAI,WAAY,WACrBnB,EAAO0kD,kBAAkBpzB,IAAI,iBAAkBqzB,KAGjD3kD,EAAO4N,KAAO,WACZ,GAAI0X,GAAStlB,EAAOohD,QAAU,SAAW,QAEzC,IAAIphD,EAAO4iD,KAAKx7C,IAAM,IAAMpH,EAAO4iD,KAAKx7C,KAAO,GAE7C,WADAnG,GAAOmH,IAAI,iDAIb,IAAIpI,EAAO4iD,KAAKv7C,IAAM,KAAOrH,EAAO4iD,KAAKv7C,KAAO,IAE9C,WADApG,GAAOmH,IAAI,oDAIb,KAAIpI,EAAOilD,SAASC,SAApB,CACA,GAAIC,GAAUjzC,OAAOzJ,UAAWzI,EAAO4iD,KAEvC,IAAe,WAAXt9B,EAAqB,CACvB,KAAM8/B,IAAa,MAAO,aAE1B,KAAK,GAAIniC,GAAI,EAAGA,EAAImiC,EAAUzhD,OAAQsf,IAAK,CACzC,GAAItgB,GAAMyiD,EAAUniC,EAEhBjjB,GAAO4iD,KAAKjgD,KAAS3C,EAAO6yB,SAASlwB,UAChCwiD,GAAQxiD,GAInB,KAAM0iD,IAAiB,MAAO,MAE1BrlD,GAAO4iD,KAAKyC,EAAc,MAAQrlD,EAAO6yB,SAASwyB,EAAc,KAAOrlD,EAAO4iD,KAAKyC,EAAc,MAAQrlD,EAAO6yB,SAASwyB,EAAc,YAClIF,GAAQE,EAAc,UACtBF,GAAQE,EAAc,KAIjC1E,EAAQr7B,GAAmB,WAAXA,EAAsBtlB,EAAO4iD,KAAOuC,EAAS,SAAUliD,GACrE,GAAIA,EAAK7C,MAAO,MAAOa,GAAOb,MAAM6C,EAAK7C,MAE1B,YAAXklB,EACFtlB,EAAOqhD,UAAW,EAElBrhD,EAAOohD,SAAU,EAGnBt+C,EAAQ+V,UACN/Q,OAAO,EACPy5C,MAAM,EACNC,YAAY,GACX,SAAUllC,GACXtc,EAAOyhD,kBAAkBnlC,GACzBtc,EAAOw1B,IAAe,WAAXlQ,EAAsBtlB,EAAO4iD,KAAOuC,GAAS5gD,KAAK,WACvD0C,EAAEsS,MACJvZ,EAAO0hD,SAASz6C,EAAEsS,KAAMtS,EAAEq6C,aAI9BthD,EAAOqkD,gBACPrkD,EAAOoiD,aAET,IAAIj6C,GAAoB,UAAVmd,EAAqB,eAAiB,cACpDrkB,GAAOmH,IAAID,OAIfnI,EAAOslD,IAAM,WACX,MAAKtlD,GAAO6yB,SAKP7xB,EAAa6C,IAAI,mBAKFsF,GAAO0B,MACzBC,YAAa,gCACb/K,WAAY,WACVO,KAAK0K,UAAY,4DAA6DhL,EAAO6yB,SAASvxB,MAC9FhB,KAAK4K,MAAQ,SACb5K,KAAK6K,UAAY,UAEnBC,aAAc,UAEFlD,OAAO3D,KAAK,WACxBo8C,EAAQjyC,QAAQ1O,EAAO6yB,SAAS1rB,IAAK,SAAUlE,GAC7C,GAAIA,EAAK7C,MAAO,MAAOa,GAAOb,MAAM6C,EAAK7C,MACzC0C,GAAQ+V,UACN/Q,OAAO,EACPy5C,MAAM,EACNC,YAAY,GACX,SAAUllC,GACXtc,EAAOyhD,kBAAkBnlC,GAEzBtc,EAAOqkD,gBACPrkD,EAAOoiD,cAETnhD,EAAOmH,IAAI,wBA1BbnH,GAAOb,MAAM,kDALba,GAAOmH,IAAI,iCAoCfpI,EAAOulD,iBAAmB,WACxB,IAAKvkD,EAAa6C,IAAI,2BAEpB,WADA5C,GAAOb,MAAM,6CAIf,IAAImQ,MACAi1C,IAQJ,IAPAxlD,EAAOsc,MAAMtV,QAAQ,SAAUqV,EAAM9F,GACZ,IAAnB8F,EAAKopC,WAAoBl1C,EAAK3M,SAASyY,EAAK/a,QAC9CiP,EAAKwN,KAAK1B,EAAK/a,MACfkkD,EAAQznC,KAAK1B,EAAKlV,QAIjBoJ,EAAK5M,OAER,WADA1C,GAAOmH,IAAI,yCAIb,IAAImI,EAAK5M,OAAS,EAAG,CACnB,KAAM2J,GAAM,MAAQiD,EAAK5M,OAAS,GAAK,cACvC4M,GAAOA,EAAKtH,MAAM,EAAG,GACrBsH,EAAKwN,KAAKzQ,GAGQnE,EAAO0B,MACzBC,YAAa,gCACb/K,WAAY,WACVO,KAAK0K,UAAY,8DACjB1K,KAAKiQ,KAAOA,EACZjQ,KAAK4K,MAAQ,SACb5K,KAAK6K,UAAY,UAEnBC,aAAc,UAEFlD,OAAO3D,KAAK,WACxBo8C,EAAQjyC,OAAO82C,EAAS,SAAUviD,GAChC,GAAIA,EAAK7C,MAAO,MAAOa,GAAOb,MAAM6C,EAAK7C,MACzC0C,GAAQ+V,UACN/Q,OAAO,EACPy5C,MAAM,EACNC,YAAY,GACX,SAAUllC,GACXtc,EAAOyhD,kBAAkBnlC,GAEzBtc,EAAOqkD,gBACPrkD,EAAOoiD,cAETnhD,EAAOmH,IAAI,4BAKjBpI,EAAOuZ,MACLtT,KAAK,EACLyE,QAAQ,GAEV1K,EAAOuZ,KAAKtS,EAAEsS,MAAQ,QAAS,EAE/BvZ,EAAO0hD,SAAW,SAAUmD,EAAUvD,GACpC,GAAI7kC,GAAI1X,EAAG2X,QACPE,EAAUH,EAAEG,OAChBH,GAAErX,SACF,IAAIsgD,GAAmBb,CAavB,OAXgB,UAAZA,GAAwB7kD,EAAO6yB,UAAY7yB,EAAO6yB,SAAS8yB,UAC7DD,GAAoBb,GAAUC,OAAOxD,GAAWvxC,KAAK,KACrD6M,EAAUA,EAAQrY,KAAK,WACrB,MAAOvE,GAAO0kD,kBAAkBkB,SAAS5lD,EAAO6yB,SAAUyuB,MAG5D1kC,EAAUA,EAAQrY,KAAK,WACrBsgD,EAAW,QAIRjoC,EAAQrY,KAAK,WAClB,IAAK,GAAI0e,KAAKjjB,GAAOuZ,KACnBvZ,EAAOuZ,KAAK0J,IAAK,CAInB,OADAjjB,GAAOuZ,KAAKsrC,IAAY,EACjB5kD,EAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD,MACxC+a,KAAMpc,EAAOoB,OAAOgb,KACpB9C,KAAMmsC,IAENzkD,QAAQ,OAKdjB,EAAO0Q,OAAS,WACd,IAAK1P,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,0CAIfJ,GAAO4iD,QACP5iD,EAAO0hD,SAAS,OAChB1hD,EAAOqhD,UAAW,EAElBrhD,EAAOqkD,gBACPrkD,EAAOoiD,aAGTpiD,EAAOuhB,KAAO,WACZ,GAAKvhB,EAAO6yB,SAAZ,CAEA,IAAK7xB,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,2CAIfJ,GAAO0hD,SAAS,OAChB1hD,EAAO4iD,KAAO/iD,QAAQ8N,KAAK3N,EAAO6yB,UAClC7yB,EAAO4iD,KAAKiD,UAAsC,IAA1B7lD,EAAO4iD,KAAKiD,UACpC/iD,EAAQ0Y,gBAAgB,KAAM,SAAUvY,GACtCjD,EAAOwE,SAAWvB,EAAKgD,IAAI,SAAUyB,GACnC,OACE+Q,WAAY/Q,EAAQ+Q,WACpBnX,KAAMoG,EAAQpG,KACdqG,IAAKD,EAAQC,SAInB7E,EAAQE,QAAQ,SAAUC,GACxBjD,EAAO4iD,KAAKl7C,QAAUzE,IAExBjD,EAAOohD,SAAU,EAEjBphD,EAAOqkD,gBACPrkD,EAAOoiD,cAGTpiD,EAAO8yB,SAAW,SAAUgzB,GAC1B9lD,EAAO4iD,KAAKl7C,QAAUo+C,GAGxB9lD,EAAO+lD,oBAAqB,EAE5B/lD,EAAOgmD,aAAe,SAAU7+C,GAC9BnH,EAAOimD,OAAOj/C,QAAQ,SAAUg3B,GAC9BA,EAAMkoB,OAASloB,EAAM72B,KAAOA,IAE9BnH,EAAO+lD,oBAAqB,GAG9B/lD,EAAOmmD,sBAAwB,SAAUC,GACvC,MAAOA,GAAOC,OAAO,GAAG3jC,cAAgB0jC,EAAOn9C,MAAM,IAGvDjJ,EAAOw1B,IAAM,SAAUnZ,GACrB,MAAOpc,GAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD,MACxC+a,KAAMA,GAAQA,EAAKlV,GACnBoS,KAAMtZ,EAAOoB,OAAOkY,OAEpBtY,QAAQ,IACPsD,KAAK,WACNvE,EAAOimD,UACPjmD,EAAOimB,QACPjmB,EAAO6yB,SAAWxW,EAEdrc,EAAO6yB,UAAY7yB,EAAO6yB,SAASyzB,aACrC3F,EAAQtjC,gBAAgBrd,EAAO6yB,SAASyzB,aAAa/hD,KAAK,SAAUtB,GAGlE,GAFAjD,EAAOumD,OAAStjD,EAEZjD,EAAOumD,QAAUvmD,EAAO6yB,SAASyzB,YAAa,CAChDtmD,EAAOumD,OAASvmD,EAAOumD,OAAO5lD,OAAO,SAAU6lD,GAC7C,MAAsB,QAAfA,EAAMC,MAGf,KAAK,GAAIxjC,GAAI,EAAGA,EAAIjjB,EAAOumD,OAAO5iD,OAAQsf,IAAK,CAC7C,GAAIkb,GAAM,gBAAkBn+B,EAAO0H,QAAQC,IAAM,YAAc3H,EAAO6yB,SAASyzB,YAAc,WAAatmD,EAAOumD,OAAOtjC,GAAG9b,EAC3HnH,GAAOimD,OAAOloC,MACZ5W,GAAI8b,EACJkb,IAAKA,EACL+nB,OAAc,IAANjjC,EACR2pB,MAAO5sC,EAAOumD,OAAOtjC,IAAMjjB,EAAOumD,OAAOtjC,GAAGwjC,MAAQzmD,EAAOumD,OAAOtjC,GAAGwjC,KAAK7Z,MAAQ5sC,EAAOmmD,sBAAsBnmD,EAAOumD,OAAOtjC,GAAGwjC,KAAK7Z,OAAS,uBAMnJniC,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI,QAAS4F,KAKzBhO,EAAOqkD,gBACPrkD,EAAOoiD,YAEHpiD,EAAO6yB,UACT+tB,EAAmBr8C,KAAK,SAAU4oC,GAChC,GAAI5N,GAAW,GAAI4N,GAAOwU,KAAKe,OAAO1iD,EAAO6yB,SAASzrB,IAAKpH,EAAO6yB,SAASxrB,IAC3ErH,GAAOiG,IAAI68C,MAAMvjB,GACjBv/B,EAAOiG,IAAI88C,QAAQ,YAK1BhjD,WAAW,0BAAA,SAAA,iBAA0B,SAAUC,EAAQwjB,GACxDxjB,EAAOygD,SAEPzgD,EAAOmY,QAAU,SAAUjY,EAAGugD,GAC5B,GAAIiG,GAAS,GAAIC,WAEjBD,GAAOxoB,OAAS,SAAUh+B,GACxBsjB,EAAeyC,MAAMygC,EAAOx+C,SAG9Bw+C,EAAOE,WAAWnG,EAAM,KAG1BzgD,EAAOiM,OAAS,WACduX,EAAeiC,cAEhB1lB,WAAW,2BAAA,SAAA,UAAA,SAAA,SAA2B,SAAUC,EAAQ2gD,EAASx3C,EAAQlI,GAC1EjB,EAAOqc,KAAOrc,EAAO6yB,SACrB7yB,EAAOmN,UAEP,IAAI05C,GAAgB,SAAU1iD,EAAO+G,GAWnC,MAVoB/B,GAAO0B,MACzBC,YAAa,gCACb/K,WAAY,WACVO,KAAK6D,MAAQA,EACb7D,KAAK0K,UAAY,6DAA+DhL,EAAOqc,KAAK/a,KAAO,2CACnGhB,KAAK4K,MAAQA,EACb5K,KAAK6K,UAAY,MAEnBC,aAAc,WAKd07C,EAAW,WACbnG,EAAQrjC,cAActd,EAAOqc,MAAMtV,QAAQ,SAAU9D,GAEnD,GADAjD,EAAOmN,QAAQu1B,UAAW,EACtBz/B,EAAK7C,MAAO,MAAOa,GAAOb,MAAM6C,EAAK7C,MACzCJ,GAAOqc,KAAK0qC,iBAAmB,GAAIx+C,MAAoB,IAAftF,EAAK+jD,SAC7ChnD,EAAOgkC,OAAS/gC,EAAKgkD,YACrBjnD,EAAOmK,OACLvD,KAAM3D,EAAK2D,KACXtF,KAAM2B,EAAK3B,KACX0lD,QAAS/jD,EAAK+jD,QACdE,QAASjkD,EAAKikD,QACd/8C,MAAOlH,EAAKkH,OAEdlJ,EAAOmH,IAAI,+BACVhI,MAAM,SAAU6C,GACjBjD,EAAOmN,QAAQu1B,UAAW,EAC1BzhC,EAAOgN,gBAIXjO,GAAOsd,cAAgB,WAGrB,GAFAtd,EAAOmN,QAAQu1B,UAAW,EAEtB1iC,EAAOqc,KAAK0qC,iBAAkB,CACZF,EAAc,6CAA8C,wCAClE3+C,OAAO3D,KAAK,WACxBuiD,KACC,WACD9mD,EAAOmN,QAAQu1B,UAAW,QAG5BokB,MAIJ9mD,EAAOud,YAAc,WACCspC,EAAc,gCAAiC,qBACrD3+C,OAAO3D,KAAK,WACxBvE,EAAOmN,QAAQo4B,QAAS,EACxBob,EAAQpjC,YAAYvd,EAAOqc,MAAMtV,QAAQ,SAAU9D,GACjDjD,EAAOmN,QAAQo4B,QAAS,EACxBvlC,EAAOqc,KAAK0qC,iBAAmB,KAC/B/mD,EAAOmK,MAAQ,KACflJ,EAAOmH,IAAI,yBACVhI,MAAM,SAAU6C,GACjBjD,EAAOmN,QAAQu1B,UAAW,EAC1BzhC,EAAOgN,sBAIZlO,WAAW,+BAAA,SAAA,KAAA,UAAA,YAAA,iBAA+B,SAAUC,EAAQ+E,EAAI47C,EAASlb,EAAW5U,GACrF,QAAS0pB,GAAiBz9B,EAAM09B,GAC9B,MAAO,YACL,GAAIC,GAAiB,OAAR39B,EAAgB,GAAIvU,MAAS,GAAIA,MAAKuU,GAC/C49B,EAAO,GAAInyC,MAAKkyC,EAAOjyC,UAAYgyC,EAEvC,IAAIA,EAAQ,EAAG,CACb,GAAInkC,GAAIokC,CACRA,GAASC,EACTA,EAAOrkC,EAGT,OAAQokC,EAAQC,IAIpB,QAASC,GAAWjK,EAAKlxB,GACvB,MAAOkxB,GAAI/vC,OAAO,SAAUoI,GAC1B,MAAOA,GAAEyW,KAAOA,IACfqV,QAGL,QAAS+lB,GAAY5oC,GACnB,GAAIoD,GAAOpD,EAAQ/O,KACf43C,EAAU7oC,EAAQwjB,KAAOpgB,EACzBshC,EAAM1kC,EAAQ0kC,GAClB,OAAO,UAAa/tC,EAAOw+C,GAezB,MAdoB,gBAATx+C,KACTA,EAAQgyC,EAAWr6C,KAAK2C,KAAKmS,GAAOzM,IAGjCA,IACHA,EAAQgyC,EAAWr6C,KAAK2C,KAAKmS,GAAOshC,IAGtCp2C,KAAKuyB,SAASgoB,GAAWlyC,EAErBA,EAAMuT,OACRvT,EAAMuT,MAAM5b,MAGP6mD,EAAkBpiD,EAAGK,UAAY9E,KAAKw6C,gBAIjD,GAAI/pB,GAAS,GAAIF,EACjBvwB,MAAK8wB,GAAKL,EAAOK,GAAGjrB,KAAK4qB,GACzBzwB,KAAKgxB,IAAMP,EAAOO,IAAInrB,KAAK4qB,GAE3BzwB,KAAK8mD,UAAY,SAAU3/C,GACzB,MAAOA,GAAK4/C,OAGd/mD,KAAK2C,MACH6Y,SACE0D,IAAK,SACL6nC,MAAO,OACP/lD,KAAM,iBACNm7B,KAAM,mBACNuE,MACErxB,GACE23C,MACEtlB,QAAS,EAAG,EAAG,EAAG,GAClBl5B,OAAQ,SAAUC,GAChB,OAAQ,UAAW,WAAY,eAAgB,QAAY,EAAJA,SAM/DyW,IAAK,UACL6nC,MAAO,OACP/lD,KAAM,UACNm7B,KAAM,qBAENjd,IAAK,QACL6nC,MAAO,OACP/lD,KAAM,QACNm7B,KAAM,6BAENjd,IAAK,UACL6nC,MAAO,OACP/lD,KAAM,UACNm7B,KAAM,uBAENjd,IAAK,aACL6nC,MAAO,OACP/lD,KAAM,aACNm7B,KAAM,0BAERse,cACEv7B,IAAK,SACLoB,KAAM,YACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,QAE/B/6B,IAAK,SACLoB,KAAM,eACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,SACLoB,KAAM,eACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,UACLoB,KAAM,gBACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,UACLoB,KAAM,gBACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,SAE/B/6B,IAAK,SACLoB,KAAM,cACNymC,MAAO,OACPzqB,MAAO2d,EAAiB,OAAO,UAE/B/6B,IAAK,SACLoB,KAAM,YACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,UAE/B/6B,IAAK,UACLoB,KAAM,eACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,WAE/B/6B,IAAK,UACLoB,KAAM,aACNymC,MAAO,QACPzqB,MAAO2d,EAAiB,OAAO,WAEjCS,UACEx7B,IAAK,WACLoB,KAAM,WACNymC,MAAO,UACPpM,SAAU,QACVC,YAAa,MAEb17B,IAAK,YACLoB,KAAM,YACNymC,MAAO,UACPpM,SAAU,SACVC,YAAa,MAEb17B,IAAK,aACLoB,KAAM,aACNymC,MAAO,UACPpM,SAAU,UACVC,YAAa,MAEb17B,IAAK,aACLoB,KAAM,aACNymC,MAAO,UACPpM,SAAU,UACVC,YAAa,OAEb17B,IAAK,SACLoB,KAAM,SACNymC,MAAO,QACPpM,SAAU,SACVC,YAAa,OAEb17B,IAAK,UACLoB,KAAM,UACNymC,MAAO,QACPpM,SAAU,UACVC,YAAa,QAEb17B,IAAK,UACLoB,KAAM,UACNymC,MAAO,QACPpM,SAAU,UACVC,YAAa,QAEb17B,IAAK,QACLoB,KAAM,QACNymC,MAAO,OACPpM,SAAU,QACVC,YAAa,SAKjB56C,KAAK6M,WACL7M,KAAKuyB,UACH/W,OAAQ6+B,EAAWr6C,KAAK2C,KAAK6Y,OAAQ,SACrCq/B,WAAYR,EAAWr6C,KAAK2C,KAAK83C,YAAa,UAC9Ch+B,OAAQ49B,EAAWr6C,KAAK2C,KAAK+3C,QAAS,WAExC16C,KAAK86C,WAAaR,GAChB33C,KAAM,SACNuyB,IAAK,SACLkhB,IAAK,UAEPp2C,KAAK+6C,eAAiBT,GACpB33C,KAAM,cACNuyB,IAAK,aACLkhB,IAAK,WAEPp2C,KAAKg7C,WAAaV,GAChB33C,KAAM,UACNuyB,IAAK,SACLkhB,IAAK,WAGPp2C,KAAKslD,SAAW,SAAU2B,EAAeC,GAiBvC,MAhBAlnD,MAAKuyB,SAASxW,KAAOkrC,EAEjBC,IACEA,EAAS7jD,QACXrD,KAAK86C,WAAWoM,EAAS3yB,SAGvB2yB,EAAS7jD,QACXrD,KAAK+6C,eAAemM,EAAS3yB,SAG3B2yB,EAAS7jD,QACXrD,KAAKg7C,WAAWkM,EAAS3yB,UAItBv0B,KAAKw6C,gBAGdx6C,KAAKi7C,UAAY,SAAUl/B,EAAMP,EAAQ8gB,EAAO7f,GAC9C,GAAI5P,GAAU7M,KAAK6M,OAEnB,OADAA,GAAQlK,MAAO,EACR09C,EAAQ1jC,eAAeZ,EAAKlV,GAAI2U,EAAO0D,IAAKod,EAAM,GAAIA,EAAM,GAAI7f,EAAOk+B,UAAU12C,KAAK,SAAUtB,GASrG,MARAkK,GAAQlK,MAAO,EACfA,EAAK8F,EAAI,WACT9F,EAAK+9B,KAAOllB,EAAOklB,KACnB/9B,EAAKgqB,OACH2f,OACEhsB,KAAM,qBAGH3d,KAIX3C,KAAKk7C,kBAAoB,SAAUv4C,GACjC,GAAIs/B,IACFx5B,GACEu+C,MACEx+C,OAAQ,SAAUC,GAChB,MAAOsa,QAAO,GAAI9a,MAAKQ,IAAIwnC,MAAMznC,OAAO,uBAM5C7F,GAAK+9B,OACPnhC,QAAQwqB,MAAMkY,EAAMt/B,EAAK+9B,YAClB/9B,GAAK+9B,MAGd1gC,KAAKqiC,OACH1/B,KAAMA,EACNs/B,KAAMA,IAIVjiC,KAAKw6C,aAAerV,EAAU,WAC5B,GAAIhpB,GAAI1X,EAAG2X,QACPE,EAAUH,EAAEG,OAChBH,GAAErX,SACF,IAAIiX,GAAO/b,KAAKuyB,SAASxW,KACrBP,EAASxb,KAAKuyB,SAAS/W,OACvBq/B,EAAa76C,KAAKuyB,SAASsoB,WAC3Bp+B,EAASzc,KAAKuyB,SAAS9V,MAE3B,IAAIV,GAAQP,GAAUq/B,GAAcp+B,EAAQ,CAC1C,GAAI6f,GAAQue,EAAWve,QACnBse,EAAcn+B,EAAOm+B,WACzBt+B,GAAUH,EAAEG,QAAQrY,KAAK,WAOvB,MANIuX,GAAO7Y,OACL6Y,EAAO7Y,KAAKoZ,MAAQA,GAAQP,EAAO7Y,KAAK8Z,QAAUA,GAAYjB,EAAO7Y,KAAK25B,MAAM,GAAKse,GAAete,EAAM,IAAMA,EAAM,IAAM9gB,EAAO7Y,KAAK25B,MAAM,GAAKse,IACrJp/B,EAAO7Y,KAAO,OAIb6Y,EAAO7Y,KAWH6Y,EAAO7Y,KAAKA,KAVZ3C,KAAKi7C,UAAUl/B,EAAMP,EAAQ8gB,EAAO7f,GAAQxY,KAAK,SAAUtB,GAOhE,MANA6Y,GAAO7Y,MACLA,KAAMA,EACNoZ,KAAMA,EACNugB,MAAOA,EACP7f,OAAQA,GAEHjB,EAAO7Y,KAAKA,QAKvBkD,KAAK7F,OAAOiE,KAAK,SAAUq3C,GAC3Bz7C,QAAQiI,IAAI,gBAAiBwzC,GAEzBA,GACFt7C,KAAKk7C,kBAAkBI,IAEzBz1C,KAAK7F,OAAOiE,KAAK,WACjBwsB,EAAOG,KAAK,kBAAmBpV,EAAO0D,IAAK27B,EAAW37B,IAAKzC,EAAOyC,QAItE,MAAO5C,IACN,OC7gCL/c,QAAQC,OAAO,+CAAgD,cAAe,gBAAiB,eAAgB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACzJo1C,EAAeC,MAAM,iCACnB9vC,IAAK,iCACL5H,WAAY,uDACZ+K,YAAa,0DAEd/K,WAAW,0CAAA,SAAA,SAAA,UAAA,iCAAA,eAA0C,SAAUoJ,EAAQlI,EAAQ6B,EAAS2kD,EAAgCzmD,GACzHV,KAAK2zB,WAAa,WAChB3zB,KAAK6M,SAAU,EACf7M,KAAKonD,YACLpnD,KAAKqnD,iBAAmB3mD,EAAa6C,IAAI,0BACzC4jD,EAA+BjqC,cAC7BC,MAAO,EACPE,aAAa,EACbD,cAAe,IACdnZ,KAAK,SAAUqjD,GAChBtnD,KAAKsnD,QAAUA,EACftnD,KAAK6M,SAAU,GACfhH,KAAK7F,QAGTA,KAAKunD,YAAc,SAAUC,GAC3B,GAAIxd,GAAYhqC,KAAKonD,SAASI,EAAUhqC,OAGxC,UAFOxd,MAAKonD,SAASI,EAAUhqC,QAE3BwsB,EAAW,CACb,IAAKtpC,EAAa6C,IAAI,0BAEpB,WADA5C,GAAOb,MAAM,mEAIfqnD,GAA+BhtC,SAAS6vB,EAAWwd,EAAUhqC,QAAQvZ,KAAK,SAAUmjD,GAClFI,EAAUv3C,KAAKwN,KAAK2pC,IACpBvhD,KAAK7F,OAAOmK,MAAM,SAAUuD,GAC5B/M,EAAOb,MAAM4N,EAAI/K,MAAQ+K,EAAI7F,aAKnC7H,KAAK0d,YAAc,SAAU+pC,GAC3B,IAAIA,EAAQrqC,cAIZ,MAAK1c,GAAa6C,IAAI,8BAKtB4jD,GAA+BzpC,YAAY+pC,EAAQ5gD,IAAI5C,KAAK,WAC1DjE,KAAKsnD,QAAQ5gD,QAAQ,SAAUghD,GAC7B,GAAIzxC,GAAQyxC,EAAWz3C,KAAKob,QAAQo8B,EAEhCxxC,IAAS,GACXyxC,EAAWz3C,KAAKge,OAAOhY,EAAO,MAGlCpQ,KAAK7F,OAAOmK,MAAM,SAAUuD;gCAC5B/M,EAAOb,MAAM4N,EAAI/K,MAAQ+K,EAAI7F,eAb7BlH,GAAOb,MAAM,wEAiBjBE,KAAKqB,IAAM,WACT,IAAKX,EAAa6C,IAAI,0BAEpB,WADA5C,GAAOb,MAAM,4CAIK+I,GAAO0B,MACzBC,YAAa,qCACb/K,WAAY,+CACZipC,KAAM,OAEM9gC,OAAO3D,KAAK,SAAUsuB,GAClC,GAAI3b,IACFtS,QAASiuB,EAASjuB,QAAQqjD,gBAC1B9V,SAAUtf,EAAS7S,KAAK1e,KAE1BwB,GAAQ2X,SAASvD,GAAKnQ,QAAQ,SAAUmB,GACtCjH,EAAOmH,IAAIyqB,EAASjuB,QAAQqjD,gBAAkB,IAAMp1B,EAAS7S,KAAK1e,KAAO,qBACzEwB,EAAQgW,WAAW,SAAU8uC,GAC3BtnD,KAAKsnD,QAAUA,MAEhBxnD,MAAM,SAAU6C,EAAMyH,GACnBA,EAAS,IAAKzJ,EAAOb,MAAM6C,EAAK7C,OAAYa,EAAOgN,mBAK7D3N,KAAKglD,IAAM,WACT,GAAKhlD,KAAK0yB,SAAY1yB,KAAK0yB,QAAQrvB,OAAnC,CAEA,IAAK3C,EAAa6C,IAAI,0BAEpB,WADA5C,GAAOb,MAAM,+CAIf,IAAI8nD,GAAiB5nD,KAAK0yB,QAAQ/sB,IAAI,SAAU+tB,GAC9C,MAAO,IAAMA,EAAIta,aAAe,MAAQsa,EAAIm0B,cAAgB,MAE1DhgD,GAAW,2DACXigD,GAAY,gBAChB9nD,MAAK66B,OACHnwB,SAAU7C,EAAQ28C,OAAOoD,EAAgBE,GACzCl9C,MAAO,cACPC,UAAW,KAEOhC,GAAO0B,MACzBC,YAAa,gCACb8c,MAAOtnB,OAEK4H,OAAO3D,KAAK,WACxB,GAAI8jD,GAAa/nD,KAAK0yB,QAAQ/sB,IAAI,SAAU+tB,GAC1C,MAAOA,GAAI7sB,KAET9F,GACFinD,gBAAiBD,EAEnBvlD,GAAQ6X,cAActZ,GAAQ0F,QAAQ,SAAUmB,GAC9CpF,EAAQgW,WAAW,SAAU8uC,GAC3BtnD,KAAKsnD,QAAUA,MAEhBxnD,MAAM,SAAU6C,EAAMyH,GACnBA,EAAS,IAAKzJ,EAAOb,MAAM6C,EAAK7C,OAAYa,EAAOgN,oBAK7D3N,KAAK2zB,gBChIPp0B,QAAQC,OAAO,wBAAyB,cAAe,gBAAiB,eAAgB,WAAWC,WAAW,eAAA,SAAA,UAAA,SAAA,SAAA,eAAe,SAAUC,EAAQ8C,EAASqG,EAAQlI,EAAQD,GACtKhB,EAAOmN,SAAU,EACjBnN,EAAO6yB,YACP/vB,EAAQgW,WAAW,SAAU8uC,GAC3B5nD,EAAO4nD,QAAUA,EACjB5nD,EAAOmN,SAAU,IAEnBrK,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,IAGnB3Y,EAAO2B,IAAM,WACX,IAAKX,EAAa6C,IAAI,0BAEpB,WADA5C,GAAOb,MAAM,4CAIK+I,GAAO0B,MACzBC,YAAa,qCACb/K,WAAY,oBACZipC,KAAM,OAEM9gC,OAAO3D,KAAK,SAAUsuB,GAClC,GAAI3b,IACFtS,QAASiuB,EAASjuB,QAAQqjD,gBAC1B9V,SAAUtf,EAAS7S,KAAK1e,KAE1BwB,GAAQ2X,SAASvD,GAAKnQ,QAAQ,SAAUmB,GACtCjH,EAAOmH,IAAIyqB,EAASjuB,QAAQqjD,gBAAkB,IAAMp1B,EAAS7S,KAAK1e,KAAO,qBACzEwB,EAAQgW,WAAW,SAAU8uC,GAC3B5nD,EAAO4nD,QAAUA,MAElBxnD,MAAM,SAAU6C,EAAMyH,GACnBA,EAAS,IAAKzJ,EAAOb,MAAM6C,EAAK7C,OAAYa,EAAOgN,mBAK7DjO,EAAOslD,IAAM,WACX,GAAKtlD,EAAOgzB,SAAYhzB,EAAOgzB,QAAQrvB,OAAvC,CAEA,IAAK3C,EAAa6C,IAAI,0BAEpB,WADA5C,GAAOb,MAAM,+CAIf,IAAI8nD,GAAiBloD,EAAOgzB,QAAQ/sB,IAAI,SAAU+tB,GAChD,MAAO,IAAMA,EAAIta,aAAe,MAAQsa,EAAIm0B,cAAgB,MAE1DhgD,GAAW,uFACXigD,GAAY,kFAChBpoD,GAAOm7B,OACLnwB,SAAU7C,EAAQ28C,OAAOsD,EAAUF,GACnCh9C,MAAO,cACPC,UAAW,KAEOhC,GAAO0B,MACzBC,YAAa,gCACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,WACxB,GAAI8jD,GAAaroD,EAAOgzB,QAAQ/sB,IAAI,SAAU+tB,GAC5C,MAAOA,GAAI7sB,KAET9F,GACFinD,gBAAiBD,EAEnBvlD,GAAQ6X,cAActZ,GAAQ0F,QAAQ,SAAUmB,GAC9CpF,EAAQgW,WAAW,SAAU8uC,GAC3B5nD,EAAO4nD,QAAUA,MAElBxnD,MAAM,SAAU6C,EAAMyH,GACnBA,EAAS,IAAKzJ,EAAOb,MAAM6C,EAAK7C,OAAYa,EAAOgN,uBAI5DlO,WAAW,qBAAA,SAAA,UAAA,YAAqB,SAAUC,EAAQ+xC,EAASG,GAC5D,GAAIiB,EACJjB,GAAU5tC,IAAI,SAAUwb,GACtB9f,EAAOuoD,UAAYzoC,IAGrB9f,EAAOwoD,cAAgB,WACrB,GAAsB,KAAlBxoD,EAAOsJ,OAET,YADAtJ,EAAO4E,WAIT6jD,cAAatV,GACbA,EAAU79B,WAAW,WACnBy8B,EAAQzoC,OAAOtJ,EAAOsJ,OAAQ,SAAUo/C,GACtC1oD,EAAO4E,QAAU8jD,KAElB,SC7FP7oD,QAAQC,OAAO,8BAA+B,cAAe,gBAAiB,eAAgB,qCAAsC,WAAWoO,QAAQ,uBAAwB,WAC7K,GAAIy6C,GAASC,EAAUC,EAASC,EAAYC,EAAWC,EAAYC,CACnE,QACEC,WAAY,SAAUz4C,GACpBA,GACE04C,GAAIR,EACJS,GAAIR,EACJS,GAAIR,EACJS,IAAKR,EACLS,GAAIR,EACJS,GAAIR,EACJS,GAAIR,KAGRS,WAAY,SAAUxmC,GACpBylC,EAAUzlC,GAEZymC,YAAa,SAAUzmC,GACrB0lC,EAAW1lC,GAEb0mC,WAAY,SAAU1mC,GACpB2lC,EAAU3lC,GAEZ2mC,cAAe,SAAU3mC,GACvB4lC,EAAa5lC,GAEf4mC,aAAc,SAAU5mC,GACtB6lC,EAAY7lC,GAEd6mC,eAAgB,SAAUC,EAAOC,GAC/BjB,EAAagB,EACbf,EAAegB,MAGlBlqD,WAAW,oBAAA,SAAA,iBAAA,UAAA,KAAA,SAAA,uBAAA,eAAA,SAAoB,SAAUE,EAAQm+B,EAAgBt7B,EAASiC,EAAIoE,EAAQ+gD,EAAsBlpD,EAAcC,GAC3H,GAAIgG,IACF6tC,IAAK70C,EAAOoB,OAAOyzC,IACnBv7B,KAAMtZ,EAAOoB,OAAOkY,KAEtBjZ,MAAKuyB,UACHs3B,UAAW,EACXr1C,IAAK,KACLxR,KAAM,GAERhD,KAAKmvB,OACHnd,KAAM,EACN83C,MAAO,GAET9pD,KAAK6M,SACHoD,MAAM,EACN85C,SAAS,GAEX/pD,KAAKgS,QACLhS,KAAKsE,QAAU,GACftE,KAAK6xC,SAAW,GAChB7xC,KAAKgqD,aAAyB,WAAVrjD,EAAEsS,KACtBjZ,KAAKiqD,eACLjqD,KAAKkqD,YAAc,IACnBlqD,KAAKgqD,cAAe,EACpBhqD,KAAKmqD,eAAgB,EAErBnqD,KAAKoqD,oBAAsB,SAAU51C,GACnC,MAAOA,GAAM,YAAcxU,KAAKqqD,WAAa,qBAAuB71C,EAAI4C,UAAY,IAGtFpX,KAAKsqD,OAAS,SAAUT,GAUtB,MATI7pD,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASs3B,UAAY,EAC1B7pD,KAAKuyB,SAAS/d,IAAM,OAEpBxU,KAAKuyB,SAASs3B,UAAYjpD,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAgB,EAAZwsB,EAAe7pD,KAAKmvB,MAAMnd,KAAO,IAChFhS,KAAKuyB,SAAS/d,IAAMxU,KAAKgS,KAAKhS,KAAKuyB,SAASs3B,YAG9CD,EAAqBN,WAAWtpD,KAAKuyB,SAAS/d,KACvCxU,KAAKuyB,SAAS/d,KAGvBxU,KAAKuqD,QAAU,SAAUvnD,GAUvB,MATIhD,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASvvB,KAAO,EACrBhD,KAAKuyB,SAAS03B,iBAEdjqD,KAAKuyB,SAASvvB,KAAOpC,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAIr6B,EAAMhD,KAAKmvB,MAAMnd,KAAOhS,KAAKkqD,YAAc,IACrFlqD,KAAKiqD,YAAcjqD,KAAKgS,KAAKrJ,MAAM3I,KAAKuyB,SAASvvB,KAAOhD,KAAKkqD,aAAclqD,KAAKuyB,SAASvvB,KAAO,GAAKhD,KAAKkqD,cAG5GN,EAAqBP,YAAYrpD,KAAKuyB,SAASvvB,MACxChD,KAAKiqD,aAGdjqD,KAAKwqD,UAAY,SAAUx4C,GACzBhS,KAAKgS,KAAOA,EACZ43C,EAAqBL,cAAcvpD,KAAKgS,OAG1ChS,KAAKyqD,QAAU,SAAUjoC,GACvB,MAAOxiB,MAAKsqD,OAAOtqD,KAAKuyB,SAASs3B,WAAarnC,GAAQ,KAGxDxiB,KAAK0qD,QAAU,SAAUloC,GACvB,MAAOxiB,MAAKsqD,OAAOtqD,KAAKuyB,SAASs3B,WAAarnC,GAAQ,KAGxDxiB,KAAK2qD,SAAW,SAAUnoC,GACxB,MAAOxiB,MAAKuqD,QAAQvqD,KAAKuyB,SAASvvB,MAAQwf,GAAQ,KAGpDxiB,KAAK4qD,SAAW,SAAUpoC,GACxB,MAAOxiB,MAAKuqD,QAAQvqD,KAAKuyB,SAASvvB,MAAQwf,GAAQ,KAGpDxiB,KAAKg8B,KAAO,SAAUxZ,GACfA,IACHA,EAAO,GAGLxiB,KAAKgqD,aACPhqD,KAAKyqD,QAAQjoC,GAEbxiB,KAAK2qD,SAASnoC,IAIlBxiB,KAAK+7B,KAAO,SAAUvZ,GAKpB,MAJKA,KACHA,EAAO,GAGFxiB,KAAKg8B,MAAMxZ,IAGpBxiB,KAAK0hB,UAAY,SAAUC,GACzB,IAAKjhB,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,mDAIK+I,GAAO0B,MACzBC,YAAa,gCACb/K,WAAY,WACVO,KAAK0K,UAAY,gDACjB1K,KAAK4K,MAAQ,cACb5K,KAAK6K,UAAY,MAEnBC,aAAc,UAEFlD,OAAO3D,KAAK,WACxB65B,EAAepc,UAAU1hB,KAAKuyB,SAASwL,YAAYl3B,GAAI8a,EAAO,SAAUhf,GACtE,GAAIA,EAAKkoD,aAAc,CACrB,IAAK,GAAIloC,GAAI,EAAGA,EAAI3iB,KAAKgS,KAAK3O,OAAQsf,IACpC,GAAI3iB,KAAKgS,KAAK2Q,GAAG9b,IAAM8a,EAAO,CAC5B3hB,KAAKgS,KAAKic,OAAOtL,EAAG,EACpB,OAIJ3iB,KAAKmvB,MAAMnd,KAAOhS,KAAKgS,KAAK3O,OAC5BrD,KAAKsqD,OAAOtqD,KAAKuyB,SAASs3B,WAC1B7pD,KAAKuqD,QAAQvqD,KAAKuyB,SAASvvB,QAE7B6C,KAAK7F,QACP6F,KAAK7F,QAGTA,KAAK8qD,gBAAkB,WACrB9qD,KAAK+qD,gBAAiB,GAGxB/qD,KAAKgrD,mBAAqB,WAExB,MADAhrD,MAAK6M,QAAQoD,MAAO,EACb6tB,EAAehvB,QAAQ,SAAUnM,GAMtC,GALA3C,KAAKirD,aAAetoD,EAAKgD,IAAI,SAAUwW,GAErC,MADAA,GAAE+uC,aAAe,GAAIjjD,MAAKkU,EAAE+uC,cACrB/uC,IAGLxV,EAAE6tC,IAAK,CACT,GAAIjiB,GAAWvyB,KAAKirD,aAAa5qD,OAAO,SAAU8qD,GAChD,MAAOA,GAAKtkD,IAAMF,EAAE6tC,MACnBzD,KAECxe,IACFvyB,KAAKorD,kBAAkB74B,GAI3BvyB,KAAK6M,QAAQoD,MAAO,GACpBpK,KAAK7F,QAGTA,KAAKqrD,kBAAoB,WACvB,IAAK3qD,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,qDAIf+I,GAAO0B,MACLC,YAAa,2DACb/K,WAAY,8CACXmI,OAAO3D,KAAKjE,KAAKgrD,mBAAmBnlD,KAAK7F,QAG9CA,KAAKorD,kBAAoB,SAAU74B,GACjC5yB,EAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD,MACjCwzC,IAAKjiB,EAAS1rB,GACdoS,KAAMtZ,EAAOoB,OAAOkY,OAEpBtY,QAAQ,IAEVX,KAAKgqD,aAAqC,WAAtBrqD,EAAOoB,OAAOkY,KAClCjZ,KAAKmqD,eAAgB,EACrBP,EAAqBR,WAAW72B,GAE5BvyB,KAAKuyB,SAASwL,aACZ/9B,KAAKuyB,SAASwL,YAAY9c,YACrBjhB,MAAKuyB,SAASwL,YAAY9c,KAIrCjhB,KAAKuyB,SAASwL,YAAcxL,EAC5B/vB,EAAQuY,wBAAwBwX,EAASjuB,QAASiuB,EAASsf,SAAU,SAAUlvC,GAC7E3C,KAAKuyB,SAASwL,YAAYutB,YAAc3oD,GACxCkD,KAAK7F,OACP89B,EAAerc,WAAW8Q,EAAS1rB,GAAI,SAAU0kD,GAC/CvrD,KAAKsE,QAAUinD,EAAYjnD,QAC3BtE,KAAK6xC,SAAW0Z,EAAY1Z,SAC5B+X,EAAqBH,eAAezpD,KAAKsE,QAAStE,KAAK6xC,UACvD/T,EAAetc,QAAQ+Q,EAAS1rB,GAAI,SAAUlE,GAC5C3C,KAAKmqD,eAAgB,EACrBnqD,KAAKgqD,cAAe,EACpBhqD,KAAKmvB,MAAMnd,KAAOrP,EAAKU,OACvBrD,KAAKmvB,MAAM26B,MAAQlpD,KAAKgoB,KAAK5oB,KAAKmvB,MAAMnd,KAAOhS,KAAKkqD,aACpDlqD,KAAKwqD,UAAU7nD,GACf3C,KAAKsqD,OAAO,GACZtqD,KAAKuqD,QAAQ,GACbvqD,KAAKuyB,SAASvvB,KAAO,GACrB6C,KAAK7F,QACP6F,KAAK7F,QAGTA,KAAKwrD,eAAiB,WACpBxrD,KAAKuyB,SAASwL,YAAY0tB,WAAa3tB,EAAevpB,aAAavU,KAAKuyB,SAASwL,YAAYl3B,KAG/F7G,KAAK0rD,eAAiB,SAAUl/C,GAE9B,MADAA,GAAOgtB,kBACH94B,EAAa8C,UAAkBxD,KAAKwrD,iBAEpC9qD,EAAa0C,MAAQ1C,EAAa0C,IAAIC,SAAW3C,EAAa6C,IAAI,iBAC7D5C,EAAOb,MAAM,0DACRE,KAAKwrD,kBAGrBxrD,KAAK2rD,gBAAkB,SAAU3B,GAC/BrqD,EAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD,MACjCwzC,IAAK70C,EAAOoB,OAAOyzC,IACnBv7B,KAAM+wC,EAAe,SAAW,YAEhCrpD,QAAQ,IAEVX,KAAKgqD,aAAeA,EACpBJ,EAAqBJ,aAAaxpD,KAAKgqD,eAGzChqD,KAAK4rD,wBAA0B,WAC7B,IAAKlrD,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,mDAIf,IAAIE,KAAKuyB,SAASwL,YAAa,CAC7B,GAAIA,GAAc/9B,KAAKuyB,SAASwL,YAC5B8tB,GACFvnD,QAASy5B,EAAYz5B,QACrButC,SAAU9T,EAAY8T,SAExBga,GAAazyC,aAAepZ,KAAKsE,QACjCunD,EAAahE,cAAgB7nD,KAAK6xC,SAClCrvC,EAAQgW,aAAavU,KAAK,SAAUqjD,GAClC,GAAInrC,GAAI1X,EAAG2X,QACPsoC,EAAU4C,EAAQjnD,OAAO,SAAUuW,GACrC,MAAOi1C,GAAavnD,SAAWsS,EAAItS,SAAWunD,EAAaha,UAAYj7B,EAAIi7B,WAC1Ed,OAAS8a,CAmBZ,OAlBA9tB,GAAY9c,MACVjgB,KAAM+8B,EAAY/8B,KAClB+mB,MAAO28B,EACPpqC,eAAgBgtC,GAElBvpB,EAAY9c,KAAKtV,OAASwQ,EAAEE,OAAOxW,KAAKsW,GAExC4hB,EAAY9c,KAAK3T,KAAO,WACtB,MAAOwwB,GAAe7c,KAAK8c,EAAYl3B,IACrC7F,KAAM+8B,EAAY9c,KAAKjgB,KACvB+mB,MAAOgW,EAAY9c,KAAK8G,MAAMlhB,KAC7B5C,KAAK,SAAUiG,GAChBiS,EAAErX,QAAQoF,EAASvH,OAClB,SAAUuH,GACXvJ,EAAOmH,IAAIoC,EAASvH,SAIjBwZ,EAAEG,UACRrY,KAAK,SAAU6nD,GAChB,IAAK,GAAInpC,KAAKmpC,GACZ/tB,EAAYpb,GAAKmpC,EAAkBnpC,EAGrC3iB,MAAKorD,kBAAkBrtB,IACvBl4B,KAAK7F,OAAO+rD,QAAQ,iBACbhuB,GAAY9c,SAKzBjhB,KAAKgsD,0BAA4B,WAC/B,GAAIjuB,GAAc/9B,KAAKuyB,SAASwL,WAEhC,IAAKA,EAIL,MAAKr9B,GAAa6C,IAAI,4BAKtBsF,GAAO0B,MACLC,YAAa,gCACb/K,WAAY,WACVO,KAAK0K,UAAY,+CAAkDqzB,EAAY/8B,KAAO,oBACtFhB,KAAK4K,MAAQ,cACb5K,KAAK6K,UAAY,MAEnBC,aAAc,UACblD,OAAO3D,KAAK,WACb65B,EAAe1vB,OAAO2vB,EAAYl3B,GAAI,SAAUlE,GAC9C3C,KAAKirD,aAAah9B,OAAOjuB,KAAKirD,aAAa5/B,QAAQ0S,GAAc,SAC1D/9B,MAAKuyB,SAASwL,aACrBl4B,KAAK7F,QACP6F,KAAK7F,WAjBLW,GAAOb,MAAM,qDAoBjBE,KAAKgrD,qBACLhrD,KAAKqqD,WAAa7nD,EAAQU,SAC1B0mD,EAAqBhB,WAAW,SAAUjmD,GACpCA,EAAKkmD,KACP7oD,KAAK+qD,gBAAiB,EACtB/qD,KAAKuyB,SAASwL,YAAcp7B,EAAKkmD,GACjC7oD,KAAKsE,QAAU3B,EAAKumD,GACpBlpD,KAAK6xC,SAAWlvC,EAAKwmD,GACrBnpD,KAAKgqD,aAAernD,EAAKsmD,GACzBjpD,KAAKmvB,MAAMnd,KAAOrP,EAAKqmD,IAAI3lD,OAC3BrD,KAAKmvB,MAAM26B,MAAQlpD,KAAKgoB,KAAK5oB,KAAKmvB,MAAMnd,KAAOhS,KAAKkqD,aACpDlqD,KAAKuyB,SAASvvB,KAAOL,EAAKmmD,GAC1B9oD,KAAKwqD,UAAU7nD,EAAKqmD,KACpBhpD,KAAKuqD,QAAQ5nD,EAAKmmD,IAClB9oD,KAAKsqD,OAAO3nD,EAAKomD,IAAM,KAEzBljD,KAAK7F,UCvWTT,QAAQC,OAAO,WAAY,cAAe,mBAAmBqC,QAAA,iBAAO,SAAUq1C,GAC5EA,EAAeC,MAAM,QACnB9vC,IAAK,QACL5H,WAAY,yBACZ+K,YAAa,4BAEd/K,WAAW,0BAAA,SAAA,QAAA,SAAA,UAAA,UAAA,WAAA,SAAA,eAA0B,SAAUC,EAAQqE,EAAO8E,EAAQpG,EAASD,EAASypD,EAAUtrD,EAAQD,GAC3GhB,EAAOuZ,QACPvZ,EAAOwsD,qBAAsB,EAC7BxsD,EAAOysD,eAAgB,EACvBzsD,EAAO0sD,iBAAkB,EACzB1sD,EAAO2H,IAAM,GACb3H,EAAO2sD,YAAc,GACrB3sD,EAAO4sD,cAAe,EACtB5sD,EAAO6sD,UAAY,GACnB7sD,EAAO8sD,YAAa,EACpB9sD,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SACLxI,MAAM,GAER3E,EAAOmN,QAAQxI,MAAO,EAEtB3E,EAAOitD,YAAc,WACnBjtD,EAAO2sD,YAAc,GACrB3sD,EAAOktD,aAAc,EACrBltD,EAAO6sD,UAAY,GACnB7sD,EAAOmtD,WAAY,EACnBntD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,GAGpBlqD,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,GAGnB,IAAIy0C,GAAU,SAAUv8C,EAAOyU,GAC7BjhB,EAAMC,IAAI,gBAAkBxB,EAAQU,SAAW,cAAgBqN,GAAO9J,QAAQ,SAAU9D,GACtFspD,EAASc,YACT,MAAMllD,GAAU,OAASmd,EAAS,gBAClCrkB,GAAOmH,IAAID,KACV/H,MAAM,SAAU6C,GACbA,EAAK7C,MACPa,EAAOb,MAAMA,OAEba,EAAOgN,gBAKbs+C,GAASe,cAAcvmD,QAAQ,SAAU9D,GACvC,GAAIysB,IAAU,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAC5E69B,GAAgB,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAClCnV,EAAYn1C,EAAKtC,OAAO,SAAUiG,GACpC,MAAO2mD,GAAa3pD,SAASgD,EAAKO,KAEpCnH,GAAOo4C,aACPp4C,EAAOo4C,UAAUH,MAAQG,EACzBp4C,EAAOo4C,UAAU7+B,QACjBvZ,EAAOo4C,UAAUoV,OACjBxtD,EAAOo4C,UAAUH,MAAMjxC,QAAQ,SAAUymD,EAAGxqC,GAC1CjjB,EAAOuZ,KAAKk0C,EAAEtmD,KAAM,EACpBnH,EAAOo4C,UAAUoV,IAAIC,EAAEtmD,IAAMsmD,EAC7BA,EAAExrB,MAAQvS,EAAOzM,EAAIyM,EAAO/rB,YAGhC3D,EAAO8oB,OAAO,WACZ,MAAOyjC,GAASmB,WACf,SAAUC,GACX3tD,EAAO2E,KAAOgpD,EACd3tD,EAAOmN,QAAQxI,MAAO,EACtB4nD,EAASqB,aACT5tD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,IACjB,GACHhtD,EAAOmB,IAAI,WAAY,WACrBorD,EAASsB,gBAGX7tD,EAAO8tD,eAAiB,WACtB,OAAQ9tD,EAAOmN,QAAQxI,UAAwB3C,KAAhBhC,EAAO2E,MAAsB3E,EAAO2E,KAAKhB,QAG1E3D,EAAO+tD,cAAgB,WACrB,OAAQ/tD,EAAOmN,QAAQxI,UAAwB3C,KAAhBhC,EAAO2E,OAAuB3E,EAAO2E,KAAKhB,QAG3E3D,EAAOguD,WAAa,WAClB,WAAuBhsD,KAAhBhC,EAAO2E,KAGhB,IAAIyjC,GAAU,SAAU6lB,EAAQ3oC,EAAQiyB,EAAI2W,EAAI/lD,GAC9C,GAAIgmD,GAAgBhlD,EAAO0B,MACzBC,YAAa,gCACb/K,WAAY,WACVO,KAAK6D,MAAQ8pD,EAAS,eACtB3tD,KAAK0K,UAAY,gDACjB1K,KAAK4K,MAAQ,QAAUoa,EAAS,MAChChlB,KAAK6K,UAAY,MAEnBC,aAAc,SAEhB+iD,GAAcC,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,IAEpBmB,EAAcjmD,OAAO3D,KAAK,SAAUokC,GAClC4O,EAAG2W,EAAI/lD,KAIXnI,GAAO02B,KAAO,SAAU23B,GACtB,IAAKrtD,EAAa6C,IAAI,uBAEpB,WADA5C,GAAOb,MAAM,oDAIf,MAAMyQ,GAAQw9C,EAAI76C,MAClBxT,GAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAEdqB,EAAIC,WAAa,IACnBlmB,EAAQ,SAAU,SAAUglB,EAASv8C,EAAO,YAE5Cu8C,EAAQv8C,EAAO,WAInB7Q,EAAOuuD,YAAc,SAAUv6B,GAC7B,MAAqB,cAAdA,EAAIyjB,OAGbz3C,EAAOwuD,aAAe,SAAUx6B,GAC9B,MAAqB,eAAdA,EAAIyjB,OAGbz3C,EAAOyuD,UAAY,SAAUz6B,GAC3B,MAAqB,YAAdA,EAAIyjB,OAGbz3C,EAAO0uD,QAAU,SAAU16B,GACzBjxB,EAAQiB,SAAS2qD,KAAO,YAAc7rD,EAAQU,SAAW,aAAewwB,EAAIrsB,QAE7ElH,QAAQ,YAAA,QAAA,YAAA,UAAA,KAAY,SAAU4D,EAAOuH,EAAW9I,EAASiC,GAC1D,GAAIJ,GAEAiqD,EADAjnD,EAAM7E,EAAQU,SAEdgrD,GAAe,CAyBnB,OAvBAnB,YAAa,WACPmB,IACJA,GAAe,EACfnqD,EAAMC,IAAI,gBAAkBqD,EAAM,kBAChCtG,QACEwtD,aAAa,KAEd9nD,QAAQ,SAAU9D,GACnBA,EAAK+D,QAAQ,SAAUS,GACI,IAArBA,EAAKqnD,aAAwC,IAAnBrnD,EAAK4F,WAAkC,UAAf5F,EAAKgwC,QACzDhwC,EAAKgwC,MAAQ,mCAGU,IAArBhwC,EAAKqnD,aAAwC,IAAnBrnD,EAAK4F,WAAkC,cAAf5F,EAAKgwC,QACzDhwC,EAAKgwC,MAAQ,gBAGjB9yC,EAAO1B,EACPurD,GAAe,MAInBnB,cAEE0B,OAAQ,WACN,MAAOpnD,IAET+lD,QAAS,WACP,MAAO/oD,IAET2oD,YAAa,WACX,MAAOjpD,GAAMC,IAAI,oBAEnB+oD,WAAY,WACV,MAAOA,eAETO,WAAY,WACVhiD,EAAUK,OAAO2iD,OAEE,KAARjqD,GAAuBA,EAAKhB,OAAS,IAC9CirD,EAAkBhjD,EAAU,WAG1B,IAAK,GAFDojD,IAAiB,EAEZ/rC,EAAI,EAAGA,EAAIte,EAAKhB,OAAQsf,IAC/B,GAAIte,EAAKse,GAAGqrC,WAAa,IAAK,CAC5BU,GAAiB,CACjB,OAIAA,EACFpjD,EAAUK,OAAO2iD,GACRjqD,EAAKhB,OAAS,EACvBiI,EAAUK,OAAO2iD,GAEjBvB,cAED,OAGPQ,YAAa,WACXjiD,EAAUK,OAAO2iD,QClNvB/uD,QAAQC,OAAO,wBAAyB,gCAAiC,yBAA0B,uCAAwC,8BAA+B,6BAA8B,YAAa,wBAAwBqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC5QA,EAAmBqM,KAAK,qBAAsB,uCAC9C+oC,EAAeC,MAAM,qBACnB9vC,IAAK,qBACLo1C,OACEkS,qBACEnkD,YAAa,sCAGjBu1C,mBAAmB,EACnBC,QAAQ,OCVZzgD,QAAQC,OAAO,oBAAqB,cAAe,gBAAiB,eAAgB,YAAa,sBAAuB,WAAY,SAAU,gBAAiB,gCAAgCqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC9No1C,EAAeC,MAAM,aACnB9vC,IAAK,aACL5H,WAAY,cACZ+K,YAAa,iCAEd/K,WAAW,eAAA,SAAA,UAAA,cAAA,qBAAA,WAAA,UAAA,WAAA,iBAAA,oBAAe,SAAUC,EAAQ8C,EAASosD,EAAatO,EAAoBj1C,EAAU5I,EAASupB,EAAU6iC,EAAgBC,GACpIpvD,EAAOmN,QAAU,CAEjB,IAAIkiD,GAAO,WACLrvD,EAAOmN,QAAU,KAAKnN,EAAOmN,QAGnCrK,GAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,EACjB3Y,EAAOsvD,kBAAmB,EAC1BxsD,EAAQgX,uBAAuBnB,EAAKF,WAAY,SAAUxV,GACxDjD,EAAOuvD,WAAatsD,GAAQ,EAC5BjD,EAAOsvD,kBAAmB,IAE5BD,MAEFvsD,EAAQ+V,SAAS,SAAUyD,GACzBtc,EAAOsc,MAAQA,EACf+yC,IACA1jD,EAAS,WACPi1C,EAAmBr8C,KAAK,SAAU4oC,GAChCntC,EAAOiG,IAAM,GAAIknC,GAAOwU,KAAKC,IAAI7+C,EAAQvB,SAASqgD,eAAe,gBAC/DC,QACE16C,IAAK,EACL26C,IAAK,GAEPC,UAAW7U,EAAOwU,KAAKM,UAAUC,UACjC56C,KAAM,EACN66C,QAAS,GAEX,IAAIK,GAAS,GAAIrV,GAAOwU,KAAKc,YAC7B5iD,SAAQmH,QAAQhH,EAAOsc,MAAO,SAAUD,GACtC,KAAIA,EAAKjV,IAAM,IAAMiV,EAAKjV,KAAO,IAAMiV,EAAKhV,IAAM,KAAOgV,EAAKhV,KAAO,KAArE,CAIA,GAAIk4B,GAAW,GAAI4N,GAAOwU,KAAKe,OAAOrmC,EAAKjV,IAAKiV,EAAKhV,KACjDo0C,EAAS,GAAItO,GAAOwU,KAAKgB,QAC3BpjB,SAAUA,EACVp7B,MAAOkY,EAAK/a,MAEdkhD,GAAOl3C,OAAOi0B,GACdkc,EAAOyI,OAAOlkD,EAAOiG,KACrBjG,EAAOiG,IAAIm8C,UAAUI,SAGxB,OAEL1/C,EAAQ+W,eAAe,SAAU5W,GAC/BjD,EAAOwvD,QAAUvsD,EACjBosD,MAEFH,EAAY9/C,UAAU7K,KAAK,SAAUtB,GACnCjD,EAAOyvD,YAAcxsD,EAAKU,OAC1B0rD,MAEFD,EAAkBr4C,yBAAyB,SAAU9T,GACnDjD,EAAO0vD,MAAQzsD,EACfosD,SChEJxvD,QAAQC,OAAO,eAAgB,cAAe,gBAAiB,WAAY,YAAa,iBAAkB,2BAA4B,eAAgB,YAAa,sBAAuB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACpOA,EAAmBqM,KAAK,YAAa,oBAErC,IAAIkhD,GAAc,SAAU3uD,GAC1B,MAAOA,GAAa6C,IAAI,2BAG1B2zC,GAAeC,MAAM,YACnB9vC,IAAK,YACLmD,YAAa,2BACbhJ,YAAa6tD,IACZlY,MAAM,oBACP9vC,IAAK,WACL5H,WAAY,sBACZ+K,YAAa,6BACbhJ,YAAa6tD,IACZlY,MAAM,kBACP9vC,IAAK,SACL5H,WAAY,oBACZ+K,YAAa,2BACbhJ,YAAa6tD,OAEd5vD,WAAW,uBAAA,SAAA,UAAA,SAAA,UAAA,WAAA,UAAA,eAAA,SAAuB,SAAUC,EAAQ8C,EAAS7B,EAAQ8B,EAAS4I,EAAU7G,EAAS9D,EAAcmI,GAChHnJ,EAAO0jB,MAAQ,GAAInb,MACnBzF,EAAQE,QAAQ,SAAU2V,GACpBA,EAAK+L,gBAAkB/L,EAAK4L,cAC9B5L,EAAKi3C,SAAW,GAAIrnD,MAAKoQ,EAAK+L,gBAC9B/L,EAAKi3C,SAAS9qC,YAAYnM,EAAKi3C,SAAS7qC,cAAgBpM,EAAK4L,cAG/DvkB,EAAO0H,QAAUiR,IAEnB7V,EAAQ8V,WAAW7R,QAAQ,SAAUme,GACnCllB,EAAOmlB,SAAWD,EAAME,YAG1BplB,EAAO4N,KAAO,WACZzN,QAAQiI,IAAIpI,GACPA,EAAO2lB,UAEP3lB,EAAO0H,QAAQhD,cAClB1E,EAAO0H,QAAQhD,YAAc,IAG/B5B,EAAQ4V,YACNhR,QAAS1H,EAAO0H,SACf,SAAUsG,EAAK9F,GAChB,MAAI8F,GACK/M,EAAOgN,cAGZ/F,EAAO9H,MACFa,EAAOb,MAAM8H,EAAO9H,QAG7Ba,EAAOmH,IAAI,6BAEPF,EAAOP,KACTgE,EAAS,WACP5I,EAAQiB,SAASyE,OAAO,YAAcP,EAAOP,IAAM,gBAClD,WAKT3H,EAAO6vD,cAAgB,WACrB,IAAK7uD,EAAa6C,IAAI,kBAEpB,WADA5C,GAAOb,MAAM,oDAIfJ,GAAOm7B,OACLh3B,MAAO,iBACP6G,UAAW,iDACXE,MAAO,MACPC,UAAW,MAEOhC,EAAO0B,MACzBC,YAAa,gCACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,WACxB,MAAOzB,GAAQ4Y,eACb4qC,YAAatmD,EAAO0H,QAAQ4+C,cAC3B/hD,KAAK,WACNtD,EAAOmH,IAAI,mBACXrF,EAAQiB,SAAS2qD,KAAO,iBAK9B3uD,EAAOqmB,WAAa,WACEvhB,EAAQuhB,mBAE7BtmB,WAAW,qBAAA,SAAA,QAAA,UAAA,SAAA,SAAqB,SAAUC,EAAQqE,EAAOvB,EAASqG,EAAQlI,GAC3EjB,EAAO8vD,UAAY,GACnB9vD,EAAO+vD,SAAW,GAClBjtD,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,IAEnB7V,EAAQ+X,SAAS,SAAU7M,EAAKgiD,GAC9BhwD,EAAOgwD,MAAQA,IAEjBltD,EAAQgY,SAAS,SAAU9M,EAAKiiD,GAC9BjwD,EAAOiwD,MAAQA,IAGjBjwD,EAAOkwD,SAAW,SAAUj+C,GAE1B,MADAjS,GAAO+vD,SAAW99C,EACX5N,EAAMC,IAAI,oBAAsB2N,GAAO1N,KAAK,SAAUiG,GAC3D,MAAOA,GAASvH,QAIpBjD,EAAOmwD,WAAa,SAAUltD,GAC5B,MAAOoB,GAAMkF,KAAK,mBAAoBtG,GAAMsB,KAAK,SAAUiG,GACzD,MAAOA,GAASvH,QAIpBjD,EAAO2B,IAAM,WACN3B,EAAO8vD,WAIZhtD,EAAQiY,SACNtC,WAAYzY,EAAO0H,QAAQ+Q,WAC3B6J,QAAStiB,EAAO8vD,UAAU3oD,GAC1BipD,WAAYpwD,EAAO8vD,UAAUnjD,OAC5B,SAAUqB,GACPA,EACF/M,EAAOb,MAAM4N,IAEbhO,EAAO+vD,SAAW,GAClB9uD,EAAOmH,IAAI,0BAGbtF,EAAQ+X,SAAS,SAAU7M,EAAKgiD,GAC9BhwD,EAAOgwD,MAAQA,OAKrBhwD,EAAOqwD,OAAS,WACdrwD,EAAOswD,oBAAoBtwD,EAAO+vD,WAGpC/vD,EAAOswD,oBAAsB,SAAU3jD,GACjBxD,EAAO0B,MACzBC,YAAa,gCACb/K,WAAY,mCACZqF,SACEuH,MAAO,WACL,MAAOA,IAETwjD,WAAY,WACV,MAAOnwD,GAAOmwD,eAINjoD,OAAO3D,KAAK,SAAU0F,GAClCjK,EAAOuwD,WAAY,EACnBvwD,EAAO8vD,UAAY7lD,EACnBjK,EAAO8vD,UAAU3oD,GAAK8C,EAAKqY,QAC3BtiB,EAAO2B,SAIX3B,EAAOwwD,WAAa,SAAUp7B,GAC5B,GAAIq7B,GAAOzwD,EAAOiwD,MAAMtvD,OAAO,SAAUgI,GACvC,MAAO3I,GAAOgwD,MAAM56B,GAAQs7B,WAAa/nD,EAAMrH,OAC9C,EACHwB,GAAQmY,gBACNxC,WAAYzY,EAAO0H,QAAQ+Q,WAC3B6J,QAAStiB,EAAOgwD,MAAM56B,GAAQjuB,GAC9BipD,WAAYpwD,EAAOgwD,MAAM56B,GAAQzoB,MACjCgkD,QAASF,EAAKtpD,IACb,SAAU6G,GACPA,EACF/M,EAAOb,MAAM4N,GAEb/M,EAAOmH,IAAI,qBAGbtF,EAAQ+X,SAAS,SAAU7M,EAAKgiD,GAC9BhwD,EAAOgwD,MAAQA,MAKrB,MAAM7nD,IAAW,8EAEjBnI,GAAOslD,IAAM,SAAUlwB,GACrB,KAAMnrB,GAAOjK,EAAOgwD,MAAM56B,EAC1Bp1B,GAAOm7B,OACLnwB,SAAU7C,EAAQ28C,OAAO76C,EAAKuvC,UAAY,IAAMvvC,EAAK6D,SAAW,KAAY7D,EAAK0C,MAAQ,KACzFzB,MAAO,cACPC,UAAW,MAEOhC,EAAO0B,MACzBC,YAAa,gCACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,WACxBzB,EAAQkY,YACNvC,WAAYzY,EAAO0H,QAAQ+Q,WAC3B6J,QAAStiB,EAAOgwD,MAAM56B,GAAQjuB,GAC9BipD,WAAYpwD,EAAOgwD,MAAM56B,GAAQzoB,OAChC,SAAUqB,GACPA,EACF/M,EAAOb,MAAM4N,GAEb/M,EAAOmH,IAAI,6BAGbtF,EAAQ+X,SAAS,SAAU7M,EAAKgiD,GAC9BhwD,EAAOgwD,MAAQA,YAKtBjwD,WAAW,sBAAA,iBAAA,SAAA,QAAA,aAAsB,SAAUyjB,EAAgBviB,EAAQ0L,EAAOwjD,GAC3Ej+C,OAAOzJ,OAAOnI,MACZ2zB,WAAY,WACV3zB,KAAKuG,WAAY,EACjBvG,KAAK2C,MACH0J,MAAOA,EACP6sC,UAAW,GACX1rC,SAAU,KAGdyY,OAAQ,WACN,GAAIqqC,GAAQtwD,IAEZ,KAEE,MADAA,MAAKuG,WAAY,EACVspD,EAAW7vD,KAAK2C,MAAMsB,KAAK,SAAU0F,GAC1CuZ,EAAeyC,MAAMhc,KACpBQ,MAAMxJ,EAAOgN,aAAao+C,QAAQ,WACnCuE,EAAM/pD,WAAY,IAEpB,MAAOzG,GACPD,QAAQC,MAAM,oCAAqCA,KAGvD6L,OAAQ,WACNuX,EAAeyC,MAAM,OAEvB4qC,YAAa,WACX,MAAOvwD,MAAK2C,KAAK0J,MAAMwQ,OAAOxZ,OAAS,GAAKrD,KAAK2C,KAAKu2C,UAAUr8B,OAAOxZ,OAAS,GAAKrD,KAAK2C,KAAK6K,SAASqP,OAAOxZ,OAAS,KAG5HrD,KAAK2zB,gBC5PPp0B,QAAQC,OAAO,iCAAkCW,QAAQ,iBAAA,gBAAA,KAAA,SAAA,cAAA,UAAA,gBAAA,eAAiB,SAAUqwD,EAAe/rD,EAAI9D,EAAQ8vD,EAAajuD,EAAS+B,EAAe7D,GAClJ,YAEA,IAAIs9C,GAAgB,SAAU12B,EAAO5V,GAiBnC,GAhBA1R,KAAKsnB,MAAQA,EACbtnB,KAAK8+C,KAAO,EACZ9+C,KAAK0wD,aAAe,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,IACjD1wD,KAAK2wD,gBAAcjvD,GACnB1B,KAAK4wD,YAAa,EAClB5wD,KAAK6wD,UAAW,EAChB7wD,KAAK8wD,eAAgB,EACrB9wD,KAAK+wD,oBAAqB,EAC1B/wD,KAAKgxD,oBAAqB,EAC1BhxD,KAAK6+C,SAAW,KAChB7+C,KAAKixD,mBACLjxD,KAAKkxD,eAAgB,EACrBlxD,KAAKmxD,kBAAmB,EACxBnxD,KAAKoxD,gBACLpxD,KAAKqxD,aAAe,KAEhB3/C,IACEA,EAAQotC,OACV9+C,KAAK8+C,KAAOl+C,KAAKy8B,IAAIz8B,KAAK08B,IAAI,EAA+B,GAA3B5rB,GAAWA,EAAQotC,OAAY9+C,KAAK0wD,YAAY1wD,KAAK0wD,YAAYrtD,OAAS,IAC5GrD,KAAKixD,gBAAgBnS,KAAO9+C,KAAK8+C,MAG/BptC,EAAQrR,QAAQ,CAClB,GAAIixD,GAAI5/C,EAAQrR,OAAOqI,MAAM,KACzB8X,EAAiB,EAAZ8wC,EAAE/8B,QACP7T,EAAiB,EAAZ4wC,EAAE/8B,QACPg9B,EAAO3wD,KAAKy8B,IAAI7c,EAAIE,GACpB8wC,EAAO5wD,KAAK08B,IAAI9c,EAAIE,EAEpB8wC,KACFxxD,KAAK2wD,aACHtzB,IAAKk0B,EACLj0B,IAAKk0B,GAEPxxD,KAAKixD,gBAAgBxnB,QAAU+nB,EAC/BxxD,KAAKixD,gBAAgBQ,QAAUF,GAKrCjqC,EAAMzmB,IAAI,WAAYb,KAAK0xD,QAAQ7rD,KAAK7F,OAmL1C,OAhLAg+C,GAAc/vC,WACZ0jD,mBAAoB,SAAUhB,GAS5B,MARIA,IACF3wD,KAAKixD,gBAAgBxnB,QAAUknB,EAAYrzB,IAC3Ct9B,KAAKixD,gBAAgBQ,QAAUd,EAAYtzB,YAEpCr9B,MAAKixD,gBAAgBxnB,cACrBzpC,MAAKixD,gBAAgBQ,SAGvBzxD,KAAKwiC,KAAKxiC,KAAK2U,cAAc1Q,KAAK,WACvCjE,KAAK2wD,YAAcA,GACnB9qD,KAAK7F,QAITo+C,QAAS,SAAUU,GASjB,MARAA,GAAOl+C,KAAK08B,IAAI,EAAU,EAAPwhB,GAEP,GAARA,EACF9+C,KAAKixD,gBAAgBnS,KAAOA,QAErB9+C,MAAKixD,gBAAgBnS,MAGtB9+C,KAAK2U,aAAe3U,KAAKwiC,KAAKxiC,KAAK2U,cAAgBlQ,EAAGK,WAAWb,KAAK,WAC5EjE,KAAK8+C,KAAOA,GACZj5C,KAAK7F,QAIT4xD,UAAW,WACT,MAAO5xD,MAAK6+C,UAAY7+C,KAAK6+C,SAASgT,MAAMC,QAE9ClT,eAAgB,SAAU/lB,GACpB74B,KAAK6+C,UACP7+C,KAAK6+C,SAASD,eAAe/lB,IAGjCk5B,eAAgB,WACd,MAAO/xD,MAAK6+C,UAAY7+C,KAAK6+C,SAASgT,OAAS7xD,KAAK6+C,SAASgT,MAAMG,aAErEC,YAAa,WACXjyD,KAAKkxD,eAAiBlxD,KAAKkxD,eAE7BgB,oBAAqB,WACnB,MAAOlyD,MAAKoxD,aAAae,cAAgBnyD,KAAKoxD,aAAae,aAAat1C,OAAOxZ,OAAS,GAE1F+uD,WAAY,WACVpyD,KAAKkxD,eAAgB,GAEvBmB,aAAc,WAGZ,GAFAryD,KAAKmxD,kBAAmB,EAEpBnxD,KAAKqxD,cAAgBrxD,KAAKqxD,aAAarhD,SAAU,CACnD,GAAI2gC,GAAO3wC,IACXywD,GAAYrgD,QACVkiD,cAAetyD,KAAKoxD,aAAae,aACjCpxD,OAAQf,KAAKqxD,aAAarhD,SAAS7L,WACnCouD,gBAAgB,GACf,SAAU5vD,GACXguC,EAAKwgB,kBAAmB,EACxBxgB,EAAKyhB,aAEDzvD,GAAQA,EAAKoV,aACf04C,EAAY34C,qBACVC,YAAapV,EAAKoV,YAClB3I,IAAKuhC,EAAK0gB,aAAajiD,KACtB,SAAUzM,GACXguC,EAAKygB,gBACLzwD,EAAOmH,IAAI,2DAMrB0qD,eAAgB,SAAUnrD,EAAKtG,GAG7B,GAFAf,KAAK6M,SAAU,EAEX9L,EAAQ,CACV,GAAI0xD,GAAK7gD,OAAOC,KAAK9Q,EAErB,IAAI0xD,EAAGpvD,OAAQ,CAEbgE,IADS,KAAKqV,KAAKrV,GAAO,IAAM,KACpBorD,EAAG9sD,IAAI,SAAU+sD,GAC3B,MAAOA,GAAI,IAAM3xD,EAAO2xD,KACvBjjD,KAAK,MAIZ,GAAIovC,GAAW,GAAI2R,GAAcnpD,EAIjC,OAHAw3C,GAAS8T,oBAAoBl1C,KAAK,WAChCzd,KAAK4wD,YAAa,GAClB/qD,KAAK7F,OACA6+C,EAAS+T,aAAa3uD,KAAK,WAChCjE,KAAK6M,SAAU,GACfhH,KAAK7F,OAAOiE,KAAK,WACjB,MAAO46C,MAGXrc,KAAM,SAAUn7B,GAGd,MAFArH,MAAK0xD,UACL1xD,KAAK6+C,aAAWn9C,GACT1B,KAAKwyD,eAAenrD,EAAKrH,KAAKixD,iBAAiBhtD,KAAK,SAAU46C,GACnE7+C,KAAK6+C,SAAWA,EAChB7+C,KAAKgkB,SAAW66B,EAAS76B,SACzBhkB,KAAK2U,aAAetN,EACpBrH,KAAK8wD,eAAgB,EACrB9wD,KAAKqxD,aAAepsD,KAAKC,MAAMX,EAAcY,QAAQ,sBACrDtF,QAAQiI,IAAI,eAAgB9H,KAAKqxD,eACjCxrD,KAAK7F,QAET0xD,QAAS,WACP1xD,KAAKg/C,OAEDh/C,KAAK6+C,UACP7+C,KAAK6+C,SAAS6S,UAGhB1xD,KAAK8wD,eAAgB,EACrB9wD,KAAK6+C,aAAWn9C,GAChB1B,KAAK2U,iBAAejT,IAEtBmxD,KAAM,SAAUC,GACV9yD,KAAK6+C,UACP7+C,KAAK6+C,SAASiU,EAAQ,OAAS,YAGjC9yD,KAAK6wD,SAAWiC,GAElB/U,KAAM,WACA/9C,KAAK6+C,WACP7+C,KAAK6+C,SAASd,OACd/9C,KAAK4wD,YAAa,IAGtB7R,MAAO,WACD/+C,KAAK6+C,UACP7+C,KAAK6+C,SAASE,QAGhB/+C,KAAK4wD,YAAa,GAEpB5R,KAAM,WACAh/C,KAAK6+C,UACP7+C,KAAK6+C,SAASG,OAGhBh/C,KAAK4wD,YAAa,GAEpBmC,eAAgB,WACd/yD,KAAKsnB,MAAMmS,WAAW,mBAExBu5B,eAAgB,WACdhzD,KAAKsnB,MAAMmS,WAAW,mBAExBqf,SAAU,SAAUj7B,GAClB,MAAInd,GAAa8C,UAAkBxD,KAAKuU,aAAasJ,GAEjDnd,EAAa0C,MAAQ1C,EAAa0C,IAAIC,SAAW3C,EAAa6C,IAAI,iBAC7D5C,EAAOb,MAAM,oDAGfE,KAAKuU,aAAasJ,IAE3BtJ,aAAc,SAAUsJ,GACtB,KAAMo1C,GAAO/xD,SAASqmC,cAAc,OACpC0rB,GAAKzxB,MAAM0xB,QAAU,OACrBD,EAAKt7C,OAAS,KACd,MAAMtQ,GAAM,gBAAkB7E,EAAQU,SAAW,wBAA0B2a,EAAUhX,EACrFosD,GAAKjuC,OAAS3d,EACdnG,SAASmgC,KAAK4L,YAAYgmB,GAC1BA,EAAKhtC,SACL/kB,SAASmgC,KAAK2X,YAAYia,KAGvBjV,KACNpwC,QAAQ,iBAAkB,UAAW,YAAa,KAAM,SAAUnL,EAAS6I,EAAW7G,GAIvF,QAAS0uD,GAAU9rD,GACjB,GAAI+rD,GAAW3uD,EAAG2X,QACdy1C,EAAQ,GAAIpvD,GAAQ4wD,KAaxB,OAZAhsD,GAAMA,EAAIuB,QAAQ,IAAK,KACvBipD,EAAMlqB,iBAAiB,QAAS,SAAUj6B,GACxC7N,QAAQiI,IAAI,MAAO4F,GACnB0lD,EAAS/2C,WAEXw1C,EAAMlqB,iBAAiB,YAAa,WAClCyrB,EAAStuD,QAAQ+sD,KAGnBpvD,EAAQuS,WAAW,WACjB68C,EAAMh0B,IAAMx2B,GACX,GACI+rD,EAAS92C,QAlBlB,GAqBIk0C,GAAgB,SAAUnpD,GACpB5C,EAAG2X,OACXpc,MAAKqH,IAAMA,EACXrH,KAAK2yD,uBACL3yD,KAAKszD,SAAWhoD,EAAUtL,KAAKuzD,oBAAoB1tD,KAAK7F,MAzBjC,IA0BvBA,KAAK4yD,aAAeO,EAAU9rD,GAAKpD,KAAK,SAAUuvD,GAChDxzD,KAAK6xD,MAAQ2B,EACbxzD,KAAK6xD,MAAMlqB,iBAAiB,UAAW,WACrC3nC,KAAKgkB,SAAWhkB,KAAK6xD,MAAM7tC,SAC3BhkB,KAAKyzD,OAASzzD,KAAK6xD,MAAM4B,OACzBzzD,KAAK69B,IAAM79B,KAAK6xD,MAAMh0B,IACtB79B,KAAK0zD,SAAU,GACf7tD,KAAK7F,OACPA,KAAK6xD,MAAMlqB,iBAAiB,QAAS,SAAUj6B,GAC7C1N,KAAK0zD,SAAU,EACf7zD,QAAQiI,IAAI4F,IACZ7H,KAAK7F,QACP6F,KAAK7F,MAAO,SAAUF,GACtBE,KAAKF,OAAQ,EACbD,QAAQiI,IAAI,8DACZjC,KAAK7F,OA4JT,OAzJAwwD,GAAcviD,WAqFZ8vC,KAAM,WAGJ,MADA/9C,MAAK6xD,MAAM9T,OACJ/9C,MAET2zD,SAAU,SAAUxjD,GAClBnQ,KAAK2yD,oBAAoBl1C,KAAKtN,IAEhC4uC,MAAO,WACL/+C,KAAK6xD,MAAM9S,SAEb6U,QAAS,WACP5zD,KAAK6xD,MAAM9S,QAEX/+C,KAAK6xD,MAAMG,YAAc,GAE3BhT,KAAM,WACJh/C,KAAK4zD,WAEPlC,QAAS,WACF1xD,KAAK6zD,YACR7zD,KAAK6zD,WAAY,GAGf7zD,KAAKsb,UACPtb,KAAKsb,QAAQqK,QACb3lB,KAAKsb,YAAU5Z,IAGb1B,KAAKszD,WACPhoD,EAAUK,OAAO3L,KAAKszD,UACtBtzD,KAAKszD,aAAW5xD,KAGpBoyD,UAAW,SAAUhC,GACnB9xD,KAAK+zD,cAAgBjC,EACrB9xD,KAAK8yD,OAAQ,EACb9yD,KAAK6xD,MAAMC,OAASA,GAEtBkC,gBAAiB,SAAUzjB,GACzBvwC,KAAK6xD,MAAMoC,aAAe1jB,GAE5B2jB,UAAW,SAAUC,GACnBn0D,KAAK8yD,MAAQqB,EACbn0D,KAAK6xD,MAAMC,QAAU9xD,KAAK8yD,MAAQ9yD,KAAK+zD,eAEzCK,YAAa,SAAUC,GACjBr0D,KAAK6xD,OAAS7xD,KAAK6xD,MAAM7tC,UAAYzB,SAAS8xC,KAChDr0D,KAAK6xD,MAAMG,YAAchyD,KAAK6xD,MAAM7tC,SAAWqwC,IAGnDzV,eAAgB,SAAUoT,GACpBhyD,KAAK6xD,OAAS7xD,KAAK6xD,MAAM7tC,WAC3BhkB,KAAK6xD,MAAMG,YAAcA,IAG7BuB,oBAAqB,WACfvzD,KAAK6xD,QACP7xD,KAAKgyD,YAAchyD,KAAK6xD,MAAMG,YAE1BhyD,KAAKgyD,aAAehyD,KAAKgkB,UAC3BhkB,KAAK2yD,oBAAoBjsD,QAAQ,SAAUqqB,GACzCA,EAAS/wB,WAMZwwD,KCtaTjxD,QAAQC,OAAO,qBAAsB,sBAAuB,aAAa4nB,UAAU,yBAAA,cAAA,WAAA,iBAAyB,SAAUktC,EAAatoC,EAAU6iC,GAC3I,OACExnC,SAAU,IACVze,SAAS,EACT4B,YAAa,0CACbid,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9B,GAAI6sC,KAAaD,EAAYhtC,EAAMktC,MAAMluD,OAAQghB,EAAMktC,MAAMluD,KACzDmuD,EAAYH,EAAYC,GAAcD,EAAYC,GAAYjuD,KAAO,IAEzE,IAAImuD,GAA0B,WAAbA,EACf,CAAA,GAAIC,GAAY,8BAAgCD,EAAY,OAC5C5F,GAAe6F,EAAW,SAAUC,GAClD,GAAIC,GAAW5oC,EAAS2oC,GAAWrtC,EACnCzS,GAAQ6X,OAAOkoC,EAAStoC,WAAW6W,kBCb7C5jC,QAAQC,OAAO,uBAAwB,gBAAgBO,SAAS,cAAe,WAC7E,GAAI80D,KACJ,QACEC,aAAc,SAAUC,GAEtB,MADAF,GAAWp3C,KAAKs3C,GACT/0D,MAETE,KAAM,WACJ,GAAIo0D,KAIJ,OAHAO,GAAWnuD,QAAQ,SAAUsuD,GAC3BV,EAAYU,EAAG1uD,MAAQ0uD,IAElBV,MAGVn0D,QAAQ,sBAAA,cAAA,cAAsB,SAAUm0D,EAAa57B,GACtD,GAAIu8B,GAAS,SAAUv1D,EAAQw1D,GAC7Bl1D,KAAKN,OAASA,EACdM,KAAKk1D,eAAiBA,EACtBl1D,KAAKiQ,QA2FP,OAxFAglD,GAAOhnD,WACL0pC,MAAO2c,EACPa,cAAe,SAAUZ,GACvB,GAAIa,GAAYp1D,KAAK23C,MAAM4c,EAE3B,IAAIa,EAAW,CACb,GAAIC,GAAc,YAElBA,GAAYpnD,UAAYmnD,CACxB,IAAIZ,GAAQ,GAAIa,EAEhB,IAAIb,EAAM/0D,YAAyC,gBAApB+0D,GAAM/0D,WAAwB,CAC3D,GAAI61D,GAAQ,qBAAqB/mD,KAAKimD,EAAM/0D,WAExC61D,KACFd,EAAMc,EAAM,GAAKA,EAAM,GAAK,cAAgB58B,EAAY48B,EAAM,IAC5D51D,OAAQM,KAAKN,OACbw1D,eAAgBl1D,KAAKk1D,kBAK3B,MAAOV,GAEP,MAAO,OAGXnzD,IAAK,WACH,IAAK,GAAIuT,GAAI+G,UAAWgH,EAAI,EAAG/iB,EAAIgV,EAAEvR,OAAQsf,EAAI/iB,IAAK+iB,EAAG,CACvD,GAAI4xC,GAAa3/C,EAAE+N,EAEf2xC,GAAYC,GACdv0D,KAAKiQ,KAAKwN,KAAKzd,KAAKm1D,cAAcZ,IAElC10D,QAAQ01D,KAAK,yBAA2BhB,EAAa,OAI3DiB,aAAc,SAAUC,EAASC,GAC/B,GAAID,YAAmBh6C,OAAO,CAG5B,IAAY,GAFFg6C,EAAQpqC,QAAQqqC,GAGxB,OAAO,MAEJ,IAAIA,GAAWD,EACpB,OAAO,CAGT,QAAO,GAETE,mBAAoB,SAAUC,GAC5B,GAAIC,GAAa71D,KAAKN,OAAOo2D,eACzBC,EAAS/1D,KAAKN,OAAOme,UAAY7d,KAAKN,OAAOme,UAAUvX,KAAOuvD,CAElE,QAAKD,KAEMA,EAAII,YAAch2D,KAAKN,OAAOme,eAE9B+3C,EAAItvD,OAAStG,KAAKw1D,aAAaI,EAAItvD,KAAMyvD,QAEzCH,EAAIC,aAAe71D,KAAKw1D,aAAaI,EAAIC,WAAYA,OAErDD,EAAIK,OAASL,EAAIK,KAAKj2D,KAAKN,YAMxCw2D,gBAAiB,SAAUtmB,GACzB,QAAIA,EAAEsmB,kBAAoBtmB,EAAEsmB,gBAAgBx2D,YAEhCM,KAAK21D,mBAAmB/lB,EAAE/kB,UAMxCsrC,oBAAqB,SAAUvmB,GAC7B,MAAO5vC,MAAK21D,mBAAmB/lB,EAAE/kB,UAAY+kB,EAAEnb,SAEjD2hC,gBAAiB,SAAUxmB,GACzB,OAAQA,EAAEsjB,UAAiC,IAAtBtjB,EAAEsjB,QAAQ7hC,SAEjCglC,oBAAqB,SAAUzmB,GAC7B,OAAQA,EAAEsjB,SAAWtjB,GAAKA,EAAEsjB,UAAqC,IAA1BtjB,EAAEsjB,QAAQoD,cAG9CrB,KACNl1D,SAAS,qBAAsB,WAChC,GAAIw2D,KACJ,QACEl1D,IAAK,SAAUiF,GAEb,MADAiwD,GAAmB94C,KAAKnX,GACjBtG,MAETE,KAAM,WACJ,MAAOq2D,GAAmBj5C,OAAO,SAAUC,EAAGi5C,GAE5C,MADAj5C,GAAEi5C,EAAIlwD,MAAQkwD,EACPj5C,WAIZ9d,WAAW,oBAAA,UAAoB,SAAU+C,GAC1C,GAAImuC,GAAO3wC,IACXwC,GAAQgW,WAAW,SAAUvI,GAC3B0gC,EAAK1gC,KAAOA,OAEb9P,QAAQ,sBAAA,WAAA,iBAAA,qBAAsB,SAAUkL,EAAUyyB,EAAgBy4B,GACnE,GAAIE,GAAS,WACXz2D,KAAK02D,QAAU,KACf12D,KAAK22D,OAAS,EACd32D,KAAK42D,OAAS,KACd52D,KAAKoN,QAuEP,OApEAqpD,GAAOxoD,WACLb,MAAO,WAKL,MAJApN,MAAKye,KAAO,KACZze,KAAK62D,OAAS,KACd72D,KAAK82D,OAAS,KACd92D,KAAK0M,OAAQ,EACN1M,MAET+2D,cAAe,WACb/2D,KAAKye,QACLze,KAAK62D,UACL72D,KAAK0M,OAAQ,GAEfsqD,iBAAkB,SAAUvuD,EAAG4G,GAC7B,GAAIrP,KAAKye,OAASze,KAAK0M,MAAO,CAC5B,GAAIoqD,IAAUruD,EAAG4G,EACjBrP,MAAK82D,OAASA,EACd92D,KAAKqQ,UAAUymD,MAGnBG,UAAW,SAAUxuD,EAAG4G,EAAGqnD,GACzBA,EAAUA,GAAW12D,KAAK02D,OAC1B,IAAIQ,GAAWl3D,KAAK62D,QAAU72D,KAAK62D,OAAOx2D,OAAO,SAAU82D,GACzD,GAAIC,IAAMD,EAAG,GAAK1uD,GAAKzI,KAAK22D,OACxBU,GAAMF,EAAG,GAAK9nD,GAAKrP,KAAK42D,MAE5B,OADSQ,GAAKA,EAAKC,EAAKA,GACXX,GAGXQ,IAAYA,EAAS7zD,OAAS,IAI7BrD,KAAKye,MACRze,KAAK+2D,gBAGH/2D,KAAK62D,OAAOxzD,OAAS,GACvBrD,KAAK62D,OAAOp5C,MAAMhV,EAAG4G,IAGvBrP,KAAKqQ,aAEPA,SAAU,SAAUinD,GAClB,GAAIC,GAAQv3D,KAAK62D,OAAOlxD,IAAI,SAAU8C,GACpC,MAAOA,GAAE,KAEP+uD,EAAQx3D,KAAK62D,OAAOlxD,IAAI,SAAU8C,GACpC,MAAOA,GAAE,IAGP6uD,KACFC,EAAM95C,KAAK7B,MAAM27C,EAAOD,EAAW3xD,IAAI,SAAU8C,GAC/C,MAAOA,GAAE,MAEX+uD,EAAM/5C,KAAK7B,MAAM47C,EAAOF,EAAW3xD,IAAI,SAAU8C,GAC/C,MAAOA,GAAE,OAIbzI,KAAKye,KAAKg5C,GAAK72D,KAAKy8B,IAAIzhB,MAAM,KAAM27C,GACpCv3D,KAAKye,KAAKi5C,GAAK92D,KAAKy8B,IAAIzhB,MAAM,KAAM47C,GACpCx3D,KAAKye,KAAKk5C,GAAK/2D,KAAK08B,IAAI1hB,MAAM,KAAM27C,GACpCv3D,KAAKye,KAAKm5C,GAAKh3D,KAAK08B,IAAI1hB,MAAM,KAAM47C,GACpCx3D,KAAK0M,MAAQ1M,KAAK62D,OAAOxzD,QAAU,IAGvCozD,EAAOxoD,UAAUogC,MAAQooB,EAAOxoD,UACzBwoD,KC9MTl3D,QAAQC,OAAO,2BAA4B,gBAAgB4nB,UAAU,yBAAA,YAAyB,SAAU1iB,GACtG,GAEImzD,GAAc,SAAUvwC,EAAOzS,EAASqK,GAC1C,GAAIsc,GAAM3mB,EAAQyX,SAAS,QACvBwrC,GAAiB,UAAW,UAAW,UAAW,OAAQ,UAAW,UACrEC,GACFC,cAAe,OAYjB,IATK94C,EAGHrK,EAAQoE,OAFRpE,EAAQuhB,OAKV9O,EAAMS,MAAQ,GACdT,EAAMka,SAEY,gBAAPtiB,GACTsc,EAAIlb,KAAKpB,GACToI,EAAMS,MAAQkwC,oBACT,CACL,GAAI3xD,GAAO4Y,EAAI5Y,KACXga,EAAOpB,EAAIoB,MAAQpB,EAAIA,IACvByiB,EAAQziB,EAAIyiB,OAAS,SACzBra,GAAM9f,UAAsB9F,KAAdwd,EAAI1X,MAAsB,GAAiB,EAAZ0X,EAAI1X,MAErC,iBAARlB,EACF5B,EAAUK,OAAOmzD,EAAqBl4D,MACpC6U,QAAS2mB,EACTlb,KAAMA,EACN5gB,OAAQ4nB,KAGVhhB,EAAO,SACPk1B,EAAIlb,KAAKA,IAGE,WAATqhB,GAAsBo2B,EAAuBzxD,KAC/Cq7B,EAAQo2B,EAAuBzxD,IAG7BwxD,EAAczsC,QAAQsW,IAAU,EAClCra,EAAMS,MA3CI,SA2CgB4Z,EAE1Bra,EAAMka,MAAM,oBAAsBG,IAKpCu2B,EAAsB,SAAUrjD,EAASyL,EAAM0L,EAAUtsB,GAC3DmV,EAAQ8X,QAAQD,OAAOV,EAAS,yBAAkC,EAAP1L,GAAY,2BAA2B5gB,IAGpG,0DACE2nB,SAAU,IACVC,OACEpI,IAAK,IACLi5C,UAAW,KACXC,UAAW,KACXC,QAAS,KAEXzvD,SAAS,EACT4B,YAAa,6CACbid,KAAM,SAAUH,EAAOzS,EAASiW,GAC9BxD,EAAMkB,OAAO,MAAO,SAAUtJ,GAC5B24C,EAAYvwC,EAAOzS,EAASqK,UCnEpC3f,QAAQC,OAAO,0BAA2B,sBAAuB,kBAAmB,aAAaW,QAAQ,iBAAkB,WACzH,MAAO,UAAUm4D,EAAWC,EAAK7sB,GAC/B,GAAIxpB,GACAs2C,EAAUD,EAAIzjD,KAAK,uBAEnB0jD,KACFt2C,EAAIwpB,EAAO8sB,IAGRt2C,IACHA,GACEgd,KAAM,EACNtF,IAAK,EACLhM,MAAO0qC,EAAU1qC,QACjBE,OAAQwqC,EAAUxqC,UAItB,IAII2qC,IAHKF,EAAI3qC,QACH2qC,EAAIzqC,SAEiC,EAA9ByqC,EAAIzjD,KAAK,oBACtB4jD,EAAcH,EAAIzjD,KAAK,oBACvB6jD,EAAgBJ,EAAIzjD,KAAK,0BAETpT,KAAhBg3D,EACFD,EAAav2C,EAAEgd,KAAOhd,EAAE0L,MAAQ2qC,EAAI3qC,SAAyB,EAAd8qC,OACpBh3D,KAAlBi3D,EACTF,EAAav2C,EAAEgd,MAAQhd,EAAE0L,MAAQ2qC,EAAI3qC,SAAW+qC,EAEhDF,GAAcv2C,EAAEgd,IAGlB,IAAI05B,GAAyC,EAA7BL,EAAIzjD,KAAK,kBACrB+jD,EAAeN,EAAIzjD,KAAK,qBACxBgkD,EAAgBP,EAAIzjD,KAAK,0BAERpT,KAAjBm3D,EACFD,EAAY12C,EAAE0X,IAAM1X,EAAE4L,OAASyqC,EAAIzqC,UAA2B,EAAf+qC,OACpBn3D,KAAlBo3D,EACTF,EAAY12C,EAAE0X,KAAO1X,EAAE4L,OAASyqC,EAAIzqC,UAAYgrC,EAEhDF,GAAa12C,EAAE0X,IAGjB2+B,EAAIv9B,KACFiE,SAAU,WACVC,KAAMt+B,KAAK6gC,MAAMg3B,EAAaH,EAAU/oB,cACxC3V,IAAKh5B,KAAK6gC,MAAMm3B,EAAYN,EAAU1/B,kBAGzCxR,UAAU,2BAAA,mBAAA,iBAA2B,SAAU4sB,EAAkB+kB,GAClE,OACE1xC,SAAU,IACV7c,YAAa,8CACb5B,SAAS,EACT6e,KAAM,SAAU/nB,EAAQivB,EAAU7D,GA8FhC,QAASkuC,GAASttB,EAAQxB,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,GAC1D,GAAI58B,GAASqP,EAAOkE,EAAEvT,WAClB68B,GACFC,gBAAiBjvB,EACjBosB,YAAapsB,EAAU5d,SAAS,0BAChC8sC,OAAQ/8B,EAAOhtB,GAAK66B,EAAU5d,SAAS,WACvC+sC,OAAQh9B,EAAO5zB,GAAKyhC,EAAU5d,SAAS,WACvCwP,OAAQO,EAAOP,QAAUoO,EAAU5d,SAAS,WAE9C1a,QAAOC,KAAKqnD,GAAYxyD,QAAQ,SAAUic,GACxC,GAAI22C,GAAYJ,EAAWv2C,EAE3B,IAAI22C,EAAW,CACb,GAAIC,GAAMD,EACNE,EAAK9tB,EAAOkE,EAAEjtB,EAEd62C,GAAGx+B,KACLu+B,EAAIv+B,IAAIw+B,EAAGx+B,KAGTw+B,EAAG1kD,MACLykD,EAAIzkD,KAAK0kD,EAAG1kD,SAKdunB,EAAO5zB,GACTgxD,EAAc/tB,GAGZrP,EAAOhtB,GACTqqD,EAAchuB,GAGZrP,EAAOP,QACT69B,EAAejuB,GAGbutB,IACFtqC,EAASiK,UAAUh4B,KAAKy8B,IAAIqO,EAAOkE,EAAEgqB,cAAchgC,IAAK8R,EAAOkE,EAAE0mB,YAAYt7B,IAAIlN,OAAS4d,EAAOmuB,SAAS/rC,SAC1Ga,EAAS4gB,WAAW3uC,KAAKy8B,IAAIqO,EAAOkE,EAAEgqB,cAAc16B,KAAMwM,EAAOkE,EAAE0mB,YAAYt7B,IAAIpN,MAAQ8d,EAAOmuB,SAASjsC,SAG7GluB,EAAOo6D,cAGT,QAASL,GAAc/tB,GACrB,GAAIquB,GAAYhgC,GAAG/M,OAAO2B,EAASrC,SAAS,WAAWK,QAAQ,IAC3DqtC,EAAStuB,EAAO4qB,YAAYxoC,OAC5BuO,EAASqP,EAAOkE,EAAEvT,OAClBs6B,EAASjrB,EAAOkE,EAAE3T,MAAMxzB,CAC5BsxD,GAAUv4B,MAAM,SAAU,KAC1Bu4B,EAAUv4B,MAAM,QAAS,QACzBu4B,EAAUrtC,OAAO,QAAQ5X,MACvBiT,MAAO,KACPtf,EAAG,EACH4G,EAAG,EACHue,MAAO8d,EAAOkE,EAAEypB,OAAOvkD,KAAK8Y,MAC5BE,OAAQksC,EAASC,EAAW1lB,YAE9BwlB,EAAUrtC,OAAO,KAAK5X,KAAK,QAAS,QAAQA,KAAK,YAAa,aAAemlD,EAAW1lB,UAAY,QAAQ74B,KAAKw+C,EAAU79B,EAAO5zB,EAAGkuD,EAAQ,WAG/I,QAAS+C,GAAchuB,GACrB,GAAIyuB,GAAYpgC,GAAG/M,OAAO2B,EAASrC,SAAS,WAAWK,QAAQ,IAC3DqtC,EAAStuB,EAAO4qB,YAAYxoC,OAC5BuO,EAASqP,EAAOkE,EAAEvT,OAClBu6B,EAASlrB,EAAOkE,EAAE3T,MAAM5sB;mGAC5B8qD,GAAU34B,MAAM,QAAS,IACzB24B,EAAU34B,MAAM,QAAS,QACzB24B,EAAUztC,OAAO,QAAQ5X,MACvBiT,MAAO,KACPtf,EAAG,EACH4G,EAAG,EACHue,MAAO8d,EAAOkE,EAAEwpB,OAAOtkD,KAAK8Y,MAAQ,EACpCE,OAAQksC,EAASC,EAAW1lB,UAAY,IAE1C4lB,EAAUztC,OAAO,QAAQ5X,MACvBiT,MAAO,KACPtf,EAAG,EACH4G,EAAG,EACHue,MAAO8d,EAAOkE,EAAEwpB,OAAOtkD,KAAK8Y,MAAQqsC,EAAW1lB,UAC/CzmB,OAAQksC,EAASC,EAAW1lB,UAAY0lB,EAAW9lB,aAErDgmB,EAAUztC,OAAO,KAAK5X,KAAK,QAAS,QAAQA,KAAK,YAAa,aAAemlD,EAAW/lB,WAAa,KAAO+lB,EAAW1lB,UAAY,KAAK74B,KAAKw+C,EAAU79B,EAAOhtB,EAAGunD,EAAQ,SAG3K,QAAS+C,GAAejuB,GACtB,GAAI0uB,GAAYrgC,GAAG/M,OAAO2B,EAASrC,SAAS,WAAWK,QAAQ,IAC3DqtC,EAAStuB,EAAO4qB,YAAYxoC,OAC5BuO,EAASqP,EAAOkE,EAAEvT,MACtB+9B,GAAU1tC,OAAO,QAAQ5X,MACvBiT,MAAO,KACPtf,EAAGwxD,EAAW1lB,UACdllC,EAAG,EACHue,MAAO8d,EAAOkE,EAAE9T,OAAOhnB,KAAK8Y,MAC5BE,OAAQ4d,EAAOkE,EAAE9T,OAAOhnB,KAAKgZ,SAE/BssC,EAAU1tC,OAAO,SAAS5X,MACxBiT,MAAO,eACPtf,EAAGwxD,EAAW7lB,cACd/kC,EAAG4qD,EAAW1lB,UACd3mB,MAAOqsC,EAAW5lB,aAAe4lB,EAAW7lB,cAC5CtmB,OAAQksC,EACRK,oBAAqB,OACrBC,aAAcj+B,EAAOP,OAAO+B,MAE9Bu8B,EAAU1tC,OAAO,QAAQ5X,MACvBiT,MAAO,SACPtf,EAAGwxD,EAAW7lB,cACd/kC,EAAG4qD,EAAW1lB,UACd3mB,MAAOqsC,EAAW5lB,aAAe4lB,EAAW7lB,cAC5CtmB,OAAQksC,IAEVI,EAAU1tC,OAAO,KAAK5X,KAAK,QAAS,QAAQA,KAAK,YAAa,aAAemlD,EAAW7lB,cAAgB,MAAQ6lB,EAAW1lB,UAAY,GAAK,KAAK74B,KAAKw+C,EAAU79B,EAAOP,OAAQ4P,EAAOkE,EAAE3T,MAAMH,OAAQ,SA/MxM,GAAIm+B,GAAav6D,EAAOgsC,OAAO6uB,GAEnB5rC,GAASrC,SAAS,yBAG9B5sB,GAAO86D,UAAY,SAAU56D,GAC3BF,EAAOgsC,OAAO0tB,OAAOl6B,KAAOvQ,EAAS4gB,aACrC5gB,EAASrC,SAAS,WAAW0O,KAC3BkE,KAAMx/B,EAAOgsC,OAAO0tB,OAAOl6B,KAAO,OAEpCx/B,EAAOgsC,OAAO2tB,OAAOz/B,IAAMh5B,KAAKy8B,IAAI39B,EAAOgsC,OAAO4qB,YAAY18B,IAAMl6B,EAAOgsC,OAAO4qB,YAAYxoC,OAAQa,EAASiK,YAAcjK,EAASb,SAAWmsC,EAAW9lB,YAC5JxlB,EAASrC,SAAS,WAAW0O,KAC3BpB,IAAKl6B,EAAOgsC,OAAO2tB,OAAOz/B,IAAM,QAIpCl6B,EAAOo6D,YAAc,SAAUl6D,GAC7B,GAAI8rC,GAAShsC,EAAOgsC,OAChB+uB,EAAU/uB,EAAO4qB,YAAYxoC,OAAS4d,EAAOmuB,SAAS/rC,OACtD4sC,EAAUhvB,EAAO4qB,YAAY1oC,MAAQ8d,EAAOmuB,SAASjsC,KAErDe,GAASiK,YAAc6hC,GACzB9rC,EAASiK,UAAU6hC,GAGjB9rC,EAAS4gB,aAAemrB,GAC1B/rC,EAAS4gB,WAAWmrB,GAGtBhvB,EAAOjtB,MACLk8C,IAAKhsC,EAAS4gB,aAAe7D,EAAO4qB,YAAYp3B,MAAQwM,EAAOzP,MAAM2+B,OACrEC,IAAKlsC,EAAS4gB,aAAe7D,EAAO4qB,YAAYp3B,KAAOvQ,EAASf,SAAW8d,EAAOzP,MAAM2+B,OACxFE,KAAMpvB,EAAO4qB,YAAY18B,IAAM8R,EAAO4qB,YAAYxoC,OAASa,EAASiK,YAAcjK,EAASb,UAAY4d,EAAOzP,MAAM8+B,MACpHC,KAAMtvB,EAAO4qB,YAAY18B,IAAM8R,EAAO4qB,YAAYxoC,OAASa,EAASiK,aAAe8S,EAAOzP,MAAM8+B,OAElGrvB,EAAO8V,QACLnsC,GAAIsZ,EAAS4gB,aAAe7D,EAAO4qB,YAAYp3B,KAAOvQ,EAASf,QAAU,GAAO8d,EAAOzP,MAAM2+B,OAC7FK,IAAKvvB,EAAO4qB,YAAY18B,IAAM8R,EAAO4qB,YAAYxoC,OAASa,EAASiK,YAAcjK,EAASb,SAAW,GAAO4d,EAAOzP,MAAM8+B,OAE3HrvB,EAAO0tB,OAAOl6B,KAAOvQ,EAAS4gB,aAC9B5gB,EAASrC,SAAS,WAAW0O,KAC3BkE,KAAMwM,EAAO0tB,OAAOl6B,KAAO,OAE7BwM,EAAO2tB,OAAOz/B,IAAMjL,EAASiK,YAAcjK,EAASb,SAAWmsC,EAAW9lB,WAAa8lB,EAAWhmB,OAClGtlB,EAASrC,SAAS,WAAW0O,KAC3BpB,IAAK8R,EAAO2tB,OAAOz/B,IAAM,EAAI,OAG3B8R,EAAO5P,SACT4P,EAAO5P,OAAOoD,KAAOvQ,EAAS4gB,aAAe5gB,EAASf,QAAUomB,EAAiBxE,WAAW5hB,MAAQqsC,EAAW5lB,aAAe4lB,EAAW3lB,cACzI3lB,EAASrC,SAAS,WAAW0O,KAC3BkE,KAAMwM,EAAO5P,OAAOoD,KAAO,QAI/BvQ,EAAS0D,KAAK,sCAAsC+M,KAAK,SAAUzc,EAAGkc,GACpEk6B,EAAepqC,EAAU2D,EAAEuM,GAAK6M,MAIpChsC,EAAOw7D,YAAc,SAAUt7D,GAC7B,GAAIu7D,GAAQxsC,EAASld,SACjBhJ,EAAI7I,EAAEunC,MAAQg0B,EAAMj8B,KAAOvQ,EAAS4gB,aAAe7vC,EAAOgsC,OAAO4qB,YAAYp3B,KAC7E7vB,EAAIzP,EAAEwnC,MAAQ+zB,EAAMvhC,IAAMjL,EAASiK,YAAcl5B,EAAOgsC,OAAO4qB,YAAY18B,GAC/EnxB,GAAI7H,KAAKy8B,IAAIz8B,KAAK08B,IAAI70B,EAAG,GAAI/I,EAAOgsC,OAAO4qB,YAAY1oC,OACvDve,EAAIzO,KAAKy8B,IAAIz8B,KAAK08B,IAAIjuB,EAAG,GAAI3P,EAAOgsC,OAAO4qB,YAAYxoC,QACvDpuB,EAAO07D,QAAQ3yD,EAAIA,EACnB/I,EAAO07D,QAAQ/rD,EAAIA,EACnB3P,EAAO07D,QAAQC,IAAM37D,EAAOgsC,OAAO4vB,MAAM7yD,GACzC/I,EAAO07D,QAAQH,GAAKv7D,EAAOgsC,OAAO6vB,KAAKlsD,GAGzC,IAAI6qD,GAAY,SAAU79B,EAAQJ,EAAO8X,GACvC,GAAIrT,GAAO3G,GAAG6B,IAAI8E,MAalB,OAXIrE,GAAOsE,OACTD,EAAKC,MAAMtE,EAAOsE,OAGhBtE,EAAOm/B,YACT96B,EAAK+6B,WAAWp/B,EAAOm/B,aACdn/B,EAAOq/B,aAChBh7B,EAAK+6B,WAAWp/B,EAAOq/B,aAGzBh7B,EAAKzE,MAAMA,GAAO4E,OAAOkT,GAClBrT,EAGThhC,GAAOgsC,OAAO6F,UAAU9zB,KAAK,SAAUiuB,EAAQxB,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,GAC/ED,EAASttB,EAAQxB,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,KAwHrDv5D,EAAOi8D,yBAA2B,WAChC,MAAOj8D,GAAOu+C,aAAa8T,kBAG7BryD,EAAO8oB,OAAO,WACZ,OACEmR,EAAKhL,EAASb,SACduX,EAAK1W,EAASf,UAEf,SAAUoiB,EAAU4rB,GACrBl8D,EAAOgsC,OAAO9vB,MAAM+S,EAAUjvB,EAAQswC,EAAS3K,EAAG2K,EAASrW,GAAG,KAC7D,GACHj6B,EAAO8oB,OAAO,WACZ,MAAO9oB,GAAOgsC,OAAOzP,MAAM2+B,OAASl7D,EAAOi8D,2BAA6B,GACvE,SAAU3rB,EAAU4rB,GACrB,GAAIl8D,EAAOu+C,aAAa2S,WAAY,CAClC,GAAIiL,GAAM5B,EAAW/lB,WAAalE,EAC9B8rB,EAAKntC,EAAS4gB,aACdwsB,EAAMD,EAAKntC,EAASf,QAAU,EAC9BwpC,EAAKyE,EAAME,CAEX3E,GAAK,GACPzoC,EAAS4gB,WAAWusB,EAAK1E,MAG5B,GACH13D,EAAO8oB,OAAO,YAAa,SAAUwnB,EAAU4rB,GAC7CjtC,EAAS4gB,WAAW,GACpB5gB,EAASiK,UAAU,QACnBl5B,EAAOgsC,OAAO9vB,MAAM+S,EAAUjvB,EAAQivB,EAASf,QAASe,EAASb,YAChE,GACHa,EAAS9oB,KAAK,SAAU,WACtBnG,EAAOmsB,WAETnsB,EAAO8oB,OAAO,sBAAuB,SAAUwnB,EAAU4rB,GACvDl8D,EAAOgsC,OAAO9vB,MAAM+S,EAAUjvB,EAAQivB,EAASf,QAASe,EAASb,UAAU,KAE7EpuB,EAAO8oB,OAAO,sBAAuB,SAAUwnB,EAAU4rB,GACvDl8D,EAAOgsC,OAAO9vB,MAAM+S,EAAUjvB,EAAQivB,EAASf,QAASe,EAASb,UAAU,KAE7EpuB,EAAO8oB,OAAO,6BAA8B,SAAUwnB,EAAU4rB,GAC9Dl8D,EAAOgsC,OAAO9vB,MAAM+S,EAAUjvB,EAAQivB,EAASf,QAASe,EAASb,UAAU,KAE7EpuB,EAAOgsC,OAAO9vB,MAAM+S,EAAUjvB,EAAQivB,EAASf,QAASe,EAASb,UACjEpuB,EAAOo6D,mBAGV1yC,UAAU,gCAAA,cAAA,WAAA,iBAAgC,SAAUktC,EAAatoC,EAAU6iC,GAC5E,OACExnC,SAAU,IACV7c,YAAa,iDACb5B,SAAS,EACT6e,KAAM,SAAUH,EAAOzS,EAAS6S,GAE9B,GAAI6sC,KAAaD,EAAYhtC,EAAMktC,MAAMluD,OAAQghB,EAAMktC,MAAMluD,KACzDmuD,EAAYH,EAAYC,GAAcD,EAAYC,GAAYjuD,KAAO,IAGzE,IAFAuO,EAAQsF,SAASo6C,GAEbE,GAA0B,WAAbA,EACf,CAAA,GAAIC,GAAY,qCAAuCD,EAAY,OACnD5F,GAAe6F,EAAW,SAAUC,GAClD,GAAIC,GAAW5oC,EAAS2oC,GAAWrtC,EACnCzS,GAAQ6X,OAAOkoC,WAKtBxtC,UAAU,kCAAA,iBAAA,YAAkC,SAAU2xC,EAAgB5zB,GACvE,OACE9d,SAAU,IACVI,KAAM,SAAU/nB,EAAQivB,EAAU7D,GAChC6D,EAASxU,SAAS,oCAClB,IAAI6hD,GAAQrtC,EAASwH,QAAQ,oBACzB8lC,EAASttC,EAASld,SAClByqD,EAAQF,EAAMvqD,QAEdyqD,SACuCx6D,KAArCitB,EAAS7Z,KAAK,oBAChB6Z,EAAS7Z,KAAK,kBAAmBmnD,EAAO/8B,KAAOg9B,EAAMh9B,UAGfx9B,KAApCitB,EAAS7Z,KAAK,mBAChB6Z,EAAS7Z,KAAK,iBAAkBmnD,EAAOriC,IAAMsiC,EAAMtiC,MAInD9O,EAAOqxC,iCACTz8D,EAAO8oB,OAAOsC,EAAOqxC,+BAAgC,SAAUC,EAAQC,GACrE,GAAI15C,EAEJ,IAAI05C,EACF,IAAK15C,IAAK05C,GACR1tC,EAAS7Z,KAAK,cAAgB6N,EAAG,KAIrC,IAAIy5C,EACF,IAAKz5C,IAAKy5C,GACRztC,EAAS7Z,KAAK,cAAgB6N,EAAGy5C,EAAOz5C,MAI9Co2C,EAAepqC,EAASoQ,eAAgBpQ,EAAUjvB,EAAOgsC,SAG3DqtB,EAAepqC,EAASoQ,eAAgBpQ,EAAUjvB,EAAOgsC,QACzDhsC,EAAO8oB,OAAO,WACZ,MAAOmG,GAASf,QAAUe,EAASb,UAClCqX,EAAU,WACX4zB,EAAepqC,EAASoQ,eAAgBpQ,EAAUjvB,EAAOgsC,gBCzXjEnsC,QAAQC,OAAO,uBAAwB,WAAY,gBAAgB4nB,UAAU,sBAAA,UAAA,eAAA,SAAA,UAAsB,SAAU5kB,EAAS9B,EAAcC,EAAQkpB,GAE1I,OACExC,SAAU,IACVC,OACElQ,UAAW,cAEb5M,YAAa,sCACbid,KAAM,SAAU/nB,EAAQivB,EAAU7D,GAChC,GAAIwxC,GAAY,SAAUC,GACxB,GAAI3lD,EAUJ,QAPEA,EADE,gBAAgB8F,WAAY6/C,IACxB78D,EAAO4nD,QAAQjnD,OAAO,SAAUm8D,GACpC,MAAOA,GAAG31D,IAAM01D,IACfhoC,QAEGgoC,KAGO3lD,EAAItS,QAASsS,EAAIi7B,UAAUpiC,KAAK,MAG7CgtD,EAAiB,SAAUxqD,GAC7B,GAAI5P,IAAO4P,EAAW3N,QAAS2N,EAAW4/B,UAAUpiC,KAAK,KACrDitD,EAAU9qD,OAAO8vB,QACnBg7B,QAASzqD,EAAWyqD,QACpBC,cAAe1qD,EAAW0qD,cAC1BC,WAAY3qD,EAAW2qD,YAEzBl9D,GAAO4rD,YAAYjpD,GAAOq6D,GAGxBG,EAAuB,WACzBr6D,EAAQgW,WAAW,SAAU8uC,GAC3B5nD,EAAO4nD,QAAUA,CAGjB,KAAK,GAFDwV,MAEKn6C,EAAI,EAAGA,EAAI2kC,EAAQjkD,OAAQsf,IAAK,CACvC,GAAIwqC,GAAI7F,EAAQ3kC,EACXm6C,GAAO3P,EAAE4P,SAAQD,EAAO3P,EAAE4P,WAC/BD,EAAO3P,EAAE4P,OAAOt/C,KAAK0vC,GAGvB,IAAK,GAAIp3C,KAAK+mD,GACZA,EAAO/mD,GAAK8T,EAAQ,WAAWizC,EAAO/mD,IAAK,eAAgB,iBAG7DrW,GAAOs9D,QAAUF,EACjBp9D,EAAOo9D,OAASlrD,OAAOC,KAAKnS,EAAOs9D,SAASznC,SAIhD71B,GAAOmB,IAAI,eAAgBg8D,GAC3Bn9D,EAAO4nD,WACP5nD,EAAOu9D,eAEPv9D,EAAOstB,OAAS,SAAU+vC,EAAOR,EAAe/vD,GAC9C,IAAI8lB,EAAE9lB,EAAO2e,QAAQoU,GAAG,KAIxB,GAAI/yB,EAAOwoB,SAAU,CACnBt1B,EAAOu9D,YAAYV,EAAc11D,KAAM,CACvC,IAAIq2D,IACF1gD,KAAM2gD,EAAAA,EACNr8D,IAAKq8D,EAAAA,GAEHC,EAAe19D,EAAOs9D,QAAQD,EAClCK,GAAa12D,QAAQ,SAAU81D,EAAI3sB,GAC7BnwC,EAAOu9D,YAAYT,EAAG31D,MACxBq2D,EAAU1gD,KAAO5b,KAAKy8B,IAAI6/B,EAAU1gD,KAAMqzB,GAC1CqtB,EAAUp8D,GAAKF,KAAK08B,IAAI4/B,EAAUp8D,GAAI+uC,KAI1C,KAAK,GAAIwtB,GAAKH,EAAU1gD,KAAM8gD,EAAKJ,EAAUp8D,GAAK,EAAGu8D,EAAKC,IAAMD,EAC9D39D,EAAOu9D,YAAYG,EAAaC,GAAIx2D,KAAM,MAEnC2F,GAAO+wD,QAChB79D,EAAOu9D,YAAYV,EAAc11D,KAAOnH,EAAOu9D,YAAYV,EAAc11D,KAEzEnH,EAAOu9D,eACPv9D,EAAOu9D,YAAYV,EAAc11D,KAAM,IAI3CnH,EAAO4rD,eAEP5rD,EAAO2Q,SAAW,SAAUuS,GAC1B,IAAKliB,EAAa6C,IAAI,oBAEpB,WADA5C,GAAOb,MAAM,iDAIf,IAEI4yD,GAFA7gD,KACA2rD,IAQJ,KAAK,GAAIC,KAAa/9D,GAAOu9D,YACvBv9D,EAAOu9D,YAAYQ,KACrB/K,EAAI4J,EAAUmB,MAEJD,EAAQ9K,KAChB8K,EAAQ9K,IAAK,EACb7gD,EAAK4L,KAAKi1C,GAKZ7gD,GAAKxO,OAAS,GAChBb,EAAQuX,kBAAkBra,EAAO0X,UAAUvQ,IACzCkhB,MAASlW,EAAKpC,KAAK,KACnBmT,IAAKA,EACL86C,eAAgB,cACf,SAAUpS,GACXA,EAAY5kD,QAAQ,SAAUuL,GAC5B,GAAI5P,GAAMi6D,EAAUrqD,EAEE,IAAlBA,EAAW2Q,UACNljB,GAAO4rD,YAAYjpD,GAE1B3C,EAAO4rD,YAAYjpD,GAAOuP,OAAO8vB,QAC/Bg7B,QAASzqD,EAAW2Q,IACpB+5C,cAAe,SAQ3Bj9D,EAAO6sC,cACLD,MAAO,QACP1pB,IAAK,IAEL0pB,MAAO,UACP1pB,IAAK,IAEL0pB,MAAO,SACP1pB,IAAK,IAGPljB,EAAOi+D,UAAY,SAAUpB,EAAehwB,GACrCA,IACHA,EAAc7sC,EAAO6sC,YAGvB,IAAIlqC,GAAMi6D,EAAUC,GAChB35C,EAAMljB,EAAO4rD,YAAYjpD,EAE7B,YAAmB,KAARugB,MACT,GAEc,GAAVA,EAAI,IAAWA,EAAI,GAAK,GAAKA,EAAI,GAAK,GACxC2pB,EAAY,GAAGqxB,aAAeh7C,EAAI,GAAK,GAAKA,EAAI,GAAK,EAC9C2pB,EAAY,IAGP,MAAV3pB,EAAI,IAAwB,GAAVA,EAAI,IAAqB,GAAVA,EAAI,OACvC,GAEO2pB,EAAY,IAKzB7sC,EAAO8oB,OAAO,YAAa,SAAUpR,GACnC1X,EAAO4rD,eAEHl0C,GAAaA,EAAUk0C,aACzBl0C,EAAUk0C,YAAY5kD,QAAQ+1D,KAGlCI,SC7KNt9D,QAAQC,OAAO,sCAAuC4nB,UAAU,oBAAqB,WACnF,OACEC,SAAU,IACVw2C,YAAY,EACZrzD,YAAa,0CACb8c,OACEw2C,OAAQ,MAEVr2C,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9B7S,EAAQsF,SAAS,gBAGjBmN,EAAMy2C,cAAgB,WACpBz2C,EAAMw2C,QAAUx2C,EAAMw2C,YCV9Bv+D,QAAQC,OAAO,iBAAkB,YAAa,sBAAuB,cAAe,WAAY,gBAAiB,uBAAwB,uBAAwB,sBAAuB,oBAAqB,kCAAmC,wCAAyC,wCAAyC,wCAAyC,uCAAwC,kCAAmC,wDAAyD,sCAAuC,wCAAyC,mCAAoC,mDAAoD,qCAAsC,iCAAkC,0CAA2C,yBAA0B,sBAAuB,6BAA8B,mCAAoC,uCAAwC,wBAAyB,iBAO77BqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAChCo1C,EAAeC,MAAM,cACnB9vC,IAAK,cACLo1C,OACEuhB,YACEv+D,WAAY,iBACZ+K,YAAa,8BAGjBu1C,mBAAmB,EACnBC,QAAQ,IACP7I,MAAM,mBACP9vC,IAAK,+CACLtG,QACEuF,KAAM,GACNsO,EAAG,KACHqpD,SAAU,KACVnf,KAAM,KACNz+C,OAAQ,KACR69D,KACE71D,MAAO,GACP81D,QAAQ,GAEVC,KACE/1D,MAAO,KACP81D,QAAQ,GAEVE,KACEh2D,MAAO,KACP81D,QAAQ,IAGZ1+D,YAAA,SAAA,SAAY,SAAUE,EAAQD,GAC5B,GAAIiH,GAAIhH,EAAOoB,OACXu9D,GAAM33D,EAAEL,KAERK,GAAEu3D,MACJI,EAAG7gD,KAAK9W,EAAEu3D,KAENv3D,EAAEy3D,MACJE,EAAG7gD,KAAK9W,EAAEy3D,KAENz3D,EAAE03D,KACJC,EAAG7gD,KAAK9W,EAAE03D,MAKhB,IAAIzuB,GAAI0uB,EAAG7uD,KAAK,IAChB/P,GAAOgE,SAAS66D,uBAAuB,WACrC7+D,EAAO8zB,QAAQiG,WAAW,uBAAwBmW,EAAGjpC,EAAEiO,GAExC,QAAXjO,EAAEL,MACJ5G,EAAO8zB,QAAQiG,WAAW,0BAA2B9yB,EAAEu3D,IAAMt8B,OAAOj7B,EAAEu3D,KAAO,KAAMv3D,EAAEiO,EAAIjO,EAAEiO,EAAI,QAI/FlV,EAAO8+D,kBACT9+D,EAAO8+D,iBAAiB73D,EAAEiO,oBAI/B,eAAU,WACX,OACEyS,SAAU,IACVze,SAAS,EACT0e,SACA7nB,WAAY,iBACZ+K,YAAa,+BAEdrK,QAAQ,+BAAA,YAA+B,SAAU0N,GAClD,GAAI4wD,GAAS,SAAUn3C,EAAOtZ,EAAQmpC,GACpCn3C,KAAKsnB,MAAQA,EACbtnB,KAAKm3C,MAAQA,EACbn3C,KAAKgO,OAASA,EACdhO,KAAK0kD,QAAU,GACf1kD,KAAK0+D,WAAa,GA4EpB,OAzEAD,GAAOxwD,WACL0wD,KAAM,WACA3+D,KAAK0kD,SAAW1kD,KAAK0+D,aAIzB1+D,KAAK0+D,WAAa1+D,KAAK0kD,QACvB1kD,KAAKsnB,MAAMmS,WAAW,uBAAwBz5B,KAAK0kD,WAErDka,YAAa,WACX5+D,KAAKw0C,IAAIx0C,KAAK0kD,UAEhBma,aAAc,SAAU99D,GACtB,GAAI+9D,GAAav/D,QAAQyL,UAAWhL,KAAKm3C,MAAMp2C,OAE/C,KAAK,GAAI0xD,KAAM1xD,GAAQ,CACrB,GAAIg+D,GAAKh+D,EAAO0xD,OAEL/wD,KAAPq9D,QACKD,GAAWrM,GAElBqM,EAAWrM,GAAMsM,EAIrBl/D,QAAQiI,IAAIg3D,EAAY9+D,KAAKm3C,MAAMuN,QAAQ1jD,MAC3ChB,KAAKm3C,MAAMsN,aAAazkD,KAAKm3C,MAAMuN,QAAQ1jD,KAAM89D,GAC/Cn+D,QAAQ,KAGZ6zC,IAAK,SAAU9wC,EAAUs7D,GAKvB,GAJIA,IACFh/D,KAAK0+D,WAAah7D,GAGhBmK,EAAU9E,QAAU/I,KAAKgO,OAAStK,EAAU,CAC9C7D,QAAQiI,IAAI,4CAA6C9H,KAAKgO,OAAStK,EAAUs7D,EACjF,IAAIh2D,GAAS6E,EAAU7E,eAChBA,GAAO4L,EACd/G,EAAU9E,KAAK/I,KAAKgO,OAAStK,GAC7BmK,EAAU7E,OAAOA,KAGrBi2D,aAAc,SAAUl2D,OACTrH,KAATqH,IACFA,EAAO8E,EAAU9E,QAGnBA,EAAO,GAAKA,EAEsB,IAA9BA,EAAKsiB,QAAQrrB,KAAKgO,UACpBhO,KAAK0kD,QAAU37C,EAAKoiC,OAAOnrC,KAAKgO,OAAO3K,UAG3Ck7D,uBAAwB,SAAUpuD,GAC5BnQ,KAAKk/D,iBACP/uD,KAECnQ,KAAKm/D,yBAA2Bn/D,KAAKm/D,4BAA8B1hD,KAAKtN,IAG7EivD,uBAAwB,WACtBp/D,KAAKk/D,kBAAmB,EAEpBl/D,KAAKm/D,yBACPn/D,KAAKm/D,uBAAuBz4D,QAAQ,SAAUyJ,GAC5CA,YAGKnQ,MAAKm/D,0BAIXV,KACNh/D,WAAW,kBAAA,qBAAA,KAAA,YAAA,SAAA,SAAA,gBAAA,WAAA,gBAAA,UAAA,cAAA,eAAA,0BAAA,aAAA,wBAAA,mBAAA,gBAAA,8BAAA,iBAAkB,SAAU4/D,EAAoB56D,EAAIoJ,EAAWlO,EAAQD,EAAQ6E,EAAe8G,EAAUi0D,EAAe98D,EAASk2B,EAAah4B,EAAc6+D,EAAyB/+D,EAAYg/D,EAAuBC,EAAkBzhB,EAAe0hB,EAA6BnvC,GACjS,GAAIE,GAAS,GAAIF,EACjBvwB,MAAK8wB,GAAKL,EAAOK,GAAGjrB,KAAK4qB,GACzBzwB,KAAKgxB,IAAMP,EAAOO,IAAInrB,KAAK4qB,EAC3B,IAAIwkC,GAAS,GAAIoK,GAAmB3/D,EAAQM,MAExC2/D,GADc1K,EAAOtd,OAEvBmH,KAAMn/C,EAAOoB,OAAO+9C,KACpBz+C,OAAQV,EAAOoB,OAAOV,QAGxBX,GAAO8+D,iBAAmB,SAAUoB,GAClClgE,EAAOmgE,YAAcD,GAAqBnkD,MAAMuzB,QAAQ4wB,GAAqBA,EAAoBA,EAAkBl3D,MAAM,MAAM/C,IAAI,SAAUwB,GAC3I,GAAI24D,GAAQ34D,EAAKuB,MAAM,KACnBq3D,GACFz5D,KAAMw5D,EAAMvrC,QACZlsB,SAYF,OAVAy3D,GAAMp5D,QAAQ,SAAUs5D,GACtB,GAAIC,GAAOD,EAAKt3D,MAAM,IAEtB,IAAIu3D,EAAK58D,OAAS,EAAG,CACnB,GAAIhB,GAAM49D,EAAK1rC,OACfwrC,GAAO19D,GAAO49D,EAAK,GAAGxwD,KAAK,SAE3BswD,GAAO13D,MAAMoV,KAAKuiD,KAGfD,QAKPpgE,EAAOoB,OAAOk9D,UAChB15D,EAAce,QAAQ,6BAA8B3F,EAAOoB,OAAOm9D,KAGpEx+D,EAAO8+D,iBAAiB7+D,EAAOoB,OAAO6T,GACtClV,EAAOu1D,OAASA,EAAOhlD,KAEvBvQ,EAAOwgE,SAAWjL,EAAO5zD,IAAIwE,KAAKovD,GAClCv1D,EAAOygE,sBAAwBlL,EAAOU,mBAAmB9vD,KAAKovD,GAC9Dv1D,EAAO0gE,iBAAmBnL,EAAOiB,gBAAgBrwD,KAAKovD,GACtDv1D,EAAO2gE,qBAAuBpL,EAAOkB,oBAAoBtwD,KAAKovD,GAC9Dv1D,EAAO4gE,oBAAsBrL,EAAOmB,gBAAgBvwD,KAAKovD,GACzDv1D,EAAO6gE,wBAA0BtL,EAAOoB,oBAAoBxwD,KAAKovD,GAE7Dv0D,EAAa0C,KAAmC,IAA5B1C,EAAa0C,IAAIC,QAAgB3C,EAAa0C,IAAIE,SAAS,qCAAuC5C,EAAa6C,IAAI,oBAAsB7C,EAAa8C,UAC5KyxD,EAAO5zD,IAAI,mBAAoB,kBAAmB,YAAa,oBAE/D4zD,EAAO5zD,IAAI,mBAAoB,mBAAoB,kBAAmB,kBAAmB,uBAAwB,wBAAyB,2BAA4B,mCAAoC,mBAAoB,gBAAiB,YAAa,8BAA+B,mBAAoB,sBAGjT3B,EAAOme,UAAY,IACnB,IAAIna,GAAW,GAAIg8D,GAA4BhgE,EAAQ,eAAqBC,EAC5ED,GAAOgE,SAAWA,EAClBhE,EAAOqe,cACPre,EAAO8gE,aAAe98D,EAAS8wC,IAAI3uC,KAAKnC,GACxChE,EAAOgsC,OAAS,GAAI+zB,GACpB//D,EAAO+gE,WAAa,GAAIlB,GAAwB7/D,EAAOgsC,QACvDhsC,EAAOkB,KAAOA,KACdlB,EAAO07D,SACL3yD,EAAG,EACH4G,EAAG,EACHgsD,IAAK,EACLJ,GAAI,GAENv7D,EAAOs2D,UAAYsJ,EAAcxvB,KAAK,SAEtCpwC,EAAOghE,UAAY,WACjB,MAAOhhE,GAAOu1D,QAGhBv1D,EAAOihE,aAAe,SAAU9iD,EAAWvX,EAAM5C,GAC/C,IAAIhE,EAAOkhE,YAEX,MADAlhE,GAAOkhE,aAAc,EACdn8D,EAAGK,UAAUb,KAAK,WACvB,GAAI4Z,EAAW,CACbne,EAAOmhE,mBAAqBn9D,EAC5BhE,EAAOgE,SAAS8wC,IAAI9wC,GAAU,EAC9B,IAAIo9D,GAAmBtB,EAAsBuB,UAAUz6D,EAEvD,OADA5G,GAAOshE,kBAAoBF,EAAiBG,cAAcpjD,GACnDijD,EAAiBt+B,KAAK3kB,EAAWne,GAAQuE,KAAK,SAAU4Z,GAI7D,GAHAhe,QAAQiI,IAAI,sBAAuB+V,GACnCne,EAAO8zB,QAAQiG,WAAW,wBAAwB,GAE9Cl1B,EAAcY,QAAQ,gCAAkCxF,EAAOoB,OAAOm9D,IAAK,CAC7E,GAAI7M,GAAepsD,KAAKC,MAAMX,EAAcY,QAAQ,qBACpDtF,SAAQiI,IAAI,eAAgB9H,KAAKqxD,cAE7BA,GAAgBA,EAAa6P,OAASvhE,EAAOoB,OAAOq9D,KACtDp+D,KAAKw+D,iBAAiBnN,EAAa6P,MAAMvhE,EAAOoB,OAAOq9D,UAGzD1+D,GAAOyhE,yBACPnhE,KAAKw+D,iBAAiB3wD,EAAU7E,SAAS4L,EAG3ClV,GAAOshE,mBAAoB,EAC3BthE,EAAOme,UAAYA,EACnBne,EAAOo2D,eAAiBj4C,EAAUvX,KAClC5G,EAAO0hE,oBACPv7D,KAAK7F,OAEPN,EAAOme,UAAY,MAErBhY,KAAK7F,OAAOiE,KAAK,WACjBwsB,EAAOG,KAAK,YAAalxB,EAAOme,WAChCne,EAAOkhE,aAAc,KAIzBlhE,EAAOyhE,uBAAyB,WAC9B58D,EAAce,QAAQ,oBAAqB,MAC3Cf,EAAce,QAAQ,6BAA8B,MACpD3F,EAAOoB,OAAOk9D,SAAW,IAI3Bv+D,EAAO2hE,0BAA4B,WACjC,IACE,MAAOp8D,MAAKC,MAAMX,EAAcY,QAAQ,mCACtCm8D,eAAe,GAEjB,MAAO1hE,GACP,OACE0hE,eAAe,KAKrB5hE,EAAO6hE,yBAA2B,WAChC7hE,EAAO8hE,aAAa96D,QAAQ,SAAUS,GACpC,MAAOA,GAAKy+C,QAAS,KAIzBlmD,EAAO0hE,iBAAmB,WAExB1hE,EAAO+hE,WAAa/hE,EAAO2hE,4BAE3B3hE,EAAOgiE,eAAiBhiE,EAAOme,WAAane,EAAOme,UAAU8jD,UAAYjiE,EAAOme,UAAU8jD,SAAW,IAAO,IAE5GjiE,EAAO8hE,eACL39D,MAAO,eACPwE,MAAO,WACPu9C,QAAQ,IAER/hD,MAAO,mBAAqBnE,EAAOgiE,eAAiB,QACpDr5D,MAAO,iBACPu9C,QAAQ,IAGNlmD,EAAO+hE,aAAe/hE,EAAO+hE,WAAWH,eAAiB5hE,EAAOgiE,eAAiB,KACnFhiE,EAAO6hE,2BACP7hE,EAAO8hE,aAAa,GAAG5b,QAAS,GAI9BlmD,EAAOgiE,gBAAkB,KAC3BhiE,EAAO6hE,2BACP7hE,EAAO8hE,aAAa,GAAG5b,QAAS,IAIpClmD,EAAOkiE,aAAe,SAAUz6D,GAC9BzH,EAAO6hE,2BACPp6D,EAAKy+C,QAAS,CACd,IAAI0b,GAA+B,mBAAfn6D,EAAKkB,KACzB9D,GAAce,QAAQ,+BAAgCL,KAAKM,WACzD+7D,cAAeA,KAEjB5hE,EAAOgsC,OAAOzP,MAAMqlC,cAAgBA,CACpC,IAAIO,GAAOP,EAAgB5hE,EAAOme,UAAUikD,cAAgB,EAAI,IAChEpiE,GAAOme,UAAUwe,OAAOhtB,EAAEvO,GAAK+gE,EAC/BniE,EAAOme,UAAUwe,OAAOhtB,EAAEwyD,KAAOA,GAGnCniE,EAAOu+C,aAAe,GAAID,GAAct+C,EAAQigE,GAChDjgE,EAAOmB,IAAI,uBAAwB,SAAUoqB,EAAK3kB,GAChD5G,EAAOo2D,eAAiBxvD,IAE1B5G,EAAOmB,IAAI,oBAAqB,WAC9BnB,EAAOgE,SAAS07D,2BAElB5+D,EAAWK,IAAI,wBAAyB,WACtC,GAAI0O,GAAOkM,MAAMxN,UAAUtF,MAAM+S,KAAKC,UAAW,EACjDpM,GAAKyhC,QAAQ,kBACbtxC,EAAO+5B,WAAW7d,MAAMlc,EAAQ6P,KAElC7P,EAAOmB,IAAI,iBAAkB,SAAUgd,GACrCne,EAAOihE,aAAajhE,EAAOme,UAAWne,EAAOo2D,eAAgBp2D,EAAOmhE,yBAErExgE,OAAO,qBAAsB,WAC9B,MAAO,UAAUirD,GACf,IAAKA,EAAa,MAAO,EACzB,IAAI9jD,GAAQ,CAMZ,OALA8jD,GAAY5kD,QAAQ,SAAUuL,IACxBA,EAAW0qD,cAAgB,GAAK1qD,EAAW2qD,WAAa,GAA2B,GAAtB3qD,EAAWyqD,UAC1El1D,MAGGA,KAERnH,OAAO,oBAAqB,WAC7B,MAAO,UAAUirD,GACf,IAAKA,EAAa,MAAO,EACzB,IAAI9jD,GAAQ,CAMZ,OALA8jD,GAAY5kD,QAAQ,SAAUuL,GACI,GAA5BA,EAAW0qD,eAA+C,GAAzB1qD,EAAW2qD,YAAyC,GAAtB3qD,EAAWyqD,SAC5El1D,MAGGA,KAUXjI,QAAQC,OAAO,oCAAqC,YAAa,kBAAkBoO,QAAQ,yBAAA,YAAyB,SAAU+mC,GAC5H,MAAOA,MAQR/mC,QAAQ,oBAAA,mBAAA,YAAA,wBAAA,gBAAoB,SAAUomC,EAAkB+tB,EAAWC,EAAuBz9D,GACzF,GAAI09D,GAAoB,SAAUz8B,EAAMnJ,EAAQ6lC,GAC9C,OAAcxgE,KAAVwgE,GAAwB7lC,GAAWA,EAAO8lC,cAEvC,CACL,GAAI7Q,GAAIj1B,EAAO7f,MAAQ,EACnB4lD,EAAI/lC,EAAO8lC,aAEf,QADA38B,EAAO5kC,KAAKkoB,OAAO0c,EAAO8rB,GAAK8Q,GAAKA,EAAI9Q,GAC1B4Q,EAAQE,EALtB,MAAO58B,IASP68B,EAAa,SAAUxkD,GACzB,MAAOA,IAAaA,EAAUwe,SAC5B5zB,GACE+T,KAAM,EACN1b,GAAI,GACJ+gE,KAAM,GACNlhC,MAAO,GACP6E,KAAM,cAERn2B,GACEmN,KAAM,EACN1b,GAAI,MACJ+gE,KAAM,MACNr8B,KAAM,oBACNg2B,YAAa,SAAUt5C,GACrB,MAAOA,GAAI,IAAO,MAMtBogD,EAAa,SAAUjmC,EAAQC,GACjC,GAAIjnB,EAEJ,IAAIgnB,EAAOkmC,QAAS,CAClB,GAAIC,GAAKnmC,EAAOv7B,GAAKu7B,EAAO7f,KACxBimD,EAAKnmC,EAAM,GAAKA,EAAM,GACtBL,EAAQwmC,EAAKD,CACjBntD,GAAI0kB,GAAGkC,MAAMoE,SAAShE,QAAQA,EAAO7f,KAAM6f,EAAOv7B,KAAKw7B,OAAOL,EAAQ,EAAIK,EAAM,GAAIA,EAAM,GAAKL,EAAQ,QAEvG5mB,GAAI0kB,GAAGkC,MAAMoE,SAAShE,QAAQA,EAAO7f,KAAM6f,EAAOv7B,KAAKw7B,MAAMA,EAG/D,OAAOjnB,IAGLqtD,EAAqB,SAAUj6D,EAAGk6D,GACpC,GAAI/yB,GAAInnC,GAAKk6D,EAAOt/D,OAAS,GACzBiuD,EAAI1wD,KAAKkoB,MAAM8mB,GACfud,EAAIvsD,KAAKgoB,KAAKgnB,GACd95B,EAAI85B,EAAI0hB,CACZ,OAAOqR,GAAOrR,IAAM,EAAIx7C,GAAK6sD,EAAOxV,GAAKr3C,GAGvCyqB,EAAcmiC,CAClB,OAAOX,IACL/vB,YAAa,WACXhyC,KAAKi8B,OACH2mC,WAAY,IACZC,UAAW,IACXC,WAAY,IACZC,UAAW,IACX/7D,MACEyB,EAAG,EACH4G,EAAG,GAELurD,OAAQ,IACRG,MAAO,IACPuG,cAAe,MAEjBthE,KAAKyR,QACH4pD,IAAK,EACLJ,GAAI,GAENj7D,KAAKu6D,IAAMyH,EACXhiE,KAAKq8B,UACLr8B,KAAKuxC,cAEP+pB,MAAO,SAAU7yD,EAAGu6D,GAClB,GAAIC,GAAUx6D,EAAIzI,KAAKi8B,MAAM2+B,MAE7B,OADAqI,IAAWjjE,KAAKyR,OAAO4pD,IAChB4G,GAAmBgB,EAASjjE,KAAKq8B,OAAO5zB,EAAGu6D,IAEpDzH,KAAM,SAAUlsD,EAAG2zD,GACjB,GAAIrpC,GAAoD,GAA/C35B,KAAKs2D,aAAet2D,KAAKs2D,YAAYxoC,QAC1Co1C,GAASvpC,EAAItqB,GAAKrP,KAAKi8B,MAAM8+B,KAEjC,OADAmI,IAASljE,KAAKyR,OAAOwpD,GACdgH,GAAmBiB,EAAOljE,KAAKq8B,OAAOhtB,EAAG2zD,IAElDG,MAAO,SAAUF,EAASxhC,EAAOuhC,GAC/BC,EAAUhB,EAAkBgB,EAAUjjE,KAAKyR,OAAO4pD,IAAKr7D,KAAKq8B,OAAO5zB,EAAGu6D,EACtE,IAAIv6D,GAAIw6D,EAAUjjE,KAAKi8B,MAAM2+B,MAC7B,OAAOn5B,GAAY,EAAJh5B,GAASA,GAE1B26D,KAAM,SAAUF,EAAOzhC,EAAOuhC,GAC5BE,EAAQjB,EAAkBiB,EAAQljE,KAAKyR,OAAOwpD,GAAIj7D,KAAKq8B,OAAOhtB,EAAG2zD,EACjE,IAAIrpC,GAAoD,GAA/C35B,KAAKs2D,aAAet2D,KAAKs2D,YAAYxoC,QAC1Cze,EAAIsqB,EAAIupC,EAAQljE,KAAKi8B,MAAM8+B,KAC/B,OAAOt5B,GAAY,EAAJpyB,GAASA,GAE1Bg0D,WAAY,SAAUC,EAAUC,EAAU9hC,EAAO+hC,GAC3CA,IACFF,EAAWrB,EAAkBqB,EAAUtjE,KAAKq8B,OAAO5zB,EAAG,GAGxD,IAAI48B,IAAKi+B,EAAWC,GAAYvjE,KAAKi8B,MAAM2+B,MAC3C,OAAOn5B,GAAY,EAAJ4D,GAASA,GAE1Bo+B,WAAY,SAAU3I,EAAKE,EAAKv5B,EAAO+hC,GACjCA,IACF1I,EAAMmH,EAAkBnH,EAAK96D,KAAKq8B,OAAOhtB,EAAG,GAG9C,IAAIsqB,IAAKmhC,EAAME,GAAOh7D,KAAKi8B,MAAM8+B,KACjC,OAAOt5B,GAAY,EAAJ9H,GAASA,GAE1B/d,MAAO,SAAUsuB,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,GACjD,GAAIvtB,GAAShsC,EAAOme,WAAane,EAAOme,UAAU6tB,MAClD1rC,MAAKsG,KAAOolC,GAAU,cACtB1rC,KAAK,SAAWA,KAAKsG,MAAM4jC,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,EAE7D,KAAK,GAAIyK,GAAK1jE,KAAKuxC,UAAWoyB,EAAM,EAAGC,EAAMF,EAAGrgE,OAAQsgE,EAAMC,IAAOD,EACnED,EAAGC,GAAK3jE,KAAMkqC,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,IAGpD4K,kBAAmB,SAAU35B,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,GAC7D,GAAIgB,GAAaj6D,KAAKu6D,IAClB18C,EAAYne,EAAOme,UACnBwe,EAASr8B,KAAKq8B,OAASgmC,EAAWxkD,GAClCimD,EAAUl2C,EAAQqsC,EAAW/lB,WAAa+lB,EAAW1lB,SAErDlY,GAAOP,SACTgoC,GAAW7J,EAAW5lB,aAAe4lB,EAAW3lB,cAGlD,IAUIyvB,GAVAC,EAAUl2C,EAASmsC,EAAW9lB,WAAa8lB,EAAW1lB,UAAY0lB,EAAWhmB,OAE7EgwB,GADU/5B,EAAU,GAAGnc,aACP/tB,KAAKi8B,MAAMj1B,KAAKk9D,QAAUJ,EAAUznC,EAAO5zB,EAAEo5D,KAAM7hE,KAAKi8B,MAAM6mC,aAC9EqB,EAAgBnkE,KAAKi8B,MAAMj1B,KAAKo9D,QAAUJ,EAAU3nC,EAAOhtB,EAAEwyD,KAAM7hE,KAAKi8B,MAAM8mC,WAC9EsB,EAAc9jC,EAAYvgC,KAAKi8B,MAAMj1B,KAAKyB,EAAGw7D,GAC7CK,EAAa/jC,EAAYvgC,KAAKi8B,MAAMj1B,KAAKqI,EAAG80D,GAC5CI,EAAS3jE,KAAK08B,IAAIwmC,EAASljE,KAAKgoB,KAAKyT,EAAO5zB,EAAEo5D,KAAOwC,IACrDrK,EAASp5D,KAAK08B,IAAI0mC,EAASpjE,KAAKgoB,KAAKyT,EAAOhtB,EAAEwyD,KAAOyC,IACrD3N,EAAS2L,EAAWjmC,EAAO5zB,GAAI,EAAG87D,IAClC3N,EAAS0L,EAAWjmC,EAAOhtB,GAAI2qD,EAAQ,IAEvCpqB,EAAI5vC,KAAK4vC,GACXupB,iBACEn+B,KACEsU,SAAY,KAIlBM,GAAE0mB,aACAt7B,KACEpB,IAAKqgC,EAAW1lB,UAChBrV,KAAM+6B,EAAW/lB,WACjBtmB,MAAO22C,EACPz2C,OAAQksC,IAGZpqB,EAAEwpB,QACAn9B,MAAO26B,EACP57B,KACEpB,IAAK,EACLsF,KAAMgL,EAAUqF,cAElBz6B,MACE8Y,MAAOqsC,EAAW/lB,WAClBpmB,OAAQksC,EAASC,EAAW1lB,UAAY0lB,EAAW9lB,aAGvDvE,EAAEypB,QACAp9B,MAAO06B,EACP37B,KACEkE,KAAM+6B,EAAW/lB,WAAa+lB,EAAW1lB,UAEzC3a,IAAKsQ,EAAUtR,YAAc9K,EAASmsC,EAAW9lB,WAAa8lB,EAAWhmB,QAE3En/B,MACEgZ,OAAQmsC,EAAW9lB,WACnBvmB,MAAO22C,EAAS,EAAItK,EAAW1lB,YAGnCv0C,KAAKwkE,WAAa9kE,EAAO8kE,aAAenoC,EAAOP,OAE3CO,EAAOP,QACT8T,EAAE9T,QACAG,MAAO8nC,EACP/oC,KACEpB,IAAK,EACLsF,KAAMgL,EAAUqF,aAAe3hB,EAAQomB,EAAiBxE,WAAW5hB,MAAQqsC,EAAW5lB,aAAe4lB,EAAW3lB,eAElHx/B,MACE8Y,MAAOqsC,EAAW5lB,aAClBvmB,OAAQksC,EAAS,EAAIC,EAAW1lB,YAGpCwvB,EAAchqC,GAAGkC,MAAMoE,SAAShE,QAAQA,EAAOP,OAAOtf,KAAM6f,EAAOP,OAAOh7B,KAAKw7B,OAAO09B,EAAS,EAAG,KAElGpqB,EAAE9T,WAIH,cAAe,SAAU,SAAU,UAAUp1B,QAAQ,SAAUic,GAC9D,GAAI62C,GAAK5pB,EAAEjtB,EACX3iB,MAAK2iB,GAAK62C,EAAGx+B,IAETw+B,EAAG1kD,MACLwd,EAAEtnB,OAAOhL,KAAK2iB,GAAI62C,EAAG1kD,MAGnB0kD,EAAGv9B,QACLj8B,KAAK2iB,GAAGsZ,MAAQu9B,EAAGv9B,QAErBp2B,KAAK7F,OACPA,KAAKyR,OAAO4pD,IAAMh/B,EAAO5zB,EAAE+T,KAC3Bxc,KAAKyR,OAAOwpD,GAAK5+B,EAAOhtB,EAAEmN,KAC1Bxc,KAAKi8B,MAAM2+B,OAAS2J,EAASloC,EAAO5zB,EAAEo5D,KACtC7hE,KAAKi8B,MAAM8+B,MAAQf,EAAS39B,EAAOhtB,EAAEwyD,KACrC7hE,KAAK65D,UACH36B,KAAM0Q,EAAE0mB,YAAYt7B,IAAIkE,KACxBtF,IAAKgW,EAAE0mB,YAAYt7B,IAAIpB,IACvBhM,MAAOk2C,EACPh2C,OAAQk2C,EAEV,IAAIS,GAAK70B,EAAE0mB,YAAYt7B,IAAIlN,OACvB42C,EAAK90B,EAAE0mB,YAAYt7B,IAAIpN,KAC3B5tB,MAAK2kE,MACHzlC,KAAM,EACNtF,IAAK,EAGLhM,MAAOA,GAASo2C,EAAUS,EAAKzwB,EAAiBxE,WAAW5hB,MAAQ,GACnEE,OAAQA,GAAUg2C,EAAUY,EAAK1wB,EAAiBxE,WAAW1hB,OAAS,GAExE,IAAI8rC,EAEA55D,MAAKwhD,SACPoY,GACE16B,KAAMl/B,KAAKi8B,MAAM2+B,OAAS56D,KAAKwhD,OAAOnsC,EAAIu6B,EAAE0mB,YAAYt7B,IAAIkE,KAAOtR,EAAQ,EAC3EgM,KAAM55B,KAAKi8B,MAAM8+B,MAAQ/6D,KAAKwhD,OAAOyZ,GAAKntC,EAAS,EAAM8hB,EAAE0mB,YAAYt7B,IAAIpB,IAAMgW,EAAE0mB,YAAYt7B,IAAIlN,SAIvG8hB,EAAEvT,OAASA,EACXuT,EAAEgqB,cAAgBA,EAClBhqB,EAAE3T,OACAxzB,EAAGkuD,EACHtnD,EAAGunD,EACH96B,OAAQioC,IAGZa,cAAe,SAAU16B,EAAWxqC,EAAQkuB,EAAOE,EAAQmrC,GACzD,GAEI6K,IAFa9jE,KAAKu6D,IACN76D,EAAOme,UACT+P,GACVo2C,EAAUl2C,CACAoc,GAAU,GAAGnc,YAC3B/tB,MAAKwkE,WAAa9kE,EAAO8kE,YAAa,CACtC,IAAI50B,GAAI5vC,KAAK4vC,GACXupB,iBACEn+B,KACEsU,SAAY,WAIlBM,GAAE0mB,aACAt7B,KACEpB,IAAK,EACLsF,KAAM,EACNtR,MAAOk2C,EACPh2C,OAAQk2C,IAGZp0B,EAAEgqB,eACA16B,KAAM,EACNtF,IAAK,GAEP55B,KAAKs2D,YAAc1mB,EAAE0mB,YAAYt7B,IACjCh7B,KAAK65D,SAAWt6D,QAAQyL,OAAO4kC,EAAE0mB,YAAYt7B,KAC7Ch7B,KAAK2kE,MACHzlC,KAAM,EACNtF,IAAK,EACLhM,MAAOA,EACPE,OAAQA,SChrBhBvuB,QAAQC,OAAO,wCAAyC,cAAcW,QAAQ,2BAAA,YAAA,qBAA2B,SAAU4hE,EAAW8C,GAC5H,MAAO9C,IACL1zB,MAAOw2B,EAAmB52D,UAC1B62D,cAAe,WACb9kE,KAAK4lD,QAAU5lD,KAAK4lD,OAEhB5lD,KAAK4lD,QACP5lD,KAAKoN,SAGT4kC,YAAa,SAAUtG,GACrB1rC,KAAKquC,MAAM2D,YAAYt2B,KAAK1b,MAC5BA,KAAK0rC,OAASA,EACd1rC,KAAK4lD,QAAS,GAEhBqR,UAAW,SAAUxuD,EAAG4G,EAAGrI,GACzBhH,KAAKquC,MAAM4oB,UAAUv7C,KAAK1b,KAAMyI,EAAG4G,GAE/BrI,GACFhH,KAAKgH,QAGT+9D,SAAU,WACR,GAAIr5B,GAAS1rC,KAAK0rC,MAClB1rC,MAAK4lD,QAAS,EACdla,EAAOzP,MAAMj1B,KAAKyB,EAAI7H,KAAK08B,IAAI,EAAGoO,EAAOzP,MAAMj1B,KAAKyB,EAAI,IACxDijC,EAAOzP,MAAMj1B,KAAKqI,EAAIzO,KAAK08B,IAAI,EAAGoO,EAAOzP,MAAMj1B,KAAKqI,EAAI,KAE1D21D,WAAY,WACV,GAAIt5B,GAAS1rC,KAAK0rC,MAClB1rC,MAAK4lD,QAAS,EACdla,EAAOzP,MAAMj1B,KAAKyB,EAAI,EACtBijC,EAAOzP,MAAMj1B,KAAKqI,EAAI,GAExBrI,KAAM,WACJ,GAAI0kC,GAAS1rC,KAAK0rC,OACdjtB,EAAOze,KAAKye,KACZ24C,EAAK34C,EAAKk5C,GAAKl5C,EAAKg5C,GACpBJ,EAAK54C,EAAKm5C,GAAKn5C,EAAKi5C,GACpBuN,IAAOxmD,EAAKk5C,GAAKl5C,EAAKg5C,IAAM,GAAIh5C,EAAKm5C,GAAKn5C,EAAKi5C,IAAM,GACrDsM,EAAUt4B,EAAOmuB,SAAS/rC,OAC1Bg2C,EAAUp4B,EAAOmuB,SAASjsC,MAC1Bs3C,EAAQx5B,EAAOzP,MAAMj1B,KACrBm+D,EAASrB,EAAU1M,EACnBgO,EAASpB,EAAU3M,EACnBgO,EAAezkE,KAAK08B,IAAI,EAAG18B,KAAKy8B,KAAK8nC,EAASD,EAAMhB,OAAO,KAAOgB,EAAMhB,OAAO,GAAKgB,EAAMhB,OAAO,IAAK,IACtGoB,EAAe1kE,KAAK08B,IAAI,EAAG18B,KAAKy8B,KAAK+nC,EAASF,EAAMd,OAAO,KAAOc,EAAMd,OAAO,GAAKc,EAAMd,OAAO,IAAK,GAC1GpkE,MAAK4lD,QAAS,EACdla,EAAO8V,QACLnsC,EAAG4vD,EAAG,GACNhK,GAAIgK,EAAG,IAETv5B,EAAOzP,MAAMj1B,KAAKyB,EAAI48D,EACtB35B,EAAOzP,MAAMj1B,KAAKqI,EAAIi2D,EACtBzlE,QAAQiI,IAAI,YAAasvD,EAAIC,GAAK4N,GAAKI,EAAcC,UAGxDl+C,UAAU,gBAAiB,WAC5B,OACEC,SAAU,IACVC,OACE+hB,MAAS,KAEX7+B,YAAa,6BACb5B,SAAS,EACT6e,KAAM,SAAU/nB,EAAQivB,EAAU7D,GAChC,GAAIovB,IAASpvB,EAAOovB,OAAS,GACzBqrB,KAAoC,EAApBz6C,EAAOy6C,YAAkB,cAAc7oD,KAAKoO,EAAOy6C,WAAa,IACpF7lE,GAAO6lE,WAAaA,EACpB7lE,EAAO8lE,SAAWD,EAElB7lE,EAAO8iB,KAAO,SAAUA,GACtB9iB,EAAO2pC,MAAQzoC,KAAKy8B,IAAI,EAAGz8B,KAAK08B,IAAI59B,EAAO2pC,MAAQ7mB,EAAO03B,EAAO,KAGnEx6C,EAAO+lE,aAAe,SAAUj5D,GAC9B,GAAIk5D,GAAQ/2C,EAAS0D,KAAK,eACtBszC,EAAWD,EAAMj0D,SACjBm0D,GAAMF,EAAM93C,SAAWphB,EAAO26B,MAAQw+B,EAASzmC,OAASwmC,EAAM93C,QAC9Di4C,GAAMH,EAAM53C,UAAYthB,EAAO46B,MAAQu+B,EAAS/rC,MAAQ8rC,EAAM53C,SAE9Dub,EAAQ3pC,EAAO6lE,WAAaK,EAAKC,CACrCnmE,GAAO2pC,MAAQ3pC,EAAO8lE,SAAW,EAAIn8B,EAAQA,OClFrD9pC,QAAQC,OAAO,qCAAsC,mBAAoB,0BAA2B,iBAAkB,oBAAqB,mCAAoC,gDAAgDqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC9Po1C,EAAeC,MAAM,kCACnB9vC,IAAK,yBACL5H,WAAY,qDACZ+K,YAAa,sDAEd/K,WAAW,wCAAA,KAAA,mBAAA,aAAA,eAAwC,SAAUgF,EAAIqhE,EAAkBC,EAAYrlE,GAChGV,KAAK2zB,WAAa,WAChB,MAAO3zB,MAAKgmE,UAGdhmE,KAAKgmE,OAAS,WAEZ,MADAhmE,MAAK6M,SAAU,EACRi5D,GACLG,0BAA2B,6BAA8B,SAAUC,GACjE,MAAOA,GAA2Bp3D,aAEnC9O,MAAMiE,KAAK,WACZjE,KAAK6M,SAAU,GACfhH,KAAK7F,QAGTA,KAAK2P,IAAM,WACT,MAAKjP,GAAa6C,IAAI,sBAKfwiE,EAAW,mCAChBjhE,SACEqhE,UAAW,6BAA8B,SAAUD,GACjD,MAAOA,GAA2Bv2D,aAPtChP,QAAOb,MAAM,iEAajBE,KAAK2zB,gBCrCPp0B,QAAQC,OAAO,+CAAgD,oBAAqB,iBAAkB,mBAAoB,SAAU,iCAAkC,qCAAqCqC,QAAA,qBAAO,SAAUsU,GAC1NA,EAAmBE,OAAO,mCACxB7L,YAAa,qDACbM,aAAc,aACdrL,WAAY,kCACZqF,SACEqhE,SAAU,WACR,MAAO,aAIZj5B,SAAS,iDACVk5B,KAAM,4EACL3mE,WAAW,mCAAA,KAAA,iBAAA,mBAAA,SAAA,SAAA,gDAAA,WAAmC,SAAUgF,EAAIye,EAAgB4iD,EAAkB13C,EAAQztB,EAAQ0lE,EAA+CF,GAC9JnmE,KAAK0X,aACL1X,KAAKsmE,kBACLtmE,KAAKumE,iBACL,IAAIC,GAAiBp4C,EAAO,kKAE5BpuB,MAAK2zB,WAAa,WAChB,MAAO3zB,MAAKgmE,SAAS/hE,KAAK,WACxBjE,KAAKoP,KACHS,UAAW7P,KAAKsmE,eAAe,GAC/Bv2D,WAAY/P,KAAKumE,eAAe59D,QAChCqH,SAAU,KACV2qB,KAAM,GAAI1yB,OAEZjI,KAAKymE,6BACL5gE,KAAK7F,QAGTA,KAAKgmE,OAAS,WAEZ,MADAhmE,MAAK6M,SAAU,EACRi5D,GACLpuD,WAAY,cAAe,SAAU+4C,GACnC,MAAOA,GAAY3hD,YAErBw3D,eAAgB,SAAUJ,GACxB,MAAOA,GAA2Bn3D,qBAEpCw3D,eAAgB,SAAUL,GACxB,MAAOA,GAA2Bl3D,sBAEnChP,MAAMiE,KAAK,WACZjE,KAAK6M,SAAU,GACfhH,KAAK7F,QAGTA,KAAKymE,0BAA4B,WAC/B,GAAI52D,GAAY7P,KAAKoP,IAAIS,aACzB7P,MAAKoP,IAAIU,WAAaD,EAAUqjC,aAChClzC,KAAK0mE,4BAA8BL,EAA8Cx2D,EAAU7O,MAC3FhB,KAAK2mE,wBAGP3mE,KAAK2mE,qBAAuB,WAC1B3mE,KAAKoP,IAAIQ,YAAc42D,EAAexmE,KAAKoP,MAG7CpP,KAAKqoC,GAAK,WACR,MAAO5jC,GAAGK,UAAUb,KAAK,WACvB,MAAOkiE,IAAYA,EAASnmE,KAAKoP,MACjCvJ,KAAK7F,OAAOiE,KAAK,WACjB,MAAOif,GAAeyC,MAAM3lB,KAAKoP,MACjCvJ,KAAK7F,OAAOmK,MAAM,SAAUrK,GAC5Ba,EAAOb,MAAMA,MAIjBE,KAAK2L,OAAS,WACZuX,EAAeiC,QAAQ,WAGzBnlB,KAAK2zB,gBCzEPp0B,QAAQC,OAAO,iDAAkD,eAAgB,2CAA4C,cAAe,iBAAkB,SAAU,+BAA+BqC,QAAA,iBAAO,SAAUq1C,GACtNA,EAAeC,MAAM,8CACnB9vC,IAAK,qCACL5H,WAAY,0CACZ+K,YAAa,iEAEd/K,WAAW,2CAAA,SAAA,SAAA,YAAA,WAAA,SAAA,mCAAA,UAAA,gBAAA,UAAA,eAA2C,SAAUC,EAAQmJ,EAAQgF,EAAWo+C,EAAUtrD,EAAQimE,EAAkCpkE,EAAS+B,EAAe9B,EAAS/B,GACjLhB,EAAOmnE,yBAA2B,WAIhC,MAHAnnE,GAAOmN,SAAU,EACjBnN,EAAOonE,gBAAiB,EACxBpnE,EAAOuD,WAAaT,EAAQU,SACrB0jE,EAAiC32D,MACtCtG,MAAM,EACNo9D,cAAc,EACdh6D,WAAW,EACXi6D,UAAU,IACT/iE,KAAK,SAAUtB,GAChBjD,EAAOunE,6BAA+BtkE,EACtCjD,EAAOwnE,yBAA2BvkE,EAClCjD,EAAOmN,SAAU,EAEblK,GAAQA,EAAKU,SACf3D,EAAOonE,gBAAiB,MAK9BpnE,EAAOmnE,2BAEPnnE,EAAOynE,cAAgB,SAAUpvD,EAAa7E,EAAQk0D,GACpD7iE,EAAce,QAAQ,yBAA0B4N,GAChDzQ,EAAQiB,SAAS2qD,KAAO,YAAc7rD,EAAQU,SAAW,wBAA0B6U,EAAc,IAAMqvD,GAGzG1nE,EAAO2nE,yBAA2B,WAChC,IAAK3mE,EAAa6C,IAAI,iCAEpB,WADA5C,GAAOb,MAAM,sEAIK+I,GAAO0B,MACzBC,YAAa,4FACb/K,WAAY,6DAEAmI,OAAO3D,KAAK,SAAU2D,GAClCjF,KAAOiF,EAEHjF,KAAKyN,QACP67C,EAASc,aACTrtD,EAAOonE,gBAAiB,EACxBnmE,EAAOmH,IAAI,yHACFnF,KAAK7C,MACda,EAAOb,MAAM,UAAY6C,KAAK7C,OACrB6C,KAAK0E,KACdwG,EAAU9E,KAAKpG,KAAK0E,QAK1B3H,EAAO4nE,aAAe,SAAUC,EAAQ/6D,GAGtC,GAFAA,EAAOgtB,mBAEF94B,EAAa6C,IAAI,iCAEpB,WADA5C,GAAOb,MAAM,sEAIK+I,GAAO0B,MACzBC,YAAa,mGACb/K,WAAY,iCACZqF,SACEyiE,OAAQ,WACN,MAAOA,OAIC3/D,OAAO3D,KAAK,SAAUujE,GAClC,GAAIA,EAAI95D,IACN/M,EAAOb,MAAM,UAAY0nE,EAAI95D,SACxB,CACL,KAAM+5D,GAASloE,QAAQ8N,KAAK3N,EAAOunE,8BAC7BS,EAAOD,EAAOE,UAAU,SAAUxgE,GACtC,MAAOA,GAAK+L,SAAWq0D,EAAOr0D,QAG5Bw0D,IAAQ,IACVhoE,EAAOunE,6BAA6Bh5C,OAAOy5C,EAAM,GACjD/mE,EAAOmH,IAAI,0DAKlBrI,WAAW,oBAAA,SAAA,iBAAA,mCAAA,SAAoB,SAAUC,EAAQwjB,EAAgB0jD,EAAkCW,GACpGvnE,KAAKunE,OAASA,EACd7nE,EAAOkoE,gBAAiB,EAExBloE,EAAO2oC,GAAK,WACV3oC,EAAOkoE,gBAAiB,EACxBhB,EAAiCx4D,OAAOm5D,EAAOr0D,QAAQjP,KAAK,SAAUtB,GACpEugB,EAAeyC,MAAMhjB,MAIzBjD,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAExB1lB,WAAW,8CAAA,iBAAA,mCAAA,cAAA,eAAA,SAA8C,SAAUyjB,EAAgB0jD,EAAkCnW,EAAa/vD,EAAcC,GACjJiR,OAAOzJ,OAAOnI,MACZ2zB,WAAY,WACV3zB,KAAK6M,SACH6K,WAAW,GAEb1X,KAAK+pD,SACH9wC,MAAM,EAER,IAAIhJ,GAAOjQ,KAAKiQ,OAChBjQ,MAAK2C,MACH3B,KAAM,KACNgP,SAAU,KACVjP,QACE8mE,cAAe,EACfC,mBAAoB,EACpBC,kBAAmB,GACnBC,mBAAoB,GACpBC,WAAY,GACZC,aAAc,EACdC,aAAc,KAGlBnoE,KAAKooE,WAAa1nE,EAAa4tC,SAC/BtuC,KAAKwD,QAAU9C,EAAa8C,UAC5BxD,KAAKqoE,eAAgB,EACrBroE,KAAK6M,QAAQ6K,WAAY,EACzB+4C,EAAY3hD,SACVgI,qBAAqB,IACpB7S,KAAK,SAAUyT,GAChB1X,KAAK6M,QAAQ6K,WAAY,EACzBzH,EAAKyH,UAAYA,GACjB7R,KAAK7F,QAETsuC,OAAQ,WACN,MAAOtuC,MAAKooE,YAAcpoE,KAAKwD,SAEjC8kE,WAAY,SAAU9gE,GACpB,MAAOA,GAAQ,MAAUxH,KAAKsuC,UAEhCi6B,cAAe,WACbvoE,KAAK+pD,QAAQ9wC,MAAQjZ,KAAK+pD,QAAQ9wC,MAEpCuvD,OAAQ,WACN,IACE,MAAO5B,GAAiCx2D,QACtC2H,YAAa/X,KAAK2C,KAAKqN,SAASnJ,GAChC7F,KAAMhB,KAAK2C,KAAK3B,KAChBD,OAAQf,KAAK2C,KAAK5B,SACjBkD,KAAK,SAAUwkE,GAChBvlD,EAAeyC,OACbvV,QAAQ,EACRq4D,gBAAiBA,MAElBt+D,MAAMxJ,EAAOgN,aAChB,MAAO7N,GACPD,QAAQC,MAAM,kDAAoDA,KAGtEsQ,OAAQ,WACN,GAAIkgD,GAAQtwD,IAGZ,OADAA,MAAKqoE,eAAgB,EACjBroE,KAAKsuC,SAAiBtuC,KAAKwoE,SACxB5B,EAAiCp/D,QAAQvD,KAAK,SAAUtB,GAC7D,GAAI2tD,EAAMgY,WAAW3lE,EAAK+lE,iBAExB,YADApY,EAAM+X,eAAgB,EAEjB/X,GAAMkY,YAGjB78D,OAAQ,SAAUtE,GAChB6b,EAAeyC,OACbha,QAAQ,EACRtE,IAAKA,KAGTshE,WAAY,WACV,MAAO3oE,MAAK2C,MAAQ3C,KAAK2C,KAAK3B,MAAQhB,KAAK2C,KAAK3B,KAAKqC,OAAS,GAAKrD,KAAK2C,KAAKqN,WAAahQ,KAAK4oE,aAAa5oE,KAAK2C,KAAK5B,OAAOonE,gBAAkBnoE,KAAK4oE,aAAa5oE,KAAK2C,KAAK5B,OAAOmnE,eAEpLW,gBAAiB,WACf,MAAO7oE,MAAK2C,MAAQ3C,KAAK2C,KAAK3B,MAAQhB,KAAK2C,KAAK3B,KAAKqC,OAAS,GAAKrD,KAAK2C,KAAK3B,KAAKqC,OAAS,GAE7FylE,yBAA0B,WACxB,GAAK9oE,KAAK2C,MAAS3C,KAAK2C,KAAKqN,SAC7B,MAAOhQ,MAAK2C,MAAQ3C,KAAK2C,KAAKqN,UAAYhQ,KAAK2C,KAAKqN,SAASxI,MAAQ,MAASxH,KAAKsuC,UAErFy6B,qBAAsB,WACpB,MAAO/oE,MAAK2C,KAAK5B,OAAOonE,cAAgBnoE,KAAK2C,KAAK5B,OAAOmnE,cAE3DU,aAAc,SAAUzhE,GACtB,WAAgBzF,KAATyF,GAA+B,OAATA,KAGjCnH,KAAK2zB,gBCxMPp0B,QAAQC,OAAO,mBAAoB,eAAgB,yBAA0B,aAAc,cAAe,iBAAkB,SAAU,cAAcqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACnLo1C,EAAeC,MAAM,yBACnB9vC,IAAK,gBACLmD,YAAa,oCACZ2sC,MAAM,gBACP9vC,IAAK,QACL5H,WAAY,UACZ+K,YAAa,gCACZ2sC,MAAM,wBACP9vC,IAAK,cAEL5H,WAAY,UACZ+K,YAAa,mCAEd/K,WAAW,WAAA,SAAA,SAAA,UAAA,YAAA,UAAA,gBAAA,WAAA,QAAA,cAAA,SAAA,KAAA,eAAA,SAAA,eAAW,SAAUC,EAAQmJ,EAAQghB,EAAShc,EAAWrL,EAASwmE,EAAe/c,EAAUgd,EAAOxY,EAAa9vD,EAAQ8D,EAAI/D,EAAcf,EAAQupE,GAE7JrpE,QAAQiI,IAAI,mBACZpI,EAAOypE,cAAgBD,EAAah1D,KAEpC,IAAIk1D,GAAY,SAAUziE,EAAGwmD,EAAG93C,EAAGi8C,EAAGv7C,GACpC,GAAIsf,MACAg0C,EAAU,MAEF,MAARh0D,EAAE,KACJg0D,EAAU,OAGZh0C,EAAOhgB,EAAEsuB,UAAU,IAAM0lC,CACzB,IAAIC,IACFtmE,KAAM2D,EACNa,MAAO2lD,EACPoc,QAASl0C,EACTh1B,OAAQixD,EAEV5xD,GAAO8pE,YAAc,GAAIR,GAAcM,GACrCn6C,MAAOpZ,EACPjS,QAAS,SAAU2lE,EAAQ1oE,GACzBrB,EAAOgqE,aAAe,EACtB,IAAIC,GAAe5oE,EAAOV,SAAWwpB,EAAQ,UAAUnqB,EAAOkqE,YAAa7oE,EAAOV,UAAYX,EAAOkqE,YACjGC,EAAc9oE,EAAOwoE,UAAY1/C,EAAQ,WAAW8/C,EAAc5oE,EAAO+oE,WAAapqE,EAAOkqE,WACjG7oE,GAAOouB,MAAM06C,EAAYxmE,QACzBomE,EAAO3kE,QAAQ+kE,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,UAE1FqiE,EAAYxmE,OAAS,IACvB3D,EAAOgqE,aAAe,0BAGxBhqE,EAAOqqE,SAAWF,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,YAKvG9H,GAAOsqE,SAAW,WAIhB,MAHAtqE,GAAOmN,SAAU,EACjBnN,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EACXuc,EAAMh5D,OAAOhM,KAAK,SAAUtB,GACjCjD,EAAOkqE,YAAcjnE,EACrBjD,EAAOqqE,SAAWpnE,EAClBjD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GAElB/mE,EAAKU,OAAS,EACX3D,EAAO8pE,YAGV9pE,EAAO8pE,YAAYxD,SAFnBoD,EAAU,EAAG,GAAI,gBAAkBzmE,EAAKU,QAK1C3D,EAAOgqE,aAAe,oBAKvBhqE,EAAOypE,eACVzpE,EAAOsqE,WAGTtqE,EAAOuqE,aAAe,WAEpB,IAAKvpE,EAAa6C,IAAI,eAEpB,WADA5C,GAAOb,MAAM,iDAIK+I,GAAO0B,MACzBC,YAAa,sCACb/K,WAAY,2CAEAmI,OAAO3D,KAAK,SAAU2D,GAClCjF,KAAOiF,EAEHjF,KAAK0lC,IACP4jB,EAASc,aACTpsD,EAAOmH,IAAI,sFACFnF,KAAK7C,MACda,EAAOb,MAAM,UAAY6C,KAAK7C,OACrB6C,KAAK0E,KACdwG,EAAU9E,KAAKpG,KAAK0E,QAK1B3H,EAAOwqE,UAAY,SAAUC,EAAK39D,GAGhC,GAFAA,EAAOgtB,mBAEF94B,EAAa6C,IAAI,eAEpB,WADA5C,GAAOb,MAAM,6CAIK+I,GAAO0B,MACzBC,YAAa,mCACb/K,WAAY,sCACZqF,SACEqlE,IAAK,WACH,MAAOA,OAICviE,OAAO3D,KAAK,SAAUujE,GAC9BA,EAAI95D,IACN/M,EAAOb,MAAM,UAAY0nE,EAAI95D,MAE7B/M,EAAOmH,IAAI,SAAWqiE,EAAInpE,KAAO,0BACjCtB,EAAOsqE,eAmBbtqE,EAAO0qE,WAAa,SAAUl2D,GACvBA,EAGHvU,EAAOiC,GAAG,wBACRsS,MAAOA,IAHTvU,EAAOiC,GAAG,oBASdlC,EAAOisD,gBAAkB,SAAU3B,GACjCtqD,EAAOsqD,aAAeA,EACtBrqD,EAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD;+BACjCsQ,kBAAmB5R,EAAO2qE,0BAC1BpxD,KAAM+wC,EAAe,SAAW,YAEhCrpD,QAAQ,QAGXlB,WAAW,yBAAA,SAAA,iBAAA,QAAA,MAAA,UAAyB,SAAUC,EAAQwjB,EAAgB+lD,EAAOkB,EAAK3nE,GACnFxC,KAAKmqE,IAAMA,EACXzqE,EAAO4qE,aAAe9nE,EAAQU,SAC9BxD,EAAOkoE,gBAAiB,EAExBloE,EAAO2oC,GAAK,WACV3oC,EAAOkoE,gBAAiB,EACxBqB,EAAM76D,OAAO+7D,EAAIj3D,QAAQjP,KAAK,SAAUtB,GACtCugB,EAAeyC,MAAMhjB,MAIzBjD,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAExB1lB,WAAW,4BAAA,SAAA,iBAAA,oBAAA,cAAA,cAAA,QAAA,SAA4B,SAAUC,EAAQwjB,EAAgB4rC,EAAmBF,EAAa6B,EAAawY,EAAOtoE,GAC9HiR,OAAOzJ,OAAOnI,MACZ2zB,WAAY,WACV3zB,KAAK6M,SACH6K,WAAW,EACX6yD,QAAQ,EAEV,IAAIt6D,GAAOjQ,KAAKiQ,OAChBA,GAAKu6D,UACHxpE,KAAQ,uCACRqB,IAAO,sBAEPrB,KAAQ,0CACRqB,IAAO,mBAETrC,KAAK2C,MACH3B,KAAM,KACNgP,SAAU,KACVy6D,MAAO,KACPC,OAAQz6D,EAAKu6D,QAAQ,GACrBzpE,WAEFf,KAAK6M,QAAQ09D,QAAS,EACtBtB,EAAMj1D,aAAa/P,KAAK,SAAUsmE,GAChCvqE,KAAK6M,QAAQ09D,QAAS,EACtBt6D,EAAKs6D,OAASA,GACd1kE,KAAK7F,OACPA,KAAK6M,QAAQ6K,WAAY,EACzB+4C,EAAY3hD,UAAU7K,KAAK,SAAUyT,GACnC1X,KAAK6M,QAAQ6K,WAAY,EACzBzH,EAAKyH,UAAYA,GACjB7R,KAAK7F,QAETqoC,GAAI,WACF,IACE,MAAO4gC,GAAM74D,QACX2H,YAAa/X,KAAK2C,KAAKqN,SAASnJ,GAChC8jE,OAAQ3qE,KAAK2C,KAAK8nE,MAAM5jE,GACxB7F,KAAMhB,KAAK2C,KAAK3B,KAChB0pE,OAAQ1qE,KAAK2C,KAAK+nE,OAAOroE,IACzBtB,OAAQf,KAAK2C,KAAK5B,SACjBkD,KAAK,SAAUkmE,GAChBjnD,EAAeyC,OACb0iB,IAAI,EACJ8hC,IAAKA,MAENhgE,MAAMxJ,EAAOgN,aAChB,MAAO7N,GACPD,QAAQC,MAAM,uBAAyBA,KAG3C6L,OAAQ,SAAUtE,GAChB6b,EAAeyC,OACbha,QAAQ,EACRtE,IAAKA,OAIXrH,KAAK2zB,gBACJvM,UAAU,eAAgB,WAC3B,OACEC,SAAU,IACVze,SAAS,EACT0e,OACEpT,MAAO,IACP81C,aAAc,IACd4gB,kBAAmB,IACnBC,SAAU,KAEZprE,WAAY,iBACZqL,aAAc,aACdN,YAAa,oCAEd/K,WAAW,kBAAA,SAAA,SAAA,gBAAA,gBAAA,UAAA,QAAA,eAAA,UAAA,oBAAA,SAAkB,SAAUC,EAAQC,EAAQqpE,EAAehrB,EAAen0B,EAASo/C,EAAOvoE,EAAc8B,EAASsoE,EAAmBnqE,GAChJ,GAAI0pD,GAAa7nD,EAAQU,QACzBxD,GAAOqrE,OACLC,aACEjjD,MAAO,iBACP1f,MAAO,KAEP0f,MAAO,WACP1f,MAAO,aAETW,SACEX,MAAO,MACPiY,KAAM,MACNlc,YAAa,2BAEbiE,MAAO,UACPiY,KAAM,UACNlc,YAAa,qCAEbiE,MAAO,cACPiY,KAAM,cACNlc,YAAa,yCAEbiE,MAAO,cACPiY,KAAM,cACNlc,YAAa,sCAEbiE,MAAO,WACPiY,KAAM,oBACNlc,YAAa,2CAEbiE,MAAO,oBACPiY,KAAM,iBACNlc,YAAa,wCAEf4xD,YACE3tD,MAAO,MACPiY,KAAM,QAENjY,MAAO,OACPiY,KAAM,SAENjY,MAAO,gBACPiY,KAAM,kBAERrO,aACE8V,MAAO,WACPzH,KAAM,UACNjY,MAAO,IAEP0f,MAAO,WACPzH,KAAM,cACNjY,MAAO,IAEP0f,MAAO,cACPzH,KAAM,QACNjY,MAAO,OAETq8C,SACEumB,eAAgB,aAGpBvrE,EAAOyvB,OACLnd,KAAM,EACN83C,MAAO,GAETpqD,EAAO6yB,UACLs3B,UAAW,EACXr1C,IAAK,KACLxR,KAAM,EACNgG,OAAQtJ,EAAOqrE,MAAM/hE,OAAO,IAE9BtJ,EAAOuS,YACLyyC,QAAShlD,EAAOqrE,MAAM94D,WAAW,IAEnCvS,EAAO+R,OAAS,EAChB/R,EAAO8R,MAAQ,GAEf,IAAIg6C,GAAiB,WACnB9rD,EAAOwrE,aAAejC,EAAM10D,cAC1BL,MAAOxU,EAAOwU,QAIlBxU,GAAOyrE,gBAAkB,SAAU3+D,GAEjC,MADAA,GAAOgtB,kBACH94B,EAAa8C,UAAkBgoD,IAE/B9qD,EAAa0C,MAAQ1C,EAAa0C,IAAIC,SAAW3C,EAAa6C,IAAI,iBAC7D5C,EAAOb,MAAM,iDACR0rD,IAGhB,IAEI4d,IAFe,GAAIprB,GAAct+C,GAErB,SAAUiH,EAAGwmD,EAAG93C,EAAGi8C,EAAGv7C,GACpC,GAAIsf,MACAg0C,EAAU,MAEF,MAARh0D,EAAE,KACJg0D,EAAU,OAGZh0C,EAAOhgB,EAAEsuB,UAAU,IAAM0lC,CACzB,IAAIC,IACFtmE,KAAM2D,EACNa,MAAO2lD,EACPoc,QAASl0C,EACTh1B,OAAQixD,EAEV5xD,GAAO8pE,YAAc,GAAIR,GAAcM,GACrCn6C,MAAOpZ,EACPjS,QAAS,SAAU2lE,EAAQ1oE,GACzBrB,EAAOgqE,aAAe,EACtB,IAAIC,GAAe5oE,EAAOV,SAAWwpB,EAAQ,UAAUnqB,EAAOkqE,YAAa7oE,EAAOV,UAAYX,EAAOkqE,YACjGC,EAAc9oE,EAAOwoE,UAAY1/C,EAAQ,WAAW8/C,EAAc5oE,EAAO+oE,WAAapqE,EAAOkqE,WACjG7oE,GAAOouB,MAAM06C,EAAYxmE,QACzBomE,EAAO3kE,QAAQ+kE,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,UAE1FqiE,EAAYxmE,OAAS,IACvB3D,EAAOgqE,aAAe,0BAGxBK,SAAWF,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,SAEnE,WAAnB9H,EAAO0rE,SACT1rE,EAAO4E,QAAUylE,SACW,cAAnBrqE,EAAO0rE,SAChB1rE,EAAOyE,WAAa4lE,SAEpBrqE,EAAO2rE,YAActB,aAO7BrqE,GAAO4rE,QACLnnE,WAAY,MAGdzE,EAAO8yB,SAAW,SAAUrrB,GAC1BzH,EAAOstB,OAAO7lB,EAAKkB,QAGrB3I,EAAOstB,OAAS,SAAUlb,GACxB,GAAIy5D,GAAW,IAGbA,GADa,QAAXz5D,EACS,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,SAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,kBAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,SAA6B,OAAlB/d,EAAIg3D,WAGV,SAAUh3D,GACnBA,EAAI+d,SAAW/d,EAAI3N,KAAOiL,IAI7BpS,EAAO+rE,iBAAmB/kE,QAAQ6kE,GAGrC,IAAIG,GAAiB,WACnBzC,EAAMh1D,cAAcvU,EAAOwU,OAAOjQ,KAAK,SAAUtB,GAC/CjD,EAAOisE,YAAchpE,IAIzB+oE,IAEA,IAAIE,GAAY,SAAUC,GACxB,GAAIC,KAgBJ,OAfAD,GAAOnlE,QAAQ,SAAUmO,GACvB,GAAIQ,GAAIR,EAAQjB,UAEVyB,KAAKy2D,KACTA,EAAQz2D,IACN7N,MAAO,EACPoM,WAAYyB,EACZsyC,gBAAiB9yC,EAAQ8yC,kBAIN,GAAnB9yC,EAAQ6nD,SACVoP,EAAQz2D,GAAG7N,UAGRskE,GAGLC,EAAS,SAAUF,EAAQG,GACxBA,IACHA,EAAS,GAGX,IAAIF,KASJ,OARAD,GAAOnlE,QAAQ,SAAUmO,GACvBA,EAAQo3D,YAAcp3D,EAAQuzB,OAAS4jC,EACvCn3D,EAAQ6nD,QAAU7nD,EAAQo3D,YAC1BH,EAAQruD,KAAK5I,KAEfi3D,EAAQv2C,KAAK,SAAU3gB,EAAG6a,GACxB,MAAO7a,GAAEwzB,MAAQ3Y,EAAE2Y,MAAQ,GAAK,IAE3B0jC,GAGLI,EAAkB,SAAUL,EAAQM,GAoBtC,MAnBAL,YACAD,EAAOnlE,QAAQ,SAAUmO,GACvB,GAAIQ,GAAI82D,EAASt3D,EAAQkH,KAAOlH,EAAQjB,WAAa,IAAMiB,EAAQ8K,WAE7DtK,KAAKy2D,WACTA,QAAQz2D,IACN7N,MAAO,EACPoM,WAAYiB,EAAQjB,WACpB+L,YAAa9K,EAAQ8K,YACrBgoC,gBAAiB9yC,EAAQ8yC,gBACzB9V,SAAUh9B,EAAQg9B,SAClB7/B,SAEEm6D,IAAQL,QAAQz2D,GAAG0G,KAAOlH,EAAQkH,OAGxC+vD,QAAQz2D,GAAGrD,KAAKyL,KAAK5I,GACrBi3D,QAAQz2D,GAAG7N,UAENskE,SAGLM,EAAe,SAAUP,GAC3B,GAAIC,IACF38C,MAAO,EAiCT,OA/BA08C,GAAOnlE,QAAQ,SAAUmO,GACvB,GAAIwC,GAAIxC,EAAQw3D,aACZh3D,EAAIR,EAAQjB,UAEVyD,KAAKy0D,KACTA,EAAQz0D,IACNg1D,aAAch1D,EACdi1D,UAAWz3D,EAAQy3D,UACnBhoE,WACA6qB,MAAO,EACPo9C,aAAc,KAIZl3D,IAAKy2D,GAAQz0D,GAAG/S,UACpBwnE,EAAQz0D,GAAG/S,QAAQ+Q,IACjBzB,WAAYyB,EACZsyC,gBAAiB9yC,EAAQ8yC,gBACzBngD,MAAO,IAIY,GAAnBqN,EAAQ6nD,UACyB,GAA/BoP,EAAQz0D,GAAG/S,QAAQ+Q,GAAG7N,QACxBskE,EAAQz0D,GAAGk1D,aAAeT,EAAQz0D,GAAGk1D,aAAe,IAAM13D,EAAQ8yC,iBAGpEmkB,EAAQz0D,GAAG/S,QAAQ+Q,GAAG7N,QACtBskE,EAAQz0D,GAAG8X,WAGR28C,GAGLU,EAAgB,SAAUX,EAAQj4D,GAqBpC,MApBA64D,iBACAjlE,MAAQ,EACRklE,YAAc,MAEdb,EAAOnlE,QAAQ,SAAUmO,GACvB,GAAkB,OAAdjB,EAAsBiB,EAAQjB,YAAcA,IAE5C84D,YADgB,OAAd94D,EACY,MAEAiB,EAAQ8yC,gBAGD,GAAnB9yC,EAAQ6nD,SAAc,CACxB,GAAIvgD,GAAI,GAAIlU,MAAK4M,EAAQumC,SACXj/B,GAAEwwD,WAAkBxwD,EAAEywD,YACpCH,cAAahvD,KAAK,GAAIxV,MAAK,IAAM,EAAG,EAAGkU,EAAEwwD,WAAYxwD,EAAEywD,eACvDplE,YAKJ+uB,MAAOk2C,aACPjlE,MAAOA,MACPxG,KAAM0rE,cAING,GAAY,CAEhBntE,GAAOotE,SAAW,SAAUl5D,GAC1BlU,EAAOqtE,YAAcP,EAAc9sE,EAAO0oD,QAASx0C,EACnD,IAAIo5D,IACFvkE,EAAG/I,EAAOqtE,YAAYx2C,MACtBjwB,KAAM,YAGN2mE,OACEh6B,MAAO,WACPi6B,IAAK,YACLxkC,KAAM,OAGNgD,GACF7nC,MAAOnE,EAAOqtE,YAAY/rE,KAAO,mBACjCuyC,OACE45B,WAAY,KAEZ7wC,OAAQ,GAAIr0B,MAAK,IAAM,EAAG,GAAGC,UAAW,GAAID,MAAK,IAAM,EAAG,GAAGC,aAG7DvF,GAAQqqE,EAEPH,GAIHhhC,OAAOC,QAAQ,cAAenpC,EAAM+oC,IAHpCG,OAAOC,QAAQ,cAAenpC,EAAM+oC,GACpCmhC,GAAY,IAMhBntE,EAAO0tE,0BAA4B,SAAUf,GAC3C,MAAO,YAAc7pE,EAAQU,SAAW,mBAAqBmpE,GAG/D3sE,EAAO2tE,oBAAsB,SAAU74D,GACrC,GAAI84D,IAAO,MAAO94D,EAAIijD,GAAIjjD,EAAIkjD,GAAIljD,EAAImjD,GAAInjD,EAAIojD,IAAInoD,KAAK,IACvD,OAAO+E,GAAM,YAAc61C,EAAa,qBAAuB71C,EAAI63D,aAAe,MAAQiB,EAAM,IAGlG5tE,EAAO6tE,yBAA2B,SAAU1sD,GAC1C,GAAIysD,IAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,IAC3E,OAAOoR,GAAW,YAAcwpC,EAAa,mBAAqBxpC,EAASzJ,UAAY,MAAQk2D,EAAM,IAGvG5tE,EAAO8tE,aAAe,SAAUh5D,EAAKhI,GAC/BA,IACFA,EAAO7K,iBACP6K,EAAOgtB,mBAGTsxC,EAAkBhtB,QAAQmrB,EAAMz1D,eAAegB,IAAM,IAGvD9U,EAAO6qD,QAAU,SAAUvnD,EAAMyqE,KAC/BzqE,EAAOpC,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAIr6B,EAAMtD,EAAOyvB,MAAMnd,KAAOtS,EAAO8R,MAAQ,MAEzD9R,EAAO6yB,SAASvvB,MAAQyqE,KAClC/tE,EAAO6yB,SAASvvB,KAAOA,EACvBtD,EAAO+R,OAASzO,EAAOtD,EAAO8R,MAC9Bk8D,MAIJhuE,EAAOiuE,YAAc,SAAUprC,GAC7B,GAAIooB,GAAWjrD,EAAO6yB,SAASvvB,KAAOu/B,CAElCooB,GAAWjrD,EAAOyvB,MAAM26B,MAAQ,EAClCpqD,EAAO6qD,QAAQ,GACNI,EAAW,EACpBjrD,EAAO6qD,QAAQ7qD,EAAOyvB,MAAM26B,MAAQ,GAEpCpqD,EAAO6qD,QAAQI,IAInBjrD,EAAOkuE,WAAa,SAAUtpE,GAC5B5E,EAAO6yB,SAASjuB,QAAUA,EAC1B5E,EAAO6yB,SAASvvB,KAAO,EACvBtD,EAAO+R,OAAS,CAChB,IAAIo8D,GAAY,QAAUnuE,EAAO6yB,SAASxW,KAAKlI,QAAU,IAAMnU,EAAO6yB,SAASxW,KAAK/a,IAEhD,IAAhCtB,EAAO6yB,SAASxW,KAAKlI,UACvBg6D,EAAY,GAGdnuE,EAAO4rE,OAAOwC,mBAAqBC,EAAiBF,EAAWnuE,EAAOsuE,0BACtEtuE,EAAO4rE,OAAO2C,iBAAmBC,EAAexuE,EAAO6yB,SAASjuB,QAAQsP,WAAYlU,EAAOsuE,yBAC3F,IAAIG,GAAoBzuE,EAAO4rE,OAAOwC,mBAAmBxwD,OAAO,SAAU9V,EAAOk9C,GAC/E,MAAOl9C,IAAgBk9C,EAAQ0pB,GAC9B,EACHC,cACEz6D,WAAY,EACZw6D,EAAGD,EACHxmB,gBAAiB,eAEnBjoD,EAAO4rE,OAAOwC,mBAAmB98B,QAAQq9B,YACzC,IAAIC,GAAkB5uE,EAAO4rE,OAAO2C,iBAAiB3wD,OAAO,SAAU9V,EAAOk9C,GAC3E,MAAOl9C,IAAgBk9C,EAAQ0pB,GAC9B,GACCG,GACF16D,QAAS,EACTu6D,EAAGE,EACHttE,KAAM,YAERtB,GAAO4rE,OAAO2C,iBAAiBj9B,QAAQu9B,GACvC7uE,EAAO6yB,SAASxW,KAAOrc,EAAO4rE,OAAO2C,iBAAiB57C,KAAK,SAAUxd,GACnE,MAAOA,GAAQhB,SAAWnU,EAAO6yB,SAASxW,KAAKlI,UAEjDnU,EAAO6yB,SAASjuB,QAAU5E,EAAO4rE,OAAOwC,mBAAmBz7C,KAAK,SAAUxd,GACxE,MAAOA,GAAQjB,YAAclU,EAAO6yB,SAASjuB,QAAQsP,aAIvDlU,EAAOyvB,OACLnd,KAAM1N,EAAQ8pE,EACdtkB,MAAOlpD,KAAKgoB,KAAKtkB,EAAQ8pE,EAAI1uE,EAAO8R,QAEtCk8D,KAGFhuE,EAAO4rE,UAEP5rE,EAAO8uE,QAAU,SAAUzyD,GACzBrc,EAAO6yB,SAASxW,KAAOA,EACvBrc,EAAO6yB,SAASvvB,KAAO,EACvBtD,EAAO+R,OAAS,CAChB,IAAIo8D,GAAY,QAAUnuE,EAAO6yB,SAASxW,KAAKlI,QAAU,IAAMnU,EAAO6yB,SAASxW,KAAK/a,IAEhD,IAAhCtB,EAAO6yB,SAASxW,KAAKlI,UACvBg6D,EAAY,GAGdnuE,EAAO4rE,OAAOwC,mBAAqBC,EAAiBF,EAAWnuE,EAAOsuE,0BACtEtuE,EAAO4rE,OAAO2C,iBAAmBC,EAAexuE,EAAO6yB,SAASjuB,QAAQsP,WAAYlU,EAAOsuE,yBAC3F,IAAIG,GAAoBzuE,EAAO4rE,OAAOwC,mBAAmBxwD,OAAO,SAAU9V,EAAOk9C,GAC/E,MAAOl9C,IAAgBk9C,EAAQ0pB,GAC9B,EACHC,cACEz6D,WAAY,EACZw6D,EAAGD,EACHxmB,gBAAiB,eAEnBjoD,EAAO4rE,OAAOwC,mBAAmB98B,QAAQq9B,YAEzC,IAAIC,GAAkB5uE,EAAO4rE,OAAO2C,iBAAiB3wD,OAAO,SAAU9V,EAAOk9C,GAC3E,MAAOl9C,IAAgBk9C,EAAQ0pB,GAC9B,GACCG,GACF16D,QAAS,EACTu6D,EAAGE,EACHttE,KAAM,YAERtB,GAAO4rE,OAAO2C,iBAAiBj9B,QAAQu9B,GACvC7uE,EAAO6yB,SAASjuB,QAAU5E,EAAO4rE,OAAOwC,mBAAmBz7C,KAAK,SAAUxd,GACxE,MAAOA,GAAQjB,YAAclU,EAAO6yB,SAASjuB,QAAQsP,aAEvDlU,EAAO6yB,SAASxW,KAAOrc,EAAO4rE,OAAO2C,iBAAiB57C,KAAK,SAAUxd,GACnE,MAAOA,GAAQhB,SAAWnU,EAAO6yB,SAASxW,KAAKlI,UAEjDnU,EAAOyvB,OACLnd,KAAM+J,EAAKqyD,EACXtkB,MAAOlpD,KAAKgoB,KAAK7M,EAAKqyD,EAAI1uE,EAAO8R,QAEnCk8D,IAGF,IAAIA,GAAc,WAChBhuE,EAAOmN,SAAU,EACjBnN,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBuc,EAAMt1D,SAASjU,EAAOwU,MAAOxU,EAAO8R,MAAO9R,EAAO+R,OAAQ/R,EAAO6yB,SAASjuB,QAAQsP,WAAYlU,EAAO6yB,SAASxW,KAAKlI,QAASnU,EAAO6yB,SAASvpB,OAAOX,OAAOpE,KAAK,SAAUtB,GACvKjD,EAAO+rE,YAAc9oE,EACrBjD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GACtBhqE,EAAOsS,KAAO+5D,EAAOrsE,EAAO+rE,aAC5B/rE,EAAO+uE,aAAevC,EAAgBxsE,EAAOsS,KAAuC,sBAAjCtS,EAAO6yB,SAASvpB,OAAOX,SAI9E3I,GAAO2Q,SAAW,WAChB,IAAK3P,EAAa6C,IAAI,qBAEpB,WADA5C,GAAOmH,IAAI,uDAIb,IAAImK,IAAcvS,EAAOuS,WAAWyyC,UAClCr8C,MAAO,OACNA,MACC2J,IAEJ,KAAK,GAAI1N,KAAW5E,GAAO+uE,aACzB/uE,EAAO+uE,aAAanqE,GAAS0N,KAAKtL,QAAQ,SAAU8N,GAC9CA,EAAI+d,UACNvgB,EAAKyL,KAAKjJ,IAKhB,IAAIk6D,GAAS18D,EAAKrM,IAAI,SAAU6O,GAC9B,MAAOA,GAAIC,mBAGb,KACEw0D,EAAMv0D,aAAahV,EAAOwU,MAAOw6D,EAAQz8D,GAAYhO,KAAK,SAAUiG,GAClE8H,EAAKtL,QAAQ,SAAU8N,GACrBA,EAAIg3D,UAAYv5D,EAChBuC,EAAI+d,UAAW,MAGnB,MAAOzyB,GACPD,QAAQC,MAAM,gCAAiCA,GAGjD4rE,KAKFhsE,EAAOsjD,SAAW,SAAUx2C,EAAQksB,GAClC14B,KAAKi4B,cAAgBS,EAAYT,aACjC,IAAIgrB,GAAYvqB,EAAYT,cAAcirB,QACtCyrB,EAAYj2C,EAAYJ,QAAQs2C,OAAOn9D,SAASmoB,GACpD55B,MAAK2uE,UAAwB,EAAZA,EACjB3uE,KAAKmjD,mBAAqBF,GAAa0rB,EAGzC,IAAIZ,GAAmB,SAAUhyD,EAAM8yD,GACzB,GAAR9yD,IACFA,EAAO,QAGT,IAAI+xD,KAQJ,OAPAe,GAAqBnoE,QAAQ,SAAUpC,GACrCwpE,EAAmBrwD,MACjB7J,WAAYtP,EAAQsP,WACpBw6D,EAAG9pE,EAAQyX,GACX4rC,gBAAiBrjD,EAAQqjD,oBAGtBmmB,GAGLI,EAAiB,SAAU5pE,EAASuqE,GACvB,GAAXvqE,IACFA,EAAU,QAGZ,IAAIwqE,KAmCJ,OAlCAD,GAAqBnoE,QAAQ,SAAU2O,GACrC,GAAe,SAAX/Q,EAAqB+Q,EAAEzB,YAActP,EACvC,IAAKjC,MAAOgT,GACV3M,MAAQrG,IAAIqG,MAAM,KAClBmL,QAAUnL,MAAM,GAChB1H,KAAO0H,MAAMC,MAAM,GAAG8G,KAAK,KAEX,QAAZ/G,MAAM,KACRgrB,OACAA,IAAI7f,QAAUA,QACd6f,IAAI06C,EAAI/4D,EAAEhT,KACVqxB,IAAI1yB,KAAOA,KACX8tE,EAAgBrxD,KAAKiW,QAMd,SAAXpvB,IACFyqE,qBAAuBD,EAAgBxxD,OAAO,SAAU0xD,EAAUjzD,GAUhE,MATMA,GAAKlI,UAAWm7D,KACpBA,EAASjzD,EAAKlI,UACZA,QAASkI,EAAKlI,QACdu6D,EAAG,EACHptE,KAAM+a,EAAK/a,OAIfguE,EAASjzD,EAAKlI,SAASu6D,GAAKryD,EAAKqyD,EAC1BY,OAETF,EAAkBl9D,OAAO8vB,OAAOqtC,uBAG3BD,EAGTpvE,GAAOuvE,gBAAkB,WACvBvvE,EAAOwvE,WAAW,SAGpBxvE,EAAOwvE,WAAa,SAAU9D,EAAU+D,GAClCA,GACFj9B,OAAO0Q,SAAS,EAAG,EAGrB,IAAIvtB,GAAS,kBA4BG,SAAZ+1C,EACFnC,EAAM30D,wBAAwB5U,EAAOwU,OACnClL,OAAQtJ,EAAO6yB,SAASvpB,OAAOX,QAC9BpE,KAAK,SAAUiG,GAChB,GAAIvH,GAAOuH,EAASvH,IACpBjD,GAAOsuE,yBAA2BrrE,EAClCjD,EAAO4rE,OAAOwC,mBAAqBC,EAAiBruE,EAAO6yB,SAASxW,KAAOrc,EAAO6yB,SAASxW,KAAKlI,QAAU,EAAGnU,EAAOsuE,0BACpHtuE,EAAO4rE,OAAO2C,iBAAmBC,EAAexuE,EAAO6yB,SAASjuB,QAAU5E,EAAO6yB,SAASjuB,QAAQsP,WAAa,EAAGlU,EAAOsuE,yBACzH,IAAIoB,GAAY1vE,EAAO4rE,OAAOwC,mBAAmBxwD,OAAO,SAAU9V,EAAOk9C,GACvE,MAAOl9C,IAAgBk9C,EAAQ0pB,GAC9B,GACCC,GACFz6D,WAAY,EACZw6D,EAAGgB,EACHznB,gBAAiB,cAEnBjoD,GAAO4rE,OAAOwC,mBAAmB98B,QAAQq9B,GAEpC3uE,EAAO6yB,SAASjuB,QAGnB5E,EAAO6yB,SAASjuB,QAAU5E,EAAO4rE,OAAOwC,mBAAmBz7C,KAAK,SAAUxd,GACxE,MAAOA,GAAQjB,YAAclU,EAAO6yB,SAASjuB,QAAQsP,cACjDy6D,EAJN3uE,EAAO6yB,SAASjuB,QAAU+pE,CAO5B,IAAIgB,IACFx7D,QAAS,EACTu6D,EAAGgB,EACHpuE,KAAM,YAERtB,GAAO4rE,OAAO2C,iBAAiBj9B,QAAQq+B,GAElC3vE,EAAO6yB,SAASxW,KAGnBrc,EAAO6yB,SAASxW,KAAOrc,EAAO4rE,OAAO2C,iBAAiB57C,KAAK,SAAUxd,GACnE,MAAOA,GAAQhB,SAAWnU,EAAO6yB,SAASxW,KAAKlI,WAC3Cw7D,EAJN3vE,EAAO6yB,SAASxW,KAAOszD,EAOzB3vE,EAAOyvB,OACLnd,KAAMo9D,EACNtlB,MAAOlpD,KAAKgoB,KAAKwmD,EAAY1vE,EAAO8R,QAEtC9R,EAAO0rE,SAAW,OAClBsC,MAQQhuE,EAAO0oD,QAhFF,WACC,WAAZgjB,GACF1rE,EAAO4E,QAAUsnE,EAAUlsE,EAAO0oD,SAClC1oD,EAAO0rE,SAAW,UAClB/1C,EAAS,mBACT31B,EAAOotE,SAASqC,GAAkB,OAClCzvE,EAAOkqE,YAAch4D,OAAO8vB,OAAOhiC,EAAO4E,UACrB,cAAZ8mE,GACT1rE,EAAOyE,WAAaioE,EAAa1sE,EAAO0oD,SACxC1oD,EAAO4rE,OAAOnnE,WAAayN,OAAOC,KAAKnS,EAAOyE,YAAYd,OAC1D3D,EAAO0rE,SAAW,aAClB/1C,EAAS,gBACT31B,EAAOkqE,YAAch4D,OAAO8vB,OAAOhiC,EAAOyE,cAE1CzE,EAAO0rE,SAAW,MAClB1rE,EAAO2rE,YAAc3rE,EAAO0oD,QAC5B1oD,EAAOkqE,YAAch4D,OAAO8vB,OAAOhiC,EAAO0oD,UAGxC1oD,EAAOkqE,YAAYvmE,OAAS,EAC9B+lE,EAAU,EAAG,GAAI/zC,KAAY31B,EAAOkqE,YAAYvmE,QAEhD3D,EAAOgqE,aAAe,4BA2DxBhqE,EAAOmN,SAAU,EACjBnN,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBuc,EAAMl1D,YAAYrU,EAAOwU,OAAOjQ,KAAK,SAAUtB,GAC7CjD,EAAO0oD,QAAUzlD,EACjBjD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GACtBhqE,EAAOwvE,WAAW,YAOxBxvE,EAAOwvE,WAAWvvE,EAAOoB,OAAOuuE,WAAa3vE,EAAOoB,OAAOuuE,WAAa,UC37B1E/vE,QAAQC,OAAO,+BAAgC,eAAgB,yBAA0B,mBAAoB,cAAe,iBAAkB,yBAA0B,SAAU,kBAAmB,gDAAgDqC,QAAA,iBAAO,SAAUq1C,GACpQA,EAAeC,MAAM,4BACnB9vC,IAAK,mBACL5H,WAAY,0BACZ+K,YAAa,4CACZ2sC,MAAM,oCACP9vC,IAAK,oDACL5H,WAAY,0BACZsB,QACEwuE,QAAS,KACTC,QAAS,MAEXhlE,YAAa,4CACZ2sC,MAAM,sBACP9vC,IAAK,8CACL5H,WAAY,0BACZsB,QACE0uE,YAAa,MAEfjlE,YAAa,+CAGhB/K,WAAW,2BAAA,SAAA,SAAA,eAAA,mBAAA,WAAA,SAAA,YAAA,SAAA,eAAA,gBAAA,UAA2B,SAAUC,EAAQC,EAAQupE,EAAcwG,EAAkBzjB,EAAUtrD,EAAQkN,EAAWhF,EAAQnI,EAAc6D,EAAe/B,GACjK9C,EAAOiwE,wBAA0BzG,EAAal2D,gBAC9CtT,EAAOkwE,kBAAmB,EAC1BlwE,EAAOmwE,eAAiB,WACtBrtE,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAOowE,kBAAsC,IAAlBz3D,EAAKkP,YAEjC7nB,EAAOmwE,iBAEVnwE,EAAOqwE,mBAAqB,WAG1B,MAFArwE,GAAOmN,SAAU,EACjBnN,EAAOonE,gBAAiB,EACjB4I,EAAiBz/D,MACtBlD,WAAW,IACV9I,KAAK,SAAUtB,GAChBjD,EAAOswE,uBAAyBrtE,EAChCjD,EAAOuwE,mBAAqBttE,EAC5BjD,EAAOmN,SAAU,EAEblK,GAAQA,EAAKU,SACf3D,EAAOonE,gBAAiB,MAKzBpnE,EAAOiwE,yBACVjwE,EAAOqwE,oBAIT,MAAMN,GAAcxqE,KAAKC,MAAMX,EAAcY,QAAQ,wBAEjD+jE,GAAauG,aAAeA,GAAuC,uBAAxB9vE,EAAO+kD,QAAQ1jD,MAC5DtB,EAAOkwE,kBAAmB,EAC1BlwE,EAAO+vE,YAAcvG,EAAauG,YAAcvG,EAAauG,YAAcA,GAE3ElrE,EAAce,QAAQ,uBAAwB,MAGhD5F,EAAO0qE,WAAa,SAAU8F,GACvBA,EAGHvwE,EAAOiC,GAAG,oCACRoR,gBAAiBk9D,EAAcC,oBAHjCxwE,EAAOiC,GAAG,gCAQdlC,EAAO0wE,uBAAyB,WAC9B,IAAK1vE,EAAa6C,IAAI,iCAEpB,WADA5C,GAAOb,MAAM,sDAIK+I,GAAO0B,MACzBC,YAAa,wDACb/K,WAAY,6CAEAmI,OAAO3D,KAAK,SAAU2D,GAClCjF,KAAOiF,EAEHjF,KAAKyN,QACP67C,EAASc,aACTrtD,EAAOonE,gBAAiB,EACxBnmE,EAAOmH,IAAI,iGACFnF,KAAK7C,MACda,EAAOb,MAAM,UAAY6C,KAAK7C,OACrB6C,KAAK0E,KACdwG,EAAU9E,KAAKpG,KAAK0E,QAK1B3H,EAAO2wE,oBAAsB,SAAUH,EAAe1jE,GAGpD,GAFAA,EAAOgtB,mBAEF94B,EAAa6C,IAAI,iCAEpB,WADA5C,GAAOmH,IAAI,sDAISe,GAAO0B,MAC3BC,YAAa,2DACb/K,WAAY,wCACZqF,SACEorE,cAAe,WACb,MAAOA,OAICtoE,OAAO3D,KAAK,SAAUujE,GAClC,GAAIA,EAAI95D,IACN/M,EAAOb,MAAM,UAAY0nE,EAAI95D,SACxB,CACL,KAAM+5D,GAASloE,QAAQ8N,KAAK3N,EAAOswE,wBAC7BtI,EAAOD,EAAOE,UAAU,SAAUxgE,GACtC,MAAOA,GAAKgpE,oBAAsBD,EAAcC,mBAG9CzI,IAAQ,IACVhoE,EAAOswE,uBAAuB/hD,OAAOy5C,EAAM,GAC3C/mE,EAAOmH,IAAI,+CAKlBrI,WAAW,2BAAA,SAAA,iBAAA,mBAAA,gBAA2B,SAAUC,EAAQwjB,EAAgBwsD,EAAkBQ,GAC3FlwE,KAAKkwE,cAAgBA,EACrBxwE,EAAOkoE,gBAAiB,EAExBloE,EAAO2oC,GAAK,WACV3oC,EAAOkoE,gBAAiB,EACxB8H,EAAiBthE,OAAO8hE,EAAcC,mBAAmBlsE,KAAK,SAAUtB,GACtEugB,EAAeyC,MAAMhjB,MAIzBjD,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAG1BiC,UAAU,sBAAuB,WAChC,OACEC,SAAU,IACVze,SAAS,EACT0e,OACEtU,gBAAiB,IACjBg3C,aAAc,IACd4gB,kBAAmB,IACnBC,SAAU,KAEZprE,WAAY,wBACZqL,aAAc,aACdN,YAAa,gDAEd/K,WAAW,yBAAA,SAAA,SAAA,YAAA,mBAAA,UAAA,UAAA,cAAA,gBAAA,SAAA,eAAyB,SAAUC,EAAQC,EAAQkO,EAAW6hE,EAAkBjtE,EAASD,EAASiuD,EAAalsD,EAAesE,EAAQnI,GAClJ,GAAIq5B,GAAKt3B,EAAQs3B,EACjBr6B,GAAOmN,SAAU,EACjBnN,EAAO4wE,YAAa,EACpB5wE,EAAO6wE,gBAAkB,IACzB,IAAI19B,EACJnzC,GAAO8wE,iBACLnzC,IAAK,KACLC,IAAK,KACLmzC,WAAY,KACZC,WAAY,MAGdhxE,EAAOixE,kBAAoB,WACM,IAA3BjxE,EAAO6wE,kBACX7wE,EAAO6wE,iBAAmB,EAC1B7wE,EAAOkxE,kBAGTlxE,EAAOmxE,kBAAoB,WACrBnxE,EAAO6wE,kBAAoB7wE,EAAOgsC,OAAOolC,OAAOztE,SACpD3D,EAAO6wE,iBAAmB,EAC1B7wE,EAAOkxE,kBAITlxE,EAAOkxE,cAAgB,WACrBzoB,aAAatV,GACbA,EAAU79B,WAAW,WACnB,GAA+B,OAA3BtV,EAAO6wE,gBAA0B,CACnCj+C,EAAE,2BAA2BhxB,SAC7B5B,EAAOgsC,OAAOolC,OAAOpqE,QAAQ,SAAUqqE,GACrCA,EAAMj0D,KAAK6kB,MAAQovC,EAAMC,UACzBD,EAAMj0D,KAAK,gBAAkB,GAEfpd,GAAOgsC,OAAOolC,OAAOpxE,EAAO6wE,gBAAkB,GACpDzzD,KAAK6kB,MAAQ,UACvBkK,OAAOG,SAAS9qC,SAASqgD,eAAe,WACtC0vB,uBAAwB,UACxBC,yBAA0B,EAC1BC,8BAA+B,IAGjCzxE,EAAOm3D,UACPn3D,EAAOm3D,OAAOn3D,EAAO6wE,gBAAkB,MACvC7wE,EAAOm3D,OAAOn3D,EAAO6wE,gBAAkB,GAAK7wE,EAAO0xE,iBACnD1xE,EAAO4wE,YAAa,EACpB5wE,EAAOmsB,WAER,MAGLnsB,EAAO0xE,eAAiB,WACtB,GAAIhhC,MACA6tB,EAAWv+D,EAAO2xE,qBAAuB3xE,EAAO4xE,kBAClDj0C,IAAKxvB,EAAU7E,SAASumE,QACxBjyC,IAAKzvB,EAAU7E,SAASwmE,UACrB9vE,EAAOu+D,SACRsT,EAAkB3/D,OAAO8vB,OAAOu8B,GAAUv+D,EAAO6wE,gBAAkB,GAAGnhE,GAQ1E,OANImiE,IAAmBA,EAAgBluE,QACrCkuE,EAAgB7qE,QAAQ,SAAUS,EAAMqqE,GACtCphC,EAAI3yB,KAAK+zD,KAINphC,EA6FT1wC,GAAO2xE,mBAAqB,WAC1B,MAAOxjE,GAAU7E,SAASumE,SAAW1hE,EAAU7E,SAASwmE,SAG1D9vE,EAAO+xE,QAAU,WACf,WAA0C/vE,KAAnChC,EAAOgyE,yBAA4E,IAAnChyE,EAAOgyE,0BAAkChyE,EAAOmN,SAGzGnN,EAAOiyE,aAAe,WACpB,WAAuCjwE,KAAnChC,EAAOgyE,yBAAyChyE,EAAOmN,QAAgB,OACpCnL,KAAnChC,EAAOgyE,yBAA0ChyE,EAAOmN,QACrDnN,EAAOgyE,wBAD8D,WAI9EhyE,EAAOkyE,iBAAmB,WACxB,WAAqClwE,KAAjChC,EAAOmyE,uBAAuCnyE,EAAOmN,QAAgB,OACpCnL,KAAjChC,EAAOmyE,uBAAwCnyE,EAAOmN,QACnDnN,EAAOmyE,sBAD4D,UAI5E,IAAIC,GAAuB,SAAU7T,GA2EnC,QAAS8T,GAASxvC,GAChB,KAAMyvC,IAAO,EAAG,EAAG,EAEnB,KAAK,GAAIrvD,GAAI,EAAGA,EAAI,GAAIA,IACtBqvD,EAAIrvD,EAAI,KAAO,EACfqvD,EAAIrvD,EAAI,IAAU,EAAJ4f,EACdA,IAAM,CAGR,OAAO,IAAMyvC,EAAI10D,OAAO,SAAU1I,EAAGu4C,GACnC,OAAQA,EAAI,GAAOA,EAAEhyB,SAAS,IAAM,IAAMgyB,EAAEhyB,SAAS,KAAOvmB,GAC3D,IArFL,GAAIiqB,GAAK39B,SAASqgD,eAAe,UAC7B5+C,KACAmuE,IACJpxE,GAAOuyE,eAEP,KAAK,GAAI9kB,KAAK8Q,GAEZt7D,EAAK8a,MACHhV,EAAGw1D,EAAS9Q,GAAG1kD,EACf4G,EAAG4uD,EAAS9Q,GAAG99C,EACf/I,KAAM,UACNoe,KAAM,UACN2uB,UAAW,OACXryC,KAAMmsD,EACNhS,QACEzS,KAAM,KAIVooC,EAAOrzD,MACLnX,KAAM,SACN4rE,KAAM,IACNC,KAAM,IACNC,GAAIr4C,EAAGsD,IAAI4gC,EAAS9Q,GAAG1kD,GACvB4pE,GAAIt4C,EAAGsD,IAAI4gC,EAAS9Q,GAAG99C,GACvBooD,GAAI19B,EAAGuD,IAAI2gC,EAAS9Q,GAAG1kD,GACvBivD,GAAI39B,EAAGuD,IAAI2gC,EAAS9Q,GAAG99C,GACvBijE,QAAS,KAGX5yE,EAAOuyE,aAAax0D,MAClBhV,EAAGw1D,EAAS9Q,GAAG1kD,EACf4G,EAAG4uD,EAAS9Q,GAAG99C,EACfkjE,QAASplB,EACT/9C,IAAK6uD,EAAS9Q,GAAG/9C,KA8ErB,IAzEA1P,EAAOgsC,QACLolC,OAAQA,EACRhjD,OAAQ+Q,EAAKA,EAAG2zC,YAAc3zC,EAAG2zC,YAAc,EAAI,IACnD5kD,MAAOiR,EAAKA,EAAG2zC,YAAc,KAC7BC,YAAY,EACZl9B,SAAU,QACVzZ,QACEj4B,OACEyc,KAAM,iBACNoyD,KAAM,MACN9sC,MACE8C,KAAM,KAGVjgC,EAAG,EACHkqE,QAAS,QACTtjE,EAAG,EACHujE,UAAW,eACXhtC,MACEjE,MAAO,UAGX2T,cAAe,UACfD,aAAc,UACd9B,OACE5R,MAAO,QACP99B,MAAO,cACP6uE,KAAM,OAER/+B,OACEhS,MAAO,QACP99B,MAAO,gBAmBXnE,EAAOgsC,OAAOolC,OAAOpqE,QAAQ,SAAUqqE,EAAOpuD,GAC5C,GAAIgf,GAAQowC,EAASpvD,EAAI,EACzBhgB,GAAKggB,GAAGw4B,QACNxZ,MAAOA,GAETovC,EAAMC,UAAYrvC,EAClBovC,EAAMj0D,MACJ6kB,MAAOA,EACPkxC,eAAgB,KAIpBnzE,EAAOozE,YAAc,WACnBpzE,EAAO4wE,YAAa,EACpB5wE,EAAOmsB,SACPnsB,EAAOgsC,OAAOolC,OAAOpqE,QAAQ,SAAUqqE,GACrCA,EAAMj0D,KAAK6kB,MAAQovC,EAAMC,UACzBD,EAAMj0D,KAAK,gBAAkB,IAE/B+uB,OAAOknC,OAAOl0C,GACdn/B,EAAOmsB,UAGLgT,EAAI,CACN,GAAIh9B,IACFszC,YAAY,EACZD,gBAAgB,EAChBD,aAAa,EACb+9B,cAAe,EAGjBnnC,QAAOC,QAAQjN,EAAIl8B,EAAMjD,EAAOgsC,OAAQ7pC,GACxCoxE,UAAY/xE,SAASgyE,uBAAuB,YAAY,GACxDxzE,EAAOyzE,gBAAkBzzE,EAAOgsC,OAAO6H,MAAMjX,MAAM,GAEnDuC,EAAG/N,GAAG,eAAgB,SAAUnuB,GACC,UAA3BjD,EAAOgsC,OAAO6J,UAChB09B,UAAU7xE,UAAUC,IAAI,kBAI5Bw9B,EAAG/N,GAAG,iBAAkB,SAAUnuB,GAChCswE,UAAU7xE,UAAUE,OAAO,kBAE7Bu9B,EAAG/N,GAAG,qBAAsB,SAAUnuB,GAChCA,EAAK,kBAAoBjD,EAAOyzE,kBAClCF,UAAU7xE,UAAUE,OAAO,mBAC3B2xE,UAAU7xE,UAAUC,IAAI,kBACxB3B,EAAOyzE,gBAAkBxwE,EAAK,mBAG5BA,EAAK,kBAAoBjD,EAAOyzE,kBAClCF,UAAU7xE,UAAUE,OAAO,kBAC3B2xE,UAAU7xE,UAAUC,IAAI,mBACxB3B,EAAOyzE,gBAAkBxwE,EAAK,qBAGlCk8B,EAAG/N,GAAG,kBAAmB,SAAUnuB,GACjCswE,UAAU7xE,UAAUE,OAAO,mBAC3B2xE,UAAU7xE,UAAUE,OAAO,oBAG7Bu9B,EAAG/N,GAAG,eAAgB,SAAUnuB,GAC9B9C,QAAQiI,IAAI,eAAgBnF,GAC5B2vB,EAAE,2BAA2BhxB,SAC7B5B,EAAOozE,cACPpzE,EAAOm3D,QACLpuD,EAAG9F,EAAKk0D,OAAO,GAAGpuD,EAClB4G,EAAG1M,EAAKk0D,OAAO,GAAGxnD,EAClBrO,KAAM2B,EAAKk0D,OAAO,GAAGuc,SAASpyE,MAEhCtB,EAAOgsC,OAAOolC,OAAOpqE,QAAQ,SAAUqqE,EAAOpuD,GACxCjjB,EAAOm3D,OAAOpuD,GAAKsoE,EAAMqB,IAAM1yE,EAAOm3D,OAAOpuD,GAAKsoE,EAAMtZ,IAAM/3D,EAAOm3D,OAAOxnD,GAAK0hE,EAAMsB,IAAM3yE,EAAOm3D,OAAOxnD,GAAK0hE,EAAMrZ,KACxHh4D,EAAOgsC,OAAOolC,OAAOnuD,GAAG7F,KAAK6kB,MAAQ,UACrCkK,OAAOG,SAASnN,GACdw0C,qCAAsC,UACtCC,4CAA6C,IAE/C5zE,EAAO4wE,YAAa,EACpB5wE,EAAOmsB,cAKbgT,EAAG/N,GAAG,kBAAmB,SAAUnuB,GAC5BA,GACH2vB,EAAE,2BAA2BhxB,SAI/BzB,QAAQiI,IAAI,kBAAmBnF,GAC/BjD,EAAOm3D,UAEHl0D,GAAQA,EAAKk0D,QAAUl0D,EAAKk0D,OAAOxzD,SACrCV,EAAKk0D,OAAOnwD,QAAQ,SAAU6sE,GAC5B,GAAIhB,GAAUgB,EAAMC,WAEf9zE,GAAOm3D,OAAO0b,KACjB7yE,EAAOm3D,OAAO0b,OAKhB7yE,EAAOm3D,OAAO0b,GAAS90D,KAAK81D,EAAME,eAEpC/zE,EAAO4wE,YAAa,EACpB5wE,EAAOmsB,aAOfnsB,GAAOg0E,mBAAqB,WAC1Bh0E,EAAO4wE,YAAa,EACpB5wE,EAAO6wE,gBAAkB,KACzB7wE,EAAOkwE,kBAAmB,EAErBlwE,EAAOm3D,OAGHn3D,EAAOm3D,OAAOxzD,QACnB3D,EAAO+vE,eACP/vE,EAAOm3D,OAAOnwD,QAAQ,SAAUgtB,EAAK/Q,GACnCjjB,EAAO+vE,YAAY9sD,IACjBvT,IAAK1P,EAAOuyE,aAAatvD,GAAGvT,IAAI/O,OAAO,SAAUuU,EAAG+N,GAClD,MAAO+Q,GAAIpwB,SAASqf,KAEtB3hB,KAAMtB,EAAOuyE,aAAatvD,GAAG4vD,YAK/B7yE,EAAO+vE,YAAc/vE,EAAOuyE,aAAa5/C,KAAK,SAAU0+C,GACtD,MAAOA,GAAMtoE,EAAEnF,SAAS5D,EAAOm3D,OAAOpuD,IAAMsoE,EAAM1hE,EAAE/L,SAAS5D,EAAOm3D,OAAOxnD,KAfjF3P,EAAO+vE,YAAc/vE,EAAOuyE,aAmB9BtyE,EAAOiC,GAAG,sBACRoR,gBAAiBtT,EAAOsT,gBACxBy8D,YAAa/vE,EAAO+vE,eAKxB/vE,EAAOi0E,yBAA2B,WAChC,GAAIj0E,EAAOm3D,OAAOxzD,OAAQ,CACxB3D,EAAOk0E,kBACLxkE,OAGF,KAAK,GAAIiI,KAAK3X,GAAOm3D,OACnBn3D,EAAOuyE,aAAa56D,GAAGjI,IAAI1I,QAAQ,SAAUkO,EAAG+N,GAC1CjjB,EAAOm3D,OAAOx/C,GAAG/T,SAASqf,IAC5BjjB,EAAOk0E,iBAAiBxkE,IAAIqO,KAAK7I,SAQvClV,GAAOk0E,iBAAmBl0E,EAAOuyE,aAAa5/C,KAAK,SAAU0+C,GAC3D,MAAOA,GAAMtoE,EAAEnF,SAAS5D,EAAOm3D,OAAOpuD,IAAMsoE,EAAM1hE,EAAE/L,SAAS5D,EAAOm3D,OAAOxnD,IAK/E,IAAI3P,EAAOk0E,kBAAoBl0E,EAAOk0E,iBAAiBxkE,KAAO1P,EAAOk0E,iBAAiBxkE,IAAI/L,YAC7D3B,KAAvBhC,EAAOm0E,YAA2B,CACpCn0E,EAAOk0E,iBAAiB1S,QACxB,IAAI4S,KACJp0E,GAAOk0E,iBAAiBxkE,IAAI1I,QAAQ,SAAUG,GAC5C,KAAM6gE,GAAOhoE,EAAOm0E,YAAYE,OAAOpM,UAAU,SAAUxgE,GACzD,MAAOA,KAASN,GAElBitE,GAAOr2D,KAAK/d,EAAOm0E,YAAYxH,aAAa3E,GAC5C,IAAI4F,IAAO,MAAO5tE,EAAOm0E,YAAYG,SAAStM,GAAOhoE,EAAOm0E,YAAYI,SAASvM,GAAOhoE,EAAOm0E,YAAYK,SAASxM,GAAOhoE,EAAOm0E,YAAYM,UAAUzM,IAAOj4D,KAAK,IAE/J/P,GAAOk0E,iBAAiB1S,MAAMxhE,EAAOm0E,YAAYxH,aAAa3E,IAGjEhoE,EAAOk0E,iBAAiB1S,MAAMxhE,EAAOm0E,YAAYxH,aAAa3E,IAAOjqD,KAAK6vD,GAF1E5tE,EAAOk0E,iBAAiB1S,MAAMxhE,EAAOm0E,YAAYxH,aAAa3E,KAAU4F,KAK5E5tE,EAAOyhE,yBACPiT,oBACAA,iBAAiBhlE,IAAM1P,EAAOk0E,iBAAiBxkE,IAC/CglE,iBAAiBlT,MAAQxhE,EAAOk0E,iBAAiB1S,MACjDkT,iBAAiBpkE,UACfnJ,GAAI,EACJ7F,KAAM,WAAa8yE,EAAOrkE,KAAK,KAC/BtL,WAAY2vE,EAAOzzE,OAAO,SAAUwG,EAAI8b,EAAG/N,GACzC,MAAOA,GAAEyW,QAAQxkB,KAAQ8b,IAE3Bnb,MAAOssE,EAAOzzE,OAAO,SAAUwG,EAAI8b,EAAG/N,GACpC,MAAOA,GAAEyW,QAAQxkB,KAAQ8b,IACxBtf,QAELkB,EAAce,QAAQ,oBAAqBL,KAAKM,UAAU6uE,mBAC1D3xE,EAAQiB,SAAS2qD,KAAO,YAAc7rD,EAAQU,SAAW,oCAK/DxD,EAAOyhE,uBAAyB,WAC9B58D,EAAce,QAAQ,oBAAqB,MAC3Cf,EAAce,QAAQ,6BAA8B,MACpD3F,EAAOoB,OAAOk9D,SAAW,IAG3Bv+D,EAAO2yD,aAAe,SAAUniD,GAC9B,IAAKxP,EAAa6C,IAAI,iCAEpB,WADA5C,QAAOb,MAAM,8DAIf2wD,GAAYrgD,OAAOF,EAAM,SAAUvN,GAC7BA,GAAQA,EAAKoV,cACftV,EAAQiB,SAAS2qD,KAAO,YAAc7rD,EAAQU,SAAW,wBAA0BP,EAAKoV,YAAc,gBAK5GrY,EAAO20E,gBAAkB,WACvB,OAAQ30E,EAAOmN,UAAYnN,EAAOgqE,eAAiBhqE,EAAO40E,kBAG5D50E,EAAO60E,oBAAsB,WACP1rE,EAAO0B,MACzBC,YAAa,sDACb/K,WAAY,0CACZipC,KAAM,KACN5jC,SACEnC,KAAM,WACJ,OACE6xE,UAAW90E,EAAO8wE,qBAKZ5oE,OAAO3D,KAAK,SAAU2D,GAC7BA,GAILlI,EAAO+0E,uBAAuB7sE,MAIlClI,EAAO4xE,iBAAmB,SAAU1pE,GAClC,GAAIq2D,KAEJ,KAAK,GAAI9Q,KAAKztD,GAAOu+D,SACfv+D,EAAOu+D,SAAS9Q,GAAG/9C,IAAI/L,SACzB46D,EAAS9Q,MACT8Q,EAAS9Q,GAAG99C,KACZ4uD,EAAS9Q,GAAG1kD,KACZw1D,EAAS9Q,GAAG/9C,OAEZ1P,EAAOu+D,SAAS9Q,GAAGgnB,UAAUztE,QAAQ,SAAUytE,EAAWxxD,GACpDjjB,EAAOu+D,SAAS9Q,GAAG8mB,SAAStxD,IAAM/a,EAAOy1B,KAAO82C,GAAavsE,EAAO01B,MACtE2gC,EAAS9Q,GAAG99C,EAAEoO,KAAK/d,EAAOu+D,SAAS9Q,GAAG99C,EAAEsT,IACxCs7C,EAAS9Q,GAAG1kD,EAAEgV,KAAK/d,EAAOu+D,SAAS9Q,GAAG1kD,EAAEka,IACxCs7C,EAAS9Q,GAAG/9C,IAAIqO,KAAK/d,EAAOu+D,SAAS9Q,GAAG/9C,IAAIuT,OAI3Cs7C,EAAS9Q,GAAG/9C,IAAI/L,cACZ46D,GAAS9Q,GAKtB,OAAO8Q,IAGTv+D,EAAO+0E,uBAAyB,SAAU7sE,GACxClI,EAAO8wE,gBAAgBC,WAAa7oE,EAAOy1B,IAC3C39B,EAAO8wE,gBAAgBE,WAAa9oE,EAAO01B,IAC3C39B,EAAOoB,OAAOwuE,QAAU7vE,EAAO8wE,gBAAgBC,WAC/C9wE,EAAOoB,OAAOyuE,QAAU9vE,EAAO8wE,gBAAgBE,WAC/C7iE,EAAU7E,OAAO,UAAWtJ,EAAO8wE,gBAAgBC,YACnD5iE,EAAU7E,OAAO,UAAWtJ,EAAO8wE,gBAAgBE,WACnD,IAAIzS,GAAWv+D,EAAO4xE,iBAAiB1pE,EACvClI,GAAOmyE,sBAAwBjgE,OAAOC,KAAKosD,GAAU56D,OACrD3D,EAAOgyE,wBAA0B9/D,OAAO8vB,OAAOu8B,GAAUt4D,IAAI,SAAU4sE,GACrE,MAAOA,GAAQnjE,IAAI/L,SAClBia,OAAO,SAAUo3D,EAAKhwB,GACvB,MAAOgwB,GAAMhwB,GACZ,GAEHotB,EAAqB7T,IA5eI,WACzBv+D,EAAOgqE,aAAe,GACtBgG,EAAiB38D,cAAcrT,EAAOsT,iBAAiB/O,KAAK,SAAUtB,GAChEA,IAAMjD,EAAOisE,YAAchpE,KAC9BwH,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI4F,KAGdgiE,EAAiBz8D,sBACfC,OAAQxT,EAAOsT,kBACd/O,KAAK,SAAU0wE,GAChBj1E,EAAOmN,SAAU,EAEb8nE,GAAOA,EAAIZ,SACbr0E,EAAOgyE,wBAA0BiD,EAAIZ,OAAO1wE,OAE5C3D,EAAOu+D,YACP0W,EAAIpC,QAAQ7rE,QAAQ,SAAUS,EAAMwb,GAC7BjjB,EAAOu+D,SAAS92D,IASnBzH,EAAOu+D,SAAS92D,GAAMsB,EAAEgV,KAAKk3D,EAAIC,QAAQjyD,IACzCjjB,EAAOu+D,SAAS92D,GAAMkI,EAAEoO,KAAKk3D,EAAIE,QAAQlyD,IACzCjjB,EAAOu+D,SAAS92D,GAAMiI,IAAIqO,KAAKk3D,EAAIZ,OAAOpxD,KAV1CjjB,EAAOu+D,SAAS92D,IACdsB,GAAIksE,EAAIC,QAAQjyD,IAChBtT,GAAIslE,EAAIE,QAAQlyD,IAChBvT,KAAMulE,EAAIZ,OAAOpxD,IACjBsxD,YACAE,gBASNzE,EAAiBz8D,sBACfC,OAAQxT,EAAOsT,gBACf8hE,UAAU,IACT7wE,KAAK,SAAUtB,GAChB,OAAajB,KAATiB,EAAoB,CACtBjD,EAAOm0E,YAAclxE,EAErBjD,EAAO80E,WACLP,YACAE,aAGF,KAAK,GAAIhnB,KAAKztD,GAAOu+D,SACfv+D,EAAOu+D,SAAS9Q,IAAMztD,EAAOu+D,SAAS9Q,GAAG/9C,KAAO1P,EAAOu+D,SAAS9Q,GAAG/9C,IAAI/L,QACzE3D,EAAOu+D,SAAS9Q,GAAG/9C,IAAI1I,QAAQ,SAAU0I,GACvC,KAAMs4D,GAAO/kE,EAAKoxE,OAAOpM,UAAU,SAAUxgE,GAC3C,MAAOA,KAASiI,KAGJ,IAAVs4D,IAEFhoE,EAAO80E,UAAUP,SAASx2D,KAAK9a,EAAKsxE,SAASvM,IAC7ChoE,EAAO80E,UAAUL,UAAU12D,KAAK9a,EAAKwxE,UAAUzM,IAC/ChoE,EAAOu+D,SAAS9Q,GAAG8mB,SAASx2D,KAAK9a,EAAKsxE,SAASvM,IAC/ChoE,EAAOu+D,SAAS9Q,GAAGgnB,UAAU12D,KAAK9a,EAAKwxE,UAAUzM,MAOzDhoE,GAAO8wE,gBAAgBnzC,IAAMz8B,KAAKy8B,IAAIzhB,MAAM,KAAMlc,EAAO80E,UAAUP,UACnEv0E,EAAO8wE,gBAAgBlzC,IAAM18B,KAAK08B,IAAI1hB,MAAM,KAAMlc,EAAO80E,UAAUL,WAE/Dz0E,EAAO2xE,sBACT3xE,EAAO+0E,wBACLp3C,IAAK03C,SAASlnE,EAAU7E,SAASumE,SACjCjyC,IAAKy3C,SAASlnE,EAAU7E,SAASwmE,cAItCrlE,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI4F,KAEdhO,EAAOmyE,sBAAwBjgE,OAAOC,KAAKnS,EAAOu+D,UAAU56D,OAEvD3D,EAAO2xE,sBACVS,EAAqBpyE,EAAOu+D,aAG/B9zD,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI4F,GACZhO,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,4CA0ZzBjqE,WAAW,2CAAA,SAAA,iBAAA,OAAA,UAA2C,SAAUC,EAAQwjB,EAAgBvgB,EAAMH,GAC/F9C,EAAOs1E,cACPt1E,EAAOs1E,WAAWrT,SAAWh/D,EAAK6xE,UAAUl3C,IAC5C59B,EAAOs1E,WAAWn3C,IAAM,gBAAkBr7B,EAAQU,SAAW,gCAC7DxD,EAAOu1E,qBAAsB,EAC7Bv1E,EAAO80E,UAAY7xE,EAAK6xE,WAAa7xE,EAAK6xE,UAAU9D,YAClDrzC,IAAK99B,QAAQ8N,KAAK1K,EAAK6xE,UAAU/D,YACjCnzC,IAAK36B,EAAK6xE,UAAU9D,aAEpBrzC,IAAK,EACLC,IAAK59B,EAAOs1E,WAAWrT,UAGzBjiE,EAAOw1E,cAAgB,WACrBhyD,EAAeyC,OACb0X,IAAK16B,EAAK6xE,UAAUn3C,IACpBC,IAAK36B,EAAK6xE,UAAUl3C,OAIxB59B,EAAOy1E,aAAe,WACpBjyD,EAAeyC,MAAMjmB,EAAO80E,eAE7B/0E,WAAW,8BAAA,iBAAA,mBAAA,SAA8B,SAAUyjB,EAAgBwsD,EAAkB/uE,GACtFiR,OAAOzJ,OAAOnI,MACZ2zB,WAAY,WACV3zB,KAAK6M,SACHxI,MAAM,EACN+wE,QAAQ,EAEV,IAAInlE,GAAOjQ,KAAKiQ,OAChBjQ,MAAK2C,MACH3B,KAAM,KACNq0E,WACAt0E,QACEu0E,UAAW,EACXC,kBAAmB,GACnBC,eAAgB,MAGpBx1E,KAAK6yC,QACL7yC,KAAK6M,QAAQxI,MAAO,EACpBqrE,EAAiBh8D,sBACf3G,WAAW,IACV9I,KAAK,SAAUI,GAChBrE,KAAK6M,QAAQxI,MAAO,EACpB4L,EAAK5L,KAAOA,EAAKsB,IAAI,SAAUooD,GAC7B,OACE/sD,KAAM+sD,EAAI/sD,KACVuP,MAAOw9C,EAAI76C,WAGfrN,KAAK7F,QAEToQ,OAAQ,WACN,GAAIkgD,GAAQtwD,IAEZA,MAAK6M,QAAQuoE,QAAS,CAEtB,KACE,MAAO1F,GAAiBt/D,QACtBpP,KAAMhB,KAAK2C,KAAK3B,KAChBq0E,QAASr1E,KAAK2C,KAAK0yE,QACnBt0E,OAAQf,KAAK2C,KAAK5B,SACjBkD,KAAK,SAAUwkE,GAChBvlD,EAAeyC,OACbvV,QAAQ,EACRq4D,gBAAiBA,KAEnB5iE,KAAK7F,OACP,MAAOF,GACPE,KAAK6M,QAAQuoE,QAAS,EACtBv1E,QAAQC,MAAMA,GAGhBqoD,aAAatV,SACbA,QAAU79B,WAAW,WACnBs7C,EAAMzjD,QAAQuoE,QAAS,GACtB,MAELzpE,OAAQ,SAAUtE,GAChBrH,KAAK6M,QAAQxI,MAAO,EACpBrE,KAAK6M,QAAQuoE,QAAS,EACtBlyD,EAAeyC,OACbha,QAAQ,EACRtE,IAAKA,KAGTshE,WAAY,WACV,MAAO3oE,MAAK2C,MAAQ3C,KAAK2C,KAAK3B,MAAQhB,KAAK2C,KAAK3B,KAAKqC,OAAS,GAAKrD,KAAK2C,KAAK0yE,WAGjFr1E,KAAK2zB,gBAENvM,UAAU,aAAc,WACvB,OACEC,SAAU,IACVC,OACEtU,gBAAiB,IACjBy8D,YAAa,IACb5E,SAAU,KAEZprE,WAAY,eACZqL,aAAc,aACdN,YAAa,kDAEd/K,WAAW,yBAAA,SAAA,iBAAA,mBAAA,OAAyB,SAAUC,EAAQwjB,EAAgBwsD,EAAkB/sE,GACzFjD,EAAOivC,UAAYhsC,EAAKgsC,UAExBjvC,EAAO+1E,mBAAqB,SAAUppE,GACpC1J,EAAKgsC,UAAYtiC,EACjB3M,EAAOg2E,aAAc,EACrBh2E,EAAOi2E,QAAU,GACjBjG,EAAiBn8D,qBAAqB5Q,GAAMsB,KAAK,SAAUtB,GACzDjD,EAAOg2E,aAAc,EAEjB/yE,EAAK7C,MACPJ,EAAOi2E,QAAUhzE,EAAK7C,MAEtBojB,EAAeyC,WAKrBjmB,EAAOk2E,iBAAmB,WACxBl2E,EAAOi2E,QAAU,SAElBl2E,WAAW,gBAAA,SAAA,QAAA,eAAA,mBAAA,oBAAA,mCAAA,UAAA,YAAA,cAAA,SAAA,SAAA,gBAAgB,SAAUC,EAAQqE,EAAOrD,EAAcgvE,EAAkB5E,EAAmBlE,EAAkCpkE,EAASovC,EAAW6e,EAAa9vD,EAAQkI,EAAQtE,GAC3L7E,EAAOmN,SAAU,EACjBnN,EAAOm2E,cAAe,EACtBn2E,EAAOgqE,aAAe,GACtBhqE,EAAOuD,WAAaT,EAAQU,SAC5BxD,EAAOo2E,WACPp2E,EAAOq2E,gBACPr2E,EAAOs2E,oBACLhzE,KAAM,EACNwO,MAAO,IACPC,OAAQ,EACRwkE,WAAY,EACZC,WAAY,GAEdx2E,EAAOqrE,OACL/hE,SACEX,MAAO,MACPiY,KAAM,MACNlc,YAAa,2BAEbiE,MAAO,cACPiY,KAAM,mBACNlc,YAAa,sCAEbiE,MAAO,WACPiY,KAAM,gBACNlc,YAAa,mCAEbiE,MAAO,WACPiY,KAAM,gBACNlc,YAAa,mCAEbiE,MAAO,cACPiY,KAAM,mBACNlc,YAAa,sCAEf6N,aACE8V,MAAO,WACPzH,KAAM,UACNjY,MAAO,IAEP0f,MAAO,WACPzH,KAAM,cACNjY,MAAO,IAEP0f,MAAO,cACPzH,KAAM,QACNjY,OAAQ,KAGZ3I,EAAOuS,YACL7H,OAAQ1K,EAAOqrE,MAAM94D,WAAW,IAElCvS,EAAOy2E,mBAAqBz2E,EAAOqrE,MAAM/hE,OAAO,GAChDtJ,EAAO0xD,gBACP1xD,EAAO02E,SACL5uE,MAAO,EACPX,OAEFnH,EAAO22E,gBAAiB,EACxB32E,EAAO6yB,UACLjuB,QAAS,KACTutC,SAAU,KAEZ,IAAIgB,GACAyjC,GAAoB,CAEpB52E,GAAO+vE,aAAe/vE,EAAO+vE,YAAYrgE,KAC3C1P,EAAO62E,YACP72E,EAAO62E,SAAS94D,KAAK/d,EAAO+vE,aAC5B/vE,EAAO02E,QAAQ5uE,MAAQ,EACvB9H,EAAO+vE,YAAYrgE,IAAI1I,QAAQ,SAAUic,GACvC,MAAOjjB,GAAO02E,QAAQvvE,GAAG4W,KAAKkF,OAGhCjjB,EAAO62E,SAAW3kE,OAAO8vB,OAAOhiC,EAAO+vE,aACvC/vE,EAAO02E,QAAQ5uE,MAAQ9H,EAAO62E,SAASlzE,OACvC3D,EAAO62E,SAAS7vE,QAAQ,SAAU/D,GAChCA,EAAKyM,IAAI1I,QAAQ,SAAUic,GACzB,MAAOjjB,GAAO02E,QAAQvvE,GAAG4W,KAAKkF,QAKpCpe,EAAce,QAAQ,uBAAwBL,KAAKM,UAAU7F,EAAO+vE,cACpEC,EAAiB38D,cAAcrT,EAAOsT,iBAAiB/O,KAAK,SAAUtB,GAChEA,IAAMjD,EAAOisE,YAAchpE,KAC9BwH,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI4F,KAGdhO,EAAOuvE,gBAAkB,SAAU9nE,GACjCzH,EAAOy2E,mBAAqBhvE,EAC5BzH,EAAOyT,gBAAe,GAAMlP,KAAK,WAC/BkkD,aAAatV,GACbA,EAAU79B,WAAW,WACnBtV,EAAO82E,sBACP92E,EAAO+2E,oBACN,QAIP/2E,EAAOg3E,eAAiB,WACtB12E,KAAKg2E,mBAAmBvkE,OAAS/R,EAAOs2E,mBAAmBhzE,KAAO,EAClEtD,EAAOyT,kBAGTzT,EAAOi3E,eAAiB,WACtB,MAAOj3E,GAAOs2E,mBAAmBC,YAAcv2E,EAAOs2E,mBAAmBC,WAAav2E,EAAOs2E,mBAAmBxkE,OAGlH9R,EAAOyT,eAAiB,SAAUyjE,GAChC,IAAKl3E,EAAO02E,QAAQvvE,GAAGxD,OACrB,MAAO3D,GAAOm3E,uBAGhBn3E,GAAOkd,OACP,IAAIw5D,EAaJ,OAZA12E,GAAOo3E,eAAgB,EAEnBF,IACFl3E,EAAOs2E,mBAAmBhzE,KAAO,EACjCtD,EAAOs2E,mBAAmBvkE,OAAS,GAGrC/R,EAAOs2E,mBAAmBxkE,MAAQ,IAClC9R,EAAOs2E,mBAAmBC,WAAav2E,EAAO02E,QAAQvvE,GAAGxD,OACzD+yE,EAAU12E,EAAO02E,QAAQvvE,GAAGxG,OAAO,SAAUwG,EAAI8b,EAAG/N,GAClD,MAAO+N,IAAKjjB,EAAOs2E,mBAAmBvkE,OAAS/R,EAAOs2E,mBAAmBxkE,OAASmR,EAAIjjB,EAAOs2E,mBAAmBhzE,KAAOtD,EAAOs2E,mBAAmBxkE,QAE5Ik+D,EAAiBv8D,gBACtB5C,MAAO7Q,EAAOsT,gBACd5D,IAAKgnE,EACLptE,OAAQtJ,EAAOy2E,mBAAmB9tE,QACjCpE,KAAK,SAAUtB,GAChB,KAAMo0E,KACNnlE,QAAO8vB,OAAOhiC,EAAO62E,UAAU7vE,QAAQ,SAAU6rE,GAC/C3gE,OAAOolE,QAAQzE,GAAS7rE,QAAQ,SAAUuwE,GACxB,OAAZA,EAAM,IACRA,EAAM,GAAGvwE,QAAQ,SAAUG,GACzB,KAAMqwE,GAAUv0E,EAAK0vB,KAAK,SAAUjjB,GAClC,MAAOA,GAAI2kE,SAAWltE,GAGpBqwE,KACFA,EAAQ3E,QAAUA,EAAQvxE,KAC1B+1E,EAAYt5D,KAAKy5D,UAM3Bx3E,EAAOs2E,mBAAmBE,WAAat1E,KAAKgoB,KAAKlpB,EAAOs2E,mBAAmBC,WAAav2E,EAAOs2E,mBAAmBxkE,OAClH9R,EAAOs2E,mBAAmBxkE,MAAQ,IAClC9R,EAAOmN,SAAU,EACjBnN,EAAOo2E,QAAUiB,EACjBr3E,EAAOo3E,eAAgB,EACvBp3E,EAAOy3E,wBACPz3E,EAAO03E,0BACNjtE,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI4F,GACZhO,EAAOm3E,2BAIXn3E,EAAOyT,iBAEPzT,EAAO03E,sBAAwB,WAC7B13E,EAAO23E,kBACP33E,EAAO62E,SAAS7vE,QAAQ,SAAU6rE,GAChC7yE,EAAO23E,eAAe9E,EAAQvxE,MAAQuxE,EAAQnjE,OAIlD1P,EAAO43E,aAAe,WACpB,IAAK52E,EAAa6C,IAAI,iCAEpB,WADA5C,GAAOb,MAAM,4DAIf,IAAIiB,IACFwP,MAAO7Q,EAAOsT,gBACd5D,IAAK1P,EAAO02E,QAAQvvE,GACpB0rE,QAAS7yE,EAAO23E,eAChBruE,OAAQtJ,EAAOy2E,mBAAmB9tE,MAClCsmC,UAAWjuC,EAAaguC,gBAAkB,GAGL,aAAnChvC,EAAOy2E,mBAAmB9tE,MAC5BtH,EAAOsS,SAAU,EAC2B,YAAnC3T,EAAOy2E,mBAAmB9tE,MACnCtH,EAAOuS,SAAU,EACZvS,EAAOqC,KAAM,EAEpB1D,EAAO63E,gBAAgBx2E,IAGzBrB,EAAO63E,gBAAkB,SAAUC,GACX3uE,EAAO0B,MAC3B9K,WAAY,wBACZ+K,YAAa,mDACb1F,SACEnC,KAAM,WACJ,MAAO60E,KAGXrwD,UAAU,IAEEvf,OAAO3D,KAAK,WACxBtD,EAAOmH,IAAI,+EAIfpI,EAAOm3E,sBAAwB,WAC7Bn3E,EAAOmN,SAAU,EACjBnN,EAAOo3E,eAAgB,EACvBp3E,EAAOgqE,aAAe;EAGxBhqE,EAAOy3E,sBAAwB,WAC7B,KAAMx0E,GAAOjD,EAAOo2E,OAEpB,IAAInzE,GAA4C,aAApCjD,EAAOy2E,mBAAmB9tE,MAAsB,CAC1D,GAAI2T,KACJrZ,GAAK+D,QAAQ,SAAUS,GAChB6U,EAAM7U,EAAK0M,SAOdmI,EAAM7U,EAAK0M,SAASvP,QAAQmZ,KAAKtW,GANjC6U,EAAM7U,EAAK0M,UACThN,GAAIM,EAAK0M,QACTkI,KAAM5U,EAAK4U,KACXzX,SAAU6C,KAMhB,MAAMyV,GAAOhL,OAAO8vB,OAAO1lB,GAAOrW,IAAI,SAAUoW,GAC9C,OACElV,GAAIkV,EAAKlV,GACTkV,KAAMA,EAAKA,KACXzX,QAAS5E,EAAO+3E,mBAAmB17D,EAAKzX,WAG5C5E,GAAOkd,KAAOA,MACT,IAAIja,GAA4C,gBAApCjD,EAAOy2E,mBAAmB9tE,MAAyB,CAGpE,GAFA3I,EAAOg4E,OAEHh4E,EAAO02E,QAAQ5uE,MAAQ,EAAG,CAC5B,GAAImwE,KACJj4E,GAAO62E,SAAS7vE,QAAQ,SAAUgtB,GAChCikD,EAAMl6D,MAAMiW,MAEdikD,EAAMjxE,QAAQ,SAAUgtB,EAAKzd,GAC3BvW,EAAOg4E,IAAIzhE,IACTpP,GAAI6sB,EAAI,GAAG6+C,SAAW7+C,EAAI,GAAG1yB,KAC7BuxE,QAAS7+C,EAAI,GAAG6+C,SAAW7+C,EAAI,GAAG1yB,KAClCsD,QAAS5E,EAAO+3E,mBAAmB90E,EAAM+wB,EAAI,GAAGtkB,YAIpD1P,GAAOg4E,IAAI,IACT7wE,GAAInH,EAAO62E,SAAS,GAAGhE,SAAW7yE,EAAO62E,SAAS,GAAGv1E,KACrDuxE,QAAS7yE,EAAO62E,SAAS,GAAGhE,SAAW7yE,EAAO62E,SAAS,GAAGv1E,KAC1DsD,QAAS5E,EAAO+3E,mBAAmB90E,GAIvCjD,GAAOkd,KAAOhL,OAAO8vB,OAAOhiC,EAAOg4E,SAC9B,IAAI/0E,GAA4C,gBAApCjD,EAAOy2E,mBAAmB9tE,MAAyB,CACpE,GAAIuvE,KACJj1E,GAAK+D,QAAQ,SAAU8N,GAChBojE,EAAWpjE,EAAIZ,YAOlBgkE,EAAWpjE,EAAIZ,YAAYtP,QAAQmZ,KAAKjJ,GANxCojE,EAAWpjE,EAAIZ,aACb/M,GAAI2N,EAAIZ,WACR84D,YAAal4D,EAAImzC,gBACjBrjD,SAAUkQ,KAMhB,MAAMoI,GAAOhL,OAAO8vB,OAAOk2C,GAAYjyE,IAAI,SAAU+tB,GACnD,OACE7sB,GAAI6sB,EAAI7sB,GACR6lE,YAAah5C,EAAIg5C,aAAe,mBAChCpoE,QAAS5E,EAAO+3E,mBAAmB/jD,EAAIpvB,WAG3C5E,GAAOkd,KAAOA,MAE0B,aAApCld,EAAOy2E,mBAAmB9tE,OAC5B1F,EAAK4yB,KAAK,SAAU3gB,EAAG6a,GACrB,MAAO7a,GAAEs2C,aAAez7B,EAAEy7B,aAAe,GAAK,IAIlDxrD,EAAOkd,QACPld,EAAOkd,KAAKa,MACVnZ,UACE0N,KAAMrP,OAMdjD,EAAO+3E,mBAAqB,SAAU90E,EAAMk1E,GAC1C,KAAM7lE,GAAO6lE,EAAOl1E,EAAKtC,OAAO,SAAUuU,EAAG+N,GAC3C,MAAOk1D,GAAKv0E,SAASsR,EAAEm/D,UACpBpxE,CACL,IAAI2B,KAaJ,OAZA0N,GAAKtL,QAAQ,SAAUS,GACrB,KAAM9E,GAAM8E,EAAKwgD,gBAAkBxgD,EAAKwgD,gBAAkB,IAAMxgD,EAAK0qC,SAAW,kBAE3EvtC,GAAQjC,GAMXiC,EAAQjC,GAAK2P,KAAKyL,KAAKtW,GALvB7C,EAAQjC,IACNA,IAAKA,EACL2P,MAAO7K,MAMNyK,OAAO8vB,OAAOp9B,IAGvB5E,EAAO8tE,aAAe,SAAU56D,EAAOa,EAAOjH,GACxCA,IACFA,EAAO7K,iBACP6K,EAAOgtB,mBAGTsxC,EAAkBhtB,QAAQ4xB,EAAiBl8D,eAAeZ,EAAOa,IAAQ,IAG3E/T,EAAO2tE,oBAAsB,SAAU74D,GACrC,GAAI61C,GAAa7nD,EAAQU,SACrBoqE,GAAO,MAAO94D,EAAIw/D,SAAUx/D,EAAIsjE,cAAetjE,EAAI0/D,SAAU1/D,EAAIujE,eAAetoE,KAAK,IACzF,OAAO+E,GAAM,YAAc61C,EAAa,qBAAuB71C,EAAI63D,aAAe,MAAQiB,EAAM,IAGlG5tE,EAAOuyD,YAAc,WACnBvyD,EAAOwxD,eAAiBxxD,EAAOwxD,eAGjCxxD,EAAOs4E,cAAgB,WACrBt4E,EAAOm2E,cAAgBn2E,EAAOm2E,cAGhCn2E,EAAOwyD,oBAAsB,WAC3B,MAAOxyD,GAAOq2E,cAAgBr2E,EAAOq2E,aAAa1yE,QAAU3D,EAAO0xD,aAAae,cAAgBzyD,EAAO0xD,aAAae,aAAat1C,OAAOxZ,OAAS,GAGnJ3D,EAAO0yD,WAAa,WAClB1yD,EAAOwxD,eAAgB,GAGzBxxD,EAAO2yD,aAAe,WAChB3yD,EAAOq2E,aAAa1yE,SACtB3D,EAAOyxD,kBAAmB,EAE1BV,EAAYrgD,QACVkiD,cAAe5yD,EAAO0xD,aAAae,aACnCpxD,OAAQrB,EAAOq2E,aACfkC,gBAAgB,GACf,SAAUt1E,GACXjD,EAAOyxD,kBAAmB,EAC1BzxD,EAAO0yD,aAEHzvD,GAAQA,EAAKoV,aACf04C,EAAY34C,qBACVC,YAAapV,EAAKoV,YAClB3I,IAAK1P,EAAOq2E,cACX,SAAUpzE,GACXjD,EAAO0xD,gBACPzwD,EAAOmH,IAAI,6IAOrBpI,EAAOw4E,uBAAyB,WAC9B,MAAOx3E,GAAa6C,IAAI,kCAG1B7D,EAAOy4E,cAAgB,WACrB,IAAKz3E,EAAa6C,IAAI,iCAEpB,WADA5C,GAAOb,MAAM,8DAIf,MAAuC,IAAnCJ,EAAOuS,WAAW7H,OAAO/B,OAAiB3I,EAAO6yB,SAASjuB,SAAY5E,EAAO6yB,SAASsf,UAExF,WADAlxC,GAAOb,MAAM,wFAIf,MAAuC,IAAnCJ,EAAOuS,WAAW7H,OAAO/B,OAAiB3I,EAAO6yB,SAASjuB,SAAY5E,EAAO6yB,SAASsf,UAExF,WADAlxC,GAAOb,MAAM,uFAIfJ,GAAO22E,gBAAiB,CACxB,IAAInmE,IACFd,IAAK1P,EAAOq2E,aACZvK,UAAW9rE,EAAOuS,WAAW7H,OAAO/B,MAEtC,MAAM+vE,IAAwD,IAApC14E,EAAOuS,WAAW7H,OAAO/B,KACnD6H,GAAKkJ,aAAeg/D,EAAoB,KAAO14E,EAAO6yB,SAASjuB,QAAQqjD,gBACvEz3C,EAAK23C,cAAgBuwB,EAAoB,KAAO14E,EAAO6yB,SAASsf,SAAS7wC,KACzEkP,EAAK0D,WAAawkE,EAAoB,KAAO14E,EAAO6yB,SAASjuB,QAAQuC,GACrEqJ,EAAKyP,YAAcy4D,EAAoB,KAAO14E,EAAO6yB,SAASsf,SAAShrC,GACvEshD,aAAatV,GACbA,EAAU79B,WAAW,WACnB4xD,EAAiCv2D,SAASH,GAAMjM,KAAK,SAAUtB,GAC7D9C,QAAQwY,KAAK,oBAAqB1V,GAElCjD,EAAO24E,iCACP34E,EAAO44E,gBACP54E,EAAOq2E,gBAEgC,IAAnCr2E,EAAOuS,WAAW7H,OAAO/B,OAC3B1H,EAAOmH,IAAI,2CAA6CpI,EAAO6yB,SAASjuB,QAAQqjD,gBAAkB,IAAMjoD,EAAO6yB,SAASsf,SAAS7wC,MAGnItB,EAAO6yB,UACLjuB,QAAS,KACTutC,SAAU,MAEZnyC,EAAO+2E,mBACP/2E,EAAOyT,mBACN44C,QAAQ,WACTrsD,EAAO22E,gBAAiB,KAEzB,MAGL32E,EAAO24E,+BAAiC,WACtC34E,EAAOkd,KAAKlW,QAAQ,SAAUgtB,GAC5BA,EAAIpvB,QAAQoC,QAAQ,SAAU6rE,GAC5BA,EAAQvgE,KAAKtL,QAAQ,SAAU8N,GACzB9U,EAAOq2E,aAAazyE,SAASkR,EAAIu/D,UACnCv/D,EAAIg3D,UAAY9rE,EAAOuS,WAAW7H,OAAO/B,cAOnD3I,EAAO44E,cAAgB,WACrB54E,EAAOkd,KAAKlW,QAAQ,SAAUgtB,GAC5BA,EAAIpvB,QAAQoC,QAAQ,SAAU6rE,GAC5BA,EAAQvgE,KAAKtL,QAAQ,SAAU8N,GACzBA,EAAI+d,WACN/d,EAAI+d,UAAW,UAOzB7yB,EAAO82E,oBAAsB,WAC3B92E,EAAOkd,KAAKlW,QAAQ,SAAUgtB,GAC5BA,EAAIpvB,QAAQoC,QAAQ,SAAU6rE,GAC5BA,EAAQvgE,KAAKtL,QAAQ,SAAU8N,GACzB9U,EAAOq2E,aAAazyE,SAASkR,EAAIu/D,UACnCv/D,EAAI+d,UAAW,UAOzBqf,EAAU5tC,IAAI,SAAUwb,GACtB9f,EAAOuoD,UAAYzoC,IAGrB9f,EAAOwoD,cAAgB,SAAUl/C,GAG/B,MAFAtJ,GAAO6yB,SAASsf,SAAW,KAC3BnyC,EAAO22E,gBAAiB,EACjBtyE,EAAMC,IAAI,uBACfjD,QACEwe,EAAGvW,KAEJ/E,KAAK,SAAU2D,GAEhB,MADAlI,GAAO22E,gBAAiB,EACjBzuE,EAAOjF,QAIlBjD,EAAOsjD,SAAW,SAAUx2C,EAAQksB,GAClC14B,KAAKi4B,cAAgBS,EAAYT,aACjC,IAAIgrB,GAAYvqB,EAAYT,cAAcirB,QACtCyrB,EAAYj2C,EAAYJ,QAAQs2C,OAAOn9D,SAASmoB,GACpD55B,MAAK2uE,UAAwB,EAAZA,EACjB3uE,KAAKmjD,mBAAqBF,EAAY0rB,EAGxC,IAAI4J,GAA0B,WAiB5B,MAhBA74E,GAAOkd,KAAKlW,QAAQ,SAAUgtB,GAC5BA,EAAIpvB,QAAQoC,QAAQ,SAAU6rE,GAC5BA,EAAQvgE,KAAKtL,QAAQ,SAAU8N,GAK7B,IAJqB,IAAjBA,EAAI+d,UAAsB7yB,EAAOq2E,aAAazyE,SAASkR,EAAIu/D,SAC7Dr0E,EAAOq2E,aAAat4D,KAAKjJ,EAAIu/D,SAGV,IAAjBv/D,EAAI+d,UAAsB7yB,EAAOq2E,aAAazyE,SAASkR,EAAIu/D,QAAS,CACtE,KAAM99D,GAAQvW,EAAOq2E,aAAapO,UAAU,SAAUxgE,GACpD,MAAOA,KAASqN,EAAIu/D,QAEtBr0E,GAAOq2E,aAAa9nD,OAAOhY,EAAO,UAKnCvW,EAAOq2E,aAGhBr2E,GAAOkxE,cAAgB,SAAU2B,GAC/B,KAAMiG,GAAajG,EAAQhgD,QAC3BggD,GAAQvgE,KAAOugE,EAAQvgE,KAAKrM,IAAI,SAAU6O,GAExC,MADAA,GAAI+d,UAA0B,IAAfimD,EACRhkE,IAET9U,EAAOq2E,aAAewC,IACtB74E,EAAO+2E,mBAGT,IAAIgC,GAAwB,WAC1B,GAAIC,KAMJ,OALAh5E,GAAOkd,KAAKlW,QAAQ,SAAUgtB,GAC5BA,EAAIpvB,QAAQoC,QAAQ,SAAU6rE,GAC5BmG,EAAqBA,EAAmBl0B,OAAO+tB,EAAQvgE,UAGpD0mE,EAITh5E,GAAOi5E,gBAAkB,SAAU/gE,GAGjC,GAFA0+D,EAAoB1+D,EAAMod,SAEH,CACrB,KAAM0jD,GAAqBD,IACrBG,EAAuBL,IACvBM,EAAWH,EAAmB/Q,UAAU,SAAUxrD,GACtD,MAAOA,GAAE43D,SAAW6E,EAAqB,KAErCE,EAAYJ,EAAmB/Q,UAAU,SAAUoR,GACvD,MAAOA,GAAIhF,SAAW6E,EAAqBA,EAAqBv1E,OAAS,KAErE21E,GAAeH,EAAUC,GAAWvjD,KAAK,SAAU3gB,EAAG6a,GAC1D,MAAO7a,GAAI6a,IAEPwpD,EAAqBP,EAAmBr4E,OAAO,SAAU64E,EAAMjjE,GACnE,MAAOA,IAAS+iE,EAAY,IAAM/iE,GAAS+iE,EAAY,KAEnDtB,EAAMuB,EAAmBtzE,IAAI,SAAUozE,GAC3C,MAAOA,GAAIhF,QAEbr0E,GAAOkd,KAAKlW,QAAQ,SAAUgtB,GAC5BA,EAAIpvB,QAAQoC,QAAQ,SAAU6rE,GAC5BA,EAAQvgE,KAAKtL,QAAQ,SAAU8N,GACzBkjE,EAAIp0E,SAASkR,EAAIu/D,UACnBv/D,EAAI+d,UAAW,SAOzB7yB,EAAOq2E,aAAewC,IACtBpwB,aAAatV,GACbA,EAAU79B,WAAW,WACnBtV,EAAO+2E,oBACN,MAIL/2E,EAAO+2E,iBAAmB,WACxB,KAAM0C,GAASj4E,SAASk4E,iBAAiB,wBACzC,IAAKD,EAAO91E,OAAZ,CACA,GAAI4S,GAAQ,CACZvW,GAAOkd,KAAKlW,QAAQ,SAAUgtB,GAC5BA,EAAIpvB,QAAQoC,QAAQ,SAAU6rE,GAC5B,KAAMwD,GAAexD,EAAQvgE,KAAK3R,OAAO,SAAUmU,GACjD,MAAOA,GAAI+d,UAGRwjD,GAAa1yE,OAGP0yE,EAAa1yE,SAAWkvE,EAAQvgE,KAAK3O,QAC9C81E,EAAOljE,GAAOojE,eAAgB,EAC9BF,EAAOljE,GAAOyc,SAAU,IAExBymD,EAAOljE,GAAOyc,SAAU,EACxBymD,EAAOljE,GAAOojE,eAAgB,IAP9BF,EAAOljE,GAAOyc,SAAU,EACxBymD,EAAOljE,GAAOojE,eAAgB,GAShCpjE,aCx6CR1W,QAAQC,OAAO,+BAAgC,eAAgB,yBAA0B,yBAA0B,cAAe,iBAAkB,SAAU,cAAcqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC3Mo1C,EAAeC,MAAM,qCACnB9vC,IAAK,4BACLmD,YAAa,gDAEf0sC,EAAeC,MAAM,4BACnB9vC,IAAK,mBACL5H,WAAY,sBACZ+K,YAAa,4CAEf0sC,EAAeC,MAAM,oCACnB9vC,IAAK,sCACL5H,WAAY,sBACZ+K,YAAa,+CAEd/K,WAAW,uBAAA,SAAA,SAAA,WAAA,YAAA,SAAA,KAAA,oBAAA,eAAA,SAAA,eAAA,UAAuB,SAAUC,EAAQmJ,EAAQojD,EAAUp+C,EAAWlN,EAAQ8D,EAAIqqD,EAAmBpuD,EAAcf,EAAQupE,EAAc1mE,GACrJ9C,EAAO2qE,0BAA4BnB,EAAa53D,kBAChD5R,EAAOmN,SACL+P,MAAM,EACNkqD,gBAAgB,GAElBpnE,EAAOs2E,oBACLhzE,KAAM,EACNwO,MAAO,GACPC,OAAQ,EACR6nE,UAAW,EACXpD,WAAY,GAEdx2E,EAAOsJ,QACLuW,EAAG,GAEL,IAAIszB,EACJnzC,GAAO6tE,yBAA2B,SAAU1sD,GAC1C,GAAIysD,EAMJ,OAJIzsD,IAAYA,EAAS42C,KACvB6V,GAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,MAGlEoR,EAAW,YAAcA,EAAS04D,mBAAqB,mBAAqB14D,EAASzJ,UAAY,MAAQk2D,EAAM,IACrH5tE,EAAO0qE,WAAa,SAAUoP,GAC/B95E,EAAO2qE,0BAA4BmP,EAE9BA,EAGH75E,EAAOiC,GAAG,oCACR0P,kBAAmBkoE,IAHrB75E,EAAOiC,GAAG,gCAQdlC,EAAOg3E,eAAiB,WACtB12E,KAAKg2E,mBAAmBvkE,OAAS/R,EAAOs2E,mBAAmBhzE,KAAO,EAClEtD,EAAO+5E,wBAGT/5E,EAAOmX,OAAS,SAAU3E,EAAiB1F,GAGzC,GAFAA,EAAOgtB,mBAEF94B,EAAa6C,IAAI,4BAEpB,WADA5C,GAAOb,MAAM,uDAIfJ,GAAOg6E,OAASxnE,EAAgBlR,KACV6H,EAAO0B,MAC3BC,YAAa,0DACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,SAAUjD,GAClC8tD,EAAkBj4C,OAAO3E,EAAgBrL,IACvC7F,KAAMA,IACLiD,KAAK,WACNvE,EAAO+5E,4BAKb/5E,EAAO+5E,qBAAuB,WAI5B,MAHA/5E,GAAOmN,QAAQ+P,MAAO,EACtBld,EAAOgtD,UAAW,EAClBhtD,EAAOi6E,eAAgB,EAChB7qB,EAAkB7+C,MACvBlD,WAAW,EACXwS,EAAG7f,EAAOsJ,OAAOuW,EACjB/N,MAAO9R,EAAOs2E,mBAAmBxkE,MACjCC,OAAQ/R,EAAOs2E,mBAAmBvkE,OAAS/R,EAAOs2E,mBAAmBxkE,QACpEvN,KAAK,SAAUtB,GAChBjD,EAAOk6E,yBAA2Bj3E,EAAKsN,KACvCvQ,EAAOm6E,qBAAuBl3E,EAAKsN,KACnCvQ,EAAOs2E,mBAAmBsD,UAAY32E,EAAK6E,MAC3C9H,EAAOs2E,mBAAmBE,WAAat1E,KAAKgoB,KAAKlpB,EAAOs2E,mBAAmBsD,UAAY55E,EAAOs2E,mBAAmBxkE,OACjH9R,EAAOgtD,UAAW,EAClBhtD,EAAOmN,QAAQ+P,MAAO,EAElBja,GAAQA,EAAKsN,KAAK5M,SACpB3D,EAAOmN,QAAQi6D,gBAAiB,MAKtCpnE,EAAO40B,gBAAkB,WACvB6zB,aAAatV,GACbA,EAAU79B,WAAW,WACftV,EAAOsJ,OAAOuW,EAAE1C,OAAOxZ,OAAS,GAAK3D,EAAOsJ,OAAOuW,EAAE1C,OAAOxZ,OAAS,IACzE3D,EAAOo6E,kBACPp6E,EAAO+5E,yBACN,MAGL/5E,EAAOq6E,aAAe,WACpB,MAAOr6E,GAAOm6E,sBAAwBn6E,EAAOm6E,qBAAqBx2E,QAAU3D,EAAOsJ,OAAOuW,EAAE1C,OAAOxZ,OAAS,GAG9G3D,EAAOo6E,gBAAkB,WACvBp6E,EAAOs2E,mBAAmBhzE,KAAO,EACjCtD,EAAOs2E,mBAAmBvkE,OAAS,EACnC/R,EAAOs2E,mBAAmBsD,UAAY,EACtC55E,EAAOs2E,mBAAmBE,WAAa,GAGzCx2E,EAAOs6E,yBAA2B,WAChC,IAAKt5E,EAAa6C,IAAI,4BAEpB,WADA5C,GAAOb,MAAM,yDAIK+I,GAAO0B,MACzBC,YAAa,8DACb/K,WAAY,uDAEAmI,OAAO3D,KAAK,SAAU2D,GAClCjF,KAAOiF,EAEHjF,KAAK0lC,IACP4jB,EAASc,aACTrtD,EAAOmN,QAAQi6D,gBAAiB,EAChCnmE,EAAOmH,IAAI,mGACFnF,KAAK7C,MACda,EAAOb,MAAM,UAAY6C,KAAK7C,OACrB6C,KAAK0E,KACdwG,EAAU9E,KAAKpG,KAAK0E,QAK1B3H,EAAOu6E,sBAAwB,SAAU/nE,EAAiB1F,GAGxD,GAFAA,EAAOgtB,mBAEF94B,EAAa6C,IAAI,4BAEpB,WADA5C,GAAOb,MAAM,yDAIK+I,GAAO0B,MACzBC,YAAa,2DACb/K,WAAY,kDACZqF,SACEoN,gBAAiB,WACf,MAAOA,OAICtK,OAAO3D,KAAK,SAAUujE,GAClC,GAAIA,EAAI95D,IACN/M,EAAOb,MAAM,UAAY0nE,EAAI95D,SACxB,CAIL,IAAK,GAHDuI,IAAS,EACTwxD,EAASloE,QAAQ8N,KAAK3N,EAAOk6E,0BAExBj3D,EAAI,EAAGA,EAAI8kD,EAAOpkE,OAAQsf,IACjC,GAAI8kD,EAAO9kD,GAAG9b,KAAOqL,EAAgBrL,GAAI,CACvCoP,EAAQ0M,CACR,OAIA1M,GAAS,IACXvW,EAAOk6E,yBAAyB3rD,OAAOhY,EAAO,GAC9CtV,EAAOmH,IAAI,6CAMdpI,EAAO2qE,2BACV3qE,EAAO+5E,0BAERryD,UAAU,2BAA4B,WACvC,OACEC,SAAU,IACVze,SAAS,EACT0e,OACEhW,kBAAmB,IACnBu5D,SAAU,KAEZprE,WAAY,6BACZqL,aAAc,aACdN,YAAa,gDAEd/K,WAAW,8BAAA,SAAA,KAAA,oBAAA,cAAA,eAAA,UAAA,oBAAA,SAAA,gBAAA,SAA8B,SAAUC,EAAQ+E,EAAIqqD,EAAmBF,EAAaluD,EAAc8B,EAASsoE,EAAmBnqE,EAAQy/C,EAAev3C,GACjK+I,OAAOzJ,OAAOnI,MACZ6G,GAAI,KACJ8sB,WAAY,SAAUriB,GACpBtR,KAAK6G,GAAKyK,EACVtR,KAAKyR,OAAS,EACdzR,KAAKwR,MAAQ,IACbxR,KAAKuyB,UACHs3B,UAAW,EACXr1C,IAAK,KACLxR,KAAM,GAERhD,KAAKk6E,aACLl6E,KAAKm6E,mBAAqB,GAC1Bn6E,KAAKo6E,gBACLp6E,KAAKmvB,OACHnd,KAAM,EACN83C,MAAO,GAET9pD,KAAKq6E,gBAAkB,EACvBr6E,KAAK6M,SACHk9C,SAAS,EACT/3C,MAAM,GAERhS,KAAKiS,WAAajS,KAAK+qE,MAAM94D,WAAW,GACxCjS,KAAKirE,eAAiBjrE,KAAK+qE,MAAMC,WAAW,GAAG3iE,MAC/CrI,KAAKgJ,OAAShJ,KAAK+qE,MAAM/hE,OAAO,GAChChJ,KAAKqqD,WAAa7nD,EAAQU,SAC1BlD,KAAKs6E,eAAer2E,KAAK,WACvB,MAAOjE,MAAKu6E,iBACZ10E,KAAK7F,OAAOiE,KAAK,WACjB,MAAOjE,MAAKw6E,SAAS,IACrB30E,KAAK7F,QAET+qE,OACEC,aACEjjD,MAAO,iBACP1f,MAAO,KAEP0f,MAAO,WACP1f,MAAO,aAETW,SACEX,MAAO,MACPiY,KAAM,MACNlc,YAAa,yCAEbiE,MAAO,UACPiY,KAAM,UACNlc,YAAa,mDAEbiE,MAAO,cACPiY,KAAM,cACNlc,YAAa,uDAEbiE,MAAO,cACPiY,KAAM,cACNlc,YAAa,oDAEbiE,MAAO,gBACPiY,KAAM,gBACNlc,YAAa,uCAEbiE,MAAO,oBACPiY,KAAM,qBACNlc,YAAa,+CAEbiE,MAAO,WACPiY,KAAM,QACNlc,YAAa,iDAEbiE,MAAO,oBACPiY,KAAM,iBACNlc,YAAa,0DAEbiE,MAAO,mBACPiY,KAAM,0BACNlc,YAAa,mEAEf4xD,YACE3tD,MAAO,MACPiY,KAAM,QAENjY,MAAO,OACPiY,KAAM,SAENjY,MAAO,gBACPiY,KAAM,kBAERrO,aACE8V,MAAO,WACPzH,KAAM,UACNjY,MAAO,IAEP0f,MAAO,WACPzH,KAAM,cACNjY,MAAO,IAEP0f,MAAO,cACPzH,KAAM,QACNjY,MAAO,QAGXiyE,aAAc,WAEZ,MADAt6E,MAAK6M,QAAQk9C,SAAU,EAChB+E,EAAkB76C,cAAcjU,KAAK6G,IAAI5C,KAAK,SAAUiO,GAC7DlS,KAAK6M,QAAQk9C,SAAU,EACvB/pD,KAAKkS,gBAAkBA,EACvBlS,KAAKkS,gBAAgBuoE,oBACnBC,UAAa16E,KAAKkS,gBAAgBpC,WAAWssB,UAC7Cu+C,oBAAqB36E,KAAKkS,gBAAgBpC,WAAWs+D,EACrDwM,eAAgB56E,KAAKkS,gBAAgBpC,WAAW+qE,SAAW,YAE7D76E,KAAKmvB,OACHnd,KAAME,EAAgBwkB,QACtBozB,MAAOlpD,KAAKgoB,KAAK1W,EAAgBwkB,QAAU12B,KAAKwR,SAElD3L,KAAK7F,OAAOmK,MAAM,SAAUuD,GAE5B,MADA1N,MAAK6M,QAAQk9C,SAAU,EAChBppD,EAAOgN,YAAYD,IAC1B7H,KAAK7F,QAETivE,gBAAiB,WACfjvE,KAAKuyB,SAASvvB,KAAO,EACrBhD,KAAK86E,2BACL96E,KAAKw6E,SAAS,IAEhB3jE,OAAQ,SAAU3E,EAAiB1F,GAIjC,GAFAA,EAAOgtB,mBAEF94B,EAAa6C,IAAI,4BAEpB,WADA5C,GAAOb,MAAM,uDAIfJ,GAAOg6E,OAASxnE,EAAgBlR,KACV6H,EAAO0B,MAC3BC,YAAa,0DACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,SAAUjD,GAClC8tD,EAAkBj4C,OAAO3E,EAAgBrL,IACvC7F,KAAMA,IACLiD,KAAK,WACNiO,EAAgBlR,KAAOA,OAI7BwqD,eAAgB,WACdxrD,KAAK+6E,yBAA2BjsB,EAAkBv6C,cAChDrC,gBAAiBlS,KAAKkS,gBAAgBrL,GACtC8P,QAASvL,mBAAmBpL,KAAKkS,gBAAgBlR,SAGrDg6E,eAAgB,SAAUxuE,GAExB,MADAA,GAAOgtB,kBACH94B,EAAa8C,UAAkBxD,KAAKwrD,iBAEpC9qD,EAAa0C,MAAQ1C,EAAa0C,IAAIC,SAAW3C,EAAa6C,IAAI,iBAC7D5C,EAAOb,MAAM,8DACRE,KAAKwrD,kBAErBxI,SAAU,SAAUx2C,EAAQksB,GAC1B,GAA0B,sBAAtB14B,KAAKgJ,OAAOX,MACd,OAAO,CAGTrI,MAAKi4B,cAAgBS,EAAYT,aACjC,IAAIgrB,GAAYvqB,EAAYT,cAAcirB,QACtCyrB,EAAYj2C,EAAYJ,QAAQs2C,OAAOn9D,SAASmoB,GACpD55B,MAAK2uE,UAAwB,EAAZA,EACjB3uE,KAAKmjD,mBAAqBF,GAAa0rB,GAEzCn8C,SAAU,SAAUgzB,GAClBxlD,KAAKgtB,OAAOw4B,EAAMn9C,QAEpBkyE,cAAe,WACb,MAAOzrB,GAAkBp4C,gBAAgB1W,KAAK6G,IAAI5C,KAAK,SAAUgM,GAC/DjQ,KAAKk6E,UAAYjqE,EACjBjQ,KAAKi7E,WAAaj7E,KAAKo6E,aAAa/2E,OACpCrD,KAAKk7E,6BACLr1E,KAAK7F,QAETk7E,0BAA2B,WAGzB,IAAK,GAFDC,MAEKx4D,EAAI,EAAGA,EAAI3iB,KAAKk6E,UAAU72E,OAAQsf,GAAK3iB,KAAKm6E,mBACnDgB,EAAQ19D,KAAKzd,KAAKk6E,UAAUvxE,MAAMga,EAAGA,EAAI3iB,KAAKm6E,oBAGhDn6E,MAAKo6E,aAAee,GAEtBC,gBAAiB,WACf,MAAOp7E,MAAKgS,MAAQhS,KAAKgS,KAAK,IAAMhS,KAAKgS,KAAK,GAAG/B,KAAK,GAAGorE,cAE3DC,sBAAuB,WAGrB,OAFat7E,KAAKgJ,QAAUhJ,KAAKgJ,OAAOX,MAAQrI,KAAKgJ,OAAOX,UAAQ3G,IAGlE,IAAK,UACH1B,KAAKq6E,gBAAkBr6E,KAAKkS,gBAAgBwqD,OAC5C,MAEF,KAAK,cACH18D,KAAKq6E,gBAAkBr6E,KAAKkS,gBAAgBqpE,MAC5C,MAEF,KAAK,WACHv7E,KAAKq6E,gBAAkBr6E,KAAKkS,gBAAgBwkB,OAC5C,MAEF,KAAK,oBACH12B,KAAKq6E,gBAAkBr6E,KAAKo7E,iBAC5B,MAEF,SACEp7E,KAAKq6E,gBAAkB,IAG7BS,yBAA0B,WACxB,GAAI9xE,GAAShJ,KAAKgJ,QAAUhJ,KAAKgJ,OAAOX,MAAQrI,KAAKgJ,OAAOX,UAAQ3G,GAChE85E,GAAoB,GAEnB,MAAO,cAAe,mBAAoB,qBAAqBl4E,SAAS0F,IAC3C,IAA5BhJ,KAAKm6E,qBACPqB,GAAoB,GAGtBx7E,KAAKm6E,mBAAqB,IAChB,gBAAiB,qBAAqB72E,SAAS0F,KACzB,KAA5BhJ,KAAKm6E,qBACPqB,GAAoB,GAGtBx7E,KAAKm6E,mBAAqB,IAGxBqB,GACFx7E,KAAKk7E,6BAGTO,gBAAiB,SAAU1/D,GACzB,KAAM2/D,GAAqC,sBAAtB17E,KAAKgJ,OAAOX,KAEjC,IAAIrI,KAAK27E,oBAAsBD,EAE7B,MADA17E,MAAKuyB,SAASvvB,KAAO04E,EAAe,EAAI17E,KAAK47E,0BAA0B7/D,EAAKlI,SAAW,EAChF7T,KAAKw6E,UAGd,IAAI13B,GAAW,QAAU/mC,EAAKlI,OAC9BusC,GAAc2C,QAAUzwB,EAAE,mBAAmBxE,SAAW,GACxDsyB,EAAc0C,IAEhB64B,iBAAkB,WAChB,MAAO37E,MAAKgJ,SAAW,MAAO,cAAe,mBAAoB,gBAAiB,qBAAqB1F,SAAStD,KAAKgJ,OAAOX,QAE9HuzE,0BAA2B,SAAUC,GACnC,GAAK77E,KAAKo6E,cAAiBp6E,KAAKo6E,aAAa/2E,OAI7C,MAAOrD,MAAKo6E,aAAazS,UAAU,SAAUmU,GAC3C,QAASA,EAAMzpD,KAAK,SAAUtW,GAC5B,MAAOA,GAAKlI,UAAYgoE,OAI9BE,qBAAsB,SAAUF,GAC9B,KAAMG,GAAah8E,KAAK47E,0BAA0BC,EAElD,QAAmBn6E,KAAfs6E,EAIJ,MAAOh8E,MAAKo6E,aAAa4B,IAE3BC,yBAA0B,SAAUj5E,GAClC,GAAKhD,KAAKo6E,cAAiBp6E,KAAKo6E,aAAa/2E,OAI7C,MAAOrD,MAAKo6E,aAAap3E,EAAO,IAElCk5E,SAAU,SAAUv5E,GAClB,GAAIqG,GAAShJ,KAAKgJ,QAAUhJ,KAAKgJ,OAAOX,MAAQrI,KAAKgJ,OAAOX,UAAQ3G,GAChEwO,GACFlH,OAAQA,EAGNrG,GAAKoZ,OACP7L,EAAK6L,KAAOpZ,EAAKoZ,MAGfpZ,EAAKqZ,QACP9L,EAAK8L,MAAQrZ,EAAKqZ,MAGpB,IAAIxK,GAAOC,CACX,MACM0qE,GAAa1qE,GAAU9O,EAAKy5E,WAAa,GAAKp8E,KAAKwR,KAEzD,QAAQxI,GACN,IAAK,mBACHwI,EALgB,IAMhBC,EAAS,CACT,MAEF,KAAK,gBACHD,EAAQ,EACRC,EAAS,CACT,MAEF,KAAK,MACL,IAAK,cACHD,EAAQ,IACRC,EAAS,CACT,MAEF,SACED,EAAQxR,KAAKwR,MACbC,EAAS0qE,EAGb,OACE3qE,MAAOA,EACPC,OAAQA,EACRvB,KAAMA,IAGVmsE,gBAAiB,SAAUrqE,GACzB,GAAIhJ,GAAShJ,KAAKgJ,QAAUhJ,KAAKgJ,OAAOX,MAAQrI,KAAKgJ,OAAOX,UAAQ3G,EAGpE,OAFA1B,MAAK25E,cAA2B,aAAX3wE,EAEjBhJ,KAAK25E,gBAEL1pE,KAAM+B,IAGDA,EAAKsL,OAAO,SAAUC,EAAG/I,GAC9B,GAAIX,GAAUW,EAAIX,QACdyoE,EAAW9nE,EAAIuH,IAenB,OAbKwB,GAAEsyB,IAAIysC,KACT/+D,EAAEsyB,IAAIysC,IACJrsE,QACA4/B,OACA7uC,KAAMs7E,EACNz1E,GAAIgN,GAGN0J,EAAEtN,KAAKwN,KAAKF,EAAEsyB,IAAIysC,KAGT/+D,EAAEsyB,IAAIysC,GACZrsE,KAAKwN,KAAKjJ,GACR+I,IAEPtN,QACA4/B,SACC5/B,MAGPuqE,SAAU,SAAUx3E,GAClB,GAAIjC,EAEJ,IAA0B,sBAAtBf,KAAKgJ,OAAOX,MAA+B,CAC7C,KAAM0T,GAAO/b,KAAKuyB,SAASgqD,aAAev8E,KAAKuyB,SAASgqD,aAAa1oE,QAAU7T,KAAKo6E,aAAa,GAAG,GAAGvmE,OACvG9S,GAASf,KAAKk8E,UACZlgE,MAAOD,EACPqgE,WAAYp8E,KAAKuyB,SAASvvB,WAEvB,IAAIhD,KAAK27E,mBAAoB,CAClC34E,EAAOA,GAAQhD,KAAKuyB,SAASvvB,IAC7B,IAAIw5E,GAAYx8E,KAAKi8E,yBAAyBj5E,GAC1CkiD,EAAUs3B,EAAU72E,IAAI,SAAU0P,GACpC,MAAOA,GAAExB,SAEX9S,GAASf,KAAKk8E,UACZlgE,MAAOkpC,QAGTnkD,GAASf,KAAKk8E,UACZE,WAAYp8E,KAAKuyB,SAASvvB,MAM9B,OAFAhD,MAAKgS,QACLhS,KAAK6M,QAAQmF,MAAO,EACb88C,EAAkB36C,WAAWnU,KAAK6G,GAAI9F,EAAOyQ,MAAOzQ,EAAO0Q,OAAQ1Q,EAAOmP,MAAMjM,KAAK,SAAU+N,GACpGhS,KAAK6M,QAAQmF,MAAO,EACpBhS,KAAKgS,KAAOhS,KAAKq8E,gBAAgBrqE,GACjChS,KAAKuyB,SAAS/d,IAAM5T,KAAKy8B,MACzBr9B,KAAKs7E,yBACLz1E,KAAK7F,OAAOmK,MAAM,SAAUuD,GAE5B,MADA1N,MAAK6M,QAAQmF,MAAO,EACbrR,EAAOgN,YAAYD,IAC1B7H,KAAK7F,QAETwtE,aAAc,SAAUh5D,EAAKhI,GACvBA,IACFA,EAAO7K,iBACP6K,EAAOgtB,mBAGT35B,QAAQwY,KAAK,QACbyyD,EAAkBhtB,QAAQgR,EAAkBt7C,eAAegB,IAAM,IAEnEioE,kBAAmB,WACjB3R,EAAkBhtB,QAAQ8Q,EAAYp7C,eAAexT,KAAKkS,gBAAgB2O,WAAW,IAEvFwsD,oBAAqB,SAAU74D,GAC7B,GAAI84D,IAAO,MAAO94D,EAAIijD,GAAIjjD,EAAIkjD,GAAIljD,EAAImjD,GAAInjD,EAAIojD,IAAInoD,KAAK,IACvD,OAAO+E,GAAM,YAAcxU,KAAKqqD,WAAa,mBAAqB71C,EAAI63D,aAAe,MAAQiB,EAAM,IAErGC,yBAA0B,SAAU1sD,GAClC,GAAIysD,IAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,IAC3E,OAAOoR,GAAW,YAAcA,EAAS04D,mBAAqB,mBAAqB14D,EAASzJ,UAAY,MAAQk2D,EAAM,IAExHoP,OAAQ,SAAU7yB,GAShB,MARI7pD,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASs3B,UAAY,EAC1B7pD,KAAKuyB,SAAS/d,IAAM,OAEpBxU,KAAKuyB,SAASs3B,UAAYjpD,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAgB,EAAZwsB,EAAe7pD,KAAKmvB,MAAMnd,KAAO,IAChFhS,KAAKuyB,SAAS/d,IAAMxU,KAAKgS,KAAKhS,KAAKuyB,SAASs3B,YAGvC7pD,KAAKuyB,SAAS/d,KAEvB+1C,QAAS,SAAUvnD,EAAMyqE,GACvB,MAAIztE,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASvvB,KAAO,EACrBhD,KAAKgS,QACEvN,EAAGK,QAAQ9E,KAAKgS,OAEnBhP,GAAQhD,KAAKuyB,SAASvvB,MAAQyqE,GAChCztE,KAAKuyB,SAASvvB,KAAOA,EACdhD,KAAKw6E,SAASx3E,IAIlByB,EAAGK,WAEZkoB,OAAQ,SAAUlb,GAChB,GAAIy5D,GAAW,IAGbA,GADa,QAAXz5D,EACS,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,SAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,kBAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,SAA6B,OAAlB/d,EAAIg3D,WAGV,SAAUh3D,GACnBA,EAAI+d,SAAW/d,EAAI3N,KAAOiL,GAI9B9R,KAAK28E,WAAWpR,IAElBoR,WAAY,SAAUphE,IACnBvb,KAAKgS,UAAYtL,QAAQ,SAAUqV,GAClCA,EAAK9L,KAAKvJ,QAAQ6U,MAGtBlL,SAAU,SAAU4B,EAAYD,GAC9B,IAAKtR,EAAa6C,IAAI,8BAEpB,WADA5C,GAAOb,MAAM,gEAII4B,KAAfuQ,IACFA,GAAcjS,KAAKiS,aACjB5J,MAAO,OACNA,WAGQ3G,KAATsQ,IACFA,KACAhS,KAAK28E,WAAW,SAAUnoE,GACpBA,EAAI+d,UACNvgB,EAAKyL,KAAKjJ,KAKhB,IAAIk6D,GAAS18D,EAAKrM,IAAI,SAAU6O,GAC9B,MAAOA,GAAI3N,KAET+1E,GACFC,EAAG,EACHC,EAAG,EACHC,KAAM,GAEJnmE,GACFtS,QAAStE,KAAKkS,gBAAgBkH,aAC9By4B,SAAU7xC,KAAKkS,gBAAgB21C,cAEjC,OAAOiH,GAAkBp6C,aAAa1U,KAAK6G,GAAI6nE,EAAQz8D,EAAY2E,GAAK3S,KAAK,WAC3E+N,EAAKtL,QAAQ,SAAU8N,GACrBooE,EAAUpoE,EAAIg3D,YAAc,EAC5BoR,EAAU3qE,IAAe,EACzBuC,EAAIg3D,UAAYv5D,EAChBuC,EAAI+d,UAAW,IAEjBvyB,KAAKkS,gBAAgBqpE,QAAUqB,EAAU,GACzC58E,KAAKkS,gBAAgBwqD,SAAWkgB,EAAU,IAC1C/2E,KAAK7F,UAGXA,KAAK2zB,WAAWj0B,EAAO4R,sBACtB7R,WAAW,qCAAA,SAAA,iBAAA,oBAAA,kBAAqC,SAAUC,EAAQwjB,EAAgB4rC,EAAmB58C,GACtGlS,KAAKkS,gBAAkBA,EACvBxS,EAAOkoE,gBAAiB,EAExBloE,EAAO2oC,GAAK,WACV3oC,EAAOkoE,gBAAiB,EACxB9Y,EAAkB1gD,OAAO8D,EAAgBrL,IAAI5C,KAAK,SAAUtB,GAC1DugB,EAAeyC,MAAMhjB,MAIzBjD,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAExB1lB,WAAW,wCAAA,iBAAA,oBAAA,cAAA,cAAA,SAAwC,SAAUyjB,EAAgB4rC,EAAmBF,EAAa6B,EAAa9vD,GAC3H,GAAIgwC,GAAO3wC,IACX4R,QAAOzJ,OAAOnI,MACZ2zB,WAAY,WACV3zB,KAAK6M,SACH6K,WAAW,EACXslE,WAAW,EACXC,uBAAuB,GAEzBj9E,KAAK2C,MACH3B,KAAM,KACNgP,SAAU,KACV6Q,SAAU,KACV9f,QACEqtE,EAAG,EACHhyC,UAAW,KAGfp8B,KAAKiQ,QACLjQ,KAAK6M,SACHmwE,WAAW,EACXtlE,WAAW,GAEb1X,KAAKk9E,UAAW,EAChBl9E,KAAKm9E,eAAiB,2FACtBn9E,KAAKo9E,eACLp9E,KAAKq9E,gBAEPD,aAAc,WAEZ,MADAzsC,GAAK9jC,QAAQmwE,WAAY,EAClBpuB,EAAY9/C,UAAU7K,KAAK,SAAU+4E,GAC1CrsC,EAAK9jC,SAAU,EACf8jC,EAAK1gC,KAAK+sE,UAAYA,EAAU38E,OAAO,SAAU0V,GAC/C,OAAQA,EAAEwR,YAEZ1hB,KAAK7F,OAAOmK,MAAM,SAAUuD,GAC5BijC,EAAK9jC,SAAU,EACf8jC,EAAK1gC,KAAK+sE,aACVr8E,EAAOgN,YAAYD,IACnB7H,KAAK7F,QAETq9E,aAAc,WAEZ,MADA1sC,GAAK9jC,QAAQ6K,WAAY,EAClB+4C,EAAY3hD,UAAU7K,KAAK,SAAUyT,GAC1Ci5B,EAAKj5B,WAAY,EACjBi5B,EAAK1gC,KAAKyH,UAAYA,GACtB7R,KAAK7F,OAAOmK,MAAM,SAAUuD,GAC5BijC,EAAKj5B,WAAY,EACjBi5B,EAAK1gC,KAAKyH,aACV/W,EAAOgN,YAAYD,IACnB7H,KAAK7F,QAETqoC,GAAI,WACF,MAAiC,KAA7BsI,EAAKhuC,KAAKqN,SAASxI,MACd7G,EAAOb,MAAM,4CAGtB6wC,EAAKusC,UAAW,EACTpuB,EAAkB1+C,QACvBpP,KAAM2vC,EAAKhuC,KAAK3B,KAChBgP,SAAU2gC,EAAKhuC,KAAKqN,SAASnJ,GAC7Bga,SAAU8vB,EAAKhuC,KAAKke,SAASha,GAC7B9F,OAAQ4vC,EAAKhuC,KAAK5B,SACjBkD,KAAK,SAAUiO,GAChBy+B,EAAKusC,UAAW,EAChBh6D,EAAeyC,OACb0iB,IAAI,EACJn2B,gBAAiBA,MAElB/H,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI,MAAO4F,GACnBijC,EAAKusC,UAAW,EAChBv8E,EAAOb,MAAM4N,OAGjBi7D,WAAY,WACV,MAAOh4B,GAAKhuC,MAAQguC,EAAKhuC,KAAK3B,MAAQ2vC,EAAKhuC,KAAK3B,KAAKqC,OAAS,GAAKstC,EAAKhuC,KAAKqN,UAAY2gC,EAAKhuC,KAAKke,UAErGlV,OAAQ,SAAUtE,GAChB6b,EAAeyC,OACbha,QAAQ,EACRtE,IAAKA,KAGTi2E,iBAAkB,WAChB,MAAOt9E,MAAK2C,KAAKqN,UAAYhQ,KAAK2C,KAAKqN,SAASxI,MAAQ,OAG5DxH,KAAK2zB,gBCrzBPp0B,QAAQC,OAAO,oCAAqC,YAAa,0CAA2C,oDAAoDqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC/Lo1C,EAAeC,MAAM,iCACnB9vC,IAAK,wBACLwZ,SAAU,cACV27B,UAAU,OCJdj9C,QAAQC,OAAO,iDAAkD4nB,UAAU,sBAAA,cAAsB,SAAUqpC,GACzG,OACEppC,SAAU,IACV7c,YAAa,oDACb8c,OACEi2D,qBAAsB,KAExB99E,WAAY,6CACZ+9E,SAAU,gBACV/1D,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9B,GAAIjoB,GAAa6nB,EAAM7nB,UACvBA,GAAWk0B,YACT8pD,WAAY,SAAUvmE,GACpBoQ,EAAMi2D,sBACJrmE,WAAYA,OAIlBoQ,EAAMzmB,IAAI,WAAY,WACpBpB,EAAW00B,kBAIhB10B,WAAW,gCAAA,cAAA,eAAgC,SAAUgxD,EAAaitB,GACnE19E,KAAKuyB,YACLvyB,KAAK29E,aACHr3E,KAAM,QACNga,KAAM,wBACN6b,KAAM,WACNyhD,aAAc,4CAEdt3E,KAAM,eACNga,KAAM,6BACN6b,KAAM,eACNyhD,aAAc,iDAEdt3E,KAAM,cACNga,KAAM,oCACN6b,KAAM,gBACNyhD,aAAc,qCAEhB,IAAIC,EAEJ79E,MAAK2zB,WAAa,SAAUjiB,GAC1B1R,KAAK0R,QAAUA,MACfmsE,EAA4BptB,EAAY5vD,IAAI,kBAAmB,WAC7Db,KAAKoN,SACLvH,KAAK7F,OACPA,KAAKoN,QACLpN,KAAK89E,yBAGP99E,KAAKoN,MAAQ,WACX,MAAOqjD,GAAY3hD,UAAU7K,KAAK,SAAUyT,GAC1C1X,KAAK0X,UAAYA,GACjB7R,KAAK7F,QAGTA,KAAKm0B,SAAW,WACd0pD,KAGF79E,KAAK89E,sBAAwB,WAC3B,GAAIF,IAAgB59E,KAAKuyB,SAASwrD,eAAiBH,cAAgB,aAC/DI,EAAQh+E,KAAKuyB,SAASyrD,UACtBC,EAAQj+E,KAAKuyB,SAAS0rD,SAC1Bj+E,MAAKk+E,gBAAkBR,EAAaE,IAClCO,UAAWH,EAAMh9E,MAAQ,eACzBo9E,UAAWH,EAAMj9E,MAAQ,kBAI7BhB,KAAKimB,OAAS,WACZ,GAAI83D,GAAY/9E,KAAKuyB,SAASwrD,UAC1BC,EAAQh+E,KAAKuyB,SAASyrD,MACtBC,EAAQj+E,KAAKuyB,SAAS0rD,MACtBj9E,EAAOhB,KAAKuyB,SAASvxB,MAAQhB,KAAKk+E,eAElCH,IAAaC,GAASC,GAASj9E,GAC7BhB,KAAK0R,QAAQ+rE,YACfz9E,KAAK0R,QAAQ+rE,YACXM,UAAWA,EAAUz3E,KACrB03E,MAAOA,EAAMn3E,GACbo3E,MAAOA,EAAMp3E,GACb7F,KAAMA,QCpFhBzB,QAAQC,OAAO,0BAA2B,cAAe,gBAAiB,eAAgB,6CAA8C,WAAWqC,QAAA,iBAAO,SAAUq1C,GAClKA,EAAeC,MAAM,uBACnB9vC,IAAK,aACL5H,WAAY,6BACZ+K,YAAa,+CAEd/K,WAAW,gBAAA,SAAA,cAAA,SAAA,SAAA,eAAA,YAAgB,SAAUC,EAAQ+wD,EAAa5nD,EAAQlI,EAAQD,EAAcmN,GACzF7N,KAAK2zB,WAAa,WAChBkqD,0BAA4BptB,EAAY5vD,IAAI,kBAAmB,WAC7Db,KAAKoN,SACLvH,KAAK7F,OACPA,KAAKoN,SAGPpN,KAAKoN,MAAQ,WACX1N,EAAOmN,SAAU,EACjB4jD,EAAY3hD,SACVuJ,MAAM,IACLpU,KAAK,SAAUtB,GAChBjD,EAAOgY,UAAY/U,EACnBjD,EAAOmN,SAAU,KAIrB7M,KAAKq+E,QAAU,SAAUnnE,GACvB,MAAKxW,GAAa6C,IAAI,oBAKfktD,EAAYx5C,QAAQC,GAAYjT,KAAK,WAC1CtD,EAAOmH,IAAI,sBACVqC,MAAM,SAAUuD,GACjBA,EAAMA,MACN/M,EAAOb,MAAM4N,EAAI7F,SAAW6F,EAAI/K,MAAQ,sBARxChC,GAAOb,MAAM,oDAYjBE,KAAKihB,KAAO,WACV,IAAKvhB,EAAOgzB,QAAQrvB,QAAU3D,EAAOgzB,QAAQrvB,OAAS,EAEpD,WADA1C,GAAOmH,IAAI,qCAIb,KAAKpH,EAAa6C,IAAI,oBAEpB,WADA5C,GAAOb,MAAM,+CAIfJ,GAAO4+E,MAAQ5+E,EAAOgzB,QAAQ,GAAG1xB,IACjC,MAAM+W,GAAcrY,EAAOgzB,QAAQ,GAAG7rB,EAChBgC,GAAO0B,MAC3BC,YAAa,oCACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,SAAUkuD,GAClC1B,EAAYj5C,QACV3Q,GAAIkR,EACJ/W,KAAMmxD,GACL,SAAUxvD,GACX,GAAIA,EAAK7C,MAAO,MAAOD,SAAQiI,IAAInF,EAAK7C,YAK9CJ,EAAOslD,IAAM,WACX,GAAKtlD,EAAOgzB,SAAYhzB,EAAOgzB,QAAQrvB,OAAvC,CAEA,IAAK3C,EAAa6C,IAAI,oBAEpB,WADA5C,GAAOb,MAAM,iDAIf,MAAM4X,GAAYhY,EAAOgzB,QAAQ/sB,IAAI,SAAU+tB,GAC7C,MAAO,IAAMA,EAAI1yB,KAAO,MAEpB6G,GAAW,qDACXigD,GAAY,gBAClBpoD,GAAOm7B,OACLnwB,SAAU7C,EAAQ28C,OAAO9sC,EAAWowC,GACpCl9C,MAAO,MACPC,UAAW,KAEShC,GAAO0B,MAC3BC,YAAa,gCACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,WACxB,KAAMwT,GAAc/X,EAAOgzB,QAAQ/sB,IAAI,SAAU44E,GAC/C,MAAOA,GAAG13E,IAEZnH,GAAOmN,SAAU,EACjB4jD,EAAYnvD,OAAOmW,EAAa,SAAU9U,GACxC,GAAIA,EAAK7C,MAAO,MAAOa,GAAOb,MAAM6C,EAAK7C,MACzC2wD,GAAY3hD,UAAU7K,KAAK,SAAUtB,GACnCjD,EAAOgY,UAAY/U,EACnBjD,EAAOmN,SAAU,EACjBlM,EAAOmH,KAAK2P,EAAYpU,OAAS,EAAI,aAAe,aAAe,mBAM3E3D,EAAO0Q,OAAS,SAAU/I,GACxBwG,EAAU9E,KAAK1B,IAGjBrH,KAAK2zB,gBC3GPp0B,QAAQC,OAAO,2BAA4B,cAAe,iBAAkB,eAAgB,iBAAkB,UAAUqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACvJo1C,EAAeC,MAAM,wBACnB9vC,IAAK,eACL5H,WAAY,gCACZ+K,YAAa,2CAEd/K,WAAW,mBAAA,UAAA,SAAA,SAAA,UAAA,UAAA,WAAA,gBAAA,cAAA,YAAA,gBAAA,SAAA,eAAmB,SAAUgD,EAAS/C,EAAQmJ,EAAQghB,EAASrnB,EAASypD,EAAU+c,EAAevY,EAAa5iD,EAAW4gB,EAAe9tB,EAAQD,GAC5J,GAAI4xB,GAAI7vB,EAAQ6vB,CAChB5yB,GAAO2sD,YAAc,GACrB3sD,EAAOktD,aAAc,EACrBltD,EAAO6sD,UAAY,GACnB7sD,EAAOmtD,WAAY,EACnBntD,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GACtBlnE,EAAQE,QAAQ,SAAUC,GACxBjD,EAAOo9C,YAAcn6C,EACrBjD,EAAO8+E,IAAM77E,EAAKwV,WAClBzY,EAAO2H,IAAM1E,EAAK0E,IAClB3H,EAAOowE,kBAAsC,IAAlBntE,EAAK4kB,WAElCkpC,EAAY3hD,UAAU7K,KAAK,SAAUtB,GACnCjD,EAAOgY,UAAY/U,GAGrB,IAAIymE,GAAY,SAAUziE,EAAGwmD,EAAG93C,EAAGi8C,EAAGv7C,GACpC,GAAIsf,MACAg0C,EAAU,MAEF,MAARh0D,EAAE,KACJg0D,EAAU,OAGZh0C,EAAOhgB,EAAEsuB,UAAU,IAAM0lC,EACzB3pE,EAAO8pE,YAAc,GAAIR,IACvBhmE,KAAM2D,EACNa,MAAO2lD,EACPoc,QAASl0C,EACTh1B,OAAQixD,IAERniC,MAAOpZ,EACPjS,QAAS,SAAU2lE,EAAQ1oE,GACzBrB,EAAOgqE,aAAe,EACtB,IAAIC,GAAe5oE,EAAOV,SAAWwpB,EAAQ,UAAUnqB,EAAO++E,oBAAqB19E,EAAOV,UAAYX,EAAO++E,oBACzG5U,EAAc9oE,EAAOwoE,UAAY1/C,EAAQ,WAAW8/C,EAAc5oE,EAAO+oE,WAAapqE,EAAO++E,mBACjG19E,GAAOouB,MAAM06C,EAAYxmE,QACzBomE,EAAO3kE,QAAQ+kE,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,UAE1FqiE,EAAYxmE,OAAS,IACvB3D,EAAOgqE,aAAe,6BAGxBhqE,EAAOg/E,gBAAkB7U,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,SACxGinB,EAAcpc,WACZ1P,KAAQjD,EAAO++E,oBACfE,SAAYj/E,EAAOg/E,gBACnBptB,EAAKvwD,EAAOV,SACZiiC,EAAKvhC,EAAO+oE,UACZnjE,EAAK5F,EAAOiC,OACZmqD,EAAKpsD,EAAOyG,QACZuO,EAAK8zD,EAAYxmE,YAMzB3D,GAAOk/E,gBAAkB,WACvBnwD,EAAcnQ,SAAS,SAAU3b,GAC/BjD,EAAO++E,oBAAsB97E,EAC7BjD,EAAOg/E,gBAAkB/7E,EACzBjD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GAElB/mE,EAAKU,OAAS,EACX3D,EAAO8pE,YAGV9pE,EAAO8pE,YAAYxD,SAFnBoD,EAAU,EAAG,GAAI,WAAazmE,EAAKU,QAKrC3D,EAAOgqE,aAAe,0BAK5B,IAAImV,GAAYpwD,EAAcnc,UAEZ,QAAdusE,EACFn/E,EAAOk/E,mBAEHC,EAAUl8E,KAAKU,OAAS,GAC1B3D,EAAOg/E,gBAAkBG,EAAUF,SACnCj/E,EAAO++E,oBAAsBI,EAAUl8E,KACvCymE,EAAUyV,EAAUl4E,EAAGk4E,EAAU1xB,EAAG0xB,EAAUv8C,EAAE,GAAIu8C,EAAUvtB,EAAGutB,EAAUF,SAASt7E,SAEpF3D,EAAOgqE,aAAe,mBAGxBhqE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,GAGnBnN,EAAOo/E,iBAAmB,SAAUj4E,EAAI7F,GACtC,IAAKN,EAAa6C,IAAI,sBAEpB,WADA5C,GAAOb,MAAM,mDAIfJ,GAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,CACjB,IAAIghD,GAAgBhlD,EAAO0B,MACzBC,YAAa,kDACb/K,WAAY,+BACZqF,SACE9D,KAAM,WACJ,MAAOA,IAET6F,GAAI,WACF,MAAOA,IAETi2C,YAAa,WACX,MAAOp9C,GAAOo9C,eAIpB+Q,GAAcC,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,IAEnBghD,EAAcjmD,OAAO3D,KAAK,SAAUujE,GAClC,GAAIA,EAAI1nE,MACNa,EAAOb,MAAM,UAAY0nE,EAAI1nE,WACxB,CAIL,IAAK,GAHDmW,IAAS,EACTwxD,EAASloE,QAAQ8N,KAAK3N,EAAO++E,qBAExB97D,EAAI,EAAGA,EAAI8kD,EAAOpkE,OAAQsf,IACjC,GAAI8kD,EAAO9kD,GAAG9D,gBAAkBhY,EAAI,CAClCoP,EAAQ0M,CACR,OAIA1M,GAAS,IACXvW,EAAO++E,oBAAoBxwD,OAAOhY,EAAO,GACzCvW,EAAO8pE,YAAYxD,SACnBrlE,EAAOmH,IAAI,wCAMnBpI,EAAOq/E,oBAAsB,WAC3B,IAAKr+E,EAAa6C,IAAI,sBAEpB,WADA5C,GAAOb,MAAM,mDAIfJ,GAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,CACjB,IAAIghD,GAAgBhlD,EAAO0B,MACzBC,YAAa,qDACb/K,WAAY,kCACZqF,SACEk6E,qBAAA,gBAAqB,SAAUvwD,GAC7B,MAAOA,GAAcxQ,2BAEvBvG,UAAW,WACT,MAAOhY,GAAOgY,WAEhBolC,YAAa,WACX,MAAOp9C,GAAOo9C,eAIpB+Q,GAAcC,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,IAEnBghD,EAAcjmD,OAAO3D,KAAK,SAAU2D,GAClCjF,KAAOiF,EAEHjF,KAAK0lC,KACP4jB,EAASc,aACTpsD,EAAOmH,IAAI,6FAGTnF,KAAK+K,KACP/M,EAAOb,MAAM6C,KAAK+K,KAGhB/K,KAAK0E,KACPwG,EAAU9E,KAAKpG,KAAK0E,QAK1B3H,EAAOu/E,YAAc,SAAU9gE,GAC7BsQ,EAAczqB,IAAIma,EAAc,SAAUS,GACxC6xC,EAAY/tD,QAAQkc,EAAW7G,YAAa,SAAUmnE,GAChCr2E,EAAO0B,MACzB9K,WAAY,uCACZ+K,YAAa,yCACb1F,SACE8Z,WAAY,WACV,MAAOA,IAET5O,SAAU,WACR,MAAOkvE,YAQnBl/E,KAAKm/E,iBAAmB,SAAUztE,GAChC,MAAIhR,GAAa8C,UAAkBxD,KAAKuU,aAAa7C,GAEjDhR,EAAa0C,MAAQ1C,EAAa0C,IAAIC,SAAW3C,EAAa6C,IAAI,iBAC7D5C,EAAOb,MAAM,4DAGtBE,MAAKuU,aAAa7C,IAGpB1R,KAAKuU,aAAe,SAAU7C,GAC5B+c,EAAcla,aAAa7C,GAASzN,KAAK,SAAUwnD,GACjD,GAAI72C,GAAI0d,EAAE,WAAWxd,KAAK,SAAU,UAAUA,KAAK,OAAQ22C,GAAY12C,SAAS,OAChFtS,GAAQuS,WAAW,WACjBJ,EAAE,GAAGK,QACLL,EAAEtT,UACD,SAGN7B,WAAW,gCAAA,SAAA,iBAAA,gBAAA,OAAA,KAAA,cAAgC,SAAUC,EAAQwjB,EAAgBuL,EAAeztB,EAAM6F,EAAIi2C,GACvGp9C,EAAOsB,KAAOA,EACdtB,EAAOmH,GAAKA,EACZnH,EAAOo9C,YAAcA,CACXp9C,GAAOo9C,YAAYz1C,GAE7B3H,GAAO2oC,GAAK,WACV5Z,EAAcrgB,OAAOvH,EAAI,SAAUlE,GACjCugB,EAAeyC,MAAMhjB,MAIzBjD,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAExB1lB,WAAW,mCAAA,SAAA,iBAAA,gBAAA,WAAA,cAAA,YAAmC,SAAUC,EAAQwjB,EAAgBuL,EAAepjB,EAAUyxC,EAAaplC,GACvHhY,EAAOo9C,YAAcA,EACrBp9C,EAAOgY,UAAYA,EACnBhY,EAAO0/E,kBAAmB,EAC1B1/E,EAAO2/E,YACLr+E,KAAM,GACNgP,SAAU,GACVsvE,YAAa,GACbljD,UAAW,EACXmjD,mBAAoB,WACpBC,IAAK,GACLC,UAAW,EACX59C,WAAW,GAEbniC,EAAOggF,QAAU,GAEjBhgF,EAAOigF,iBAAmB,SAAU/8D,GAClCljB,EAAOmsB,OAAO,WACZnsB,EAAO2/E,WAAWC,YAAc18D,KAIpCljB,EAAO2oC,GAAK,WACA3oC,EAAOo9C,YAAYz1C,GAC7B3H,GAAOggF,QAAU,GACjBjxD,EAAcre,QACZmyB,EAAG7iC,EAAO2/E,WAAWr+E,KACrB2F,EAAGjH,EAAO2/E,WAAWrvE,SACrB4E,EAAGlV,EAAO2/E,WAAWC,YACrBvpE,EAAGrW,EAAO2/E,WAAWjjD,UACrBwjD,GAAIlgF,EAAO2/E,WAAWE,mBACtBzpE,EAAG,MACH2Z,EAAG/vB,EAAO2/E,WAAWG,IACrBluB,EAAG5xD,EAAO2/E,WAAWI,UACrBI,GAAIngF,EAAO2/E,WAAWx9C,YACrBp7B,QAAQ,SAAU9D,GACfA,EAAK3B,KACPtB,EAAOggF,QAAU,cAEjBx8D,EAAeyC,MAAMhjB,KAEtB7C,MAAM,SAAU6C,GACbA,EAAK+K,IACPwV,EAAeyC,OACbjY,IAAK,UAAY/K,EAAK+K,MAGxBwV,EAAeyC,OACbjY,IAAK,2CAMbhO,EAAOogF,aAAe,WACpB,MAAiC,KAA1BpgF,EAAO2/E,WAAWG,KAAoD,gBAAhC9/E,GAAO2/E,WAAWG,IAAIn8E,QAA+D,IAAzC3D,EAAO2/E,WAAWC,YAAYj8E,QAA6D,gBAAtC3D,GAAO2/E,WAAWjjD,UAAU/4B,QAAmE,gBAAtC3D,GAAO2/E,WAAWI,UAAUp8E,QAAwD,IAAlC3D,EAAO2/E,WAAWr+E,KAAKqC,QAAqD,gBAA9B3D,GAAO2/E,WAAWrvE,UAG3TtQ,EAAOiM,OAAS,SAAUtE,GACxB6b,EAAeyC,OACbte,IAAKA,QAGR+f,UAAU,4BAA6B,WACxC,OACEC,SAAU,IACVC,OACEiL,SAAY,KAEd/nB,YAAa;qEACb/K,YAAA,SAAY,SAAUC,GACpBA,EAAOqgF,eACL/+E,KAAM,cACNi7B,OAAQ,QAAS,QAAS,SAAU,QAAS,SAC7Cp1B,GAAI,gBAEJ7F,KAAM,cACNi7B,OAAQ,MAAO,MAAO,SAAU,MAAO,OACvCp1B,GAAI,gBAEJ7F,KAAM,eACNi7B,OAAQ,IAAK,IAAK,SAAU,KAAM,MAClCp1B,GAAI,iBAEJ7F,KAAM,gBACNi7B,OAAQ,MAAO,MAAO,SAAU,MAAO,OACvCp1B,GAAI,kBAEJ7F,KAAM,cACNi7B,OAAQ,IAAK,IAAK,SAAU,MAAO,OACnCp1B,GAAI,gBAEJ7F,KAAM,OACNi7B,OAAQ,OAAQ,OAAQ,SAAU,OAAQ,QAC1Cp1B,GAAI,SAENnH,EAAOkuB,MAAQ,IACfluB,EAAOggC,QAAU,GACjBhgC,EAAOouB,OAAS,GAEhBpuB,EAAOstB,OAAS,SAAUgzD,GACxBtgF,EAAO6yB,SAAWytD,EAAKn5E,SAI5BugB,UAAU,qBAAA,UAAqB,SAAU3kB,GAC1C,GAAIs3B,GAAKt3B,EAAQs3B,EACjB,QACE1S,SAAU,IACVC,OACEg4D,YAAe,KAEjB73D,KAAM,SAAUH,EAAOzS,EAAS6S,GAE9B,GAAIkH,GAAO,SAAUqxD,GACnB,GAGIC,GAAenmD,EAAG/M,OAAOnY,EAAQ,IAAI6X,OAAO,OAAO5X,KAAK,QAHhD,KAGgEA,KAAK,SAFpE,IAGTqrE,EAAYpmD,EAAGkC,MAAMoE,SAAShE,QAAQ,EAAG,IAAIC,OAFnC,GAEmD1O,MAC7D6S,EAAQ1G,EAAG6B,IAAI8E,OAAOzE,MAAMkkD,GAAWt/C,OAAO,UAAUF,MAAM,GAAGy/C,YAAY,EAAG,EAAG,EAAG,EAAG,IAAI3kB,WAAW,SAAUt/C,GACpH,MAAO8jE,GAAMhkD,MAAM9f,IAEJ+jE,GAAaxzD,OAAO,KAAK5X,KAAK,YAAa,kBAAkBA,KAAK,QAAS,mBAAmB4G,KAAK+kB,GAGtHnZ,GAAMkB,OAAO,cAAe,SAAUngB,GAChCA,GAAOumB,EAAKvmB,UAIrB+e,UAAU,uBAAA,gBAAuB,SAAUqH,GAC5C,OACEpH,SAAU,IACVC,OACE8U,UAAa,IACbmjD,mBAAsB,IACtBE,UAAa,KAEfj1E,YAAa,mDACbid,KAAM,SAAU/nB,GACdA,EAAOs/E,sBACP,IAAIqB,GAA8B5xD,EAAcxQ,yBAAyBha,KAAK,SAAU+6E,GACtFt/E,EAAOs/E,oBAAsBA,GAG/Bt/E,GAAO4gF,sBAAwB,SAAUC,GACvC1gF,QAAQiI,IAAI,qBAAsBy4E,GAClC7gF,EAAO6/E,mBAAqBgB,EAAmBl4E,OAGjD3I,EAAO8oB,OAAO,qBAAsB,SAAU+2D,GAC5Cc,EAA4Bp8E,KAAK,WAC/BpE,QAAQiI,IAAI,qBAAsBy3E,EAAoB7/E,EAAOs/E,qBAC7Dt/E,EAAO6gF,mBAAqB7gF,EAAOs/E,oBAAoB1hE,OAAO,SAAUC,EAAGpW,GACzE,MAAOoW,KAAMpW,EAAKkB,OAASk3E,EAAqBp4E,EAAO,YAI7DzH,EAAO8oB,OAAO,YAAa,SAAU+Z,EAAGD,GACtCziC,QAAQiI,IAAI,YAAay6B,EAAGD,GAC5B5iC,EAAO8gF,oBAA+C,KAAxB,EAAI9gF,EAAO08B,aAE3C18B,EAAO8oB,OAAO,sBAAuB,SAAU+Z,EAAGD,GAChDziC,QAAQiI,IAAI,sBAAuBy6B,EAAGD,EAEtC5iC,GAAO08B,UAAYx7B,KAAK6gC,OAAO,IAAM/hC,EAAO8gF,qBAD5B,IACmD,WAIxEp5D,UAAU,uBAAA,UAAuB,SAAU3kB,GAC5C,GAAIs3B,GAAKt3B,EAAQs3B,EACjB,QACE1S,SAAU,IACVC,OACE8U,UAAa,IACbqjD,UAAa,KAEfh4D,KAAM,SAAU/nB,EAAQmV,EAAS6S,GAK/B,IAAK,GAJD/kB,IAAQ,GAAK,EAAK,GAAK,IAAM,GAAK,GAAK,GAAK,IAAM,IAAM,GAAK,GAAK,IAElE89E,KAEK99D,EAAI,EAAGA,EAAIhgB,EAAKU,OAAQsf,IAC/B89D,EAAShjE,MACPhV,EAAGka,EAAI,EACPtT,EANa,GAMV1M,EAAKggB,IAIZ,IAAI+9D,KACFj4E,EAAG,IACH4G,EAAG,GACH8M,EAAG,SAEH1T,EAAG,IACH4G,EAAG,KACH8M,EAAG,MAEH1T,EAAG,EACH4G,EAAG,IACH8M,EAAG,MAEH1T,EAAG,EACH4G,EAAG,KACH8M,EAAG,MAEH1T,EAAG,GACH4G,EAAG,GACH8M,EAAG,MAIDwkE,GACF/mD,IAAK,GACL+F,MAAO,GACPC,OAAQ,GACRV,KAAM,IAEJ0hD,EAAM7mD,EAAG/M,OAAOnY,EAAQ,IAAI6X,OAAO,OAAO5X,KAAK,QARvC,KAQuDA,KAAK,SAP3D,IAQT+rE,EAAS9mD,EAAGkC,MAAMoE,SAAS/D,OAAOqkD,EAAQzhD,KATlC,IASgDyhD,EAAQhhD,QAAQtD,QAAQtC,EAAGsD,IAAIojD,EAAU,SAAUtkE,GAC7G,MAAOA,GAAE1T,IACPsxB,EAAGuD,IAAImjD,EAAU,SAAUtkE,GAC7B,MAAOA,GAAE1T,MAEPq4E,EAAS/mD,EAAGkC,MAAMoE,SAAShE,QAAQ,EAAG,IAAIC,OAbjC,GAaiDqkD,EAAQ/mD,IAAK+mD,EAAQ/gD,SAC/Ea,EAAQ1G,EAAG6B,IAAI8E,OAAOzE,MAAM4kD,GAAQlgD,MAAM,GAC1CC,EAAQ7G,EAAG6B,IAAI8E,OAAOzE,MAAM6kD,GAAQngD,MAAM,GAAGogD,SAAS,GAAGlgD,OAAO,QAAQmgD,eAAc,GAEtFC,EAAmB,SAAUC,GAC/BC,KAAO,IAAM,EAAID,GAAa,GAC9BN,EAAIrkD,UAAU,mBAAmBj7B,SACjC5B,EAAOod,KAAO8jE,EAAIl0D,OAAO,YAAY5X,KAAK,KAAM6rE,EAAQzhD,MAAMpqB,KAAK,KAAMqsE,MAAMrsE,KAAK,KArB1E,IAqBwF6rE,EAAQhhD,OAAO7qB,KAAK,KAAMqsE,MAAMrsE,KAAK,SAAU,OAAOA,KAAK,eAAgB,GAAGA,KAAK,OAAQ,QAAQA,KAAK,QAAS,cACnN8rE,EAAIrkD,UAAU,iBAAiBj7B,QAG/B,KAAK,GAFD8/E,GAAQ,EAEHz+D,EAAI,EAAGA,EAAI+9D,EAAMr9E,OAAQsf,IAC5B+9D,EAAM/9D,GAAGtT,GAAK6xE,GAAaR,EAAM/9D,GAAGxG,GAAKzc,EAAO+/E,YAClD//E,EAAO2hF,SAAWT,EAAIl0D,OAAO,QAAQ5X,KAAK,IAAc4rE,EAAM/9D,GAAGla,EAAIg4E,EAASp9E,OA3BxE,KA2BiFyR,KAAK,IAAK,IAAM,EAAI4rE,EAAM/9D,GAAGtT,GAAK,IAAIyF,KAAK,YAAa,QAAQ0sB,MAAM,cAAe,UAAU1sB,KAAK,QAAS,YAAYwL,KAAK,IAAM8gE,GAC3NA,GAAgB,GAKtB1hF,GAAO8oB,OAAO,YAAa,WACpB9oB,EAAO08B,WACZ6kD,EAAiBvhF,EAAO08B,aAE1B18B,EAAO8oB,OAAO,YAAa,WAGzB9oB,EAAO4hF,cAAgB5hF,EAAO+/E,UAC9B8B,KAAO3gF,KAAKkoB,MAAe43D,EAAM,GAAGj4E,EAAIg4E,EAASp9E,OAzCvC,KAyCkD,GAAY3D,EAAO+/E,UAAY,IAA1B,IACjEmB,EAAIrkD,UAAU,oBAAoBj7B,SAClC5B,EAAOod,KAAO8jE,EAAIl0D,OAAO,YAAY5X,KAAK,KAAMysE,MAAMzsE,KAAK,KAAM,IAAIA,KAAK,KAAMysE,MAAMzsE,KAAK,KAAM,IAAIA,KAAK,SAAU,OAAOA,KAAK,eAAgB,GAAGA,KAAK,OAAQ,QAAQA,KAAK,QAAS,eACtL8rE,EAAIrkD,UAAU,iBAAiBj7B,QAG/B,KAAK,GAFD8/E,GAAQ,EAEHz+D,EAAI,EAAGA,EAAI+9D,EAAMr9E,OAAQsf,IAC5B+9D,EAAM/9D,GAAGtT,GAAK3P,EAAO08B,WAAaskD,EAAM/9D,GAAGxG,EAAIzc,EAAO4hF,gBACxD5hF,EAAO2hF,SAAWT,EAAIl0D,OAAO,QAAQ5X,KAAK,IAAc4rE,EAAM/9D,GAAGla,EAAIg4E,EAASp9E,OAjDxE,KAiDiFyR,KAAK,IAAK,IAAM,EAAI4rE,EAAM/9D,GAAGtT,GAAK,IAAIyF,KAAK,YAAa,QAAQ0sB,MAAM,cAAe,UAAU1sB,KAAK,QAAS,YAAYwL,KAAK,IAAM8gE,GAC3NA,GAAgB,KAMtBR,EAAIl0D,OAAO,SAAS5X,KAAK,QAAS,iBAAiBA,KAAK,YAAa,gBAvDxD,GAuDmF6rE,EAAQ/gD,QAAU,KAAKlkB,KAAK+kB,GAC5HmgD,EAAIl0D,OAAO,SAAS5X,KAAK,QAAS,iBAAiBA,KAAK,YAAa,aAAe6rE,EAAQzhD,KAAO,OAAOxjB,KAAKklB,EAC/G,IAAI4gD,GAAWznD,EAAG6B,IAAI9e,OAAOrU,EAAE,SAAU0T,GACvC,MAAO0kE,GAAO1kE,EAAE1T,KACf4G,EAAE,SAAU8M,GACb,MAAO2kE,GAAO3kE,EAAE9M,KACfkxB,YAAY,SACfqgD,GAAIl0D,OAAO,YAAY5X,KAAK,IAAK0sE,EAASf,IAAW3rE,KAAK,SAAU,QAAQA,KAAK,eAAgB,GAAGA,KAAK,OAAQ,QACjHpV,EAAOod,KAAO8jE,EAAIl0D,OAAO,YAAY5X,KAAK,KAAMlU,KAAKkoB,MAAe43D,EAAM,GAAGj4E,EAAIg4E,EAASp9E,OAhE9E,KAgEyF,IAAIyR,KAAK,KAAM,IAAIA,KAAK,KAAMlU,KAAKkoB,MAAe43D,EAAM,GAAGj4E,EAAIg4E,EAASp9E,OAhEjK,KAgE4K,IAAIyR,KAAK,KAAM,IAAIA,KAAK,SAAU,OAAOA,KAAK,eAAgB,GAAGA,KAAK,OAAQ,QACtQ8rE,EAAIl0D,OAAO,QAAQ5X,KAAK,IAAK2sE,KAAW3sE,KAAK,IAAK,IAAIA,KAAK,YAAa,OAAO0sB,MAAM,cAAe,UAAUlhB,KAAK,WAGtH7gB,WAAW,0BAAA,SAAA,aAAA,WAAA,gBAAA,eAA0B,SAAUC,EAAQkf,EAAY5O,EAAUye,EAAe/tB,GAC7FhB,EAAOgiF,aAAehhF,EAAa6C,IAAI,qBAYvC7D,GAAOkf,WAAaA,EACpBlf,EAAOsQ,SAAWA,EAClBtQ,EAAOiiF,cACLxhD,UAAW,OACXvS,MAAO,IACPE,OAAQ,KAEVW,EAAcxQ,yBAAyBha,KAAK,SAAU+6E,GACpDh/E,KAAKg/E,oBAAsBA,EAAoB1hE,OAAO,SAAUC,EAAGuY,GAEjE,MADAvY,GAAEuY,EAAGztB,OAASytB,EACPvY,QAET1X,KAAK7F,OACPyuB,EAAcpP,YAAYT,EAAW/X,GAAI,SAAUe,GACjD,GAAKA,EAAL,CACAlI,EAAOuW,OACLo3B,KACAu0C,OACAC,OAEFniF,EAAOoiF,WACPpiF,EAAOoiF,QAAQrkE,MACbob,KAAM,OACN+oD,IAAK,MACLC,GAAI,MAGN,KAAK,GAAIl/D,GAAI,EAAGA,EAAI/a,EAAOylC,EAAEhqC,OAAQsf,IAAK,CACxC,GAAI5M,GAAI4M,EAAI/D,EAAWmjE,KACvBriF,GAAOoiF,QAAQrkE,MACbob,KAAM9iB,EACN6rE,IAAKh6E,EAAOg6E,IAAIj/D,GAChBk/D,GAAIj6E,EAAOi6E,GAAGl/D,KAEhBjjB,EAAOuW,MAAMo3B,EAAE5vB,MACbhV,EAAGsN,EACH1G,EAAGzH,EAAOylC,EAAE1qB,KAEdjjB,EAAOuW,MAAM2rE,IAAInkE,MACfhV,EAAGsN,EACH1G,EAAGzH,EAAOg6E,IAAIj/D,KAEhBjjB,EAAOuW,MAAM4rE,GAAGpkE,MACdhV,EAAGsN,EACH1G,EAAGzH,EAAOi6E,GAAGl/D,YCllBrBpjB,QAAQC,OAAO,kDAAmD,8CAA+C,cAAe,gBAAiB,eAAgB,SAAU,+BAA+B4nB,UAAU,iCAAA,YAAA,aAAiC,SAAUqD,EAAWjqB,GACxQ,OACE6mB,SAAU,IACV7c,YAAa,mDACb8c,OACE06D,SAAU,KAEZviF,WAAY,wDACZ+9E,SAAU,YACV/1D,KAAM,SAAUH,EAAOzS,EAAS6S,EAAOjoB,GACrCA,EAAWk0B,YACTquD,SAAU,SAAUlyE,GAClBwX,EAAM06D,UACJlyE,WAAYA,YAMrB3P,QAAQ,0BAA2B,WACpC,QACE0D,MAAO,mBACPo+E,WAAY,YACZC,YAAa,sBACbjyE,OACE5H,MAAO,WACP6V,QAAS,WACT+T,QAAS,2BAET5pB,MAAO,OACP6V,QAAS,OACT+T,QAAS,uBAET5pB,MAAO,MACP6V,QAAS,MACT+T,QAAS,sBAET5pB,MAAO,OACP6V,QAAS,OACT+T,QAAS,uBAET5pB,MAAO,MACP6V,QAAS,MACT+T,QAAS,sBAEXkwD,aAAc,WAAY,OAAQ,SAElCt+E,MAAO,mCACPo+E,WAAY,aACZC,YAAa,qBACbpzE,QAAS,SAAUtM,GACjB,MAAOA,GAAQgW,YACb8yC,aAAa,IACZrnD,KAAK,SAAUqjD,GAChB,MAAOA,GAAQ3hD,IAAI,SAAUiR,GAC3B,OACEvO,MAAOuO,EAAI/P,GACXqX,QAAStH,EAAIwC,aAAe,MAAQxC,EAAIixC,cACxCu6B,SACEjmD,KAAM,QACN9zB,MAAOuO,EAAIyrE,eAEXlmD,KAAM,QACN9zB,MAAOuO,EAAI0rE,sBAOrBz+E,MAAO,yBACPo+E,WAAY,wBACZC,YAAa,mBACbpzE,QAAS,SAAUq4C,GACjB,MAAOA,GAA+BjqC,cACpCE,cAAe,IACdnZ,KAAK,SAAUqjD,GAChB,MAAOA,GAAQ3hD,IAAI,SAAUiR,GAC3B,OACEvO,MAAOuO,EAAI/P,GACXqX,QAAStH,EAAI5V,KACb+lD,MAAOnwC,EAAItQ,aAMnBzC,MAAO,OACPo+E,WAAY,MACZC,YAAa,UACbpzE,QAAS,SAAUyzE,GACjB,MAAOA,GAAOviE,WAAW,aAAa/b,KAAK,SAAUyU,GACnD,MAAOA,GAAK/S,IAAI,SAAUuZ,GACxB,OACE7W,MAAO6W,EAAImB,OACXnC,QAASgB,EAAIA,IACbid,KAAM,SACNimD,SACE/5E,MAAO6W,EAAI1X,YAIjB3B,KAAK7F,UAGT6D,MAAO,yBACPo+E,WAAY,UACZC,YAAa,2BACbjyE,OACE5H,MAAO,OACP6V,QAAS,OACT+T,QAAS,+BAET5pB,MAAO,OACP6V,QAAS,OACT+T,QAAS,+BAET5pB,MAAO,OACP6V,QAAS,OACT+T,QAAS,iCAGXpuB,MAAO,yBACPo+E,WAAY,UACZC,YAAa,aACbpzE,QAAS,SAAUtM,GACjB,MAAOA,GAAQgW,aAAavU,KAAK,SAAUqjD,GAEzC,GAAIk7B,KAYJ,OAXAl7B,GAAQ5gD,QAAQ,SAAUkQ,GACxB,KAAM/P,GAAK+P,EAAIwC,aAAa1Q,MAAM,KAAK+G,KAAK,IAEvC+yE,GAAG37E,KACN27E,EAAG37E,IACDwB,MAAOuO,EAAItS,QACX4Z,QAAStH,EAAIwC,aACbpY,KAAM6F,MAIL+K,OAAO8vB,OAAO8gD,UAI1B/iF,WAAW,2CAAA,KAAA,YAAA,SAAA,0BAAA,eAA2C,SAAUgF,EAAIC,EAAW/D,EAAQ8hF,EAAyB/hF,GACjHV,KAAK2zB,WAAa,SAAUjiB,GAa1B,QAAS5C,GAAQ4zE,GACf,MAAOj+E,GAAGK,QAAQ49E,EAAc5zE,QAAUpK,EAAUK,OAAO29E,EAAc5zE,SAAW4zE,EAAczyE,UAbpGyB,EAAUA,MAENA,EAAQswE,WACVhiF,KAAKgiF,SAAWtwE,EAAQswE,UAG1BhiF,KAAK2iF,mBAAqBF,EAC1BziF,KAAKuyB,YACLvyB,KAAK+qE,MAAQ/qE,KAAK2iF,mBAAmBh9E,IAAI,WACvC,WAOFlB,EAAGrB,IAAIpD,KAAK2iF,mBAAmBh9E,IAAImJ,IAAU7K,KAAK,SAAU2+E,GAC1D5iF,KAAK+qE,MAAQ6X,EAIb5iF,KAAKuyB,SAAWvyB,KAAK2iF,mBAAmBh9E,IAAI,SAAU+8E,EAAe7yC,GACnE,GAAI6yC,EAAcP,YAAa,CAC7B,GAAIU,GAAcD,EAAS/yC,GAAKvyB,OAAO,SAAUC,EAAGpW,GAElD,MADAoW,GAAEpW,EAAKkB,OAASlB,EACToW,MAET,QAAQmlE,EAAcP,iBAAmBx8E,IAAI,SAAU0C,GACrD,MAAOw6E,GAAYx6E,KAClBhI,OAAO,SAAUkd,GAClB,QAASA,IAGX,YAGJ1X,KAAK7F,QAGTA,KAAKwD,QAAU9C,EAAa8C,UAC5BxD,KAAKooE,WAAa1nE,EAAa4tC,SAC/BtuC,KAAKsuC,OAAS,WACZ,MAAOtuC,MAAKooE,YAAcpoE,KAAKwD,SAC9BxD,KAAK8iF,mBAAqB,SAAUvwD,GACrC,MAAOA,IAAYA,EAASF,KAAK,SAAUqB,GACzC,OAAsB,IAAfA,EAAIrrB,SAIfrI,KAAKy9E,WAAa,SAAUsF,GACtBA,IAAwC,IAAxBA,EAAa16E,QAC/BrI,KAAKuyB,SAAS,IAAMwwD,KAIxB/iF,KAAKgjF,aAAe,WAClBhjF,KAAKuyB,aAGPvyB,KAAKijF,WAAa,WAChB,MAAOjjF,MAAKuyB,UAAYvyB,KAAKuyB,SAAS,IAAMvyB,KAAKuyB,SAAS,GAAGlvB,QAAUrD,KAAKuyB,SAAS,GAAGlvB,OAAS,IAGnGrD,KAAKkjF,iBAAmB,WACtB,MAAOljF,MAAKuyB,UAAYvyB,KAAKuyB,SAAS,IAAkC,IAA5BvyB,KAAKuyB,SAAS,GAAGlvB,QAG/DrD,KAAKmjF,WAAa,WAChB,GAAInjF,KAAKkjF,mBAEP,WADAviF,GAAOmH,IAAI,yCAIb,IAAIyqB,GAAWvyB,KAAKuyB,QAIpBvyB,MAAKgiF,SAAShiF,KAAK2iF,mBAAmBrlE,OAAO,SAAUC,EAAGmlE,EAAezsE,GAiBvE,MAhBIsc,GAAStc,IAAUsc,EAAStc,GAAO5S,SACrCka,EAAEmlE,EAAcT,YAAc1vD,EAAStc,GAAOtQ,IAAI,SAAUwB,GAC1D,MAAOA,GAAKkB,SAIZkqB,EAAStc,IAAuC,YAA7BysE,EAAcT,YAA4B1vD,EAAStc,GAAO5N,QAC/EkV,EAAEmlE,EAAcT,YAAc1vD,EAAStc,GAAO5N,MAC9CkV,EAAE,aAAkBgV,EAAStc,GAAOjV,MAGlCuxB,EAAStc,IAAuC,YAA7BysE,EAAcT,YAA4B1vD,EAAStc,GAAO5N,QAC/EkV,EAAEmlE,EAAcT,YAAc1vD,EAAStc,GAAO5N,MAC9CkV,EAAE,QAAagV,EAAStc,GAAO5N,OAG1BkV,SAIXvd,KAAKgiF,SAAW,SAAUlyE,GACxBjQ,QAAQiI,IAAI,uBAAwBgI,OCrPxCvQ,QAAQC,OAAO,6CAA8C,8CAA+C,cAAe,gBAAiB,eAAgB,WAAW4nB,UAAU,6BAAA,YAAA,aAA6B,SAAUqD,EAAWjqB,GACjO,OACE6mB,SAAU,IACV7c,YAAa,mDACb8c,OACE4D,OAAQ,IACR+O,QAAS,IACTC,QAAS,IACTkpD,SAAU,IACV78E,UAAW,IACX88E,eAAgB,KAElB5jF,WAAY,oDACZ+9E,SAAU,YACV/1D,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9B,GAAIjoB,GAAa6nB,EAAM7nB,UAEvB6nB,GAAMg8D,aAAe,WACnBh8D,EAAM+7D,gBACJtqE,QAAStZ,EAAW8jF,gBAIxBj8D,EAAM07D,aAAe,WACnBvjF,EAAWsB,UACXumB,EAAM+7D,gBACJtqE,QAAStZ,EAAW8jF,gBAIxB9jF,EAAW+jF,oBAGd/jF,WAAW,uCAAA,SAAA,UAAA,WAAA,iCAAA,cAAA,KAAA,SAAA,UAAuC,SAAUC,EAAQ8C,EAASihF,EAAUt8B,EAAgCsJ,EAAahsD,EAAI89E,EAAQ9/E,GA2BjJ,QAASihF,GAAOC,GACd,MAAO,UAAU7tD,GACf,MAAOA,GAAG6tD,IAId,QAASC,GAAUC,GACjB,MAAO,UAAU/tD,GACf,WAAqBp0B,KAAdo0B,EAAGzyB,QAAwByyB,EAAGnwB,IAAIk+E,IAzB7C,IAAK,GATDC,IAAgB,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAAOn+E,IAAI,SAAUo3B,EAAKy0C,GACzH,OACEnpE,MAAOmpE,EACP1rB,OAAQ/oB,EACRv1B,MAAO,QAGPu8E,KAEKC,EAAM,EAAGA,GAAO,GAAIA,IAC3BD,EAAWtmE,MACTpV,MAAO27E,EACPx8E,MAAO,MAMX,KAAK,GAFDy8E,MAEKC,EAAO,EAAGA,EAAO,GAAIA,IAC5BD,EAAYxmE,MACVpV,MAAO67E,EACPp+B,QAASo+B,EAAO,GAAK,IAAM,IAAMA,EAAO,MACxC18E,MAAO,MAgBX,IAAI28E,GAAsBP,EAAUF,EAAO,UAEvCU,EAAmBR,EAAUF,EAAO,OAEpCW,EAAuBT,EAAUF,EAAO,WAExCY,EAAsBV,EAAUF,EAAO,UAEvCa,EAAiB,SAAUn0C,EAAK/tC,EAAKgG,GACvC,GAAIT,GAASwoC,EAAI/vC,OAAO,SAAUyf,GAChC,MAAOA,GAAIzd,KAASgG,GAEtB,OAAOT,GAAOvE,OAAS,EAAIuE,EAAO,GAAK,MAGrC48E,GACFC,aACEvmE,QAAS,wCACT+T,QAAS,UACTyyD,OACEja,MAAO,GAETka,OACEC,UAAW,EAAG,MAGhB1mE,QAAS,sCACT+T,QAAS,SACTyyD,OACEja,MAAO,GAETka,OACEC,UAAW,EAAG,MAGlBA,WACE1mE,QAAS,0EACT+T,QAAS,oCACTyyD,OACEja,MAAO,EACPoa,GAAI,GAENF,OACEF,YAAa,MAGfvmE,QAAS,yEACT+T,QAAS,mCACTyyD,OACEja,MAAO,EACPoa,GAAI,KAGN3mE,QAAS,yEACT+T,QAAS,mCACTyyD,OACEja,MAAO,EACPoa,GAAI,KAGN3mE,QAAS,wEACT+T,QAAS,kCACTyyD,OACEja,MAAO,EACPoa,GAAI,GAENF,OACEF,YAAa,MAInBzkF,MAAK0R,SACH41C,WACAw9B,UAAW,UAAW,UACtB9oE,SACA+oE,aACArtE,aACAstE,SACAhoD,UACArB,QACAspD,SACAvsE,QACAwsE,mBACAV,uBAAwBA,EAAuBC,WAC/CU,0BACAC,mCAAoC,UAAW,WAEjDplF,KAAKe,UACLf,KAAK6M,SACHmP,OAAO,EAET,IAAIqpE,KACFrkF,KAAM,QACN2E,IAAK,SAA0B22B,GAC7B,MAAOA,MAGTt7B,KAAM,QACN2E,IAAKw+E,IAELnjF,KAAM,YACN2E,IAAKy+E,IAELpjF,KAAM,QACN2E,IAAKw+E,IAELnjF,KAAM,SACN2E,IAAKw+E,IAELnjF,KAAM,QACN2E,IAAKw+E,IAELnjF,KAAM,OACN2E,IAAKw+E,IAELnjF,KAAM,YACN2E,IAAKy+E,IAELpjF,KAAM,cACN2E,IAAKy+E,IAELpjF,KAAM,OACN2E,IAAK0+E,IAELrjF,KAAM,aAENA,KAAM,kBACN2E,IAAKy+E,IAELpjF,KAAM,yBACN2E,IAAK2+E,IAELtjF,KAAM,yBACN2E,IAAKy+E,IAELpjF,KAAM,qCAGRhB,MAAKujF,WAAa,WAChB,GAAIxqE,MACAhY,EAASf,KAAKe,MAclB,OAbAskF,GAAW3+E,QAAQ,SAAU4+E,GAC3B,GAAIpsE,GAAQnY,EAAOukF,EAAUtkF,MACzBqH,EAAQ6Q,GAASosE,EAAU3/E,IAAM2/E,EAAU3/E,IAAIuT,GAASA,CAM5D,KAJI7Q,YAAiBoT,OAAQpT,EAAMhF,OAASgF,KAC1C0Q,EAAQusE,EAAUtkF,MAAQqH,GAGxBA,GAA4B,UAAnBi9E,EAAUtkF,KAAkB,CACvC,KAAMukF,GAAOF,EAAW,GAAG1/E,IAAIuT,EAC/BH,GAAQ,UAAewsE,KAGpBxsE,GAGT/Y,KAAKwlF,0BAA4B,SAAUxpE,EAAOjD,EAASrH,GACzD,GAAI+zE,GAAQzpE,EAAMrW,IAAI,SAAUoW,GAC9B,MAAOvZ,GAAQoX,yBAAyB,MAAQmC,EAAKlV,GAAK,cAE5D,OAAOpC,GAAGrB,IAAIqiF,GAAOxhF,KAAK,SAAUtB,GAClC,MAAOA,GAAK2a,OAAO,SAAUC,EAAGmoE,GAC9B,MAAOnmF,SAAQwqB,MAAMxM,EAAGmoE,UAEzBzhF,KAAK,SAAUtB,GAEhB,GAAIooE,IACF/uD,SAEAgpE,SAEAhoD,UAEArB,QAEAspD,UAGEU,EAAW/zE,OAAOC,KAAKk5D,GAEvB6a,EAAmB,SAAU7sE,EAAS+G,EAAKupB,GAC7C,GAAI7hC,GAAQ,CACZ,MAAMq+E,GAAeF,EAASt8C,EAE9B,KAAK,GAAIy8C,KAAShmE,GAChB,IAAIlO,OAAOC,KAAKkH,GAAS1V,SAAU0V,EAAQ8sE,KAA2D,IAA1C9sE,EAAQ8sE,GAAcx6D,QAAQy6D,GAA1F,CAKA,GAAI3+E,GAAOo9E,EAAexZ,EAAM8a,GAAe,QAASC,EAExD,KAAK3+E,EAAM,CACT,KAAM4+E,GAA0B,SAAhBF,EAA0B7pE,EAAMqW,KAAK,SAAUtW,GAC7D,MAAOA,GAAK/a,OAAS8kF,MAEvB3+E,IACEkB,MAAOy9E,EACPt+E,MAAO,GAGW,SAAhBq+E,IACF1+E,EAAKN,GAAKk/E,EAAQl/E,IAGpBkkE,EAAM8a,GAAcpoE,KAAKtW,GAG3B,GAAI6+E,EAEqB,iBAAdlmE,GAAIgmE,GACbE,EAAYlmE,EAAIgmE,IAEF,IAAVz8C,IAAa7hC,EAAQ,GACzBw+E,EAAYJ,EAAiB7sE,EAAS+G,EAAIgmE,GAAQz8C,EAAQ,IAG5DliC,EAAKK,OAASw+E,EACdx+E,GAASw+E,EAGX,MAAOx+E,GAGTo+E,GAAiB7sE,EAASpW,EAAM,GAChC+O,EAAQsK,MAAQ+uD,EAAM/uD,MACtBtK,EAAQszE,MAAQja,EAAMia,MACtBtzE,EAAQsrB,OAAS+tC,EAAM/tC,OAAOr3B,IAAI,SAAUsgF,GAG1C,MAFAA,GAAM59E,MAAQ0sE,SAASkR,EAAM59E,OAC7B49E,EAAM59E,SAEJA,MAAO49E,EAAM59E,MACby9C,OAAQrjD,EAAQsgB,SAASkjE,MAAMA,EAAM59E,OAAOG,OAAO,OACnDhB,MAAOy+E,EAAMz+E,SAGjBkK,EAAQiqB,KAAOovC,EAAMpvC,KAAKh2B,IAAI,SAAUq+E,GAEtC,MADAA,GAAI37E,MAAQ0sE,SAASiP,EAAI37E,OAClB27E,IAETtyE,EAAQuzE,MAAQla,EAAMka,MAAMt/E,IAAI,SAAUu+E,GAExC,MADAA,GAAK77E,MAAQ0sE,SAASmP,EAAK77E,QAEzBA,MAAO67E,EAAK77E,MACZy9C,OAAQrjD,EAAQsgB,SAASmhE,KAAKA,EAAK77E,OAAO69E,OAAO,GAAG19E,OAAO,SAC3DhB,MAAO08E,EAAK18E,QAIhB,IAAI+tB,GAAO,SAAU3gB,EAAG6a,GACtB,MAAO7a,GAAEvM,MAAQonB,EAAEpnB,MAAQ,GAAK,EAGlCqJ,GAAQsK,MAAMuZ,KAAKA,GACnB7jB,EAAQszE,MAAMzvD,KAAKA,GACnB7jB,EAAQsrB,OAAOzH,KAAKA,GACpB7jB,EAAQiqB,KAAKpG,KAAKA,GAClB7jB,EAAQuzE,MAAM1vD,KAAKA,MAIvBv1B,KAAKmmF,kBAAoB,SAAUnqE,EAAOkmC,EAAQxwC,GAChDA,EAAQsK,MAAQA,EAAMrW,IAAI,SAAUoW,GAClC,OACE1T,MAAO0T,EAAK/a,KACZwG,MAAO,KACPX,GAAIkV,EAAKlV,KAOb,KAAK,GAJDm+E,MACAoB,GAAWlkC,EAAO5kB,IAAM,GAAIr1B,MAAKi6C,EAAO5kB,KAAO,GAAIr1B,OAAQwc,cAC3D4hE,EAAUnkC,EAAO7kB,IAAM,GAAIp1B,MAAKi6C,EAAO7kB,KAAK5Y,cAAgB,OAEvD0V,EAAOisD,EAASjsD,GAAQksD,EAASlsD,IACxC6qD,EAAMvnE,MACJpV,MAAO8xB,EACP3yB,MAAO,MAIXkK,GAAQszE,MAAQA,EAChBtzE,EAAQsrB,OAAS8mD,EACjBpyE,EAAQiqB,KAAOooD,EACfryE,EAAQuzE,MAAQhB,GAGlBjkF,KAAKwjF,aAAe,SAAUzqE,GAC5B,GAAI43B,GAAO3wC,SAEK0B,KAAZqX,IACFA,KAGF,IAEIiD,GAFAtK,EAAU1R,KAAK0R,QACf7E,EAAU7M,KAAK6M,OAGnB,QAAwBnL,KAApBhC,EAAO0jF,cAA6C1hF,KAAnBhC,EAAOw6B,aAA4Cx4B,KAAnBhC,EAAOu6B,QAK1E,WAHAjlB,YAAW,WACThV,KAAKwjF,aAAazqE,IAClBlT,KAAK7F,MAAO,IAIhB6M,GAAQmP,OAAQ,EAChBxZ,EAAQ+V,WAAWtU,KAAK,SAAUtB,GAGhC,MAFAqZ,GAAQrZ,EAEJqZ,EAAM3Y,OAAS,IAAM3D,EAAO0jF,SAAW,IAClCzyC,EAAK60C,0BAA0BxpE,EAAOjD,EAASrH,GAE/Ci/B,EAAKw1C,kBAAkBnqE,GAC5BqhB,IAAK39B,EAAOw6B,QAAQosD,cACpBhpD,IAAK59B,EAAOu6B,QAAQqsD,eACnB50E,KAEJq6C,QAAQ,WACTl/C,EAAQmP,OAAQ,IAElBxZ,EAAQgW,YACN8yC,aAAa,GACZ,SAAUhE,GACX51C,EAAQ41C,QAAUA,IAEpBmJ,EAAY3hD,UAAU7K,KAAK,SAAUyT,GACnChG,EAAQgG,UAAYA,IAEtB6qE,EAAOviE,WAAW,aAAa/b,KAAK,SAAUyU,GAC5C,GAAI6tE,KACJ7tE,GAAKhS,QAAQ,SAAUqP,GACrB,GAAI1T,GAAM0T,EAAEmJ,GAEPqnE,GAAQlkF,IAOXkkF,EAAQlkF,GAAKge,OAAO5C,KAAK1H,EAAEsK,QAC3BkmE,EAAQlkF,GAAKmF,SAPb++E,EAAQlkF,IACN6c,IAAK7c,EACLge,QAAStK,EAAEsK,QACX7Y,MAAOuO,EAAEvO,SAOfkK,EAAQgH,KAAO9G,OAAO8vB,OAAO6kD,IAC7B1gF,KAAK7F,OACPyjF,EAASxzE,KAAK,SAAUi1E,GACtBxzE,EAAQwzE,gBAAkBA,EAAgBv/E,IAAI,SAAUwnD,GAItD,MAHAA,GAAEnsD,KAAOmsD,EAAEmI,MACXnI,EAAEtmD,GAAKsmD,EAAEj6C,aACFi6C,GAAEmI,MACFnI,KAETtnD,KAAK7F,OACPmnD,EAA+BjqC,cAC7BE,cAAe,IACdnZ,KAAK,SAAUqjD,GAChB51C,EAAQyzE,uBAAyB79B,GACjCzhD,KAAK7F,QAGTA,KAAKwmF,oCAAsC,SAAUtB,GACnDrlF,QAAQiI,IAAI,iEAAkEo9E,EAC9E,IAAIuB,GAAgBvB,GAAmBA,EAAgB5nE,OAAO,SAAU1I,EAAG6a,GACzE,MAAO7a,MAAO6a,EAAE2M,YACf,GACCsqD,EAAU1mF,KAAK0R,QAAQ8yE,uBACvBmC,EAAUF,EAAgB,WAAa,aACvCG,EAAUpC,EAAuBmC,EACrC3mF,MAAK0R,QAAQ8yE,uBAAyBoC,EAElCF,GAAWE,IACb5mF,KAAKe,OAAOyjF,uBAAyBxkF,KAAKe,OAAOyjF,uBAAuBlnE,OAAO,SAAUjG,EAAGwvE,GAC1F,GAAIlC,GAAQkC,EAAGlC,OAASkC,EAAGlC,MAAMgC,EAajC,OAXIhC,IACFA,EAAMj+E,QAAQ,SAAUic,GACtB,GAAImkE,GAASF,EAAQjkE,EAEhBtL,GAAEpB,MAAM6wE,KACXzvE,EAAEpB,MAAM0M,GAAK,EACbtL,EAAEpH,KAAKwN,KAAKqpE,MAKXzvE,IAEPpH,QACAgG,WACChG,UC/cT1Q,QAAQC,OAAO,2BAA4B,8CAA+C,+BAAgC,iDAAkD,4CAA6C,cAAe,gBAAiB,eAAgB,WAAWqC,QAAA,iBAAO,SAAUq1C,GACnSA,EAAeC,MAAM,wBACnB9vC,IAAK,cACL5H,WAAY,yBACZ+K,YAAa,iDAEd/K,WAAW,YAAA,SAAA,UAAA,WAAA,QAAA,SAAA,SAAA,eAAA,oBAAY,SAAUC,EAAQ8C,EAASihF,EAAU1/E,EAAO8E,EAAQlI,EAAQD,EAAc6/C,GAClG7gD,EAAOqnF,iBACPrnF,EAAOsnF,cAEPhnF,KAAKinF,oBAAsB,SAAUC,GACnC,GAAInmF,GAASxB,QAAQwqB,SAAUrqB,EAAOqB,OAYtC,OAXAmmF,GAASA,IAAW,QACpBnmF,EAAOmmF,OAASA,EAChBnmF,EAAOyQ,MAAQ9R,EAAO4wC,aACtBvvC,EAAO0Q,OAASy1E,EAAO77D,QAAQ,SAAW,GAAK3rB,EAAO2wC,YAAc,GAAK3wC,EAAO4wC,aAAe,EAC/FvvC,EAAOs0B,OAAS,kCAEZt0B,EAAOu7B,QACTv7B,EAAOu7B,MAAM9f,KAAOuG,OAAOhiB,EAAOu7B,MAAM9f,MAAMhU,OAAO,cAAgB,iBACrEzH,EAAOu7B,MAAMx7B,GAAKiiB,OAAOhiB,EAAOu7B,MAAMx7B,IAAI0H,OAAO,cAAgB,kBAG5DzH,GAGTf,KAAKmnF,WAAa,SAAUD,GAC1BxnF,EAAOmN,SAAU,EACjBq6E,EAASA,IAAW,OACpB,IAAInmF,GAASf,KAAKinF,oBAAoBC,GAClCE,EAASF,EAAO5pE,OAAO,SAAUwC,EAAKlL,GAExC,MADAkL,GAAIlL,IAAK,EACFkL,MAGLsnE,GAAOn3E,OACTvQ,EAAO2nF,SAGLD,EAAO5/E,QACT9H,EAAO4nF,cAAY5lF,IAGrBc,EAAQiW,QAAQ1X,EAAQ,SAAU4B,GACX,GAAjBukF,EAAO7jF,SACTV,EAAOukF,EAAO5pE,OAAO,SAAUwC,EAAKlL,GAElC,MADAkL,GAAIlL,GAAKjS,EACFmd,QAIPsnE,EAAOn3E,OACTvQ,EAAO2nF,KAAO1kF,EAAKsN,KAEnBvQ,EAAO2nF,KAAK3gF,QAAQ,SAAU6gF,GACxB7nF,EAAOqnF,cAAczjF,SAASikF,EAAI1gF,MACpC0gF,EAAI70D,SAAU,KAGlBhzB,EAAOmN,SAAU,GAGfu6E,EAAO5/E,QACT9H,EAAO4nF,UAAY3kF,EAAK6E,OAGtB4/E,EAAOI,YAAc7kF,EAAK6kF,WAAWC,UAAY9kF,EAAK6kF,WAAWE,WACnEhoF,EAAOw6B,QAAU,GAAIjyB,MAAK,GAAIA,MAAKtF,EAAK6kF,WAAWC,SAASt8C,OAAO,EAAG,IAAM,kBAAkBjjC,UAAY,OAC1GxI,EAAOu6B,QAAU,GAAIhyB,MAAK,GAAIA,MAAKtF,EAAK6kF,WAAWE,SAASv8C,OAAO,EAAG,IAAM,kBAAkBjjC,UAAY,WAKhHlI,KAAK2nF,SAAW,SAAU7zD,EAAS0B,GACjC91B,EAAOo0B,QAAUA,EACjBp0B,EAAO81B,QAAUA,EACjBx1B,KAAKmnF,cAGPnnF,KAAKsjF,aAAe,SAAUvqE,GAC5BrZ,EAAO2wC,YAAc,EACrB3wC,EAAOqB,OAASgY,EAChB/Y,KAAKmnF,YAAY,QAAS,UAG5BnnF,KAAK4nF,WAAa,WAChB5nF,KAAKmnF,YAAY,QAAS,UAG5BnnF,KAAK6nF,aAAe,WAClB,MAAOnnF,GAAa6C,IAAI,8BAG1BvD,KAAK8nF,eAAiB,WACpB,GAAItQ,GAAaj4E,QAAQwqB,SAAUrqB,EAAOqB,OAE1C,OAAK6Q,QAAOC,KAAK2lE,GAAYn0E,OAKL,GAApB3D,EAAO4nF,cACT3mF,GAAOb,MAAM,8CAIVY,EAAa6C,IAAI,qBAKlBi0E,EAAW9+D,MAAQ8+D,EAAW9+D,KAAKrV,SACrCm0E,EAAW9+D,KAAO8+D,EAAW9+D,KAAKC,QAGhC6+D,EAAWsN,UAAYtN,EAAWsN,SAASzhF,SAC7Cm0E,EAAWsN,SAAWtN,EAAWsN,SAAS,IAGxCtN,EAAWl7C,QACbk7C,EAAWl7C,MAAM9f,KAAOuG,OAAOy0D,EAAWl7C,MAAM9f,MAAMhU,OAAO,cAAgB,iBAC7EgvE,EAAWl7C,MAAMx7B,GAAKiiB,OAAOy0D,EAAWl7C,MAAMx7B,IAAI0H,OAAO,cAAgB,kBAGvE9I,EAAOqnF,eAAiBrnF,EAAOqnF,cAAc1jF,SAC/Cm0E,EAAW1D,OAASp0E,EAAOqnF,mBAGTl+E,GAAO0B,MACzB9K,WAAY,gCACZ+K,YAAa,sCACb1F,SACE0yE,WAAY,WACV,MAAOA,KAGXrwD,UAAU,IAEEvf,OAAO3D,KAAK,SAAUtB,GACb,qBAAjBA,EAAKkF,SACPlH,EAAOmH,IAAInF,EAAKkF,gBAjClBlH,GAAOb,MAAM,sDAVba,GAAOmH,IAAI,4CAgDf9H,KAAK+nF,oBAAsB,WACzB,OAAQroF,EAAOsnF,WAAW3jF,SAAW3D,EAAOgzB,SAG9C1yB,KAAKgoF,iBAAmB,WACtB,IAAKtnF,EAAa6C,IAAI,6BAEpB,WADA5C,GAAOb,MAAM,kDAIf,MAAMunF,GAAO3nF,EAAOsnF,WAAW3mF,OAAO,SAAUknF,GAC9C,OAAQA,EAAIU,UAGd,KAAKZ,IAASA,EAAKhkF,OACjB,MAAO1C,GAAOmH,IAAI,yCAGpB,MAAML,GAAW4/E,EAAK/pE,OAAO,SAAUC,EAAGgqE,GAExC,MADAhqE,GAAEgqE,EAAIxrE,MAAQwB,EAAEgqE,EAAIxrE,MAAQ,GAAK,EAC1BwB,OAEH7S,KACAuF,IAUN,IATAvF,EAAS+S,KAAK,kDACd7L,OAAOC,KAAKpK,GAAUf,QAAQ,SAAUqV,EAAM9F,GAC5C,KAAMZ,GAAI5N,EAASsU,GAAQ,EAAI,IAAM,EAEjC9F,GAAQ,GACVhG,EAAKwN,KAAKhW,EAASsU,GAAQ,aAAe1G,EAAI,UAAY0G,EAAO,OAIjEnK,OAAOC,KAAKpK,GAAUpE,OAAS,EAAG,CACpC,GAAImE,GAAQ,CACZoK,QAAOC,KAAKpK,GAAUf,QAAQ,SAAUqV,EAAM9F,GACxCA,GAAS,IACXzO,GAAgBC,EAASsU,KAG7B,MAAM/O,GAAM,KAAOxF,EAAQ,qBAAuBoK,OAAOC,KAAKpK,GAAUpE,OAAS,GAAK,cACtF4M,GAAKwN,KAAKzQ,GAGZ,MAAOnE,GAAO0B,MACZC,YAAa,gCACb/K,WAAY,WACVO,KAAK0K,SAAWA,EAChB1K,KAAKiQ,KAAOA,EACZjQ,KAAKkoF,KAAO,kEACZloF,KAAK4K,MAAQ,SACb5K,KAAK6K,UAAY,UAEnBC,aAAc,UACblD,OAAO3D,KAAK,WACb,MAAOF,GAAMkF,KAAK,gBAAkBzG,EAAQU,SAAW,sBACrDmkF,KAAMA,MAEPpjF,KAAK,SAAUiG,GAChB,GAAIA,EAASvH,KAAK7C,MAChB,MAAOa,GAAOb,MAAMoK,EAASvH,KAAK7C,MAGpCE,MAAKmnF,YAAY,QAAS,SAC1BxmF,EAAOmH,IAAIoC,EAASvH,KAAKqK,MACzBnH,KAAK7F,QAGTA,KAAKmoF,oBAAsB,WACzB,GAAIpvE,GAAUrZ,EAAOqB,MAErB,OAAKL,GAAa6C,IAAI,6BAKjB7D,EAAO2nF,KAAKhkF,OAKVb,EAAQoW,aAAaG,GAAS9U,KAAK,SAAUwD,GAClD,GAAIiD,MACA09E,EAAgB,EAChBC,KACAp4E,IAaJ,IAZAvF,EAAS+S,KAAK,kDACdhW,EAASf,QAAQ,SAAUuwE,EAAOhhE,GAChC,GAAIZ,GAAI4hE,EAAMzvE,MAAQ,EAAI,IAAM,IAE3ByvE,EAAMgR,UAAYhyE,EAAQ,EAC7BhG,EAAKwN,KAAKw5D,EAAMzvE,MAAQ,aAAe6N,EAAI,UAAY4hE,EAAMl7D,KAAO,KAC3Dk7D,EAAMgR,WACfG,GAAiBnR,EAAMzvE,MACvB6gF,EAAc5qE,KAAK,IAAMw5D,EAAMl7D,KAAO,QAItCtU,EAASpE,OAAS,EAAG,CACvB,GAAImE,GAAQ,CACZC,GAASf,QAAQ,SAAUuwE,EAAOhhE,GAC5BA,GAAS,IACXzO,GAAgByvE,EAAMzvE,QAG1B,MAAMwF,GAAM,KAAOxF,EAAQ,qBAAuBC,EAASpE,OAAS,GAAK,cACzE4M,GAAKwN,KAAKzQ,GAOZ,MAJIo7E,IACF19E,EAAS+S,KAAK,wBAA0B2qE,EAAgB,8BAAgCC,EAAc54E,KAAK,MAAQ,uGAG9G5G,EAAO0B,MACZC,YAAa,gCACb/K,WAAY,WACVO,KAAK0K,SAAWA,EAChB1K,KAAKiQ,KAAOA,EACZjQ,KAAKkoF,KAAO,kEACZloF,KAAK4K,MAAQ,SACb5K,KAAK6K,UAAY,UAEnBC,aAAc,UACblD,SACF3D,KAAK,WACN,MAAOF,GAAMkF,KAAK,gBAAkBzG,EAAQU,SAAW,8BAA+B6V,GAASjZ,MAAM,SAAUA,GAC7G,MAAOa,GAAOb,MAAMA,OAErBmE,KAAK,SAAUiG,GAChB,GAAIA,EAASvH,KAAK7C,MAChB,MAAOa,GAAOb,MAAMoK,EAASvH,KAAK7C,MAGpCE,MAAKmnF,YAAY,QAAS,SAC1BxmF,EAAOmH,IAAIoC,EAASvH,KAAKqK,MACzBnH,KAAK7F,WA1DLW,GAAOb,MAAM,4BALba,GAAOb,MAAM,oDAkEjBJ,EAAOqB,UACPrB,EAAOmN,SAAU,EACjBnN,EAAO2wC,YAAc,EACrB3wC,EAAO4wC,aAAe,GACtBtwC,KAAKmnF,YAAY,QAAS,aAAc,SACxCznF,EAAO8oB,OAAO,UAAW,WACvB9oB,EAAO4oF,6BAGT5oF,EAAO4oF,yBAA2B,WAChC5oF,EAAO2nF,KAAK3gF,QAAQ,SAAU6gF,GACxBA,EAAI70D,UAAYhzB,EAAOqnF,cAAczjF,SAASikF,EAAI1gF,MACpDnH,EAAOqnF,cAActpE,KAAK8pE,EAAI1gF,IAC9BnH,EAAOsnF,WAAWvpE,KAAK8pE,OAK7B7nF,EAAO6oF,UAAY,SAAUhB,GAC3B,IAAKA,EAAI70D,QAAS,CAChB,KAAMzc,GAAQvW,EAAOqnF,cAAcpf,UAAU,SAAU9gE,GACrD,MAAOA,KAAO0gF,EAAI1gF,IAIpB,OAFAnH,GAAOqnF,cAAc94D,OAAOhY,EAAO,OACnCvW,GAAOsnF,WAAW/4D,OAAOhY,EAAO,GAI9BvW,EAAOqnF,cAAczjF,SAASikF,EAAI1gF,MACtCnH,EAAOqnF,cAActpE,KAAK8pE,EAAI1gF,IAC9BnH,EAAOsnF,WAAWvpE,KAAK8pE,KAGzBvnF,KAAK02E,eAAiB,SAAUrmC,GAC9B3wC,EAAO2wC,YAAcA,EACrBrwC,KAAKmnF,cAGPnnF,KAAKwoF,gBAAkB,SAAUl4C,GAC/B5wC,EAAO4wC,aAAeA,EACtBtwC,KAAKmnF,cAGPnnF,KAAKyoF,iBAAmB,SAAUjR,GAChC,MAAI92E,GAAa8C,UACRxD,KAAKu3E,gBAAgBC,GAG1B92E,EAAa0C,MAAQ1C,EAAa0C,IAAIC,SAAW3C,EAAa6C,IAAI,iBAC7D5C,EAAOb,MAAM,iDAGtBE,MAAKu3E,gBAAgBC,IAGvBx3E,KAAKu3E,gBAAkB,SAAUC,GAC/B93E,EAAOqB,OAAO4tC,UAAYjuC,EAAaguC,gBAAkB,GACnC7lC,EAAO0B,MAC3B9K,WAAY,qCACZ+K,YAAa,oCACb1F,SACEnC,KAAM,WACJ,OACE5B,OAAQrB,EAAOqB,OACfy2E,WAAYA,KAIlBrwD,UAAU,IAEEvf,OAAO3D,KAAK,WACxBtD,EAAOmH,IAAI,kFAGdrI,WAAW,iCAAA,SAAA,iBAAA,cAAA,aAAA,SAAiC,SAAUC,EAAQwjB,EAAgButC,EAAa+mB,EAAY72E,GACxG,GAAIiH,EAEJlI,GAAO2yD,aAAe,SAAUrxD,GAC9BtB,EAAOyxD,kBAAmB,EAC1BV,EAAYrgD,QACVkiD,cAAetxD,EACfD,OAAQy2E,GACP,SAAU70E,GACXjD,EAAOyxD,kBAAmB,EAEtBxuD,EAAK7C,MACPJ,EAAOi2E,QAAUhzE,EAAK7C,OAEtB8H,EAASjF,EACTugB,EAAeyC,OACb9d,QAAS,uBAIf,IAAIgrC,EACJsV,cAAatV,GACbA,EAAU79B,WAAW,WACnBtV,EAAOyxD,kBAAmB,EAC1BjuC,EAAeyC,OACb9d,QAAS,sBAGNnI,EAAOi2E,SAAY/tE,GACtBjH,EAAOmH,IAAI,2EAEZ,MAGLpI,EAAOgpF,mBAAqB,WAC1BhpF,EAAOi2E,QAAU,SAElBl2E,WAAW,sCAAA,SAAA,iBAAA,UAAA,OAAsC,SAAUC,EAAQwjB,EAAgB1gB,EAASG,GAC7FjD,EAAOivC,UAAYhsC,EAAK5B,OAAO4tC,UAE/BjvC,EAAO+oF,iBAAmB,SAAUp8E,GAClC1J,EAAK5B,OAAO4tC,UAAYtiC,EACxB3M,EAAOipF,iBAAkB,EACzBjpF,EAAOi2E,QAAU,GACjBnzE,EAAQsW,iBAAiBnW,EAAK5B,OAAQ4B,EAAK60E,YAAYvzE,KAAK,SAAUtB,GACpEjD,EAAOipF,iBAAkB,EAErBhmF,EAAK7C,MACPJ,EAAOi2E,QAAUhzE,EAAK7C,MAEtBojB,EAAeyC,WAKrBjmB,EAAOkpF,gBAAkB,WACvBlpF,EAAOi2E,QAAU,SAElBvuD,UAAU,YAAa,WACxB,OACEK,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9B,GAAI8V,GAAKqrD,CACTrrD,GAAM,KAENqrD,EAAY,WACVh0E,EAAQ,GAAGgpB,IAAM,GACjBL,EAAM,GAAIG,OACVH,EAAIK,IAAMnW,EAAMohE,UAEhBtrD,EAAII,OAAS,WACX/oB,EAAQ,GAAGgpB,IAAMnW,EAAMohE,WAGzBtrD,EAAIkZ,QAAU,WACZ7hC,EAAQ,GAAGgpB,IAAM,+EAIrBvW,EAAMkB,OAAO,WACX,MAAOd,GAAMohE,WACZ,SAAUp3C,EAAQC,GACfA,IAAWD,GACbm3C,UCvbVtpF,QAAQC,OAAO,0BAA2B,cAAe,gBAAiB,eAAgB,mBAAoB,yBAA0B,6BAA8B,WAAWqC,QAAA,iBAAO,SAAUq1C,GAChMA,EAAeC,MAAM,uBACnB9vC,IAAK,aACL5H,WAAY,8BACZ+K,YAAa,+CAEd/K,WAAW,iBAAA,SAAA,cAAA,UAAA,gBAAA,eAAA,SAAA,SAAA,UAAA,oBAAiB,SAAUC,EAAQkvD,EAAapsD,EAAS+B,EAAe7D,EAAcC,EAAQkI,EAAQpG,EAASqoE,GAC3H,GAAIn6B,GAAO3wC,IACX4R,QAAOzJ,OAAOnI,MACZ2zB,WAAY,WACV3zB,KAAK6M,SAAU,EACf7M,KAAK+oF,UAAW,EAChB/oF,KAAKg9E,aACLh9E,KAAKgpF,WAAa,mBAClBhpF,KAAKipF,YACHjmF,KAAM,EACNwO,MAAO,IACPC,OAAQ,EACRwkE,WAAY,EACZC,WAAY,GAEdl2E,KAAKqqD,WAAa7nD,EAAQU,SAC1BlD,KAAKgJ,QACHuW,EAAG,IAELvf,KAAK8O,UACL9O,KAAK6yC,SAEPq2C,kBAAmB,SAAUhxE,GACtBA,GACL1V,EAAQyV,eAAeC,EAAW,SAAUvV,GACtCA,IACFF,EAAQiB,SAASC,SAAW,YAAchB,EAAK0E,IAAM,2BAI3DqvE,eAAgB,WACd/lC,EAAKs4C,WAAWx3E,OAASk/B,EAAKs4C,WAAWjmF,KAAO,EAChDhD,KAAK8O,WAEPA,QAAS,WACP6hC,EAAK9jC,SAAU,CACf,MAAMqD,IACJyQ,kBAAkB,EAClBpB,EAAGoxB,EAAK3nC,OAAOuW,EACf/N,MAAOm/B,EAAKs4C,WAAWz3E,MACvBC,OAAQk/B,EAAKs4C,WAAWx3E,OAASk/B,EAAKs4C,WAAWz3E,MAGnD,OADAtB,GAAKygC,EAAKq4C,aAAc,EACjBp6B,EAAY9/C,QAAQoB,GAAMjM,KAAK,SAAUtB,GAC9CguC,EAAK9jC,SAAU,EACf8jC,EAAKqsC,UAAYr6E,EAAKsN,KACtB0gC,EAAKs4C,WAAWhT,WAAatzE,EAAK6E,MAClCmpC,EAAKs4C,WAAW/S,WAAat1E,KAAKgoB,KAAK+nB,EAAKs4C,WAAWhT,WAAatlC,EAAKs4C,WAAWz3E,QACpF3L,KAAK7F,OAAOmK,MAAM,SAAUuD,GAC5BijC,EAAK9jC,SAAU,EACf8jC,EAAKqsC,aACLr8E,EAAOgN,YAAYD,IACnB7H,KAAK7F,QAETivE,gBAAiB,WACf,GAAI3e,GAAQtwD,IAEZmoD,cAAaxX,EAAKkC,SAClBlC,EAAKkC,QAAU79B,WAAW,WACpB27B,EAAK3nC,OAAOuW,EAAE1C,OAAOxZ,OAAS,GAAKstC,EAAK3nC,OAAOuW,EAAE1C,OAAOxZ,OAAS,GAErEitD,EAAM64B,cACL,MAELA,WAAY,WACVnpF,KAAK85E,kBACL95E,KAAK8O,WAEPy+D,yBAA0B,SAAU1sD,GAClC,KAAMysD,IAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,IAC7E,OAAOoR,GAAW,YAAcA,EAAShI,YAAc,qBAAuBgI,EAASzJ,UAAY,MAAQk2D,EAAM,IAEnH8b,eAAgB,SAAUtoE,GACxB,IAAKpgB,EAAa6C,IAAI,oBAEpB,WADA5C,GAAOb,MAAM,iDAIfJ,GAAOm7B,OACLh3B,MAAO,kBACP6G,UAAW,kDACXE,MAAO,MACPC,UAAW,MAEOhC,EAAO0B,MACzBC,YAAa,gCACb8c,MAAO5nB,IAEKkI,OAAO3D,KAAK,SAAUolF,GAClC,GAAIA,EACF,MAAOz6B,GAAYxgD,OAAO0S,GAAY7c,KAAK,WACzC0sC,EAAK7hC,eAKbw6E,UAAW,SAAUC,GACnB54C,EAAKq4C,WAAaO,EAClBvpF,KAAKmpF,cAEPrP,gBAAiB,WACfnpC,EAAKs4C,YACHjmF,KAAM,EACNwO,MAAO,IACPC,OAAQ,EACRwkE,WAAY,EACZC,WAAY,IAGhBsT,YAAa,SAAU3oE,GACrB8vB,EAAKo4C,UAAW,EAChBn6B,EAAYvtD,KACVL,KAAM6f,EAAS7f,KACfoW,UAAWyJ,EAASzJ,UACpB9S,QAASuc,EAASvc,QAClButC,SAAUhxB,EAASgxB,SACnBr9B,KACEijD,GAAI52C,EAAS42C,GACbC,GAAI72C,EAAS62C,GACbC,GAAI92C,EAAS82C,GACbC,GAAI/2C,EAAS+2C,IAEf6xB,kBAAmB5oE,EAASzZ,UAC3BnD,KAAK,SAAU4c,GAChBhhB,QAAQiI,IAAI,eAAgB+Y,GAC5B8vB,EAAKo4C,UAAW,EACI,IAAhBloE,EAASha,GAAUlG,EAAOb,MAAM,yDAAkE+gB,EAAS/gB,MAAOa,EAAOb,MAAM,kDAAuDa,EAAOmH,IAAI,2CACpMqC,MAAM,SAAUuD,GACjB7N,QAAQiI,IAAI,MAAO4F,GACnBijC,EAAKo4C,UAAW,EAChBpoF,EAAOb,MAAM4N,MAGjB+uE,kBAAmB,SAAU57D,EAAUrU,GACjCA,IACFA,EAAO7K,iBACP6K,EAAOgtB,mBAITj1B,EAAce,QAAQ,sBAAuBL,KAAKM,UAAU,IAC5D1F,QAAQwY,KAAK,QACbyyD,EAAkBhtB,QAAQ8Q,EAAYp7C,eAAeqN,IAAW,MAGpE7gB,KAAK2zB,gBCvJPp0B,QAAQC,OAAO,8BAA+B,YAAa,kDAAmD,wCAAyC,wCAAwCqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC9No1C,EAAeC,MAAM,2BACnB9vC,IAAK,SACLwZ,SAAU,cACV27B,UAAU,OCJdj9C,QAAQC,OAAO,wBAAyB,YAAa,8BAA+B,oCAAoCqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACvJo1C,EAAeC,MAAM,qBACnB9vC,IAAK,WACLwZ,SAAU,cACV27B,UAAU,OCJdj9C,QAAQC,OAAO,mCAAoC,cAAe,iBAAkB,gBAAiB,eAAgB,oBAAqB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACpLo1C,EAAeC,MAAM,gCACnB9vC,IAAK,cACL5H,WAAY,iDACZ+K,YAAa,8CAEd/K,WAAW,oCAAA,SAAA,mBAAoC,SAAUC,EAAQgqF,GAClE1pF,KAAKgW,SAAW,WACdhW,KAAK6M,SAAU,EACf68E,EAAiB9nE,oBAAoB3d,KAAK,SAAUtB,GAClD3C,KAAK6M,SAAU,EACf7M,KAAKiQ,KAAOtN,EAAKsN,KACjBjQ,KAAKwH,MAAQ7E,EAAK6E,OAClB3B,KAAK7F,QAGTA,KAAKgW,cChBPzW,QAAQC,OAAO,+BAAgC,cAAe,gBAAiB,eAAgB,oBAAqB,sBAAuB,iBAAkB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACvMo1C,EAAeC,MAAM,4BACnB9vC,IAAK,IACL5H,WAAY,6CACZ+K,YAAa,0CAEdnK,OAAO,cAAe,WACvB,MAAO,UAAUspF,GACf,GACIC,GACAjjF,EAFAu1B,GAAU,IAAK,KAAM,KAAM,KAI/B,KAAKv1B,EAAI,EAAGgjF,EAAQ/oF,KAAKipF,IAAI,KAAMljF,GAAK,EAAGA,IACzCijF,EAAWD,EAAQ/oF,KAAKipF,IAAI,KAAMljF,EAIpC,OADAijF,GAAWhpF,KAAK6gC,MAAiB,IAAXmoD,GAAkB,IACjCE,OAAOF,GAAY,IAAM1tD,EAAOv1B,EAAI,MAE5ClH,WAAW,gCAAA,SAAA,UAAA,UAAA,qBAAA,eAAA,SAAA,YAAA,mBAAgC,SAAUC,EAAQqqF,EAASvnF,EAASwnF,EAAoBtpF,EAAcC,EAAQ2K,EAAWo+E,GACrIhqF,EAAOuqF,gBAAkB,WACvB,IAAKvpF,EAAa6C,IAAI,6BAEpB,WADA5C,GAAOb,MAAM,kDAIf,IAAImW,GAAQ,CACZvW,GAAOwqF,WAAY,CAEnB,IAAIC,GAAmB,WACrB,GAAIhjF,GAAOzH,EAAO0qF,SAASC,MAAMp0E,EAEjC,IAAI9O,GAAQA,EAAKmjF,OAASnjF,EAAKmjF,KAAK5hD,KAGlC,MAFAvhC,GAAKojF,SAAU,OACfpjF,EAAKqjF,SAAW,yBAIlB,IAAIxuD,GAAO,WACT/lB,IAEAk0E,IAGF,OAAKhjF,IAASzH,EAAOwqF,UAKjB/iF,EAAKsjF,UACAzuD,QACTx5B,GAAQwX,UAAUta,EAAO2Y,KAAK0D,KAAKlV,GAAIM,EAAKmjF,KAAKtpF,KAAM,SAAUiZ,GAC/D,GAAIA,EAGF,MAFApa,SAAQiI,IAAI,cACZX,EAAKujF,aAAc,EACZ1uD,GAGT70B,GAAKE,IAAM,0BAA4B3H,EAAO0H,QAAQ+Q,WAAa,SAAWzY,EAAO2Y,KAAK0D,KAAKlV,GAAK,eAAiBnH,EAAO2Y,KAAK7P,OAAOxH,KAAO,aAAetB,EAAO2Y,KAAK63B,SAAS1nC,OACnLrB,EAAKwjF,SACLxjF,EAAKyjF,UAAY5uD,EACjB70B,EAAKo4C,QAAUvjB,SAhBft8B,EAAOwqF,WAAY,GAoBvBC,MAGFzqF,EAAOmrF,kBAAmB,EAE1BnrF,EAAOorF,sBAAwB,WACzBprF,EAAOmrF,mBACXnrF,EAAOmrF,kBAAmB,EAC1BnB,EAAiB9nE,mBACf7F,KAAMrc,EAAO2Y,KAAK0D,KAAKlV,KACtB5C,KAAK,SAAUk8C,GAChB,KAAM4qC,GAAiBrrF,EAAOsrF,mBAE9B,KAAKD,EAAe1nF,OAGlB,MAFA3D,GAAO6tD,mBACP7tD,EAAOmrF,kBAAmB,EAI5B,MAAMI,GAAYF,EAAeplF,IAAI,SAAUulF,GAC7C,MAAOA,GAAQZ,KAAKtpF,MAGtB,IAAIm/C,GAASA,EAAM98C,OAAQ,CACzB,KAAM8nF,GAAehrC,EAAM9/C,OAAO,SAAUiqF,GAC1C,MAAOW,GAAU3nF,SAASgnF,EAAKtpF,QAE3B8gB,EAAQqpE,EAAaxiF,MAAM,EAAG,GAAGhD,IAAI,SAAUwB,GACnD,OACEikF,UAAWjkF,EAAKikF,UAChBC,SAAUlkF,EAAKN,GACfmK,SAAU7J,EAAKnG,OAGnB0oF,GAAiB7nE,aACfC,MAAOA,IACN7d,KAAK,SAAUtB,GACZA,IACFA,EAAK+D,QAAQ,SAAUS,GACrB,KAAMmkF,GAAWP,EAAe14D,KAAK,SAAU64D,GAC7C,MAAOA,GAAQZ,KAAKtpF,OAASmG,EAAK6J,UAGhCs6E,IAA4B,aAAhBnkF,EAAKiD,QACnB1K,EAAO6rF,gBAAgBD,KAG3B5rF,EAAOmrF,kBAAmB,UAOpCnrF,EAAOsrF,kBAAoB,WACzB,KAAMD,GAAiBrrF,EAAO0qF,SAASC,MAAMhqF,OAAO,SAAUiqF,GAC5D,OAA0B,IAAnBA,EAAKG,YAA0C,IAApBH,EAAKkB,YAEzC,OAAOT,IAAkBA,EAAe1nF,OAAS0nF,MAGnDrrF,EAAO+rF,oBAAsB,WACvB/rF,EAAOsrF,oBAAoB3nF,QAC7B3D,EAAO4tD,cAIX5tD,EAAO4tD,WAAa,WAClB5tD,EAAO6tD,cACP7tD,EAAOgsF,oBAAsBpgF,EAAU,WACrC5L,EAAOorF,yBACN,MAGLprF,EAAO6tD,YAAc,WACf7tD,EAAOgsF,qBACTpgF,EAAUK,OAAOjM,EAAOgsF,sBAI5BhsF,EAAOmB,IAAI,WAAY,WACrBnB,EAAO6tD,gBAETy8B,EAAmBjqE,OAAO,6BAA6B9b,KAAK,SAAU0nF,GACpE3rF,KAAK2rF,mBAAqBA,GAC1B9lF,KAAK7F,OAEPN,EAAOksF,UAAY,WACjBlsF,EAAOwqF,WAAY,EACnB3qF,QAAQmH,QAAQhH,EAAO0qF,SAASC,MAAO,SAAUljF,GAC/CA,EAAKwE,YAITjM,EAAO0qF,SAAWL,EAAQ8B,cAC1BnsF,EAAO2Y,QACP3Y,EAAO2rC,UACLrqC,KAAM,UACNwH,OAAQ,yBAERxH,KAAM,YACNwH,OAAQ,uBAERxH,KAAM,mBACNwH,OAAQ,4BAERxH,KAAM,UACNwH,OAAQ,yBAERxH,KAAM,aACNwH,OAAQ,wBAERxH,KAAM,WACNwH,OAAQ,sBAEV9I,EAAOosF,eACL9qF,KAAM,MACNwH,OAAQ,QAERxH,KAAM,gBACNwH,OAAQ,UAEVhG,EAAQ+V,UACNwzE,SAAS,GACR,SAAU/vE,GACXtc,EAAOsc,MAAQA,EAAMuZ,KAAK,SAAU3gB,EAAG6a,GACrC,MAAO,IAAIxnB,MAAKwnB,EAAEk0B,YAAc,GAAI17C,MAAK2M,EAAE+uC,gBAI/CjkD,EAAOssF,WAAa,WAClB,KAAMC,GAAQvsF,EAAO2Y,MAAQ3Y,EAAO2Y,KAAK0D,MAAQrc,EAAO2Y,KAAK0D,KAAKmwE,UAAYxsF,EAAO2Y,KAAK0D,KAAKmwE,UAAY,WAAa,eACxHxsF,GAAOosF,aAAa,GAAG9qF,KAAOirF,EAC9BvsF,EAAO2Y,KAAK63B,SAAWxwC,EAAOosF,aAAa;mCAG7CpsF,EAAOysF,sBAAwB,WAC7B,OAAQzsF,EAAO0qF,SAASC,MAAMhnF,QAAU3D,EAAO0sF,oBAAsB1sF,EAAO2Y,KAAK0D,OAASrc,EAAO2Y,KAAK7P,QAAU9I,EAAOwqF,WAGzHxqF,EAAO0sF,gBAAkB,WACvB,MAAO1sF,GAAO0qF,SAASC,MAAMhnF,OAAS,IAGxC,MAAMgpF,GAAezrF,KAAK6gC,MAAsB,IAAhB7gC,KAAK0rF,SACrCtsF,MAAKusF,cACHC,IAAK,yCAA2CH,EAChDI,QAAS,yCAA2CJ,GAEtD7pF,EAAQE,QAAQ,SAAU2V,GACxB3Y,EAAO0H,QAAUiR,IAEnB3Y,EAAO0qF,SAASrxE,QAAQ0E,MACtBzc,KAAM,mBACNua,GAAI,SAAUpU,GACZ,GAAInG,GAAOmG,EAAKnG,KAAK0H,MAAM,IAG3B,SADmB,qBACD6F,KAFFvN,EAAKA,EAAKqC,OAAS,GAAGmuB,kBAM1C9xB,EAAO0qF,SAASrxE,QAAQ0E,MACtBzc,KAAM,eACNua,GAAI,SAAUpU,GAIZ,OAHgBzH,EAAO0qF,SAASC,MAAMhqF,OAAO,SAAUqsF,GACrD,MAAOA,GAAMpC,KAAKtpF,OAASmG,EAAKnG,OAEhBqC,UAItB3D,EAAO0qF,SAASuC,YAAc,SAAUxlF,EAAM+C,EAAUE,EAAQmuC,GAC9D,GAAIruC,EAASpK,MACXqH,EAAKqjF,SAAWtgF,EAASpK,UACpB,CAAA,GAAIsK,GAAU,IAEnB,YADAjD,EAAKqjF,SAAW,eAGhBrjF,GAAKqjF,SAAW,qBAIpB9qF,EAAO0qF,SAASwC,cAAgB,SAAUzlF,EAAM+C,EAAUE,EAAQmuC,GAChEpxC,EAAKqkF,YAAa,EAClB3rF,QAAQwY,KAAK,2BAA4B3Y,EAAOsrF,oBAAoB3nF,QACpE3D,EAAO+rF,uBAGT/rF,EAAO6rF,gBAAkB,SAAUpkF,GACjCA,EAAKiD,OAAS,WACdjD,EAAKy5D,aAAc,EACnBz5D,EAAKsjF,WAAY,EACjBtjF,EAAKqkF,YAAa,EAClBrkF,EAAKktD,SAAW,KAGlB30D,EAAOmtF,YAAc,SAAU1lF,GAC7B,MAAIA,GAAKy5D,aAAiC,MAAlBz5D,EAAKktD,SAAyB,GAAYltD,EAAKsjF,YAActjF,EAAKqkF,WAAmB,GAAerkF,EAAKktD,UAGnI30D,EAAOotF,gBAAkB,WAClBptF,EAAO0qF,SAASC,MAAMhnF,SAC3B3D,EAAO0qF,SAASC,MAAQ3qF,EAAO0qF,SAASC,MAAMhqF,OAAO,SAAUiqF,GAC7D,OAAQA,EAAKG,cAIjB/qF,EAAOqtF,mBAAqB,WAC1B,MAAKrtF,GAAO0qF,UAAa1qF,EAAO0qF,SAASC,OAAU3qF,EAAO0qF,SAASC,MAAMhnF,QACzE3D,EAAOstF,SAAWttF,EAAO0qF,SAASC,MAAMhqF,OAAO,SAAUiqF,GACvD,QAASA,EAAKkB,aAAelB,EAAKC,UACjClnF,OACI3D,EAAOstF,UAJ0E,GAO1FttF,EAAOutF,WAAa,WAClBvtF,EAAO0qF,SAAS/1B,SAAW,EAC3B30D,EAAOstF,SAAW,GAGpBttF,EAAOstF,SAAW,EAElBttF,EAAO0qF,SAAS8C,cAAgB,gBAC/Bt/E,QAAQ,WAAA,eAAW,SAAUu/E,GAC9B,GAAI/qB,GAAI,GAAI+qB,EASZ,OARAj7C,QAAOvK,iBAAiB,eAAgB,SAAU/nC,GAChD,GAAIwiE,EAAExB,YAAa,CAIjB,OAFChhE,GAAKsyC,OAAOt6B,OAAOw1E,YADM,+CAAA,mDAO5BvB,YAAa,WACX,MAAOzpB,QC7Sb7iE,QAAQC,OAAO,iCAAkC,cAAe,gBAAiB,eAAgB,iCAAkC,oBAAqB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAClMo1C,EAAeC,MAAM,8BACnB9vC,IAAK,YACL5H,WAAY,8CACZ+K,YAAa,kDAEd/K,WAAW,iCAAA,SAAA,4BAAA,eAAA,SAAA,QAAiC,SAAUC,EAAQ2tF,EAA2BnkB,EAAcvpE,EAAQ2tF,GAChHttF,KAAKgW,SAAW,WACdhW,KAAK6M,SAAU,EACfwgF,EAA0Bl7E,aAAalO,KAAK,SAAUtB,GACpD3C,KAAK6M,SAAU,CACf,IAAI0gF,IAAQ,YAAa,YAAa,gBAAiB,UAAW,aAClEvtF,MAAKm9B,MAAQx6B,EAAKw6B,MAAMx3B,IAAI,SAAUwB,EAAM8O,GAI1C,MAHAs3E,GAAK7mF,QAAQ,SAAU8mF,GACrBrmF,EAAK,SAAWqmF,GAAQ7qF,EAAK8qF,WAAWx3E,GAAOu3E,KAE1CrmF,IAETnH,KAAK0tF,QAAU/qF,EAAKw6B,MAAM7f,OAAO,SAAUC,EAAGpW,GAK5C,MAJAomF,GAAK7mF,QAAQ,SAAU8mF,GACrBjwE,EAAEiwE,IAASrmF,EAAKqmF,GAChBjwE,EAAE,SAAWiwE,IAASrmF,EAAK,SAAWqmF,KAEjCjwE,GACNgwE,EAAKjwE,OAAO,SAAUqwE,EAAIH,GAG3B,MAFAG,GAAGH,GAAQ,EACXG,EAAG,SAAWH,GAAQ,EACfG,SAET9nF,KAAK7F,QAGTA,KAAKgW,cChCPzW,QAAQC,OAAO,+BAAgC,eAAgB,yBAA0B,2BAA4B,kCAAmC,6BAA8B,cAAe,iBAAkB,SAAU,cAAcqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC9Qo1C,EAAeC,MAAM,4BACnB9vC,IAAK,8BACL5H,WAAY,6BACZ+K,YAAa,+CAEd/K,WAAW,8BAAA,SAAA,UAAA,UAAA,gBAAA,cAAA,SAAA,KAAA,4BAAA,kCAAA,oBAAA,eAAA,SAAA,eAA8B,SAAUC,EAAQmqB,EAASrnB,EAASwmE,EAAevY,EAAa9vD,EAAQ8D,EAAI4oF,EAA2BO,EAAiC9+B,EAAmBpuD,EAAcf,EAAQupE,GAC3NxpE,EAAO2qE,0BAA4BnB,EAAa53D,iBAEhD,IAAI83D,GAAY,SAAUziE,EAAGwmD,EAAG93C,EAAGi8C,EAAGv7C,GACpC,GAAIsf,MACAg0C,EAAU,MAEF,MAARh0D,EAAE,KACJg0D,EAAU,OAGZh0C,EAAOhgB,EAAEsuB,UAAU,IAAM0lC,CACzB,IAAIC,IACFtmE,KAAM2D,EACNa,MAAO2lD,EACPoc,QAASl0C,EACTh1B,OAAQixD,EAEV5xD,GAAO8pE,YAAc,GAAIR,GAAcM,GACrCn6C,MAAOpZ,EACPjS,QAAS,SAAU2lE,EAAQ1oE,GACzBrB,EAAOgqE,aAAe,EACtB,IAAIC,GAAe5oE,EAAOV,SAAWwpB,EAAQ,UAAUnqB,EAAOk6E,yBAA0B74E,EAAOV,UAAYX,EAAOk6E,yBAC9G/P,EAAc9oE,EAAOwoE,UAAY1/C,EAAQ,WAAW8/C,EAAc5oE,EAAO+oE,WAAapqE,EAAOk6E,wBACjG74E,GAAOouB,MAAM06C,EAAYxmE,QACzBomE,EAAO3kE,QAAQ+kE,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,UAE1FqiE,EAAYxmE,OAAS,IACvB3D,EAAOgqE,aAAe,wCAGxBhqE,EAAOm6E,qBAAuBhQ,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,YAKnH9H,GAAO6tE,yBAA2B,SAAU1sD,GAC1C,GAAIysD,IAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,IAC3E,OAAOoR,GAAW,YAAcA,EAAS04D,mBAAqB,mBAAqB14D,EAASzJ,UAAY,MAAQk2D,EAAM,IACrH5tE,EAAO0qE,WAAa,SAAUoP,GAC/B75E,EAAOiC,GAAG,4BACR0P,kBAAmBkoE,OAAwC93E,MAI/DhC,EAAO+5E,qBAAuB,WAI5B,MAHA/5E,GAAOmN,SAAU,EACjBnN,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EACXkhC,EAAgCx8E,sBAAsBnN,KAAK,SAAUtB,GAC1EjD,EAAOk6E,yBAA2Bj3E,EAClCjD,EAAOm6E,qBAAuBl3E,EAC9BjD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GAElB/mE,EAAKU,OAAS,EACX3D,EAAO8pE,YAGV9pE,EAAO8pE,YAAYxD,SAFnBoD,EAAU,EAAG,GAAI,YAAczmE,EAAKU,QAKtC3D,EAAOgqE,aAAe,iCAKvBhqE,EAAO2qE,2BACV3qE,EAAO+5E,0BAERryD,UAAU,kCAAmC,WAC9C,OACEC,SAAU,IACVze,SAAS,EACT0e,OACEhW,kBAAmB,IACnBu5D,SAAU,KAEZprE,WAAY,oCACZqL,aAAc,aACdN,YAAa,gDAEdnK,OAAO,eAAgB,WACxB,MAAO,UAAU4R,EAAYgzD,EAAI4oB,GAC/B,MAAkB,IAAd57E,EACK,UACgB,GAAdA,EACF,cACiB,OAAfA,OAAsCvQ,KAAfuQ,EAC5BgzD,EAAK,GAAK4oB,EAAM,EACX,aAEA,UAJJ,MAQRpuF,WAAW,qCAAA,SAAA,oBAAA,cAAA,kCAAA,eAAA,UAAA,oBAAA,SAAqC,SAAUC,EAAQovD,EAAmBF,EAAag/B,EAAiCltF,EAAc8B,EAASsoE,EAAmBnqE,GAC9KiR,OAAOzJ,OAAOnI,MACZ6G,GAAI,KACJ8sB,WAAY,SAAUriB,GACpBtR,KAAK6G,GAAKyK,EACVtR,KAAKyR,OAAS,EACdzR,KAAKwR,MAAQ,IACbxR,KAAKuyB,UACHs3B,UAAW,EACXr1C,IAAK,KACLxR,KAAM,GAERhD,KAAKmvB,OACHnd,KAAM,EACN83C,MAAO,GAET9pD,KAAK6M,SACHk9C,SAAS,EACT/3C,MAAM,GAERhS,KAAKiS,WAAajS,KAAK+qE,MAAM94D,WAAW,GACxCjS,KAAKirE,eAAiBjrE,KAAK+qE,MAAMC,WAAW,GAAG3iE,MAC/CrI,KAAK8tF,aAAe9tF,KAAK+qE,MAAM/hE,OAAO,GACtChJ,KAAKqqD,WAAa7nD,EAAQU,SAC1BlD,KAAKs6E,eAAer2E,KAAK,WACvBjE,KAAKgW,SAAShW,KAAKuyB,SAASvvB,OAC5B6C,KAAK7F,QAET+tF,oBAAqB,SAAUv5E,GAC7B,GAAIw5E,GAAax5E,EAAIy5E,iBACjBC,EAAgB15E,EAAI25E,oBACpBlpB,EAAKzwD,EAAI45E,eACTP,EAAMr5E,EAAI65E,kBACd,QAAQL,EAAYE,EAAejpB,EAAK,GAAK4oB,EAAM,GAAK,EAAI,MAAMvwE,OAAO,SAAUC,EAAG+wE,GACpF,MAAa,QAAN/wE,EAAa+wE,EAAM/wE,GACzB,OAELwtD,OACEC,aACEjjD,MAAO,iBACP1f,MAAO,KAEP0f,MAAO,WACP1f,MAAO,aAETW,SACEX,MAAO,MACPiY,KAAM,MACNlc,YAAa,2BAEbiE,MAAO,YACPiY,KAAM,YACNlc,YAAa,+CAEbiE,MAAO,UACPiY,KAAM,UACNlc,YAAa,0DAEbiE,MAAO,aACPiY,KAAM,aACNlc,YAAa,8CAEbiE,MAAO,SACPiY,KAAM,SACNlc,YAAa,wDAEf4xD,YACE3tD,MAAO,MACPiY,KAAM,QAENjY,MAAO,OACPiY,KAAM,SAENjY,MAAO,gBACPiY,KAAM,kBAERrO,aACE8V,MAAO,WACPzH,KAAM,UACNjY,MAAO,IAEP0f,MAAO,WACPzH,KAAM,cACNjY,MAAO,IAEP0f,MAAO,cACPzH,KAAM,QACNjY,MAAO,QAGXiyE,aAAc,WAEZ,MADAt6E,MAAK6M,QAAQk9C,SAAU,EAChB6jC,EAAgCv8E,6BAA6BrR,KAAK6G,IAAI5C,KAAK,SAAUiO,GAC1FlS,KAAK6M,QAAQk9C,SAAU,EACvB/pD,KAAKkS,gBAAkBA,EACvBlS,KAAKwrD,iBACLxrD,KAAKmvB,OACHnd,KAAME,EAAgBwkB,QACtBozB,MAAOlpD,KAAKgoB,KAAK1W,EAAgBwkB,QAAU12B,KAAKwR,SAElD3L,KAAK7F,OAAOmK,MAAM,SAAUuD,GAE5B,MADA1N,MAAK6M,QAAQk9C,SAAU,EAChBppD,EAAOgN,YAAYD,IAC1B7H,KAAK7F,QAETuuF,sBAAuB,WACrBvuF,KAAKuyB,SAASvvB,KAAO,EACrBhD,KAAKgW,SAAS,IAEhBw1C,eAAgB,WACdxrD,KAAK+6E,yBAA2B6S,EAAgC/8E,gBAC9DqB,gBAAiBlS,KAAKkS,gBAAgBrL,MAG1Cm8C,SAAU,SAAUx2C,EAAQksB,GAC1B14B,KAAKi4B,cAAgBS,EAAYT,aACjC,IAAIgrB,GAAYvqB,EAAYT,cAAcirB,QACtCyrB,EAAYj2C,EAAYJ,QAAQs2C,OAAOn9D,SAASmoB,GACpD55B,MAAK2uE,UAAwB,EAAZA,EACjB3uE,KAAKmjD,mBAAqBF,GAAa0rB,GAEzCn8C,SAAU,SAAUgzB,GAClBxlD,KAAKgtB,OAAOw4B,EAAMn9C,QAEpB2N,SAAU,SAAUomE,GAElB,MADAp8E,MAAK6M,QAAQmF,MAAO,EACb47E,EAAgCr8E,0BAA0BvR,KAAK6G,GAAI7G,KAAKwR,MAAO4qE,EAAap8E,KAAKwR,OACtGxI,OAAQhJ,KAAK8tF,cAAgB9tF,KAAK8tF,aAAazlF,QAC9CpE,KAAK,SAAU+N,GA6BhB,MA5BAhS,MAAK6M,QAAQmF,MAAO,EACpBhS,KAAKgS,KAAOA,EAAKsL,OAAO,SAAUC,EAAG/I,GACnC,GAAI8nE,GAAW9nE,EAAIuH,IACLvH,GAAI4C,SAclB,OAZKmG,GAAEsyB,IAAIysC,KACT/+D,EAAEsyB,IAAIysC,IACJrsE,QACA4/B,OACA7uC,KAAMs7E,GAGR/+D,EAAEtN,KAAKwN,KAAKF,EAAEsyB,IAAIysC,KAGT/+D,EAAEsyB,IAAIysC,GACZrsE,KAAKwN,KAAKjJ,GACR+I,IAEPtN,QACA4/B,SACC5/B,KACHjQ,KAAKuyB,SAAS/d,IAAM5T,KAAKy8B,MAErBr9B,KAAKi4B,eACPj4B,KAAKi4B,cAAc2qB,SAAS,EAAG,GAG1B5wC,GACPnM,KAAK7F,OAAOmK,MAAM,SAAUuD,GAE5B,MADA1N,MAAK6M,QAAQmF,MAAO,EACbrR,EAAOgN,YAAYD,IAC1B7H,KAAK7F,QAETwtE,aAAc,SAAUh5D,EAAKhI,GACvBA,IACFA,EAAO7K,iBACP6K,EAAOgtB,mBAGTsxC,EAAkBhtB,QAAQgR,EAAkBt7C,eAAegB,IAAM,IAEnEioE,kBAAmB,WACjB3R,EAAkBhtB,QAAQ8Q,EAAYp7C,eAAexT,KAAKkS,gBAAgB2O,WAAW,IAEvFwsD,oBAAqB,SAAU74D,GAC7B,GAAI84D,IAAO,MAAO94D,EAAIijD,GAAIjjD,EAAIkjD,GAAIljD,EAAImjD,GAAInjD,EAAIojD,IAAInoD,KAAK,IACvD,OAAO+E,GAAM,YAAcxU,KAAKqqD,WAAa,mBAAqB71C,EAAI63D,aAAe,MAAQiB,EAAM,IAErGC,yBAA0B,SAAU1sD,GAClC,GAAIysD,IAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,IAC3E,OAAOoR,GAAW,YAAcA,EAAS04D,mBAAqB,mBAAqB14D,EAASzJ,UAAY,MAAQk2D,EAAM,IAExHoP,OAAQ,SAAU7yB,GAShB,MARI7pD,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASs3B,UAAY,EAC1B7pD,KAAKuyB,SAAS/d,IAAM,OAEpBxU,KAAKuyB,SAASs3B,UAAYjpD,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAgB,EAAZwsB,EAAe7pD,KAAKmvB,MAAMnd,KAAO,IAChFhS,KAAKuyB,SAAS/d,IAAMxU,KAAKgS,KAAKhS,KAAKuyB,SAASs3B,YAGvC7pD,KAAKuyB,SAAS/d,KAEvB+1C,QAAS,SAAUvnD,EAAMyqE,GACvB,MAAIztE,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASvvB,KAAO,EACrBhD,KAAKgS,QACEhS,KAAKgS,OAEZhP,EAAOpC,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAIr6B,EAAMhD,KAAKmvB,MAAMnd,KAAOhS,KAAKwR,MAAQ,MAErDxR,KAAKuyB,SAASvvB,MAAQyqE,GAChCztE,KAAKuyB,SAASvvB,KAAOA,EACdhD,KAAKgW,SAAShT,QAFvB,IAMJgqB,OAAQ,SAAUlb,GAChB,GAAIy5D,GAAW,IAGbA,GADa,QAAXz5D,EACS,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,SAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,kBAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,SAAgC,OAArB/d,EAAIg6E,cAGV,SAAUh6E,GACnBA,EAAI+d,SAAW/d,EAAI3N,KAAOiL,GAI9B9R,KAAK28E,WAAWpR,IAElBoR,WAAY,SAAUphE,IACnBvb,KAAKgS,UAAYtL,QAAQ,SAAUqV,GAClCA,EAAK9L,KAAKvJ,QAAQ6U,MAGtBlL,SAAU,SAAU4B,EAAYD,GAC9B,IAAKtR,EAAa6C,IAAI,8BAEpB,WADA5C,GAAOb,MAAM,gEAII4B,KAAfuQ,IACFA,GAAcjS,KAAKiS,aACjB5J,MAAO,OACNA,WAGQ3G,KAATsQ,IACFA,KACAhS,KAAK28E,WAAW,SAAUnoE,GACpBA,EAAI+d,UACNvgB,EAAKyL,KAAKjJ,KAKhB,IAAIk6D,GAAS18D,EAAKrM,IAAI,SAAU6O,GAC9B,MAAOA,GAAI3N,KAET+1E,GACF6R,oBAAqB,EACrBC,kBAAmB,EACnB3R,KAAM,EACNF,EAAG,EACHC,EAAG,EAEL,OAAO8Q,GAAgC77E,4BAA4B/R,KAAK6G,GAAI6nE,EAAQz8D,GAAYhO,KAAK,WACnG+N,EAAKtL,QAAQ,SAAU8N,GACrB,GAAIm6E,GAAQC,CAERp6E,GAAI45E,eAAiB,GAAK55E,EAAI65E,mBAAqB,IACrDM,EAAkC,OAAzBn6E,EAAIy5E,iBAA4B,oBAAsB,sBAC/DW,EAAwB,OAAf38E,EAAsB,oBAAsB,uBAGvD2qE,EAAU+R,IAAW,EACrB/R,EAAUgS,IAAW,EACrBhS,EAAUpoE,EAAIy5E,mBAAqB,EACnCrR,EAAU3qE,IAAe,EACzBuC,EAAIy5E,iBAAmBh8E,EACvBuC,EAAI+d,UAAW,IAEjBvyB,KAAKkS,gBAAgB28E,sBAAwBjS,EAAU8R,kBACvD1uF,KAAKkS,gBAAgB48E,wBAA0BlS,EAAU6R,oBACzDzuF,KAAKkS,gBAAgB68E,yBAA2BnS,EAAU,GAC1D58E,KAAKkS,gBAAgB88E,0BAA4BpS,EAAU,GAC3D58E,KAAKgW,SAAShW,KAAKuyB,SAASvvB,OAC5B6C,KAAK7F,QAETivF,UAAW,SAAUzsE,GACnB,MAAOxiB,MAAK08E,OAAO18E,KAAKuyB,SAASs3B,WAAarnC,GAAQ,KAExD0sE,UAAW,SAAU1sE,GACnB,MAAOxiB,MAAK08E,OAAO18E,KAAKuyB,SAASs3B,WAAarnC,GAAQ,KAExDmoC,SAAU,SAAUnoC,GAClB,MAAOxiB,MAAKuqD,QAAQvqD,KAAKuyB,SAASvvB,MAAQwf,GAAQ,KAEpDooC,SAAU,SAAUpoC,GAClB,MAAOxiB,MAAKuqD,QAAQvqD,KAAKuyB,SAASvvB,MAAQwf,GAAQ,KAEpDwZ,KAAM,SAAUxZ,GACTA,IACHA,EAAO,GAGTxiB,KAAK2qD,SAASnoC,IAEhBuZ,KAAM,SAAUvZ,GAKd,MAJKA,KACHA,EAAO,GAGFxiB,KAAKg8B,MAAMxZ,MAGtBxiB,KAAK2zB,WAAWj0B,EAAO4R,sBCpazB/R,QAAQC,OAAO,wCAAyC,eAAgB,yBAA0B,2BAA4B,6BAA8B,cAAe,iBAAkB,SAAU,cAAcqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACpPo1C,EAAeC,MAAM,qCACnB9vC,IAAK,mBACL5H,WAAY,sCACZ+K,YAAa,qDAEf0sC,EAAeC,MAAM,6CACnB9vC,IAAK,uCACL5H,WAAY,sCACZ+K,YAAa,wDAEd/K,WAAW,uCAAA,SAAA,UAAA,UAAA,gBAAA,cAAA,SAAA,KAAA,4BAAA,oBAAA,eAAA,SAAA,eAAuC,SAAUC,EAAQmqB,EAASrnB,EAASwmE,EAAevY,EAAa9vD,EAAQ8D,EAAI4oF,EAA2Bv+B,EAAmBpuD,EAAcf,EAAQupE,GACnMxpE,EAAO2qE,0BAA4BnB,EAAa53D,iBAEhD,IAAI83D,GAAY,SAAUziE,EAAGwmD,EAAG93C,EAAGi8C,EAAGv7C,GACpC,GAAIsf,MACAg0C,EAAU,MAEF,MAARh0D,EAAE,KACJg0D,EAAU,OAGZh0C,EAAOhgB,EAAEsuB,UAAU,IAAM0lC,CACzB,IAAIC,IACFtmE,KAAM2D,EACNa,MAAO2lD,EACPoc,QAASl0C,EACTh1B,OAAQixD,EAEV5xD,GAAO8pE,YAAc,GAAIR,GAAcM,GACrCn6C,MAAOpZ,EACPjS,QAAS,SAAU2lE,EAAQ1oE,GACzBrB,EAAOgqE,aAAe,EACtB,IAAIC,GAAe5oE,EAAOV,SAAWwpB,EAAQ,UAAUnqB,EAAOk6E,yBAA0B74E,EAAOV,UAAYX,EAAOk6E,yBAC9G/P,EAAc9oE,EAAOwoE,UAAY1/C,EAAQ,WAAW8/C,EAAc5oE,EAAO+oE,WAAapqE,EAAOk6E,wBACjG74E,GAAOouB,MAAM06C,EAAYxmE,QACzBomE,EAAO3kE,QAAQ+kE,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,UAE1FqiE,EAAYxmE,OAAS,IACvB3D,EAAOgqE,aAAe,wCAGxBhqE,EAAOm6E,qBAAuBhQ,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,YAKnH9H,GAAO6tE,yBAA2B,SAAU1sD,GAC1C,GAAIysD,IAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,IAC3E,OAAOoR,GAAW,YAAcA,EAAS04D,mBAAqB,mBAAqB14D,EAASzJ,UAAY,MAAQk2D,EAAM,IACrH5tE,EAAO0qE,WAAa,SAAUoP,GAC/B95E,EAAO2qE,0BAA4BmP,EAE9BA,EAGH75E,EAAOiC,GAAG,6CACR0P,kBAAmBkoE,IAHrB75E,EAAOiC,GAAG,yCAQdlC,EAAO+5E,qBAAuB,WAI5B,MAHA/5E,GAAOmN,SAAU,EACjBnN,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EACX2gC,EAA0Bj8E,sBAAsBnN,KAAK,SAAUtB,GACpEjD,EAAOk6E,yBAA2Bj3E,EAClCjD,EAAOm6E,qBAAuBl3E,EAC9BjD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GAElB/mE,EAAKU,OAAS,EACX3D,EAAO8pE,YAGV9pE,EAAO8pE,YAAYxD,SAFnBoD,EAAU,EAAG,GAAI,YAAczmE,EAAKU,QAKtC3D,EAAOgqE,aAAe,iCAKvBhqE,EAAO2qE,2BACV3qE,EAAO+5E,0BAERryD,UAAU,2CAA4C,WACvD,OACEC,SAAU,IACVze,SAAS,EACT0e,OACEhW,kBAAmB,IACnBu5D,SAAU,KAEZprE,WAAY,6CACZqL,aAAc,aACdN,YAAa,yDAEd/K,WAAW,8CAAA,SAAA,oBAAA,cAAA,4BAAA,eAAA,UAAA,oBAAA,SAA8C,SAAUC,EAAQovD,EAAmBF,EAAay+B,EAA2B3sF,EAAc8B,EAASsoE,EAAmBnqE,GACjLiR,OAAOzJ,OAAOnI,MACZ6G,GAAI,KACJ8sB,WAAY,SAAUriB,GACpBtR,KAAK6G,GAAKyK,EACVtR,KAAKyR,OAAS,EACdzR,KAAKwR,MAAQ,IACbxR,KAAKuyB,UACHs3B,UAAW,EACXr1C,IAAK,KACLxR,KAAM,GAERhD,KAAKmvB,OACHnd,KAAM,EACN83C,MAAO,GAET9pD,KAAK6M,SACHk9C,SAAS,EACT/3C,MAAM,GAERhS,KAAKiS,WAAajS,KAAK+qE,MAAM94D,WAAW,GACxCjS,KAAKirE,eAAiBjrE,KAAK+qE,MAAMC,WAAW,GAAG3iE,MAC/CrI,KAAKqqD,WAAa7nD,EAAQU,SAC1BlD,KAAKs6E,eAAer2E,KAAK,WACvBjE,KAAKgW,SAAShW,KAAKuyB,SAASvvB,OAC5B6C,KAAK7F,QAET+qE,OACEC,aACEjjD,MAAO,iBACP1f,MAAO,KAEP0f,MAAO,WACP1f,MAAO,aAET2tD,YACE3tD,MAAO,MACPiY,KAAM,QAENjY,MAAO,OACPiY,KAAM,SAGRrO,aACE8V,MAAO,WACPzH,KAAM,UACNjY,MAAO,IAEP0f,MAAO,WACPzH,KAAM,cACNjY,MAAO,IAEP0f,MAAO,cACPzH,KAAM,QACNjY,MAAO,QAGXiyE,aAAc,WAEZ,MADAt6E,MAAK6M,QAAQk9C,SAAU,EAChBsjC,EAA0Bh8E,6BAA6BrR,KAAK6G,IAAI5C,KAAK,SAAUiO,GACpFlS,KAAK6M,QAAQk9C,SAAU,EACvB/pD,KAAKkS,gBAAkBA,EACvBlS,KAAKwrD,iBACLxrD,KAAKmvB,OACHnd,KAAME,EAAgBi9E,SACtBrlC,MAAOlpD,KAAKgoB,KAAK1W,EAAgBi9E,SAAWnvF,KAAKwR,SAEnD3L,KAAK7F,OAAOmK,MAAM,SAAUuD,GAE5B,MADA1N,MAAK6M,QAAQk9C,SAAU,EAChBppD,EAAOgN,YAAYD,IAC1B7H,KAAK7F,QAETwrD,eAAgB,WACdxrD,KAAK+6E,yBAA2BjsB,EAAkBv6C,cAChDrC,gBAAiBlS,KAAKkS,gBAAgBrL,MAG1Cm8C,SAAU,SAAUx2C,EAAQksB,GAC1B14B,KAAKi4B,cAAgBS,EAAYT,aACjC,IAAIgrB,GAAYvqB,EAAYT,cAAcirB,QACtCyrB,EAAYj2C,EAAYJ,QAAQs2C,OAAOn9D,SAASmoB,GACpD55B,MAAK2uE,UAAwB,EAAZA,EACjB3uE,KAAKmjD,mBAAqBF,GAAa0rB,GAEzCn8C,SAAU,SAAUgzB,GAClBxlD,KAAKgtB,OAAOw4B,EAAMn9C,QAEpB2N,SAAU,SAAUomE,GAElB,MADAp8E,MAAK6M,QAAQmF,MAAO,EACbq7E,EAA0B97E,0BAA0BvR,KAAK6G,GAAI7G,KAAKwR,MAAO4qE,EAAap8E,KAAKwR,OAAOvN,KAAK,SAAU+N,GA6BtH,MA5BAhS,MAAK6M,QAAQmF,MAAO,EACpBhS,KAAKgS,KAAOA,EAAKsL,OAAO,SAAUC,EAAG/I,GACnC,GAAI8nE,GAAW9nE,EAAIuH,IACLvH,GAAI4C,SAclB,OAZKmG,GAAEsyB,IAAIysC,KACT/+D,EAAEsyB,IAAIysC,IACJrsE,QACA4/B,OACA7uC,KAAMs7E,GAGR/+D,EAAEtN,KAAKwN,KAAKF,EAAEsyB,IAAIysC,KAGT/+D,EAAEsyB,IAAIysC,GACZrsE,KAAKwN,KAAKjJ,GACR+I,IAEPtN,QACA4/B,SACC5/B,KACHjQ,KAAKuyB,SAAS/d,IAAM5T,KAAKy8B,MAErBr9B,KAAKi4B,eACPj4B,KAAKi4B,cAAc2qB,SAAS,EAAG,GAG1B5wC,GACPnM,KAAK7F,OAAOmK,MAAM,SAAUuD,GAE5B,MADA1N,MAAK6M,QAAQmF,MAAO,EACbrR,EAAOgN,YAAYD,IAC1B7H,KAAK7F,QAETwtE,aAAc,SAAUh5D,EAAKhI,GACvBA,IACFA,EAAO7K,iBACP6K,EAAOgtB,mBAGTsxC,EAAkBhtB,QAAQgR,EAAkBt7C,eAAegB,IAAM,IAEnEioE,kBAAmB,WACjB3R,EAAkBhtB,QAAQ8Q,EAAYp7C,eAAexT,KAAKkS,gBAAgB2O,WAAW,IAEvFwsD,oBAAqB,SAAU74D,GAC7B,GAAI84D,IAAO,MAAO94D,EAAIijD,GAAIjjD,EAAIkjD,GAAIljD,EAAImjD,GAAInjD,EAAIojD,IAAInoD,KAAK,IACvD,OAAO+E,GAAM,YAAcxU,KAAKqqD,WAAa,mBAAqB71C,EAAI63D,aAAe,MAAQiB,EAAM,IAErGC,yBAA0B,SAAU1sD,GAClC,GAAIysD,IAAO,MAAOzsD,EAAS42C,GAAI52C,EAAS62C,GAAI72C,EAAS82C,GAAI92C,EAAS+2C,IAAInoD,KAAK,IAC3E,OAAOoR,GAAW,YAAcA,EAAS04D,mBAAqB,mBAAqB14D,EAASzJ,UAAY,MAAQk2D,EAAM,IAExHoP,OAAQ,SAAU7yB,GAShB,MARI7pD,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASs3B,UAAY,EAC1B7pD,KAAKuyB,SAAS/d,IAAM,OAEpBxU,KAAKuyB,SAASs3B,UAAYjpD,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAgB,EAAZwsB,EAAe7pD,KAAKmvB,MAAMnd,KAAO,IAChFhS,KAAKuyB,SAAS/d,IAAMxU,KAAKgS,KAAKhS,KAAKuyB,SAASs3B,YAGvC7pD,KAAKuyB,SAAS/d,KAEvB+1C,QAAS,SAAUvnD,EAAMyqE,GACvB,MAAIztE,MAAKmvB,MAAMnd,MAAQ,GACrBhS,KAAKuyB,SAASvvB,KAAO,EACrBhD,KAAKgS,QACEhS,KAAKgS,OAEZhP,EAAOpC,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAIr6B,EAAMhD,KAAKmvB,MAAMnd,KAAOhS,KAAKwR,MAAQ,MAErDxR,KAAKuyB,SAASvvB,MAAQyqE,GAChCztE,KAAKuyB,SAASvvB,KAAOA,EACdhD,KAAKgW,SAAShT,QAFvB,IAMJgqB,OAAQ,SAAUlb,GAChB,GAAIy5D,GAAW,IAGbA,GADa,QAAXz5D,EACS,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,SAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,UAAW,GAEG,kBAAXzgB,EACE,SAAU0C,GACnBA,EAAI+d,SAAgC,OAArB/d,EAAIg6E,cAGV,SAAUh6E,GACnBA,EAAI+d,SAAW/d,EAAI3N,KAAOiL,GAI9B9R,KAAK28E,WAAWpR,IAElBoR,WAAY,SAAUphE,IACnBvb,KAAKgS,UAAYtL,QAAQ,SAAUqV,GAClCA,EAAK9L,KAAKvJ,QAAQ6U,MAGtBlL,SAAU,SAAU4B,EAAYD,GAC9B,IAAKtR,EAAa6C,IAAI,mCAEpB,WADA5C,GAAOb,MAAM,gEAII4B,KAAfuQ,IACFA,GAAcjS,KAAKiS,aACjB5J,MAAO,OACNA,WAGQ3G,KAATsQ,IACFA,KACAhS,KAAK28E,WAAW,SAAUnoE,GACpBA,EAAI+d,UACNvgB,EAAKyL,KAAKjJ,KAKhB,IAAIk6D,GAAS18D,EAAKrM,IAAI,SAAU6O,GAC9B,MAAOA,GAAI3N,KAET+1E,GACFC,EAAG,EACHC,EAAG,EACHC,KAAM,EAUR,OARA/qE,GAAKtL,QAAQ,SAAU8N,GACrBooE,EAAUpoE,EAAIg6E,eAAiB,EAC/B5R,EAAU3qE,IAAe,EACzBuC,EAAIg6E,aAAev8E,EACnBuC,EAAI+d,UAAW,IAEjBvyB,KAAKkS,gBAAgBk9E,WAAaxS,EAAU,GAC5C58E,KAAKkS,gBAAgBm9E,YAAczS,EAAU,GACtCyQ,EAA0Bt7E,4BAA4B/R,KAAK6G,GAAI6nE,EAAQz8D,IAEhFg9E,UAAW,SAAUzsE,GACnB,MAAOxiB,MAAK08E,OAAO18E,KAAKuyB,SAASs3B,WAAarnC,GAAQ,KAExD0sE,UAAW,SAAU1sE,GACnB,MAAOxiB,MAAK08E,OAAO18E,KAAKuyB,SAASs3B,WAAarnC,GAAQ,KAExDmoC,SAAU,SAAUnoC,GAClB,MAAOxiB,MAAKuqD,QAAQvqD,KAAKuyB,SAASvvB,MAAQwf,GAAQ,KAEpDooC,SAAU,SAAUpoC,GAClB,MAAOxiB,MAAKuqD,QAAQvqD,KAAKuyB,SAASvvB,MAAQwf,GAAQ,KAEpDwZ,KAAM,SAAUxZ,GACTA,IACHA,EAAO,GAGTxiB,KAAK2qD,SAASnoC,IAEhBuZ,KAAM,SAAUvZ,GAKd,MAJKA,KACHA,EAAO,GAGFxiB,KAAKg8B,MAAMxZ,MAGtBxiB,KAAK2zB,WAAWj0B,EAAO4R,sBC3WzB/R,QAAQC,OAAO,wBAAyB,WAAY,oBAAqB,wBAAyB,yBAA0B,qCAW3H4nB,UAAU,sBAAA,UAAA,WAAsB,SAAU3kB,EAAS4I,GAClD,OACEgc,SAAU,IACVC,OACE5jB,SAAU,KACV4rF,YAAa,KAEf9kF,YAAa,oCAEb/K,WAAY,0CACZgoB,KAAM,SAAUH,EAAOzS,EAAS6S,EAAO6nE,GACrCA,EAAQC,mBAAmBvrF,KAAK,WAC9BqjB,EAAMtQ,MAAM,uBAEdu4E,EAAQ9+D,OAAOK,GAAG,mBAAoB,WACpCxJ,EAAM5jB,SAAW1D,KAAK0D,WAExB6rF,EAAQ9+D,OAAOK,GAAG,uBAAwB,SAAU2+D,GAClDnoE,EAAMtQ,MAAM,uBAAwBy4E,KAEtCF,EAAQ9+D,OAAOK,GAAG,gBAAiB,SAAUptB,EAAUma,EAAWvX,GAChEghB,EAAMgoE,aACJ5rF,SAAUA,EACVma,UAAWA,EACXvX,KAAMA,IAER+E,EAAS,WACP,GAAIg0B,GAAKxqB,EAAQwd,KAAK,2BAEtB,IAAIgN,EAAGh8B,OAAQ,CACb,GAAIqsF,GAAKrwD,EAAGuD,SACR+sD,EAAMtwD,EAAG5tB,SACTm+E,EAAMF,EAAGj+E,SACTo+E,EAAMF,EAAI/1D,IAAMg2D,EAAIh2D,GACxB81D,GAAGI,SACDl3D,UAAW82D,EAAG92D,YAAci3D,SAKpCvoE,EAAMyoE,gBAAkBR,EAAQQ,gBAAgBlqF,KAAK0pF,GAErDjoE,EAAMzmB,IAAI,iBAAkB0uF,EAAQS,wBAAwBnqF,KAAK0pF,IACjEjoE,EAAMzmB,IAAI,iBAAkB0uF,EAAQU,oBAAoBpqF,KAAK0pF,IAC7DjoE,EAAMzmB,IAAI,uBAAwB0uF,EAAQW,mBAAmBrqF,KAAK0pF,IAElEjoE,EAAMzmB,IAAI,0BAA2B0uF,EAAQY,sBAAsBtqF,KAAK0pF,IACxEjoE,EAAMzmB,IAAI,uBAAwB0uF,EAAQa,mBAAmBvqF,KAAK0pF,IAClEjoE,EAAMzmB,IAAI,iBAAkB0uF,EAAQc,oBAAoBxqF,KAAK0pF,IAC7DA,EAAQjqC,SAASh+B,EAAM5jB,UAAUyG,MAAMtK,QAAQC,MAAM+F,KAAKhG,eAc/DJ,WAAW,gCAAA,SAAA,SAAA,cAAA,KAAA,sBAAA,eAAA,oBAAA,gBAAA,UAAA,mBAAgC,SAAUC,EAAQC,EAAQ+4B,EAAaj0B,EAAI6rF,EAAqBC,EAAcC,EAAmBlxB,EAAe98D,EAAS0uC,GACnK,GAAIP,GAAO3wC,IAGXA,MAAK23C,MAAQ44C,EAAaE,UAC1BzwF,KAAK0wF,eAAiBF,EAGtBxwF,KAAK6M,SACHmP,OAAO,EACP20E,OAAO,EACPp6D,OAAO,GAGTv2B,KAAK4wF,QAEL5wF,KAAK6wF,OAAS,KAEd7wF,KAAK8wF,KAAO,KAEZ9wF,KAAKywB,OAAS,GAAIygB,EAElB,IAAI6/C,IAAc,EACdC,EAA0BvsF,EAAG2X,OACjCpc,MAAKwvF,mBAAqBwB,EAAwB10E,QAClDtc,KAAKwvF,mBAAmBvrF,KAAK,WACtBjE,KAAKsG,MACRtG,KAAKixF,eAAeV,EAAaW,MAAM7wF,OAAO,SAAUywF,GACtD,MAAOA,GAAKK,UACX58D,UAEL1uB,KAAK7F,OAWPA,KAAKslD,SAAW,SAAU5hD,GACxB,GAAI0tF,GAAQpxF,KAAKoxF,KACjB,QAAQA,GAASA,EAAM9rC,SAAW8rC,EAAM9rC,WAAWrhD,KAAK,WACtD,MAAIvE,GAAO6vF,QAAQ8B,kBAAoB3xF,EAAO6vF,QAAQ1vB,YAC7C7/D,KAAKsxF,UAGVF,EAAMN,KAAa9wF,KAAKsxF,QAAQF,EAAMN,UAA1C,IACAjrF,KAAK7F,OAASyE,EAAGK,WAAWb,KAAK,WAC5B8sF,IACHA,GAAc,EACdC,EAAwBlsF,YAE1Be,KAAK7F,QAGTA,KAAKsxF,QAAU,SAAUR,EAAMptF,GACjBe,EAAG2X,QACAu0B,EAAKmgD,IAGpB,OAFAngD,GAAKmgD,KAAOA,EACRngD,EAAKmgD,OAAMngD,EAAKmgD,KAAKjkF,SAAU,GAC5BpI,EAAGK,UAAUb,KAAK,WACnB6sF,IACFngD,EAAKmgD,KAAKjkF,SAAU,EAEhBikF,EAAKS,kBACPT,EAAKU,gBAAgB9xF,EAAO6vF,QAAQ8B,iBAAmB3xF,EAAO6vF,QAAQ8B,qBAAmB3vF,IAG3FovF,EAAKn9D,aAAa1vB,KAAK,WACjBP,GACFitC,EAAK6vB,aAAa98D,KAEnBO,KAAK,WAQN,GANI6sF,EAAKS,kBAAoBT,EAAK7gF,MAAQ6gF,EAAKzkB,eAC7C17B,EAAKigD,KAAK/yE,UAAYizE,EAAK7gF,KAAKoiB,KAAK,SAAUlrB,GAC7C,MAAOA,GAAKN,KAAO8pC,EAAKigD,KAAK/yE,UAAUhX,MAIvC8pC,EAAKigD,KAAK/yE,UACZ,MAAOizE,GAAKz+D,KAAKse,EAAKigD,KAAK/yE,WAAW5Z,KAAK,SAAU4Z,GACnD,MAAO8yB,GAAK8gD,UAAU5zE,OAGzB5Z,KAAK,WACN,MAAOQ,GAAGK,QAAQgsF,SAM1B9wF,KAAKwgE,aAAe,SAAU98D,GAC5B1D,KAAK0D,SAAWA,EAChB1D,KAAKywB,OAAO2gB,MACVx5B,MAAO,mBACP0D,QAAStb,MACR0D,IAGL1D,KAAKixF,eAAiBX,EAAoB,SAAUhqF,GAClD,GAAIorF,GACAC,EAAYhhD,EAAKygD,KAEjB9qF,IAAQA,EAAK7G,aACV6G,EAAKoyB,cACRpyB,EAAKoyB,YAAcA,EAAYpyB,EAAK7G,YAClCC,OAAQA,EACRkyF,UAAWjhD,KAIf+gD,EAAYprF,EAAKoyB,YAGnB,IAAIm5D,GAASH,IAAcC,CAC3B,QAAQE,EAASptF,EAAGK,UAAUb,KAAK,WACjC,GAAI4tF,GAAUF,GAAaA,EAAUG,WACnC,MAAOH,GAAUG,eAElB7tF,KAAK,WACN,GAAI4tF,GAAUH,GAAaA,EAAUpsC,SAGnC,MAFA3U,GAAKrqC,KAAOA,EACZqqC,EAAKygD,MAAQM,EACN/gD,EAAK2U,aAEX7gD,EAAGK,WAAWb,KAAK,WACtB0sC,EAAKlgB,OAAO2gB,MACVx5B,MAAS,uBACT0D,QAASq1B,GACRrqC,EAAKmpF,kBAIZzvF,KAAKyxF,UAAY,SAAUzhD,GACzBhwC,KAAK6wF,OAAS7gD,CACd,IAAItsC,GAAWssC,GAAYW,EAAKygD,MAAMW,aAAa/hD,EACnDhwC,MAAKgyF,eAAiBtuF,EACtB1D,KAAKywB,OAAO2gB,MACVx5B,MAAO,gBACP0D,QAAStb,MACR0D,EAAUssC,EAAUW,EAAKmgD,KAAOngD,EAAKmgD,KAAKmB,YAAc,OAG7DjyF,KAAK+vF,gBAAkB,SAAUlyE,GAE/B,MADAhe,SAAQiI,IAAI,2BAA4B+V,GACjCA,EAAYpZ,EAAGK,UAAUb,KAAK,WACnC,MAAO0sC,GAAKmgD,MAAQngD,EAAKmgD,KAAKz+D,KAAKxU,KAClC5Z,KAAK,SAAUiuF,GAChB,MAAOA,IAAQr0E,IACd5Z,KAAK,SAAUiuF,GAKhB,MAJAvhD,GAAKigD,MACH/yE,UAAWq0E,GAGTvhD,EAAKygD,MAAMe,YACNxhD,EAAKygD,MAAMe,YAAYt0E,GAEvB8yB,EAAK8gD,UAAU5zE,KAErBpZ,EAAGK,WAGV9E,KAAKgwF,wBAA0B,WAEzBr/C,EAAKkgD,QAAUlgD,EAAKmgD,MACtBngD,EAAKmgD,KAAKsB,SAASzhD,EAAKkgD,OAAOhqF,IAAI5C,KAAKjE,KAAK+vF,gBAAgBlqF,KAAK7F,QAItEA,KAAKiwF,oBAAsB,WACzBpwF,QAAQiI,IAAI,0CAER6oC,EAAKkgD,QAAUlgD,EAAKmgD,MACtBngD,EAAKmgD,KAAK90D,KAAK2U,EAAKkgD,OAAOhqF,IAAI5C,KAAKjE,KAAK+vF,gBAAgBlqF,KAAK7F,QAKlEA,KAAKmwF,sBAAwB,SAAUllE,EAAK7T,EAAWzF,GACrD3R,KAAK6/D,YAAcluD,EACnB3R,KAAKqxF,iBAAmBj6E,GAG1BpX,KAAKowF,mBAAqB,SAAUnlE,EAAKtoB,GACvC3C,KAAKqxF,iBAAmB,MAG1BrxF,KAAKkwF,mBAAqB,SAAUjlE,EAAKvnB,GACvC,GAAIoS,GAAI,qBAAqBvH,KAAK7K,EAElC,IAAI1D,KAAKgyF,gBAAkBtuF,EACzB,MAAOe,GAAGK,SAKZ,IAFA9E,KAAKgyF,eAAiBtuF,EAElBoS,GAAKy6E,EAAaz6E,EAAE,IAAK,CAC3B,GAAIu8E,GAAMv8E,EAAE,GACRw8E,EAAY/B,EAAaz6E,EAAE,GAC/B9V,MAAKixF,eAAeqB,GAAWruF,KAAK,WAClC,MAAOquF,GAAU55D,YAAY65D,iBAAiBF,KAC7CpuF,KAAK,SAAU4Z,GAChB,GAAIA,EACF,MAAO8yB,GAAKo/C,gBAAgBlyE,OAMpC7d,KAAKqwF,oBAAsB,SAAUplE,EAAKpN,GACpC8yB,EAAKmgD,MAAQngD,EAAKmgD,KAAKj6E,QACzB85B,EAAKmgD,KAAKj6E,OAAOgH,OCjSvBte,QAAQC,OAAO,wBAAyBO,SAAS,oBAAqB,WACpE,GAAIyyF,KACJ,QACEnxF,IAAK,SAAUwc,GACb20E,EAAW30E,EAAUvX,MAAQ/G,QAAQyL,OAAOwnF,EAAW30E,EAAUvX,UAAauX,IAEhF3d,KAAM,WACJ,MAAOsyF,OAGVzyF,SAAS,eAAgB,WAC1B,GAAI0yF,IACFhC,aACAS,SAEF,QACE7vF,IAAK,SAAUyvF,GACb2B,EAAMvB,MAAMzzE,KAAKqzE,IAEnB5wF,KAAM,WAeJ,MAdAuyF,GAAMhC,UAAYgC,EAAMvB,MAAM5zE,OAAO,SAAUC,EAAGm1E,GAChD,GAAI3rC,GAAQ2rC,EAAQ3rC,OAAS,EAQ7B,OANKxpC,GAAEuX,OAAOiyB,IACZxpC,EAAEo1E,OAAOl1E,KAAKF,EAAEuX,OAAOiyB,OAGzBxpC,EAAEuX,OAAOiyB,GAAOtpC,KAAKg1E,EAAMC,EAAQ1xF,MAAQ0xF,GAEpCn1E,IAEPo1E,UACA79D,YACC69D,OACIF,MAGVtyF,QAAQ,eAAA,KAAe,SAAUsE,GAClC,GAAIqsF,GAAO,SAAU7gF,EAAMgiF,GACzBjyF,KAAKyR,OAAS,EACdzR,KAAK4yF,SAAS3iF,EAAMgiF,GAqDtB,OAlDAnB,GAAK7iF,WACH0lB,WAAY,WACV,GAAIxX,GAAI1X,EAAG2X,OAEX,OADAD,GAAErX,SAAQ,GACHqX,EAAEG,SAEXs2E,SAAU,SAAU3iF,EAAMgiF,GACxBjyF,KAAKiQ,KAAOA,MACZjQ,KAAKwH,MAAQxH,KAAKiQ,KAAK5M,OACvBrD,KAAKiyF,YAAcA,GAErB5/D,KAAM,SAAUzT,GACd,GAAIzC,GAAI1X,EAAG2X,QACPvV,EAAK+X,GAAcA,EAAW/X,IAAmB,EAAb+X,CAIxC,OAHAzC,GAAErX,QAAQ9E,KAAKiQ,KAAK5P,OAAO,SAAUgX,GACnC,MAAOA,GAAExQ,IAAMA,IACd0tB,SACIpY,EAAEG,SAEX81E,SAAU,SAAUxzE,GAKlB,IAAK,GAJDzC,GAAI1X,EAAG2X,QACPvV,EAAK+X,GAAcA,EAAW/X,IAAmB,EAAb+X,EACpC3I,EAAQ,EAEH25B,EAAI5vC,KAAKiQ,KAAM0S,EAAI,EAAG/iB,EAAIgwC,EAAEvsC,OAAQsf,EAAI/iB,IAAK+iB,EACpD,GAAItN,EAAExO,IAAMA,EAAI,CACdoP,EAAQrV,KAAKy8B,IAAIz8B,KAAK08B,IAAI,EAAG3a,EAAI,EAAG3iB,KAAKiQ,KAAK5M,OAAS,GACvD,OAKJ,MADA8Y,GAAErX,QAAQ9E,KAAKiQ,KAAKgG,IACbkG,EAAEG,SAEX0f,KAAM,SAAU5kB,GAKd,IAAK,GAJD+E,GAAI1X,EAAG2X,QACPvV,EAAK+X,YAAcA,WAAW/X,IAAmB,EAAb+X,WACpC3I,EAAQ,EAEH25B,EAAI5vC,KAAKiQ,KAAM0S,EAAI,EAAG/iB,EAAIgwC,EAAEvsC,OAAQsf,EAAI/iB,IAAK+iB,EACpD,GAAItN,EAAExO,IAAMA,EAAI,CACdoP,EAAQrV,KAAKy8B,IAAIz8B,KAAK08B,IAAI,EAAG3a,EAAI,EAAG3iB,KAAKiQ,KAAK5M,OAAS,GACvD,OAKJ,MADA8Y,GAAErX,QAAQ9E,KAAKiQ,KAAKgG,IACbkG,EAAEG,UAGNw0E,KCvFTvxF,QAAQC,OAAO,2BAA4B4nB,UAAU,qBAAsB,WACzE,OACEC,SAAU,IACVw2C,YAAY,EACZrzD,YAAa,qCACb8c,OACErO,KAAM,IACNw+C,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,KAENn4D,WAAY,4BAEbA,WAAW,0BAAA,SAA0B,SAAUC,GAChDA,EAAOgsC,OAAShsC,EAAO8zB,QAAQkY,OAE/BhsC,EAAOmzF,SAAW,SAAUp7B,EAAIE,GAE9B,MADS/2D,MAAK08B,IAAI,EAAG18B,KAAKy8B,IAAI39B,EAAOgsC,OAAOy3B,MAAMxL,EAAI,GAAKj4D,EAAOgsC,OAAO4qB,YAAY1oC,MAAO,IAChF,GAAK,OAAS,SAG5BluB,EAAOozF,UAAY,SAAUr7B,EAAIE,GAC/B,MAAkC,QAA3Bj4D,EAAOmzF,SAASp7B,EAAIE,GAAgBF,EAAKE,GAGlDj4D,EAAOqzF,aAAe,SAAUt7B,EAAIE,EAAID,EAAIE,GAG1C,MAAO,cAF6B,QAA3Bl4D,EAAOmzF,SAASp7B,EAAIE,GAAgB,QAAU,KAE5B,KADlBj4D,EAAOszF,iBAAiBt7B,EAAKE,GAAM,GAAG,GACR,KAGzCl4D,EAAOszF,gBAAkB,SAAU3jF,EAAG4jF,GACpC,GAAIptB,GAAKjlE,KAAK08B,IAAI,GAAK18B,KAAKy8B,IAAI39B,EAAOgsC,OAAO03B,KAAK/zD,EAAG,GAAK3P,EAAOgsC,OAAO4qB,YAAYxoC,OAAQ,IAM7F,OAJImlE,KACFptB,GAAMA,IAGA,IAAMA,EAAK,GAAK,QC7C5BtmE,QAAQC,OAAO,uCAAwC,gBAAgBqC,QAAA,sBAAO,SAAUqxF,GAUtFA,EAAoBp+B,cAClBxuD,KAAM,uBACNzC,MAAO,GACPpE,WAAY,yDACZorB,SACEvkB,KAAM,YACN0vD,WAAW,GAEbvhC,SAAS,EACT0+D,iBAAiB,OAWpB1zF,WAAW,4CAAA,iBAAA,SAAA,oBAAA,qBAAA,KAAA,YAA4C,SAAUy1D,EAAgBqtB,EAAQ3xC,EAAmBi0B,EAAoBpgE,EAAI0gC,GACnI,QAASiuD,GAAc16E,GACrB,MAAOA,GAAK4E,OAAO,SAAUuyB,EAAK3wB,GAKhC,MAJIA,GAAIrY,KACNgpC,EAAI3wB,EAAIrY,KAAM,GAGTgpC,OAIX,QAASwjD,GAAY36E,GACnB,GAAI46E,KAkBJ,OAjBA56E,GAAK4E,OAAO,SAAUi2E,EAASr0E,GAC7B,GAAIA,EAAIsB,GAAI,CACV,GAAI/B,IAAQS,EAAIqB,GAAIrB,EAAIsB,GAAItB,EAAIuB,GAAIvB,EAAIwB,IACpC8yE,EAAW/0E,EAAKhP,KAAK,IAEpB8jF,GAAQC,IACXF,EAAO71E,KAAK81E,EAAQC,IAClB/0E,KAAMS,EACNxG,UAIJ66E,EAAQC,GAAU96E,KAAK+E,KAAKyB,GAG9B,MAAOq0E,QAEFD,EAGT,GAAIG,GAAkB,GAAI7iD,IACxBr1B,GAAIgnE,EAAOv5E,OACXg/B,UAAW,EACX8I,eAAe,EACfG,cAAe,SAAU3wB,GACvB,OACEpB,IAAKoB,IAGTuwB,cAAe,SAAUvwB,EAAMpB,GAC7B,MAAOA,GAAIA,KAAOoB,IAGtBtgB,MAAK0Y,QACL1Y,KAAK0zF,mBACL1zF,KAAK2zF,aACL3zF,KAAK4zF,YACL5zF,KAAK6zF,iBAWL7zF,KAAK8zF,aAAe,SAAUj2E,GAE5B,MADA7d,MAAK6d,UAAYA,EACV7d,KAAK+zF,YAYd/zF,KAAK+zF,SAAW,WACd,GAAIl2E,GAAY7d,KAAK6d,SAErB,OAAKA,IAAc,cAAcnB,KAAKmB,EAAUvX,OAKhDtG,KAAK6M,SAAU,EACf7M,KAAK6d,UAAYA,EACV0kE,EAAOxiE,OAAOlC,GAAW5Z,KAAK,SAAUyU,GAI7C,MAHA1Y,MAAK2zF,UAAYP,EAAc16E,GAC/B1Y,KAAK0zF,gBAAkBL,EAAY36E,GACnC1Y,KAAK0Y,KAAOA,EACLA,GACP7S,KAAK7F,OAAO+rD,QAAQ,WACpB/rD,KAAK6M,SAAU,GACfhH,KAAK7F,SAbLA,KAAK0Y,QACEjU,EAAGK,QAAQ9E,KAAK0Y,QAqB3B1Y,KAAKg0F,gBASLh0F,KAAKi0F,WAAa,SAAU3zE,GAK1B,MAJa,KAATA,GAAgBA,GAClBtgB,KAAKk0F,iBAGAT,EAAgBzqF,OAAOsX,GAAMrc,KAAK,SAAUyU,GACjD1Y,KAAKg0F,aAAet7E,GACpB7S,KAAK7F,QAUTA,KAAKm0F,iBAAmBhvD,EAAU,WAChC,GAAIivD,GAAYp0F,KAAKq0F,mBAAmBr0F,KAAK0Y,KAAM1Y,KAAK2zF,UACxD,OAAO3zF,MAAKs0F,WAAWF,IACtB,KACHp0F,KAAKu0F,qBAAuBpvD,EAAU,WACpC,GAAIivD,GAAYp0F,KAAKq0F,mBAAmBr0F,KAAK4zF,SAC7C5zF,MAAK4zF,WACL,IAAIn1E,GAAOze,KAAKye,KAAKA,IAOrB,OANA21E,GAAU/yF,IAAIqF,QAAQ,SAAUwY,GAC9BA,EAAIqB,GAAK9B,EAAKg5C,GACdv4C,EAAIsB,GAAK/B,EAAKi5C,GACdx4C,EAAIuB,GAAKhC,EAAKk5C,GACdz4C,EAAIwB,GAAKjC,EAAKm5C,KAET53D,KAAKs0F,WAAWF,GAAWnwF,OAGpCjE,KAAKk0F,eAAiB,WACpB,MAAO3R,GAAOviE,WAAW,aAAa/b,KAAK,SAAUyU,GACnD1Y,KAAKg0F,aAAet7E,GACpB7S,KAAK7F,QAGTA,KAAKk0F,iBAELl0F,KAAKq0F,mBAAqB,SAAU37E,EAAM87E,GACxC,GAAIb,GAAYP,EAAc16E,GAC1B+7E,EAAW7iF,OAAOC,KAAK2iF,OAAoBn0F,OAAO,SAAU8f,GAC9D,OAAQwzE,EAAUxzE,IAKpB,QACE9e,IAJUqX,EAAKrY,OAAO,SAAU6e,GAChC,OAAQA,EAAIrY,KAIZuH,OAAQqmF,IAIZz0F,KAAKs0F,WAAa,SAAUF,GAC1B,GAAIv2E,GAAY7d,KAAK6d,SAGrB,OAFAhe,SAAQiI,IAAI,eAAgB+V,GAC5Bhe,QAAQiI,IAAI,gBAAiBssF,GACtB3vF,EAAGrB,KAAKqB,EAAGrB,IAAIgxF,EAAUhmF,OAAOzI,IAAI,SAAUwa,GACnD,MAAOoiE,GAAOriE,UAAUrC,EAAWsC,MAChC1b,EAAGrB,IAAIgxF,EAAU/yF,IAAIsE,IAAI,SAAUuZ,GACtC,MAAOqjE,GAAOniE,OAAOvC,EAAWqB,QAC5Bjb,KAAK,SAAUywF,GACnB,MAAO10F,MAAK+zF,YACZluF,KAAK7F,OAAOmK,MAAM,WAElB,MAAOnK,MAAK+zF,YACZluF,KAAK7F,QAGTA,KAAKye,KAAOlf,QAAQyL,OAAO,GAAI65D,IAC7B7N,iBAAkB,SAAUuc,GAC1BvzE,KAAKquC,MAAM2oB,iBAAiBt7C,KAAK1b,KAAMuzE,EAAMlY,IAAKkY,EAAMtY,KAE1DhE,UAAW,SAAUsc,EAAO7c,GAC1B12D,KAAKquC,MAAM4oB,UAAUv7C,KAAK1b,KAAMuzE,EAAMlY,IAAKkY,EAAMtY,GAAIvE,IAEvDi+B,cAAe,WACb90F,QAAQiI,IAAI,gBAAiB9H,KAAK4zF,UAClC5zF,KAAK4zF,aACL/tF,KAAK7F,MACPoN,MAAO,WACLpN,KAAK20F,gBACL30F,KAAKquC,MAAMjhC,MAAMsO,KAAK1b,SAG1Bk1D,EAAepkC,GAAG,YAAa9wB,KAAK8zF,aAAajuF,KAAK7F,UACrDonB,UAAU,QAAS,WACpB,OACEC,SAAU,IACVC,OACEpI,IAAK,KAEP2B,SAAU,6DC3OdthB,QAAQC,OAAO,oDAAqD,gCAAiC,2CAA2CqC,QAAA,sBAAO,SAAUqxF,GAU/JA,EAAoBp+B,cAClBxuD,KAAM,8BACNzC,MAAO,GACPpE,WAAY,gEACZyzD,SACEoD,aAAa,GAEfzrC,SACEvkB,KAAM,YACN0vD,WAAW,GAEbvhC,SAAS,EACT0+D,iBAAiB,OAWpB1zF,WAAW,mDAAA,KAAA,iBAAA,eAAA,SAAA,iCAAmD,SAAUgF,EAAIywD,EAAgBx0D,EAAcC,EAAQwmD,GACjHnnD,KAAK2zB,WAAa,WAChBuhC,EAAepkC,GAAG,YAAa9wB,KAAK8zF,aAAajuF,KAAK7F,OACtDmnD,EAA+BjqC,cAC7BG,aAAa,EACbD,cAAe,IACdnZ,KAAK,SAAU2wF,GAChB50F,KAAK60F,WAAaD,EAClB50F,KAAK40F,cAAgBA,EAAct3E,OAAO,SAAUC,EAAGjX,GAErD,MADAiX,GAAEjX,EAAKA,MAAQA,EACRiX,QAET1X,KAAK7F,OACPA,KAAK6/D,eACL7/D,KAAK80F,qBACHzsF,MAAO,EACP6V,QAAS,wBAET7V,MAAO,EACP6V,QAAS,yBAET7V,MAAO,EACP6V,QAAS,uBAIble,KAAK8d,SAAW,SAAU8E,EAAKmyE,GAC7B,IAAKr0F,EAAa6C,IAAI,oBAEpB,WADA5C,GAAOb,MAAM,wEAIf,IAAI+R,IAAQkjF,EAERljF,GAAKxO,OAAS,GAChB8jD,EAA+BrpC,SAAS9d,KAAK6d,WAC3CkK,MAASlW,EAAKpC,KAAK,KACnBmT,IAAKA,IACJ3e,KAAK,SAAU47D,GAChB7/D,KAAKi9D,eACL4C,EAAYn5D,QAAQ,SAAUqX,GACF,GAAtBA,EAAW2+C,cACN18D,MAAK6/D,YAAY9hD,EAAWi3E,WAEnCh1F,KAAK6/D,YAAY9hD,EAAWi3E,WAAaj3E,EAAW2+C,SAEtD72D,KAAK7F,QACP6F,KAAK7F,QAIXA,KAAK8zF,aAAe,SAAUj2E,GAE5B,MADA7d,MAAK6d,UAAYA,EACV7d,KAAKi1F,mBAGdj1F,KAAKi1F,gBAAkB,WACrB,GAAIp3E,GAAY7d,KAAK6d,SAErB,OAAKA,IAAc,cAAcnB,KAAKmB,EAAUvX,OAKhDtG,KAAK6M,SAAU,EACf7M,KAAK6d,UAAYA,EACVspC,EAA+BvpC,kBAAkBC,GAAW5Z,KAAK,SAAU47D,GAEhF,MADA7/D,MAAK6/D,YAAcA,EACZA,GACPh6D,KAAK7F,OAAO+rD,QAAQ,WACpB/rD,KAAK6M,SAAU,GACfhH,KAAK7F,SAXLA,KAAK6/D,eACEp7D,EAAGK,QAAQ9E,KAAK6/D,eAa3B7/D,KAAK2zB,gBC3GPp0B,QAAQC,OAAO,kCAAmC,sBAAuB,aAAaqC,QAAA,sBAAO,SAAUqxF,GASrGA,EAAoBp+B,cAClBxuD,KAAM,YACNzC,MAAO,GACPpE,WAAY,mDACZorB,SACEvkB,KAAM,YACN0vD,WAAW,GAEbvhC,SAAS,OAEVh1B,WAAW,uCAAA,SAAA,SAAA,cAAA,SAAA,WAAA,cAAA,eAAA,qBAAA,UAAA,SAAuC,SAAUC,EAAQmJ,EAAQ6vB,EAAa/4B,EAAQ0L,EAAUujD,EAAaluD,EAAcmkE,EAAoBriE,EAAS7B,GACpK,GAAIgwC,GAAO3wC,IACX2wC,GAAKpe,SAAW,KAChBoe,EAAKqsC,aACLrsC,EAAKukD,sBACLvkD,EAAKxtC,qBAAuBzC,EAAa0C,KAAmC,IAA5B1C,EAAa0C,IAAIC,QAAgB3C,EAAa0C,IAAIE,SAAS,qCAAuC5C,EAAa6C,IAAI,oBAAsB7C,EAAa8C,UACtMhB,EAAQgW,WAAW,SAAUwvC,GAC3BrX,EAAKqX,gBAAkBA,GAEzB,IAAImtC,GAAsBvmC,EAAY9/C,SACpCxH,kBAAkB,IACjBrD,KAAK,SAAU+4E,GAEhB,MADArsC,GAAKqsC,UAAYA,EACVA,GAGTrsC,GAAKykD,YAAc,WACjB,GAAI7N,GAAM7nF,EAAOme,WAAsC,aAAzBne,EAAOo2D,gBAAiCp2D,EAAOme,UAAUhX,EACvFsuF,GAAoBlxF,KAAK,WACvB0sC,EAAKukD,mBAAqBvkD,EAAKqsC,UAAU38E,OAAO,SAAUwgB,GACxD,MAAOA,GAASzJ,WAAamwE,MAGjC52C,EAAK8lB,OAAOrpD,QACZujC,EAAK8lB,OAAOr/C,UAAYmwE,GAG1B52C,EAAK0kD,gBAAkB,WACrB11F,EAAOiC,GAAG,yBAGZ+uC,EAAK8lB,OAASl3D,QAAQyL,OAAO,GAAI65D,IAC/Bz3D,MAAO,WACLpN,KAAKquC,MAAMjhC,MAAMsO,KAAK1b,MACtBA,KAAKwU,IAAM,MAEbuiD,cAAe,WACb/2D,KAAKquC,MAAM0oB,cAAcr7C,KAAK1b,MAC9BA,KAAKwU,IAAMxU,KAAKye,MAElB62E,aAAc,WACZt1F,KAAK+2D,iBAEPC,iBAAkB,SAAUuc,GAC1BvzE,KAAKquC,MAAM2oB,iBAAiBt7C,KAAK1b,KAAMuzE,EAAMlY,IAAKkY,EAAMtY,KAE1DhE,UAAW,SAAUsc,EAAO7c,GAC1B72D,QAAQiI,IAAI,wBAAyByrE,EAAO,KAAM7c,EAAS,MAC3D12D,KAAKquC,MAAM4oB,UAAUv7C,KAAK1b,KAAMuzE,EAAMlY,IAAKkY,EAAMtY,GAAIvE,IAEvD6+B,qBAAsB,WACpB,MAAOv1F,MAAKu8D,cAAgBv8D,KAAKu8D,cAAcnjD,aAAe,IAAMpZ,KAAKu8D,cAAc1U,cAAgB,iBAEzG5hC,OAAQ,WACN,IAAKvlB,EAAa6C,IAAI,oBAEpB,WADA5C,GAAOb,MAAM,iDAIVE,KAAKu8D,cAAc1U,eAAkB7nD,KAAKu8D,cAAcnjD,gBAI7DpZ,KAAKw1F,YAAa,EAClB5mC,EAAYvtD,KACVL,KAAMhB,KAAKy1F,eAAiBz1F,KAAKu8D,cAAcnjD,aAAe,IAAMpZ,KAAKu8D,cAAc1U,cACvFzwC,UAAWpX,KAAKoX,UAChB9S,QAAStE,KAAKu8D,cAAcj4D,QAC5ButC,SAAU7xC,KAAKu8D,cAAc1qB,SAC7Br9B,IAAKxU,KAAKwU,MACTvQ,KAAK,SAAUyxF,GAGhB,GAFA71F,QAAQiI,IAAI,eAAgB4tF,GAC5B11F,KAAKw1F,YAAa,EACM,IAApBE,EAAa7uF,GAAU,MAAOlG,GAAOb,MAAM,8DAC/CuL,GAAS,WACPrL,KAAKoN,QACLujC,EAAKqsC,UAAUv/D,KAAKi4E,GACpB/kD,EAAKykD,eACLvvF,KAAK7F,QACP6F,KAAK7F,WAGXN,EAAO8oB,OAAO,YAAamoB,EAAKykD,gBCrGlC71F,QAAQC,OAAO,uCAAwC,cAAe,uBAAwB,iCAAiCqC,QAAA,gCAAO,SAAU8zF;gLAC9IA,EAA8Bt0F,KAC5BiF,KAAM,wBACNsvF,SAAU,gDAAiD,SAAUC,GACnE,MAAOA,UAGV11F,QAAQ,iDAAA,KAAA,6BAAA,kBAAA,cAAiD,SAAUsE,EAAIyhE,EAA4Bz6B,EAAiBuK,GACrH,GAAI8/C,GACAC,EACAC,EAAgBvxF,EAAGK,UAAUb,KAAK,WACpC,MAAOQ,GAAGrB,KAAK8iE,EAA2Bh3D,wBAAwBjL,KAAK,SAAUgyF,GAC/EH,EAAaG,IACX/vB,EAA2Bj3D,wBAAwBhL,KAAK,SAAUiyF,GACpEH,EAAiBG,EAAY54E,OAAO,SAAUC,EAAG+U,GAC/C,MAAO/U,GAAE+U,EAAE9iB,WAAa8iB,EAAG/U,aAK7B44E,EAAsB,SAAUxzF,GAClC3C,KAAK6W,OAAOlU,GAAMsB,KAAK,WACrB,MAAO+xF,IACPnwF,KAAK7F,OAAOiE,KAAK,WACjB,MAAOjE,MAAKo2F,YACV3tF,EAAGstF,EAAeM,IAClBhnF,EAAG0mF,EAAeO,MAClBhnF,EAAGwmF,EAAWx4E,OAAO,SAAUC,EAAG+U,GAChC,MAAsB,SAAfA,EAAE9iB,UAAuB8iB,EAAI/U,GACnC,SAEL1X,KAAK7F,OAkFT,OA/EAm2F,GAAoBI,MAAQ,SAAU14E,GACpC,GAAI1B,GAAI1X,EAAG2X,OAGX,OAFAyB,GAAY,GAAIs4E,GAAoBt4E,GACpC1B,EAAErX,QAAQ+Y,GACH1B,EAAEG,SAGX65E,EAAoB3zD,KAAO,SAAU3kB,EAAWne,GAC9C,MAAOy2F,GAAoBI,MAAM14E,IAGnCs4E,EAAoBl1B,cAAgB,SAAUpjD,GAC5C,MAAOA,GAAU7c,MAGnBm1F,EAAoBloF,WAClB3H,KAAM,wBACNolC,OAAQ,UACR8qD,UAAU,EACV3/E,OAAQ,SAAUlU,GAChB9C,QAAQiI,IAAI,cAAenF,EAE3B,KAAK,GAAIggB,KAAKhgB,GACZ3C,KAAK2iB,GAAKhgB,EAAKggB,EAcjB,OAXA3iB,MAAKozC,MACH1H,QACE7nC,MAAOlB,EAAK3B,MAEd2B,UAGwC,GAAtCA,EAAKoN,WAAWsb,QAAQ,WAC1B1oB,EAAKoN,WAAW0N,KAAK,SAAU,aAAc,YAGxCu4E,EAAc/xF,KAAK,WACxB,GAAI8L,GAAapN,EAAKoN,WAAWuN,OAAO,SAAUC,EAAG+U,GACnD,MAAOyjE,GAAezjE,IAAM/U,EAAEE,KAAKs4E,EAAezjE,IAAK/U,MAEzDvd,MAAKy2F,gBACHhuF,EAAGsH,EACHV,EAAGU,EACHT,EAAGwmF,EACHpxC,SACEj8C,EAAGstF,EAAeM,IAClBhnF,EAAG0mF,EAAeO,MAClBhnF,EAAGwmF,EAAWx4E,OAAO,SAAUC,EAAG+U,GAChC,MAAsB,SAAfA,EAAE9iB,UAAuB8iB,EAAI/U,GACnC,SAGP1X,KAAK7F,QAETo2F,WAAY,SAAUpgC,GACpBh2D,KAAKy2F,eAAe/xC,QAAUnlD,QAAQyL,UAAWhL,KAAKy2F,eAAe/xC,QAASsR,EAC9E,IAAIvtD,GAAIzI,KAAKy2F,eAAe/xC,QAAQj8C,EAChC4G,EAAIrP,KAAKy2F,eAAe/xC,QAAQr1C,EAChCC,EAAItP,KAAKy2F,eAAe/xC,QAAQp1C,CAEpC,OADAzP,SAAQiI,IAAI,8BAA+B9H,KAAKy2F,eAAe/xC,SACxDwhB,EAA2B/2D,WAAWnP,KAAK6G,GAAI4B,EAAG4G,EAAGC,GAAGrL,KAAK,SAAUtB,GAC5E,GAAIywC,GAAO3qC,GAAK4G,EAAIo8B,EAAgBqI,YAAYrrC,EAAG6G,EAAG3M,EAAM3C,KAAKgB,MAAQyqC,EAAgB0H,gBAAgB1qC,EAAG4G,EAAGC,EAAG3M,EAAM3C,KAAKgB,KAC7HhB,MAAKozC,KAAKzwC,MAAQywC,EAAKzwC,MACvB3C,KAAKozC,KAAK1H,OAAS0H,EAAK1H,QACxB7lC,KAAK7F,QAET02F,SAAU,WACR,GAAIjuF,GAAIzI,KAAKy2F,eAAe/xC,QAAQj8C,EAChC4G,EAAIrP,KAAKy2F,eAAe/xC,QAAQr1C,EAChCC,EAAItP,KAAKy2F,eAAe/xC,QAAQp1C,CACpC,OAAO42D,GAA2Bx2D,YAAY1P,KAAK6G,GAAI4B,EAAG4G,EAAGC,GAAGrL,KAAK,SAAUtB,GAC7EqzC,EAAYn/B,OAAOlU,EAAK0E,QAG5BsvF,WAAY,WACV,MAAOR,GAAoBl1B,cAAcjhE,QAGtCm2F,KCjHT52F,QAAQC,OAAO,2BAA4BO,SAAS,wBAAyB,WAC3E,GAAI43C,KAEJ,QACEt2C,IAAK,SAAUu1F,GACbj/C,EAAMi/C,EAAQtwF,MAAQ/G,QAAQyL,OAAO2sC,EAAMi/C,EAAQtwF,UAAaswF,IAElE12F,MAAA,YAAM,SAAUwE,GACd,OACEizC,MAAOA,EACPopB,UAAW,SAAUz6D,GACnB,IAAKqxC,EAAMrxC,GACT,KAAM,IAAI0X,OAAM,2BAA6B1X,EAAO,cAGtD,OAAO5B,GAAUK,OAAO4yC,EAAMrxC,GAAMsvF,gBCf9Cr2F,QAAQC,OAAO,2BAA4B,cAAe,yBAAyBqC,QAAA,gCAAO,SAAU8zF,GAClGA,EAA8Bt0F,KAC5BiF,KAAM,YACNsvF,SAAU,sCAAuC,SAAUiB,GACzD,MAAOA,UAGV12F,QAAQ,uCAAA,KAAA,UAAA,gBAAuC,SAAUsE,EAAIjC,EAAS+B,GACvE,GAAIuyF,GAAa,SAAU50E,GACzB,MAAOA,GAAI,IAAO,GAehBu/C,EAZ4B,WAC9B,IACE,MAAOx8D,MAAKC,MAAMX,EAAcY,QAAQ,mCACtCm8D,eAAe,GAEjB,MAAO1hE,GACP,OACE0hE,eAAe,OAOjBlqD,EAAY,SAAUzU,EAAMo0F,GAC9B,IAAK,GAAIp0E,KAAKhgB,GACZ3C,KAAK2iB,GAAKhgB,EAAKggB,EA8BjB,IA3BA3iB,KAAK8hE,cAAgB9hE,KAAKg3F,YAC1Bh3F,KAAK+2F,MAAQA,EACb/2F,KAAK2hE,SAAW3hE,KAAK8hE,cAAgB,EACrC9hE,KAAK6hE,KAAOJ,GAAcA,EAAWH,cAAgBthE,KAAK2hE,SAAW3hE,KAAK2hE,SAAW,KAAQ3hE,KAAK2hE,SAAW,KAExGh/D,IACH3C,KAAK6hE,KAAO,MACZ7hE,KAAKgkB,SAAW,IAGlBhkB,KAAKq8B,QACH5zB,GACE+T,KAAM,EACN1b,GAAId,KAAKgkB,SACT69C,KAAM7hE,KAAKgkB,SACXwhB,KAAM,aACN7E,MAAO,IAETtxB,GACEmN,KAAM,EACN1b,GAAId,KAAK6hE,KACTA,KAAM7hE,KAAK6hE,KACXr8B,KAAM,oBACNg2B,YAAas7B,KAIZ92F,KAAKi3F,MAER,YADAj3F,KAAKijF,YAAa,EAKpBjjF,MAAKi3F,MAAMziD,IAAI9tC,QAAQ,SAAUwwF,GAC/B,GAAMv0F,EAAKw0F,OACTD,EAAKr5D,IAAM,gBAAkBr7B,EAAQU,SAAW,qBAAuBlD,KAAK6G,GAAK,IAAMqwF,EAAKv0E,EAAI,IAAMu0E,EAAK3kD,MACtG,CACL,GAAI6kD,GAAWz0F,EAAK07B,IAAI31B,MAAM,KAAK,EACnC,MAAM0yC,GAAWz4C,EAAK00F,aAAe10F,EAAK00F,aAAe10F,EAAKy4C,QAC9D,IAAInI,GAAQ,GAAIhrC,MAAK,GAAIA,MAAKmzC,GAAUk8C,UAAY12F,KAAK6gC,MAAe,IAATy1D,EAAK7hF,IAAWixE,cAC3EpZ,EAAM,GAAIjlE,MAAK,GAAIA,MAAKmzC,GAAUk8C,UAAY12F,KAAK6gC,MAA2B,KAApBy1D,EAAK7hF,EAAI6hF,EAAKK,MAAajR,aACzF4Q,GAAKr5D,IAAM,0BAA4Bu5D,EAAW,KAAOnkD,EAAMrqC,QAAQ,UAAW,IAAM,IAAMskE,EAAItkE,QAAQ,UAAW,IAAM,6CAE7H/C,KAAK7F,OAwCT,OArCAoX,GAAU69C,UAEV79C,EAAUm/E,MAAQ,SAAU14E,GAC1B,GAAI1B,GAAI1X,EAAG2X,OAUX,OATA5Z,GAAQsX,iBAAiB+D,EAAUhX,GAAI,SAAUlE,GAClC,iBAATA,IACFkb,EAAUolE,YAAa,EACvBtgF,MAGFkb,EAAY,GAAIzG,GAAUzU,EAAMkb,EAAUk5E,OAC1C56E,EAAErX,QAAQ+Y,KAEL1B,EAAEG,SAGXlF,EAAUorB,KAAO,SAAU3kB,EAAWne,GACpC,MAAO0X,GAAUm/E,MAAM14E,GAAW5Z,KAAK,SAAU4Z,GAK/C,MAJIA,GAAU25E,UACZ93F,EAAOu+C,aAAazb,KAAK3kB,EAAU25E,UAG9B35E,KAIXzG,EAAU6pD,cAAgB,SAAUpjD,GAClC,MAAOA,GAAUysE,MAGnBlzE,EAAUnJ,WACR3H,KAAM,YACNkwF,UAAU,EACVG,WAAY,WACV,MAAOv/E,GAAU6pD,cAAcjhE,QAG5BoX,KClHT7X,QAAQC,OAAO,4BAA6B,cAAe,yBAAyBqC,QAAA,gCAAO,SAAU8zF,GACnGA,EAA8Bt0F,KAC5BiF,KAAM,aACNsvF,SAAU,uCAAwC,SAAU6B,GAC1D,MAAOA,UAGVt3F,QAAQ,wCAAA,KAAA,UAAwC,SAAUsE,EAAIjC,GAC/D,GAAIs0F,GAAa,SAAU50E,GACzB,MAAOA,GAAI,IAAO,GAGhBw1E,EAAe,SAAUx1E,GAC3B,MAAOthB,MAAKkoB,MAAM5G,EAAI,IAAQ,IAAQ,QAGpC69D,GACF4X,aACEC,UAAW,qBACXC,SAAU,SAAU31E,GAClB,OAAY,EAAJA,GAAS,QAGrB41E,cACEF,UAAW,sBACXC,SAAU,SAAU31E,GAClB,MAAW,GAAJA,IAGX61E,aACEH,UAAW,sBACXC,SAAU,SAAU31E,GAClB,MAAW,GAAJA,IAGX81E,eACEJ,UAAW,uBACXC,SAAU,SAAU31E,GAClB,MAAOa,UAASk1E,aAAaC,SAAa,EAAJh2E,GAAS,KAGnDi2E,aACEP,UAAW,kBACXC,SAAU,SAAU31E,GAClB,MAAOa,UAASk1E,aAAaG,WAAe,EAAJl2E,GAAS,KAGrDiY,MACEy9D,UAAW,eACXC,SAAU,SAAU31E,GAClB,MAAW,GAAJA,IAGXm2E,SACET,UAAW,OACXC,SAAU,SAAU31E,GAClB,MAAW,GAAJA,KAKTtD,EAAa,SAAUjc,GACzB3C,KAAK6W,OAAOlU,GAiHd,OA9GAic,GAAW23E,MAAQ,SAAU14E,GAC3B,GAAI1B,GAAI1X,EAAG2X,OAGX,OAFAyB,GAAY,GAAIe,GAAWf,GAC3B1B,EAAErX,QAAQ+Y,GACH1B,EAAEG,SAGXsC,EAAW4jB,KAAO,SAAU3kB,EAAWne,GACrC,MAAOkf,GAAW23E,MAAM14E,IAG1Be,EAAWqiD,cAAgB,SAAUpjD,GACnC,GAAIy6E,IACFX,YAAe,cACfG,aAAgB,eAChBC,YAAe,cACfC,cAAiB,gBACjBG,YAAe,cACfh+D,KAAQ,QAEV,OAAOtc,GAAU7c,KAAO,KAAOs3F,EAAIz6E,EAAUyhE,aAAe,KAG9D1gE,EAAW3Q,WACT3H,KAAM,aACNkwF,UAAU,EACV3/E,OAAQ,SAAUlU,GAChB,IAAK,GAAIggB,KAAKhgB,GACZ3C,KAAK2iB,GAAKhgB,EAAKggB,EAGjB,IAAIpC,GAAKvgB,KAAK+hF,MACVthE,EAAKzgB,KAAKu4F,MACV/3E,EAAKxgB,KAAKw4F,MACV93E,EAAK1gB,KAAKy4F,MACVC,EAAK14F,KAAK24F,UACVC,EAAK54F,KAAK64F,kBAAoB74F,KAAK84F,SAEnC94F,MAAK+4F,aACPL,EAAK,EACLE,EAAK,IAGP,IAAII,GAAKv4E,EAAKF,EAAK,EACf04E,EAAKv4E,EAAKF,EACV04E,EAAKN,EAAKF,EACVpZ,EAAcS,EAAa//E,KAAKs/E,cAAgBS,EAAasY,QAC7DT,EAAYtY,EAAYsY,SAE5B53F,MAAKq8B,QACH5zB,GAEE+T,KAAM+D,EACNzf,GAAI2f,EACJohD,KAAMm3B,EACNr4D,MAAOq4D,EACPz2B,SAAS,EACTJ,cAAe,EACfzG,YAAa4jB,EAAYuY,SACzBryD,KAAMoyD,GAAa,cAErBvoF,GACEmN,KAAMgE,EACN1f,GAAI4f,EACJmhD,KAAMo3B,EACNzzD,KAAM,oBACN28B,cAAeniE,KAAKm5F,SACpBz9B,YAAag8B,EACbl8B,YAAas7B,GAEfh7D,QACEtf,KAAMk8E,EACN53F,GAAI83F,EACJ/2B,KAAMq3B,EACNv4D,MAAO//B,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAS,EAAL67D,EAAQ,KACpC1zD,KAAM,QACN3H,IAAK,oBAAsB79B,KAAKo5F,eAAiB,SAIjDp5F,KAAK+4F,aACP/4F,KAAKq8B,OAAOP,OAAO0/B,YAAc,SAAUt5C,GACzC,MAAOA,GAAI,MAKfliB,KAAKi3F,OACHxuF,EAAG,EACH4G,EAAG,EACHmlC,MACE7xB,EAAG,EACH4vB,EAAG,EACHl9B,EAAG,EACH4lD,GAAIv6C,EACJ62E,GAAIyB,EACJK,IAAKJ,EACLp7D,IAAK79B,KAAKssE,UACVgtB,OAAO,KAGXt5F,KAAK87B,QACHuB,IAAK,EACLC,IAAK,MAGTq5D,WAAY,WACV,MAAO/3E,GAAWqiD,cAAcjhE,QAG7B4e,KC/KTrf,QAAQC,OAAO,iBAAkB,uBAAwB,0BAA2B,2BAA4B,wCCAhHD,QAAQC,OAAO,mDAAoD,eAAgB,cAAe,iBAAkB,SAAU,cAAcqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC3Ko1C,EAAeC,MAAM,gDACnB9vC,IAAK,kBACL5H,WAAY,qBACZ+K,YAAa,mEAEd/K,WAAW,sBAAA,SAAA,SAAA,UAAA,UAAA,gBAAA,WAAA,cAAA,SAAA,YAAA,WAAA,eAAsB,SAAUC,EAAQmJ,EAAQghB,EAASrnB,EAASwmE,EAAe/c,EAAUwE,EAAa9vD,EAAQkN,EAAW41E,EAAU/iF,GACjJ,GAAI0oE,GAAY,SAAUziE,EAAGwmD,EAAG93C,EAAGi8C,EAAGv7C,GACpC,GAAIsf,MACAg0C,EAAU,MAEF,MAARh0D,EAAE,KACJg0D,EAAU,OAGZh0C,EAAOhgB,EAAEsuB,UAAU,IAAM0lC,CACzB,IAAIC,IACFtmE,KAAM2D,EACNa,MAAO2lD,EACPoc,QAASl0C,EACTh1B,OAAQixD,EAEV5xD,GAAO8pE,YAAc,GAAIR,GAAcM,GACrCn6C,MAAOpZ,EACPjS,QAAS,SAAU2lE,EAAQ1oE,GACzBrB,EAAOgqE,aAAe,EACtB,IAAIC,GAAe5oE,EAAOV,SAAWwpB,EAAQ,UAAUnqB,EAAO65F,wBAAyBx4F,EAAOV,UAAYX,EAAO65F,wBAC7G1vB,EAAc9oE,EAAOwoE,UAAY1/C,EAAQ,WAAW8/C,EAAc5oE,EAAO+oE,WAAapqE,EAAO65F,uBACjGx4F,GAAOouB,MAAM06C,EAAYxmE,QACzBomE,EAAO3kE,QAAQ+kE,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,UAE1FqiE,EAAYxmE,OAAS,IACvB3D,EAAOgqE,aAAe,6BAGxBhqE,EAAO85F,oBAAsB3vB,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,SAC5Gi8E,EAASpxE,WACP1P,KAAQjD,EAAO65F,wBACf5a,SAAYj/E,EAAO85F,oBACnBloC,EAAKvwD,EAAOV,SACZiiC,EAAKvhC,EAAO+oE,UACZnjE,EAAK5F,EAAOiC,OACZmqD,EAAKpsD,EAAOyG,QACZuO,EAAK8zD,EAAYxmE,YAMzB3D,GAAOitD,YAAc,WACnBjtD,EAAO2sD,YAAc,GACrB3sD,EAAOktD,aAAc,EACrBltD,EAAO6sD,UAAY,GACnB7sD,EAAOmtD,WAAY,EACnBntD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,GAGnBnN,EAAO+5F,WAAa,SAAU/lE,GAC5B,MAAOA,GAAIrwB,OAASqwB,EAAI,GAAGtR,cAAgBsR,EAAI/qB,MAAM,GAAK+qB,GAG5Dh0B,EAAOg6F,oBAAsB,WAC3BjW,EAASxzE,KAAK,SAAUtN,GACtBjD,EAAO65F,wBAA0B52F,EACjCA,EAAK+D,QAAQ,SAAUgtB,GACrBA,EAAIimE,MAAQj6F,EAAO+5F,WAAW/lE,EAAIwlB,WAAa,IAAMx5C,EAAO+5F,WAAW/lE,EAAIlmB,YAE7E9N,EAAO85F,oBAAsB72F,EAC7BjD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EACjBnN,EAAOgqE,aAAe,GAElB/mE,EAAKU,OAAS,EACX3D,EAAO8pE,YAGV9pE,EAAO8pE,YAAYxD,SAFnBoD,EAAU,EAAG,GAAI,YAAczmE,EAAKU,QAKtC3D,EAAOgqE,aAAe,+BAK5BhqE,EAAOk6F,0BAA4B,SAAUC,GAC3Cn6F,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,CACjB,IAAIlK,IACFkE,GAAIgzF,EAAO3mF,OACXlS,KAAM64F,EAAOvkC,MACb7/C,QAASokF,EAAOC,SAChB9pF,UACEhP,KAAM64F,EAAOvnC,cACbzrD,GAAIgzF,EAAO9hF,aAGKlP,GAAO0B,MACzBC,YAAa,mEACb/K,WAAY,4BACZs6F,YAAa,uBACb5yE,SAAU,SACVriB,SACEk1F,WAAY,WACV,OACEr3F,KAAMA,EACNyE,QAAS1H,EAAOo9C,iBAKVgR,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,KAIrBnN,EAAOu6F,wBAA0B,WAC/B,IAAKv5F,EAAa6C,IAAI,oCAEpB,WADA5C,GAAOb,MAAM,uDAIfJ,GAAOmN,SAAU,EACjBnN,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,CAClB,IAAImB,GAAgBhlD,EAAO0B,MACzBC,YAAa,iFACb/K,WAAY,sCACZqF,SACEnC,MAAA,KAAM,SAAU8B,GACd,GAAI0X,GAAI1X,EAAG2X,OAQX,OAPA5Z,GAAQoY,UAAU,SAAUlN,EAAK/K,GAC3B+K,GACF7N,QAAQC,MAAM4N,GAGhByO,EAAErX,QAAQnC,SAELwZ,EAAEG,UAEX5E,WAAA,KAAW,SAAUjT,GACnB,GAAI0X,GAAI1X,EAAG2X,OAIX,OAHAq0C,GAAY3hD,UAAU7K,KAAK,SAAUtB,GACnCwZ,EAAErX,QAAQnC,SAELwZ,EAAEG,UAEXwgC,YAAa,WACX,MAAOp9C,GAAOo9C,eAIpB+Q,GAAcC,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,IAEnBghD,EAAcjmD,OAAO3D,KAAK,SAAU2D,GAClCjF,KAAOiF,EAEHjF,KAAK0lC,KACP4jB,EAASc,aACTpsD,EAAOmH,IAAI,iGAGTnF,KAAK7C,OACPa,EAAOb,MAAM,UAAY6C,KAAK7C,OAG5B6C,KAAK0E,KACPwG,EAAU9E,KAAKpG,KAAK0E,QAK1B3H,EAAOw6F,qBAAuB,SAAUrzF,EAAI7F,GAC1C,IAAKN,EAAa6C,IAAI,oCAEpB,WADA5C,GAAOb,MAAM,uDAIfJ,GAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,CACjB,IAAIghD,GAAgBhlD,EAAO0B,MACzBC,YAAa,8EACb/K,WAAY,mCACZqF,SACE9D,KAAM,WACJ,MAAOA,IAET6F,GAAI,WACF,MAAOA,IAETi2C,YAAa,WACX,MAAOp9C,GAAOo9C,eAIpB+Q,GAAcC,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,IAEnBghD,EAAcjmD,OAAO3D,KAAK,SAAUujE,GAClC,GAAIA,EAAI95D,IACN/M,EAAOb,MAAM,UAAY0nE,EAAI95D,SACxB,CAIL,IAAK,GAHDuI,IAAS,EACTwxD,EAASloE,QAAQ8N,KAAK3N,EAAO65F,yBAExB52E,EAAI,EAAGA,EAAI8kD,EAAOpkE,OAAQsf,IACjC,GAAI8kD,EAAO9kD,GAAGzP,SAAWrM,EAAI,CAC3BoP,EAAQ0M,CACR,OAIA1M,GAAS,IACXvW,EAAO65F,wBAAwBtrE,OAAOhY,EAAO,GAC7CvW,EAAO8pE,YAAYxD,SACnBrlE,EAAOmH,IAAI,4CAMnBpI,EAAOmN,SAAU,EACjBnN,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBlqD,EAAQE,QAAQ,SAAUC,GACxBjD,EAAOo9C,YAAcn6C,GAEvB,IAAIk8E,GAAY4E,EAASnxE,UAEP,QAAdusE,EACFn/E,EAAOg6F,uBAEH7a,EAAUl8E,KAAKU,OAAS,GAC1B3D,EAAO85F,oBAAsB3a,EAAUF,SACvCj/E,EAAO65F,wBAA0B1a,EAAUl8E,KAC3CymE,EAAUyV,EAAUl4E,EAAGk4E,EAAU1xB,EAAG0xB,EAAUv8C,EAAE,GAAIu8C,EAAUvtB,EAAGutB,EAAUF,SAASt7E,SAEpF3D,EAAOgqE,aAAe,mBAGxBhqE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,MAElBpN,WAAW,oCAAA,SAAA,iBAAA,WAAA,OAAA,KAAA,cAAoC,SAAUC,EAAQwjB,EAAgBugE,EAAUziF,EAAM6F,EAAIi2C,GACtGp9C,EAAOsB,KAAOA,EACdtB,EAAOmH,GAAKA,EACZnH,EAAOkoE,gBAAiB,EACxBloE,EAAOo9C,YAAcA,CACXp9C,GAAOo9C,YAAYz1C,GAE7B3H,GAAO2oC,GAAK,WACV3oC,EAAOkoE,gBAAiB,EACxB6b,EAASr1E,OAAOvH,EAAI,SAAUlE,GAC5BugB,EAAeyC,MAAMhjB,MAIzBjD,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAExB1lB,WAAW,6BAAA,SAAA,iBAAA,WAAA,WAAA,SAAA,eAAA,aAA6B,SAAUC,EAAQwjB,EAAgBugE,EAAU0W,EAAUx5F,EAAQD,EAAcs5F,GACrH,GAAII,GAAoB,WACtB3W,EAAShxE,iBAAiB/S,EAAO26F,WAAWxzF,GAAInH,EAAO2wC,YAAc3wC,EAAO46F,WAAY56F,EAAO46F,WAAY,SAAUC,GACnH9W,EAAS9wE,aAAajT,EAAO26F,WAAWxzF,GAAI0zF,EAAQ,GAAGluB,cAAc5lE,QAAQ,SAAU9D,GACrF,GAAI63F,GAAS55F,KAAK08B,IAAI1hB,MAAM,KAAMjZ,EAAK83F,OAEd,iBAAd/6F,GAAOmlF,KAChBnlF,EAAOg7F,UAAYF,EAAS96F,EAAOmlF,GAAK,KAAO,OAGjDnlF,EAAOi7F,QAAUh4F,EAAK83F,OACtB/6F,EAAO2nF,KAAOkT,EACd76F,EAAOk7F,KAAOL,EAAQ,GAAGp9D,MAAMy9D,KAC/Bl7F,EAAOm7F,KAAON,EAAQ,GAAGp9D,MAAM09D,KAC/Bn7F,EAAOo7F,YAAcl6F,KAAK6gC,MAAoB,IAAd/hC,EAAOm7F,MAAe,QAK5Dn7F,GAAO2oC,GAAK,WACVnlB,EAAeyC,SAGjBjmB,EAAOs8B,KAAO,WACZt8B,EAAO2wC,YAAc3wC,EAAO2wC,YAAc,EAEtC3wC,EAAO2wC,YAAc3wC,EAAO46F,YAAc56F,EAAO26F,WAAWlrE,MAC9DzvB,EAAO2wC,YAAc3wC,EAAO2wC,YAAc,EAE1C+pD,KAIJ16F,EAAOq8B,KAAO,WACZr8B,EAAO2wC,YAAc3wC,EAAO2wC,YAAc,EAEtC3wC,EAAO2wC,YAAc,EACvB3wC,EAAO2wC,YAAc,EAErB+pD,KAIJ16F,EAAOq7F,MAAQ,SAAUC,GACV,SAATA,IACFt7F,EAAO2wC,YAAc,GAGV,QAAT2qD,IACFt7F,EAAO2wC,YAAczvC,KAAKgoB,KAAKlpB,EAAO26F,WAAWlrE,MAAQzvB,EAAO46F,YAAc,GAGhFF,KAGF16F,EAAOu7F,iBAAmB,WACxBv7F,EAAOw7F,UAAYx7F,EAAOw7F,SAEtBx7F,EAAOw7F,WAAax7F,EAAO2nF,MAC7B+S,KAIJ16F,EAAOmN,SAAU,EACjBnN,EAAOg7F,UAAY,IACnBh7F,EAAO26F,WAAaL,EAAWr3F,KAC/BjD,EAAO0H,QAAU4yF,EAAW5yF,QAC5B1H,EAAOw7F,UAAW,EAClBx7F,EAAO2wC,YAAc,EACrB3wC,EAAO46F,WAAa,EACpB56F,EAAOy7F,OAAS,gBAAkBz7F,EAAO0H,QAAQC,IAAM,wBAA0B3H,EAAO26F,WAAWxzF,GACnGnH,EAAOgiF,aAAehhF,EAAa6C,IAAI,oCACvC1D,QAAQu7F,MAAM17F,EAAO26F,YACrB5W,EAASlxE,WAAW7S,EAAO26F,WAAWxzF,GAAI,SAAUlE,GAClD,IAAKA,EAGH,MAFAugB,GAAeyC,YACfhlB,GAAOmH,IAAI,+CAIbvI,SAAQyL,OAAOtL,EAAO26F,WAAY13F,GAClCjD,EAAO4nF,UAAY1mF,KAAKgoB,KAAKlpB,EAAO26F,WAAWlrE,MAAQzvB,EAAO46F,YAC9Dz6F,QAAQiI,IAAIpI,EAAO26F,YACnB36F,EAAO0oD,UAAY,SAAU1oD,EAAO26F,WAAWlrE,MAAQzvB,EAAO26F,WAAW39B,UAAW,UAAWh9D,EAAO26F,WAAW39B,UAAW,UAAWh9D,EAAO26F,WAAWgB,WACzJlB,EAAS3kF,SAAS9V,EAAO26F,WAAW5kF,SAAShP,QAAQ,SAAU60F,GAC7Dz7F,QAAQiI,IAAIwzF,GACZ57F,EAAO+qE,MAAQ6wB,EACf57F,EAAOmN,SAAU,IAChB/M,MAAM,SAAU4N,GACjBhO,EAAOmN,SAAU,SAGpBpN,WAAW,uCAAA,SAAA,iBAAA,WAAA,OAAA,cAAA,YAAuC,SAAUC,EAAQwjB,EAAgBugE,EAAU9gF,EAAMm6C,EAAaplC,GAClHhY,EAAOiD,KAAOA,EACdjD,EAAOo9C,YAAcA,EACrBp9C,EAAO67F,YAAc,GACrB77F,EAAO87F,eAAgB,EACvB97F,EAAOgY,UAAYA,EACnBhY,EAAOggF,QAAU,GACjBhgF,EAAO+7F,OACLz6F,KAAM,GACN06F,WAAY,GACZ1rF,SAAU,IAEZtQ,EAAO8oB,OAAO,cAAe,WACA,aAAvB9oB,EAAO67F,YACT77F,EAAO87F,eAAgB,EAEvB97F,EAAO87F,eAAgB,IAI3B97F,EAAO2oC,GAAK,WACV3oC,EAAOggF,QAAU,EACPhgF,GAAOo9C,YAAYz1C,GAI7B,IAHA3H,EAAO0D,IAAM,EACb1D,EAAOi8F,iBAEFj8F,EAAO+7F,MAAMC,WAAW/zE,QAA7B,CACA,GAAI0yE,IACF93D,EAAG7iC,EAAO+7F,MAAMz6F,KAChBmsD,EAAGztD,EAAO+7F,MAAMC,WAAW5B,SAC3BllF,EAAGlV,EAAO0D,IACViS,EAAG3V,EAAOi8F,cAAclsF,OACxB9I,EAAGjH,EAAO+7F,MAAMzrF,SAElByzE,GAASrzE,OAAOiqF,EAAY,SAAU13F,GAChCA,EAAK3B,KACPtB,EAAOggF,QAAU,cAEjBx8D,EAAeyC,MAAMhjB,OAK3BjD,EAAOogF,aAAe,WAcpB,QAA0C,gBAA1BpgF,GAAO+7F,MAAMzrF,UAAyBtQ,EAAO+7F,MAAMz6F,KAAKqC,QAA6C,gBAA5B3D,GAAO+7F,MAAMC,aAGxGh8F,EAAOiM,OAAS,SAAUtE,GACxB6b,EAAeyC,OACbte,IAAKA,QAGR+f,UAAU,gBAAiB,WAC5B,OACEC,SAAU,IACVC,OACEs0E,WAAY,IACZC,QAAS,IACTC,QAAS,KAEXtxF,YAAa,qEACb/K,YAAA,SAAY,SAAUC,GACpBA,EAAOq8F,aAAc,EAErBr8F,EAAOs8F,WAAa,WAClB,GAAKt8F,EAAOk8F,WAAZ,CACAl8F,EAAOq8F,aAAc,CACrB,IAIIE,GAJA73D,EAAS1kC,EAAO0kC,OAChBq2D,EAAS/6F,EAAOk8F,WAEhBhuE,EAAQluB,EAAOkuB,KAGfA,IAAS6sE,EAAOp3F,QAClB+gC,EAAOxW,MAAQA,EACfquE,EAAQruE,EAAQ6sE,EAAOp3F,SAEvB+gC,EAAOxW,MAAQ6sE,EAAOp3F,OACtB44F,EAAQ,GAGV73D,EAAOtW,OAZM,GAabgB,IAAMsV,EAAOrV,WAAW,MACxBD,IAAIwX,WACJ,IAAI3jB,GAAI,CAGR,KAFAmM,IAAIyX,OAAO5jB,EAAIs5E,EAhBF,IAgBmB,GAAKxB,EAAO93E,GAAKjjB,EAAOm8F,UAAYn8F,EAAOo8F,QAAUp8F,EAAOm8F,WAErFl5E,EAAI83E,EAAOp3F,QAChBsf,IACAmM,IAAI0X,OAAO7jB,EAAIs5E,EApBJ,IAoBqB,GAAKxB,EAAO93E,GAAKjjB,EAAOm8F,UAAYn8F,EAAOo8F,QAAUp8F,EAAOm8F,UAM9F,IAHA/sE,IAAI+W,YAAc,OAClB/W,IAAI2X,SAEA/mC,EAAOm8F,SAAW,IAAM,CAM1B,IAJA/sE,IAAIwX,YACJ3jB,EAAI,EACJmM,IAAIyX,OAAO5jB,EAAIs5E,EA9BJ,IA8BqB,GAAK,EAAIv8F,EAAOm8F,UAAYn8F,EAAOo8F,QAAUp8F,EAAOm8F,WAE7El5E,EAAI83E,EAAOp3F,QAChBsf,IACAmM,IAAI0X,OAAO7jB,EAAIs5E,EAlCN,IAkCuB,GAAK,EAAIv8F,EAAOm8F,UAAYn8F,EAAOo8F,QAAUp8F,EAAOm8F,UAGtF/sE,KAAI+W,YAAc,UAClB/W,IAAI2X,SAGN/mC,EAAOq8F,aAAc,IAGvBr8F,EAAO8oB,OAAO,aAAc,WAC1B9oB,EAAOs8F,iBAGXv0E,KAAM,SAAUH,EAAOzS,GACrByS,EAAM8c,OAASvvB,EAAQyX,WAAW,GAClChF,EAAMsG,MAAQmnD,SAASlgE,EAAQmmB,IAAI,cChfzCz7B,QAAQC,OAAO,2CAA4C,cAAe,iBAAkB,WAAY,eAAgB,YAAa,aAAc,UAAW,QAAS,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACjNo1C,EAAeC,MAAM,wCACnB9vC,IAAK,UACL5H,WAAY,aACZ+K,YAAa,wDACZ2sC,MAAM,yBACP9vC,IAAK,kBACL5H,WAAY,mBACZ+K,YAAa,gEAEd/K,WAAW,cAAA,SAAA,SAAA,UAAA,gBAAA,UAAA,WAAA,WAAA,YAAA,SAAA,eAAc,SAAUC,EAAQmJ,EAAQghB,EAASm/C,EAAexmE,EAAS23F,EAAUluC,EAAUp+C,EAAWlN,EAAQD,GAC5HhB,EAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EAEjBnN,EAAOitD,YAAc,WACnBjtD,EAAO2sD,YAAc,GACrB3sD,EAAOktD,aAAc,EACrBltD,EAAO6sD,UAAY,GACnB7sD,EAAOmtD,WAAY,EACnBntD,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,GAGnBrK,EAAQE,QAAQ,SAAUC,GACxBjD,EAAOo9C,YAAcn6C,GAGvB,IAAIymE,GAAY,SAAUziE,EAAGwmD,EAAG93C,EAAGi8C,EAAGv7C,GACpC,GAAIsf,MACAg0C,EAAU,MAEF,MAARh0D,EAAE,KACJg0D,EAAU,OAGZh0C,EAAOhgB,EAAEsuB,UAAU,IAAM0lC,EACzB3pE,EAAO8pE,YAAc,GAAIR,IACvBhmE,KAAM2D,EACNa,MAAO2lD,EACPoc,QAASl0C,EACTh1B,OAAQixD,IAERniC,MAAOpZ,EACPjS,QAAS,SAAU2lE,EAAQ1oE,GACzBrB,EAAOgqE,aAAe,EACtB,IAAIC,GAAe5oE,EAAOV,SAAWwpB,EAAQ,UAAUnqB,EAAOw8F,eAAgBn7F,EAAOV,UAAYX,EAAOw8F,eACpGryB,EAAc9oE,EAAOwoE,UAAY1/C,EAAQ,WAAW8/C,EAAc5oE,EAAO+oE,WAAaH,CAC1F5oE,GAAOouB,MAAM06C,EAAYxmE,QACzBomE,EAAO3kE,QAAQ+kE,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,UAE1FqiE,EAAYxmE,OAAS,IACvB3D,EAAOgqE,aAAe,oBAGxBhqE,EAAOy8F,WAAatyB,EAAYlhE,OAAO5H,EAAOiC,OAAS,GAAKjC,EAAOyG,QAASzG,EAAOiC,OAASjC,EAAOyG,SACnG2yF,EAAS9nF,WACP1P,KAAMjD,EAAOw8F,eACbvd,SAAUj/E,EAAOy8F,WACjB7qC,EAAGvwD,EAAOV,SACViiC,EAAGvhC,EAAO+oE,UACVnjE,EAAG5F,EAAOiC,OACVmqD,EAAGpsD,EAAOyG,QACVuO,EAAG8zD,EAAYxmE,YAMvB3D,GAAO08F,WAAa,WAClBjC,EAASlqF,KAAK,SAAUtN,GACtBjD,EAAOy8F,WAAax5F,EACpBjD,EAAOw8F,eAAiBv5F,EACxBjD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,EAEblK,EAAKU,OAAS,EACX3D,EAAO8pE,YAGV9pE,EAAO8pE,YAAYxD,SAFnBoD,EAAU,EAAG,GAAI,YAAczmE,EAAKU,QAKtC3D,EAAOgqE,aAAe,qBAK5B,IAAImV,GAAYsb,EAAS7nF,UAEP,QAAdusE,EACFn/E,EAAO08F,cAEHvd,EAAUl8E,KAAKU,OAAS,GAC1B3D,EAAOy8F,WAAatd,EAAUF,SAC9Bj/E,EAAOw8F,eAAiBrd,EAAUl8E,KAClCymE,EAAUyV,EAAUl4E,EAAGk4E,EAAU1xB,EAAG0xB,EAAUv8C,EAAE,GAAIu8C,EAAUvtB,EAAGutB,EAAUF,SAASt7E,SAEpF3D,EAAOgqE,aAAe,mBAGxBhqE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,GAGnBnN,EAAO28F,YAAc,SAAUvC,EAAUwC,GACvC,IAAK57F,EAAa6C,IAAI,oCAEpB,WADA5C,GAAOb,MAAM,8CAIfJ,GAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,CACjB,IAAIghD,GAAgBhlD,EAAO0B,MACzBC,YAAa,6DACb/K,WAAY,0BACZqF,SACEw3F,WAAY,WACV,MAAOA,IAETxC,SAAU,WACR,MAAOA,IAETh9C,YAAa,WACX,MAAOp9C,GAAOo9C,eAIpB+Q,GAAcC,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,IAEnBghD,EAAcjmD,OAAO3D,KAAK,SAAUujE,GAClC,GAAIA,EAAI1nE,MACNa,EAAOb,MAAM,UAAY0nE,EAAI1nE,WACxB,CAIL,IAAK,GAHDmW,IAAS,EACTwxD,EAASloE,QAAQ8N,KAAK3N,EAAOw8F,gBAExBv5E,EAAI,EAAGA,EAAI8kD,EAAOpkE,OAAQsf,IACjC,GAAI8kD,EAAO9kD,GAAGm3E,WAAaA,EAAU,CACnC7jF,EAAQ0M,CACR,OAIA1M,GAAS,IACXvW,EAAOw8F,eAAejuE,OAAOhY,EAAO,GACpCvW,EAAO8pE,YAAYxD,SACnBrlE,EAAOmH,IAAI,mCAMnBpI,EAAOo6F,SAAW,KAClBp6F,EAAO68F,eAAiB,KAExB78F,EAAO88F,SAAW,WAChB,IAAK97F,EAAa6C,IAAI,oCAEpB,WADA5C,GAAOb,MAAM,8CAIfJ,GAAO+sD,SAAW,aAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,CACPnN,GAAOo9C,YAAYz1C,GAC7B8yF,GAAS5kF,YAAY,SAAU5S,GAC7B,GAAIkrD,GAAgBhlD,EAAO0B,MACzBC,YAAa,0DACb/K,WAAY,uBACZqF,SACEg4C,YAAa,WACX,MAAOp9C,GAAOo9C,aAEhBnF,MAAO,WAIL,MAHkBh1C,GAAKg1C,MAAMt3C,OAAO,SAAUiG,GAC5C,MAAOA,GAAKqhB,WAIhB80E,UAAW,WACT,MAAO95F,GAAK85F,aAIlB5uC,GAAcC,OAAO7pD,KAAK,WACxBvE,EAAO+sD,SAAW,GAClB/sD,EAAOgtD,UAAW,EAClBhtD,EAAOmN,SAAU,IAEnBghD,EAAcjmD,OAAO3D,KAAK,SAAU2D,GAC9BA,EAAOygC,KACT4jB,EAASc,aACTpsD,EAAOmH,IAAI,iGAGTF,EAAO9H,OACTa,EAAOb,MAAM,SAAW8H,EAAO9H,OAG7B8H,EAAOP,KACTwG,EAAU9E,KAAKnB,EAAOP,aAK7B5H,WAAW,wBAAA,SAAA,iBAAA,WAAA,UAAA,cAAA,QAAA,YAAA,SAAA,QAAwB,SAAUC,EAAQwjB,EAAgBi3E,EAAU33F,EAASs6C,EAAanF,EAAO8kD,EAAW97F,EAAQoD,GAChIrE,EAAOi4C,MAAQA,EACfj4C,EAAOo9C,YAAcA,EACrBp9C,EAAO+8F,UAAYA,EACnB/8F,EAAOggF,QAAU,GACjBhgF,EAAOiD,MACL+5F,SAAU,GACVhB,WAAY,GACZ16F,KAAM,GACN27F,iBAAkB,gBAClBC,mBAAoB,IACpBC,mBAAoB,IACpBC,mBAAoB,GACpBC,sBAAuB,GACvBC,sBAAuB,EACvBC,yBAA0B,GAE5Bl5F,EAAMC,IAAI,mBAAmByC,QAAQ,SAAUwxC,GAC7C,GAAIykD,GAAWzkD,EAAS53C,OAAO,SAAUiG,GACvC,MAAqB,mBAAdA,EAAKtF,MAEd,KAAK07F,EAASr5F,OAAQ,MAAOxD,SAAQC,MAAM,8BAC3CJ,GAAOw9F,aAAeR,EAAS,GAAG/0E,UAEpCjoB,EAAOy9F,uBAAyB,EAChCz9F,EAAO8oB,OAAO,0BAA2B,WACvC,GAAI5F,GAAMljB,EAAOiD,KAAKi6F,mBAAqBl9F,EAAOiD,KAAKm6F,kBAGrDp9F,GAAOiD,KAAKq6F,qBADVp6E,GAAO,EAC0BA,EAEA,EAGjCljB,EAAOiD,KAAKm6F,mBAAqBp9F,EAAOiD,KAAKi6F,qBAC/Cl9F,EAAOiD,KAAKm6F,mBAAqBp9F,EAAOiD,KAAKi6F,oBAG/Cl9F,EAAOy9F,uBAAyBz9F,EAAOiD,KAAKq6F,uBAE9Ct9F,EAAO09F,0BAA4B,EACnC19F,EAAO8oB,OAAO,6BAA8B,WAC1C,GAAI5F,GAAMljB,EAAOiD,KAAKk6F,mBAAqBn9F,EAAOiD,KAAKo6F,qBAGrDr9F,GAAOiD,KAAKs6F,wBADVr6E,GAAO,EAC6BA,EACK,EAEzCljB,EAAOiD,KAAKo6F,sBAAwBr9F,EAAOiD,KAAKk6F,qBAAoBn9F,EAAOiD,KAAKo6F,sBAAwBr9F,EAAOiD,KAAKk6F,oBACxHn9F,EAAO09F,0BAA4B19F,EAAOiD,KAAKs6F,0BAEjDv9F,EAAO8oB,OAAO,4BAA6B,WACrC9oB,EAAOiD,KAAKq6F,qBAAuBt9F,EAAOy9F,yBAC5Cz9F,EAAOiD,KAAKq6F,qBAAuBt9F,EAAOy9F,0BAG9Cz9F,EAAO8oB,OAAO,+BAAgC,WACxC9oB,EAAOiD,KAAKs6F,wBAA0Bv9F,EAAO09F,4BAC/C19F,EAAOiD,KAAKs6F,wBAA0Bv9F,EAAO09F,6BAGjD19F,EAAO8oB,OAAO,gBAAiB,WACA,KAAzB9oB,EAAOiD,KAAK+5F,UACdl6F,EAAQuY,wBAAwBrb,EAAOiD,KAAK+5F,SAAS9oF,WAAYlU,EAAOiD,KAAK+5F,SAAS/8E,YAAa,SAAUhd,GAC3GjD,EAAOiD,KAAKg6F,iBAAmBh6F,EAAKwsB,MACpCzvB,EAAOiD,KAAKi6F,mBAAqBj6F,EAAK+5D,QACtCh9D,EAAOiD,KAAKk6F,mBAAqBl6F,EAAK44E,WAK5C77E,EAAO29F,oBAAsB,WAC3B,QAAS39F,EAAO+8F,UAAUp5F,QAAU3D,EAAOiD,KAAK3B,KAAKqC,QAAU3D,EAAO09F,0BAA4B,GAAK19F,EAAOy9F,uBAAyB,GAAKz9F,EAAOiD,KAAKm6F,mBAAqB,GAAKp9F,EAAOiD,KAAKo6F,sBAAwB,GAAKr9F,EAAOiD,KAAKq6F,qBAAuB,GAAKt9F,EAAOiD,KAAKs6F,wBAA0B,GAAqC,gBAAzBv9F,GAAOiD,KAAK+5F,UAA2D,gBAA3Bh9F,GAAOiD,KAAK+4F,aAA4Bh8F,EAAOw9F,cAGlZx9F,EAAOiM,OAAS,SAAUtE,GACxB6b,EAAeyC,OACbte,IAAKA,KAIT3H,EAAO2oC,GAAK,WACV3oC,EAAOggF,QAAU,GACjBya,EAAS/pF,QACPmyB,EAAG7iC,EAAOiD,KAAK3B,KACf+U,EAAGrW,EAAOiD,KAAK+5F,SAASY,gBACxBnwC,EAAGztD,EAAOiD,KAAK+4F,WAAW6B,cAC1BC,GAAIzoB,SAASr1E,EAAOiD,KAAKm6F,oBACzBW,GAAI1oB,SAASr1E,EAAOiD,KAAKo6F,uBACzBW,GAAI3oB,SAASr1E,EAAOiD,KAAKq6F,sBACzBW,GAAI5oB,SAASr1E,EAAOiD,KAAKs6F,2BACxBx2F,QAAQ,SAAU9D,GACfA,EAAK3B,KACPtB,EAAOggF,QAAU,cAEjBx8D,EAAeyC,MAAMhjB,KAEtB7C,MAAM,WACPojB,EAAeyC,OACbjY,IAAK,+BAIVjO,WAAW,2BAAA,SAAA,iBAAA,WAAA,aAAA,WAAA,cAAA,SAA2B,SAAUC,EAAQwjB,EAAgBi3E,EAAUmC,EAAYxC,EAAUh9C,EAAan8C,GACtHjB,EAAO48F,WAAaA,EACpB58F,EAAOo6F,SAAWA,EAClBp6F,EAAOo9C,YAAcA,CACXp9C,GAAOo9C,YAAYz1C,GAE7B3H,GAAO2oC,GAAK,WACV8xD,EAAS/rF,OAAO0rF,EAAU,SAAUn3F,GAClCugB,EAAeyC,MAAMhjB,MAIzBjD,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAExB1lB,WAAW,iCAAA,SAAA,iBAAA,aAAA,WAAiC,SAAUC,EAAQwjB,EAAgBo5E,EAAYxC,GAC3Fp6F,EAAO48F,WAAaA,EACpB58F,EAAOo6F,SAAWA,EAElBp6F,EAAO2oC,GAAK,WACVnlB,EAAeyC,SAGjBjmB,EAAOiM,OAAS,WACduX,EAAeiC,QAAQ,cAExB1lB,WAAW,oBAAA,SAAA,WAAA,eAAA,YAAA,UAAA,WAAA,SAAA,UAAA,eAAoB,SAAUC,EAAQy6F,EAAUjxB,EAAcr7D,EAAWrL,EAASihF,EAAU9iF,EAAQ8B,EAAS/B,GACzH,GAAIk9F,IAAc,CAClBl+F,GAAOmB,IAAI,WAAY,SAAUk3C,GAC/B6lD,GAAc,EACdzD,EAAS/kF,YAAW,IAMtB,IAAIyoF,GAAa,SAAU5nF,GACzB,IAAI2nF,EAAJ,CACA,GAAI3nF,GAASvW,EAAO4rD,YAAYjoD,OAAQ,MAAO3D,GAAOo+F,gBACtD,IAAIC,GAAUr+F,EAAO4rD,YAAYr1C,EACjC8nF,GAAQpjE,KAAOl4B,EAAQsgB,OAAOg7E,EAAQpjE,KAAM,oBAC5Cw/D,EAASxnF,aAAajT,EAAO+qE,MAAM5jE,GAAIk3F,EAAQl3F,IAAIJ,QAAQ,SAAU9D,GACnE,IAAMA,EAAK+K,KAAmB,oBAAZ/K,EAAK+K,IAA4B,CACjD,GAAI+sF,GAAS93F,EAAK83F,OACduD,EAAOp9F,KAAK08B,IAAI1hB,MAAM,KAAM6+E,GAC5BwD,EAAOr9F,KAAKy8B,IAAIzhB,MAAM,KAAM6+E,EAChCsD,GAAQC,KAAOA,EACfD,EAAQtD,OAASA,EACjB/6F,EAAOw+F,OAAOzgF,KAAKugF,GACnBt+F,EAAOy+F,OAAO1gF,KAAKwgF,GAEK,MAApBF,EAAQjZ,SACNplF,EAAO0+F,YAAcJ,IACvBt+F,EAAO0+F,YAAcJ,GAEM,OAApBD,EAAQjZ,UACjBplF,EAAO2+F,UAAU5gF,KAAKugF,GAI1BH,IAAa5nF,MAKjBvW,GAAOmN,SAAU,EACjBnN,EAAO4+F,sBAAuB,EAC9B5+F,EAAO2+F,aACP3+F,EAAOw+F,UACPx+F,EAAOy+F,UACPz+F,EAAO0+F,aAAe,EACtB1+F,EAAO6+F,oBAAqB,EAC5B7+F,EAAO8+F,sBAAuB,EAC9B9+F,EAAO++F,aAAe,GACtBtE,EAAS/kF,YAAW,GACpB5S,EAAQE,QAAQ,SAAUC,GACxBjD,EAAOyY,WAAaxV,EAAKwV,aAE3BgiF,EAAS3kF,SAAS0zD,EAAazzD,SAAShP,QAAQ,SAAUgkE,GACxD/qE,EAAO+qE,MAAQA,EACf/qE,EAAOmN,QAAU,OAChB/M,MAAM,SAAU6C,EAAMyH,GACT,KAAVA,EACF1K,EAAO8pB,UAAW,EAElB7oB,EAAOgN,gBAGXwsF,EAASxkF,qBAAqBuzD,EAAazzD,QAAS,SAAU9S,GAC5D,GAAIA,EAAK+K,MAAQ/K,EAAK2oD,YAAYjoD,OAGhC,MAFA3D,GAAO8+F,sBAAuB,OAC9B9+F,EAAO6+F,oBAAqB,EAI9B7+F,GAAO4rD,YAAc3oD,EAAK2oD,YAC1BuyC,EAAW,KAGbn+F,EAAOo+F,eAAiB,WACtBp+F,EAAOmN,QAAU,KAEZnN,EAAO2+F,UAAUh7F,SACpB3D,EAAO8+F,sBAAuB,EAC9B9+F,EAAO6+F,oBAAqB,GAG9B7+F,EAAO2+F,UAAY3+F,EAAO2+F,UAAU9oE,MAGpC,KAAK,GAFDtf,GAAQ,EAEHs8B,EAAI,EAAGA,EAAI7yC,EAAO2+F,UAAUh7F,OAAQkvC,IACvC7yC,EAAO2+F,UAAU9rD,IAAM7yC,EAAO0+F,cAChCnoF,EAAQs8B,EAaZ,IARA7yC,EAAO+qE,MAAMowB,KAAOj6F,KAAK08B,IAAI1hB,MAAM,KAAMlc,EAAOw+F,QAChDx+F,EAAO+qE,MAAMmwB,KAAOh6F,KAAKy8B,IAAIzhB,MAAM,KAAMlc,EAAOy+F,QAChDz+F,EAAOg/F,mBAAqB99F,KAAK6gC,MAAgC,IAA1B/hC,EAAO2+F,UAAUpoF,IAAoB,SAEnCvU,WAA9BhC,GAAOg/F,oBAAoCC,MAAMj/F,EAAOg/F,uBACjEh/F,EAAOg/F,mBAAqB99F,KAAK6gC,MAA4B,IAAtB/hC,EAAO2+F,UAAU,IAAgB,SAGjC38F,WAA9BhC,GAAOg/F,oBAAoCC,MAAMj/F,EAAOg/F,oBACjEh/F,EAAO8+F,sBAAuB,MACzB,CAYL,IAVA,GAQI77E,GAAGi8E,EAAIC,EARPC,EAAWp/F,EAAOg/F,mBAClBK,KACAC,KACAC,KACAC,KACAC,KACAC,KACAC,EAAQ,EAGLP,EAAW,KAAQO,EAAQ,IAAI,CACpC,IAAKR,EAAK,EAAGA,EAAKn/F,EAAO4rD,YAAYjoD,OAAQw7F,IAC3Cn/F,EAAO4rD,YAAYuzC,GAAIziE,UAAY18B,EAAO4rD,YAAYuzC,GAAIb,KAAOc,EAAW,MAAQ,IAGtFp/F,GAAO4/F,eACPP,EAAgBthF,KAAKqhF,GACrBE,EAAgBvhF,KAAK/d,EAAO6/F,MAAM18E,WAClCo8E,EAAexhF,KAAK/d,EAAO6/F,MAAMC,UACjCN,EAAkBzhF,KAAK/d,EAAO6/F,MAAME,aACpCN,EAAkB1hF,KAAK/d,EAAO6/F,MAAMG,aACpCN,EAAU3hF,KAAK/d,EAAO6/F,MAAMG,YAAchgG,EAAO6/F,MAAME,YAAc//F,EAAO6/F,MAAMC,SAAW9/F,EAAO6/F,MAAM18E,WAC1Gi8E,GAAsB,KACtBO,GAAgB,EAGlB,GAAI/hE,GAAM8hE,EAAU,EAGpB,KAAKR,EAAK,EAAGA,EAAKQ,EAAU/7F,OAAQu7F,IAC9BQ,EAAUR,GAAMthE,IAClBA,EAAM8hE,EAAUR,GACPA,EAMb,KAFAthE,EAAM0hE,EAAgB,GAEjBJ,EAAK,EAAGA,EAAKI,EAAgB37F,OAAQu7F,IACpCI,EAAgBJ,IAAOthE,IACzBA,EAAM0hE,EAAgBJ,GAI1B,IAAIe,KAEJ,KAAKf,EAAK,EAAGA,EAAKI,EAAgB37F,OAAQu7F,IACpCI,EAAgBJ,IAAOthE,GACzBqiE,EAAoBliF,KAAKmhF,EAM7B,KAFAthE,EAAM4hE,EAAkBS,EAAoB,IAEvCh9E,EAAI,EAAGA,EAAIg9E,EAAoBt8F,OAAQsf,IACtCu8E,EAAkBS,EAAoBh9E,KAAO2a,IAC/CA,EAAM4hE,EAAkBS,EAAoBh9E,IAIhD,IAAIi9E,KAEJ,KAAKj9E,EAAI,EAAGA,EAAIg9E,EAAoBt8F,OAAQsf,IACtCu8E,EAAkBS,EAAoBh9E,KAAO2a,GAC/CsiE,EAAsBniF,KAAKkiF,EAAoBh9E,GAMnD,KAFA2a,EAAM2hE,EAAeW,EAAsB,IAEtCj9E,EAAI,EAAGA,EAAIi9E,EAAsBv8F,OAAQsf,IACxCs8E,EAAeW,EAAsBj9E,KAAO2a,IAC9CA,EAAM2hE,EAAeW,EAAsBj9E,IAI/C,IAAIk9E,KAEJ,KAAKl9E,EAAI,EAAGA,EAAIi9E,EAAsBv8F,OAAQsf,IACxCs8E,EAAeW,EAAsBj9E,KAAO2a,GAC9CuiE,EAAmBpiF,KAAKmiF,EAAsBj9E,GAMlD,KAFA2a,EAAM6hE,EAAkBU,EAAmB,IAEtCl9E,EAAI,EAAGA,EAAIk9E,EAAmBx8F,OAAQsf,IACrCw8E,EAAkBU,EAAmBl9E,KAAO2a,IAC9CA,EAAM6hE,EAAkBU,EAAmBl9E,IAI/C,IAAIm9E,KAEJ,KAAKn9E,EAAI,EAAGA,EAAIk9E,EAAmBx8F,OAAQsf,IACrCw8E,EAAkBU,EAAmBl9E,KAAO2a,GAC9CwiE,EAAsBriF,KAAKoiF,EAAmBl9E,GAIlD,IAAIo9E,GAAQ,CAEZ,KAAKp9E,EAAI,EAAGA,EAAIm9E,EAAsBz8F,OAAQsf,IAC5Co9E,GAAgBhB,EAAgBe,EAAsBn9E,GAYxD,KATAo9E,GAAgBD,EAAsBz8F,OACtC3D,EAAOsgG,iBAA6C,KAA1BtgG,EAAO+qE,MAAMruC,UAAmB18B,EAAO+qE,MAAMruC,UAAY2jE,EACnFrgG,EAAOg/F,mBAAqB99F,KAAK6gC,MAAc,IAARs+D,GAAmB,QAEjBr+F,WAA9BhC,GAAOg/F,qBAAoCC,MAAMj/F,EAAOg/F,qBAAwBh/F,EAAOg/F,qBAChGh/F,EAAOsgG,iBAA6C,KAA1BtgG,EAAO+qE,MAAMruC,UAAmB18B,EAAO+qE,MAAMruC,UAAY18B,EAAO2+F,UAAU,GACpG3+F,EAAOg/F,mBAAqB99F,KAAK6gC,MAA4B,IAAtB/hC,EAAO2+F,UAAU,IAAgB,KAGrEQ,EAAK,EAAGA,EAAKn/F,EAAO4rD,YAAYjoD,OAAQw7F,IAC3Cn/F,EAAO4rD,YAAYuzC,GAAIziE,UAAY18B,EAAO4rD,YAAYuzC,GAAIb,KAAOt+F,EAAOsgG,iBAAmB,MAAQ,IAGrGtgG,GAAO4/F,eACP5/F,EAAO6+F,oBAAqB,IAIhC7+F,EAAO4/F,aAAe,WACpB5/F,EAAO6/F,OACLU,KAAM,IACNC,KAAM,IACNC,KAAM,IACNC,KAAM,IACNZ,SAAU,IACV38E,UAAW,IACX48E,YAAa,IACbC,YAAa,IAOf,KAAK,GALDW,GAAc,EACdC,EAAiB,EACjBC,EAAgB,EAChBC,EAAgB,EAEX3B,EAAK,EAAGA,EAAKn/F,EAAO4rD,YAAYjoD,OAAQw7F,IACR,OAAnCn/F,EAAO4rD,YAAYuzC,GAAI/Z,SACe,OAApCplF,EAAO4rD,YAAYuzC,GAAIziE,UACzBikE,GAA4B,EAE5BG,GAAgC,EAGM,OAApC9gG,EAAO4rD,YAAYuzC,GAAIziE,UACzBkkE,GAAkC,EAElCC,GAAgC,CAKtC7gG,GAAO6/F,MAAMU,KAAOI,EACpB3gG,EAAO6/F,MAAMW,KAAOI,EACpB5gG,EAAO6/F,MAAMY,KAAOI,EACpB7gG,EAAO6/F,MAAMa,KAAOI,EACpB9gG,EAAO6/F,MAAMC,SAAW5+F,KAAK6gC,OAAO4+D,EAAcE,IAAkBF,EAAcC,EAAiBC,EAAgBC,GAAiB,KAAO,IAEvIH,EAAcC,EAAiB,IACjC5gG,EAAO6/F,MAAM18E,UAAYjiB,KAAK6gC,MAAM4+D,GAAeA,EAAcC,GAAkB,KAAO,KAGxFD,EAAcG,EAAgB,IAChC9gG,EAAO6/F,MAAME,YAAc7+F,KAAK6gC,MAAM4+D,GAAeA,EAAcG,GAAiB,KAAO,KAGzFD,EAAgBD,EAAiB,IACnC5gG,EAAO6/F,MAAMG,YAAc9+F,KAAK6gC,MAAM8+D,GAAiBA,EAAgBD,GAAkB,KAAO,MAIpG5gG,EAAO+gG,cAAgB,WACrB/gG,EAAO++F,aAAe,GACtB/+F,EAAOghG,cACPvG,EAASvkF,aAAaszD,EAAazzD,QAAS/V,EAAOsgG,kBAAkBv5F,QAAQ,WAC3E/G,EAAO++F,aAAe,kBACtB/+F,EAAO+qE,MAAMruC,UAAY18B,EAAOsgG,mBAC/BlgG,MAAM,WACPJ,EAAO++F,aAAe,4BAI1B/+F,EAAOghG,YAAc,WACnBhhG,EAAO++F,aAAe,EACtB,IAAIriC,GAASukC,WAAWjhG,EAAOkhG,SAE/B,KAAKjC,MAAMviC,IAAWA,GAAU,GAAOA,GAAU,EAAK,CACpD18D,EAAOsgG,iBAAmB5jC,CAE1B,KAAK,GAAIyiC,GAAK,EAAGA,EAAKn/F,EAAO4rD,YAAYjoD,OAAQw7F,IAC/Cn/F,EAAO4rD,YAAYuzC,GAAIziE,UAAY18B,EAAO4rD,YAAYuzC,GAAIb,KAAOt+F,EAAOsgG,iBAAmB,MAAQ,IAGrGtgG,GAAO4/F,mBAEP5/F,GAAO++F,aAAe,oCAK1B/+F,EAAOmhG,QAAU,WACfvuE,EAAE,mBAAmB0I,IAAI,YAAa,KACtC1I,EAAE,mBAAmB0I,IAAI,SAAU,MAGrCt7B,EAAOohG,OAAS,WACdxuE,EAAE,mBAAmB0I,IAAI,YAAa,KACtC1I,EAAE,mBAAmB0I,IAAI,SAAU,MAGrCt7B,EAAOqhG,SAAW,WAChB,MAAOrgG,GAAa6C,IAAI,kBAAoB7C,EAAa8C,WAG3D9D,EAAOshG,eAAiB,WAGtB,IAAK,GAFDzb,MAEK5iE,EAAI,EAAGA,EAAIjjB,EAAO4rD,YAAYjoD,OAAQsf,IAC7C4iE,EAAK9nE,MACH1B,KAAMrc,EAAO4rD,YAAY3oC,GAAG5G,KAC5B4e,KAAMj7B,EAAO4rD,YAAY3oC,GAAGgY,KAC5BhxB,KAAMjK,EAAO4rD,YAAY3oC,GAAGmiE,SAC5Bra,MAAO/qE,EAAO4rD,YAAY3oC,GAAG8nD,MAC7BruC,UAAW18B,EAAO4rD,YAAY3oC,GAAGyZ,UACjC/zB,MAAO3I,EAAOsgG,kBAIlB,OAAOza,IAGT7lF,EAAOuhG,WAAa,SAAU1Z,GAC5B7nF,EAAO6yB,SAAWg1D,EAClB7nF,EAAO4+F,sBAAuB,GAGhC5+F,EAAOwhG,2BAA6B,WAClCxhG,EAAO4+F,sBAAuB,EAC9B5+F,EAAO6yB,SAAW,MAGpB7yB,EAAOyhG,QAAU,WACf,GAAIC,GAAO,mBAAqB1hG,EAAO6yB,SAAS1rB,EAChDgH,GAAU9E,KAAKq4F,OCnrBnB7hG,QAAQC,OAAO,mDAAoD,cAAe,gBAAiB,eAAgB,iCAAkC,oBAAqB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACpNo1C,EAAeC,MAAM,gDACnB9vC,IAAK,oCACL5H,WAAY,+DACZ+K,YAAa,oEAEd/K,WAAW,kDAAA,SAAA,iCAAA,eAAA,SAAA,UAAkD,SAAUC,EAAQ2hG,EAAgCn4B,EAAcvpE,EAAQ8xC,GACtIzxC,KAAK4tE,WAAa,SAAUn9D,GAC1BzQ,KAAKyQ,UAAYA,EACjB9Q,EAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD,MACjCyP,UAAWA,IAEX9P,QAAQ,IAGNX,KAAKyQ,WACPzQ,KAAKshG,kBAITthG,KAAKyQ,UAAYy4D,EAAaz4D,UAE9BzQ,KAAKgW,SAAW,WACdhW,KAAK6M,SAAU,EACfw0F,EAA+B7wF,yBAAyBvM,KAAK,SAAUtB,GACrE3C,KAAK6M,SAAU,EACf7M,KAAKm9B,MAAQx6B,EAAKw6B,OAClBt3B,KAAK7F,QAGTA,KAAKshG,eAAiB,WACpBthG,KAAKuhG,mBAAoB,EACzB9vD,EAAQj8B,SAASxV,KAAKyQ,WAAWxM,KAAK,SAAUK,GAC9CtE,KAAKsE,QAAUA,GACfuB,KAAK7F,OACPqhG,EAA+B7wF,uBAAuBxQ,KAAKyQ,WAAWxM,KAAK,SAAUtB,GACnF3C,KAAKuhG,mBAAoB,EACzBvhG,KAAKwhG,aAAe7+F,EAAKw6B,OACzBt3B,KAAK7F,QAGTA,KAAK+6E,yBAA2B,SAAUrnD,EAAK3iB,GAC7C,MAAOswF,GAA+BxwF,eAAe6iB,EAAI5iB,oBAAqBC,IAGhF/Q,KAAKgW,WAEDhW,KAAKyQ,WACPzQ,KAAKshG,oBChDT/hG,QAAQC,OAAO,yCAA0C,cAAe,gBAAiB,eAAgB,iCAAkC,oBAAqB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GAC1Mo1C,EAAeC,MAAM,sCACnB9vC,IAAK,uBACL5H,WAAY,qDACZ+K,YAAa,0DAEd/K,WAAW,wCAAA,SAAA,iCAAA,eAAA,SAAA,QAAwC,SAAUC,EAAQ2hG,EAAgCn4B,EAAcvpE,EAAQ2tF,GAC5HttF,KAAKyhG,mBAAqBJ,EAA+BzwF,wBAEzD5Q,KAAK0hG,QAAU,SAAU/wF,GACvB3Q,KAAK2Q,OAASA,EACdhR,EAAO8kD,aAAa9kD,EAAO+kD,QAAQ1jD,MACjC2P,OAAQA,IAERhQ,QAAQ,IAGNX,KAAK2Q,QACP3Q,KAAK2hG,eAIT3hG,KAAK2Q,OAASu4D,EAAav4D,OAE3B3Q,KAAKgW,SAAW,WACdhW,KAAK6M,SAAU,EACfw0F,EAA+B3wF,eAAezM,KAAK,SAAUtB,GAC3D3C,KAAK6M,SAAU,EACf7M,KAAKm9B,MAAQx6B,EAAKw6B,MAAM98B,OAAO,SAAU8G,GACvC,QAASA,EAAK6a,WAEhBnc,KAAK7F,QAGTA,KAAK2hG,YAAc,WACjB3hG,KAAK4hG,gBAAiB,EACtBtU,EAAMvrE,aAAa/hB,KAAK2Q,QAAQ1M,KAAK,SAAU0F,GAC7C3J,KAAK2J,KAAOA,GACZ9D,KAAK7F,OACPqhG,EAA+B3wF,aAAa1Q,KAAK2Q,QAAQ1M,KAAK,SAAUtB,GACtE3C,KAAK4hG,gBAAiB,EACtB5hG,KAAK6hG,UAAYl/F,EAAKw6B,OACtBt3B,KAAK7F,QAGTA,KAAKgW,WAEDhW,KAAK2Q,QACP3Q,KAAK2hG,iBChDTpiG,QAAQC,OAAO,uCAAwC,cAAe,iCAAkC,gBAAiB,eAAgB,oBAAqB,WAAWqC,QAAA,iBAAA,qBAAO,SAAUq1C,EAAgBp1C,GACxMo1C,EAAeC,MAAM,oCACnB9vC,IAAK,YACL5H,WAAY,oDACZ+K,YAAa,wDAEd/K,WAAW,uCAAA,SAAA,iCAAA,SAAuC,SAAUC,EAAQ2hG,EAAgC1gG,GACrGX,KAAKgW,SAAW,WACdhW,KAAK6M,SAAU,EACfw0F,EAA+BpwF,cAAchN,KAAK,SAAUtB,GAC1D3C,KAAK6M,SAAU,EACf7M,KAAK8hG,iBAAmBn/F,GACxBkD,KAAK7F,QAGTA,KAAKsN,KAAO,WACVtN,KAAKo1E,QAAS,CACd,IAAIjkE,GAAWnR,KAAK8hG,iBAAiBzhG,OAAO,SAAU0hG,GACpD,MAAOA,GAAGC,mBAAqBD,EAAGE,YACjCt8F,IAAI,SAAUo8F,GACf,OACEl7F,GAAIk7F,EAAGl7F,GACPq7F,iBAAkBH,EAAGG,iBACrBF,kBAAmBD,EAAGC,kBACtBC,UAAWF,EAAGE,YAGlB,OAAOZ,GAA+BnwF,YAAYC,GAAUlN,KAAK,SAAUtB,GACzE3C,KAAKo1E,QAAS,EACdz0E,EAAOmH,IAAI,oBACXjC,KAAK7F,OAAOmK,MAAM,WAClBnK,KAAKo1E,QAAS,EACdz0E,EAAOb,MAAM,sBACb+F,KAAK7F,QAGTA,KAAKgW,cCpCPzW,QAAQC,OAAO,qCAAsC,oBAAqB,qBAAqBqC,QAAA,4BAAA,uBAAO,SAAUsgG,EAA2BC,GACzID,EAA0B9gG,KACxBiF,KAAM,wBACN+7F,aAAc,6DAEhBD,EAAqB/gG,KACnBL,KAAM,wBACN+lD,MAAO,yBACP0oC,aAAc,wBACdtzD,KAAM,qBACNlK,QAAS,8BACTxyB,WAAY,0CACZohB,SAAU,kFAEXphB,WAAW,2CAAA,YAAA,6BAAA,cAAA,WAAA,KAA2C,SAAUmyF,EAAW1rB,EAA4Bo8B,EAAaj3F,EAAU5G,GAC/H,GAAIksC,GAAO3wC,IACXA,MAAK0T,wBACL1T,KAAK4lD,QAAS,EACd5lD,KAAK6M,SACH6G,sBAAsB,GAExB1T,KAAKuiG,oBAAsB,KAC3BviG,KAAK8wF,KAAO,KACZ9wF,KAAK4wF,QAEL5wF,KAAKslD,SAAW,WACd,GAAIlpC,GAAQ3X,EAAG2X,OA8Bf,OA7BA8pD,GAA2Bp3D,SACzBmK,KAAM,mBACLhV,KAAK,SAAUyP,GAChB7T,QAAQiI,IAAI,uBAAwB4L,GACpCi9B,EAAK9jC,QAAQ6G,sBAAuB;kCACpCi9B,EAAKj9B,qBAAuBA,EAEvBi9B,EAAK6xD,4BACR7xD,EAAK6xD,0BAA4B,GAAIF,IAGvC3xD,EAAK6xD,0BAA0B5P,SAASjiD,EAAKj9B,qBAAsB,yBAEnEi9B,EAAK6xD,0BAA0B3rF,OAAS,WACtC85B,EAAK2U,YAGF3U,EAAKmgD,OACRngD,EAAKmgD,KAAOngD,EAAK6xD,0BACjB5Q,EAAUN,QAAQ3gD,EAAKmgD,OAGzB10E,EAAMtX,SAAQ,GAEV6rC,EAAK7rC,QAAQ29F,KACf9xD,EAAK7rC,QAAQ29F,IAAI39F,QAAQ6rC,EAAKj9B,wBAGlCi9B,EAAK9jC,QAAQ6G,sBAAuB,EAC7B0I,EAAME,SAGftc,KAAK8E,WAEL9E,KAAKuyF,iBAAmB,SAAU7uF,GAChC,GAAIoS,GAAI,kBAAkBvH,KAAK7K,GAC3B0Y,EAAQ3X,EAAG2X,OAEf,IAAItG,EAAG,CACL,GAAI4sF,GAAc,EAAP5sF,EAAE,GACT6sF,EAAkB,EAAP7sF,EAAE,GACb2sF,EAAMh+F,EAAG2X,OAETu0B,GAAK9jC,QAAQ6G,qBACfi9B,EAAK7rC,SACH29F,IAAKA,GAGPA,EAAI39F,QAAQ6rC,EAAKj9B,sBAGnB+uF,EAAInmF,QAAQrY,KAAK,SAAUyP,GACzB,GAAI6uF,GAAsB5xD,EAAKj9B,qBAAqBrT,OAAO,SAAUkiG,GACnE,MAAOA,GAAoB17F,IAAM67F,IAChCnuE,OAECguE,KACF5xD,EAAK4xD,oBAAsBA,EAEvBI,IACGhyD,EAAK4xD,oBAAoBxL,QAC5BpmD,EAAK4xD,oBAAoBxL,UAG3BpmD,EAAK4xD,oBAAoBxL,MAAMp4E,OAASgkF,IAI5CvmF,EAAMtX,QAAQy9F,SAGhBnmF,GAAMtX,SAGR,OAAOsX,GAAME,SAGftc,KAAK+xF,aAAe,SAAUwQ,GAC5B,MAAO,yBAA2BA,EAAoB17F,IAAM07F,EAAoBxL,OAASwL,EAAoBxL,MAAMp4E,OAAS,IAAM4jF,EAAoBxL,MAAMp4E,OAAS,QCzGzKpf,QAAQC,OAAO,yBAA0B,oBAAqB,gCAAiC,sCAAsCqC,QAAA,4BAAA,uBAAO,SAAUsgG,EAA2BC,GAC/KD,EAA0B9gG,KACxBiF,KAAM,YACN+7F,aAAc,oDCHlB9iG,QAAQC,OAAO,0BAA2B,sBAAsBqC,QAAA,4BAAA,uBAAO,SAAUsgG,EAA2BC,GAC1GD,EAA0B9gG,KACxBiF,KAAM,aACN+7F,aAAc,kDAEhBD,EAAqB/gG,KACnBL,KAAM,aACN+lD,MAAO,cACP0oC,aAAc,aACdtzD,KAAM,mBACNlK,QAAS,mBACTxyB,WAAY,iCACZohB,SAAU,4DAEXphB,WAAW,kCAAA,YAAA,gBAAA,cAAA,cAAA,UAAA,KAAkC,SAAUmyF,EAAWnjE,EAAe6zE,EAAatsD,EAAaxzC,EAASiC,GACrH,GAAIksC,GAAO3wC,IACXA,MAAK4iG,eACL5iG,KAAK4lD,QAAS,EACd5lD,KAAK6M,SACH+1F,aAAa,GAEf5iG,KAAK4e,WAAa,KAClB5e,KAAK8wF,KAAO,KACZ9wF,KAAK4wF,QAEL5wF,KAAKslD,SAAW,WACd,GAAIlpC,GAAQ3X,EAAG2X,OAiCf,OAhCAqS,GAAc3f,SACZmK,KAAM,kBACL,SAAU2pF,GACXjyD,EAAK9jC,QAAQ+1F,aAAc,EAC3BjyD,EAAKiyD,YAAcA,EACnBjyD,EAAKiyD,YAAYl8F,QAAQ,SAAUkY,GACjCo3B,EAAYn/B,OAAO+H,EAAW0tD,WAC9B1tD,EAAWikF,SAAWjkF,EAAWm6E,WAAa,aAAe,UAA4C,OAAhCn6E,EAAWi6E,iBAA4Bj6E,EAAWi6E,iBAAmBj6E,EAAWk6E,aAGtJnoD,EAAKmyD,mBACRnyD,EAAKmyD,iBAAmB,GAAIR,IAG9B3xD,EAAKmyD,iBAAiBlQ,SAASjiD,EAAKiyD,YAAa,cAEjDjyD,EAAKmyD,iBAAiBjsF,OAAS,WAC7B85B,EAAK2U,YAGF3U,EAAKmgD,OACRngD,EAAKmgD,KAAOngD,EAAKmyD,iBACjBlR,EAAUN,QAAQ3gD,EAAKmgD,OAGzB10E,EAAMtX,SAAQ,GAEV6rC,EAAK7rC,QAAQ29F,KACf9xD,EAAK7rC,QAAQ29F,IAAI39F,QAAQ6rC,EAAKiyD,eAGlCjyD,EAAK9jC,QAAQ+1F,aAAc,EACpBxmF,EAAME,SAGftc,KAAK8E,WAEL9E,KAAKuyF,iBAAmB,SAAU7uF,GAChC,GAAIoS,GAAI,kBAAkBvH,KAAK7K,GAC3B0Y,EAAQ3X,EAAG2X,OAEf,IAAItG,EAAG,CACL,GAAI4sF,GAAc,EAAP5sF,EAAE,GACT6sF,EAAkB,EAAP7sF,EAAE,GACb2sF,EAAMh+F,EAAG2X,OAETu0B,GAAK9jC,QAAQ+1F,YACfjyD,EAAK7rC,SACH29F,IAAKA,GAGPA,EAAI39F,QAAQ6rC,EAAKiyD,aAGnBH,EAAInmF,QAAQrY,KAAK,SAAU2+F,GACzB,GAAIhkF,GAAa+xB,EAAKiyD,YAAYviG,OAAO,SAAUue,GACjD,MAAOA,GAAW/X,IAAM67F,IACvBnuE,OAEC3V,KACF+xB,EAAK/xB,WAAaA,EAEd+jF,IACGhyD,EAAK/xB,WAAWm4E,QACnBpmD,EAAK/xB,WAAWm4E,UAGlBpmD,EAAK/xB,WAAWm4E,MAAMp4E,OAASgkF,IAInCvmF,EAAMtX,QAAQ8Z,SAGhBxC,GAAMtX,SAGR,OAAOsX,GAAME,SAGftc,KAAK+xF,aAAe,SAAUnzE,GAC5B,MAAO,cAAgBA,EAAW/X,IAAM+X,EAAWm4E,OAASn4E,EAAWm4E,MAAMp4E,OAAS,IAAMC,EAAWm4E,MAAMp4E,OAAS,QC5G1Hpf,QAAQC,OAAO,4CAA6CqC,QAAA,sBAAO,SAAUqxF,GAW3EA,EAAoBp+B,cAClBxuD,KAAM,mBACNzC,MAAO,GACPpE,WAAY,iDACZorB,SACEvkB,MAAO,aACP0vD,WAAW,GAEb9C,SACE7hC,SAAS,GAEXoD,SAAS,OAEVh1B,WAAW,oCAAA,SAAoC,SAAUC,OCxB5DH,QAAQC,OAAO,8CAA+CqC,QAAA,sBAAO,SAAUqxF,GAC7EA,EAAoBp+B,cAClBxuD,KAAM,qBACNzC,MAAO,GACPpE,WAAY,oDACZorB,SACEvkB,MAAO,aACP0vD,WAAW,GAEbvhC,SAAS,EACT0+D,iBAAiB,OAElB1zF,WAAW,qCAAA,SAAA,mCAAA,mBAAA,gBAAqC,SAAUC,EAAQknE,EAAkC8I,EAAkBnrE,GACvH,GAAIosC,GAAO3wC,IACX,MAAMovB,IAAU,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,YACpFuhB,GAAKoyD,YAAc,KACnBpyD,EAAKqyD,iBAAmB,KACxBryD,EAAKsyD,sBAAwB,KAC7BtyD,EAAKuyD,sBAAwB,KAC7BvyD,EAAKwyD,iBAAmB,KACxBxyD,EAAKyyD,YAAa,EAElBzyD,EAAK0yD,kBAAoB,SAAUC,EAAaz8F,EAAIyrE,IACjDgxB,EAAc3yD,EAAKoyD,YAAcpyD,EAAKqyD,kBAAkBt8F,QAAQ,SAAUS,GACzE,IAAKm8F,EAAcn8F,EAAK+L,OAAS/L,EAAK4Q,eAAiBlR,IACrDM,EAAKmrE,SAAsB,IAAZA,EAAoB,EAAI,EAEnCgxB,GAAa,CACf,KAAMrtF,GAAQrE,OAAOC,KAAK8+B,EAAK4yD,gBAAgB57B,UAAU,SAAU5Z,GACjE,MAAOnsB,QAAOmsB,KAAS5mD,EAAK+L,SAExByuB,EAAQvS,EAAOnZ,IAAUmZ,EAAO,EACtCjoB,GAAKq8F,YAAc7yD,EAAK8yD,SAAS9hE,EAAO,IACxCx6B,EAAKu8F,gBAAkB/yD,EAAK8yD,SAAS9hE,EAAO,OAK9C2hE,GACF/+F,EAAce,QAAQ,yBAA0B,OAIpDqrC,EAAK8yD,SAAW,SAAUE,EAAKrxB,GAI7B,MAAO,QAHCyC,SAAS4uB,EAAIh7F,MAAM,EAAG,GAAI,IAGb,KAFbosE,SAAS4uB,EAAIh7F,MAAM,EAAG,GAAI,IAEF,KADxBosE,SAAS4uB,EAAIh7F,MAAM,EAAG,GAAI,IACS,KAAO2pE,EAAU,KAG9D3hC,EAAKizD,iBAAmB,WACtB,OAAQjF,MAAMp6F,EAAcY,QAAQ,4BAGtCwrC,EAAKkzD,iBAAmB,WACtB,GAAItc,GAAM7nF,EAAOme,WAAsC,aAAzBne,EAAOo2D,gBAAiCp2D,EAAOme,UAAUhX,EAEvF,IAAI0gF,EAAK,CACP52C,EAAKyyD,WAAa1jG,EAAOme,UAAUk5E,OAASr3F,EAAOme,UAAUk5E,MAAM/mF,QAEnE,KACE2gC,EAAKuyD,sBAAwB3+F,EAAcY,QAAQ,0BACnDwrC,EAAKsyD,uBAAyBtE,MAAMhuD,EAAKuyD,uBACzC,MAAOtjG,IAGTgnE,EAAiC32D,MAC/BmD,OAAQm0E,EACRx6E,WAAW,IACV9I,KAAK,SAAU8+F,GACZA,IACFpyD,EAAK4yD,kBAEDR,EAAY1/F,QACd0/F,EAAYr8F,QAAQ,SAAUkR,GACvB+4B,EAAK4yD,eAAe3rF,EAAM1E,UAC7By9B,EAAK4yD,eAAe3rF,EAAM1E,SACxBA,OAAQ0E,EAAM1E,OACdlS,KAAM4W,EAAM5W,KACZwG,MAAO,EACPsI,WAAY8H,EAAM9H,WAClB2kB,UAASkc,EAAKsyD,uBAAwBrhE,OAAO+O,EAAKuyD,yBAA2BtrF,EAAM1E,SAMvFy9B,EAAK4yD,eAAe3rF,EAAM1E,QAAQ1L,OAAS,IAI/CmpC,EAAKoyD,YAAcA,EAAYp9F,IAAI,SAAUiS,GAC3C,OACExE,OAAQwE,EAAMxE,OACdqkD,GAAI7/C,EAAMo8D,SACVrc,GAAI//C,EAAMs8D,SACVxc,GAAI9/C,EAAMksF,SACVlsC,GAAIhgD,EAAMmsF,SACV7wF,OAAQ0E,EAAM1E,QAAU,KACxBggD,QAASt7C,EAAMxE,SAAWm0E,EAAM,QAAU,OAC1CjV,QAAS3hC,EAAKsyD,uBAAwBrhE,OAAO+O,EAAKuyD,yBAA2BtrF,EAAM1E,OAAS,EAAQ,KAIxGw8D,EAAiBv8D,gBACfC,OAAQ1T,EAAOme,UAAUhX,KACxB5C,KAAK,SAAU++F,GACZA,IAEFryD,EAAKwyD,oBACLH,EAAiBt8F,QAAQ,SAAUkR,GAC5B+4B,EAAKwyD,iBAAiBvrF,EAAMG,eAC/B44B,EAAKwyD,iBAAiBvrF,EAAMG,cAC1B3E,OAAQwE,EAAMy0D,aACd/Z,cAAe16C,EAAM06C,cACrBv6C,YAAaH,EAAMG,YACnBvQ,MAAO,EACPitB,SAAS,IAMbkc,EAAKwyD,iBAAiBvrF,EAAMG,aAAavQ,OAAS,IAEpDmpC,EAAKqyD,iBAAmBA,EAAiBr9F,IAAI,SAAUiS,GACrD,OACExE,OAAQwE,EAAMy0D,aACd5U,GAAI7/C,EAAMo8D,SACVrc,GAAI//C,EAAMs8D,SACVxc,GAAI9/C,EAAMkgE,cACVlgB,GAAIhgD,EAAMmgE,cACVhgE,YAAaH,EAAMG,aAAe,KAClCm7C,QAASt7C,EAAMy0D,eAAiBkb,EAAM,QAAU,OAChDjV,QAAS,aAWzB5yE,EAAO8oB,OAAO,YAAamoB,EAAKkzD,qBCjJlCtkG,QAAQC,OAAO,4CAA6CqC,QAAA,sBAAO,SAAUqxF,GAW3EA,EAAoBp+B,cAClBxuD,KAAM,mBACNzC,MAAO,GACPgnB,SACEvkB,MAAO,YAAa,cACpB0vD,WAAW,GAEb9C,SACE7hC,SAAS,GAEXoD,SAAS,OCrBbl1B,QAAQC,OAAO,4DAA6DqC,QAAA,sBAAO,SAAUqxF,GAU3FA,EAAoBp+B,cAClBxuD,KAAM,mCACNzC,MAAO,GACPpE,WAAY,mEACZorB,SACEvkB,KAAM,YACN0vD,WAAW,EACXC,KAAM,SAAU3uC,GACd,GAAIi3D,GAAKj3D,EAAMzJ,WAAayJ,EAAMzJ,UAAUk5E,OAASzvE,EAAMzJ,UAAUk5E,MAAM/mF,QAC3E,OAAOuuE,IAAMA,EAAG3/D,YAAc2/D,EAAG5/D,SAGrCqlF,cAAc,EACdvvE,SAAS,EACT0+D,iBAAiB,OAElB1zF,WAAW,4DAAA,SAAA,gBAA4D,SAAUC,EAAQ+uB,GAC1F,GAAIkiB,GAAO3wC,IACX2wC,GAAK9jC,WACL8jC,EAAKzxB,KACHle,KAAM,KACNK,IAAK,WACH,GAAI6d,GAAMlf,KAAKgB,IACfhB,MAAKgB,KAAO,KACZytB,EAAcxP,gBAAgB0xB,EAAK/xB,WAAW/X,GAAI8pC,EAAKhyB,OAAO9X,GAAI8pC,EAAKv5B,UAAUvQ,GAAIqY,EAAK,SAAUA,GAClG,GAAI+kF,GAAiB,EAAT/kF,EAAIrY,EAEX8pC,GAAKj4B,KAAKrY,OAAO,SAAU0V,GAC9B,MAAOA,GAAElP,IAAMo9F,IACd5gG,QACDstC,EAAKj4B,KAAK+E,KAAKyB,MAIrB5d,OAAQ,SAAU4d,GAChB,GAAI+kF,GAAiB,EAAT/kF,EAAIrY,EAChB4nB,GAActP,mBAAmBwxB,EAAK/xB,WAAW/X,GAAI8pC,EAAKhyB,OAAO9X,GAAI8pC,EAAKv5B,UAAUvQ,GAAIo9F,EAAO,WAC7FtzD,EAAKj4B,KAAOi4B,EAAKj4B,KAAKrY,OAAO,SAAU0V,GACrC,MAAOA,GAAElP,IAAMo9F,QAKvBvkG,EAAO8oB,OAAO,YAAa,SAAU3K,GACnC8yB,EAAKv5B,UAAY,KACjBu5B,EAAK3gC,SAAW,KAChB2gC,EAAK/xB,WAAa,KAClB+xB,EAAKhyB,OAAS,KACdgyB,EAAKj4B,KAAO,KAERmF,GAA+B,aAAlBA,EAAUvX,MAAuBuX,EAAUhX,IAAMgX,EAAUk5E,OAASl5E,EAAUk5E,MAAM/mF,UAAY6N,EAAUk5E,MAAM/mF,SAAS4O,YAAcf,EAAUk5E,MAAM/mF,SAAS2O,SAC/KgyB,EAAKv5B,UAAYyG,EACjB8yB,EAAK3gC,SAAW6N,EAAUk5E,MAAM/mF,SAChC2gC,EAAK9jC,QAAQ+R,YAAa,EAC1B+xB,EAAK9jC,QAAQ8R,QAAS,EACtBgyB,EAAK9jC,QAAQ6L,MAAO,EACpB+V,EAAczqB,IAAI2sC,EAAK3gC,SAAS4O,WAAY,SAAUA,GACpD+xB,EAAK9jC,QAAQ+R,YAAa,EAC1B+xB,EAAK/xB,WAAaA,EAClB6P,EAAc1P,UAAUH,EAAW/X,GAAI8pC,EAAK3gC,SAAS2O,OAAQ,SAAUA,GACrEgyB,EAAK9jC,QAAQ8R,QAAS,EACtBgyB,EAAKhyB,OAASA,EACd8P,EAAczP,iBAAiBJ,EAAW/X,GAAI8X,EAAO9X,GAAI8pC,EAAKv5B,UAAUvQ,GAAI,SAAU6R,GACpFi4B,EAAK9jC,QAAQ6L,MAAO,EACpBi4B,EAAKj4B,KAAOA,cC1ExBnZ,QAAQC,OAAO,wCAAyC,8BAA+B,mCAAmCqC,QAAA,sBAAO,SAAUqxF,GAWzIA,EAAoBp+B,cAClBxuD,KAAM,kBACNzC,MAAO,GACPpE,WAAY,oDACZorB,SACEvkB,MAAO,yBACP0vD,WAAW,GAEbvhC,SAAS,EACT0+D,iBAAiB,OAElB1zF,WAAW,uCAAA,SAAuC,SAAUC,OCtB/DH,QAAQC,OAAO,oCAAqC,wCAAyC,6CCA7FD,QAAQC,OAAO,mCAAoC,kBAAmB,gDAAgDqC,QAAA,sBAAO,SAAUqxF,GAUrIA,EAAoBp+B,cAClBxuD,KAAM,kBACNzC,MAAO,GACPpE,WAAY,qDACZorB,SACEvkB,KAAM,YACN0vD,WAAW,GAEbvhC,SAAS,EACT0+D,iBAAiB,OAElB1zF,WAAW,wCAAA,SAAA,SAAA,YAAA,UAAwC,SAAUC,EAAQmJ,EAAQgF,EAAWpL,GACzFzC,KAAKo+C,QAAU,SAAUU,GACvBp/C,EAAOu+C,aAAaG,QAAQU,GAAM76C,KAAK,WACrC,GAAI66C,GAAOp/C,EAAOu+C,aAAaa,IAC/Bp/C,GAAOgE,SAASm7D,cACd/f,KAAMA,GAAQ,EAAIA,MAAOp9C,QAK/B1B,KAAKkkG,YAAc,WACjB,MAAKxkG,GAAOme,UACLne,EAAOme,UAAUqmF,YADM,MAIhClkG,KAAKu0E,oBAAsB,WACpB70E,EAAOme,WAIZhV,EAAO0B,MACLC,YAAa,gEACb/K,WAAY,6CACZipC,KAAM,KACN5jC,SACEnC,KAAM,WACJ,OACEyU,UAAW1X,EAAOme,UAClBxd,OAAQX,EAAOu+C,aAAa0S,iBAIjC/oD,OAAO3D,KAAKvE,EAAOu+C,aAAa0T,mBAAmB9rD,KAAKnG,EAAOu+C,eAAeh6C,KAAK,WACpF,GAAI5D,GAASX,EAAOu+C,aAAa0S,WACjCjxD,GAAOgE,SAASm7D,cACdx+D,OAAQA,EAASA,EAAOg9B,IAAM,IAAMh9B,EAAOi9B,QAAM57B,WAItDjC,WAAW,8CAAA,SAAA,iBAAA,OAA8C,SAAUC,EAAQwjB,EAAgBvgB,GAC5FjD,EAAO0X,UAAYzU,EAAKyU,UACxB1X,EAAOiiE,SAAWh/D,EAAKyU,UAAU4/E,YAAc,EAC/Ct3F,EAAOu1E,qBAAsB,EAE7Bv1E,EAAOW,OAASsC,EAAKtC,OAASd,QAAQ8N,KAAK1K,EAAKtC,SAC9Cg9B,IAAK,EACLC,IAAK59B,EAAOiiE,UAGdjiE,EAAOw1E,cAAgB,WACrBhyD,EAAeyC,SAGjBjmB,EAAOy1E,aAAe,WACpBjyD,EAAeyC,MAAMjmB,EAAOW,YC3EhCd,QAAQC,OAAO,4CAA6CqC,QAAA,sBAAO,SAAUqxF,GAW3EA,EAAoBp+B,cAClBxuD,KAAM,mBACNzC,MAAO,GACPpE,WAAY,4DACZorB,SACEvkB,KAAM,YACN0vD,WAAW,GAEbvhC,SAAS,OAEVh1B,WAAW,yCAAA,SAAA,oBAAA,mCAAyC,SAAUC,EAAQovD,EAAmB8X,GAC1F,GAAIj2B,GAAO3wC,IACX2wC,GAAKwzD,gBAAkB,KACvBxzD,EAAKyzD,YAAa,EAElBzzD,EAAK0zD,kBAAoB,SAAUC,EAASC,EAAUC,GACpD,MAAOF,GAAUC,EAAW,IAAMC,GAGpC7zD,EAAKshB,YAAc,SAAUz9C,GAC3BA,EAAI08C,eAAiB18C,EAAI08C,eAG3BvgB,EAAK8zD,aAAe,SAAUjwF,GAG5B,MAFAm8B,GAAKyzD,YAAa,EAEd5vF,EAAIu/D,OACCnN,EAAiCt2D,YACtClB,KAAMoF,EAAIu/D,UACT9vE,KAAK,WACN0sC,EAAKyhB,WAAW59C,GAChBA,EAAIxT,KAAO,KAED8tD,EAAkBp6C,aAAaF,EAAI1D,oBAAqB0D,EAAIkwF,wBAAyB,MAAMzgG,KAAK,WAC5G0sC,EAAKyhB,WAAW59C,GAChBA,EAAI0+C,QAAU,UAIlBviB,EAAKyhB,WAAa,SAAU59C,GAC1Bm8B,EAAKyzD,YAAa,EAClB5vF,EAAI08C,eAAgB,GAGtBvgB,EAAKg0D,qBAAuB,WAC1B,GAAIpd,GAAM7nF,EAAOme,WAAsC,aAAzBne,EAAOo2D,gBAAiCp2D,EAAOme,UAAUhX,EAEnF0gF,IACFz4B,EAAkB7+C,MAChBmD,OAAQm0E,EACR/b,UAAW,IACVvnE,KAAK,SAAU+N,GAChB2+B,EAAKwzD,gBAAkBnyF,EAAKrM,IAAI,SAAU6O,GACxC,OACEpB,OAAQoB,EAAI63D,aACZv7D,oBAAqB0D,EAAI1D,oBACzB4zF,wBAAyBlwF,EAAIkwF,wBAC7B1jG,KAAMwT,EAAI4E,aAAe,IAAM5E,EAAIqzC,cACnC4P,GAAIjjD,EAAIijD,GACRE,GAAInjD,EAAImjD,GACRD,GAAIljD,EAAIkjD,GACRE,GAAIpjD,EAAIojD,GACR1E,QAAS1+C,EAAI63D,eAAiBkb,EAAM,QAAU,OAC9Cr2B,eAAe,KAIfxxD,EAAOme,WAAane,EAAOme,UAAU+mF,gBAAkBllG,EAAOme,UAAU+mF,eAAevhG,SACzFstC,EAAKwzD,gBAAkBxzD,EAAKwzD,gBAAgB3/C,OAAO9kD,EAAOme,UAAU+mF,oBAM5EllG,EAAO8oB,OAAO,YAAamoB,EAAKg0D,yBCrFlCplG,QAAQC,OAAO,8CAA+C,sBAAuB,iBAAkB,WAAWqC,QAAA,6BAAO,SAAUgjG,GACjIA,EAA2BxjG,KACzBiF,KAAM,UACNw+F,YAAY,EACZ9nB,WACE+nB,WAAY,wDACZC,UAAW,uDAEbhgF,QACEigF,sBAAuB,SAAUC,EAAOlkF,EAAWmkF,GAC7CD,EAAMn9E,MACR/G,EAAU+G,MAAQm9E,EAAMn9E,MAAMlhB,IAE9Bs+F,EAAKp9E,MAAQ,iCACbo9E,EAAK39F,WAIX/H,WAAY,oDAEbA,WAAW,oDAAA,SAAA,WAAA,iBAAA,qBAAA,qBAAA,eAAA,SAAoD,SAAUC,EAAQ2L,EAAUyyB,EAAgBy4B,EAAoBsO,EAAoBnkE,EAAcC,GAClK,GAAIgwC,GAAO3wC,IACX2wC,GAAKrqC,KAAO,UACZqqC,EAAKy0D,QAAU7uC,EAAmB8uC,QAElC3lG,EAAOozF,UAAY,SAAUr7B,EAAIE,GAC/B,MAAkC,QAA3Bj4D,EAAOmzF,SAASp7B,EAAIE,GAAgBF,EAAKE,GAGlDj4D,EAAOmzF,SAAW,SAAUp7B,EAAIE,GAE9B,MADS/2D,MAAK08B,IAAI,EAAG18B,KAAKy8B,IAAI39B,EAAOgsC,OAAOy3B,MAAMxL,EAAI,GAAKj4D,EAAOgsC,OAAO4qB,YAAY1oC,MAAO,IAChF,GAAK,OAAS,SAG5BluB,EAAOqzF,aAAe,SAAUt7B,EAAIE,EAAID,EAAIE,GAG1C,MAAO,cAF6B,QAA3Bl4D,EAAOmzF,SAASp7B,EAAIE,GAAgB,QAAU,KAE5B,KADlBj4D,EAAOszF,iBAAiBt7B,EAAKE,GAAM,GAAG,GACR,KAGzCl4D,EAAOszF,gBAAkB,SAAU3jF,EAAG4jF,GACpC,GAAIptB,GAAKjlE,KAAK08B,IAAI,GAAK18B,KAAKy8B,IAAI39B,EAAOgsC,OAAO03B,KAAK/zD,EAAG,GAAK3P,EAAOgsC,OAAO4qB,YAAYxoC,OAAQ,IAM7F,OAJImlE,KACFptB,GAAMA,IAGA,IAAMA,EAAK,GAAK,KAG1Bl1B,EAAK20D,UAAY,SAAUC,EAAQhe,GACjC52C,EAAK40D,OAASA,EACd50D,EAAKv5B,UAAYmwE,EACjBzpD,EAAeh6B,QAAQyhG,EAAQhe,EAAK,SAAU5kF,GAC5C0I,EAAS,WACPslC,EAAK3+B,KAAOrP,OAKlBguC,EAAK8lB,OAASl3D,QAAQyL,OAAO,GAAI65D,IAC/Bz3D,MAAO,WACLpN,KAAKquC,MAAMjhC,MAAMsO,KAAK1b,MACtBA,KAAKwU,IAAM,MAEbuiD,cAAe,WACb/2D,KAAKquC,MAAM0oB,cAAcr7C,KAAK1b,MAC9BA,KAAKwU,IAAMxU,KAAKye,MAElB62E,aAAc,WACZt1F,KAAK+2D,iBAEPC,iBAAkB,SAAUuc,GAC1BvzE,KAAKquC,MAAM2oB,iBAAiBt7C,KAAK1b,KAAMuzE,EAAMlY,IAAKkY,EAAMtY,KAE1DhE,UAAW,SAAUsc,EAAO7c,GAC1B12D,KAAKquC,MAAM4oB,UAAUv7C,KAAK1b,KAAMuzE,EAAMlY,IAAKkY,EAAMtY,GAAIvE,IAEvDzwC,OAAQ,WACN,IAAKvlB,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,yDAIfg+B,GAAe3c,QAAQwvB,EAAK40D,QAC1BnuF,UAAWu5B,EAAKv5B,UAChB5C,IAAKxU,KAAKwU,KACT,SAAUgxF,GACXn6F,EAAS,WACPrL,KAAKoN,QACLujC,EAAK3+B,KAAKyL,KAAK+nF,IACf3/F,KAAK7F,QACP6F,KAAK7F,aC5FbT,QAAQC,OAAO,sCAAuC,sBAAuB,6CAA8C,aAAaqC,QAAA,sBAAO,SAAUqxF,GASvJA,EAAoBp+B,cAClBxuD,KAAM,gBACNzC,MAAO,GACPpE,WAAY,0DACZorB,SACEvkB,KAAM,YACN0vD,WAAW,GAEbvhC,SAAS,OAEVh1B,WAAW,0CAAA,SAAA,SAAA,cAAA,WAAA,iBAAA,eAAA,SAA0C,SAAUC,EAAQmJ,EAAQ6vB,EAAartB,EAAUyyB,EAAgBp9B,EAAcC,GACrI,GAAIgwC,GAAO3wC,IACX2wC,GAAKwa,KAAO,KACZxa,EAAK80D,UAAY,KACjB90D,EAAK+0D,aACL/0D,EAAKhuC,KAAO,KACZm7B,EAAehvB,QAAQ,SAAU62F,GAC/Bh1D,EAAK+0D,UAAYC,GAEZh1D,EAAKwa,MAAQw6C,GAAiBA,EAActiG,OAAS,IACxDstC,EAAKwa,KAAOw6C,EAAc,MAI9Bh1D,EAAKi1D,aAAe,WAClB,IAAKllG,EAAa6C,IAAI,wBAEpB,WADA5C,GAAOb,MAAM,qDAIf+I,GAAO0B,MACLC,YAAa,2DACb/K,WAAY,8CACXmI,OAAO3D,KAAK,SAAU4hG,GACnBA,GAAYA,EAASh/F,KACvB8pC,EAAK+0D,UAAUjoF,KAAKooF,GAEfl1D,EAAKwa,OACRxa,EAAKwa,KAAO06C,MAMpB,IAAIC,GAAgB,WAClB,GAAI36C,GAAOxa,EAAKwa,MAAQxa,EAAKwa,KAAKtkD,GAC9B4+F,EAAY90D,EAAKwa,MAAQxa,EAAKwa,KAAK7kD,KACnCihF,EAAM7nF,EAAOme,WAAsC,aAAzBne,EAAOo2D,gBAAiCp2D,EAAOme,UAAUhX,EAEvF,IAAIskD,GAAQo8B,EAAK,CACf,IAAK52C,EAAKhuC,MAAQguC,EAAKhuC,KAAK2D,MAAQm/F,EAAW,CAC7C,GAAIM,GAAYN,EAAU78F,QAAQ,eAAgB,SAAU2U,EAAGuY,EAAIC,EAAIY,GACrE,MAAOZ,GAAG3T,eAEZ2jF,GAAY,+BAAiCA,EAAY,iBACzDp1D,EAAKhuC,KAAO+1B,EAAYqtE,GACtBrmG,OAAQA,IAIZixC,EAAKhuC,KAAK2iG,UAAUn6C,EAAMo8B,IAI9B7nF,GAAO8oB,OAAO,WACZ,MAAOmoB,GAAKwa,MACX26C,GACHpmG,EAAO8oB,OAAO,YAAas9E,MAC1B1+E,UAAU,0CAAA,qBAAA,WAAA,cAAA,iBAA0C,SAAUmvC,EAAoBvqC,EAAU0M,EAAam2B,GAC1G,OACExnC,SAAU,IACVxG,SAAU,wCACVjY,SAAS,EACT6e,KAAM,SAAUH,EAAOzS,EAAS6S,GAC9BJ,EAAMkB,OAAOd,EAAMs+E,uCAAwC,SAAUP,GACnE,GAAIQ,GAAW1vC,EAAmBkvC,EAGlC,IAFA5wF,EAAQC,KAAK,iBAAkB2wF,GAE3BQ,GACEA,EAASnB,WAAY,CAEvBj2C,EADc,mDAAqD42C,EAAY,QACvD,SAAUlrC,GAChC1lD,EAAQ8X,QAAQD,OAAOV,EAASuuC,GAAKjzC,cAOhD7nB,WAAW,6CAAA,SAAA,iBAAA,UAAA,iBAAA,SAA6C,SAAUC,EAAQwjB,EAAgB1gB,EAASs7B,EAAgBn+B,GACpHD,EAAOiD,MACL3B,KAAM,GACNsF,KAAM,MAER5G,EAAOwmG,gBAAiB,EACxB1jG,EAAQgW,WAAW,SAAUwvC,GAC3BtoD,EAAOsoD,gBAAkBA,EACzBtoD,EAAOwmG,gBAAiB,IAE1BxmG,EAAOymG,cAAe,EACtBroE,EAAevc,SAAS,SAAU6kF,GAChC1mG,EAAO0mG,WAAaA,EAEhBA,GAAmC,GAArBA,EAAW/iG,SAC3B3D,EAAOiD,KAAK2D,KAAO8/F,EAAW,GAC9B1mG,EAAOymG,cAAe,KAI1BzmG,EAAO21F,gBAAkB,WACvB11F,EAAOiC,GAAG,yBAGZlC,EAAO2oC,GAAK,WACV3oC,EAAOqhD,UAAW,EAClBrhD,EAAOuS,YACLzK,MAAO,EAET,IAAIwZ,KAEAthB,GAAOiD,KAAK3B,KACdggB,EAAUhgB,KAAOtB,EAAOiD,KAAK3B,MAE7BtB,EAAOuS,WAAWjR,KAAO,iCACzBtB,EAAOuS,WAAWzK,SAGhB9H,EAAOiD,KAAK2D,MAAQ5G,EAAOiD,KAAK2D,KAAKO,GACvCma,EAAU1a,KAAO5G,EAAOiD,KAAK2D,KAAK27E,YAElCviF,EAAOuS,WAAW3L,KAAO,iCACzB5G,EAAOuS,WAAWzK,SAGhB9H,EAAOiD,KAAKolB,MACd/G,EAAU+G,MAAQroB,EAAOiD,KAAKolB,MAAMlhB,IAEpCnH,EAAOuS,WAAW8V,MAAQ,6BAC1BroB,EAAOuS,WAAWzK,SAIY,IAA5B9H,EAAOuS,WAAWzK,MACpBs2B,EAAez8B,IAAI2f,EAAW,SAAU6kF,GACtC,GAAIA,EAAS/lG,MAAO,CAClB,GAAI+xB,GAAQg0E,EAASh0E,OAAS,OAE9B,aADAnyB,EAAOuS,WAAW4f,GAASg0E,EAAS/lG,OAItCojB,EAAeyC,MAAMkgF,KAGvBnmG,EAAOqhD,UAAW,MClKxBxhD,QAAQC,OAAO,4CAA6CqC,QAAA,sBAAO,SAAUqxF,GAQ3EA,EAAoBp+B,cAClBxuD,KAAM,mBACNzC,MAAO,GACPgnB,SACEvkB,MAAO,YAAa,cACpB0vD,WAAW,EACXC,KAAM,SAAU3uC,GACd,MAAOA,GAAMzJ,WAAayJ,EAAMzJ,UAAU24E,WAG9CtjC,SACE7hC,SAAS,GAEXoD,SAAS,OCrBbl1B,QAAQC,OAAO,iCAAkC,sBAAsBqC,QAAA,uBAAO,SAAUugG,GACtFA,EAAqB/gG,KACnBL,KAAM,MACN+lD,MAAO,aACP0oC,aAAc,YACd0B,SAAS,EACTh1D,KAAM,mBACNlK,QAAS,4BACTxyB,WAAY,sCACZohB,SAAU,0EAEXjT,QAAQ,2BAAA,gBAA2B,SAAUy4F,GAC9C,MAAOA,GAAc,6CACpBlmG,QAAQ,0BAAA,KAAA,UAAA,UAA0B,SAAUsE,EAAIjC,EAASqnB,GAC1D,GAAIinE,GAAO,SAAU/0E,EAAM4e,EAAMnpB,EAAOC,EAAQ46D,GAC9CrsE,KAAK6M,SAAU,EACf7M,KAAK+wF,aAAc,EACnB/wF,KAAK+b,KAAOA,EACZ/b,KAAK26B,KAAOA,EACZ36B,KAAKiyF,YAAc,YACnBjyF,KAAKuxF,kBAAmB,EACxBvxF,KAAKyR,OAASA,GAAU,EACxBzR,KAAKwR,MAAQA,EACbxR,KAAKulB,MAAQ,WACbvlB,KAAKwH,MAAQ,EACbxH,KAAKiQ,QACLjQ,KAAKgD,KAAO,EACZhD,KAAKqsE,aAAeA,EACpBrsE,KAAKsmG,UAAW,EA2GlB,OAxGAxV,GAAK7iF,WACH0lB,WAAY,WACV,GAAIxX,GAAI1X,EAAG2X,OAEX,OAAIpc,MAAK+wF,aACP50E,EAAErX,SAAQ,GAKLqX,EAAEG,SAHAtc,KAAKumG,YAKhB/U,gBAAiB,SAAUnlB,GACzBrsE,KAAKqsE,aAAeA,GAEtB3yD,cAAe,SAAUlI,EAAOC,EAAQ46D,GACtC,GAAIlwD,GAAI1X,EAAG2X,OACXpc,MAAKwR,MAAQA,EAAOxR,KAAKyR,OAASA,CAClC,IAAIsK,GAAO/b,KAAK+b,KACZ4e,EAAO36B,KAAK26B,KACZt4B,GAAO,MAAQ0Z,EAAKlV,GAAI8zB,EAAKlW,cAAekW,EAAKnU,WAAa,EAAGmU,EAAKlU,WAAWhX,KAAK,KACtFS,GACF+I,KAAM,iBAmDR,YAhDqBvX,KAAjB2qE,IACFn8D,EAAKsB,MAAQA,EACbtB,EAAKuB,OAASA,OAKK/P,KAAjB2qE,IACFn8D,EAAKm8D,aAAeA,GAItBrsE,KAAK6M,SAAU,EACfrK,EAAQkX,cAAcrX,EAAK6N,EAAM,SAAU/L,GACzCA,EAAa0lB,EAAQ,WAAW1lB,EAAY,YAC5CA,EAAWuC,QAAQ,SAAU0Q,GAC3BA,EAAU8G,SAAW9G,EAAU2E,KAAMgH,OAAOktB,IAAI74B,EAAUgkC,UAAU5yC,OAAO,QAAQiH,KAAK,MACxF2H,EAAUovF,OACR5gE,KAAM,MACNjE,MAAO,UACPrF,OAAQ,EAAGllB,EAAU4/E,YAAc,KACnCxvF,MAAO,EACPg+B,KAAM,MAINrhC,GAAcA,EAAWd,OAEvBgpE,GACE9sE,QAAQknG,OAAOzmG,KAAKiQ,KAAM9L,KAC5BnE,KAAKsmG,UAAW,GAIlBtmG,KAAKiQ,QACLjQ,KAAKiQ,KAAO9L,IAEZnE,KAAKiQ,KAAKwN,KAAK7B,MAAM5b,KAAKiQ,KAAM9L,GAChCnE,KAAKgD,QAGPhD,KAAKsmG,UAAW,EAGlBtmG,KAAKwH,OAASrD,EAAWd,OACzBrD,KAAK6M,SAAU,EACfsP,EAAErX,SAAQ,IACVe,KAAK7F,OACAmc,EAAEG,SAEXiqF,SAAU,WACR,MAAIvmG,MAAKsmG,SACA7hG,EAAG2X,QAAQtX,SAAQ,GAGrB9E,KAAK0Z,cAAc1Z,KAAKwR,MAAOxR,KAAKgD,KAAOhD,KAAKwR,MAAOxR,KAAKqsE,eAErEh6C,KAAM,SAAUjb,GACd,GAAI+E,GAAI1X,EAAG2X,QACPvV,EAAKuQ,GAAaA,EAAUvQ,IAAkB,EAAZuQ,CAItC,OAHA+E,GAAErX,QAAQ9E,KAAKiQ,KAAK5P,OAAO,SAAUgX,GACnC,MAAOA,GAAExQ,IAAMA,IACd0tB,SACIpY,EAAEG,SAEX81E,SAAU,SAAUh7E,GAClBvX,QAAQiI,IAAI,sCAAuCsP,EACnD,IAAI+E,GAAI1X,EAAG2X,QACPvV,EAAKuQ,GAAaA,EAAUvQ,IAAkB,EAAZuQ,CAEtC,OADA5U,GAAQ8U,qBAAqBzQ,EAAIsV,EAAErX,SAC5BqX,EAAEG,SAEX0f,KAAM,SAAU5kB,GACd,GAAI+E,GAAI1X,EAAG2X,QACPvV,EAAKuQ,GAAaA,EAAUvQ,IAAkB,EAAZuQ,CAEtC,OADA5U,GAAQ+U,iBAAiB1Q,EAAIsV,EAAErX,SACxBqX,EAAEG,UAGNw0E,KACNrxF,WAAW,uCAAA,SAAA,YAAA,0BAAA,UAAA,WAAA,KAAA,yBAAuC,SAAUC,EAAQkyF,EAAW8U,EAAyBlkG,EAAS6I,EAAU5G,EAAIkiG,GAChI,GAAIv/F,GAAU5E,EACVmuC,EAAO3wC,IACXN,GAAOknG,YACP5mG,KAAKgc,SACLhc,KAAK2wF,OACHkW,YAAY,EACZnf,SAAU,KACVD,SAAU,KACVqf,aAAc,KACdC,eACAC,eAAgB,OAChBtgF,MAAOggF,EACPO,eAAgB,SAAU9sE,GACxB,GAAIpe,GAAO40B,EAAK50B,KACZlI,EAAUkI,GAAQA,EAAKlV,EAE3B,KAAKgN,EACH,OAAO,CAGT,IAAIxR,IAAO,MAAQwR,EAASsmB,EAAM,UAAU1qB,KAAK,KAC7Cy3F,EAAev2D,EAAKggD,MAAMjqE,MAAM1iB,IAAI3B,EAEnC6kG,GAEMA,EAAavkG,OACtBguC,EAAKggD,MAAMoW,YAAcG,EAAavkG,MAFtCguC,EAAKggD,MAAMwW,aAAa9kG,IAK5B8kG,aAAc,SAAU9kG,GACtBsuC,EAAKggD,MAAMjqE,MAAMrY,IAAIhM,GACnB+kG,UAAU,IAEZz2D,EAAK9jC,QAAQ8jF,OAAQ,EACrBnuF,EAAQoX,yBAAyBvX,EAAK,SAAUM,GAC9C0I,EAAS,WACP,GAAIg8F,KAEJ,KAAK,GAAItrF,KAAQpZ,GAAM,CACrB,GAAI2kG,GAAa3kG,EAAKoZ,EAEtB,KAAK,GAAIoe,KAAQmtE,GAAY,CAC3B,GAAIC,GAAcD,EAAWntE,EAE7B,KAAK,GAAI8rD,KAASshB,GAAa,CAC7B,GAAIC,GAAaD,EAAYthB,EAE7B,KAAK,GAAIjC,KAAOwjB,GAAY,CAC1B,GAAIC,GAAOttE,EAAO,KAAO8rD,EAAQ,GAAK,IAAM,IAAMA,EAAQ,KAAOjC,EAAM,GAAK,IAAM,IAAMA,CACxFqjB,GAAMI,IAAuB,EAAdJ,EAAMI,IAAaD,EAAWxjB,MAMrDrzC,EAAKggD,MAAMjqE,MAAM1iB,IAAI3B,GAAKM,KAAO0kG,MACjC12D,EAAKggD,MAAMoW,YAAcM,EACzB12D,EAAK9jC,QAAQ8jF,OAAQ,OAI3B+W,iBAAkB,SAAU3rF,EAAM5L,GAChC,GAAI0D,GAAUkI,GAAQA,EAAKlV,EAEtBgN,IAILrR,EAAQoX,yBAAyB,MAAQ/F,EAAS,SAAUlR,GAC1D0I,EAAS,WACP,GAAIixB,IACFgB,KAAK,EAAA,EACLD,IAAK,EAAA,EACL71B,MAAO,EAGT,KAAK,GAAIuU,KAAQpZ,GAAM,CACrB,GAAI2kG,GAAa3kG,EAAKoZ,EAEtB,KAAK,GAAIoe,KAAQmtE,GACfhrE,EAAM90B,QACN80B,EAAMe,IAAMz8B,KAAKy8B,IAAIlD,EAAMmC,EAAMe,KACjCf,EAAMgB,IAAM18B,KAAK08B,IAAInD,EAAMmC,EAAMgB,KAIhChB,EAAM90B,QACT80B,EAAMgB,IAAMhB,EAAMe,KAAM,GAAIp1B,OAAOwc,eAGrCksB,EAAKggD,MAAMlJ,SAAW,GAAIx/E,MAAKq0B,EAAMe,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,GACzDsT,EAAKggD,MAAMjJ,SAAW,GAAIz/E,MAAKq0B,EAAMgB,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,KAC9DqT,EAAK9jC,QAAQ8jF,OAAQ,EACrBxgF,EAASmsB,QAIf8qE,UAAU,EACVp7F,cAEFhM,KAAK6M,SACHmP,OAAO,EACP20E,OAAO,EACPgX,SAAS,GAEX3nG,KAAK4wF,QACL5wF,KAAK+b,KAAO,KACZ/b,KAAK26B,KAAO,KACZ36B,KAAK8wF,KAAO,KACZpxF,EAAO8R,MAAQ,GAEfxR,KAAKslD,SAAW,WACd,GAAIlpC,GAAQ3X,EAAG2X,OAaf,OAZAu0B,GAAK9jC,QAAQmP,OAAQ,EACrB5U,EAAQmR,UACN/Q,OAAO,EACPy5C,MAAM,GACL,SAAUjlC,GACX20B,EAAK30B,MAAQA,EACb20B,EAAK9jC,QAAQmP,OAAQ,EACrB3Q,EAAS,WACPslC,EAAKiV,QAAS,EACdxpC,EAAMtX,QAAQkX,OAGXI,EAAME,SAGftc,KAAK8xF,WAAa,WAChB,GAAI11E,GAAQ3X,EAAG2X,OAGf,OAFAA,GAAMtX,UACN6rC,EAAKiV,QAAS,EACPxpC,EAAME,SAIftc,KAAKmyF,YAAc,SAAU/6E,GAC3B,GAAIA,EAAW,CACb,GAAIwwF,GAAiB,GAAI3/F,MAAKmP,EAAUgkC,UACpCysD,EAAU,GAAI5/F,MAAK2/F,EAAe1/F,UAAiD,GAArC0/F,EAAeE,oBAA2B,IAC5Fn3D,GAAKigD,MACH70E,KAAM40B,EAAK30B,MAAM3b,OAAO,SAAUgV,GAChC,MAAOA,GAAErU,MAAQoW,EAAU2E,OAC1Bg1B,MACHpW,KAAM,GAAI1yB,MAAK4/F,EAAQpjF,cAAeojF,EAAQrhF,WAAYqhF,EAAQphF,UAAW,EAAG,EAAG,EAAG,IAGpFkqB,EAAK50B,MAAQ40B,EAAKigD,KAAK70E,KACzB40B,EAAKo3D,SAASp3D,EAAKigD,KAAK70E,MACf40B,EAAKhW,MAAQgW,EAAKigD,KAAKj2D,KAChCgW,EAAKq3D,SAASr3D,EAAKigD,KAAKj2D,MAExBi3D,EAAUN,QAAQ2W,OAKxBjoG,KAAKuyF,iBAAmB,SAAU7uF,GAChC,GAAI0Y,GAAQ3X,EAAG2X,OAEf,IAAI1Y,EAAU,CACZ,GAAIwkG,GAAa,8BAA8B35F,KAAK7K,EAEpD,IAAIwkG,EAAY,CACd,GAAInsF,GAAuB,EAAhBmsF,EAAW,GAClBv2F,EAAQu2F,EAAW,EAEvB,IAAInsF,EAAM,CACR,GAAI1Z,GAAM,MAAQ0Z,GAAQpK,EAAQ,IAAMA,EAAQ,GAChDnP,GAAQkX,cAAcrX,EAAK,SAAU8B,GACnCiY,EAAMtX,QAAQX,GAAcA,EAAW4sC,QACvClrC,KAAK7F,WAEPoc,GAAMtX,cAGRtC,GAAQqX,gBAAgBnW,EAAU,SAAU0T,GAC1CgF,EAAMtX,QAAQsS,SAIlBgF,GAAMtX,SAGR,OAAOsX,GAAME,SAGftc,KAAK+xF,aAAe,SAAU36E,GAC5B,MAAO,OAASA,EAAUvQ,GAG5B,IAAIohG,GAAY,WACd,GAAIlsF,GAAO40B,EAAK50B,KACZ4e,EAAOgW,EAAKhW,IAWhB,OATI5e,IAAQ4e,IAENj7B,EAAO6vF,QAAQ8B,iBACjB1gD,EAAKmgD,KAAO,GAAI6V,GAAuB5qF,EAAM4e,EAAM,KAAM,KAAMiH,OAAOliC,EAAO6vF,QAAQ8B,mBAErF1gD,EAAKmgD,KAAO,GAAI6V,GAAuB5qF,EAAM4e,EAAMj7B,EAAO8R,QAIvDm/B,EAAKmgD,KAGdpxF,GAAOsjD,SAAW,SAAUx2C,EAAQksB,GAClCh5B,EAAOu4B,cAAgBS,EAAYT,aACnC,IAAIW,GAAYF,EAAYT,cAAcW,YACtCD,EAAeD,EAAYT,cAAc,GAAGU,YAIhD,IAFWC,EADSF,EAAYT,cAAcnK,SACQ,GAAf6K,EAE7B,CACR,IAAKgY,EAAKmgD,KAAM,MAChB,IAAIngD,EAAKmgD,OAA8B,IAAtBngD,EAAKmgD,KAAKjkF,QAAkB,MAC7C,IAAInN,EAAO6vF,QAAQ8B,kBAAoB3xF,EAAO6vF,QAAQ1vB,YAAa,MACnE,IAAIlvB,EAAKmgD,KAAK7gF,MAAQ0gC,EAAKmgD,KAAK7gF,KAAK5M,OAAS,EAAG,MACjDstC,GAAKmgD,KAAKyV,aAIdvmG,KAAKmoG,uBAAyB,SAAUC,GACtCpoG,KAAK2wF,MAAMmW,aAAesB,EAErBpoG,KAAK4lD,QAIV5lD,KAAK2wF,MAAMsW,eAAemB,IAG5BpoG,KAAK+nG,SAAW,SAAU/3D,GAGxB,GAFAhwC,KAAK+b,KAAOrc,EAAOknG,SAAS7qF,KAAOi0B,EAE9BhwC,KAAK4lD,OAAV,CAIA5lD,KAAKmE,cAELnE,KAAK26B,KAAO,KACZi3D,EAAUx6E,UAAY,IAEtB,IAAI+6E,GAAcnyF,KAAK4wF,MAAQ5wF,KAAK4wF,KAAKj2D,IAErCw3D,KACFnyF,KAAK4wF,KAAKj2D,KAAO,KACjB36B,KAAKgoG,SAAS7V,IAIhBnyF,KAAK2wF,MAAM+W,iBAAiB13D,EAAU,SAAUq4D,GAC9Ch9F,EAAS,WACPslC,EAAKggD,MAAMmW,aAAeuB,EAAW/qE,IACrCqT,EAAKggD,MAAMsW,eAAet2D,EAAKggD,MAAMmW,oBAK3C9mG,KAAKgoG,SAAW,SAAUrtE,GACxB,GAAKgW,EAAKiV,OAAV,CAIA5lD,KAAKsoG,cAAe,CACpB,IAAIvsF,GAAO/b,KAAK+b,IAGhB,IAFA/b,KAAK26B,KAAOj7B,EAAOknG,SAASjsE,KAAOA,EAE/B5e,GAAQ4e,EAAM,EACO,WACrB,MAAO36B,MAAK8wF,MAAQn2D,GAAQ36B,KAAK8wF,KAAKn2D,MAAQA,EAAKzyB,YAAclI,KAAK8wF,KAAKn2D,KAAKzyB,WAAa6T,EAAKlV,KAAO7G,KAAK8wF,KAAK/0E,KAAKlV,MAMxH+qF,EAAUN,QAAQ2W,KAAahkG,KAAK,WAClCvE,EAAO6vF,QAAQ8B,iBAAmB,KAClC3xF,EAAO6vF,QAAQ1vB,YAAc,OAJ/B+xB,EAAUN,QAAQ3gD,EAAKmgD,YC7Z/BvxF,QAAQC,OAAO,qCAAsC,YAAa,sBAAsBqC,QAAA,uBAAO,SAAUugG,GACvGA,EAAqB/gG,KACnBL,KAAM,WACN+lD,MAAO,aACP0oC,aAAc,YACdtzD,KAAM,aACNlK,QAAS,gCACTxyB,WAAY,0CACZohB,SAAU,kFAEX1gB,QAAQ,kBAAA,KAAA,YAAA,cAAA,UAAA,SAAA,gBAAA,UAAkB,SAAUsE,EAAIs9D,EAAWtR,EAAa83C,EAAS5oG,EAAQ4E,EAAe/B,GACjG,MAAOu/D,IACL9vB,QACEu2D,SAAU,GACVC,UAAW,GAEbz2D,YAAa,SAAUhiC,GACrBhQ,KAAK6M,SAAU,EACf7M,KAAKgQ,SAAWA,EAChBhQ,KAAKiyF,YAAc,YACnBjyF,KAAKyR,OAAS,EACdzR,KAAKwH,MAAQ,EACbxH,KAAKiQ,QACLjQ,KAAK0oG,aACL,IAAI/3D,GAAO3wC,IACXA,MAAK2oG,OAAS,GAAIJ,IAChBK,WAAY54F,EAASxI,MACrBqhG,UAAW7oG,KAAKgyC,YAAYw2D,SAC5BM,WAAY9oG,KAAKgyC,YAAYy2D,UAC7BM,mBAAmB,EACnBC,QAAS,SAAUppG,GACjB,MAAO+wC,GAAKs4D,UAAUrpG,EAAE6R,OAAQ7R,EAAE4H,WAIxCmsB,WAAY,WACV,GAAIgd,GAAO3wC,KACPmc,EAAI1X,EAAG2X,OAUX,OARIpc,MAAK+wF,YACP50E,EAAErX,SAAQ,GAEV9E,KAAK2oG,OAAOO,SAAS,GAAGjlG,KAAK,WAC3BkY,EAAErX,SAAQ,KAIV6rC,EAAK3gC,UAAiC,IAArB2gC,EAAK3gC,SAASnJ,IACjCsV,EAAErX,SAAQ,GACHqX,EAAEG,SAIJH,EAAEG,QAAQrY,KAAK,WACpBwsD,EAAY/tD,QAAQiuC,EAAK3gC,SAASnJ,GAAI,SAAUsiG,GAC9Cx4D,EAAK3gC,SAAWm5F,MAEjBllG,KAAK,WACF0sC,EAAK+3D,YACP/3D,EAAK+3D,WAAWhiG,QAAQiqC,EAAKy4D,cAAcvjG,KAAK8qC,OAItDs4D,UAAW,SAAUx3F,EAAQjK,GAC3B,GAAImpC,GAAO3wC,KACPmc,EAAI1X,EAAG2X,QACPlM,GACFuB,OAAQA,EACRD,MAAOhK,EACPyR,KAAM,iBAGR,IAAItZ,EAAOoB,OAAOk9D,SAAU,CAC1B,GAAI5M,GAAepsD,KAAKC,MAAMX,EAAcY,QAAQ,qBAEhDksD,IAAgBA,EAAarhD,UAAYqhD,EAAarhD,SAAS7L,aACjE+L,EAAK/L,WAAaktD,EAAarhD,SAAS7L,WAAW9D,OAAO,SAAUwG,EAAI8b,EAAG/N,GACzE,MAAO+N,IAAKzS,EAAKuB,QAAUkR,EAAIzS,EAAKuB,OAASvB,EAAKsB,QAEpDm/B,EAAKnpC,MAAQ6pD,EAAarhD,SAAS7L,WAAWd,QAsBlD,MAjBAstC,GAAK9jC,SAAU,EACf4jD,EAAY3sD,QAAQ6sC,EAAK3gC,SAASnJ,GAAIqJ,EAAM,SAAU/L,GACpDwsC,EAAK1gC,KAAO9L,EACZA,EAAWuC,QAAQ,SAAU0Q,GAC3BA,EAAU8G,SAAW9G,EAAU2E,KAAMgH,OAAOktB,IAAI74B,EAAUgkC,UAAU5yC,OAAO,QAAQiH,KAAK,MACxF2H,EAAUovF,OACR5gE,KAAM,MACNjE,MAAO,UACPrF,OAAQ,EAAGllB,EAAU4/E,YAAc,KACnCxvF,MAAO,EACPg+B,KAAM,IAERmL,EAAKy4D,cAAchyF,KAErBu5B,EAAK9jC,SAAU,EACfsP,EAAErX,QAAQX,KAELgY,EAAEG,SAEX8sF,cAAe,SAAUhyF,GAOvB,MANIA,KACFA,EAAU2/E,OACR/mF,SAAUhQ,KAAKgQ,WAIZoH,GAETiyF,WAAY,SAAUjyF,GACpB,GACIvQ,GAAKuQ,GAAaA,EAAUvQ,IAAkB,EAAZuQ,CAEtC,OAAO3S,GAAGK,QAAQ9E,KAAKopG,cAAcppG,KAAKiQ,MAAQjQ,KAAKiQ,KAAK5P,OAAO,SAAUgX,GAI3E,MAAOA,GAAExQ,IAAMA,IACd0tB,WAELlC,KAAM,SAAUjb,GACd,GAAIu5B,GAAO3wC,KACPmc,EAAI1X,EAAG2X,QACPvV,EAAKuQ,GAAaA,EAAUvQ,IAAkB,EAAZuQ,CActC,OAbAu5B,GAAK04D,WAAWjyF,GAAWnT,KAAK,SAAUqlG,GACpCA,EACFntF,EAAErX,QAAQwkG,GAEV74C,EAAYt5C,qBAAqBw5B,EAAK3gC,SAASnJ,GAAIA,GAAI5C,KAAK,SAAUiG,GACpE,MAAOymC,GAAKg4D,OAAOO,SAASv4D,EAAKg4D,OAAOY,SAASr/F,EAASvH,SACzDsB,KAAK,SAAUE,GAChB,MAAOwsC,GAAK04D,WAAWjyF,KACtBnT,KAAK,SAAUqlG,GAChBntF,EAAErX,QAAQwkG,OAITntF,EAAEG,SAEX81E,SAAU,SAAUh7E,GAClB,GAAIu5B,GAAO3wC,KACPmc,EAAI1X,EAAG2X,QACPvV,EAAKuQ,GAAaA,EAAUvQ,IAAkB,EAAZuQ,CAItC,OAHAq5C,GAAYn5C,qBAAqBtX,KAAKgQ,SAASnJ,GAAIA,EAAI,SAAUwQ,GAC/D8E,EAAErX,QAAQ6rC,EAAKy4D,cAAc/xF,MAExB8E,EAAEG,SAEX0f,KAAM,SAAU5kB,GACd,GAAIu5B,GAAO3wC,KACPmc,EAAI1X,EAAG2X,QACPvV,EAAKuQ,GAAaA,EAAUvQ,IAAkB,EAAZuQ,CAItC,OAHAq5C,GAAYl5C,iBAAiBvX,KAAKgQ,SAASnJ,GAAIA,EAAI,SAAUwQ,GAC3D8E,EAAErX,QAAQ6rC,EAAKy4D,cAAc/xF,MAExB8E,EAAEG,cAGZ1O,QAAQ,WAAA,YAAW,SAAUm0D,GAC9B,MAAOA,IACL/vB,YAAa,SAAUtgC,GACrB1R,KAAK8oG,WAAa,GAClB9oG,KAAKwpG,UAAY,EACjBxpG,KAAKypG,YAAY/3F,IAEnBg4F,cAAe,SAAUrhG,EAAOq8C,EAAShyC,EAAOi3F,GAC9C,OAAQthG,GACN,IAAK,QACHA,EAAQqK,CACR,MAEF,KAAK,WACHrK,EAAQq8C,EAAU,CAClB,MAEF,KAAK,OACHr8C,EAAQq8C,EAAU,CAClB,MAEF,KAAK,OACHr8C,EAAQshG,EAIZ,MAAO/oG,MAAK08B,IAAI5qB,EAAO9R,KAAKy8B,KAAKh1B,EAAOshG,KAE1CF,YAAa,SAAU/3F,GACjBA,EAAQk3F,aACV5oG,KAAK4oG,WAAal3F,EAAQk3F,YAGxBl3F,EAAQm3F,YACV7oG,KAAK6oG,UAAYn3F,EAAQm3F,WAGvBn3F,EAAQo3F,aACV9oG,KAAK8oG,WAAap3F,EAAQo3F,YAGxBp3F,EAAQ83F,YACVxpG,KAAKwpG,UAAY93F,EAAQ83F,eAGO9nG,KAA9BgQ,EAAQq3F,oBACV/oG,KAAK+oG,oBAAsBr3F,EAAQq3F,uBAGbrnG,KAApBgQ,EAAQs3F,UACVhpG,KAAKgpG,QAAUt3F,EAAQs3F,SAGzBhpG,KAAK6W,UAEP0yF,SAAU,SAAUpiG,GAClB,GAAInE,GAAOmE,EAAOnH,KAAK6oG,UAAY,CAEnC,OADAhpG,SAAQiI,IAAI,qBAAsBX,EAAMnE,GACjCA,GAETkmG,SAAU,SAAUlmG,GAWlB,GAVAhD,KAAK4pG,aAAgF,EAAjE5pG,KAAK0pG,cAAc1mG,EAAMhD,KAAK4pG,aAAc,EAAG5pG,KAAKwpG,WACxExpG,KAAK6pG,iBAAyC,IAAtB7pG,KAAK4pG,aAC7B5pG,KAAK8pG,gBAAkB9pG,KAAK4pG,eAAiB5pG,KAAKwpG,UAE9CxpG,KAAK+oG,kBACP/oG,KAAK+pG,YAAY/pG,KAAK4pG,aAAe5pG,KAAK8oG,WAAa,EAAI9oG,KAAK8oG,WAAa,GAAK9oG,KAAK8oG,YAEvF9oG,KAAK+pG,WAAW/pG,KAAK4pG,aAAe5pG,KAAK8oG,YAGvC9oG,KAAKgpG,kBAAmBrvF,UAAU,CACpC,GAAIlI,GAASzR,KAAK4pG,aAAe5pG,KAAK6oG,SACtC,OAAO7oG,MAAKgpG,SACVhmG,KAAMhD,KAAK4pG,aACXn4F,OAAQA,EACRjK,MAAO5G,KAAKy8B,IAAIr9B,KAAK6oG,UAAW7oG,KAAK4oG,WAAan3F,EAAS,OAIjEoF,OAAQ,WACN7W,KAAK6pG,iBAAmB7pG,KAAK4pG,cAAgB,EAC7C5pG,KAAKwpG,WAAaxpG,KAAK4oG,WAAa,GAAK5oG,KAAK6oG,UAAY,EAC1D7oG,KAAKgqG,gBAAkBhqG,KAAKwpG,UAAYxpG,KAAK8oG,WAAa,EAC1D9oG,KAAK8pG,gBAAkB9pG,KAAK4pG,cAAgB5pG,KAAKwpG,UACjDxpG,KAAK+pG,WAAW/pG,KAAKiqG,QAEvBF,WAAY,SAAUE,GAChBjqG,KAAK+oG,kBACP/oG,KAAKkqG,mBAAqBlqG,KAAK0pG,cAAcO,EAAOjqG,KAAKkqG,mBAAoB,EAAGlqG,KAAKgqG,iBAErFhqG,KAAKkqG,mBAAmG,EAA9ElqG,KAAK0pG,cAAcO,EAAOjqG,KAAKkqG,mBAAoB,EAAGlqG,KAAKgqG,iBAGvFhqG,KAAKmqG,uBAAyBnqG,KAAKkqG,oBAAsB,EACzDlqG,KAAKoqG,sBAAwBpqG,KAAKkqG,oBAAsBlqG,KAAKgqG,gBAC7DhqG,KAAKqqG,8BAAgCrqG,KAAKkqG,mBAAqBlqG,KAAK8oG,WAAa,EACjF9oG,KAAKsqG,6BAA+B1pG,KAAKy8B,KAAKr9B,KAAKkqG,mBAAqB,GAAKlqG,KAAK8oG,WAAa,EAAI,EAAG9oG,KAAKwpG,WAC3GxpG,KAAKiqG,QAEL,KAAK,GAAItnF,GAAI3iB,KAAKqqG,8BAA+BzqG,EAAII,KAAKsqG,6BAA8B3nF,GAAK/iB,IAAK+iB,EAChG3iB,KAAKiqG,MAAMxsF,KAAKkF,IAGpB4nF,SAAU,SAAUvnG,GAClB,MAAO,IAAKA,GAAQA,GAAQhD,KAAKwpG,gBAGpC/pG,WAAW,2CAAA,SAAA,YAAA,cAAA,KAAA,iBAAA,SAAA,gBAA2C,SAAUC,EAAQkyF,EAAWnhC,EAAahsD,EAAI+lG,EAAgB7qG,EAAQ4E,GAC7H,GAAIosC,GAAO3wC,IACXA,MAAK0X,aACL1X,KAAK4lD,QAAS,EACd5lD,KAAK6M,SACH6K,WAAW,GAEb1X,KAAKgQ,SAAW,KAChBhQ,KAAK8wF,KAAO,KACZ9wF,KAAK4wF,QAEL5wF,KAAKslD,SAAW,WAwBd,MAvBA3U,GAAK9jC,QAAQ6K,WAAY,EACzB1X,KAAKq9E,aAAe5sB,EAAY3hD,UAAU7K,KAAK,SAAUyT,GAEvD,GAAI/X,EAAOoB,OAAOk9D,SAAU,CAC1B,GAAI5M,GAAepsD,KAAKC,MAAMX,EAAcY,QAAQ,qBAEhDksD,IAAgBA,EAAarhD,UAC/B0H,EAAU+F,KAAK4zC,EAAarhD,UAIhC2gC,EAAKj5B,UAAYA,EACjBi5B,EAAK9jC,QAAQ6K,WAAY,IACxBzT,KAAK,WACN0sC,EAAKiV,QAAS,EAEVjV,EAAK7rC,QAAQ2lG,MACf95D,EAAK7rC,QAAQ2lG,IAAI3lG,QAAQ4S,iBAClBi5B,GAAK7rC,QAAQ2lG,OAErBxmG,KAAK,WACN,MAAO0sC,GAAKj5B,YAEP1X,KAAKq9E,cAGdr9E,KAAK8xF,WAAa,WAChBnhD,EAAKiV,QAAS,GAGhB5lD,KAAK8E,WAEL9E,KAAK0qG,aAAe,SAAUjjF,GACxBA,EAAK/jB,UACPkuF,EAAUpxB,aAAa/4C,EAAK/jB,WAIhC1D,KAAKuyF,iBAAmB,SAAU7uF,GAChC,GAAIoS,GAAI,kBAAkBvH,KAAK7K,EAC/B,OAAOoS,GAAIrR,EAAGK,UAAUb,KAAK,WAC3B,GAAI0mG,GAAc,EAAP70F,EAAE,GACT80F,EAAe,EAAP90F,EAAE,EACd,OAAO66B,GAAK0sC,aAAap5E,KAAK,SAAUyT,GACtC,GAAI1H,GAAW2gC,EAAKj5B,UAAUrX,OAAO,SAAU2P,GAC7C,MAAOA,GAASnJ,IAAM8jG,IACrBp2E,OAEH,IAAIvkB,EAGF,MAFA2gC,GAAK3gC,SAAWA,EAChB2gC,EAAKmgD,KAAO,GAAI0Z,GAAex6F,GACxB2gC,EAAKmgD,KAAKn9D,aAAa1vB,KAAK,WACjC,MAAO2tF,GAAUN,QAAQ3gD,EAAKmgD,QAC7B7sF,KAAK,WACN,MAAO0sC,GAAKmgD,KAAKz+D,KAAKu4E,KACrB3mG,KAAK,SAAUmT,GAChB,MAAOA,SAIV3S,EAAGK,WAGV9E,KAAK+xF,aAAe,SAAU36E,GAC5B,MAAO,aAAepX,KAAK8wF,KAAO9wF,KAAK8wF,KAAK9gF,SAASnJ,IAAMuQ,EAAY,IAAMA,EAAUvQ,GAAK,IAAM,KAGpG7G,KAAK6qG,aAAe,SAAU76F,GAC5BhQ,KAAKgQ,SAAWA,EAEX2gC,EAAKiV,SAINjV,EAAKmgD,MAAQngD,EAAKmgD,KAAK9gF,SAASnJ,IAAMmJ,EAASnJ,IACjDnH,EAAOyhE,0BAGLnxD,GAAa2gC,EAAKmgD,MAAOngD,EAAKmgD,KAAK9gF,UAAYA,IACjD2gC,EAAKmgD,KAAO,GAAI0Z,GAAex6F,IAGjC4hF,EAAUN,QAAQ3gD,EAAKmgD,KAAMngD,EAAKmgD,KAAO,YAAcngD,EAAKmgD,KAAK9gF,SAASnJ,GAAK,MAGjFnH,EAAOyhE,uBAAyB,WAC9B58D,EAAce,QAAQ,oBAAqB,MAC3Cf,EAAce,QAAQ,6BAA8B,MACpD3F,EAAOoB,OAAOk9D,SAAW,OCjX7B1+D,QAAQC,OAAO,4CAA6C,sBAAuB,WAAY,4BAA4BqC,QAAA,sBAAO,SAAUqxF,GAU1IA,EAAoBp+B,cAClBxuD,KAAM,2BACNzC,MAAO,GACPpE,WAAY,6DACZorB,SACEvkB,KAAM,aACNuvD,WAAY,aACZG,WAAW,GAEbvhC,SAAS,OAGVh1B,WAAW,gDAAA,SAAA,SAAA,YAAA,gBAAA,qBAAA,eAAA,SAAgD,SAAUC,EAAQmJ,EAAQgF,EAAW4gB,EAAeo2C,EAAoBnkE,EAAcC,GAClJ,GAAIgwC,GAAO3wC,KAEP8qG,EAAc,SAAUrsF,GAK1B,OAJmB,EAAVA,EAAKg5C,IAIF,KAHO,EAAVh5C,EAAKi5C,IAGS,KAFJ,EAAVj5C,EAAKk5C,IAEoB,KADf,EAAVl5C,EAAKm5C,IAIhBnpC,GAAcxQ,yBAAyBha,KAAK,SAAU+6E,GACpDh/E,KAAKg/E,oBAAsBA,EAAoB1hE,OAAO,SAAUC,EAAGpW,GAEjE,MADAoW,GAAEpW,EAAKkB,OAASlB,EACToW,QAET1X,KAAK7F,OACPA,KAAKiZ,MACH8xF,OAAO,EACPryF,MAAM,GAGR1Y,KAAKgrG,cAAgB,SAAUrsF,GAC7B9e,QAAQiI,IAAI,yCAA0C6W,GAElDA,EAAO3O,UACTtQ,EAAO8gE,aAAa,YAAc7hD,EAAO3O,WAI7ChQ,KAAK2R,MAAQ,SAAU8M,GAChBkyB,EAAKqlB,UAAUtpD,OAIpB+hB,EAAc/U,cAAci3B,EAAK/xB,WAAYksF,EAAYrsF,IACvDjX,MAAO,EACP40B,UAAW,GACV,SAAUz5B,GACX8b,EAAKc,EAAI5c,KAIb3C,KAAKimB,OAAS,SAAUxH,EAAMzd,GAC5B,GAAK2vC,EAAKqlB,UAAUtpD,MAIpB,MAAKhM,GAAa6C,IAAI,0BAKtBkrB,GAAcjQ,UAAUmyB,EAAK/xB,WAAYksF,EAAYrsF,IACnDzd,KAAMA,EACNo7B,UAAW,GACV,SAAUz5B,GACXguC,EAAKs6D,QAAQxtF,KAAK9a,GAClBguC,EAAKqlB,UAAUv3C,KAAO9b,QATtBhC,GAAOb,MAAM,uDAajBE,KAAKkrG,OAAS,SAAUzsF,EAAMkgC,GACvBlgC,EAAK5X,IAIVgC,EAAO0B,MACLC,YAAa,iFACb/K,WAAY,oDACZipC,KAAM,KACN5jC,SACEnC,KAAM,WACJ,OACEic,WAAY+xB,EAAK/xB,WACjBD,OAAQF,OAIb7W,OAAO3D,KAAK,SAAU0a,GACnBA,GAAUA,EAAO9X,KACnB8pC,EAAKs6D,QAAQvkG,QAAQ,SAAU2Q,EAAGw4B,GAC5Bx4B,EAAExQ,IAAM8X,EAAO9X,KACjB8pC,EAAKs6D,QAAQp7D,GAAOlxB,KAGxBgyB,EAAKqlB,UAAUv3C,KAAOE,MAK5B3e,KAAKg2D,UAAYz2D,QAAQyL,OAAO,GAAI65D,IAClCz3D,MAAO,WAGL,MAFApN,MAAKquC,MAAMjhC,MAAMsO,KAAK1b,MACtBA,KAAK2+C,QAAU,IACR3+C,MAETmrG,SAAU,SAAU1iG,EAAG4G,EAAGuZ,GACxB,GAAIrJ,GAAIqJ,EAAOhoB,KAAKgoB,KAAOhoB,KAAKkoB,MAC5BsiF,EAAK1rG,EAAOme,UAAUwe,OAAO5zB,EAAE05D,cAC/BkpC,EAAK3rG,EAAOme,UAAUwe,OAAOhtB,EAAE8yD,aACnC,QAAQ5iD,EAAE9W,EAAI2iG,GAAMA,EAAI7rF,EAAElQ,EAAIg8F,GAAMA,IAEtCr0C,iBAAkB,SAAUvuD,EAAG4G,GAE7B,MADArP,MAAKquC,MAAM2oB,iBAAiBp7C,MAAM5b,KAAMA,KAAKmrG,SAAS1iG,EAAG4G,IAClDrP,MAETi3D,UAAW,SAAUxuD,EAAG4G,GAEtB,MADArP,MAAKquC,MAAM4oB,UAAUr7C,MAAM5b,KAAMA,KAAKmrG,SAAS1iG,EAAG4G,IAC3CrP,MAETqQ,SAAU,SAAUinD,GAClBt3D,KAAKquC,MAAMh+B,SAASqL,KAAK1b,KAAMs3D,EAC/B,IAAI/3C,GAAIvf,KAAKmrG,SAASnrG,KAAKye,KAAKk5C,GAAK,GAAK33D,KAAKye,KAAKm5C,GAAK,IAAK,EAC9D53D,MAAKye,KAAKm5C,GAAKr4C,EAAE,GACjBvf,KAAKsrG,QACH7zC,GAAIz3D,KAAKye,KAAKg5C,GACdC,GAAI13D,KAAKye,KAAKi5C,GACdC,GAAIp4C,EAAE,GACNq4C,GAAIr4C,EAAE,KAGV5N,MAAO,WACLg/B,EAAKh/B,MAAM3R,KAAKye,OAElBwH,OAAQ;kBACN0qB,EAAK1qB,OAAOjmB,KAAKye,KAAMze,KAAKye,KAAKzd,OAEnCkqG,OAAQ,WACNv6D,EAAKu6D,OAAOlrG,KAAKye,KAAMze,KAAK2+C,UAE9B4sD,aAAc,WACZ56D,EAAKq6D,cAAchrG,KAAKye,OAE1BuO,OAAQ,SAAUrO,GAChB3e,KAAKye,KAAOE,EAERjf,EAAOme,WAAane,EAAOme,UAAUhX,IAAM8X,GAAUA,EAAO9X,IAC9DnH,EAAO8gE,aAAa,cAAgB9gE,EAAOme,UAAUhX,GAAK,IAAM8X,EAAO9X,IAAI,MAIjFnH,EAAO8oB,OAAO,YAAa,SAAU3K,GACnC,GAAI2tF,GAAK3tF,GAA+B,cAAlBA,EAAUvX,MAAwBuX,EAAUhX,EAE9D2kG,IACF76D,EAAK/xB,WAAa4sF,EAClB76D,EAAKqlB,UAAU5oD,QACfqhB,EAAcrP,WAAWosF,GACvBvkF,KAAM,QACL,SAAUgkF,GACXt6D,EAAKs6D,QAAUA,EAEXptF,EAAUk5E,OAASl5E,EAAUk5E,MAAMp4E,SACrCgyB,EAAKqlB,UAAUv3C,KAAOkyB,EAAKs6D,QAAQ5qG,OAAO,SAAUgX,GAClD,MAAOA,GAAExQ,IAAMgX,EAAUk5E,MAAMp4E,SAC9BoyB,UAIPJ,EAAK/xB,WAAa,OAGrBnf,WAAW,qDAAA,SAAA,iBAAA,gBAAA,OAAqD,SAAUC,EAAQwjB,EAAgBuL,EAAe9rB,GAClHjD,EAAOkf,WAAajc,EAAKic,WACzBlf,EAAOif,OAAShc,EAAKgc,OACrBjf,EAAOiD,MACLg8C,QAAS,KAGXj/C,EAAO2oC,GAAK,WACV3oC,EAAOuS,YACLzK,MAAO,EAET,IAAI09F,GAAQxlG,EAAOiD,KACfwiG,EAAOzlG,EAAOuS,WACdw5F,IAGAvG,GAAMvmD,QAAU,KAClBwmD,EAAKxmD,QAAU,uCACfwmD,EAAK39F,UACK09F,EAAMvmD,QAAUj/C,EAAOif,OAAOnX,MAAQ,GAAK,GACrD29F,EAAKxmD,QAAU,wCACfwmD,EAAK39F,SAELikG,EAAM9sD,QAAUumD,EAAMvmD,QAGxBj/C,EAAOgsG,UAAYD,EAEA,IAAftG,EAAK39F,OACPinB,EAAc/P,aAAahf,EAAOkf,WAAYlf,EAAOif,OAAO9X,GAAI4kG,EAAO,SAAU9sF,GAC/EuE,EAAeyC,MAAMhH,SCvN7Bpf,QAAQC,OAAO,yCAA0C,sBAAuB,WAAY,0BAA2B,wBAAyB,gBAAiB,iCAAkC,oCAAoCqC,QAAA,sBAAO,SAAUqxF,GAWtPA,EAAoBp+B,cAClBxuD,KAAM,wBACNzC,MAAO,GACPpE,WAAY,oDACZorB,SACEvkB,KAAM,aACNuvD,WAAY,aACZG,WAAW,GAEb9C,SACEoD,aAAa,GAEf7hC,SAAS,EACT0+D,iBAAiB,OAElB1zF,WAAW,6CAAA,SAAA,SAAA,YAAA,gBAAA,eAAA,SAA6C,SAAUC,EAAQmJ,EAAQgF,EAAW4gB,EAAe/tB,EAAcC,GAE3H8tB,EAAcxQ,yBAAyBha,KAAK,SAAU+6E,GACpDh/E,KAAKg/E,oBAAsBA,EAAoB1hE,OAAO,SAAUC,EAAGpW,GAEjE,MADAoW,GAAEpW,EAAKkB,OAASlB,EACToW,QAET1X,KAAK7F,OAEPA,KAAK2rG,kBAAoB,SAAU/sF,GACjC,IAAKle,EAAa6C,IAAI,sBAEpB,WADA5C,GAAOb,MAAM,iDAIf+I,GAAO0B,MACLC,YAAa,kFACb/K,WAAY,+EAEZqF,SACEk6E,qBAAA,gBAAqB,SAAUvwD,GAC7B,MAAOA,GAAcxQ,2BAEvBtb,KAAM,WACJ,OACEic,WAAYA,OAIjBhX,OAAO3D,KAAK,kBAGhBxE,WAAW,kEAAA,SAAA,iBAAA,gBAAA,sBAAA,OAAA,cAAA,sBAAkE,SAAUC,EAAQwjB,EAAgBuL,EAAeuwD,EAAqBr8E,EAAMqzC,EAAaxD,GACvK,GAAI5zB,GAAajc,EAAKic,UACtBlf,GAAOkf,WAAaA,EACpBlf,EAAOksG,SAAWp5D,EAAoBC,UACtC/yC,EAAOiD,MACL+rB,QAAS9P,EAAWw6E,eACpByS,WAAYjtF,EAAWi6E,kBAAoBj6E,EAAWk6E,UACtDC,aAAcn6E,EAAWm6E,WACzBjxB,mBAAoBlpD,EAAWwd,UAC/BmkD,mBAAoBvB,EAAoB1hE,OAAO,SAAUC,EAAGpW,GAC1D,MAAOoW,KAAMpW,EAAKkB,OAASuW,EAAWktF,eAAiB3kG,EAAO,OAC7D,OAELnH,KAAKg/E,oBAAsBA,EAE3Bt/E,EAAO2oC,GAAK,WACV5Z,EAAclQ,wBAAwBK,EAAW/X,IAC/Cy2B,IAAK59B,EAAOiD,KAAKkpG,WACjBn9E,QAAShvB,EAAOiD,KAAK+rB,QACrBqqE,WAAYr5F,EAAOiD,KAAKo2F,WACxBgT,UAAWrsG,EAAOiD,KAAKmlE,mBACvByY,mBAAoB7gF,EAAOiD,KAAK49E,mBAAmBl4E,OAClD,SAAUmjG,GACP5sF,EAAW/H,QACb+H,EAAW/H,OAAO20F,GAGpBx1D,EAAYn/B,OAAO+H,EAAW0tD,WAC9BppD,EAAeyC,WAInB9lB,QAAQiI,IAAIpI,MACX0nB,UAAU,sBAAA,gBAAsB,SAAUqH,GAC3C,OACEpH,SAAU,IACVxG,SAAU,uCACVyG,OACE1I,WAAY,IACZm6E,WAAY,IACZjxB,mBAAoB,IACpBkkC,uBAAwB,IACxBt9E,QAAS,IACTu9E,UAAW,KAEbrjG,SAAS,EACT6e,KAAM,SAAU/nB,EAAQivB,EAAU7D,GAChC,GAAIohF,GACAttF,EACAutF,EAEAv9E,EAAO,WACT,GAAKhQ,GAAestF,EAApB,CAIA,GAAIlO,GAAOt+F,EAAOusG,aAAertF,EAAWk6E,UACxCsT,EAAQ1sG,EAAOooE,oBAAsBpoE,EAAOooE,sBAAwB,CAExE,IAAuC,4BAAnCpoE,EAAOssG,yBAAwD,CAEjEI,GADaC,IAIf,GAAIx9E,GAAMnvB,EAAOgvB,SAEjB,IAAKG,GAAQA,EAAIxrB,OAAjB,CAIA,GAAIipG,GAAU,GAAOz9E,EAAIxrB,OAAS,GAE9Bs+B,EAAQ,SAAUzf,GACpB,GAAIS,GAAI/hB,KAAK08B,IAAI,EAAG18B,KAAKy8B,IAAInb,EAAIoqF,EAAUtO,EAAO,EAAGsO,GACrD,OAAOz9E,GAAIlM,GAGb,IAAIwpF,EAAa,CACfnO,EAAO,CACP,IAAIuO,GAAM5qE,CAEVA,GAAQ,SAAUzf,EAAGqwB,GACnB,GAAIhQ,GAAI4pE,EAAY55D,IAAM,CAC1B,OAAOg6D,GAAIrqF,EAAIqgB,IAInB,GAAI8C,GAAI6mE,EAAMt+E,MACV+L,EAAIuyE,EAAMp+E,MACda,GAAS7Z,KAAK,QAASuwB,GACvB1W,EAAS7Z,KAAK,SAAU6kB,EACxB,IAAI7K,GAAMH,EAAS,GAAGI,WAAW,KACjCD,GAAIE,UAAY2S,EAAM,GACtB7S,EAAIG,SAAS,EAAG,EAAGoW,EAAG1L,EAEtB,KAAK,GAAIhX,KAAKupF,GAAMj2F,MAAO,CACzB,GAAIyd,GAAMw4E,EAAMj2F,MAAM0M,EAEtB,KAAK,GAAI4vB,KAAK7e,GAAK,CACjB,GAAI84E,GAAO94E,EAAI6e,EAEf,IAAI65D,GAASI,EAAK,GAAI,CAGpB,IAAK,GAFDC,GAAM,EAEDC,EAAKF,EAAK,GAAIG,EAAM,EAAGC,EAAMF,EAAGrpG,OAAQspG,EAAMC,IAAOD,EACxDD,EAAGC,GAAOP,KACVK,CAIN39E,GAAIE,UAAY2S,EAAM8qE,EAAKl6D,OAE3BzjB,GAAIE,UAAY2S,EAAM6qE,EAAK,GAAIj6D,EAGjCzjB,GAAIG,SAASsjB,EAAG5Y,EAAIhX,EAAI,EAAG,EAAG,QAKhC0pF,EAAkB,WAYpB,WAX6B3qG,KAAzBwqG,EAAMW,iBACRX,EAAMW,eAAiBj7F,OAAOC,KAAKq6F,EAAMj2F,OAAOqH,OAAO,SAAUwvF,EAAQnqF,GACvE,GAAI+Q,GAAMw4E,EAAMj2F,MAAM0M,EACtB,OAAO/Q,QAAOC,KAAK6hB,GAAKpW,OAAO,SAAUwvF,EAAQv6D,GAC/C,GAAIw6D,GAAUnsG,KAAK08B,IAAI1hB,MAAMhb,KAAM8yB,EAAI6e,GAAG,KAAO,GACjD,OAAO3xC,MAAK08B,IAAIyvE,EAASD,IACxBA,IACF,GACHjtG,QAAQiI,IAAI,uBAAwBokG,EAAMW,iBAGrCX,EAAMW,eAGfntG,GAAO8oB,OAAO,eAAgB,SAAUwkF,IACtCpuF,EAAaouF,IACGv+E,EAAcrQ,SAASQ,EAAW/X,IAChDW,MAAO,IACNvD,KAAK,SAAUgpG,GAChBf,EAAQe,EACRr+E,QAGJlvB,EAAO8oB,OAAO,eAAgB,SAAU0kF,GACjCA,EAICf,EACFv9E,IAEAH,EAAcpQ,cAAcO,EAAW/X,IAAI5C,KAAK,SAAUkpG,GACxDhB,EAAcgB,EACdv+E,OARJu9E,EAAc,KACdv9E,OAYJlvB,EAAO8oB,OAAO,YAAaoG,GAC3BlvB,EAAO8oB,OAAO,uBAAwBoG,GACtClvB,EAAO8oB,OAAO,2BAA4BoG,GAC1ClvB,EAAO8oB,OAAO,cAAeoG","file":"arbimon2.min.js","sourcesContent":["angular.module('a2.admin', ['a2.directives', 'a2.admin.dashboard', 'a2.admin.projects', 'a2.admin.jobs', 'a2.directive.search-bar']).controller('AdminCtrl', function ($scope, $state) {\n  $scope.$state = $state;\n});","try {\n  angular.module(\"angularytics\"); // this throws if GA script is not loaded\n} catch (e) {\n  console.error(\"GA not available, likely adblocker\", e);\n\n  (function () {\n    angular.module('angularytics', []).provider('Angularytics', function () {\n      this.setEventHandlers = function () {};\n\n      this.$get = [function () {\n        var service = {};\n\n        service.init = function () {};\n\n        return service;\n      }];\n    }).filter('trackEvent', ['Angularytics', function () {\n      return function () {\n        return null;\n      };\n    }]);\n  })();\n}\n\nvar a2 = angular.module('a2.app', ['a2.permissions', 'templates-arbimon2', 'a2.app.dashboard', 'a2.audiodata', 'a2.visualizer', 'a2.analysis', 'a2.citizen-scientist', 'a2.jobs', 'a2.directive.sidenav-bar', 'a2.settings', 'a2.login', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    if (to.name.startsWith('visualizer')) {\n      document.getElementsByTagName('body')[0].classList.add('visualizer-page');\n    } else {\n      document.getElementsByTagName('body')[0].classList.remove('visualizer-page');\n    } // only check permissions if state have allowAccess\n\n\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (allowed === undefined) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      $state.go('dashboard');\n    } else if (allowed === false) {\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/dashboard\");\n}).controller('MainCtrl', function ($scope, $state, Project, a2UserPermit, $window) {\n  $scope.$state = $state;\n  Project.getInfo(function (data) {\n    $scope.bioAnalyticsBaseUrl = data.bioAnalyticsBaseUrl;\n    $scope.reportsEnabled = data.reports_enabled;\n  });\n\n  $scope.getUrlFor = function (page) {\n    const projectUrl = Project.getUrl();\n\n    if (page == 'citizen-scientist') {\n      return '/citizen-scientist/' + projectUrl + '/';\n    } else if (page == 'reports') {\n      return $scope.bioAnalyticsBaseUrl + '/' + projectUrl;\n    }\n  };\n\n  $scope.citizenScientistUser = a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper();\n  $scope.isAppPage = $window.location.pathname.startsWith('/project/');\n});","var a2 = angular.module('a2.cs-app', ['a2.permissions', 'templates-arbimon2', 'a2.app.dashboard', 'a2.audiodata', 'a2.visualizer', 'a2.analysis', 'a2.citizen-scientist', 'a2.directive.sidenav-bar', 'a2.settings', 'a2.login', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    // only check permissions if state have allowAccess\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (allowed === undefined) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      $state.go('citizen-scientist.patternmatching');\n    } else if (allowed === false) {\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/citizen-scientist/patternmatching/\");\n}).controller('MainCtrl', function ($scope, $state, Project) {\n  $scope.$state = $state;\n  $scope.onCitizenScientistPage = true;\n\n  $scope.getUrlFor = function (page) {\n    if (page == 'citizen-scientist') {\n      return '/citizen-scientist/' + Project.getUrl() + '/';\n    }\n  };\n});","angular.module('a2.home', ['templates-arbimon2', 'ui.bootstrap', 'a2.utils', 'a2.forms', 'a2.orders', 'a2.login', 'humane', 'angularytics', 'ui.router', 'a2.srv.local-storage', 'a2.filter.time-from-now', 'a2.directive.search-bar', 'ngSanitize']).config(function (AngularyticsProvider, $locationProvider) {\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).service('homeSummaryStatsData', function () {\n  return [{\n    title: 'projects created',\n    getData: function ($http) {\n      return $http.get('/api/project/projects-count').then(function (projects) {\n        return projects.data;\n      });\n    }\n  }, {\n    title: 'recordings uploaded',\n    getData: function ($http) {\n      return $http.get('/api/project/recordings-count').then(function (recordings) {\n        return recordings.data;\n      });\n    }\n  }, {\n    title: 'analyses performed',\n    description: 'Number of files processed by pattern matching jobs',\n    getData: function ($http) {\n      return $http.get('/api/project/jobs-count').then(function (jobs) {\n        return jobs.data;\n      });\n    }\n  }, {\n    title: 'species identified',\n    getData: function ($http) {\n      return $http.get('/api/project/recordings-species-count').then(function (species) {\n        return species.data;\n      });\n    }\n  }];\n}).controller('HomeCtrl', function ($http, $window, $localStorage, notify, a2order, a2InjectedData, $scope, $q, $injector, homeSummaryStatsData) {\n  $scope.summaryDataLoading = true;\n  $scope.list_summary_data = homeSummaryStatsData;\n  $scope.summary_data = $scope.list_summary_data.map(function () {\n    return [];\n  });\n\n  function getSummaryData(summary_item) {\n    return $q.resolve(summary_item.getData ? $injector.invoke(summary_item.getData) : []);\n  }\n\n  $q.all($scope.list_summary_data.map(getSummaryData)).then(function (allData) {\n    $scope.summaryDataLoading = false;\n    $scope.summary_data = allData;\n  }.bind(this));\n  $scope.isExplorePage = $window.location.pathname === '/';\n\n  function getProjectSelectCache() {\n    try {\n      return JSON.parse($localStorage.getItem('home.project.select.cache')) || {};\n    } catch (e) {\n      return {};\n    }\n  }\n\n  function setProjectSelectCache(psCache) {\n    try {\n      $localStorage.setItem('home.project.select.cache', JSON.stringify(psCache));\n    } catch (e) {}\n  }\n\n  this.loadProjectList = function () {\n    const isFeatured = $scope.isAnonymousGuest || $scope.isExplorePage;\n    const isMyProjects = !$scope.isAnonymousGuest && !$scope.isExplorePage;\n    var config = {\n      params: {\n        include_location: true,\n        publicTemplates: true\n      }\n    };\n\n    if (isFeatured) {\n      config.params.featured = true;\n    }\n\n    if (isMyProjects) {\n      config.params.type = 'my';\n    }\n\n    var psCache = getProjectSelectCache();\n    this.isLoading = true;\n    this.projects = [];\n    this.highlightedProjects = [];\n    $http.get('/api/user/projectlist', config).success(function (data) {\n      data.forEach(function (p) {\n        p.lastAccessed = psCache[p.id] || 0;\n        var lat = p.lat && p.lat >= -85.0511 && p.lat <= 85.0511 ? p.lat : 37.773972;\n        var lon = p.lon && p.lon >= -180 && p.lon <= 180 ? p.lon : -122.431297;\n        var zoom = p.lat && p.lon ? 5.33 : 4;\n        p.mapUrl = \"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/\" + lon + \",\" + lat + \",\" + zoom + \",0,60/274x180?access_token=\" + a2InjectedData.mapbox_access_token;\n      });\n      this.isLoading = false;\n\n      if (isFeatured) {\n        this.projects = [];\n        this.highlightedProjects = data.filter(function (item) {\n          return item.featured === 1;\n        });\n        this.highlightedProjects.forEach(function (project) {\n          project.isLoading = true;\n          $http.get('/api/project/' + project.url + '/templates/count', {\n            params: {\n              projectTemplates: true\n            }\n          }).success(function (data) {\n            project.templatesTotal = data.count || 0;\n            project.isLoading = false;\n          });\n          $http.get('/api/project/' + project.url + '/recordings/count').success(function (count) {\n            project.recCount = count;\n            project.isLoading = false;\n          });\n          $http.get('/api/project/' + project.url + '/species-count').success(function (count) {\n            project.speciesCount = count || 0;\n            project.isLoading = false;\n          });\n        });\n      } else if (isMyProjects) {\n        this.highlightedProjects = [];\n        this.projects = data;\n      }\n    }.bind(this)).error(function () {\n      this.isLoading = false;\n    }.bind(this));\n  };\n\n  this.createProject = function () {\n    var modalInstance = a2order.createProject({});\n    modalInstance.result.then(function (message) {\n      if (message) {\n        notify.log(message);\n      }\n\n      this.loadProjectList();\n    }.bind(this));\n  };\n\n  this.selectProject = function (project) {\n    if (!project.is_enabled) {\n      return;\n    }\n\n    var psCache = getProjectSelectCache();\n    psCache[project.id] = new Date().getTime();\n    setProjectSelectCache(psCache);\n    $window.location.assign(\"/project/\" + project.url + \"/\");\n  };\n\n  $scope.isAnonymousGuest = true;\n  $http.get('/api/user/info').success(function (data) {\n    $scope.isAnonymousGuest = data.isAnonymousGuest;\n    this.loadProjectList();\n  }.bind(this));\n\n  this.valueShortScale = function (value) {\n    const formattedNumber = numeral(value).format('0.0a');\n\n    const firstDecimalDigit = function (x) {\n      return x.split('.')[1].slice(0, 1);\n    };\n\n    return firstDecimalDigit(formattedNumber) === '0' ? formattedNumber.replace('.0', '') : formattedNumber;\n  };\n});","angular.module('a2.login', ['humane', 'ui.bootstrap', 'templates-arbimon2', 'g-recaptcha', 'a2.utils.google-login-button', 'a2.utils.facebook-login-button']).controller('LoginCtrl', function ($scope, $http, $window, $modal, notify) {\n  $scope.login = function () {\n    var path = '/login' + $window.location.search;\n    $http.post(path, {\n      username: $scope.username,\n      password: $scope.password,\n      captcha: $scope.captchaResp\n    }).success(function (data) {\n      if (data.error) {\n        notify.error(data.error);\n\n        if (data.captchaNeeded) {\n          $scope.showCaptcha = true;\n        }\n\n        $scope.resetCaptcha();\n        $scope.captchaResp = '';\n        return;\n      }\n\n      if (data.success) {\n        $window.location.assign(data.redirect);\n      }\n    }).error(function (error) {\n      notify.error(error || 'Something went wrong, try again later');\n    });\n  };\n\n  this.oAuthLogin = function (type, user) {\n    var oauthData;\n\n    if (type == 'google') {\n      oauthData = {\n        type: 'google',\n        token: user.getAuthResponse().id_token\n      };\n    } else if (type == 'facebook') {\n      oauthData = {\n        type: 'facebook',\n        token: user.authResponse.accessToken\n      };\n    } else {\n      return;\n    }\n\n    $http.post('/oauth-login' + $window.location.search, oauthData).then(function (response) {\n      var data = response.data;\n\n      if (data.error) {\n        notify.error(data.error);\n      } else if (data.success) {\n        $window.location.assign(data.redirect);\n      }\n    }).catch(function (response) {\n      if (response.status == 449) {\n        return this.showEnableOAuthModal(oauthData);\n      } else {\n        notify.error(response.data || 'Something went wrong, try again later');\n      }\n    }.bind(this));\n  };\n\n  this.showEnableOAuthModal = function (oauthData) {\n    var modalData = {};\n    $modal.open({\n      templateUrl: '/common/templates/authorize-enter-credentials-pop-up.html',\n      controller: function () {\n        this.title = \"User Authorization Required\";\n        this.data = modalData;\n        this.oauthType = oauthData.type;\n        this.messages = [\"Before using \" + oauthData.type + \" to sign into your account you must first allow it.\"];\n        this.authorizeMessage = \"Authorize \" + oauthData.type + \" sign-in on my account.\";\n        this.btnOk = \"Confirm\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      if (!modalData.authorized) {\n        notify.error(\"Login authorization canceled.\");\n      } else {\n        $http.post('/oauth-login' + $window.location.search, angular.extend({}, oauthData, {\n          authorize: 1,\n          username: modalData.username,\n          password: modalData.password\n        })).then(function (response) {\n          var data = response.data;\n\n          if (data.error) {\n            notify.error(data.error);\n          } else if (data.success) {\n            $window.location.assign(data.redirect);\n          }\n        }).catch(function (response) {\n          if (response.status == 449) {\n            return this.showEnableOAuthModal(oauthData);\n          } else {\n            notify.error(response.data || 'Something went wrong, try again later');\n          }\n        }.bind(this));\n      }\n    });\n  };\n}).controller('RedirectToLoginCtrl', function ($scope, $window) {\n  var redirect = $window.location.pathname + $window.location.search + $window.location.hash;\n  $scope.loginUrl = \"/login?redirect=\" + encodeURIComponent(redirect);\n});","angular.module('a2.orders', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.create-project', 'a2.orders.change-project-plan', 'a2.orders.order-summary', 'a2.orders.plan-selection', 'a2.orders.shipping-form', 'a2.orders.process-order', 'a2.orders.directives.plan-capacity', 'a2.orders.directives.tier-select' // 'ui.bootstrap',\n// 'humane',\n// 'a2.directives',\n// 'a2.services',\n]);","angular.module('a2.register', ['a2.forms', 'a2.directives', 'ui.bootstrap', 'angularytics', 'g-recaptcha', 'humane']).config(function (AngularyticsProvider) {\n  AngularyticsProvider.setEventHandlers(['Console', 'GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).controller('UserRegisterCtrl', function ($scope, $modal, $http, $timeout, $interval, notify) {\n  var captchaResp = '';\n\n  $scope.testUsername = function () {\n    $scope.usernameOk = '';\n    $scope.usernameErr = '';\n\n    if ($scope.testUserTimeout) {\n      $timeout.cancel($scope.testUserTimeout);\n    }\n\n    if ($scope.regis.username.$error.required) {\n      return;\n    } else if ($scope.regis.username.$error.pattern) {\n      $scope.usernameErr = \"Username must be at least 4 characters long \" + \"and can only contain alphanumeric characters,\" + \" dash(-), underscore(_) and dot(.).\";\n      return;\n    }\n\n    $scope.testUserTimeout = $timeout(function () {\n      $http.get('/api/login_available', {\n        params: {\n          username: $scope.user.username\n        }\n      }).success(function (data) {\n        if (data.available) {\n          $scope.usernameOk = $scope.user.username + \" is available\";\n        } else {\n          $scope.usernameErr = $scope.user.username + \" is not available\";\n        }\n      });\n    }, 1000);\n  };\n\n  $scope.testEmail = function () {\n    $scope.emailOk = '';\n    $scope.emailErr = '';\n\n    if ($scope.testEmailTimeout) {\n      $timeout.cancel($scope.testEmailTimeout);\n    }\n\n    if ($scope.regis.email.$error.required) {\n      return;\n    } else if ($scope.regis.email.$error.email) {\n      $scope.emailErr = \"Invalid email\";\n      return;\n    }\n\n    $scope.testEmailTimeout = $timeout(function () {\n      $http.get('/api/email_available', {\n        params: {\n          email: $scope.user.email\n        }\n      }).success(function (data) {\n        if (data.available) {\n          $scope.emailOk = $scope.user.email + \" is available\";\n        } else {\n          if (data.invalid) {\n            $scope.emailErr = $scope.user.email + \" is not a valid address\";\n          } else {\n            $scope.emailErr = $scope.user.email + \" is not available\";\n          }\n        }\n      });\n    }, 1000);\n  };\n\n  $scope.register = function ($event) {\n    if (!$scope.passResult.valid) {\n      notify.error($scope.passResult.msg);\n    } else if ($scope.usernameErr) {\n      notify.error($scope.usernameErr);\n    } else if ($scope.emailErr) {\n      notify.error($scope.emailErr);\n    } else if (!$scope.terms_accepted) {\n      notify.log('To register you must agree with our terms of service');\n    } else if (!$scope.captchaResp && !$scope.captchaNotNeeded) {\n      notify.log('Please complete the captcha');\n    } else {\n      $scope.loading = true;\n      $http.post('/register', {\n        user: $scope.user,\n        captcha: $scope.captchaResp,\n        newsletter: $scope.newsletter\n      }).success(function (data) {\n        $scope.loading = false;\n\n        if (data.success) {\n          $scope.completed = true;\n        }\n      }).error(function (data) {\n        $scope.loading = false;\n\n        if (data.error) {\n          $scope.resetCaptcha();\n          $scope.captchaResp = '';\n          return notify.error(data.error);\n        }\n\n        notify.error(\"something went wrong, please try again later\");\n      });\n    }\n  };\n});","angular.module('a2.reset-password', ['a2.directives', 'a2.forms', 'humane']).controller('ResetPassCtrl', function ($scope, $http, $window, notify) {\n  $scope.changePassword = function () {\n    if (!$scope.passResult.valid) {\n      notify.error($scope.passResult.msg);\n    }\n\n    var path = $window.location.pathname;\n    $http.post(path, {\n      password: $scope.password\n    }).success(function (data) {\n      $scope.completed = true;\n    });\n  };\n}).controller('ResetRequestCtrl', function ($scope, $http, notify) {\n  $scope.request = function () {\n    $scope.loading = true;\n    $http.post('/forgot_request', {\n      email: $scope.email\n    }).success(function (data) {\n      $scope.loading = false;\n\n      if (data.error) {\n        return notify.error(data.error);\n      }\n\n      $scope.requestComplete = true;\n    });\n  };\n});","angular.module('a2.user-settings', ['templates-arbimon2', 'a2.forms', 'ui.bootstrap', 'humane', 'angularytics']).config(function (AngularyticsProvider) {\n  AngularyticsProvider.setEventHandlers(['Console', 'GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).controller('UserSettingsCtrl', function ($scope, $modal, $http, notify) {\n  this.data = {};\n  $http.get('/api/user/info').then(function (response) {\n    $scope.user = response.data;\n    this.user = response.data;\n    this.reset();\n  }.bind(this));\n\n  this.reset = function () {\n    this.data = angular.copy(this.user);\n  };\n\n  this.save = function () {\n    var data = this.data;\n    return $http.post('/api/user/update', {\n      userData: {\n        name: data.name,\n        lastname: data.lastname,\n        oauth: data.oauth\n      }\n    }).then(function (response) {\n      if (response.data.error) {\n        notify.error(response.data.error);\n      } else {\n        notify.log(response.data.message);\n      }\n    }).catch(function (err) {\n      console.log(\"err\", err);\n      notify.serverError();\n    });\n  };\n});","var a2 = angular.module('a2.visualizer-app', ['a2.permissions', 'templates-arbimon2', 'a2.visualizer', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    // only check permissions if state have allowAccess\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (!allowed) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/visualizer\");\n}).controller('MainCtrl', function ($scope, $state, Project, $http, $window) {\n  $scope.$state = $state;\n\n  $scope.getUrlFor = function (page) {\n    if (page == 'visualizer') {\n      return '/visualizer/' + Project.getUrl() + '/';\n    }\n  };\n});","angular.module('a2.srv.api', []).factory('a2APIServiceClass', function ($location, $q, $http) {\n  var a2APIServiceClass = function (prefix) {\n    this.prefix = prefix;\n  };\n\n  function returnData(response) {\n    return response.data;\n  }\n\n  a2APIServiceClass.prototype = {\n    getUrl: function (apiRoute) {\n      return this.prefix + apiRoute;\n    },\n    get: function (apiRoute, params) {\n      return $q.when($http.get(this.prefix + apiRoute, params)).then(returnData);\n    },\n    post: function (apiRoute, data) {\n      return $q.when($http.post(this.prefix + apiRoute, data)).then(returnData);\n    },\n    delete: function (apiRoute, data) {\n      return $q.when($http.delete(this.prefix + apiRoute)).then(returnData);\n    },\n    put: function (apiRoute, data) {\n      return $q.when($http.put(this.prefix + apiRoute, data)).then(returnData);\n    }\n  };\n  return a2APIServiceClass;\n}).factory('a2APIService', function ($location, $q, a2APIServiceClass) {\n  var nrm = /\\/?(project|citizen-scientist|visualizer)\\/([\\w\\_\\-]+)/.exec($location.absUrl());\n  var projectName = nrm ? nrm[2] : '';\n  var apiURLPrefix = '/api/project/' + projectName;\n\n  function returnData(response) {\n    return response.data;\n  }\n\n  var a2APIService = new a2APIServiceClass(apiURLPrefix);\n  a2APIService.api = new a2APIServiceClass('/api');\n  a2APIService.project = new a2APIServiceClass('/project/' + projectName);\n\n  a2APIService.getProjectName = function () {\n    return projectName;\n  };\n\n  return a2APIService;\n});","angular.module('a2.service.audio-event-detection', ['a2.srv.api']).factory('AudioEventDetectionService', function (a2APIService) {\n  var AudioEventDetectionService = {\n    getList: function () {\n      return a2APIService.get('/audio-event-detections/');\n    },\n    getAlgorithmsList: function () {\n      return a2APIService.get('/audio-event-detections/algorithms');\n    },\n    getStatisticsList: function () {\n      return a2APIService.get('/audio-event-detections/statistics');\n    },\n    getDataStatisticsList: function () {\n      return a2APIService.get('/audio-event-detections/data/statistics');\n    },\n    getDataAggregatesList: function () {\n      return a2APIService.get('/audio-event-detections/data/aggregates');\n    },\n    getDataFor: function (aed, x, y, z) {\n      var args = [];\n      return a2APIService.get('/audio-event-detections/data/' + [aed, x.statistic, y.statistic, z.statistic].map(encodeURIComponent).join('/') + '?' + args.join('&'));\n    },\n    savePlotFor: function (aed, x, y, z) {\n      var params = {\n        x: x.statistic,\n        y: y.statistic,\n        z: z.statistic\n      };\n      return a2APIService.post('/audio-event-detections/default-plot/' + [aed].map(encodeURIComponent).join('/'), params);\n    },\n    new: function (aed) {\n      aed = aed || {};\n      var params = {\n        name: aed.name || aed.defaultName,\n        algorithm: aed.algorithm.id,\n        parameters: aed.parameters,\n        statistics: aed.statistics.map(function (statistic) {\n          return statistic.id;\n        }),\n        playlist: aed.playlist.id\n      };\n      return a2APIService.post('/audio-event-detections/new', params);\n    }\n  };\n  return AudioEventDetectionService;\n});","angular.module('a2.srv.audio-event-detections-clustering', ['a2.srv.project', 'humane']).factory('a2AudioEventDetectionsClustering', function ($http, Project, notify) {\n  return {\n    list: function (opts, callback) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    count: function () {\n      return $http.get('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/total-recordings').then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    validate: function (opts) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/validate', opts).then(function (response) {\n        return response.data;\n      });\n    },\n    unvalidate: function (opts) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/unvalidate', opts).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (jobId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/' + jobId + '/remove').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist-admin', ['a2.srv.api']).factory('a2CitizenScientistAdminService', function (a2APIService, Project, notify) {\n  return {\n    getClassificationStats: function (speciesId) {\n      return a2APIService.get('/citizen-scientist/stats/classification' + (speciesId ? '/' + speciesId : '')).catch(notify.serverError);\n    },\n    getUserStats: function (userId) {\n      return a2APIService.get('/citizen-scientist/stats/user' + (userId ? '/' + userId : '')).catch(notify.serverError);\n    },\n    getUserStatsExportUrl: function () {\n      return '/api/project/' + Project.getUrl() + '/citizen-scientist/stats/export/user-stats.csv';\n    },\n    getCSExportUrl: function (pattern_matching_id, per_user) {\n      var filename = per_user ? 'export-per-user.csv' : 'export.csv';\n      return '/api/project/' + Project.getUrl() + '/citizen-scientist/pattern-matchings/' + pattern_matching_id + '/' + filename;\n    },\n    getSettings: function () {\n      return a2APIService.get('/citizen-scientist/settings').catch(notify.serverError);\n    },\n    setSettings: function (settings) {\n      return a2APIService.post('/citizen-scientist/settings', settings).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist-expert', ['a2.srv.api']).factory('a2CitizenScientistExpertService', function (a2APIService, Project, notify) {\n  return {\n    getPatternMatchings: function () {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/expert').catch(notify.serverError);\n    },\n    getPatternMatchingDetailsFor: function (patternMatchingId) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert/details').catch(notify.serverError);\n    },\n    getPatternMatchingRoisFor: function (patternMatchingId, limit, offset, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert-rois/' + (offset || 0) + '_' + (limit || 0) + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    validatePatternMatchingRois: function (patternMatchingId, rois, validation) {\n      return a2APIService.post('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert-validate', {\n        rois: rois,\n        validation: validation\n      }).catch(notify.serverError);\n    },\n    getCSExportUrl: function (options) {\n      options = options || {};\n      return '/api/project/' + Project.getUrl() + '/citizen-scientist/pattern-matchings/' + (options.patternMatching | 0) + '/export.csv';\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist', ['a2.srv.api']).factory('a2CitizenScientistService', function (a2APIService, notify) {\n  return {\n    getMyStats: function (userId) {\n      return a2APIService.get('/citizen-scientist/stats/mine').catch(notify.serverError);\n    },\n    getPatternMatchings: function () {\n      return a2APIService.get('/citizen-scientist/pattern-matchings').catch(notify.serverError);\n    },\n    getPatternMatchingDetailsFor: function (patternMatchingId) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/details').catch(notify.serverError);\n    },\n    getPatternMatchingRoisFor: function (patternMatchingId, limit, offset) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/rois/' + (offset || 0) + '_' + (limit || 0)).catch(notify.serverError);\n    },\n    validatePatternMatchingRois: function (patternMatchingId, rois, validation) {\n      return a2APIService.post('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/validate', {\n        rois: rois,\n        validation: validation\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.classi', ['a2.srv.project', 'humane']).factory('a2Classi', function ($http, Project, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/classifications').then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetails: function (classificationId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId).success(callback).error(notify.serverError);\n    },\n    getResultDetails: function (classificationId, first, limit, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/more/' + first + '/' + limit).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getRecVector: function (classificationId, recId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/vector/' + recId);\n    },\n    create: function (classificationData, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/classifications/new', classificationData).success(callback).error(notify.serverError);\n    },\n    delete: function (classificationId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/delete').success(callback).error(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.clustering-jobs', ['a2.srv.project', 'humane']).factory('a2ClusteringJobs', function ($http, Project, notify, $httpParamSerializer) {\n  return {\n    list: function (opts) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getJobDetails: function (clusteringJobId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs/' + clusteringJobId + '/job-details').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getClusteringDetails: function (opts) {\n      var config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.job_id + '/clustering-details', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getRoisDetails: function (opts) {\n      var params = {};\n\n      if (opts.aed) {\n        params.aed = opts.aed;\n      }\n\n      if (opts.rec_id) {\n        params.rec_id = opts.rec_id;\n      }\n\n      if (opts.search && opts.search == 'per_site') {\n        params.perSite = true;\n      } else if (opts.search && opts.search == 'per_date') {\n        params.perDate = true;\n      } else params.all = true;\n\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.jobId + '/rois-details', params).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    exportClusteringROIs: function (opts) {\n      const config = {\n        params: opts\n      };\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.jobId + '/rois-export', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getAudioUrlFor: function (recId, aedId) {\n      return '/api/project/' + Project.getUrl() + '/clustering-jobs/' + recId + '/audio/' + aedId;\n    },\n    audioEventDetections: function (opts) {\n      var config = {\n        params: {}\n      };\n\n      if (opts.completed) {\n        config.params.completed = opts.completed;\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs/audio-event-detections', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/new', data).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    delete: function (clusteringJobId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/' + clusteringJobId + '/remove').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.cnn', ['a2.srv.project', 'humane']).factory('a2CNN', function ($q, $http, Project, notify) {\n  var saveData = null;\n  return {\n    listROIs: function (job_id, limit, offset, species_id, site_id, search, callback) {\n      if (!limit) {\n        var limit = 100;\n      }\n\n      if (!offset) {\n        var offset = 0;\n      }\n\n      if (!species_id) {\n        species_id = 0;\n      }\n\n      if (!site_id) {\n        site_id = 0;\n      }\n\n      if (!search) {\n        search = \"all\";\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/rois/' + job_id + \"/\" + species_id + \"/\" + site_id + \"/\" + search + \"/\" + offset + \"_\" + limit).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listROIsBySpecies: function (job_id, species_id, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/roisBySpecies/' + job_id + '/' + species_id).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listResults: function (job_id, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/results/' + job_id).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listModels: function (callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/models').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetailsFor: function (cnnId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/details').then(function (response) {\n        return response.data;\n      });\n    },\n    getRoisFor: function (cnnId, limit, offset) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/rois/' + (offset || 0) + '_' + (limit || 0)).then(function (response) {\n        return response.data;\n      });\n    },\n    countROIsBySpecies: function (cnnId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySpecies');\n    },\n    countROIsBySites: function (cnnId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySites');\n    },\n    countROIsBySpeciesSites: function (cnnId, options) {\n      var search = \"all\";\n\n      if (options.search) {\n        search = options.search;\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySpeciesSites/' + search);\n    },\n    getExportUrl: function (params) {\n      return '/api/project/' + Project.getUrl() + '/cnn/' + params.cnnId + '/rois.csv';\n    },\n    getAudioUrlFor: function (roi) {\n      return '/api/project/' + Project.getUrl() + '/cnn/' + roi.job_id + '/audio/' + roi.cnn_result_roi_id;\n    },\n    validateRois: function (cnnId, rois, validation) {\n      return $http.post('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/validate', {\n        rois: rois,\n        validation: validation\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/cnn/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (cnnId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/remove').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.service.download-resource', []).service('$downloadResource', function ($window) {\n  return function $downloadResource(resource_url) {\n    var a = angular.element('<a></a>').attr('target', '_blank').attr('href', resource_url).appendTo('body');\n    $window.setTimeout(function () {\n      a[0].click();\n      a.remove();\n    }, 0);\n  };\n});","angular.module('a2.services', ['a2.srv.classi', 'a2.srv.models', 'a2.srv.playlists', 'a2.srv.project', 'a2.srv.sites', 'a2.srv.soundscapes', 'a2.srv.species', 'a2.srv.users', 'a2.srv.training-sets', 'a2.srv.templates', 'a2.srv.audio-event-detections-clustering', 'a2.srv.clustering-jobs']);","angular.module('a2.srv.local-storage', []).service('$localStorage', function ($window) {\n  return {\n    getItem: function (item) {\n      if ($window.localStorage) {\n        return $window.localStorage.getItem(item);\n      }\n    },\n    setItem: function (item, value) {\n      if ($window.localStorage) {\n        $window.localStorage.setItem(item, value);\n      }\n    }\n  };\n});","angular.module('a2.srv.models', ['a2.srv.project', 'humane']).factory('a2Models', function ($http, Project, notify) {\n  var saveData = null;\n  var openedModel = false;\n  return {\n    modelState: function (s) {\n      openedModel = s;\n    },\n    isModelOpen: function () {\n      return openedModel;\n    },\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models').success(callback).error(notify.serverError);\n    },\n    getFormInfo: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models/forminfo').success(callback).error(notify.serverError);\n    },\n    findById: function (modelId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId);\n    },\n    create: function (modelData) {\n      return $http.post('/api/project/' + Project.getUrl() + '/models/new', modelData);\n    },\n    delete: function (modelId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId + \"/delete\").success(callback).error(notify.serverError);\n    },\n    getValidationResults: function (modelId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId + '/validation-list/').success(callback).error(notify.serverError);\n    },\n    getRecVector: function (modelId, recId, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId + '/training-vector/' + recId);\n    },\n    setThreshold: function (modelId, thresholdValue) {\n      var data = {\n        m: modelId,\n        t: thresholdValue\n      };\n      return $http.post('/api/project/' + Project.getUrl() + '/models/savethreshold', data);\n    }\n  };\n});","angular.module('a2.srv.news', ['a2.srv.api']).service('a2NewsService', function ($q, a2APIService) {\n  return {\n    loadPage: function (index) {\n      return a2APIService.api.get('/user/feed/' + (index | 0));\n    },\n    loadFormats: function () {\n      return a2APIService.api.get('/user/feed/formats');\n    }\n  };\n});","angular.module('a2.srv.open-modal', ['ui.bootstrap.modal']).provider('$openModal', function () {\n  var $openModalProvider = {\n    defs: {},\n    define: function (modalName, modalDef) {\n      $openModalProvider.defs[modalName] = angular.extend({}, modalDef);\n    },\n    $get: function ($modal) {\n      return function $openModal(modalName, overrides) {\n        var options = angular.extend({}, $openModalProvider.defs[modalName]);\n\n        if (overrides) {\n          if (overrides.resolve) {\n            console.log(\"overrides.resolve\", overrides.resolve);\n            options.resolve = angular.extend(options.resolve, overrides.resolve);\n            console.log(\"options.resolve\", options.resolve);\n            delete overrides.resolve;\n          }\n\n          options = angular.extend(options, overrides);\n        }\n\n        return $modal.open(options);\n      };\n    }\n  };\n  return $openModalProvider;\n});","angular.module('a2.srv.patternmatching', ['a2.srv.project', 'humane']).factory('a2PatternMatching', function ($q, $http, a2APIService, Project, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (opts, callback) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/pattern-matchings', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetailsFor: function (patternMatchingId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/details').then(function (response) {\n        return response.data;\n      });\n    },\n    getPatternMatchingsTotal: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/pattern-matchings/count').success(function (data) {\n        callback(data);\n      });\n    },\n    getRoisFor: function (patternMatchingId, limit, offset, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/pattern-matchings/' + patternMatchingId + '/rois/' + (offset || 0) + '_' + (limit || 0) + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    getSitesListFor: function (patternMatchingId, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/pattern-matchings/' + patternMatchingId + '/site-index' + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    getExportUrl: function (params) {\n      return '/api/project/' + Project.getUrl() + '/pattern-matchings/' + params.patternMatching + '/' + params.jobName + '.csv';\n    },\n    getAudioUrlFor: function (roi) {\n      const ext = '.mp3';\n      return '/api/project/' + Project.getUrl() + '/pattern-matchings/' + roi.pattern_matching_id + '/audio/' + roi.id + ext;\n    },\n    validateRois: function (patternMatchingId, rois, validation, cls) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/validate', {\n        rois: rois,\n        validation: validation,\n        cls: cls\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    update: function (patternMatchingId, data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/update', data).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (patternMatchingId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/remove').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.srv.playlists', ['a2.srv.project']).factory('a2Playlists', function (Project, a2APIService, $rootScope, $http) {\n  var projectName = Project.getUrl();\n  return {\n    getList: function (options) {\n      if (options) {\n        options = {\n          params: options\n        };\n      }\n\n      if (options && options.filterPlaylistLimit) {\n        options.params.filterPlaylistLimit = options.filterPlaylistLimit;\n      }\n\n      return $http.get('/api/project/' + projectName + '/playlists', options).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (playlistParams, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/create', playlistParams).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    combine: function (expression) {\n      return a2APIService.post('/playlists/combine', expression).then(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        return data;\n      });\n    },\n    getRecordingPosition: function (playlist, recording, callback) {\n      var r = $http.get('/api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/position');\n\n      if (callback) {\n        r.success(callback);\n      }\n\n      return r;\n    },\n    // addData: function(playlist, tset_data, callback) {\n    //     var projectName = Project.getUrl();\n    //     $http.post('/api/project/'+projectName+'/playlists/add-data/'+playlist, tset_data).success(function(data) {\n    //         callback(data);\n    //     });\n    // },\n    getPreviousRecording: function (playlist, recording, callback) {\n      return $http.get('/api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/previous').success(function (data) {\n        callback(data);\n      });\n    },\n    getNextRecording: function (playlist, recording, callback) {\n      return $http.get('/api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/next').success(function (data) {\n        callback(data);\n      });\n    },\n    rename: function (playlist, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/rename', playlist).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    remove: function (playlistIds, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/delete', {\n        playlists: playlistIds\n      }).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    getInfo: function (playlist, callback) {\n      $http({\n        method: 'GET',\n        url: '/api/project/' + projectName + '/playlists/info/' + playlist\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getData: function (playlist, params, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/' + playlist, params).success(function (data) {\n        callback(data);\n      });\n    },\n    $on: function (event, handler) {\n      return $rootScope.$on('a2Playlists-' + event, handler);\n    },\n    attachAedToPlaylist: function (opts, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/' + opts.playlist_id + '/aed', {\n        aed: opts.aed\n      }).success(function (data) {\n        callback(data);\n      });\n    }\n  };\n});","angular.module('a2.srv.project', ['a2.srv.api']).factory('Project', function ($location, $http, $q, $httpParamSerializer, a2APIService, notify) {\n  var nameRe = /\\/?(project|citizen-scientist|visualizer)\\/([\\w\\_\\-]+)/;\n  var nrm = nameRe.exec($location.absUrl());\n  var url = nrm ? nrm[2] : '';\n  return {\n    getUrl: function () {\n      return url;\n    },\n    getInfo: function (callback) {\n      $http.get('/api/project/' + url + '/info').success(function (data) {\n        callback(data);\n      });\n    },\n    getProjectById: function (projectId, callback) {\n      var config = {\n        params: {}\n      };\n\n      if (projectId) {\n        config.params.project_id = projectId;\n      }\n\n      $http.get('/api/project/' + url + '/info/source-project', config).success(function (data) {\n        callback(data);\n      });\n    },\n    updateInfo: function (info, callback) {\n      $http.post('/api/project/' + url + '/info/update', info).success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getUsage: function () {\n      return $http.get('/api/project/' + url + '/usage');\n    },\n    getSites: function (options, callback) {\n      if (typeof options == 'function') {\n        callback = options;\n        options = {};\n      }\n\n      return $q.when($http.get('/api/project/' + url + '/sites', {\n        params: options\n      })).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    },\n    getClasses: function (options, callback) {\n      if (typeof options == 'function') {\n        callback = options;\n        options = {};\n      }\n\n      return $q.when($http.get('/api/project/' + url + '/classes', {\n        params: options\n      })).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    },\n    getRecs: function (query, callback) {\n      if (typeof query === \"function\") {\n        callback = query;\n        query = {};\n      }\n\n      if (query && query.tags) {\n        query['tags[]'] = query.tags.flat();\n        delete query.tags;\n      }\n\n      $http.get('/api/project/' + url + '/recordings/search', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecCounts: function (query) {\n      if (query && query.project_url) {\n        delete query.project_url;\n      }\n\n      return a2APIService.get('/recordings/search-count', {\n        params: query || {}\n      });\n    },\n    getRecordingData: function (filters, projection) {\n      if (filters.tags) {\n        filters.tags = filters.tags.flat();\n      }\n\n      var params = {\n        filters: filters,\n        show: projection\n      };\n      Object.keys(params).forEach(function (param) {\n        if (!Object.keys(params[param] || {}).length) {\n          delete params[param];\n        }\n      });\n      var serializedParams = $httpParamSerializer(params);\n      const getUrl = '/api/project/' + url + '/recordings/' + (projection && projection.species ? 'occupancy-models-export/' + projection.species_name : projection && projection.grouped ? 'grouped-detections-export' : 'recordings-export') + (serializedParams.length ? '?' + serializedParams : '');\n      return $http.get(getUrl).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n      ;\n    },\n    getSitesExportUrl: function () {\n      return '/api/project/' + url + '/sites-export.csv';\n    },\n    getRecTotalQty: function (callback) {\n      return a2APIService.get('/recordings/count').then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getProjectTotalSpecies: function (projectId, callback) {\n      $http.get('/api/project/' + url + '/species-count', {\n        project_id: projectId\n      }).success(function (count) {\n        callback(count);\n      });\n    },\n    getProjectTimeBounds: function (callback) {\n      return a2APIService.get('/recordings/time-bounds').then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getRecordings: function (key, options, callback) {\n      if (options instanceof Function) {\n        callback = options;\n        options = {};\n      }\n\n      $http.get('/api/project/' + url + '/recordings/' + key, {\n        params: options\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingAvailability: function (key, callback) {\n      return a2APIService.get('/recordings/available/' + key).then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getOneRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/find/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingInfo: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/info/' + rec_id).success(function (data) {\n        callback(data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getNextRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/next/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    getPreviousRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/previous/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    validateRecording: function (rec_id, validation, callback) {\n      $http.post('/api/project/' + url + '/recordings/validate/' + rec_id, validation).success(function (data) {\n        callback(data);\n      });\n    },\n    recExists: function (site_id, filename, callback) {\n      $http.get('/api/project/' + url + '/recordings/exists/site/' + site_id + '/file/' + filename).success(function (data) {\n        callback(data.exists);\n      });\n    },\n    downloadRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/download/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    addClass: function (projectClass, callback) {\n      return $http.post('/api/project/' + url + '/class/add', projectClass);\n    },\n    removeClasses: function (projectClasses, callback) {\n      return $http.post('/api/project/' + url + '/class/del', projectClasses);\n    },\n    getUsers: function (callback) {\n      $http.get('/api/project/' + url + '/users').success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getRoles: function (callback) {\n      $http.get('/api/project/' + url + '/roles').success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    addUser: function (data, callback) {\n      $http.post('/api/project/' + url + '/user/add', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    removeUser: function (data, callback) {\n      $http.post('/api/project/' + url + '/user/del', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    changeUserRole: function (data, callback) {\n      $http.post('/api/project/' + url + '/user/role', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getModels: function (callback) {\n      $http.get('/api/project/' + url + '/models').success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getClassi: function (callback) {\n      $http.get('/api/project/' + url + '/classifications').success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    validationsCount: function (callback) {\n      $http.get('/api/project/' + url + '/validations/count').success(function (response) {\n        callback(response.count);\n      });\n    },\n    validationBySpeciesSong: function (speciesId, songtypeId, callback) {\n      $http.get('/api/project/' + url + '/validations', {\n        params: {\n          species_id: speciesId,\n          sound_id: songtypeId\n        }\n      }).success(callback);\n    },\n    getProjectsList: function (ownershipType, callback) {\n      var config = {\n        params: {}\n      };\n\n      if (ownershipType) {\n        config.params.type = ownershipType;\n      }\n\n      $http.get('/api/user/projectlist', config).success(function (response) {\n        callback(response);\n      });\n    },\n    removeProject: function (data) {\n      return $http.post('/api/project/' + url + '/remove', data);\n    }\n  };\n});","angular.module('a2.srv.resolve', []).factory('$promisedResolve', function ($q, $injector) {\n  return function $resolve(resolveMap, context) {\n    context = context || {};\n    return $q.all(Object.keys(resolveMap).map(function (key) {\n      return $q.resolve().then(function () {\n        return $injector.invoke(resolveMap[key]);\n      }).then(function (value) {\n        context[key] = value;\n      });\n    })).then(function () {\n      return context;\n    });\n  };\n});","angular.module('a2.service.serialize-promised-fn', [])\n/** serializePromisedFn function decorator.\n * Decorates a promise-returning function so that\n * concurrent calls occur in a serialized manner, \n * that is, each call takes turn in a queue and gets\n * processed one at a time, in call order.\n */\n.service('serializePromisedFn', function ($q) {\n  return function serializePromisedFn(fn) {\n    var series = $q.resolve();\n    return function serializedPromisedFn() {\n      var context = this;\n      var args = Array.prototype.slice.call(arguments);\n      series = series.then(function () {\n        return fn.apply(context, args);\n      });\n      return series;\n    };\n  };\n});","angular.module('a2.srv.sites', ['a2.srv.project', 'humane']).factory('a2Sites', function ($http, $q, Project, notify) {\n  return {\n    listPublished: function (callback) {\n      $http.get('/api/sites/published').success(function (data) {\n        callback(data);\n      });\n    },\n    import: function (site, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/import', {\n        site: site\n      }).success(callback);\n    },\n    update: function (site, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/update', {\n        site: site\n      }).success(callback).error(notify.serverError);\n    },\n    create: function (site, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/create', {\n        site: site\n      }).success(callback).error(notify.serverError);\n    },\n    delete: function (sites, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/delete', {\n        sites: sites\n      }).success(callback).error(notify.serverError);\n    },\n    // Uses Promises :-)\n    getLogFiles: function (site, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/sites/' + site + '/logs');\n    },\n    getSiteLogDataDates: function (site, series) {\n      var d = $q.defer();\n      $http.get('/api/project/' + Project.getUrl() + '/sites/' + site + '/log/data.txt?get=dates').success(d.resolve.bind(d)).error(d.reject.bind(d));\n      return d.promise;\n    },\n    getSiteLogDataUrl: function (site, series, from, to, period) {\n      var args = 'q=' + period + '&from=' + from.getTime() + '&to=' + to.getTime();\n\n      if (/uploads/.test(series)) {\n        return $q.resolve('/api/project/' + Project.getUrl() + '/sites/' + site + '/uploads.txt?' + args);\n      } else if (/recordings/.test(series)) {\n        return $q.resolve('/api/project/' + Project.getUrl() + '/sites/' + site + '/data.txt?' + args);\n      } else {\n        return $q.resolve('/api/project/' + Project.getUrl() + '/sites/' + site + '/log/data.txt?stat=' + series + '&' + args);\n      }\n    },\n    getSiteLogData: function (site, series, from, to, period) {\n      return this.getSiteLogDataUrl(site, series, from, to, period).then(function (url) {\n        return $q.when($http.get(url));\n      }).then(function (response) {\n        var data = {};\n\n        if (response.data) {\n          data.rows = response.data.trim().split('\\n').map(function (line) {\n            return line.split(',');\n          });\n        }\n\n        return data;\n      });\n    },\n    // Get list of assets to a site\n    getListOfAssets: function (site_id) {\n      var d = $q.defer();\n      $http.get('/api/project/' + Project.getUrl() + '/streams/' + site_id + '/assets').success(d.resolve.bind(d)).error(d.reject.bind(d));\n      return d.promise;\n    },\n    // Uses Promises\n    generateToken: function (site) {\n      return $http.post('/api/project/' + Project.getUrl() + '/sites/generate-token', {\n        site: site.id\n      });\n    },\n    revokeToken: function (site) {\n      return $http.post('/api/project/' + Project.getUrl() + '/sites/revoke-token', {\n        site: site.id\n      });\n    }\n  };\n});","angular.module('a2.srv.soundscape-composition', ['a2.srv.api']).factory('a2SoundscapeCompositionService', function ($q, a2APIService) {\n  return {\n    getClassList: function (options) {\n      options = options || {};\n      var params = {};\n\n      if (options.tally) {\n        params.tally = 1;\n      }\n\n      if (options.isSystemClass) {\n        params.isSystemClass = 1;\n      }\n\n      return a2APIService.get('/soundscape-composition/classes', {\n        params: params\n      }).then(function (classList) {\n        if (options.groupByType) {\n          return classList.reduce(function (_, item) {\n            if (!_.index[item.typeId]) {\n              _.list.push(_.index[item.typeId] = {\n                type: item.type,\n                typeId: item.typeId,\n                list: []\n              });\n            }\n\n            _.index[item.typeId].list.push(item);\n\n            return _;\n          }, {\n            list: [],\n            index: {}\n          }).list;\n        } else {\n          return classList;\n        }\n      });\n    },\n    addClass: function (name, typeId) {\n      return a2APIService.post('/soundscape-composition/add-class', {\n        name: name,\n        type: typeId\n      });\n    },\n    removeClass: function (scClassid) {\n      return a2APIService.post('/soundscape-composition/remove-class', {\n        id: scClassid\n      });\n    },\n    getAnnotationsFor: function (visobject) {\n      if (visobject && /^recording$/.test(visobject.type)) {\n        return a2APIService.get('/soundscape-composition/annotations/' + (visobject.id | 0));\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    annotate: function (visobject, annotation) {\n      if (visobject && /^recording$/.test(visobject.type)) {\n        return a2APIService.post('/soundscape-composition/annotate/' + (visobject.id | 0), annotation);\n      } else {\n        return $q.reject(new Error(\"Cannot add soundscape composition annotation\" + (visobject ? \" to \" + visobject.type : \"\") + \".\"));\n      }\n    }\n  };\n});","angular.module('a2.srv.soundscapes', ['a2.srv.project', 'humane']).factory('a2Soundscapes', function (Project, $http, $q, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    getAmplitudeReferences: function () {\n      return $q.resolve([{\n        value: 'absolute',\n        caption: \"Absolute\",\n        description: \"The threshold is taken as an absolute value of the amplitude of each peak.\"\n      }, {\n        value: 'relative-to-peak-maximum',\n        caption: \"Relative to maximum\",\n        description: \"The threshold is taken as a relative proportion of the maximum amplitude of the peaks in the soundscape.\"\n      }]);\n    },\n    get: function (soundscapeId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId).success(function (data) {\n        callback(data);\n      });\n    },\n    getSCIdx: function (soundscapeId, params, callback) {\n      if (params instanceof Function) {\n        callback = params;\n        params = undefined;\n      }\n\n      if (!params) {\n        params = {};\n      }\n\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/scidx', {\n        params: params\n      }).success(function (data) {\n        if (callback) callback(data);\n        d.resolve(data);\n      });\n      return d.promise;\n    },\n    getNormVector: function (soundscapeId, callback) {\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/norm-vector').success(function (data) {\n        if (callback) callback(data);\n        d.resolve(data);\n      });\n      return d.promise;\n    },\n    // TODO fusion getList and getList2 routes to return needed data\n    getList: function (query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = {};\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getList2: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/soundscapes/details').success(callback).error(notify.serverError);\n    },\n    setVisualizationOptions: function (soundscapeId, params, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/scale', params).success(function (data) {\n        callback(data);\n      });\n    },\n    addRegion: function (soundscapeId, bbox, params, callback) {\n      var projectName = Project.getUrl();\n      params.bbox = bbox;\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/add', params).success(function (data) {\n        callback(data);\n      });\n    },\n    sampleRegion: function (soundscapeId, region, params, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/sample', params).success(function (data) {\n        callback(data);\n      });\n    },\n    getExportUrl: function (options) {\n      var soundscapeId = options.soundscape.soundscape_id;\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      var args = [];\n\n      if (options.raw) {\n        args.push('raw=1');\n      }\n\n      d.resolve('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/export-list' + (args.length ? '?' + args.join('&') : ''));\n      return d.promise;\n    },\n    getRegion: function (soundscapeId, region, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingTags: function (soundscapeId, region, recording, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording).success(function (data) {\n        callback(data);\n      });\n    },\n    addRecordingTag: function (soundscapeId, region, recording, tag, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording + '/add', {\n        tag: tag\n      }).success(callback);\n    },\n    removeRecordingTag: function (soundscapeId, region, recording, tag, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording + '/remove', {\n        tag: tag\n      }).success(callback);\n    },\n    getRegions: function (soundscapeId, query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = undefined;\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordings: function (soundscapeId, bbox, query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = {};\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/recordings/' + bbox, {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    // TODO change method to receive id\n    findIndices: function (soundscapeId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/soundscapes/' + soundscapeId + '/indices').success(callback);\n    },\n    delete: function (soundscapeId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/soundscapes/' + soundscapeId + \"/delete\").success(callback).error(notify.serverError);\n    },\n    create: function (soundscapeData) {\n      return $http.post('/api/project/' + Project.getUrl() + '/soundscape/new', soundscapeData);\n    }\n  };\n});","angular.module('a2.srv.species', []).factory('Species', function ($http) {\n  var species;\n  return {\n    get: function (callback) {\n      if (species) return callback(species);\n      $http.get('/api/species/list/100').success(function (data) {\n        species = data;\n        callback(species);\n      });\n    },\n    search: function (query, callback) {\n      $http.get('/api/species/search', {\n        params: {\n          q: query\n        }\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    findById: function (species_id, callback) {\n      return $http.get('/api/species/' + species_id).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    }\n  };\n}).factory('Songtypes', function ($http) {\n  var songs;\n\n  var searchId = function (id, callback) {\n    var s = songs.filter(function (song) {\n      return song.id === id;\n    });\n    if (s !== null) callback(s[0]);\n  };\n\n  return {\n    get: function (callback) {\n      if (songs) return callback(songs);\n      $http.get('/api/songtypes/all').success(function (data) {\n        songs = data;\n        callback(songs);\n      });\n    },\n    findById: function (songtype_id, callback) {\n      if (songs) {\n        searchId(songtype_id, callback);\n        return;\n      }\n\n      $http.get('/api/songtypes/all').success(function (data) {\n        songs = data;\n        searchId(songtype_id, callback);\n      });\n    }\n  };\n});","angular.module('a2.srv.tags', ['a2.srv.api']).factory('a2Tags', function ($q, a2APIService, notify) {\n  function isTaggableType(type) {\n    return /^recording$/.test('' + type);\n  }\n\n  function isTaggableResource(obj) {\n    return obj && isTaggableType(obj.type) && obj.id;\n  }\n\n  return {\n    getFor: function (visobject) {\n      if (isTaggableResource(visobject)) {\n        return a2APIService.get('/tags/' + visobject.type + '/' + (visobject.id | 0));\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    getForType: function (resourceType) {\n      if (isTaggableType(resourceType)) {\n        return a2APIService.get('/tags/' + resourceType);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    deleteFor: function (visobject, tagId) {\n      if (isTaggableResource(visobject)) {\n        return a2APIService.delete('/tags/' + visobject.type + '/' + (visobject.id | 0) + '/' + tagId);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    addFor: function (visobject, tag) {\n      if (isTaggableResource(visobject)) {\n        var data = {};\n\n        if (tag.tag_id) {\n          data.id = tag.tag_id;\n        } else {\n          data.text = tag.tag;\n        }\n\n        if (tag.t0 !== undefined) {\n          data.t0 = tag.t0;\n          data.f0 = tag.f0;\n          data.t1 = tag.t1;\n          data.f1 = tag.f1;\n        }\n\n        return a2APIService.put('/tags/' + visobject.type + '/' + (visobject.id | 0), data).catch(notify.serverError);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    search: function (text) {\n      return a2APIService.get('/tags/?q=' + text);\n    }\n  };\n});","angular.module('a2.srv.templates', ['a2.srv.project']).factory('a2Templates', function (Project, $http, notify) {\n  return {\n    getList: function (opts) {\n      var projectName = Project.getUrl();\n      var config = {\n        params: {}\n      };\n\n      if (opts && opts.showRecordingUri) {\n        config.params.showRecordingUri = opts.showRecordingUri;\n      }\n\n      if (opts && opts.projectTemplates) {\n        config.params.projectTemplates = opts.projectTemplates;\n      }\n\n      if (opts && opts.publicTemplates) {\n        config.params.publicTemplates = opts.publicTemplates;\n      }\n\n      if (opts && opts.q) {\n        config.params.q = opts.q;\n      }\n\n      if (opts && opts.limit) {\n        config.params.limit = opts.limit;\n      }\n\n      if (opts && opts.offset !== undefined) {\n        config.params.offset = opts.offset;\n      }\n\n      return $http.get('/api/project/' + projectName + '/templates', config).then(function (response) {\n        return response.data;\n      });\n    },\n    count: function (opts) {\n      var config = {\n        params: {}\n      };\n\n      if (opts && opts.publicTemplates) {\n        config.params.publicTemplates = opts.publicTemplates;\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/templates/count', config).then(function (response) {\n        return response.data;\n      });\n    },\n    add: function (template_data) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/templates/add', template_data).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getAudioUrlFor: function (template) {\n      const ext = '.mp3';\n      return '/api/project/' + Project.getUrl() + '/templates/audio/' + template.id + ext;\n    },\n    delete: function (templateId) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/templates/' + templateId + '/remove');\n    },\n    getImage: function (templateId) {\n      var projectName = Project.getUrl();\n      return $http.get('/api/project/' + projectName + '/templates/data/' + templateId + '/image').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.srv.training-sets', ['a2.srv.project']).factory('a2TrainingSets', function (Project, $http) {\n  return {\n    getList: function (callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets').success(function (data) {\n        callback(data);\n      });\n    },\n    add: function (tset_data, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/training-sets/add', tset_data).success(function (data) {\n        callback(data);\n      });\n    },\n    edit: function (trainingSetId, tset_data) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/training-sets/edit/' + trainingSetId, tset_data);\n    },\n    delete: function (trainingSetId) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/training-sets/remove/' + trainingSetId);\n    },\n    addData: function (trainingSetId, tset_data, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/training-sets/add-data/' + trainingSetId, tset_data).success(function (data) {\n        callback(data);\n      });\n    },\n    getData: function (trainingSetId, recording_uri, callback) {\n      if (recording_uri instanceof Function) {\n        callback = recording_uri;\n        recording_uri = \"\";\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/list/' + trainingSetId + '/' + recording_uri).success(function (data) {\n        callback(data);\n      });\n    },\n    getDataImage: function (trainingSetId, dataId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/data/' + trainingSetId + '/get-image/' + dataId).success(function (data) {\n        callback(data);\n      });\n    },\n    getTypes: function (callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/types').success(function (data) {\n        callback(data);\n      });\n    },\n    getRois: function (trainingSetId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/rois/' + trainingSetId).success(function (data) {\n        callback(data);\n      });\n    },\n    getExportUrl: function (trainingSetId) {\n      var projectName = Project.getUrl();\n      return '/api/project/' + projectName + '/training-sets/rois/' + trainingSetId + '?export=1';\n    },\n    getSpecies: function (trainingSetId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/species/' + trainingSetId).success(function (data) {\n        callback(data);\n      });\n    },\n    removeRoi: function (trainingSetId, roiId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/' + trainingSetId + '/remove-roi/' + roiId).success(function (data) {\n        callback(data);\n      });\n    }\n  };\n});","angular.module('a2.srv.uploads', ['a2.srv.api']).factory('a2UploadsService', function (a2APIService) {\n  return {\n    getProcessingList: function (opts) {\n      const config = {\n        params: opts\n      };\n      return a2APIService.get('/uploads/processing', config).then(function (data) {\n        return data;\n      });\n    },\n    checkStatus: function (opts) {\n      const config = {\n        params: opts\n      };\n      return a2APIService.get('/uploads/check', config).then(function (data) {\n        return data.items;\n      });\n    }\n  };\n});","angular.module('a2.srv.users', []).factory('Users', function ($http) {\n  var users;\n  return {\n    getInfoForId: function (user_id) {\n      return $http.get('/api/user/info/' + user_id).then(function (response) {\n        return response.data.user;\n      });\n    }\n  };\n});","angular.module('a2.filters', ['a2.filter.as-csv', 'a2.filter.caps', 'a2.filter.a2-page-number-to-title', 'a2.filter.a2-page-title-to-number', 'a2.filter.project-url', 'a2.filter.range', 'a2.filter.round', 'a2.filter.time-from-now']);","angular.module('a2.filter.as-csv', []).filter('asCSV', function () {\n  return function (value, delimiter, filter) {\n    if (!(value instanceof Array)) {\n      if (typeof value == 'object') {\n        value = Object.keys(value).map(function (key) {\n          return key + \"=\" + (value[key] === undefined ? '' : value[key]);\n        });\n      } else {\n        value = [value];\n      }\n    }\n\n    if (filter) {\n      value = value.filter(function (v) {\n        return !!v;\n      });\n    }\n\n    return value.join(delimiter || ', ');\n  };\n});","angular.module('a2.filter.caps', []).filter('caps', function () {\n  return function (input, type) {\n    if (!input) {\n      return undefined;\n    }\n\n    switch (type || 'title') {\n      case 'title-case':\n        return input.replace(/\\b\\w/g, function (_) {\n          return _.toUpperCase();\n        });\n\n      default:\n        return input;\n    }\n  };\n});","angular.module('a2.filter.a2-page-number-to-title', []).filter('a2PageNumberToTitle', function () {\n  return function a2PageNumberToTitle(page_number) {\n    return page_number + 1;\n  };\n});","angular.module('a2.filter.a2-page-title-to-number', []).filter('a2PageTitleToNumber', function () {\n  return function a2PageTitleToNumber(page_title) {\n    var page_number;\n\n    if (!isFinite(page_title) || page_title === '') {\n      page_number = '';\n    } else if (page_title == '0') {\n      page_number = 9;\n    } else {\n      page_number = page_title - 1;\n    }\n\n    return page_number;\n  };\n});","angular.module('a2.filter.project-url', []).filter('projectUrl', function (a2APIService) {\n  return function (url) {\n    return a2APIService.project.getUrl(url);\n  };\n});","angular.module('a2.filter.range', []).filter('a2Range', function () {\n  return function (from, to, step) {\n    if (!to) {\n      to = from;\n      from = 0;\n    }\n\n    if (!step) {\n      step = Math.sign(to - from);\n    }\n\n    var stepSign = Math.sign(step);\n    var list = [];\n\n    if (step != 0) {\n      for (var i = from; (i - to) * stepSign < 0; i += step) {\n        list.push(i);\n      }\n    }\n\n    return list;\n  };\n});","angular.module('a2.filter.round', []).filter('round', function () {\n  return function (val, precision) {\n    precision = precision || 1;\n    return (val / precision | 0) * precision || 0;\n  };\n});","angular.module('a2.filter.time-from-now', []).filter('timeFromNow', function () {\n  return function (input, fmt) {\n    if (!input) return undefined;\n    return moment(input).fromNow();\n  };\n});","angular.module('a2.orders.change-project-plan', ['a2.orders.order-utils', 'a2.orders.orders', 'ui.bootstrap', 'humane', 'a2.directives', 'a2.services']).controller('ChangeProjectPlanCtrl', function ($scope, orderData, Project, $window, a2order, $modalInstance, notify, a2orderUtils) {\n  $scope.today = new Date();\n  console.log(orderData);\n  $scope.recorderQty = orderData.recorderQty;\n  a2orderUtils.getOrdersContact().then(function (response) {\n    $scope.ordersContact = response.data;\n  });\n  a2orderUtils.paymentsStatus().then(function (response) {\n    $scope.autoPaymentsEnabled = response.data.payments_enable;\n  });\n  Project.getInfo(function (info) {\n    $scope.project = info;\n    $scope.currentPlan = {\n      storage: info.storage_limit,\n      processing: info.processing_limit,\n      duration: info.plan_period,\n      tier: info.tier,\n      activation: info.plan_activated,\n      creation: info.plan_created\n    };\n\n    if ($scope.currentPlan.activation && $scope.currentPlan.duration) {\n      var due = new Date($scope.currentPlan.activation);\n      due.setFullYear(due.getFullYear() + $scope.currentPlan.duration);\n      $scope.currentPlan.due = due;\n    }\n\n    if ($scope.currentPlan.due && $scope.currentPlan.due < $scope.today) {\n      $scope.mode = 'renew';\n    } else if ($scope.currentPlan.duration) {\n      $scope.mode = 'upgrade';\n    } else {\n      $scope.mode = 'new';\n    }\n\n    $scope.project.plan = orderData.project && orderData.project.plan || {};\n    Project.getUsage().success(function (usage) {\n      $scope.minUsage = usage.min_usage;\n    });\n  });\n\n  $scope.upgrade = function () {\n    if (!$scope.autoPaymentsEnabled) {\n      return notify.log('Payments are unavailable');\n    }\n\n    if ($scope.mode == 'renew') {\n      if ($scope.project.plan.storage < $scope.minUsage) {\n        notify.error('Please select a plan with more capacity or delete recordings from the project');\n        return;\n      }\n    } else {\n      if ($scope.currentPlan.storage && $scope.project.plan.storage - $scope.currentPlan.storage <= 0) {\n        notify.error('To upgrade select a plan with more capacity than the current');\n        return;\n      }\n    }\n\n    orderData = {\n      action: 'update-project',\n      project: $scope.project,\n      recorderQty: $scope.recorderQty,\n      mode: $scope.mode\n    };\n\n    if ($scope.recorderQty > 0 && $scope.project.plan.tier == 'paid') {\n      a2order.enterShippingAddress(orderData);\n    } else {\n      a2order.reviewOrder(orderData);\n    }\n\n    $modalInstance.dismiss();\n  };\n});","angular.module('a2.orders.create-project', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.plan-selection', 'a2.orders.project-order-service', 'ui.bootstrap', 'humane']).controller('CreateProjectCtrl', function ($scope, $http, $modalInstance, $modal, notify, a2order, orderData, a2orderUtils, ProjectOrderService) {\n  $scope.project = orderData.project;\n  $scope.recorderQty = orderData.recorderQty;\n  a2orderUtils.getOrdersContact().then(function (response) {\n    $scope.ordersContact = response.data;\n  });\n  a2orderUtils.paymentsStatus().then(function (response) {\n    $scope.autoPaymentsEnabled = response.data.payments_enable;\n  });\n\n  $scope.create = function () {\n    console.log($scope.isValid);\n\n    if (!$scope.isValid) {\n      return;\n    }\n\n    return ProjectOrderService.makeOrder('create-project', $scope.project, $scope.recorderQty, {\n      autoPaymentsEnabled: $scope.autoPaymentsEnabled\n    }).then(function (order) {\n      console.log(order); // if user added recorders to paid order show shipping address form\n\n      if (order.hasCoupon || !order.isPaidProject) {\n        return ProjectOrderService.placeOrder(order.data).then(function () {\n          return $modalInstance.close();\n        });\n      } else if (order.isPaidProject && order.data.recorderQty > 0) {\n        a2order.enterShippingAddress(order.data);\n        $modalInstance.dismiss();\n      } else {\n        a2order.reviewOrder(order.data);\n        $modalInstance.dismiss();\n      }\n    });\n  };\n});","angular.module('a2.orders.order-summary', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.project-order-service', 'ui.bootstrap', 'humane']).controller('OrderSummaryCtrl', function ($scope, $http, $modalInstance, orderData, notify, $window, a2order, a2orderUtils, ProjectOrderService) {\n  if (orderData.address) {\n    $scope.address = orderData.address;\n  }\n\n  $scope.type = orderData.mode == 'upgrade' ? 'upgrade' : 'new';\n  $scope.info = a2orderUtils.info;\n  $scope.shipping = orderData.shipping || 0;\n  $scope.project = orderData.project;\n  $scope.plan = orderData.project.plan;\n  $scope.recorderQty = orderData.recorderQty || 0;\n\n  $scope.changeItems = function () {\n    if (orderData.action == 'create-project') {\n      a2order.createProject(orderData);\n    } else {\n      a2order.changePlan(orderData);\n    }\n\n    $modalInstance.dismiss();\n  };\n\n  $scope.editAddress = function () {\n    a2order.enterShippingAddress(orderData);\n    $modalInstance.dismiss();\n  };\n\n  $scope.submit = function () {\n    $scope.waiting = true;\n    console.log(orderData);\n    return ProjectOrderService.placeOrder(orderData).then(function (data) {\n      console.log(data);\n\n      if (data.message) {\n        // if free project notify project was created\n        $modalInstance.close();\n      } else if (data.approvalUrl) {\n        // else redirect to paypal\n        $window.location.assign(data.approvalUrl);\n      }\n\n      $scope.waiting = false;\n    }).catch(function (err) {\n      $scope.waiting = false;\n    });\n  };\n});","angular.module('a2.orders.order-utils', []).service('a2orderUtils', function ($http) {\n  return {\n    /**\n        receives a plan activation date and duration period, and calculates \n        how many month are left until the plan is due\n        @param [Date] acticationDate\n        @param [Number] period\n    */\n    monthsUntilDue: function (acticationDate, period) {\n      var d = new Date(acticationDate);\n      var totalMonths = period * 12;\n      var today = new Date();\n      var currentMonth;\n\n      for (var i = 0; i <= totalMonths; i++) {\n        var month = new Date(d.getFullYear(), d.getMonth() + i, d.getDate());\n\n        if (today <= month) {\n          currentMonth = i - 1;\n          break;\n        }\n      }\n\n      return totalMonths - currentMonth;\n    },\n    paymentsStatus: function () {\n      return $http.get('/api/orders/payments-status', {\n        cache: true\n      });\n    },\n    checkCouponCode: function (code, project) {\n      return $http.post('/api/orders/check-coupon', {\n        hash: code,\n        project: project\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    getOrdersContact: function () {\n      return $http.get('/api/orders/contact', {\n        cache: true\n      });\n    },\n    info: {\n      recorder: {\n        name: 'Arbimon Recorder',\n        description: \"includes an Android device preset for acoustic monitoring, \" + \"waterproof case(IP67), microphone, 6500mAh lithium-ion battery \" + \"and USB charger\",\n        priceWithPlan: 125,\n        priceNoPlan: 300\n      },\n      plan: {\n        new: {\n          name: \"Project data plan\",\n          description: function (plan) {\n            return \"includes storage for \" + plan.storage + \" minutes of audio \" + \"and capacity to process \" + plan.processing + \" minutes of audio \" + \"per year, for a term of \" + plan.duration + \" year(s)\";\n          }\n        },\n        upgrade: {\n          name: \"Project data plan upgrade\",\n          description: function (plan) {\n            return \"upgrade your plan storage to \" + plan.storage + \" minutes of audio \" + \"and capacity to process \" + plan.processing + \" minutes of audio \" + \"per year, until this plan due\";\n          }\n        }\n      }\n    }\n  };\n});","angular.module('a2.orders.orders', ['a2.orders.create-project', 'a2.orders.change-project-plan', 'a2.orders.shipping-form', 'a2.orders.order-summary', 'ui.bootstrap']).service('a2order', function ($modal) {\n  var formOpener = function (orderData, view) {\n    var modalOptions = {\n      resolve: {\n        orderData: function () {\n          return orderData;\n        }\n      },\n      backdrop: 'static',\n      templateUrl: view.templateUrl,\n      controller: view.controller\n    };\n    return $modal.open(modalOptions);\n  };\n\n  return {\n    createProject: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/create-project.html',\n        controller: 'CreateProjectCtrl'\n      });\n      return modalInstance;\n    },\n    changePlan: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/change-plan.html',\n        controller: 'ChangeProjectPlanCtrl'\n      });\n      return modalInstance;\n    },\n    enterShippingAddress: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/shipping-address.html',\n        controller: 'ShippingFormCtrl'\n      });\n      return modalInstance;\n    },\n    reviewOrder: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/order-summary.html',\n        controller: 'OrderSummaryCtrl'\n      });\n      return modalInstance;\n    }\n  };\n});","angular.module('a2.orders.directives.plan-capacity', ['a2.orders.plan-selection', 'countries-list', 'ui.bootstrap', 'humane', 'a2.directives', 'a2.services']).directive('planCapacity', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'disabled': '=',\n      'minutes': '='\n    },\n    templateUrl: '/orders/plan-capacity.html',\n    link: function (scope, element, attrs) {\n      if (!attrs.enabled) {\n        scope.enabled = true;\n      }\n    }\n  };\n});","angular.module('a2.orders.plan-selection', ['countries-list', 'ui.bootstrap', 'humane', 'a2.orders.directives.plan-capacity', 'a2.orders.directives.tier-select', 'a2.directives', 'a2.services']).controller('PlanSelectionCtrl', function ($scope, a2orderUtils) {\n  const freePlan = {\n    // Changes must be matched in app/model/projects.js\n    tier: 'free',\n    cost: 0,\n    storage: 100000,\n    processing: 10000000\n  };\n  this.coupon = {\n    code: '',\n    validation: null\n  };\n\n  this.checkCouponCode = function () {\n    if (this.coupon.code) {\n      this.coupon.validation = {\n        class: 'fa fa-spinner fa-spin'\n      };\n      delete this.coupon.payload;\n      delete $scope.plan.coupon;\n      return a2orderUtils.checkCouponCode(this.coupon.code, this.project).then(function (code) {\n        if (code.valid) {\n          $scope.plan.coupon = code;\n          this.coupon.payload = code.payload;\n          this.coupon.validation = {\n            valid: true,\n            class: 'fa fa-check text-success'\n          };\n        } else {\n          this.coupon.validation = {\n            valid: false,\n            class: 'fa fa-times text-danger'\n          };\n        }\n      }.bind(this), function () {\n        this.coupon.validation = {\n          valid: false,\n          class: 'fa fa-times text-danger'\n        };\n      }.bind(this));\n    } else {\n      delete this.coupon.validation;\n    }\n  };\n\n  $scope.plan = freePlan;\n  $scope.recorderOptions = 0;\n  $scope.planMinutes = $scope.planMinutes || freePlan.storage;\n  $scope.planYears = $scope.planYears || 1;\n  $scope.upgradeOnly = false;\n  $scope.recorderQty = $scope.recorderQty || 0;\n  console.log($scope.plan);\n  this.hasCouponCode = false;\n  this.planData = {\n    yearOptions: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n  };\n  $scope.$watch('currentPlan', function () {\n    if (!$scope.currentPlan) return;\n    var due = new Date($scope.currentPlan.activation);\n    due.setFullYear(due.getFullYear() + $scope.currentPlan.duration);\n    $scope.planYears = $scope.currentPlan.duration || 1;\n    $scope.planMinutes = $scope.currentPlan.storage >= freePlan.storage ? $scope.currentPlan.storage : freePlan.storage;\n\n    if ($scope.currentPlan.tier == 'paid' && (!$scope.currentPlan.activation || new Date() < due)) {\n      $scope.upgradeOnly = true;\n      $scope.plan.tier = 'paid';\n    }\n  });\n  $scope.$watch('plan', function (value) {\n    if ($scope.plan) {\n      if ($scope.plan.storage) $scope.planMinutes = $scope.plan.storage;\n      if ($scope.plan.duration) $scope.planYears = $scope.plan.duration;\n    }\n  });\n  $scope.$watch('plan.tier', function (value) {\n    if (!$scope.plan) return;\n\n    if ($scope.plan.tier == 'paid') {\n      $scope.plan.cost = $scope.planMinutes * 0.03 * $scope.planYears;\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n      console.log($scope.plan);\n    } else if ($scope.plan.tier == 'free') {\n      $scope.plan.cost = freePlan.cost;\n      $scope.plan.storage = freePlan.storage;\n      $scope.plan.processing = freePlan.processing;\n      $scope.plan.duration = undefined;\n    }\n  });\n\n  var updatePlan = function () {\n    $scope.plan = $scope.plan || {};\n\n    if ($scope.upgradeOnly) {\n      if ($scope.currentPlan.storage > $scope.planMinutes) {\n        $scope.planMinutes = $scope.currentPlan.storage;\n      }\n\n      var planStarts = $scope.currentPlan.activation || $scope.currentPlan.creation;\n      var monthsLeft = a2orderUtils.monthsUntilDue(planStarts, $scope.currentPlan.duration);\n      console.log('planStarts', planStarts);\n      console.log('monthsLeft', monthsLeft);\n      $scope.plan.cost = ($scope.planMinutes - $scope.currentPlan.storage) * monthsLeft * (0.03 / 12);\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n    } else {\n      if ($scope.usage && $scope.usage > $scope.planMinutes) {\n        $scope.planMinutes = Math.ceil($scope.usage / 5000) * 5000;\n      }\n\n      $scope.plan.cost = $scope.planMinutes * $scope.planYears * 0.03;\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n      var recorderCap = Math.floor($scope.planMinutes / 10000) * $scope.planYears;\n      $scope.recorderQty = $scope.recorderQty || 0;\n\n      if ($scope.recorderQty > recorderCap) {\n        $scope.recorderQty = recorderCap;\n      }\n\n      $scope.recorderOptions = new Array(recorderCap + 1);\n    }\n  };\n\n  this.updatePlan = updatePlan;\n  $scope.$watch('planMinutes', updatePlan);\n  $scope.$watch('planYears', updatePlan);\n}).directive('planSelect', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'project': '=',\n      'plan': '=',\n      'recorderQty': '=',\n      'availablePlans': '=',\n      'ordersContact': '=',\n      'autoPaymentsEnabled': '=',\n      'currentPlan': '=?',\n      'usage': '=?'\n    },\n    templateUrl: '/orders/select-plan.html',\n    controller: 'PlanSelectionCtrl as controller',\n    link: function (scope, element, attrs, controller) {\n      scope.$watch('project', function (project) {\n        controller.project = project;\n      });\n    }\n  };\n});","angular.module('a2.orders.process-order', []).controller('ProcessOrderCtrl', function ($scope, $http, $window, $location) {\n  var reOrderId = /\\/process-order\\/([\\w\\-\\d]+)/;\n  var result = reOrderId.exec($window.location.pathname);\n  var orderId = result !== null ? result[1] : '';\n  console.log('orderId:', orderId);\n  $scope.processing = true;\n  $http.post('/api/orders/process/' + orderId + $window.location.search).success(function (data) {\n    console.log('data', data);\n    $scope.invoice = {\n      items: data.invoice.item_list.items,\n      amount: data.invoice.amount,\n      number: data.orderNumber,\n      user: data.user\n    };\n\n    if (data.invoice.item_list.shipping_address) {\n      $scope.invoice.address = data.invoice.item_list.shipping_address;\n    }\n\n    $scope.action = data.action;\n    $scope.processing = false;\n    $scope.success = true;\n  }).error(function (data, status) {\n    if (status == 404) {\n      $scope.notFound = true;\n    } else if (status == 400 && data.error == 'APPROVAL_NEEDED') {\n      $scope.needApproval = true;\n      $scope.approvalLink = data.approvalLink;\n    } else if (status == 400 && data.error == 'ALREADY_PROCESSED') {\n      $scope.alreadyProcessed = true;\n    } else {\n      $scope.errorOcurred = true;\n    }\n\n    $scope.processing = false;\n  });\n});","angular.module('a2.orders.project-order-service', ['humane']).factory(\"ProjectOrderService\", function ($q, $filter, $http, notify) {\n  var currencyFilter = $filter('currency');\n  var ProjectOrderService = {\n    placeOrder: function (orderData) {\n      if (!/(create|update)-project/.test(orderData.action)) {\n        return $q.reject(\"Invalid action \" + orderData.action);\n      }\n\n      var data = angular.merge({}, orderData);\n      delete data.action;\n      return $http.post('/api/orders/' + orderData.action, orderData).then(function (response) {\n        var data = response.data; // notify any succesfull messages\n\n        if (data.message) {\n          notify.log(data.message);\n        }\n\n        return data;\n      }).catch(function (response) {\n        var err = response.data;\n        console.log(\"err\", err);\n        console.log(\"err resp\", response);\n\n        if (err) {\n          if (err.freeProjectLimit) {\n            notify.error('You already have own a free project, ' + 'the limit is one per user.');\n          } else if (err.nameExists) {\n            notify.error('Name <b>' + orderData.project.name + '</b> not available.');\n          } else if (err.urlExists) {\n            notify.error('URL <b>' + orderData.project.url + '</b> is taken, choose another one.');\n          } else {\n            notify.serverError();\n          }\n        }\n\n        throw err;\n      });\n    },\n    makeOrder: function (action, project, recorderQty, settings) {\n      console.log(\"makeOrder\", action, project, recorderQty, settings);\n\n      if (!project || !project.plan) {\n        return $q.reject(new Error('You need to select a plan'));\n      }\n\n      var isPaidProject = project.plan.tier == 'paid';\n      var coupon = project.plan.coupon && project.plan.coupon.valid ? project.plan.coupon : undefined;\n      settings.recorderCost = settings.recorderCost || 125;\n      settings.projectCostLimit = settings.projectCostLimit || 10000;\n\n      if (coupon) {\n        project = angular.merge({}, project);\n        delete project.plan;\n      } else if (isPaidProject) {\n        if (!settings.autoPaymentsEnabled) {\n          return $q.reject(new Error('Payments are unavailable'));\n        } // don't process orders over $10,000\n\n\n        if (project.plan.cost + recorderQty * settings.recorderCost > settings.projectCostLimit) {\n          return $q.reject(new Error('Cannot process order greater than ' + currencyFilter(settings.projectCostLimit)));\n        }\n      }\n\n      return $q.resolve({\n        hasCoupon: !!coupon,\n        isPaidProject: isPaidProject,\n        data: {\n          action: action,\n          coupon: coupon ? coupon.hash : undefined,\n          project: project,\n          recorderQty: recorderQty\n        }\n      });\n    }\n  };\n  return ProjectOrderService;\n});","angular.module('a2.orders.shipping-form', ['a2.orders.orders', 'countries-list', 'ui.bootstrap']).controller('ShippingFormCtrl', function ($scope, $http, $modalInstance, $modal, orderData, countries, a2order) {\n  if (!orderData.address) {\n    $http.get('/api/user/address').success(function (data) {\n      $scope.address = data.address || {};\n    });\n  } else {\n    $scope.address = orderData.address;\n  }\n\n  countries.get(function (data) {\n    $scope.countries = data;\n  });\n\n  $scope.verify = function () {\n    // TODO this method should validate form and call server to get shipping cost\n    $http.post('/api/orders/calculate-shipping', {\n      address: $scope.address,\n      recorderQty: orderData.recorderQty\n    }).success(function (data) {\n      orderData.shipping = data.shipping_cost;\n      orderData.address = data.address;\n      a2order.reviewOrder(orderData);\n      $modalInstance.dismiss();\n    });\n  };\n});","angular.module('a2.orders.directives.tier-select', []).directive('tierSelect', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'tier': '=',\n      'disableFree': '='\n    },\n    templateUrl: '/orders/tier-select.html'\n  };\n});","angular.module('a2.directive.a2-auto-close-on-outside-click', []).directive('a2AutoCloseOnOutsideClick', function ($document, $rootScope) {\n  function getElementPath(element) {\n    var ancestors = [];\n    element = element;\n\n    while (element) {\n      ancestors.push(element);\n      element = element.parentElement;\n    }\n\n    return ancestors;\n  }\n\n  return {\n    restrict: 'A',\n    require: '?dropdown',\n    link: function (scope, element, $attrs, dropdownController) {\n      $attrs.$set('autoClose', \"disabled\");\n\n      function closeDropdown(evt) {\n        if (!evt || !dropdownController.isOpen()) {\n          return;\n        }\n\n        var ancestors = getElementPath(evt.target);\n        var htmlIdx = ancestors.indexOf($document[0].documentElement);\n        var toggleElementIdx = ancestors.indexOf(dropdownController.toggleElement[0]);\n        var elementIdx = ancestors.indexOf(dropdownController.dropdownMenu[0]); // console.log(htmlIdx, toggleElementIdx, elementIdx);\n\n        if (toggleElementIdx != -1 || elementIdx != -1 || htmlIdx == -1) {\n          return;\n        }\n\n        dropdownController.toggle(false);\n\n        if (!$rootScope.$$phase) {\n          scope.$apply();\n        }\n      }\n\n      $document.bind('click', closeDropdown);\n      scope.$on('$destroy', function () {\n        $document.unbind('click', closeDropdown);\n      });\n    }\n  };\n});","angular.module('arbimon2.directive.a2-dropdown', []).directive('a2Dropdown', function ($compile) {\n  var masterTemplate = angular.element('<div dropdown dropdown-append-to-body>' + '<button class=\"btn btn-sm btn-default dropdown-toggle\" dropdown-toggle>' + '<span></span> <i class=\"fa fa-caret-down\"></i>' + '</button>' + '<ul class=\"dropdown-menu dropup\" role=\"menu\">' + '<li ng-repeat=\"$item in list\" ng-class=\"{active: $item == $selectedItem}\">' + '<a ng-click=\"select($item)\"><span></span></a>' + '</li>' + '</ul>' + '</div>');\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    scope: true,\n    compile: function (element, attrs) {\n      var tpl = angular.element(masterTemplate[0].cloneNode(true));\n      var itemTpl = tpl.children('ul').children('li').children('a').children('span');\n      var selectedItemTpl = tpl.children('button').children('span');\n      var elementHtml = element.html();\n      itemTpl.append(elementHtml);\n      selectedItemTpl.append(elementHtml.replace(/\\$item\\b/g, '$selectedItem'));\n      element.empty();\n      var compiledTpl = $compile(tpl.clone());\n      return function (scope, linkElement, attrs, ngModelCtrl) {\n        linkElement.append(compiledTpl(scope));\n        scope.$watch(attrs.list, function (list) {\n          scope.list = list || [];\n        });\n\n        scope.select = function (item) {\n          scope.$selectedItem = item;\n          ngModelCtrl.$setViewValue(item, true);\n        };\n\n        ngModelCtrl.$render = function () {\n          scope.$selectedItem = ngModelCtrl.$viewValue;\n        };\n      };\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-on-resize\n * @description\n * Directive for detecting size changes in an element.\n */\nangular.module('a2.directive.on-resize', []).service('a2OnResizeService', function ($window, $rootScope) {\n  var watchers = [],\n      animationFramePending = false;\n\n  function Watcher(element, handler) {\n    this.element = element;\n    this.handler = handler;\n    this.value = null;\n    watchers.push(this);\n    watch.scheduleAnimationFrame();\n  }\n\n  Watcher.prototype.destroy = function () {\n    var index = watchers.indexOf(this);\n\n    if (index >= 0) {\n      watchers.splice(index, 1);\n    }\n  };\n\n  function watch() {\n    animationFramePending = false;\n    var triggered = [];\n    watchers.forEach(function (watcher) {\n      var width = watcher.element[0].clientWidth;\n      var height = watcher.element[0].clientHeight;\n\n      if (!watcher.value || watcher.value.width != width || watcher.value.height != height) {\n        watcher.value = {\n          width: width,\n          height: height\n        };\n        triggered.push(watcher);\n      }\n    });\n\n    if (triggered.length) {\n      $rootScope.$apply(function () {\n        triggered.forEach(function (watcher) {\n          try {\n            watcher.handler(watcher.value);\n          } catch (e) {\n            console.error(e);\n          }\n        });\n      });\n    }\n\n    watch.scheduleAnimationFrame();\n  }\n\n  watch.scheduleAnimationFrame = function () {\n    if (watchers.length && !animationFramePending) {\n      animationFramePending = true;\n      $window.requestAnimationFrame(watch);\n    }\n  };\n\n  return {\n    newWatcher: function (element, handler) {\n      return new Watcher(element, handler);\n    }\n  };\n}).directive('a2OnResize', function ($parse, a2OnResizeService) {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var onResize = $parse(attr.a2OnResize);\n      var watcher = a2OnResizeService.newWatcher(element, function (newSize) {\n        onResize(newSize, scope);\n      });\n      scope.$on('$destroy', function () {\n        watcher.destroy();\n      });\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-palette-drawer\n * @description\n * Directive for drawing a color palette.\n */\nangular.module('a2.directive.a2-palette-drawer', []).directive('a2PaletteDrawer', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    template: '<canvas class=\"palette\"></canvas>',\n    replace: true,\n    scope: {\n      palette: '&'\n    },\n    link: function ($scope, $element, $attrs) {\n      var draw = function () {\n        var pal = $scope.palette() || [];\n        var e = pal.length | 0;\n        $element.attr('width', e);\n        $element.attr('height', 1);\n        var ctx = $element[0].getContext('2d');\n\n        for (var i = 0; i < e; ++i) {\n          ctx.fillStyle = pal[i];\n          ctx.fillRect(i, 0, 1, 1);\n        }\n      };\n\n      $scope.$watch('palette()', draw);\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.percentage-bars', ['a2.utils']).directive('a2PercentageBars', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/a2-percentage-bars.html',\n    scope: {\n      data: \"=\",\n      total: \"=\",\n      colors: \"=\"\n    },\n    controller: 'a2PercentageBarsCtrl as bars'\n  };\n}).controller('a2PercentageBarsCtrl', function ($scope, $filter) {\n  var DEFAULT_COLORS = ['0', '1', '2'];\n  var numberFilter = $filter('number');\n\n  $scope.getColorClass = function (index) {\n    var colors = $scope.colors || DEFAULT_COLORS;\n    return 'bar-' + colors[index % colors.length];\n  };\n\n  $scope.getTotal = function () {\n    return $scope.total || $scope.data.reduce(function (a, b) {\n      return a + b;\n    });\n  };\n\n  $scope.asPercent = function (value, rounding) {\n    return numberFilter(value * 100 / $scope.getTotal(), rounding) + '%';\n  };\n});","angular.module('a2.directive.require-non-empty', []).directive('requireNonEmpty', function () {\n  return {\n    restrict: 'A',\n    require: '?ngModel',\n    link: function (scope, elm, attr, ctrl) {\n      if (!ctrl) {\n        return;\n      }\n\n      attr.required = true; // force truthy in case we are on non input element\n\n      ctrl.$validators.required = function (modelValue, viewValue) {\n        return !attr.required || !(ctrl.$isEmpty(viewValue) || viewValue instanceof Array && !viewValue.length);\n      };\n\n      attr.$observe('required', function () {\n        ctrl.$validate();\n      });\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.sidenav-bar', ['a2.utils']).directive('a2SidenavBar', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    compile: function (element, attr) {\n      element.addClass(\"sidenav\");\n      var name = attr.name;\n      var template = element.clone();\n      return function (scope, element, attr) {\n        a2SidenavBarService.enableSidenavBar(name, template, scope);\n\n        if (attr.enabled) {\n          scope.$watch(attr.enabled, function (enabled) {\n            if (enabled) {\n              a2SidenavBarService.enableSidenavBar(name, template, scope);\n            } else {\n              a2SidenavBarService.disableSidenavBar(name);\n            }\n          });\n        }\n\n        scope.$on('$destroy', function () {\n          a2SidenavBarService.disableSidenavBar(name);\n        });\n      };\n    }\n  };\n}).service('a2SidenavBarService', function ($q, $log, a2EventEmitter) {\n  var cache = {};\n\n  function SidenavBar() {\n    this.enabled = false;\n    this.events = new a2EventEmitter();\n  }\n\n  SidenavBar.prototype = {\n    enable: function (template, scope) {\n      if (!this.enabled) {\n        this.enabled = true;\n        this.template = template;\n        this.scope = scope;\n        return this.events.emit('enabled', this);\n      }\n\n      return $q.resolve();\n    },\n    disable: function () {\n      if (this.enabled) {\n        this.enabled = false;\n        delete this.template;\n        delete this.scope;\n        return this.events.emit('disabled', this);\n      }\n\n      return $q.resolve();\n    },\n    on: function (event, listener) {\n      this.events.on(event, listener);\n    },\n    off: function (event, listener) {\n      this.events.off(event, listener);\n    }\n  };\n\n  function getSidenavBar(name) {\n    return cache[name] || (cache[name] = new SidenavBar());\n  }\n\n  a2SidenavBarService = {\n    enableSidenavBar: function (name, template, scope) {\n      return getSidenavBar(name).enable(template, scope);\n    },\n    disableSidenavBar: function (name) {\n      return getSidenavBar(name).disable();\n    },\n    registerAnchor: function (name, onEnabled, onDisabled) {\n      var bar = getSidenavBar(name);\n      bar.on('enabled', onEnabled);\n      bar.on('disabled', onDisabled);\n\n      if (bar.enabled) {\n        $q.resolve().then(onEnabled);\n      }\n\n      return function unregisterAnchor() {\n        bar.off('enabled', onEnabled);\n        bar.off('disabled', onDisabled);\n      };\n    }\n  };\n  return a2SidenavBarService;\n}).directive('a2SidenavBarAnchor', function (a2SidenavBarService, $compile) {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var name;\n      var isUl = element[0].nodeName.toLowerCase() == 'ul';\n      var unregisterAnchor;\n\n      function onEnabled(sidebar) {\n        var template = sidebar.template.clone();\n        element.empty().append($compile(template.children())(sidebar.scope));\n      }\n\n      function onDisabled(sidebar) {\n        element.empty();\n      }\n\n      attr.$observe('a2SidenavBarAnchor', function (_name) {\n        name = _name;\n\n        if (unregisterAnchor) {\n          unregisterAnchor();\n          unregisterAnchor = null;\n        }\n\n        unregisterAnchor = a2SidenavBarService.registerAnchor(name, onEnabled, onDisabled);\n      });\n      scope.$on('$destroy', function () {\n        if (unregisterAnchor) {\n          unregisterAnchor();\n          unregisterAnchor = null;\n        }\n      });\n    }\n  };\n});","angular.module('a2.directive.a2-table', []).directive('a2Table', function ($window, $filter, $templateCache, $compile) {\n  var $ = $window.$;\n\n  function compileFields(element) {\n    return element.children('field').toArray().map(function (field) {\n      field = angular.element(field);\n      var clone = field.clone();\n      field.detach();\n      return {\n        title: clone.attr('title'),\n        key: clone.attr('key'),\n        tdclass: clone.attr('tdclass'),\n        width: clone.attr('width'),\n        filter: clone.attr('filter') !== undefined ? clone.attr('filter') || clone.attr('key') : undefined,\n        content: clone.html(),\n        show: clone.attr('show'),\n        tooltip: clone.attr('tooltip')\n      };\n    });\n  }\n\n  function compileSelectExpand(element, options) {\n    var selectExpand = element.children('expand-select');\n\n    if (!selectExpand.length) {\n      return;\n    }\n\n    var clone = selectExpand.clone(true);\n    selectExpand.detach();\n    selectExpand = angular.element('<tr ng-show=\"selected\"><td colspan=\"' + options.fieldCount + '\"></td></tr>');\n    selectExpand.find('td').append(clone);\n    return selectExpand;\n  }\n\n  return {\n    restrict: 'E',\n    scope: {\n      rows: '=',\n      selected: '=?',\n      // able to work with $scope.selected rows\n      onSelect: '&',\n      onCheck: '&',\n      checked: '=?',\n      // able to work with $scope.checked rows\n      search: '=?',\n      // noCheckbox: '@',    // disable row checkboxes\n      // noSelect: '@',      // disable row selection\n      dateFormat: '@',\n      // moment date format, default: 'lll'\n      numberDecimals: '@' // decimal spaces\n\n    },\n    controller: 'a2TableCtrl as a2TableController',\n    compile: function (element, attrs) {\n      var template = angular.element($templateCache.get('/directives/a2-table.html'));\n      var tplHead = template.find(\"thead tr.headers\");\n      var tplFilters = template.find(\"thead tr.filters\");\n      var tplBody = template.find(\"tbody tr\");\n      var options = {};\n      var filterable = [];\n      var hasFilters = false;\n      options.fields = compileFields(element);\n      options.hasCheckbox = attrs.noCheckbox === undefined;\n      options.hasSelection = attrs.noSelect === undefined;\n      options.fieldCount = options.fields.length + (options.hasCheckbox ? 1 : 0);\n      options.selectExpand = compileSelectExpand(element, options);\n      options.fields.forEach(function (field, index) {\n        tplHead.append(angular.element('<th ng-click=\"a2TableController.sortBy(' + index + ')\" class=\"cs-pointer\"' + (field && field.tooltip !== undefined ? ' title=\"' + field.tooltip + '\"' : '') + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '></th>').addClass(field.tdclass).text(field.title).append(field.key ? '    <i ng-if=\"sortKey == ' + index + '\" class=\"fa\" ng-class=\"reverse ? \\'fa-chevron-up\\': \\'fa-chevron-down\\'\"></i>\\n' : ''));\n        hasFilters |= field.filter !== undefined;\n        tplFilters.append(angular.element('<th' + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '></th>').append(field.filter !== undefined ? '   <input type=\"text\" class=\"a2-table-filter form-control\" ng-model=\"a2TableController.filter[' + index + ']\" ng-change=\"a2TableController.onFilterChanged(' + index + ')\">\\n' : ''));\n        tplBody.append(angular.element('<td ' + (['Project', 'Species'].includes(field.title) ? 'title=\"' + field.content + '\"' : '') + (field.width ? 'width=\"' + field.width + '\"' : '') + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '>').addClass(field.tdclass).html(field.content));\n      });\n      return function (scope, element, attrs, a2TableCtrl) {\n        var tableScope = scope.$parent.$new(false, scope);\n        options.scope = scope;\n        options.tableScope = tableScope;\n\n        options.onSelect = scope.onSelect && function (row) {\n          return scope.onSelect({\n            row: row\n          });\n        };\n\n        options.onCheck = scope.onCheck && function (row) {\n          return scope.onCheck({\n            row: row\n          });\n        };\n\n        a2TableCtrl.initialize(options);\n        tableScope.a2TableController = a2TableCtrl;\n        a2TableCtrl.fields = options.fields;\n\n        if (options.selectExpand) {\n          a2TableCtrl.selectExpand = $compile(options.selectExpand)(tableScope);\n        }\n\n        a2TableCtrl.noCheck = !options.hasCheckbox;\n        a2TableCtrl.noSelect = !options.hasSelection;\n        tableScope.sortKey = attrs.defaultSort || tableScope.sortKey;\n\n        if (attrs.search) {\n          scope.$watch('search', function (value) {\n            tableScope.query = scope.search;\n            a2TableCtrl.updateChecked();\n          });\n        }\n\n        a2TableCtrl.setRows(scope.rows);\n        scope.$watch('rows', function (rows) {\n          a2TableCtrl.setRows(rows);\n        }, true);\n        var cmpel = $compile(template.clone())(tableScope);\n        element.append(cmpel);\n        scope.$on('$destroy', function () {\n          tableScope.$destroy();\n        });\n      };\n    }\n  };\n}).controller('a2TableCtrl', function ($filter) {\n  var scope, tableScope;\n\n  this.initialize = function (options) {\n    scope = options.scope;\n    tableScope = options.tableScope;\n    this.options = options;\n    this.__onSelect = options.onSelect;\n    this.__onCheck = options.onCheck;\n    this.hasFilters = options.fields.reduce(function (_, field) {\n      return _ || field.filter !== undefined;\n    }, false);\n    this.filter = {};\n  };\n\n  this.setRows = function (rows) {\n    this.rows = rows;\n    this.updateChecked();\n  };\n\n  this.onFilterChanged = function (index) {\n    var query = tableScope.query || (tableScope.query = {});\n    var key = this.options.fields[index].filter.split('.');\n    var value = this.filter[index];\n\n    if (value == \"\") {\n      while (key.length > 1) {\n        query = (query || {})[key.shift()];\n      }\n\n      delete query[key.shift()];\n    } else {\n      while (key.length > 1) {\n        var keycomp = key.shift();\n        query = query[keycomp] || (query[keycomp] = {});\n      }\n\n      query[key.shift()] = value;\n    }\n  };\n\n  this.updateChecked = function () {\n    if (this.rows) {\n      var visible = $filter('filter')(this.rows, tableScope.query);\n      scope.checked = visible.filter(function (row) {\n        return row.checked | false;\n      });\n    }\n  };\n\n  this.toggleAll = function () {\n    var allFalse = this.rows.reduce(function (_, row) {\n      return _ && !row.checked;\n    }, true);\n    this.rows.forEach(function (row) {\n      row.checked = allFalse;\n    });\n    tableScope.checkall = allFalse;\n  };\n\n  this.check = function ($event, $index) {\n    if (this.lastChecked && $event.shiftKey) {\n      if (this.lastChecked) {\n        var rows;\n\n        if (this.lastChecked > $index) {\n          rows = this.rows.slice($index, this.lastChecked);\n        } else {\n          rows = this.rows.slice(this.lastChecked, $index);\n        }\n\n        rows.forEach(function (row) {\n          row.checked = true;\n        });\n      }\n    }\n\n    this.lastChecked = $index;\n  };\n\n  this.keyboardSel = function (row, $index, $event) {\n    if ($event.key === \" \" || $event.key === \"Enter\") {\n      this.sel(row, $index);\n    }\n  };\n\n  this.sel = function (row, $index, $event) {\n    if (this.noSelect) {\n      return;\n    }\n\n    if (tableScope.selected === row) {\n      row = undefined;\n    }\n\n    tableScope.selected = row;\n    scope.selected = row;\n\n    if (this.selectExpand) {\n      angular.element($event.currentTarget).after(this.selectExpand);\n    }\n\n    if (this.__onSelect) {\n      this.__onSelect(row);\n    }\n  };\n\n  this.onCheck = function (row, $index, $event) {\n    if (this.__onCheck) {\n      this.__onCheck(row);\n    }\n  };\n\n  this.sortBy = function (fieldIndex) {\n    var field = this.fields[fieldIndex];\n\n    if (tableScope.sortKey !== fieldIndex) {\n      tableScope.sortKey = fieldIndex;\n      tableScope.sort = field.key;\n      tableScope.reverse = false;\n    } else {\n      tableScope.reverse = !tableScope.reverse;\n    }\n  };\n});","(function () {\n  var a2TagsModule = angular.module('a2.directive.a2-tags', ['templates-arbimon2']);\n  var a2TagTypes = ['classi', 'classes', 'model', 'playlist', {\n    tag: 'project',\n    linkTo: function (tagId) {\n      return \"/project/?id=\" + tagId;\n    }\n  }, 'site', 'species', 'song', 'soundscape', 'training_set'];\n  a2TagTypes.forEach(function (tagType) {\n    if ('string' == typeof tagType) {\n      tagType = {\n        tag: tagType\n      };\n    }\n\n    tagType.tcTag = tagType.tag.replace(/(^|\\b|-)(\\w)/, function (_0, _1, _2) {\n      return _2.toUpperCase();\n    });\n    a2TagsModule.directive('a2Tag' + tagType.tcTag, function ($injector) {\n      return {\n        restrict: 'EAC',\n        scope: {\n          tag: '=a2Tag' + tagType.tcTag\n        },\n        link: function (scope, element, attrs) {\n          var tagName, tagId, tagLink;\n          var aElement = element.find('a');\n          element.addClass('a2-tag a2-tag-' + tagType.tag);\n          scope.$watch('tag', function (tag) {\n            if (tag instanceof Array) {\n              tagId = tag[0];\n              tagName = tag[1];\n\n              if (tagId && tagType.linkTo) {\n                tagLink = $injector.invoke(tagType.linkTo, null, {\n                  tagId: tagId\n                });\n              }\n            } else {\n              tagId = null;\n              tagName = tag;\n            }\n\n            var tagElement = angular.element(tagLink ? '<a></a>' : '<span></span>').appendTo(element.empty());\n            tagElement.text(tagName);\n\n            if (tagLink) {\n              tagElement.attr('href', tagLink);\n            }\n          });\n        }\n      };\n    });\n  });\n})();","angular.module('a2.directives', ['a2.services', 'a2.directive.a2-table', 'arbimon.directive.a2-switch', 'a2.directive.percentage-bars', 'templates-arbimon2']).run(function ($window) {\n  var $ = $window.$;\n  $(document).click(function (e) {\n    if ($(e.target).closest('.calendar.popup:visible').length) return;\n    $('.calendar.popup:visible').hide();\n  }); // extend jQuery\n  // add parent tag selector\n\n  $.expr.filter.UP_PARENT_SPECIAL = function (_1) {\n    var times = _1 && _1.length || 1;\n    return $.expr.createPseudo(function (seed, matches, _3, _4) {\n      var dups = [];\n      seed.forEach(function (e, i) {\n        var p = e;\n\n        for (var t = times; t > 0; --t) {\n          p = p && (p.nodeType == 9 || p.parentNode.nodeType == 9 ? p : p.parentNode);\n        }\n\n        if (p) {\n          for (var di = 0, de = dups.length; di < de; ++di) {\n            if (dups[di] === p) {\n              p = null;\n              break;\n            }\n          }\n\n          if (p) {\n            dups.push(p);\n          }\n        }\n\n        matches[i] = p;\n        seed[i] = !p;\n      });\n      return true;\n    });\n  };\n\n  $.expr.match.needsContext = new RegExp($.expr.match.needsContext.source + '|^(\\\\^)');\n  $.expr.match.UP_PARENT_SPECIAL = /^(\\^+)/;\n}).directive('a2GlobalKeyup', function ($window, $timeout) {\n  var $ = $window.$;\n  return {\n    restrict: 'A',\n    scope: {\n      onkeyup: '&a2GlobalKeyup'\n    },\n    link: function ($scope, $element, $attrs) {\n      var handler = function (evt) {\n        $timeout(function () {\n          $scope.onkeyup({\n            $event: evt\n          });\n        });\n      };\n\n      $(document).on('keyup', handler);\n      $element.on('$destroy', function () {\n        $(document).off('keyup', handler);\n      });\n    }\n  };\n}).directive('a2Scroll', function ($parse, $window) {\n  var mkFunction = function (scope, attr) {\n    var fn = $parse(attr);\n    return function (locals) {\n      locals.console = console;\n      return fn(scope, locals);\n    };\n  };\n\n  return {\n    scope: {\n      'a2InfiniteScrollDistance': '=?',\n      'a2InfiniteScrollDisabled': '=?',\n      'a2InfiniteScrollImmediateCheck': '=?'\n    },\n    link: function ($scope, element, attrs, controller) {\n      var pscope = $scope.$parent;\n      var fnBind = 'on';\n      var fnUnbind = 'off';\n\n      if (attrs.a2Scroll) {\n        controller.a2Scroll = mkFunction(pscope, attrs.a2Scroll);\n      }\n\n      controller.element = element;\n\n      if (attrs.a2ScrollOn) {\n        if (attrs.a2ScrollOn == 'window') {\n          controller.scrollElement = $window;\n          fnBind = 'addEventListener';\n          fnUnbind = 'removeEventListener';\n        } else {\n          controller.scrollElement = $(attrs.a2ScrollOn);\n        }\n      } else {\n        controller.scrollElement = element;\n      }\n\n      if (attrs.a2InfiniteScroll) {\n        $scope.a2InfiniteScroll = mkFunction(pscope, attrs.a2InfiniteScroll);\n      }\n\n      if (!$scope.a2InfiniteScrollDistance) {\n        $scope.a2InfiniteScrollDistance = 1;\n      }\n\n      if (!$scope.a2InfiniteScrollRefraction) {\n        $scope.a2InfiniteScrollRefraction = 1000;\n      }\n\n      controller.scrollHandler = controller.scrollHandler.bind(controller);\n      controller.scrollElement[fnBind](\"scroll\", controller.scrollHandler);\n      controller.element.bind(\"$destroy\", function () {\n        controller.scrollElement[fnUnbind]('scroll', controller.scrollHandler);\n        controller.dispose();\n      });\n    },\n    controller: 'a2ScrollController'\n  };\n}).controller('a2ScrollController', function ($scope) {\n  Object.assign(this, {\n    anchors: {},\n    addAnchor: function (name, anchorElement) {\n      this.anchors[name] = anchorElement;\n    },\n    removeAnchor: function (name) {\n      delete this.anchors[name];\n    },\n    scrollHandler: function (event) {\n      try {\n        if (this.a2Scroll) {\n          this.a2Scroll({\n            $event: event,\n            $controller: this\n          });\n        }\n\n        if ($scope.a2InfiniteScroll && !$scope.a2InfiniteScrollDisabled) {\n          var remaining = (element[0].scrollHeight - element[0].scrollTop | 0) / element.height();\n\n          if (remaining < $scope.a2InfiniteScrollDistance) {\n            var time = new Date().getTime();\n\n            if (!$scope.refraction || $scope.refraction < time) {\n              $scope.refraction = time + $scope.a2InfiniteScrollRefraction;\n              $scope.a2InfiniteScroll({\n                $event: e\n              });\n            }\n          }\n        }\n      } finally {\n        $scope.$apply();\n      }\n    },\n    dispose: function () {\n      this.element = null;\n      this.scrollElement = null;\n      this.anchors = {};\n    }\n  });\n}).directive('a2ScrollAnchor', function () {\n  return {\n    require: '^a2Scroll',\n    link: function ($scope, element, attrs, a2ScrollController) {\n      var name = attrs.name;\n      a2ScrollController.addAnchor(name, element);\n      element.bind(\"$destroy\", function () {\n        a2ScrollController.removeAnchor(name);\n      });\n    }\n  };\n}).directive('a2Persistent', function ($rootScope, $compile, $timeout) {\n  var counter = 0;\n  var poc = $('<div></div>');\n  return {\n    restrict: 'E',\n    scope: {},\n    compile: function (tElement, tAttrs) {\n      var children = tElement.children().detach();\n      var tag = tAttrs.name || 'persistent-' + counter++;\n      return function (_1, $element, _3) {\n        if (!$rootScope._$persistence_) {\n          $rootScope._$persistence_ = {};\n        }\n\n        var p = $rootScope._$persistence_;\n        var ptag = p[tag];\n        var persisted = true;\n\n        if (!ptag) {\n          // console.log('new persistent scope \"%s\" created in ', tag, $rootScope);\n          p[tag] = ptag = {};\n          ptag.scope = $rootScope.$new(true);\n          ptag.scope._$persistence_tag_ = tag;\n          ptag.view = $compile(children)(ptag.scope);\n          persisted = false;\n        }\n\n        $element.append(ptag.view);\n        $element.on('$destroy', function (e) {\n          e.stopPropagation();\n          poc.append(ptag.view);\n        });\n\n        if (persisted) {\n          $timeout(function () {\n            ptag.scope.$broadcast('a2-persisted');\n          });\n        }\n      };\n    }\n  };\n}).directive('autoHeight', function ($window) {\n  var $ = $window.$;\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var updateHeight = function () {\n        // console.log('window h:', $(window).height());\n        // console.log('ele pos:',  element.offset());\n        // console.log('ele h:', element.height());\n        var h = $($window).height() - element.offset().top;\n        if (h < 500) return;\n        $window.requestAnimationFrame(function () {\n          element.height(h);\n        });\n      };\n\n      updateHeight();\n      $($window).resize(function () {\n        updateHeight();\n      });\n    }\n  };\n}).directive('stopClick', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      element.bind('click', function (e) {\n        e.stopPropagation();\n      });\n    }\n  };\n}).directive('loader', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      hideText: '@',\n      text: '@'\n    },\n    templateUrl: '/directives/loader.html'\n  };\n})\n/**   yearpick - complete year date picker\n\n  example usage:\n  <div class=\"dropdown\">\n    <button ng-model=\"dia\" yearpick disable-empty=\"true\" year=\"year\" date-count=\"dateData\">\n        <span ng-hide=\"dia\"> Select Date </span>\n        {{ dia | date: short }}\n    </button>\n  </div>\n  or, if you just want to show the component :\n  <yearpick ng-model=\"dia\" yearpick disable-empty=\"true\" year=\"year\" date-count=\"dateData\"></yearpick>\n */\n.directive('yearpick', function ($timeout, $window) {\n  var d3 = $window.d3;\n  var $ = $window.$;\n  return {\n    restrict: 'AE',\n    scope: {\n      ngModel: '=',\n      maxDate: '=?',\n      minDate: '=?',\n      year: '=?',\n      dateCount: '=?',\n      mode: '@',\n      onYearChanged: '&?',\n      onDateChanged: '&?',\n      disableEmpty: '&'\n    },\n    link: function (scope, element, attrs) {\n      var is_a_popup = !/yearpick/i.test(element[0].tagName);\n      var popup;\n\n      if (is_a_popup) {\n        popup = $('<div></div>').insertAfter(element).addClass('calendar popup');\n        element.click(function (e) {\n          e.stopPropagation(); // verify if hidden\n\n          var visible = popup.css('display') === 'none'; // always hide any other open yearpick\n\n          $('.calendar.popup:visible').hide();\n\n          if (visible) {\n            popup.css('display', 'block');\n          }\n        });\n      } else {\n        popup = element.addClass('calendar');\n      }\n\n      var weekOfMonth = function (d) {\n        var firstDay = new Date(d.toString());\n        firstDay.setDate(1);\n        var monthOffset = firstDay.getDay() - 1;\n        return Math.floor((d.getDate() + monthOffset + 7) / 7) - 1;\n      };\n\n      var monthName = d3.time.format('%B');\n      var dateFormat = d3.time.format(\"%Y-%m-%d\");\n\n      var format2Date = function (txt) {\n        var m = /^(\\d+)-(\\d+)-(\\d+)$/.exec(txt);\n        return m && new Date(m[1] | 0, m[2] | 0, m[3] | 0);\n      };\n\n      var canHaveDateCounts = function () {\n        return scope.mode === \"density\" && attrs.dateCount;\n      };\n\n      var computeMax = !attrs.maxDate;\n      var computeMin = !attrs.minDate;\n\n      function setYear(year) {\n        var old_year = scope.year;\n        scope.year = year;\n\n        if (scope.onYearChanged && old_year != year) {\n          $timeout(function () {\n            scope.onYearChanged({\n              year: year\n            });\n          });\n        }\n      }\n\n      function setDate(date) {\n        var old_date = scope.ngModel;\n        scope.ngModel = date;\n\n        if (scope.onDateChanged && old_date != date) {\n          $timeout(function () {\n            scope.onDateChanged({\n              date: date\n            });\n          });\n        }\n      }\n\n      if (!scope.year) {\n        setYear(new Date().getFullYear());\n      }\n\n      var cubesize = 19;\n      var width = 600;\n      var height = 510;\n      var headerHeight = 40;\n      var days;\n      var svg = d3.select(popup[0]).append('svg').attr('width', width).attr('height', height);\n      var cal = svg.append('g');\n      var legend = svg.append('g');\n      var prev = svg.append('g').attr('class', 'btn');\n      var next = svg.append('g').attr('class', 'btn'); // draws previous year button\n\n      prev.append('text').attr('text-anchor', 'start').attr('font-family', 'FontAwesome').attr('font-size', 24).attr('x', 5).attr('y', 24).text('\\uf060');\n      prev.on('click', function (e) {\n        $timeout(function () {\n          setYear(scope.year - 1);\n        });\n      }); // draws next year button\n\n      next.append('text').attr('text-anchor', 'end').attr('font-family', 'FontAwesome').attr('font-size', 24).attr('x', width - 5).attr('y', 24).text('\\uf061');\n      next.on('click', function (e) {\n        $timeout(function () {\n          setYear(scope.year + 1);\n        });\n      }); // draw legend\n\n      if (scope.mode === \"density\") {\n        var scale = {\n          scale: [1, 50, 100],\n          labels: ['0', '1', '50', '100']\n        };\n        var color = d3.scale.threshold().domain(scale.scale).range(scale);\n        var icon = legend.selectAll('g').data(['1', '50', '100']).enter().append('g').attr('transform', function (d, i) {\n          switch (d) {\n            case '50':\n              return 'translate(18,0)';\n\n            default:\n              return 'translate(20,0)';\n          }\n        });\n        icon.append('rect').attr('width', cubesize * 0.63).attr('height', cubesize * 0.63).attr('y', height + 7 - cubesize).attr('x', function (d, i) {\n          return i * 45 + 22;\n        }).attr('class', function (d) {\n          return 'cal-level-' + d;\n        });\n        icon.append('text').attr('text-anchor', 'middle').attr('font-size', 10).attr('y', height - 2).attr('x', function (d, i) {\n          switch (d) {\n            case '1':\n              return i * 45 + 11;\n\n            case '50':\n              return i * 45 + 9;\n\n            case '100':\n              return i * 45 + 6;\n          }\n        }).text(function (d, i) {\n          return '+' + d;\n        });\n      }\n\n      var drawCounts = function () {\n        if (scope.mode === \"density\" && !scope.dateCount) return;\n\n        if (scope.disableEmpty()) {\n          days.classed('day-disabled', function (d) {\n            return $(this).hasClass('cal-oor') || !scope.dateCount[dateFormat(d)];\n          });\n        }\n\n        var squares = days.select('rect');\n        squares.attr('class', function (d) {\n          var color = d3.scale.threshold().domain([1, 50, 100]).range(['0', '1', '50', '100']);\n          var count = scope.dateCount[dateFormat(d)] || 0;\n          return 'cal-level-' + color(count);\n        });\n      };\n\n      var draw = function () {\n        // set calendar year\n        calendar = cal.selectAll('g').data([scope.year]); // append new year\n\n        var title = calendar.enter().append('g'); // set text position\n\n        title.append('text').attr('text-anchor', 'middle').attr('font-size', 30).attr('x', width / 2).attr('y', 30); // set line position\n\n        title.append('line').attr('x1', 5).attr('y1', headerHeight).attr('x2', width - 5).attr('y2', headerHeight).attr('stroke', 'rgba(0,0,0,0.5)').attr('stroke-width', 1); // remove old year\n\n        calendar.exit().remove(); // write year text\n\n        calendar.select('text').text(function (d) {\n          return d;\n        });\n        prev.classed('disabled', scope.minDate && scope.minDate.getFullYear() >= scope.year);\n        next.classed('disabled', scope.maxDate && scope.year >= scope.maxDate.getFullYear()); // setup the months containers and set the years' month date range\n\n        var mon = calendar.append('g').attr('transform', 'translate(0,' + headerHeight + ')').selectAll('g').data(function (d) {\n          return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1));\n        }); // on enter in months, append new months\n\n        mon.enter().append('g'); // in months, transform each month to their place in the yearpick\n\n        mon.attr('transform', function (d, i) {\n          return 'translate(' + (d.getMonth() % 4 * 150 + 5) + ',' + (Math.floor(d.getMonth() / 4) * 150 + 5) + ')';\n        }); // in months, transform each month to their place in the yearpick\n\n        mon.append('text').attr('text-anchor', 'middle').attr('x', cubesize * 7 / 2).attr('y', 15).text(function (d) {\n          return monthName(d);\n        }); // remove old months\n\n        mon.exit().remove(); // setup day containers for each months\n\n        days = mon.selectAll('g').data(function (d) {\n          return d3.time.days(new Date(d.getFullYear(), d.getMonth(), 1), new Date(d.getFullYear(), d.getMonth() + 1, 1));\n        }); //  in days, on enter, append a g of class btn\n\n        days.enter().append('g').attr('class', 'day'); //  for each day, move the text, add class hover and onclick event handler\n\n        days.attr('transform', function () {\n          return 'translate(0,24)';\n        }).classed('hover', true).classed('day-disabled cal-oor', function (d) {\n          return (scope.minDate ? d < scope.minDate : false) || (scope.maxDate ? scope.maxDate < d : false);\n        }).classed('selected', function (d) {\n          return scope.ngModel && dateFormat(d) == dateFormat(scope.ngModel);\n        }).on('click', function (d) {\n          scope.$apply(function () {\n            d3.event.preventDefault();\n            setDate(d);\n            if (is_a_popup) popup.css('display', 'none');\n          });\n        }); // .. also, add a rect on the background\n\n        days.append('rect').attr('width', cubesize).attr('height', cubesize).attr('y', function (d, i) {\n          return weekOfMonth(d) * (cubesize + 1);\n        }).attr('x', function (d, i) {\n          return d.getDay() * (cubesize + 1);\n        }).attr('fill', 'white'); // .. and append a text on the foreground\n\n        days.append('text').attr('text-anchor', 'middle').attr('font-size', 10).attr('y', function (d, i) {\n          return weekOfMonth(d) * (cubesize + 1) + 13;\n        }).attr('x', function (d, i) {\n          return (d.getDay() + 1) * (cubesize + 1) - 10;\n        }).text(function (d, i) {\n          return d.getDate();\n        }); // if we have date counts, then draw them\n\n        if (attrs.dateCount) {\n          drawCounts();\n        } // remove old days\n\n\n        days.exit().remove();\n      };\n\n      scope.$watch('maxDate', function () {\n        if (scope.maxDate && scope.year > scope.maxDate.getFullYear()) {\n          setYear(scope.maxDate.getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('minDate', function () {\n        if (scope.minDate && scope.year < scope.minDate.getFullYear()) {\n          setYear(scope.minDate.getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('year', function () {\n        if (!scope.year) {\n          setYear(new Date().getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('ngModel', function () {\n        if (scope.ngModel) {\n          setYear(scope.ngModel.getFullYear());\n          days.classed('selected', function (d) {\n            return scope.ngModel && dateFormat(d) == dateFormat(scope.ngModel);\n          });\n        }\n      });\n\n      var computeMaxMinDateFromCounts = function (dateCounts, computeMax, computeMin) {\n        var stats = null;\n\n        if (!dateCounts || !computeMax && !computeMin) {\n          return;\n        }\n\n        for (var dateFmt in dateCounts) {\n          var date = format2Date(dateFmt);\n\n          if (stats) {\n            stats.min = Math.min(date, stats.min);\n            stats.max = Math.max(date, stats.max);\n          } else {\n            stats = {\n              min: date,\n              max: date\n            };\n          }\n        }\n\n        if (computeMin) {\n          scope.minDate = new Date(stats.min);\n        }\n\n        if (computeMax) {\n          scope.maxDate = new Date(stats.max);\n        }\n      };\n\n      if (canHaveDateCounts()) {\n        scope.$watch('dateCount', function (value) {\n          computeMaxMinDateFromCounts(value, computeMax, computeMin);\n          drawCounts();\n        });\n      }\n    }\n  };\n}).directive('a2Img', function ($compile, $window) {\n  var $ = $window.$;\n  return {\n    restrict: 'E',\n    scope: {},\n    link: function ($scope, $element, $attr) {\n      $element.addClass('a2-img');\n      var loader = $compile('<loader hide-text=\"yes\"></loader>')($scope).appendTo($element);\n      var img = $('<img>').on('load', function () {\n        $element.removeClass('loading');\n      }).appendTo($element);\n      $attr.$observe('a2Src', function (new_src) {\n        if (!new_src) {\n          img.hide();\n          img.attr('src', '');\n          return;\n        }\n\n        img.show();\n        $element.addClass('loading');\n        var image = new Image();\n\n        image.onload = function () {\n          img.attr('src', this.src);\n        };\n\n        image.src = new_src;\n      });\n    }\n  };\n}).directive('a2TrainingSetDataImage', function ($compile, a2TrainingSets) {\n  return {\n    restrict: 'E',\n    scope: {\n      'trainingSet': '=',\n      'datum': '='\n    },\n    template: '<a2-img a2-src=\"{{datum.uri}}\" ng-class=\"resolving ? \\'resolving-uri\\' : \\'\\'\" style=\"width:100%;height:100%;\"></a2-img>',\n    link: function ($scope, $element, $attr) {\n      $element.addClass('a2-training-set-data-image a2-block-inline');\n\n      var resolve_null_uri = function () {\n        if ($scope.datum && $scope.trainingSet && !$scope.datum.url) {\n          var urikey = [$scope.trainingSet.id, $scope.datum.id].join('-');\n\n          if ($scope.resolving != urikey) {\n            $scope.resolving = urikey;\n            a2TrainingSets.getDataImage($scope.trainingSet.id, $scope.datum.id, function (datum2) {\n              $scope.resolving = false;\n\n              if ($scope.datum.id == datum2.id) {\n                $scope.datum.uri = datum2.uri;\n              }\n            });\n          }\n        }\n      };\n\n      $scope.$watch('datum', resolve_null_uri);\n      $scope.$watch('trainingSet', resolve_null_uri);\n    }\n  };\n}).directive('a2InsertIn', function ($window) {\n  var $ = $window.$;\n  var count = 1;\n  return {\n    restrict: 'A',\n    link: function ($scope, $element, $attr) {\n      var anchor = $('<div class=\"a2-insert-in-anchor\"></div>').attr('id', 'a2InsertInAnchor' + count++);\n\n      var is_truthy = function (v) {\n        return v && !/no|false|0/.test('' + v);\n      };\n\n      var keep_position = is_truthy($attr.a2KeepPosition);\n      var target = $($attr.a2InsertIn);\n      $element[0].parentNode.replaceChild(anchor[0], $element[0]);\n      $element.appendTo(target);\n      var reposition_element = null;\n\n      if (keep_position) {\n        var comp_pos = function (el) {\n          return $(el).offset();\n        };\n\n        reposition_element = function () {\n          $('.a2-insert-in-anchor');\n          var po = comp_pos($element.offsetParent());\n          var ao = comp_pos(anchor);\n          ao.position = 'absolute';\n          ao.top -= po.top;\n          ao.left -= po.left;\n          $element.css(ao);\n        };\n\n        $('.a2-insert-in-anchor').parents().each(function (i, e) {\n          var $e = $(e);\n\n          if (!/visible|hidden/.test($e.css('overflow'))) {\n            $e.scroll(reposition_element);\n          }\n        });\n        $scope.$watch(function () {\n          return anchor.offset();\n        }, reposition_element, true);\n        reposition_element();\n      }\n\n      $scope.$watch(function () {\n        return anchor.is(':visible');\n      }, function (visibility) {\n        $element.css('display', visibility ? 'block' : 'none');\n      });\n      anchor.on('$destroy', function () {\n        $element.remove();\n      });\n    }\n  };\n}).directive('a2LineChart', function ($window) {\n  var d3 = $window.d3;\n\n  var drawChart = function (data, options) {\n    var padding = {\n      left: 30,\n      right: 10,\n      top: 10,\n      bottom: 20\n    };\n\n    var getY = function (value) {\n      return value.y;\n    };\n\n    var getX = function (value) {\n      return value.x;\n    };\n\n    var yMin = d3.min(data, getY);\n    var yMax = d3.max(data, getY);\n    var tMin = d3.min(data, getX);\n    var tMax = d3.max(data, getX);\n    var element = options.element;\n    var lineColor = options.lineColor || \"red\";\n    var width = options.width,\n        height = options.height;\n    var xScale = d3.scale.linear().domain([tMin, tMax]).range([padding.left, width - padding.right]);\n    var yScale = d3.scale.linear().domain([yMin, yMax]).range([height - padding.bottom, padding.top]);\n    var line = d3.svg.line().x(function (d) {\n      return xScale(d.x);\n    }).y(function (d) {\n      return yScale(d.y);\n    }).interpolate(\"linear\");\n    var symbol = d3.svg.symbol().type('circle');\n    var xAxis = d3.svg.axis().scale(xScale).ticks(tMax - tMin);\n    var yAxis = d3.svg.axis().scale(yScale).orient('left').ticks(3);\n    var svg = element.append('svg').attr('class', \"graph\").attr('height', height).attr('width', width);\n    svg.append(\"g\").attr(\"class\", \"x axis\").attr(\"transform\", \"translate(0,\" + (height - padding.bottom) + \")\").call(xAxis);\n    svg.append(\"g\").attr(\"class\", \"y axis\").attr(\"transform\", \"translate(\" + padding.left + \",0)\").call(yAxis);\n    var dataG = svg.append('g').datum(data);\n    var path = dataG.append('path').attr('stroke', lineColor).attr('stroke-width', \"2\").attr('fill', \"none\").attr('d', line);\n    var totalLength = path.node().getTotalLength();\n    path.attr(\"stroke-dasharray\", totalLength).attr(\"stroke-dashoffset\", totalLength).transition().delay(200).duration(1000).ease(\"linear\").attr(\"stroke-dashoffset\", 0).each(\"end\", function () {\n      path.attr(\"stroke-dasharray\", null).attr(\"stroke-dashoffset\", null);\n    });\n    dataG.append(\"g\").selectAll('path').data(function (d) {\n      return d;\n    }).enter().append('path').attr('fill', \"transparent\").attr(\"transform\", function (d) {\n      return \"translate(\" + xScale(d.x) + \",\" + yScale(d.y) + \")scale(0.7,0.7)\";\n    }).attr(\"d\", symbol).attr('fill', lineColor).on('mouseenter', function (d) {\n      var body = d3.select('body');\n      var coords = d3.mouse(body.node());\n      var tooltip = body.append('div').datum(d).attr('class', \"graph-tooltip\").style('top', coords[1] - 10 + 'px').style('left', coords[0] - 10 + 'px').on('mouseleave', function () {\n        body.selectAll('.graph-tooltip').remove();\n      }).append('p').text(Math.round(d.y * 1000) / 1000);\n    });\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      values: '=',\n      height: '@',\n      width: '@',\n      color: '@?'\n    },\n    link: function (scope, element, attrs) {\n      scope.$watch('values', function () {\n        if (!scope.values) return;\n        drawChart(scope.values, {\n          lineColor: scope.color,\n          element: d3.select(element[0]),\n          width: Number(scope.width),\n          height: Number(scope.height)\n        });\n      });\n    }\n  };\n}).directive('c3ChartDisplay', function ($window) {\n  var c3 = $window.c3;\n\n  function normalize(data) {\n    if (typeof data != 'object') {\n      return {\n        columns: data\n      };\n    }\n\n    return data;\n  }\n\n  var makeChart = function (element, data, axes) {\n    var celem = element.find('div');\n\n    if (!data || !axes) {\n      celem.remove();\n      return;\n    }\n\n    if (!celem.length) {\n      celem = angular.element('<div></div>').appendTo(element);\n    }\n\n    var args = {\n      bindto: celem[0],\n      data: normalize(data)\n    };\n\n    if (axes) {\n      args.axis = axes;\n    }\n\n    return c3.generate(args);\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      axes: '='\n    },\n    template: '<span></span>',\n    link: function (scope, element, attrs) {\n      var chart;\n      scope.$watch('axes', function (o, n) {\n        if (!chart || o != n) chart = makeChart(element, scope.data, scope.axes, chart);\n      });\n      scope.$watch('data', function (o, n) {\n        if (!chart || o != n) {\n          chart = makeChart(element, scope.data, scope.axes, chart);\n        } else if (chart) {\n          // chart.unload();\n          chart.load(normalize(scope.data));\n        }\n      });\n    }\n  };\n}).directive('a2Info', function () {\n  return {\n    replace: true,\n    restrict: 'E',\n    template: '<i class=\"text-info fa fa-info-circle\"></i>'\n  };\n}).directive('a2BsNgModelOnDirtySaveButton', function ($parse) {\n  return {\n    restrict: 'A',\n    require: 'ngModel',\n    link: function (scope, element, attrs, ngModel) {\n      var saveBtn;\n      var onDirtySaveFN = $parse(attrs.a2BsNgModelOnDirtySaveButton);\n\n      function addSaveBtn() {\n        element.wrap('<div class=\"input-group\"></div>');\n        var parentEl = element.parent();\n        saveBtn = angular.element('<div class=\"input-group-btn\">' + '    <button class=\"btn btn-primary\"><i class=\"fa fa-save\"></i></button>' + '</div>');\n        saveBtn.find('button.btn').on('click', function () {\n          onDirtySaveFN(scope, {\n            $name: ngModel.$name,\n            $modelValue: ngModel.$modelValue,\n            $setPristine: function () {\n              ngModel.$setPristine();\n              removeSaveBtn();\n            }\n          });\n        });\n        saveBtn.appendTo(parentEl);\n      }\n\n      function removeSaveBtn() {\n        if (saveBtn) {\n          saveBtn.remove();\n        }\n\n        element.unwrap();\n        saveBtn = undefined;\n      }\n\n      ngModel.$viewChangeListeners.push(function () {\n        if (ngModel.$dirty && !saveBtn) {\n          addSaveBtn();\n        } else if (saveBtn) {\n          removeSaveBtn();\n        }\n      });\n    }\n  };\n}).factory('canvasObjectURL', function ($window, $q) {\n  var createObjectURL = $window.URL.createObjectURL;\n  var revokeObjectURL = $window.URL.revokeObjectURL;\n\n  if (!createObjectURL && $window.webkitURL.createObjectURL) {\n    createObjectURL = $window.webkitURL.createObjectURL;\n    revokeObjectURL = $window.webkitURL.revokeObjectURL;\n  }\n\n  if (!createObjectURL) {\n    revokeObjectURL = function () {};\n  }\n\n  function dataURIToBinaryBuffer(dataURI) {\n    var BASE64_MARKER = ';base64,';\n    var base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;\n    var base64 = dataURI.substring(base64Index);\n    var raw = $window.atob(base64);\n    var rawLength = raw.length;\n    var array = new $window.Uint8Array(new $window.ArrayBuffer(rawLength));\n\n    for (i = 0; i < rawLength; i++) {\n      array[i] = raw.charCodeAt(i);\n    }\n\n    return array.buffer;\n  }\n\n  function getCanvasBlob(canvas) {\n    if (canvas.toBlob) {\n      return $q(function (resolve) {\n        canvas.toBlob(resolve);\n      });\n    } else {\n      var data = dataURIToBinaryBuffer(canvas.toDataURL(\"image/png\"));\n      var blob;\n      var BlobBuilder = $window.BlobBuilder || $window.WebKitBlobBuilder;\n\n      if (BlobBuilder) {\n        var bb = new WebKitBlobBuilder();\n        bb.append(data);\n        blob = bb.getBlob(\"image/png\");\n      } else {\n        blob = new $window.Blob([data], {\n          type: 'image/png'\n        });\n      }\n\n      return $q.resolve(blob);\n    }\n  }\n\n  return {\n    create: function (canvas) {\n      if (!createObjectURL) {\n        return $q.resolve(canvas.toDataURL(\"image/png\"));\n      }\n\n      return getCanvasBlob(canvas).then(function (blob) {\n        return createObjectURL(blob);\n      });\n    },\n    revoke: revokeObjectURL\n  };\n}).directive('axis', function (canvasObjectURL, $q, $debounce) {\n  var promiseCache = {};\n  var canvas = angular.element('<canvas></canvas>')[0];\n\n  function computeHash(w, h, type, data) {\n    return JSON.stringify([w, h, type, data]);\n  }\n\n  function createAxisData(canvas, w, h, type, data) {\n    if (!w || !h) {\n      return $q.reject(\"Empty canvas size\");\n    }\n\n    canvas.width = w;\n    canvas.height = h;\n    var i;\n    var prec = data.prec || 1;\n    var min = (data.range[0] / prec | 0) * prec;\n    var max = (data.range[1] / prec | 0) * prec;\n    var scale;\n    var unit = data.unit;\n    var count = data.count || 1;\n    var dTick = (((max - min) / prec | 0) / count | 0) * prec;\n    var ctx = canvas.getContext('2d');\n    var w1 = w - 1,\n        h1 = h - 1; // var compStyle = getComputedStyle(canvas);\n\n    ctx.font = data.font;\n    ctx.strokeStyle = data.color;\n    ctx.lineWidth = 0.5;\n    ctx.clearRect(0, 0, w, h);\n    var val,\n        x,\n        y,\n        pad = 3;\n    var lblSize = {\n      w: 0,\n      h: 10\n    };\n    var loopCt = data.loopCt || 250;\n\n    for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n      var tW = ctx.measureText(val + unit).width;\n\n      if (lblSize.w < tW) {\n        lblSize.w = tW;\n      }\n    }\n\n    if (type == 'h') {\n      ctx.textAlign = 'left';\n      ctx.textBaseline = 'top';\n      scale = w / (max - min);\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(w1, 0);\n      ctx.stroke();\n      loopCt = data.loopCt || 250;\n\n      for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n        x = scale * (val - min);\n\n        if (val >= max - dTick) {\n          ctx.textAlign = 'right';\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(x, pad);\n        ctx.lineTo(x, 0);\n        ctx.stroke();\n        ctx.strokeText(val + unit, x, pad);\n      }\n    } else if (type == 'v') {\n      ctx.textAlign = 'right';\n      ctx.textBaseline = 'alphabet';\n      scale = h / (max - min);\n      ctx.beginPath();\n      ctx.moveTo(w1, 0);\n      ctx.lineTo(w1, h1);\n      ctx.stroke();\n      loopCt = data.loopCt || 250;\n\n      for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n        y = h - scale * (val - min);\n\n        if (val >= max - dTick) {\n          ctx.textBaseline = 'top';\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(w1 - pad, y);\n        ctx.lineTo(w1, y);\n        ctx.stroke();\n        ctx.strokeText(val + unit, lblSize.w, y, w1 - pad - 1);\n      }\n    } // {\n    //     range:[0, recording.sample_rate/2000],\n    //     count:10,\n    //     unit:'kHz'\n    // }\n    // console.log(\"drawAxis(\",canvas, w, h, type, data,\")\");\n\n\n    return canvasObjectURL.create(canvas); // return canvas.toDataURL();\n  }\n\n  function drawAxisOnImg(img, w, h, type, data) {\n    var hash = computeHash(w, h, type, data);\n    var axisDataPromise = promiseCache[hash];\n\n    if (!axisDataPromise) {\n      axisDataPromise = promiseCache[hash] = createAxisData(canvas, w, h, type, data);\n    }\n\n    return axisDataPromise.then(function (axisData) {\n      img.src = axisData;\n    });\n  }\n\n  return {\n    restrict: 'E',\n    template: '<img />',\n    scope: {\n      type: \"@\",\n      data: \"=\"\n    },\n    link: function (scope, element, attrs) {\n      var img = element.find('img')[0];\n      var tout;\n      var redrawAxis = $debounce(function () {\n        drawAxisOnImg(img, element.width(), element.height(), scope.type, scope.data);\n      }, 500);\n\n      function elementSize() {\n        return element.width() * element.height();\n      }\n\n      scope.$watch(elementSize, redrawAxis);\n      scope.$watch('type', redrawAxis);\n      scope.$watch('data', redrawAxis);\n    }\n  };\n}).filter('consoleLog', function () {\n  return function (x, type) {\n    console[type || 'log'](x);\n    return x;\n  };\n}).filter('mouseEventContainerPercent', function () {\n  return function ($event, selector) {\n    var target = angular.element($event.currentTarget);\n\n    if (selector) {\n      target = target.closest(selector);\n    }\n\n    var targetpos = target.offset();\n    var px = ($event.pageX - targetpos.left) / target.width();\n    var py = ($event.pageY - targetpos.top) / target.height();\n    return {\n      x: px,\n      y: py\n    };\n  };\n}).directive('onErrorSrc', function () {\n  return {\n    link: function (scope, element, attrs) {\n      element.bind('error', function () {\n        if (attrs.src != attrs.onErrorSrc) {\n          attrs.$set('src', attrs.onErrorSrc);\n        }\n      });\n    }\n  };\n});","angular.module('a2.forms', ['templates-arbimon2']).run(function ($window) {\n  // load zxcvbn \n  var loadZXCVBN = function () {\n    var a, b;\n    b = $window.document.createElement(\"script\");\n    b.src = \"/includes/zxcvbn/zxcvbn.js\";\n    b.type = \"text/javascript\";\n    b.async = !0;\n    a = $window.document.getElementsByTagName(\"script\")[0];\n    return a.parentNode.insertBefore(b, a);\n  };\n\n  if ($window.attachEvent) $window.attachEvent(\"onload\", loadZXCVBN);else $window.addEventListener(\"load\", loadZXCVBN, !1);\n}).directive('passwordInput', function ($window) {\n  return {\n    restrict: 'E',\n    scope: {\n      password: '=ngModel',\n      // password\n      validation: '=',\n      // validation object\n      userInputs: '=?' // array of strings to test password (username, name, lastname, etc)\n\n    },\n    templateUrl: '/directives/password-input.html',\n    controller: function ($scope) {\n      $scope.requiredScore = 2;\n      $scope.minLength = 6;\n      $scope.maxLength = 32;\n      $scope.validation = getValidation();\n\n      function getValidation() {\n        return $scope.validation || ($scope.validation = {\n          confirm: null,\n          result: {},\n          valid: false,\n          msg: ''\n        });\n      }\n\n      if (!$scope.userInputs) {\n        $scope.userInputs = [];\n      }\n\n      $scope.testConfirm = function () {\n        var validation = getValidation();\n        validation.result.confirm = null;\n\n        if (!validation.result.pass || !$scope.password) {\n          return;\n        } else if (validation.result.pass.score < $scope.requiredScore) {\n          $scope.validation.msg = 'password need to be stronger';\n          return;\n        }\n\n        if ($scope.password === validation.confirm) {\n          validation.result.confirm = {\n            ok: true\n          };\n          validation.valid = true;\n          validation.msg = '';\n        } else {\n          validation.result.confirm = {\n            err: \"Passwords do not match\"\n          };\n          validation.msg = validation.result.confirm.err;\n        }\n      };\n\n      $scope.testPass = function () {\n        var validation = getValidation(); // wait for zxcvbn library to be available\n\n        if (typeof $window.zxcvbn === 'undefined') {\n          if ($scope.waitForZxcvbn) return;\n          $scope.waitForZxcvbn = $interval(function () {\n            if (typeof $window.zxcvbn !== 'undefined') {\n              $interval.cancel($scope.waitForZxcvbn);\n              $scope.testPass();\n            }\n          }, 500);\n          return;\n        }\n\n        if ($scope.waitForZxcvbn) {\n          $interval.cancel($scope.waitForZxcvbn);\n        }\n\n        validation.result.pass = null;\n        var colors = ['#da3939', '#da3939', '#84b522', '#62b522', '#31b523'];\n        var mesgs = ['Very Weak', 'Weak', 'Average', 'Strong', 'Very strong'];\n\n        if (!$scope.password) {\n          return;\n        } else if ($scope.password.length < 6 || $scope.password.length > 32) {\n          var size = $scope.password.length < 6 ? 'short' : 'long';\n          validation.result.pass = {\n            shields: [],\n            color: colors[0],\n            msg: 'Password is too ' + size + ', 6-32 characters'\n          };\n          $scope.validation.msg = validation.result.pass.msg;\n        } else {\n          var test = $window.zxcvbn($scope.password, $scope.userInputs);\n          validation.result.pass = {\n            score: test.score,\n            shields: new Array(test.score + 1),\n            color: colors[test.score],\n            msg: mesgs[test.score]\n          };\n          $scope.testConfirm();\n        }\n      };\n    }\n  };\n}).directive('projectForm', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      project: '=ngModel',\n      // password\n      valid: '=' // validation object\n\n    },\n    templateUrl: '/directives/project-form.html',\n    controllerAs: 'controller',\n    controller: function ($scope) {\n      var urlPattern = /^[a-z0-9]+([-_][a-z0-9]+)*$/i;\n      this.deriveUrlFromName = true;\n\n      this.nameChanged = function () {\n        if (this.deriveUrlFromName) {\n          $scope.project.url = ($scope.project.name || '').replace(/[^a-z0-9A-Z-]/g, '-').replace(/-+/g, '-').replace(/(^-)|(-$)/g, '').replace(/[A-Z]/g, function (_1) {\n            return _1.toLowerCase();\n          });\n        }\n\n        $scope.verify();\n      };\n\n      this.urlChanged = function () {\n        this.deriveUrlFromName = false;\n        $scope.verify();\n      };\n\n      $scope.verify = function () {\n        var good = true;\n        $scope.errorName = '';\n        $scope.errorUrl = ''; // check name\n\n        if (!$scope.project.name) {\n          good = false;\n        } else if ($scope.project.name.length < 6 && $scope.project.name.length > 0) {\n          $scope.errorName = 'Name too short, 6 or more characters required';\n          good = false;\n        } else if ($scope.project.name.length > 50) {\n          $scope.errorName = 'Name too long, 50 characters max';\n          good = false;\n        } //check URL\n\n\n        if (!$scope.project.url) {\n          good = false;\n        } else if (!urlPattern.test($scope.project.url)) {\n          $scope.errorUrl = 'Invalid project URL alphanumeric characters ' + 'separated by dash(-) or underscore(_)';\n          good = false;\n        } else if ($scope.project.url.length < 6) {\n          $scope.errorUrl = 'URL too short, 6 or more alphanumeric characters ' + 'separated by dash(-) or underscore(_)';\n          good = false;\n        } else if ($scope.project.url.length > 50) {\n          $scope.errorUrl = 'URL too long, 50 characters max';\n          good = false;\n        }\n\n        $scope.valid = good;\n        return good;\n      };\n\n      if ($scope.project) {\n        $scope.verify();\n      } else {\n        $scope.project = {\n          is_private: 1\n        };\n        $scope.valid = false;\n      }\n\n      $scope.$watch('project', function () {\n        $scope.verify();\n      });\n    }\n  };\n});","angular.module('a2.qr-js', []).directive('a2QrCode', function ($window) {\n  var qr = $window.qr;\n  var $ = $window.$;\n  return {\n    restrict: 'E',\n    scope: {\n      data: '@'\n    },\n    link: function ($scope, $element, $attr) {\n      var canvas = $('<canvas></canvas>').appendTo($element);\n      $attr.$observe('data', function (data) {\n        qr.canvas({\n          canvas: canvas[0],\n          size: 10,\n          level: 'Q',\n          value: data\n        });\n      });\n    }\n  };\n});","angular.module('c3-charts', []).directive('c3Chart', function ($window) {\n  return {\n    restrict: 'E',\n    scope: {\n      columns: '='\n    },\n    link: function (scope, element, attrs) {\n      console.log('corri');\n      $window.chart = scope.chart = $window.c3.generate({\n        bindto: element[0],\n        size: {\n          width: attrs.width,\n          height: attrs.height\n        },\n        tooltip: {\n          show: false\n        },\n        data: {\n          columns: scope.columns || [],\n          type: attrs.type\n        }\n      });\n      scope.$watch('columns', function () {\n        if (scope.columns) {\n          scope.chart.load({\n            columns: scope.columns || []\n          });\n        }\n      });\n    }\n  };\n});","angular.module('a2.directive.error-message', []).directive('errorMessage', function ($http, $window) {\n  var message = '';\n  return {\n    templateUrl: '/directives/error-message.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      message: \"=\"\n    },\n    link: function ($scope) {\n      message = $scope.message;\n    }\n  };\n});","angular.module('a2.directive.frequency_filter_range_control', []).directive('a2VisualizerFrequencyFilterRangeControl', function () {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/frequency_filter_range_control.html',\n    scope: {\n      imgSrc: \"=\",\n      filterMin: \"=\",\n      filterMax: \"=\",\n      maxFreq: \"=\"\n    },\n    link: function (scope, element, attrs) {\n      'use strict';\n\n      var pressed;\n      var container = element.find('.a2-audio-freq-filter-component');\n\n      function detectMouseUp(event) {\n        pressed = undefined;\n        angular.element(document).off('mousemove', detectMouseMove);\n      }\n\n      function detectMouseDown(event) {\n        var btn = event.buttons === undefined ? event.which : event.buttons;\n\n        if (btn == 1) {\n          pressed = event.target;\n          angular.element(document).on('mousemove', detectMouseMove);\n        }\n      }\n\n      function detectMouseMove(event) {\n        if (pressed) {\n          var m = /bottom|top/.exec(pressed.className);\n\n          if (m) {\n            var eloff = container.offset();\n            var y = event.pageY - eloff.top;\n            var ammount = scope.maxFreq * Math.max(0, Math.min(1 - y / pressed.parentNode.clientHeight, 1));\n            ammount = (ammount / 100 | 0) * 100; // cast to int and quantize\n\n            var attr = m[0] == 'top' ? 'filterMax' : 'filterMin';\n            scope[attr] = ammount;\n\n            if (scope.filterMin > scope.filterMax) {\n              scope.filterMax = ammount;\n              scope.filterMin = ammount;\n            }\n\n            scope.$apply();\n          }\n        }\n      }\n\n      container.find('button').on('mousedown', detectMouseDown);\n      container.on('mousemove', function (event) {});\n      angular.element(document).on('mouseup', detectMouseUp);\n      element.on('$destroy', function () {\n        angular.element(document).off('mouseup', detectMouseUp);\n        angular.element(document).off('mousemove', detectMouseMove);\n      });\n    }\n  };\n});","angular.module('g-recaptcha', []).directive('gRecaptcha', function ($interval, $timeout, $window) {\n  return {\n    restrict: \"A\",\n    scope: {\n      sitekey: '@',\n      theme: '@?',\n      type: '@?',\n      response: '=',\n      // readonly captchaResponse \n      resetWidget: '=?' // readonly method to reset the widget\n\n    },\n    link: function (scope, element, attr) {\n      var waitForRecaptcha = $interval(function () {\n        if (typeof $window.grecaptcha !== 'undefined') {\n          $interval.cancel(waitForRecaptcha);\n          var grecaptcha = $window.grecaptcha;\n          scope.widgetId = grecaptcha.render(element[0], {\n            sitekey: scope.sitekey,\n            theme: scope.theme,\n            type: scope.type,\n            callback: function (response) {\n              scope.response = response;\n              scope.$apply();\n              scope.resetTimeout = $timeout(function () {\n                grecaptcha.reset(scope.widgetId);\n              }, 30000);\n            }\n          });\n\n          scope.resetWidget = function () {\n            if (scope.resetTimeout) {\n              $timeout.cancel(scope.resetTimeout);\n            }\n\n            grecaptcha.reset(scope.widgetId);\n          };\n        }\n      }, 500);\n    }\n  };\n});","angular.module('a2.directive.news-feed-item', ['a2.srv.news', 'templates-arbimon2', 'a2.directive.a2-tags', 'a2.filter.time-from-now']).directive('newsFeedItem', function (a2NewsService, $compile) {\n  function parseFormat(format) {\n    var RE_INTERP = /%\\((\\w+)\\)s/g;\n    var interpolate = [],\n        m;\n    var lastidx,\n        matchidx,\n        startidx = 0; // jshint -W084\n\n    while (m = RE_INTERP.exec(format)) {\n      lastidx = startidx;\n      matchidx = RE_INTERP.lastIndex - m[0].length;\n\n      if (lastidx < matchidx) {\n        interpolate.push(format.substr(lastidx, matchidx - lastidx));\n      }\n\n      interpolate.push(\"<span a2-tag-\" + m[1] + \"=\\\"news.data.\" + m[1] + \"\\\" ></span>\");\n      startidx = RE_INTERP.lastIndex;\n    }\n\n    if (startidx < format.length) {\n      interpolate.push(format.substr(startidx));\n    }\n\n    return '<span>' + interpolate.join('') + '</span>';\n  }\n\n  var parsedFormatsPromise = a2NewsService.loadFormats().then(function (formats) {\n    return Object.keys(formats).reduce(function (_, i) {\n      _[i] = parseFormat(formats[i]);\n      return _;\n    }, {});\n  });\n  return {\n    restrict: 'EAC',\n    scope: {\n      news: '=newsFeedItem'\n    },\n    templateUrl: '/directives/news-feed-item.html',\n    link: function (scope, element, attrs) {\n      var message = element.find('.message');\n      scope.$watch('news', function (news) {\n        parsedFormatsPromise.then(function (parsedFormats) {\n          message.empty().append($compile(parsedFormats[news.type])(scope));\n        });\n      });\n    }\n  };\n});","angular.module('a2.directive.plotly-plotter', ['a2.directive.on-resize', 'a2.service.plotly-defaults', 'a2.service.plotly-plot-maker']).directive('plotlyPlotter', function ($window, a2OnResizeService, PlotlyDefaults, plotlyPlotMaker) {\n  return {\n    restrict: 'E',\n    scope: {\n      layout: '=?',\n      data: '=?'\n    },\n    link: function (scope, element, attrs) {\n      function mergeData(data) {\n        return plotlyPlotMaker.mergeData(data, PlotlyDefaults);\n      }\n\n      function mergeLayout(layout) {\n        return plotlyPlotMaker.mergeLayout(layout, PlotlyDefaults);\n      }\n\n      Plotly.newPlot(element[0], mergeData(scope.data), mergeLayout(scope.layout), PlotlyDefaults.config);\n      var resizeWatcher = a2OnResizeService.newWatcher(element, function (newSize) {\n        Plotly.relayout(element[0], newSize);\n      });\n\n      if (attrs.layout) {\n        scope.$watch('layout', function (layout, old) {\n          if (layout && layout != old) {\n            Plotly.relayout(element[0], mergeLayout(layout));\n          }\n        });\n      }\n\n      if (attrs.data) {\n        scope.$watch('data', function (data, old) {\n          if (data && data != old) {\n            // Plotly.purge(element[0]);\n            console.log(\"Plotly plot data ::\", data, scope.layout);\n            Plotly.newPlot(element[0], mergeData(scope.data), mergeLayout(scope.layout), PlotlyDefaults.config);\n          }\n        });\n      }\n\n      scope.$on('$destroy', function () {\n        resizeWatcher.destroy();\n      });\n    }\n  };\n});","angular.module('a2.directive.search-bar', []).directive('searchBar', function ($http, $window) {\n  var q = '';\n  var projectsLoading;\n  var projects = [];\n  return {\n    templateUrl: '/directives/search-bar.html',\n    restrict: 'E',\n    scope: {\n      projectsLoading: \"=?\",\n      q: \"=?\",\n      isUnsafe: \"@\"\n    },\n    link: function ($scope) {\n      $scope.q = q;\n      $scope.projectsLoading = projectsLoading;\n      $scope.projects = projects;\n\n      $scope.findProject = function () {\n        var config = {\n          params: {\n            publicTemplates: true\n          }\n        };\n\n        if ($scope.q !== '') {\n          config.params.q = $scope.q;\n        }\n\n        $scope.projectsLoading = true;\n        return $http.get('/api/user/projectlist', config).then(function (result) {\n          $scope.projectsLoading = false;\n          $scope.projects = result.data;\n          return result.data;\n        });\n      };\n\n      $scope.selectProject = function () {\n        if (!$scope.q || $scope.q && !$scope.q.is_enabled) {\n          return;\n        }\n\n        $window.location.assign('/project/' + $scope.q.url + '/');\n      };\n    }\n  };\n});","angular.module('arbimon2.directive.validation-dropdown', []).directive('validationDropdown', function () {\n  var empty_option = {\n    label: undefined,\n    val: undefined\n  };\n  var val_options = [{\n    label: \"Clear\",\n    val: 2\n  }, {\n    label: \"Present\",\n    val: 1\n  }, {\n    label: \"Absent\",\n    val: 0\n  }];\n  var by_val = val_options.reduce(function (_, option) {\n    _[option.val] = option;\n    return _;\n  }, {});\n  return {\n    templateUrl: '/directives/validation-dropdown.html',\n    require: 'ngModel',\n    scope: {},\n    link: function (scope, element, attrs, ngModelCtrl) {\n      scope.options = val_options;\n\n      function updateLabel(val) {\n        var option = val < 2 && by_val[val] ? by_val[val] : empty_option;\n        scope.val = option.val;\n        scope.label = option.label;\n      }\n\n      scope.select = function (val) {\n        updateLabel(val);\n        ngModelCtrl.$$lastCommittedViewValue = undefined;\n        ngModelCtrl.$modelValue = undefined;\n        ngModelCtrl.$setViewValue(val, true);\n      };\n\n      ngModelCtrl.$render = function () {\n        updateLabel(ngModelCtrl.$viewValue);\n      };\n    }\n  };\n});","angular.module('a2.directive.warning-banner', []).directive('warningBanner', function ($http, $window) {\n  var message = 0;\n  return {\n    templateUrl: '/directives/warning-banner.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      message: \"=\"\n    },\n    link: function ($scope) {\n      message = $scope.message;\n    }\n  };\n});","angular.module('a2.googlemaps', []).provider(\"a2GoogleMapsLoader\", function () {\n  var defer;\n  var apiKey;\n\n  function loadScript($window, $q) {\n    if (!defer) {\n      return;\n    }\n\n    var cb_name = 'gmcb';\n\n    while ($window[cb_name]) {\n      cb_name += '_';\n    }\n\n    $window[cb_name] = function () {\n      defer.resolve($window.google);\n    };\n\n    var script = $window.document.createElement('script');\n    var params = ['callback=' + cb_name];\n\n    if (apiKey) {\n      params.push('key=' + apiKey);\n    }\n\n    script.src = $window.document.location.protocol + '//maps.googleapis.com/maps/api/js?' + params.join('&');\n    $window.document.body.appendChild(script);\n  }\n\n  return {\n    setAPIKey: function (key) {\n      apiKey = key;\n    },\n    $get: function ($window, $q) {\n      if (!defer) {\n        defer = $q.defer();\n        loadScript($window, $q);\n      }\n\n      return defer.promise;\n    }\n  };\n});","angular.module('a2.heremaps', []).constant('a2HereMarkerTextIconTemplate', '<div class=\"map-marker\">' + '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"28px\" height=\"36px\">' + '<path d=\"M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z\" fill=\"#000\" fill-opacity=\".2\"/>' + '<path d=\"M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z\" fill=\"#fff\"/>' + '<path d=\"M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z\" fill=\"#18d\"/>' + '</svg>' + '<span>${text}</span>' + '</div>').provider(\"a2HereMapsLoader\", function (a2HereMarkerTextIconTemplate) {\n  var loadPromise;\n  var appId;\n  var appCode;\n\n  function loadScript($window, $q) {\n    function loadOneScript(src) {\n      return $q(function (resolve, reject) {\n        var script = $window.document.createElement('script');\n        script.src = $window.document.location.protocol + src;\n        script.addEventListener('load', resolve);\n        script.addEventListener('error', reject);\n        $window.document.body.appendChild(script);\n      });\n    }\n\n    return loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-core.js\").then(function () {\n      return $q.all([loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-service.js\"), loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-ui.js\"), loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-mapevents.js\")]);\n    }).then(function () {\n      var api = $window.H;\n      return {\n        api: api,\n        makeTextIcon: function (text) {\n          return new H.map.DomIcon(a2HereMarkerTextIconTemplate.replace('${text}', text));\n        },\n        platform: new api.service.Platform({\n          app_id: appId,\n          app_code: appCode,\n          useHTTPS: /https/.test($window.document.location.protocol)\n        })\n      };\n    });\n  }\n\n  return {\n    setAPIIdAndCode: function (id, code) {\n      appId = id;\n      appCode = code;\n    },\n    $get: function ($window, $q) {\n      if (!loadPromise) {\n        loadPromise = loadScript($window, $q);\n      }\n\n      return loadPromise;\n    }\n  };\n});","angular.module('a2.permissions', ['a2.services', 'ng-permissions']).run(function ($rootScope, a2UserPermit) {\n  $rootScope.userPermit = a2UserPermit;\n}).service('a2UserPermit', function ($http, Project, $q, permits) {\n  var permit = permits;\n  return {\n    all: permit.permissions,\n    isSuper: function () {\n      return permit.super;\n    },\n    isRfcx: function () {\n      return permit.rfcxUser;\n    },\n    isAuthorized: function () {\n      return permit.isAuthorized;\n    },\n    isProjectMember: function () {\n      return permit.isAuthorized && (permit.permissions && permit.permissions.length > 0 || permit.super || permit.rfcxUser);\n    },\n    getUserEmail: function () {\n      return permit.userEmail;\n    },\n    has: function (feature) {\n      return permit.features && permit.features[feature];\n    },\n    can: function (perm) {\n      var allowed;\n\n      if (permit.permissions) {\n        allowed = (Array.isArray(perm) ? perm : [perm]).reduce(function (_, perm) {\n          return _ && permit.permissions.indexOf(perm) !== -1;\n        }, true);\n      }\n\n      return allowed || permit.super;\n    }\n  };\n});","angular.module('a2.utils-browser-metrics', []).service('a2BrowserMetrics', function () {\n  var metrics = {};\n  var css = {\n    \"border\": \"none\",\n    \"height\": \"200px\",\n    \"margin\": \"0\",\n    \"padding\": \"0\",\n    \"width\": \"200px\"\n  };\n  var inner = $(\"<div>\").css($.extend({}, css));\n  var outer = $(\"<div>\").css($.extend({\n    \"left\": \"-1000px\",\n    \"overflow\": \"scroll\",\n    \"position\": \"absolute\",\n    \"top\": \"-1000px\"\n  }, css)).append(inner).appendTo(\"body\").scrollLeft(1000).scrollTop(1000);\n  metrics.scrollSize = {\n    height: outer.offset().top - inner.offset().top | 0,\n    width: outer.offset().left - inner.offset().left | 0\n  };\n  outer.remove();\n  return metrics;\n});","angular.module('a2.utils', ['a2.utils-browser-metrics']).factory('$templateFetch', function ($http, $templateCache) {\n  return function $templateFetch(templateUrl, linker) {\n    var template = $templateCache.get(templateUrl);\n\n    if (template) {\n      if (template.promise) {\n        template.linkers.push(linker);\n      } else {\n        linker(template);\n      }\n    } else {\n      var tmp_promise = {\n        linkers: [linker],\n        promise: $http.get(templateUrl).success(function (template) {\n          $templateCache.put(templateUrl, template);\n\n          for (var i = 0, l = tmp_promise.linkers, e = l.length; i < e; ++i) {\n            l[i](template);\n          }\n        })\n      };\n      $templateCache.put(templateUrl, tmp_promise);\n    }\n  };\n}).factory('a2EventEmitter', function ($q) {\n  function a2EventEmitter() {\n    this.list = {};\n  }\n\n  a2EventEmitter.prototype = {\n    on: function (event, callback) {\n      var list = this.list[event] || (this.list[event] = []);\n      list.push(callback);\n      return callback;\n    },\n    off: function (event, callback) {\n      var list = this.list[event];\n\n      if (list) {\n        var idx = list.indexOf(callback);\n\n        if (idx) {\n          list.splice(idx, 1);\n        }\n      }\n    },\n    emit: function (event) {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var list = this.list[event];\n\n      if (list) {\n        for (var i = 0, e = list.length; i < e; ++i) {\n          list[i].apply(null, args);\n        }\n      }\n\n      return $q.resolve();\n    }\n  };\n  return a2EventEmitter;\n}).factory('itemSelection', function () {\n  return {\n    make: function make_itemSelection_obj(item_name) {\n      var sel = {};\n\n      if (typeof item_name == 'undefined') {\n        item_name = 'value';\n      }\n\n      sel[item_name] = null;\n\n      sel.select = function (newValue) {\n        sel[item_name] = newValue;\n      };\n\n      return sel;\n    }\n  };\n}) // display localtime formated by momentjs\n.filter('moment', function () {\n  return function (input, fmt) {\n    if (!input) return undefined;\n    return moment(input).format(fmt);\n  };\n}) // display UTC formated by momentjs\n.filter('momentUtc', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return moment(x).utc().format(fmt);\n  };\n}) // display site localtime formated by momentjs\n.filter('momentTz', function () {\n  return function (x, fmt, timezone) {\n    if (!x) {\n      return undefined;\n    }\n\n    return moment.tz(x, timezone).format(fmt);\n  };\n}) // divides array of into pages of limitPerPage size\n.filter('paginate', function () {\n  return function (arr, currentPage, limitPerPage) {\n    if (!arr) return undefined;\n    return arr.slice((currentPage - 1) * limitPerPage, currentPage * limitPerPage);\n  };\n})\n/** Pluralizes singular words accoring to some heuristics that (hopefully)\n *  look like english grammar.\n */\n.filter('plural', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return x + 's';\n  };\n}) // replace underscores or dashes for spaces\n.filter('worded', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return ('' + x).replace(/[_-]/g, ' ');\n  };\n}) // capitalize words\n.filter('wordCaps', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return ('' + x).replace(/\\b(\\w)/g, function (_1) {\n      return _1.toUpperCase();\n    });\n  };\n})\n/**\n * @ngdoc factory\n * @name a2.utils.factory:$debounce\n * @description asynchronous debouncing function decorator\n * Decorates an asynchronous function with a debouncing function. A debouncing\n * function withholds the function call by a set ammount of time and wait for\n * any othe function calls, resetting the wait for time every call. After its wait\n * time, the function gets called with the last given arguments and context.\n * @param {Function} fn - the function to debounce\n * @param {Function} rate - the timeout\n * @return {Promise} resolved with the function's return value.\n */\n.factory('$debounce', function ($timeout, $q, $log) {\n  return function $debounce(fn, rate) {\n    var timeoutPromise, qDefer, debouncePromise;\n    rate = rate || 100;\n    return function () {\n      var self = this;\n      var args = Array.prototype.slice.call(arguments);\n\n      if (timeoutPromise) {\n        $timeout.cancel(timeoutPromise);\n      }\n\n      if (!qDefer) {\n        qDefer = $q.defer();\n        debouncePromise = qDefer.promise.then(function () {\n          // qDefer got resolved. forget it's reference in case of recursivity.\n          qDefer = null;\n          return fn.apply(self, args);\n        });\n      }\n\n      timeoutPromise = $timeout(function () {\n        qDefer.resolve();\n      }, rate);\n      return debouncePromise;\n    };\n  };\n}).factory('a2LookaheadHelper', function ($q) {\n  var a2LookaheadHelper = function (options) {\n    this.options = options || {};\n\n    if (!options.searchCompare) {\n      options.searchCompare = function (a, b) {\n        return a == b;\n      };\n    }\n  };\n\n  a2LookaheadHelper.prototype = {\n    search: function (text) {\n      var options = this.options;\n\n      if (options.minLength && text.length < options.minLength) {\n        return $q.resolve([]);\n      }\n\n      var promise = options.fn(text);\n\n      if (options.includeSearch) {\n        promise = promise.then(function (items) {\n          var textItem = items.filter(function (item) {\n            return options.searchCompare(text, item);\n          }).pop();\n\n          if (!textItem) {\n            items.unshift(options.searchPromote ? options.searchPromote(text) : text);\n          }\n\n          return items;\n        });\n      }\n\n      return promise;\n    }\n  };\n  return a2LookaheadHelper;\n}).service('EventlistManager', function () {\n  var EventlistManager = function () {\n    this.events = {};\n  };\n\n  EventlistManager.prototype.get_event_def = function (event) {\n    if (!this.events[event]) {\n      this.events[event] = {};\n    }\n\n    return this.events[event];\n  };\n\n  EventlistManager.prototype.send = function ()\n  /* ...args */\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var event = args.shift();\n\n    if (typeof event == 'string') {\n      event = {\n        event: event\n      };\n    }\n\n    var eventdef = this.get_event_def(event.event);\n\n    if (event.oneTime) {\n      eventdef.oneTime = true;\n    }\n\n    var context = event.context;\n    var listeners = eventdef.listeners;\n    eventdef.fired = true;\n\n    if (listeners) {\n      listeners.forEach(function (l) {\n        l.apply(context, args);\n      });\n    }\n  };\n\n  EventlistManager.prototype.on = function (event, fn) {\n    var eventdef = this.get_event_def(event);\n\n    if (eventdef.fired && eventdef.oneTime) {\n      fn.apply();\n    } else {\n      if (!eventdef.listeners) {\n        eventdef.listeners = [];\n      }\n\n      eventdef.listeners.push(fn);\n    }\n  };\n\n  return EventlistManager;\n}); // TODO break to multiple files\n\nangular.module('a2.infotags', ['a2.services']).directive('a2Species', function (Species, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      species: '='\n    },\n    template: '{{data.scientific_name}}',\n    link: function ($scope, $element, $attrs) {\n      $scope.$watch('species', function (newVal, oldVal) {\n        $scope.data = null;\n\n        if (newVal) {\n          Species.findById(newVal, function (data) {\n            $timeout(function () {\n              $scope.data = data;\n            });\n          });\n        }\n      });\n    }\n  };\n}).directive('a2.songtype', function (Songtypes, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      songtype: '='\n    },\n    template: '{{data.name}}',\n    link: function ($scope, $element, $attrs) {\n      $scope.$watch('songtype', function (newVal, oldVal) {\n        $scope.data = null;\n\n        if (newVal) {\n          Songtypes.findById(newVal, function (data) {\n            $timeout(function () {\n              $scope.data = data;\n            });\n          });\n        }\n      });\n    }\n  };\n}); // TODO break to multiple files\n\nangular.module('a2.classy', []).factory('makeClass', function ($inheritFrom) {\n  var slice = Array.prototype.slice;\n  return function makeClass(classdef) {\n    if (!classdef.constructor) {\n      classdef.constructor = classdef.super && classdef.super.constructor ? function super_constructor() {\n        this.super.constructor.apply(this, slice.call(arguments));\n      } : function empty_constructor() {};\n    }\n\n    if (classdef.static) {\n      angular.extend(classdef.constructor, classdef.static);\n      delete classdef.static;\n    }\n\n    if (classdef.super) {\n      classdef = $inheritFrom(classdef.super, classdef);\n    }\n\n    classdef.constructor.prototype = classdef;\n    (window.qc || (window.qc = [])).push(classdef);\n    return classdef.constructor;\n  };\n}).value('$inheritFrom', function $inheritFrom(object) {\n  var fn = function () {};\n\n  fn.prototype = object;\n\n  if (arguments.length > 1) {\n    var args = Array.prototype.slice.call(arguments);\n    args[0] = new fn();\n    return angular.extend.apply(angular, args);\n  } else {\n    return new fn();\n  }\n});","angular.module(\"a2.srv.app-listings\", ['a2.srv.api']).service(\"AppListingsService\", function (a2APIService) {\n  return {\n    getFor: function (app) {\n      return a2APIService.api.get('/app-listings/' + app);\n    }\n  };\n});","angular.module('a2.service.colorscale-gradients', []).service('ColorscaleGradients', function () {\n  var g = [];\n\n  for (var i = 0; i < 256; ++i) {\n    var j = 255 - i;\n    g.push('rgb(' + j + ',' + j + ',' + j + ')');\n  }\n\n  var ColorscaleGradients = {\n    gradients: [['#4400e5', '#4000e5', '#3c00e5', '#3700e5', '#3300e5', '#2f00e5', '#2a00e5', '#2600e5', '#2200e5', '#1d00e5', '#1900e5', '#1500e5', '#1100e5', '#0c00e5', '#0800e5', '#0400e5', '#0000e5', '#0004e5', '#0008e5', '#000de5', '#0011e5', '#0015e5', '#001ae5', '#001ee5', '#0022e5', '#0027e5', '#002be5', '#002fe5', '#0034e5', '#0038e5', '#003ce5', '#0041e5', '#0045e5', '#0049e5', '#004ee5', '#0052e5', '#0056e5', '#005ae5', '#005fe5', '#0063e5', '#0067e5', '#006ce5', '#0070e5', '#0074e5', '#0079e5', '#007de5', '#0081e5', '#0086e5', '#008ae5', '#008ee5', '#0093e5', '#0097e5', '#009be5', '#00a0e5', '#00a4e5', '#00a8e5', '#00ade5', '#00b1e5', '#00b5e5', '#00bae5', '#00bee5', '#00c2e5', '#00c6e5', '#00cbe5', '#00e543', '#00e53f', '#00e53b', '#00e536', '#00e532', '#00e52e', '#00e529', '#00e525', '#00e521', '#00e51c', '#00e518', '#00e514', '#00e50f', '#00e50b', '#00e507', '#00e502', '#01e500', '#05e500', '#09e500', '#0ee500', '#12e500', '#16e500', '#1be500', '#1fe500', '#23e500', '#28e500', '#2ce500', '#30e500', '#35e500', '#39e500', '#3de500', '#42e500', '#46e500', '#4ae500', '#4fe500', '#53e500', '#57e500', '#5ce500', '#60e500', '#64e500', '#69e500', '#6de500', '#71e500', '#75e500', '#7ae500', '#7ee500', '#82e500', '#87e500', '#8be500', '#8fe500', '#94e500', '#98e500', '#9ce500', '#a1e500', '#a5e500', '#a9e500', '#aee500', '#b2e500', '#b6e500', '#bbe500', '#bfe500', '#c3e500', '#c8e500', '#cce500', '#e5e401', '#e5e303', '#e5e106', '#e5e008', '#e5df0b', '#e5de0d', '#e5dc10', '#e5db12', '#e5da15', '#e5d917', '#e5d81a', '#e5d71c', '#e5d51f', '#e5d422', '#e5d324', '#e5d227', '#e5d229', '#e5d12c', '#e5d02e', '#e5cf31', '#e5ce33', '#e5cd36', '#e5cd38', '#e5cc3b', '#e5cb3d', '#e5cb40', '#e5ca42', '#e5c945', '#e5c947', '#e5c84a', '#e5c84c', '#e5c74f', '#e5c751', '#e5c754', '#e5c656', '#e5c659', '#e5c65b', '#e5c55e', '#e5c561', '#e5c563', '#e5c566', '#e5c468', '#e5c46b', '#e5c46d', '#e5c470', '#e5c472', '#e5c475', '#e5c477', '#e5c47a', '#e5c47c', '#e5c57f', '#e5c581', '#e5c584', '#e5c586', '#e5c589', '#e5c68b', '#e5c68e', '#e5c690', '#e5c793', '#e5c795', '#e5c898', '#e5c89a', '#e5c99d', '#e5c9a0', '#916225', '#926328', '#93652a', '#95672c', '#96682f', '#986a31', '#996c33', '#9a6d36', '#9c6f38', '#9d713a', '#9f723d', '#a0743f', '#a27641', '#a37744', '#a47946', '#a67a48', '#a77c4b', '#a97e4d', '#aa7f4f', '#ab8152', '#ad8354', '#ae8456', '#b08659', '#b1885b', '#b2895d', '#b48b60', '#b58d62', '#b78e64', '#b89067', '#ba9269', '#bb936b', '#bc956e', '#be9670', '#bf9872', '#c19a75', '#c29b77', '#c39d79', '#c59f7c', '#c6a07e', '#c8a280', '#c9a483', '#caa585', '#cca787', '#cda98a', '#cfaa8c', '#d0ac8e', '#d2ad91', '#d3af93', '#d4b195', '#d6b298', '#d7b49a', '#d9b69c', '#dab79f', '#dbb9a1', '#ddbba3', '#debca6', '#e0bea8', '#e1c0aa', '#e2c1ad', '#e4c3af', '#e5c5b1', '#e7c6b4', '#e8c8b6', '#eacab9'], ['#ffffff', '#fefefe', '#fdfdfd', '#fcfcfc', '#fbfbfb', '#fafafa', '#f9f9f9', '#f8f8f8', '#f7f7f7', '#f6f6f6', '#f5f5f5', '#f4f4f4', '#f3f3f3', '#f2f2f2', '#f1f1f1', '#f0f0f0', '#efefef', '#eeeeee', '#ededed', '#ececec', '#ebebeb', '#eaeaea', '#e9e9e9', '#e8e8e8', '#e7e7e7', '#e6e6e6', '#e5e5e5', '#e4e4e4', '#e3e3e3', '#e2e2e2', '#e1e1e1', '#e0e0e0', '#dfdfdf', '#dedede', '#dddddd', '#dcdcdc', '#dbdbdb', '#dadada', '#d9d9d9', '#d8d8d8', '#d7d7d7', '#d6d6d6', '#d5d5d5', '#d4d4d4', '#d3d3d3', '#d2d2d2', '#d1d1d1', '#d0d0d0', '#cfcfcf', '#cecece', '#cdcdcd', '#cccccc', '#cbcbcb', '#cacaca', '#c9c9c9', '#c8c8c8', '#c7c7c7', '#c6c6c6', '#c5c5c5', '#c4c4c4', '#c3c3c3', '#c2c2c2', '#c1c1c1', '#c0c0c0', '#bfbfbf', '#bebebe', '#bdbdbd', '#bcbcbc', '#bbbbbb', '#bababa', '#b9b9b9', '#b8b8b8', '#b7b7b7', '#b6b6b6', '#b5b5b5', '#b4b4b4', '#b3b3b3', '#b2b2b2', '#b1b1b1', '#b0b0b0', '#afafaf', '#aeaeae', '#adadad', '#acacac', '#ababab', '#aaaaaa', '#a9a9a9', '#a8a8a8', '#a7a7a7', '#a6a6a6', '#a5a5a5', '#a4a4a4', '#a3a3a3', '#a2a2a2', '#a1a1a1', '#a0a0a0', '#9f9f9f', '#9e9e9e', '#9d9d9d', '#9c9c9c', '#9b9b9b', '#9a9a9a', '#999999', '#989898', '#979797', '#969696', '#959595', '#949494', '#939393', '#929292', '#919191', '#909090', '#8f8f8f', '#8e8e8e', '#8d8d8d', '#8c8c8c', '#8b8b8b', '#8a8a8a', '#898989', '#888888', '#878787', '#868686', '#858585', '#848484', '#838383', '#828282', '#818181', '#808080', '#7f7f7f', '#7e7e7e', '#7d7d7d', '#7c7c7c', '#7b7b7b', '#7a7a7a', '#797979', '#787878', '#777777', '#767676', '#757575', '#747474', '#737373', '#727272', '#717171', '#707070', '#6f6f6f', '#6e6e6e', '#6d6d6d', '#6c6c6c', '#6b6b6b', '#6a6a6a', '#696969', '#686868', '#676767', '#666666', '#656565', '#646464', '#636363', '#626262', '#616161', '#606060', '#5f5f5f', '#5e5e5e', '#5d5d5d', '#5c5c5c', '#5b5b5b', '#5a5a5a', '#595959', '#585858', '#575757', '#565656', '#555555', '#545454', '#535353', '#525252', '#515151', '#505050', '#4f4f4f', '#4e4e4e', '#4d4d4d', '#4c4c4c', '#4b4b4b', '#4a4a4a', '#494949', '#484848', '#474747', '#464646', '#454545', '#444444', '#434343', '#424242', '#414141', '#404040', '#3f3f3f', '#3e3e3e', '#3d3d3d', '#3c3c3c', '#3b3b3b', '#3a3a3a', '#393939', '#383838', '#373737', '#363636', '#353535', '#343434', '#333333', '#323232', '#313131', '#303030', '#2f2f2f', '#2e2e2e', '#2d2d2d', '#2c2c2c', '#2b2b2b', '#2a2a2a', '#292929', '#282828', '#272727', '#262626', '#252525', '#242424', '#232323', '#222222', '#212121', '#202020', '#1f1f1f', '#1e1e1e', '#1d1d1d', '#1c1c1c', '#1b1b1b', '#1a1a1a', '#191919', '#181818', '#171717', '#161616', '#151515', '#141414', '#131313', '#121212', '#111111', '#101010', '#0f0f0f', '#0e0e0e', '#0d0d0d', '#0c0c0c', '#0b0b0b', '#0a0a0a', '#090909', '#080808', '#070707', '#060606', '#050505', '#040404', '#030303', '#020202', '#010101', '#000000'], ['#0a0000', '#0d0000', '#0f0000', '#120000', '#150000', '#170000', '#1a0000', '#1c0000', '#1f0000', '#220000', '#240000', '#270000', '#2a0000', '#2c0000', '#2f0000', '#310000', '#340000', '#370000', '#390000', '#3c0000', '#3f0000', '#410000', '#440000', '#460000', '#490000', '#4c0000', '#4e0000', '#510000', '#540000', '#560000', '#590000', '#5b0000', '#5e0000', '#610000', '#630000', '#660000', '#690000', '#6b0000', '#6e0000', '#700000', '#730000', '#760000', '#780000', '#7b0000', '#7e0000', '#800000', '#830000', '#850000', '#880000', '#8b0000', '#8d0000', '#900000', '#930000', '#950000', '#980000', '#9a0000', '#9d0000', '#a00000', '#a20000', '#a50000', '#a80000', '#aa0000', '#ad0000', '#af0000', '#b20000', '#b50000', '#b70000', '#ba0000', '#bd0000', '#bf0000', '#c20000', '#c40000', '#c70000', '#ca0000', '#cc0000', '#cf0000', '#d20000', '#d40000', '#d70000', '#d90000', '#dc0000', '#df0000', '#e10000', '#e40000', '#e70000', '#e90000', '#ec0000', '#ee0000', '#f10000', '#f40000', '#f60000', '#f90000', '#fc0000', '#fe0000', '#ff0200', '#ff0500', '#ff0700', '#ff0a00', '#ff0c00', '#ff0f00', '#ff1200', '#ff1400', '#ff1700', '#ff1a00', '#ff1c00', '#ff1f00', '#ff2100', '#ff2400', '#ff2700', '#ff2900', '#ff2c00', '#ff2f00', '#ff3100', '#ff3400', '#ff3600', '#ff3900', '#ff3c00', '#ff3e00', '#ff4100', '#ff4400', '#ff4600', '#ff4900', '#ff4b00', '#ff4e00', '#ff5100', '#ff5300', '#ff5600', '#ff5900', '#ff5b00', '#ff5e00', '#ff6000', '#ff6300', '#ff6600', '#ff6800', '#ff6b00', '#ff6e00', '#ff7000', '#ff7300', '#ff7500', '#ff7800', '#ff7b00', '#ff7d00', '#ff8000', '#ff8300', '#ff8500', '#ff8800', '#ff8a00', '#ff8d00', '#ff9000', '#ff9200', '#ff9500', '#ff9700', '#ff9a00', '#ff9d00', '#ff9f00', '#ffa200', '#ffa500', '#ffa700', '#ffaa00', '#ffac00', '#ffaf00', '#ffb200', '#ffb400', '#ffb700', '#ffba00', '#ffbc00', '#ffbf00', '#ffc100', '#ffc400', '#ffc700', '#ffc900', '#ffcc00', '#ffcf00', '#ffd100', '#ffd400', '#ffd600', '#ffd900', '#ffdc00', '#ffde00', '#ffe100', '#ffe400', '#ffe600', '#ffe900', '#ffeb00', '#ffee00', '#fff100', '#fff300', '#fff600', '#fff900', '#fffb00', '#fffe00', '#ffff02', '#ffff06', '#ffff0a', '#ffff0e', '#ffff12', '#ffff16', '#ffff1a', '#ffff1e', '#ffff22', '#ffff26', '#ffff2a', '#ffff2e', '#ffff32', '#ffff36', '#ffff3a', '#ffff3e', '#ffff41', '#ffff45', '#ffff49', '#ffff4d', '#ffff51', '#ffff55', '#ffff59', '#ffff5d', '#ffff61', '#ffff65', '#ffff69', '#ffff6d', '#ffff71', '#ffff75', '#ffff79', '#ffff7d', '#ffff80', '#ffff84', '#ffff88', '#ffff8c', '#ffff90', '#ffff94', '#ffff98', '#ffff9c', '#ffffa0', '#ffffa4', '#ffffa8', '#ffffac', '#ffffb0', '#ffffb4', '#ffffb8', '#ffffbc', '#ffffbf', '#ffffc3', '#ffffc7', '#ffffcb', '#ffffcf', '#ffffd3', '#ffffd7', '#ffffdb', '#ffffdf', '#ffffe3', '#ffffe7', '#ffffeb', '#ffffef', '#fffff3', '#fffff7', '#fffffb', '#ffffff'], ['#000000', '#120102', '#240204', '#360306', '#490408', '#5b050a', '#6d060c', '#7f070e', '#920810', '#a40912', '#b60a14', '#c90b16', '#db0c18', '#ed0d1a', '#fe0e1c', '#f90f1e', '#f41020', '#ef1122', '#ea1224', '#e51326', '#e01428', '#db152a', '#d6162c', '#d1172e', '#cc1830', '#c71932', '#c21a34', '#bd1b36', '#b81c38', '#b41d3a', '#af1e3c', '#aa1f3e', '#a52040', '#a02041', '#9b2244', '#962346', '#912448', '#8c2449', '#87264c', '#82274e', '#7d2850', '#782851', '#732a54', '#6e2b56', '#692c58', '#642c59', '#5f2e5c', '#5a2f5e', '#553060', '#503061', '#4b3264', '#463366', '#413468', '#3c3469', '#37366c', '#32376e', '#2d3870', '#283871', '#233a74', '#1e3b76', '#193c78', '#143c79', '#0f3e7c', '#0a3f7e', '#404080', '#414182', '#414183', '#434386', '#444488', '#45458a', '#46468c', '#47478e', '#484890', '#494992', '#494993', '#4b4b96', '#4c4c98', '#4d4d9a', '#4e4e9c', '#4f4f9e', '#5050a0', '#5151a2', '#5151a3', '#5353a6', '#5454a8', '#5555aa', '#5656ac', '#5757ae', '#5858b0', '#5959b2', '#5959b3', '#5b5bb6', '#5c5cb8', '#5d5dba', '#5e5ebc', '#5f5fbe', '#6060c0', '#6161c2', '#6161c3', '#6363c6', '#6464c8', '#6565ca', '#6666cc', '#6767ce', '#6868d0', '#6969d2', '#6969d3', '#6b6bd6', '#6c6cd8', '#6d6dda', '#6e6edc', '#6f6fde', '#7070e0', '#7171e2', '#7171e3', '#7373e6', '#7474e8', '#7575ea', '#7676ec', '#7777ee', '#7878f0', '#7979f2', '#7979f3', '#7b7bf6', '#7c7cf8', '#7d7dfa', '#7e7efc', '#7f7ffe', '#8080fc', '#8181f8', '#8282f4', '#8383f0', '#8383eb', '#8485e7', '#8686e3', '#8787df', '#8888da', '#8989d6', '#8a8ad2', '#8b8bce', '#8c8cc9', '#8d8dc5', '#8e8ec1', '#8f8fbd', '#9090b8', '#9191b4', '#9292b0', '#9393ac', '#9393a7', '#9595a3', '#96969f', '#97979a', '#989896', '#999992', '#9a9a8e', '#9b9b89', '#9c9c85', '#9d9d81', '#9e9e7d', '#9f9f78', '#a0a074', '#a1a170', '#a2a26c', '#a3a367', '#a3a363', '#a5a55f', '#a6a65b', '#a7a756', '#a8a852', '#a9a94e', '#aaaa4a', '#abab45', '#acac41', '#adad3d', '#aeae39', '#afaf34', '#b0b030', '#b1b12c', '#b2b228', '#b3b323', '#b3b31f', '#b5b51b', '#b6b617', '#b7b712', '#b8b80e', '#b9b90a', '#baba06', '#bbbb01', '#bcbc02', '#bdbd05', '#bebe09', '#bfbf0d', '#c0c011', '#c1c115', '#c2c218', '#c3c31c', '#c3c320', '#c4c524', '#c5c627', '#c7c72b', '#c8c82f', '#c9c933', '#caca37', '#cbcb3a', '#cbcc3e', '#cdcd42', '#cece46', '#cfcf49', '#d0d04d', '#d1d151', '#d2d255', '#d3d358', '#d3d35c', '#d5d560', '#d6d664', '#d7d768', '#d8d86b', '#d9d96f', '#dada73', '#dbdb77', '#dcdc7a', '#dddd7e', '#dede82', '#dfdf86', '#e0e08a', '#e1e18d', '#e2e291', '#e3e395', '#e3e399', '#e5e59c', '#e6e6a0', '#e7e7a4', '#e8e8a8', '#e9e9ab', '#eaeaaf', '#ebebb3', '#ececb7', '#ededbb', '#eeeebe', '#efefc2', '#f0f0c6', '#f1f1ca', '#f2f2cd', '#f3f3d1', '#f3f3d5', '#f4f5d9', '#f5f6dd', '#f7f7e0', '#f8f8e4', '#f9f9e8', '#fafaec', '#fbfbef', '#fbfcf3', '#fdfdf7', '#fefefb', '#ffffff'], ['#000080', '#000776', '#000e6d', '#001563', '#001d5a', '#002450', '#002b47', '#00333e', '#003a34', '#00412b', '#004821', '#005018', '#00570f', '#005e05', '#005816', '#005126', '#004a37', '#004348', '#003d58', '#003669', '#002f79', '#00288a', '#00219b', '#001bab', '#0014bc', '#000dcd', '#0006dd', '#0000ee', '#000eff', '#001cff', '#002aff', '#0038ff', '#0046ff', '#0054ff', '#0062ff', '#0070ff', '#007fff', '#008dff', '#009bff', '#00a9ff', '#00b7ff', '#00c0ff', '#00c5ff', '#00caff', '#00ceff', '#00d2ff', '#00d7ff', '#00dbff', '#00e0ff', '#00e4ff', '#00e8ff', '#00edff', '#00f1fe', '#00f6f8', '#00faf1', '#00feeb', '#00fee4', '#00fede', '#00fdd7', '#00fdd1', '#00fcca', '#00fcc3', '#00fbbd', '#00fbb6', '#00fab0', '#00faa9', '#00faa3', '#00fa9c', '#00fa92', '#00fa87', '#00fa7d', '#00fa72', '#00fb68', '#00fb5d', '#00fc53', '#00fc49', '#00fc3e', '#00fd34', '#00fd29', '#00fe1f', '#06fe14', '#0cfe0a', '#13fb00', '#19f700', '#1ff300', '#26ef00', '#2cec00', '#32e800', '#39e400', '#3fe000', '#46dd00', '#4cd900', '#52d500', '#59d100', '#5fce00', '#65d100', '#67d400', '#69d700', '#6bdb00', '#6dde00', '#6fe100', '#71e400', '#73e800', '#75eb00', '#77ee00', '#79f100', '#7bf500', '#7df803', '#7ffb07', '#84fe0b', '#88ff0f', '#8dff13', '#91ff17', '#96ff1b', '#9aff1f', '#9fff23', '#a4ff27', '#a8ff2b', '#adff2f', '#b1ff33', '#b6ff37', '#baff3b', '#bfff37', '#c3ff33', '#c8ff2f', '#ccff2b', '#d1ff27', '#d6ff23', '#daff1f', '#dfff1b', '#e3ff17', '#e8ff13', '#ecff0f', '#f1ff0b', '#f5fc07', '#fafa03', '#fff700', '#fff500', '#fff200', '#fff000', '#ffed00', '#ffeb00', '#ffe800', '#ffe600', '#ffe300', '#ffe100', '#ffde00', '#ffdc00', '#ffda00', '#ffd701', '#ffd502', '#ffd203', '#ffd004', '#ffcd05', '#ffcb06', '#ffc807', '#ffc608', '#ffc309', '#ffc10a', '#ffbe0b', '#ffbc0c', '#ffb90d', '#ffb10d', '#ffa90c', '#ffa10b', '#ff990a', '#ff9109', '#ff8808', '#ff8007', '#ff7806', '#ff7005', '#ff6804', '#ff5f03', '#ff5702', '#ff4f01', '#ff4700', '#ff4200', '#ff3d00', '#ff3900', '#ff3400', '#ff2f00', '#ff2a00', '#ff2600', '#ff2100', '#ff1c00', '#ff1700', '#ff1300', '#ff0e00', '#ff0900', '#ff0411', '#ff0023', '#ff0035', '#ff0046', '#ff0058', '#ff006a', '#ff007b', '#ff008d', '#ff009f', '#ff00b1', '#ff00c2', '#ff00d4', '#ff00e6', '#ff00f8', '#f803fb', '#f106ff', '#ea0aff', '#e30dff', '#dc11ff', '#d514ff', '#ce18ff', '#c71bff', '#c11eff', '#ba22ff', '#b325ff', '#ac29ff', '#a52cfe', '#9e32fd', '#a438fc', '#aa3efb', '#b044fa', '#b64af8', '#bc50f7', '#c256f6', '#c75cf5', '#cd61f4', '#d367f2', '#d96df1', '#df73f0', '#e579ef', '#eb7fee', '#ec84ee', '#ec88ef', '#ed8df0', '#ee92f0', '#ef96f1', '#ef9bf1', '#f09ff2', '#f1a4f3', '#f1a9f3', '#f2adf4', '#f3b2f4', '#f4b7f5', '#f4bbf6', '#f5c0f6', '#f6c5f7', '#f6c9f7', '#f7cef8', '#f8d2f9', '#f9d7f9', '#f9dcfa', '#fae0fa', '#fbe5fb', '#fbeafc', '#fceefc', '#fdf3fd', '#fef7fe'] // ['#ffffff', '#fefefe', '#fdfdfd', '#fcfcfc', '#fbfbfb', '#fafafa', '#f9f9f9', '#f8f8f8', '#f7f7f7', '#f6f6f6', '#f5f5f5', '#f4f4f4', '#f3f3f3', '#f2f2f2', '#f1f1f1', '#f0f0f0', '#efefef', '#eeeeee', '#ededed', '#ececec', '#ebebeb', '#eaeaea', '#e9e9e9', '#e8e8e8', '#e7e7e7', '#e6e6e6', '#e5e5e5', '#e4e4e4', '#e3e3e3', '#e2e2e2', '#e1e1e1', '#e0e0e0', '#dfdfdf', '#dedede', '#dddddd', '#dcdcdc', '#dbdbdb', '#dadada', '#d9d9d9', '#d8d8d8', '#d7d7d7', '#d6d6d6', '#d5d5d5', '#d3d3d3', '#d3d3d3', '#d2d2d2', '#d1d1d1', '#d0d0d0', '#cfcfcf', '#cecece', '#cdcdcd', '#cccccc', '#cbcbcb', '#cacaca', '#c9c9c9', '#c8c8c8', '#c7c7c7', '#c6c6c6', '#c5c5c5', '#c3c3c3', '#c3c3c3', '#c2c2c2', '#c1c1c1', '#c0c0c0', '#bfbfbf', '#bebebe', '#bdbdbd', '#bcbcbc', '#bbbbbb', '#bababa', '#b9b9b9', '#b8b8b8', '#b7b7b7', '#b6b6b6', '#b5b5b5', '#b3b3b3', '#b3b3b3', '#b2b2b2', '#b1b1b1', '#b0b0b0', '#afafaf', '#aeaeae', '#adadad', '#acacac', '#ababab', '#aaaaaa', '#a9a9a9', '#a8a8a8', '#a7a7a7', '#a6a6a6', '#a5a5a5', '#a3a3a3', '#a3a3a3', '#a2a2a2', '#a1a1a1', '#a0a0a0', '#9f9f9f', '#9e9e9e', '#9d9d9d', '#9c9c9c', '#9b9b9b', '#9a9a9a', '#999999', '#989898', '#979797', '#969696', '#959595', '#939393', '#939393', '#929292', '#919191', '#909090', '#8f8f8f', '#8e8e8e', '#8d8d8d', '#8c8c8c', '#8b8b8b', '#8a8a8a', '#898989', '#888888', '#878787', '#868686', '#858585', '#838383', '#838383', '#828282', '#818181', '#808080', '#7f7f7f', '#7e7e7e', '#7d7d7d', '#7c7c7c', '#7b7b7b', '#797979', '#797979', '#787878', '#777777', '#767676', '#757575', '#747474', '#727272', '#717171', '#717171', '#707070', '#6f6f6f', '#6e6e6e', '#6d6d6d', '#6c6c6c', '#6b6b6b', '#696969', '#696969', '#686868', '#676767', '#666666', '#656565', '#646464', '#626262', '#616161', '#616161', '#606060', '#5f5f5f', '#5e5e5e', '#5d5d5d', '#5c5c5c', '#5b5b5b', '#595959', '#595959', '#585858', '#575757', '#565656', '#555555', '#545454', '#525252', '#515151', '#515151', '#505050', '#4f4f4f', '#4e4e4e', '#4d4d4d', '#4c4c4c', '#4b4b4b', '#494949', '#494949', '#484848', '#474747', '#464646', '#454545', '#444444', '#424242', '#414141', '#414141', '#404040', '#3f3f3f', '#3e3e3e', '#3d3d3d', '#3c3c3c', '#3b3b3b', '#393939', '#383838', '#383838', '#373737', '#363636', '#353535', '#343434', '#323232', '#313131', '#303030', '#303030', '#2f2f2f', '#2e2e2e', '#2d2d2d', '#2c2c2c', '#2b2b2b', '#292929', '#282828', '#282828', '#272727', '#262626', '#252525', '#242424', '#222222', '#212121', '#202020', '#202020', '#1f1f1f', '#1e1e1e', '#1d1d1d', '#1c1c1c', '#1b1b1b', '#191919', '#181818', '#181818', '#171717', '#161616', '#151515', '#141414', '#121212', '#111111', '#101010', '#101010', '#0f0f0f', '#0e0e0e', '#0d0d0d', '#0c0c0c', '#0b0b0b', '#090909', '#080808', '#080808', '#070707', '#060606', '#050505', '#040404', '#020202', '#010101', '#000000', '#000000'],\n    // ['#000000', '#010000', '#030000', '#040000', '#060000', '#070000', '#090000', '#0a0000', '#0c0000', '#0d0000', '#0f0000', '#100000', '#120000', '#130000', '#150000', '#160000', '#180000', '#190000', '#1b0000', '#1c0000', '#1e0000', '#1f0000', '#200000', '#220000', '#240000', '#250000', '#270000', '#280000', '#2a0000', '#2b0000', '#2c0000', '#2e0000', '#300000', '#310000', '#330000', '#340000', '#360000', '#370000', '#380000', '#3a0000', '#3c0000', '#3d0000', '#3f0000', '#400000', '#410000', '#430000', '#450000', '#460000', '#480000', '#490000', '#4b0000', '#4c0000', '#4e0000', '#4f0000', '#510000', '#520000', '#540000', '#550000', '#570000', '#580000', '#590000', '#5b0000', '#5d0000', '#5e0000', '#600000', '#610000', '#620000', '#640000', '#660000', '#670000', '#690000', '#6a0000', '#6c0000', '#6d0000', '#6e0000', '#700000', '#710000', '#730000', '#750000', '#760000', '#780000', '#790000', '#7a0000', '#7c0000', '#7e0000', '#7f0000', '#810000', '#820000', '#830000', '#850000', '#860000', '#880000', '#8a0000', '#8b0000', '#8d0000', '#8e0000', '#900000', '#910000', '#930000', '#940000', '#960000', '#970000', '#990000', '#9a0000', '#9c0000', '#9d0000', '#9f0000', '#a00000', '#a20000', '#a30000', '#a50000', '#a60000', '#a80000', '#a90000', '#ab0000', '#ac0000', '#ae0000', '#af0000', '#b10000', '#b20000', '#b30000', '#b50000', '#b60000', '#b80000', '#ba0000', '#bb0000', '#bd0000', '#be0000', '#c00000', '#c10200', '#c30400', '#c40600', '#c50800', '#c70b00', '#c90d00', '#ca0f00', '#cc1000', '#cd1200', '#cf1400', '#d01600', '#d21900', '#d31b00', '#d51d00', '#d61f00', '#d82000', '#d92200', '#db2400', '#dc2600', '#dd2800', '#df2b00', '#e12d00', '#e22f00', '#e33000', '#e53200', '#e63400', '#e83600', '#ea3900', '#eb3b00', '#ed3d00', '#ee3f00', '#f04100', '#f14200', '#f34400', '#f44600', '#f54800', '#f74b00', '#f94d00', '#fa4f00', '#fc5100', '#fd5200', '#ff5400', '#ff5600', '#ff5900', '#ff5b00', '#ff5d00', '#ff5f00', '#ff6100', '#ff6200', '#ff6400', '#ff6600', '#ff6800', '#ff6b00', '#ff6d00', '#ff6f00', '#ff7100', '#ff7200', '#ff7400', '#ff7600', '#ff7900', '#ff7b00', '#ff7d00', '#ff7f00', '#ff8102', '#ff8306', '#ff840a', '#ff860e', '#ff8812', '#ff8b17', '#ff8d1b', '#ff8f1f', '#ff9122', '#ff9326', '#ff942a', '#ff962e', '#ff9933', '#ff9b37', '#ff9d3b', '#ff9f3f', '#ffa142', '#ffa346', '#ffa44a', '#ffa64e', '#ffa852', '#ffab57', '#ffad5b', '#ffaf5f', '#ffb162', '#ffb366', '#ffb46a', '#ffb66e', '#ffb973', '#ffbb77', '#ffbd7b', '#ffbf7f', '#ffc183', '#ffc386', '#ffc48a', '#ffc68e', '#ffc892', '#ffcb97', '#ffcd9b', '#ffcf9f', '#ffd1a3', '#ffd3a6', '#ffd4aa', '#ffd6ae', '#ffd9b3', '#ffdbb7', '#ffddbb', '#ffdfbf', '#ffe1c3', '#ffe3c6', '#ffe4ca', '#ffe6ce', '#ffe8d2', '#ffebd7', '#ffeddb', '#ffefdf', '#fff1e3', '#fff3e6', '#fff4ea', '#fff6ee', '#fff9f3', '#fffbf7', '#fffdfb', '#ffffff'],\n    // ['#00007f', '#000084', '#000088', '#00008d', '#000091', '#000096', '#00009a', '#00009f', '#0000a3', '#0000a8', '#0000ac', '#0000b1', '#0000b6', '#0000ba', '#0000bf', '#0000c3', '#0000c8', '#0000cc', '#0000d1', '#0000d5', '#0000da', '#0000de', '#0000e3', '#0000e8', '#0000ec', '#0000f1', '#0000f5', '#0000fa', '#0000fe', '#0000ff', '#0000ff', '#0000ff', '#0000ff', '#0004ff', '#0008ff', '#000cff', '#0010ff', '#0014ff', '#0018ff', '#001cff', '#0020ff', '#0024ff', '#0028ff', '#002cff', '#0030ff', '#0034ff', '#0038ff', '#003cff', '#0040ff', '#0044ff', '#0048ff', '#004cff', '#0050ff', '#0054ff', '#0058ff', '#005cff', '#0060ff', '#0064ff', '#0068ff', '#006cff', '#0070ff', '#0074ff', '#0078ff', '#007cff', '#0080ff', '#0084ff', '#0088ff', '#008cff', '#0090ff', '#0094ff', '#0098ff', '#009cff', '#00a0ff', '#00a4ff', '#00a8ff', '#00acff', '#00b0ff', '#00b4ff', '#00b8ff', '#00bcff', '#00c0ff', '#00c4ff', '#00c8ff', '#00ccff', '#00d0ff', '#00d4ff', '#00d8ff', '#00dcfe', '#00e0fa', '#00e4f7', '#02e8f4', '#05ecf1', '#08f0ed', '#0cf4ea', '#0ff8e7', '#12fce4', '#15ffe1', '#18ffdd', '#1cffda', '#1fffd7', '#22ffd4', '#25ffd0', '#29ffcd', '#2cffca', '#2fffc7', '#32ffc3', '#36ffc0', '#39ffbd', '#3cffba', '#3fffb7', '#42ffb3', '#46ffb0', '#49ffad', '#4cffaa', '#4fffa6', '#53ffa3', '#56ffa0', '#59ff9d', '#5cff9a', '#5fff96', '#63ff93', '#66ff90', '#69ff8d', '#6cff89', '#70ff86', '#73ff83', '#76ff80', '#79ff7d', '#7cff79', '#80ff76', '#83ff73', '#86ff70', '#89ff6c', '#8dff69', '#90ff66', '#93ff63', '#96ff5f', '#9aff5c', '#9dff59', '#a0ff56', '#a3ff53', '#a6ff4f', '#aaff4c', '#adff49', '#b0ff46', '#b3ff42', '#b7ff3f', '#baff3c', '#bdff39', '#c0ff36', '#c3ff32', '#c7ff2f', '#caff2c', '#cdff29', '#d0ff25', '#d4ff22', '#d7ff1f', '#daff1c', '#ddff18', '#e0ff15', '#e4ff12', '#e7ff0f', '#eaff0c', '#edff08', '#f1fc05', '#f4f802', '#f7f400', '#faf000', '#feed00', '#ffe900', '#ffe500', '#ffe200', '#ffde00', '#ffda00', '#ffd700', '#ffd300', '#ffcf00', '#ffcb00', '#ffc800', '#ffc400', '#ffc000', '#ffbd00', '#ffb900', '#ffb500', '#ffb100', '#ffae00', '#ffaa00', '#ffa600', '#ffa300', '#ff9f00', '#ff9b00', '#ff9800', '#ff9400', '#ff9000', '#ff8c00', '#ff8900', '#ff8500', '#ff8100', '#ff7e00', '#ff7a00', '#ff7600', '#ff7300', '#ff6f00', '#ff6b00', '#ff6700', '#ff6400', '#ff6000', '#ff5c00', '#ff5900', '#ff5500', '#ff5100', '#ff4d00', '#ff4a00', '#ff4600', '#ff4200', '#ff3f00', '#ff3b00', '#ff3700', '#ff3400', '#ff3000', '#ff2c00', '#ff2800', '#ff2500', '#ff2100', '#ff1d00', '#ff1a00', '#ff1600', '#fe1200', '#fa0f00', '#f50b00', '#f10700', '#ec0300', '#e80000', '#e30000', '#de0000', '#da0000', '#d50000', '#d10000', '#cc0000', '#c80000', '#c30000', '#bf0000', '#ba0000', '#b60000', '#b10000', '#ac0000', '#a80000', '#a30000', '#9f0000', '#9a0000', '#960000', '#910000', '#8d0000', '#880000', '#840000', '#7f0000'],\n    // ['#000000', '#00002b', '#010038', '#010043', '#02004e', '#030058', '#030063', '#04006e', '#050273', '#050474', '#060674', '#070974', '#070b74', '#080d74', '#091075', '#091275', '#0a1475', '#0b1675', '#0b1975', '#0c1b75', '#0d1d76', '#0d2076', '#0e2276', '#0f2476', '#0f2776', '#102977', '#112b77', '#112d77', '#123077', '#133277', '#133477', '#143678', '#153878', '#153a78', '#163c78', '#173e78', '#174079', '#184279', '#194579', '#194779', '#1a4979', '#1b4b79', '#1b4d7a', '#1c4f7a', '#1d517a', '#1d537a', '#1e547a', '#1f567b', '#1f587b', '#205a7b', '#215c7b', '#215e7b', '#22607b', '#23617c', '#23637c', '#24657c', '#25667c', '#25687c', '#26697d', '#276b7d', '#276d7d', '#286e7d', '#29707d', '#29717d', '#2a737e', '#2b747e', '#2b767e', '#2c787e', '#2d797e', '#2d7b7f', '#2e7c7f', '#2f7e7f', '#2f7f7f', '#30807e', '#30817d', '#31817b', '#31827a', '#328279', '#328378', '#338477', '#338475', '#348574', '#348573', '#358672', '#358670', '#36876f', '#36886e', '#37886d', '#37896c', '#38896a', '#388a69', '#388a68', '#398b67', '#398c65', '#3a8c64', '#3a8d63', '#3b8d62', '#3b8e61', '#3c8e5f', '#3c8f5e', '#3d905d', '#3d905c', '#3e915a', '#3e9159', '#3f9258', '#3f9357', '#409355', '#409454', '#409453', '#419552', '#419551', '#42964f', '#42974e', '#43974d', '#43984c', '#44984a', '#449949', '#459948', '#479a47', '#499b46', '#4b9b46', '#4e9c47', '#509c47', '#529d48', '#549d48', '#579e49', '#599f4a', '#5b9f4a', '#5da04b', '#5fa04b', '#62a14c', '#64a14d', '#66a24d', '#68a34e', '#6ba34e', '#6da34f', '#6fa44f', '#71a450', '#73a551', '#76a551', '#78a652', '#79a652', '#7ba752', '#7da752', '#7ea753', '#80a853', '#82a853', '#83a954', '#85a954', '#87aa54', '#88aa55', '#8aab55', '#8cab55', '#8dab56', '#8fac56', '#91ac56', '#92ad57', '#94ad57', '#96ae57', '#97ae58', '#99ae58', '#9aaf58', '#9caf58', '#9eb059', '#9fb059', '#a1b159', '#a3b15a', '#a4b25a', '#a6b25a', '#a8b25b', '#a9b35b', '#abb35b', '#adb45c', '#aeb45c', '#b0b55c', '#b2b55d', '#b3b55d', '#b5b65d', '#b6b65e', '#b7b55e', '#b7b55e', '#b8b45f', '#b8b35f', '#b9b25f', '#b9b15f', '#b9b060', '#baaf60', '#baaf60', '#bbae61', '#bbad61', '#bcac61', '#bcab62', '#bcaa62', '#bda962', '#bda963', '#bea863', '#bea763', '#bea664', '#bfa564', '#bfa464', '#c0a365', '#c0a367', '#c1a369', '#c2a36c', '#c3a46e', '#c5a471', '#c6a573', '#c7a676', '#c8a678', '#c9a77b', '#caa87d', '#cba97f', '#ccaa82', '#ceab84', '#cfac87', '#d0ad89', '#d1ad8c', '#d2ae8e', '#d3af91', '#d4b093', '#d5b196', '#d6b298', '#d8b39a', '#d9b59d', '#dab69f', '#dbb7a2', '#dcb9a4', '#ddbaa7', '#debca9', '#dfbdac', '#e1bfaf', '#e2c1b2', '#e3c3b5', '#e4c5b8', '#e5c7bb', '#e6c9be', '#e7cbc1', '#e8cdc4', '#e9cfc7', '#ebd1ca', '#ecd3cd', '#edd5d0', '#eed7d3', '#efd9d6', '#f0dcd9', '#f1dedc', '#f2e0df', '#f4e3e2', '#f5e6e5', '#f6e9e8', '#f7eceb', '#f8efee', '#f9f2f1', '#faf5f4', '#fbf8f7', '#fdfafa'],\n    // ['#000000', '#010101', '#020202', '#030303', '#040404', '#050505', '#060606', '#070707', '#080808', '#090909', '#0a0a0a', '#0b0b0b', '#0c0c0c', '#0d0d0d', '#0e0e0e', '#0f0f0f', '#101010', '#111111', '#121212', '#131313', '#141414', '#151515', '#161616', '#171717', '#181818', '#191919', '#1a1a1a', '#1b1b1b', '#1c1c1c', '#1d1d1d', '#1e1e1e', '#1f1f1f', '#202020', '#202020', '#222222', '#232323', '#242424', '#242424', '#262626', '#272727', '#282828', '#282828', '#2a2a2a', '#2b2b2b', '#2c2c2c', '#2c2c2c', '#2e2e2e', '#2f2f2f', '#303030', '#303030', '#323232', '#333333', '#343434', '#343434', '#363636', '#373737', '#383838', '#383838', '#3a3a3a', '#3b3b3b', '#3c3c3c', '#3c3c3c', '#3e3e3e', '#3f3f3f', '#404040', '#414141', '#414141', '#434343', '#444444', '#454545', '#464646', '#474747', '#484848', '#494949', '#494949', '#4b4b4b', '#4c4c4c', '#4d4d4d', '#4e4e4e', '#4f4f4f', '#505050', '#515151', '#515151', '#535353', '#545454', '#555555', '#565656', '#575757', '#585858', '#595959', '#595959', '#5b5b5b', '#5c5c5c', '#5d5d5d', '#5e5e5e', '#5f5f5f', '#606060', '#616161', '#616161', '#636363', '#646464', '#656565', '#666666', '#676767', '#686868', '#696969', '#696969', '#6b6b6b', '#6c6c6c', '#6d6d6d', '#6e6e6e', '#6f6f6f', '#707070', '#717171', '#717171', '#737373', '#747474', '#757575', '#767676', '#777777', '#787878', '#797979', '#797979', '#7b7b7b', '#7c7c7c', '#7d7d7d', '#7e7e7e', '#7f7f7f', '#808080', '#818181', '#828282', '#838383', '#838383', '#858585', '#868686', '#878787', '#888888', '#898989', '#8a8a8a', '#8b8b8b', '#8c8c8c', '#8d8d8d', '#8e8e8e', '#8f8f8f', '#909090', '#919191', '#929292', '#939393', '#939393', '#959595', '#969696', '#979797', '#989898', '#999999', '#9a9a9a', '#9b9b9b', '#9c9c9c', '#9d9d9d', '#9e9e9e', '#9f9f9f', '#a0a0a0', '#a1a1a1', '#a2a2a2', '#a3a3a3', '#a3a3a3', '#a5a5a5', '#a6a6a6', '#a7a7a7', '#a8a8a8', '#a9a9a9', '#aaaaaa', '#ababab', '#acacac', '#adadad', '#aeaeae', '#afafaf', '#b0b0b0', '#b1b1b1', '#b2b2b2', '#b3b3b3', '#b3b3b3', '#b5b5b5', '#b6b6b6', '#b7b7b7', '#b8b8b8', '#b9b9b9', '#bababa', '#bbbbbb', '#bcbcbc', '#bdbdbd', '#bebebe', '#bfbfbf', '#c0c0c0', '#c1c1c1', '#c2c2c2', '#c3c3c3', '#c3c3c3', '#c5c5c5', '#c6c6c6', '#c7c7c7', '#c8c8c8', '#c9c9c9', '#cacaca', '#cbcbcb', '#cccccc', '#cdcdcd', '#cecece', '#cfcfcf', '#d0d0d0', '#d1d1d1', '#d2d2d2', '#d3d3d3', '#d3d3d3', '#d5d5d5', '#d6d6d6', '#d7d7d7', '#d8d8d8', '#d9d9d9', '#dadada', '#dbdbdb', '#dcdcdc', '#dddddd', '#dedede', '#dfdfdf', '#e0e0e0', '#e1e1e1', '#e2e2e2', '#e3e3e3', '#e3e3e3', '#e5e5e5', '#e6e6e6', '#e7e7e7', '#e8e8e8', '#e9e9e9', '#eaeaea', '#ebebeb', '#ececec', '#ededed', '#eeeeee', '#efefef', '#f0f0f0', '#f1f1f1', '#f2f2f2', '#f3f3f3', '#f3f3f3', '#f5f5f5', '#f6f6f6', '#f7f7f7', '#f8f8f8', '#f9f9f9', '#fafafa', '#fbfbfb', '#fcfcfc', '#fdfdfd', '#fefefe', '#ffffff']\n    ],\n    normalize: function (idx) {\n      var grad = ColorscaleGradients.gradients[idx];\n      var len = grad.length - 1;\n      return grad.map(function (_, i) {\n        return [i / len, _];\n      });\n    }\n  };\n  return ColorscaleGradients;\n});","angular.module('countries-list', []).service('countries', function ($http) {\n  var countries;\n  return {\n    get: function (callback) {\n      if (countries) return callback(countries);\n      $http.get('/api/orders/countries').success(function (data) {\n        countries = data;\n        callback(countries);\n      });\n    }\n  };\n});","angular.module('humane', []).factory('notify', function ($window) {\n  var humane = $window.humane;\n  humane.timeout = 6000;\n  humane.baseCls = \"humane-original\";\n  humane.error = humane.spawn({\n    addnCls: humane.baseCls + '-error'\n  });\n  humane.info = humane.spawn({\n    addnCls: humane.baseCls + '-info'\n  });\n  humane.success = humane.spawn({\n    addnCls: humane.baseCls + '-success'\n  });\n\n  humane.serverError = function () {\n    humane.error(\"Error communicating with server\");\n  };\n\n  return humane;\n});","angular.module('a2.service.plotly-plot-maker', []).service('plotlyPlotMaker', function () {\n  var plotlyPlotMaker = {\n    range: function range(start, count, step) {\n      var _ = [];\n\n      for (var i = 0, x = start; i < count; ++i, x += step) {\n        _.push(x);\n      }\n\n      return _;\n    },\n    mergeData: function mergeData(data, defaults) {\n      return (data || []).map(function (datum) {\n        return angular.merge(angular.copy(defaults[datum.type] || {}), datum);\n      });\n    },\n    mergeLayout: function mergeLayout(layout, defaults) {\n      return angular.merge(angular.copy(defaults.layout), layout);\n    },\n    makeHeatmapPlot: function (x, y, z, data, title) {\n      var plot = {\n        data: {\n          type: 'heatmap',\n          hoverinfo: 'x+y+z',\n          colorbar: {\n            title: z.title\n          } // connectgaps:true,\n\n        },\n        layout: {\n          title: title,\n          xaxis: {\n            boundsmode: 'auto',\n            title: x.title,\n            ticksuffix: x.units || ''\n          },\n          yaxis: {\n            boundsmode: 'auto',\n            title: y.title,\n            ticksuffix: y.units || ''\n          }\n        }\n      };\n\n      if (data.rows) {\n        plot.data.x = data.rows.map(function (_) {\n          return data.x.min + data.x.step * _.x;\n        });\n        plot.data.y = data.rows.map(function (_) {\n          return data.y.min + data.y.step * _.y;\n        });\n        plot.data.z = data.rows.map(function (_) {\n          return _.z;\n        });\n      } else if (data.matrix) {\n        plot.data.x = plotlyPlotMaker.range(data.x.min, data.x.bins, data.x.step);\n        plot.data.y = plotlyPlotMaker.range(data.y.min, data.y.bins, data.y.step);\n        plot.data.z = data.matrix;\n      }\n\n      return plot;\n    },\n    makeBarPlot: function (x, y, data, title) {\n      var plot = {\n        data: {\n          orientation: 'v',\n          type: 'bar'\n        },\n        layout: {\n          title: title,\n          xaxis: {\n            boundsmode: 'auto',\n            title: x.title,\n            ticksuffix: x.units || ''\n          },\n          yaxis: {\n            boundsmode: 'auto',\n            title: y.title\n          }\n        }\n      };\n\n      if (data.rows) {\n        plot.data.x = data.rows.map(function (_) {\n          return data.x.min + data.x.step * _.x;\n        });\n        plot.data.y = data.rows.map(function (_) {\n          return _.z;\n        });\n      } else if (data.matrix) {\n        plot.data.x = plotlyPlotMaker.range(data.x.min, data.x.bins, data.x.step);\n        plot.data.y = data.matrix[0];\n      }\n\n      return plot;\n    }\n  };\n  return plotlyPlotMaker;\n});","angular.module('a2-plot-specs', ['a2.utils-browser-metrics']).factory('PlotSpecs', function (a2BrowserMetrics) {\n  return {\n    gutter: a2BrowserMetrics.scrollSize.height,\n    axis_sizew: 60,\n    axis_sizeh: 60,\n    legend_axis_w: 45,\n    legend_width: 60,\n    legend_gutter: 30,\n    axis_lead: 15\n  };\n});","angular.module('a2.service.plotly-defaults', ['a2-plot-specs', 'a2.service.colorscale-gradients']).provider('PlotlyDefaults', function () {\n  var PlotlyDefaults = {\n    defaults: {},\n    set: function (newDefaults, extend) {\n      if (extend) {\n        PlotlyDefaults.defaults = angular.merge(defaults, newDefaults);\n      } else {\n        PlotlyDefaults.defaults = newDefaults;\n      }\n    },\n    $get: function (PlotlyDefaultDefaults) {\n      return angular.merge(PlotlyDefaultDefaults, PlotlyDefaults.defaults);\n    }\n  };\n  return PlotlyDefaults;\n}).service('PlotlyDefaultDefaults', function (PlotSpecs, ColorscaleGradients) {\n  var defaults = {\n    titlefont: {\n      family: '\"Helvetica Neue\", Helvetica, Arial, sans-serif',\n      size: '14px'\n    },\n    tickfont: {\n      family: 'sans-serif',\n      size: '11px',\n      color: '#fff'\n    }\n  };\n  defaults.config = {\n    showLink: false,\n    sendData: false,\n    displaylogo: false,\n    displayModeBar: true,\n    scrollZoom: true,\n    modeBarButtonsToRemove: ['sendDataToCloud', 'autoScale2d']\n  };\n  defaults.layout = {\n    xaxis: {\n      titlefont: defaults.titlefont,\n      tickfont: defaults.tickfont,\n      color: '#fff'\n    },\n    yaxis: {\n      titlefont: defaults.titlefont,\n      tickfont: defaults.tickfont,\n      color: '#fff'\n    },\n    // margin:{l:70 + 25,r:0,b:25,t:50, pad:0},\n    plot_bgcolor: '#131525',\n    paper_bgcolor: '#131525',\n    dragmode: 'pan'\n  };\n  defaults.colorbar = {\n    tickfont: defaults.tickfont,\n    thickness: PlotSpecs.legend_width - PlotSpecs.legend_axis_w\n  };\n  defaults.heatmap = {\n    colorscale: ColorscaleGradients.normalize(0),\n    colorbar: defaults.colorbar\n  };\n  return defaults;\n});","angular.module('a2.url-update-service', []).factory('a2UrlUpdate', function () {\n  return {\n    cache: {},\n    prefix: '_t_',\n    clear: function () {\n      this.cache = {};\n    },\n    update: function (url) {\n      url = this.get(url);\n      var qidx = url.indexOf('?');\n      var url2;\n\n      var _t_ = new Date().getTime();\n\n      if (qidx >= 0) {\n        var re = new RegExp('(^|&)' + this.prefix + '=(\\\\d+)');\n        var query = url.substr(qidx + 1);\n        var m = re.exec(query);\n\n        if (m) {\n          url2 = url.substr(0, qidx) + '?' + query.replace(re, this.prefix + '=' + _t_);\n        } else {\n          url2 = url + '&' + this.prefix + '=' + _t_;\n        }\n      } else {\n        url2 = url + '?' + this.prefix + '=' + _t_;\n      }\n\n      this.cache[url] = url2;\n      $('[src=\"' + url + '\"]').attr('src', '').attr('src', url2);\n    },\n    get: function (url) {\n      var url2;\n\n      while (url2 = this.cache[url]) {\n        url = url2;\n      }\n\n      return url;\n    }\n  };\n}).filter('a2UpdatedUrl', function (a2UrlUpdate) {\n  return function (url) {\n    return a2UrlUpdate.get(url);\n  };\n});","angular.module('a2.utils.external-api-loader', ['a2.utils.global-anonymous-function']).provider('externalApiLoader', function () {\n  var externalApiLoaderProvider = {\n    apis: {},\n    defaults: {\n      getCachedModule: [\"$window\", function ($window) {\n        return $window[this.def.namespace];\n      }],\n      loader: [\"$window\", \"$q\", \"globalAnonymousFunction\", function ($window, $q, globalAnonymousFunction) {\n        var api = this;\n        return $q(function (resolve, reject) {\n          var url = api.def.url;\n          var script = $window.document.createElement('script');\n          angular.element($window.document.head).append(script);\n\n          if (api.def.jsonpCallback) {\n            url += (/\\?/.test(url) ? '&' : '?') + api.def.jsonpCallback + '=' + globalAnonymousFunction(resolve, {\n              oneTime: true\n            }).id;\n          } else {\n            script.onload = resolve;\n          }\n\n          script.onerror = function () {\n            reject();\n          };\n\n          script.src = url;\n        });\n      }]\n    },\n    addApi: function (apiName, def) {\n      externalApiLoaderProvider.apis[apiName] = {\n        name: apiName,\n        def: angular.extend({}, externalApiLoaderProvider.defaults, def)\n      };\n    },\n    $get: function ($q, $injector) {\n      var externalApiLoader = {\n        load: function (apiName) {\n          var api = externalApiLoaderProvider.apis[apiName];\n\n          if (!api) {\n            return $q.reject(\"Cannot load unconfigured external api \" + apiName);\n          }\n\n          if (!api.module) {\n            api.module = $injector.invoke(api.def.getCachedModule, api);\n          }\n\n          if (!api.promise) {\n            if (api.module) {\n              api.promise = $q.resolve(api.module);\n            } else {\n              api.promise = $q.resolve();\n\n              if (api.def.parent) {\n                api.promise = api.promise.then(function () {\n                  return externalApiLoader.load(api.def.parent);\n                }).then(function () {\n                  api.parent = externalApiLoaderProvider.apis[api.def.parent];\n                });\n              }\n\n              api.promise = api.promise.then(function () {\n                return $injector.invoke(api.def.loader, api);\n              }).then(function () {\n                api.module = $injector.invoke(api.def.getCachedModule, api);\n              }).then(function () {\n                if (api.def.onload) {\n                  return $injector.invoke(api.def.onload, api);\n                }\n              }).then(function () {\n                return api.module;\n              });\n            }\n          }\n\n          return api.promise;\n        }\n      };\n      return externalApiLoader;\n    }\n  };\n  return externalApiLoaderProvider;\n});","angular.module('a2.utils.global-anonymous-function', []).factory('globalAnonymousFunction', function ($window) {\n  var ct = 0;\n  return function (fn, options) {\n    // console.log(\"return function(fn, options)\", fn, options);\n    var wrapperFn = function () {\n      if (options && options.oneTime) {\n        wrapperFn.remove();\n      }\n\n      fn.apply(this, Array.prototype.slice.call(arguments));\n    };\n\n    wrapperFn.id = '__g_a_f_' + ct++;\n    $window[wrapperFn.id] = wrapperFn;\n\n    wrapperFn.remove = function () {\n      if ($window[wrapperFn.id] == wrapperFn) {\n        delete $window[wrapperFn.id];\n      }\n    };\n\n    return wrapperFn;\n  };\n});","angular.module('a2.utils.q-promisify', []).factory('$qPromisify', function ($q) {\n  function $qPromisify()\n  /*fn, ...args*/\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var fn = args.shift();\n    return $q(function (resolve, reject) {\n      args.push(function (err, value) {\n        if (err) {\n          reject();\n        } else {\n          resolve(value);\n        }\n      });\n      fn.apply(null, args);\n    });\n  }\n\n  $qPromisify.invoke = function ()\n  /*object, method, ...args*/\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var object = args.shift();\n    var method = args.shift();\n    return $qPromisify(function (cb) {\n      args.push(cb);\n      object[method].apply(object, args);\n    });\n  };\n\n  return $qPromisify;\n});","angular.module('a2.admin.jobs', ['ui.router', 'templates-arbimon2']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('jobs', {\n    url: '/jobs',\n    controller: 'AdminJobsCtrl',\n    templateUrl: '/admin/jobs/index.html'\n  });\n}).controller('AdminJobsCtrl', function ($scope, $http, $interval, Project) {\n  var getJobQueueInfo = function (argument) {\n    $http.get('/admin/job-queue').success(function (data) {\n      $scope.jobsStatus = data;\n    });\n  };\n\n  $scope.findJobs = function () {\n    var query = {};\n    var getTags = /(\\w+):[\"'](.+)[\"']|(\\w+):([\\w\\-]+)/g;\n\n    if ($scope.params.search) {\n      // iterate over getTags results\n      $scope.params.search.replace(getTags, function (match, key1, value1, key2, value2) {\n        // key1 matches (\\w+):[\"'](.+)[\"']\n        // key2 matches (\\w+):([\\w\\-]+)\n        var key = key1 ? key1 : key2;\n        var value = value1 ? value1 : value2;\n        if (!query[key]) query[key] = [];\n        query[key].push(value);\n      });\n    }\n\n    if ($scope.params.states) {\n      query.states = $scope.params.states.map(function (s) {\n        return s.name;\n      });\n    }\n\n    if ($scope.params.types) {\n      query.types = $scope.params.types.map(function (t) {\n        return t.id;\n      });\n    }\n\n    $http.get('/admin/jobs', {\n      params: query\n    }).success(function (data) {\n      $scope.activeJobs = data; // console.log(query);\n    });\n  };\n\n  $scope.initParams = function () {\n    $scope.params = {\n      search: \"is:visible \"\n    };\n  };\n\n  $scope.job_types = [];\n  $scope.states = [{\n    name: 'waiting',\n    color: 'black',\n    show: true\n  }, {\n    name: 'initializing',\n    color: 'blue',\n    show: true\n  }, {\n    name: 'ready',\n    color: '#007777',\n    show: true\n  }, {\n    name: 'processing',\n    color: 'olive',\n    show: true\n  }, {\n    name: 'completed',\n    color: 'green',\n    show: false\n  }, {\n    name: 'error',\n    color: 'red',\n    show: true\n  }, {\n    name: 'canceled',\n    color: 'gray',\n    show: false\n  }, {\n    name: 'stalled',\n    color: 'gray',\n    show: false\n  }];\n  $scope.initParams();\n  getJobQueueInfo();\n  $http.get('/api/jobs/types').success(function (jobTypes) {\n    var colors = ['#1482f8', '#df3627', '#40af3b', '#9f51bf', '#d37528'];\n    $scope.colors = {};\n\n    for (var i = 0; i < jobTypes.length; i++) {\n      var t = jobTypes[i];\n      $scope.colors[t.name] = colors[i % colors.length];\n    }\n\n    $scope.job_types = jobTypes;\n  });\n  $scope.findJobs();\n});","angular.module('a2.admin.dashboard.data-service', []).service('AdminDashboardDataService', function ($q) {\n  return {\n    getPlotData: function (series, from, to, period) {\n      return $q.when('/admin/plot-data/data.txt?stat=' + series + '&q=' + period + '&from=' + from.getTime() + '&to=' + to.getTime());\n    }\n  };\n});","angular.module('a2.admin.dashboard', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'a2.directives', 'templates-arbimon2', 'humane', 'ui.select', 'a2.admin.dashboard.data-service', 'a2.admin.dashboard.plotter-controller']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('dashboard', {\n    url: '/dashboard',\n    controller: 'AdminDashboardCtrl as controller',\n    templateUrl: '/admin/dashboard/index.html'\n  });\n}).controller('AdminDashboardCtrl', function ($scope, $http, $q, $controller) {\n  $scope.plots = $controller('AdminDashboardPlotterController', {\n    '$scope': $scope\n  });\n\n  $scope.UserStatsExport = function () {\n    $http.get('/admin/all-users').success(function (data) {\n      download(data);\n    });\n  };\n\n  $http.get('/admin/dashboard-stats').success(function (data) {\n    $scope.newUsers = data.newUsers;\n    $scope.newProjects = data.newProjects;\n    $scope.Jobs = data.jobsStatus;\n    $scope.allUsers = data.allUsers;\n    $scope.allSites = data.allSites;\n    $scope.allProjects = data.allProjects;\n    $scope.newSites = data.newSites;\n  });\n\n  $scope.getSystemSettings = function () {\n    $http.get('/admin/system-settings').success(function (data) {\n      $scope.settings = data;\n    });\n  };\n\n  $scope.getSystemSettings();\n\n  $scope.setSetting = function (setting, value) {\n    var d = $q.defer();\n\n    if (!setting) {\n      d.resolve();\n    } else {\n      $http.put('/admin/system-settings', {\n        setting: setting,\n        value: value\n      }).success(function (data) {\n        $scope.getSystemSettings();\n        d.resolve(data[setting]);\n      }).error(function (data) {\n        console.error(data);\n        $scope.getSystemSettings();\n        d.reject(data);\n      });\n    }\n\n    return d.promise;\n  };\n\n  $scope.toggleSetting = function (setting) {\n    var value = $scope.settings[setting] == 'on' ? 'off' : 'on';\n    return this.setSetting(setting, value);\n  };\n\n  function convertToCSV(objArray) {\n    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;\n    var str = '';\n\n    for (var i = 0; i < array.length; i++) {\n      var line = '';\n\n      for (var index in array[i]) {\n        if (line != '') line += ',';\n        line += array[i][index];\n      }\n\n      str += line + '\\r\\n';\n    }\n\n    return str;\n  }\n\n  function exportCSVFile(headers, items, fileTitle) {\n    if (headers) {\n      items.unshift(headers);\n    } // Convert Object to JSON\n\n\n    var jsonObject = JSON.stringify(items);\n    var csv = convertToCSV(jsonObject);\n    var exportedFilenmae = fileTitle + '.csv' || 'export.csv';\n    var blob = new Blob([csv], {\n      type: 'text/csv;charset=utf-8;'\n    });\n\n    if (navigator.msSaveBlob) {\n      // IE 10+\n      navigator.msSaveBlob(blob, exportedFilenmae);\n    } else {\n      var link = document.createElement(\"a\");\n\n      if (link.download !== undefined) {\n        var url = URL.createObjectURL(blob);\n        link.setAttribute(\"href\", url);\n        link.setAttribute(\"download\", exportedFilenmae);\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    }\n  }\n\n  function download(data) {\n    var headers = {\n      name: 'Name',\n      email: \"Email\"\n    };\n    var itemsFormatted = []; // format the data\n\n    data.forEach(function (item) {\n      itemsFormatted.push({\n        name: item.firstname + \" \" + item.lastname,\n        email: item.email\n      });\n    });\n    exportCSVFile(headers, itemsFormatted, 'users');\n  }\n});","angular.module('a2.admin.dashboard.plotter-controller', ['templates-arbimon2', 'a2.admin.dashboard.data-service', 'a2.directive.plotly-plotter']).controller('AdminDashboardPlotterController', function ($scope, $window, $q, AdminDashboardDataService) {\n  function mk_time_range_fn(from, delta) {\n    return function () {\n      var fromdt = from == 'now' ? new Date() : new Date(from);\n      var todt = new Date(fromdt.getTime() + delta);\n\n      if (delta < 0) {\n        var t = fromdt;\n        fromdt = todt;\n        todt = t;\n      }\n\n      return [fromdt, todt];\n    };\n  }\n\n  function get_by_tag(arr, tag) {\n    return arr.filter(function (x) {\n      return x.tag == tag;\n    }).shift();\n  }\n\n  function make_setter(options) {\n    var attr = options.data;\n    var selattr = options.sel || attr;\n    var def = options.def;\n    return function set(value) {\n      if (typeof value == 'string') {\n        value = get_by_tag(this.data[attr], value);\n      }\n\n      if (!value) {\n        value = get_by_tag(this.data[attr], def);\n      }\n\n      this.selected[selattr] = value;\n\n      if (value.apply) {\n        value.apply(this);\n      }\n\n      return this.refresh_logs();\n    };\n  }\n\n  this.data = {\n    series: [{\n      tag: 'activity',\n      name: 'Activity',\n      icon: 'fa fa-fw fa-ra'\n    } // {tag:'voltage', name:'Voltage', icon:'fa fa-fw fa-bolt'},\n    // {tag:'power', name:'Power', icon:'fa fa-fw fa-battery-half'}\n    ],\n    time_ranges: [{\n      tag: '1-hour',\n      text: 'Last Hour',\n      range: mk_time_range_fn('now', -3600 * 1000)\n    }, {\n      tag: '3-hour',\n      text: 'Last 3 Hours',\n      range: mk_time_range_fn('now', -3 * 3600 * 1000)\n    }, {\n      tag: '6-hour',\n      text: 'Last 6 Hours',\n      range: mk_time_range_fn('now', -6 * 3600 * 1000)\n    }, {\n      tag: '12-hour',\n      text: 'Last 12 Hours',\n      range: mk_time_range_fn('now', -12 * 3600 * 1000)\n    }, {\n      tag: '24-hour',\n      text: 'Last 24 Hours',\n      range: mk_time_range_fn('now', -24 * 3600 * 1000)\n    }, {\n      tag: '3-days',\n      text: 'Last 3 Days',\n      range: mk_time_range_fn('now', -3 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-week',\n      text: 'Last Week',\n      range: mk_time_range_fn('now', -7 * 24 * 3600 * 1000)\n    }, {\n      tag: '2-weeks',\n      text: 'Last 2 Weeks',\n      range: mk_time_range_fn('now', -14 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-month',\n      text: 'Last Month',\n      range: mk_time_range_fn('now', -31 * 24 * 3600 * 1000)\n    }],\n    periods: [{\n      tag: '1-minute',\n      text: '1 Minute',\n      sampling: '1 min',\n      granularity: 1 * 60 * 1000\n    }, {\n      tag: '5-minutes',\n      text: '5 Minutes',\n      sampling: '5 mins',\n      granularity: 5 * 60 * 1000\n    }, {\n      tag: '10-minutes',\n      text: '10 Minutes',\n      sampling: '10 mins',\n      granularity: 10 * 60 * 1000\n    }, {\n      tag: '30-minutes',\n      text: '30 Minutes',\n      sampling: '30 mins',\n      granularity: 30 * 60 * 1000\n    }, {\n      tag: '1-hour',\n      text: '1 Hour',\n      sampling: '1 hour',\n      granularity: 1 * 60 * 60 * 1000\n    }, {\n      tag: '3-hours',\n      text: '3 Hours',\n      sampling: '3 hours',\n      granularity: 3 * 60 * 60 * 1000\n    }, {\n      tag: '6-hours',\n      text: '6 Hours',\n      sampling: '6 hours',\n      granularity: 6 * 60 * 60 * 1000\n    }, {\n      tag: '1-day',\n      text: '1 Day',\n      sampling: '1 day',\n      granularity: 24 * 60 * 60 * 1000\n    }] // min_date: 0,\n    // max_date: 10000,\n\n  };\n  this.loading = {};\n  this.selected = {\n    series: get_by_tag(this.data.series, 'activity'),\n    time_range: get_by_tag(this.data.time_ranges, '1-week'),\n    period: get_by_tag(this.data.periods, '1-day')\n  };\n  this.set_series = make_setter({\n    data: 'series',\n    sel: 'series',\n    def: 'activity'\n  });\n  this.set_time_range = make_setter({\n    data: 'time_ranges',\n    sel: 'time_range',\n    def: '1-week'\n  });\n  this.set_period = make_setter({\n    data: 'periods',\n    sel: 'period',\n    def: '1-day'\n  });\n\n  this.load_data = function (series, range, period) {\n    var loading = this.loading;\n    loading.data = true;\n    return AdminDashboardDataService.getPlotData(series.tag, range[0], range[1], period.sampling).then(function (data) {\n      loading.data = false;\n      return {\n        x: 'datetime',\n        url: data\n      };\n    });\n  };\n\n  this.make_chart_struct = function (data) {\n    return $q(function (resolve, reject) {\n      $window.Plotly.d3.csv(data.url, function (err, data) {\n        if (err) {\n          reject(err);\n        } else if (data) {\n          resolve(data);\n        }\n      });\n    }).then(function (data) {\n      this.chart = {\n        data: [{\n          type: 'scatter',\n          mode: 'lines',\n          marker: {\n            color: '#31984f'\n          },\n          x: data.map(function (_) {\n            return new Date(+_.datetime).toString();\n          }),\n          y: data.map(function (_) {\n            return +_.activity;\n          })\n        }],\n        layout: {\n          xaxis: {\n            boundsmode: 'auto'\n          },\n          yaxis: {\n            boundsmode: 'auto'\n          }\n        } // axes : {\n        //     x : {\n        //         tick: {\n        //             format: function (x) {\n        //                 return moment(new Date(x)).utc().format('MM-DD-YYYY HH:mm');\n        //             }\n        //         }\n        //     }\n        // }\n\n      };\n      console.log(this.chart);\n    }.bind(this));\n  };\n\n  this.refresh_logs = function () {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var series = this.selected.series;\n    var time_range = this.selected.time_range;\n    var period = this.selected.period;\n\n    if (series && time_range && period) {\n      var range = time_range.range();\n      var granularity = period.granularity;\n      promise = d.promise.then(function () {\n        if (series.data) {\n          if (series.data.period != period || !(series.data.range[0] - granularity >= range[0] && range[1] <= series.data.range[1] + granularity)) {\n            series.data = null;\n          }\n        }\n\n        if (!series.data) {\n          return this.load_data(series, range, period).then(function (data) {\n            series.data = {\n              data: data,\n              range: range,\n              period: period\n            };\n            return series.data.data;\n          });\n        } else {\n          return series.data.data;\n        }\n      }.bind(this)).then(function (chart_data) {\n        console.log(\"chart_data : \", chart_data);\n\n        if (chart_data) {\n          this.make_chart_struct(chart_data);\n        }\n      }.bind(this));\n    }\n\n    return promise;\n  };\n\n  $q.when().then(this.refresh_logs.bind(this));\n});","angular.module('a2.admin.users.list', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'humane', 'ui.select']) // .config(function($stateProvider, $urlRouterProvider) {\n//     $stateProvider\n//         .state('users.list', {\n//             url: '',\n//             controller:'AdminUsersListCtrl',\n//             templateUrl: '/admin/users/list.html'\n//         });\n// \n// })\n// .controller('AdminUsersCtrl', function($scope, $http) {\n//     $http.get('/admin/users')\n//         .success(function(data) {\n//             $scope.users = data;\n//         });\n// })\n.service('AdminUsersListService', function ($http) {\n  return {\n    getList: function () {\n      return $http.get('/admin/users').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.admin.projects.codes', ['ui.router', 'a2.directives', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'humane', 'ui.select', 'a2.admin.projects.list', 'a2.admin.users.list']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('projects.codes', {\n    url: '/codes',\n    controller: 'AdminProjectsCodesCtrl as controller',\n    templateUrl: '/admin/projects/codes.html'\n  });\n}).controller('AdminProjectsCodesCtrl', function ($modal, notify, LoaderFactory, AdminProjectsCodesService) {\n  var loader = LoaderFactory.newInstance();\n  this.loader = loader;\n\n  this.createNewCode = function () {\n    return $modal.open({\n      templateUrl: '/admin/projects/new-code-modal.html',\n      resolve: {\n        projectsList: function (AdminProjectsListService) {\n          return AdminProjectsListService.getList();\n        },\n        usersList: function (AdminUsersListService) {\n          return AdminUsersListService.getList();\n        }\n      },\n      controller: function (projectsList, usersList) {\n        this.projectsList = projectsList;\n        this.usersList = usersList;\n        this.data = {\n          lockToUser: undefined,\n          lockProject: undefined,\n          duration: 1,\n          recordings: 10000,\n          processing: 1000000,\n          tieProcessingWithRecordings: true\n        };\n\n        this.computeProcessingAmount = function () {\n          if (this.data.tieProcessingWithRecordings) {\n            this.data.processing = this.data.recordings * 100;\n          }\n        };\n\n        this.processingCountChanged = function () {\n          this.data.tieProcessingWithRecordings = false;\n        };\n      },\n      controllerAs: 'popup'\n    }).result.then(AdminProjectsCodesService.createNewCode).then(function () {\n      loader.load(this, 'codes', AdminProjectsCodesService.loadCodes());\n    }.bind(this));\n  };\n\n  this.showHash = function (code) {\n    return $modal.open({\n      templateUrl: '/admin/projects/view-hash.html',\n      resolve: {\n        code: function () {\n          return code;\n        }\n      },\n      controller: function (code) {\n        this.code = code;\n      },\n      controllerAs: 'popup'\n    });\n  }; // editSelectedCode\n  // deleteSelectedCode\n\n\n  loader.load(this, 'codes', AdminProjectsCodesService.loadCodes());\n}).service('AdminProjectsCodesService', function ($http) {\n  return {\n    loadCodes: function () {\n      return $http.get('/admin/projects/codes').then(function (response) {\n        return response.data;\n      });\n    },\n    createNewCode: function (data) {\n      console.log(\"createNewCode\", data);\n      return $http.post('/admin/projects/codes', {\n        user: data.lockToUser && data.lockToUser.id,\n        project: data.lockProject && data.lockProject.id,\n        recordings: data.recordings,\n        duration: data.duration,\n        processing: data.processing\n      }).then(function (data) {\n        return data.response;\n      });\n    }\n  };\n}).factory('LoaderFactory', function ($q) {\n  function Loader() {\n    this.loading = {};\n  }\n\n  Loader.prototype = {\n    load: function (valueStore, key, promise) {\n      this.loading[key] = true;\n      return promise.then(function (value) {\n        this.loading[key] = false;\n\n        if (valueStore) {\n          valueStore[key] = value;\n        }\n\n        return value;\n      }.bind(this), function (err) {\n        this.loading[key] = false;\n        throw err;\n      }.bind(this));\n    }\n  };\n  return {\n    newInstance: function () {\n      return new Loader();\n    }\n  };\n});","angular.module('a2.admin.projects', ['ui.router', 'templates-arbimon2', 'a2.admin.projects.list', 'a2.admin.projects.codes']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('projects', {\n    url: '/projects',\n    abstract: true,\n    templateUrl: '/admin/projects/index.html'\n  });\n});","angular.module('a2.admin.projects.list', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'a2.orders.directives.tier-select', 'humane', 'ui.select']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('projects.list', {\n    url: '',\n    controller: 'AdminProjectsListCtrl as controller',\n    templateUrl: '/admin/projects/list.html'\n  }).state('projects.list.detail', {\n    url: '/:url',\n    views: {\n      'detail': {\n        templateUrl: '/admin/projects/list-detail.html',\n        controller: 'AdminProjectsListDetailCtrl as controller'\n      }\n    }\n  });\n}).controller('AdminProjectsListCtrl', function ($scope, $state, AdminProjectsListService) {\n  this.initialize = function () {\n    AdminProjectsListService.getList().then(function (data) {\n      this.projects = data;\n\n      if ($state.params.url) {\n        var url = $state.params.url;\n        this.selected = this.projects.reduce(function (_, project) {\n          return project.url == url ? project : _;\n        }, null);\n      }\n    }.bind(this));\n  };\n\n  this.select = function (project) {\n    return $state.go('projects.list.detail', {\n      url: project.url\n    });\n  };\n\n  this.notifyProjectUpdated = function (project) {\n    var projectObject = this.projects.reduce(function (_, p, $index) {\n      return p.project_id == project.project_id ? project : _;\n    }, null);\n    angular.merge(projectObject, project);\n  };\n\n  this.initialize();\n}).controller('AdminProjectsListDetailCtrl', function ($scope, $state, $q, notify, AdminProjectsListService) {\n  this.initialize = function () {\n    console.log(\"$state\", $state);\n    this.setProject({\n      url: $state.params.url\n    });\n  };\n\n  this.setProject = function (projectData) {\n    return $q.all([AdminProjectsListService.getProjectInfo(projectData), AdminProjectsListService.getProjectSites(projectData), AdminProjectsListService.getProjectRecordingCount(projectData)]).then(function (all) {\n      this.project = all[0];\n      this.project.is_enabled = this.project.is_enabled | 0;\n      this.sites = all[1];\n      this.recCount = all[2];\n    }.bind(this));\n  };\n\n  this.close = function () {\n    $state.go('projects.list');\n  };\n\n  this.save = function () {\n    return AdminProjectsListService.updateProject(this.project).then(function (project) {\n      this.project = project;\n      notify.log(\"Project \" + project.name + \" info updated.\");\n    }.bind(this)).catch(function (err) {\n      notify.error(err);\n    });\n  };\n\n  this.handleAedToggle = function () {\n    this.project.clustering_enabled = this.project.aed_enabled;\n  };\n\n  this.initialize();\n}).service('AdminProjectsListService', function ($http) {\n  return {\n    getList: function () {\n      return $http.get('/admin/projects').then(function (response) {\n        return response.data;\n      });\n    },\n    getProjectInfo: function (project) {\n      return $http.get('/api/project/' + project.url + '/info').then(function (response) {\n        var data = response.data;\n        data.is_enabled = !!data.is_enabled;\n        return data;\n      });\n    },\n    getProjectSites: function (project) {\n      return $http.get('/api/project/' + project.url + '/sites').then(function (response) {\n        return response.data;\n      });\n    },\n    getProjectRecordingCount: function (project) {\n      return $http.get('/api/project/' + project.url + '/recordings/count').then(function (response) {\n        return response.data.count;\n      });\n    },\n    updateProject: function (project) {\n      var projectData = {\n        project_id: project.project_id,\n        name: project.name,\n        url: project.url,\n        description: project.description,\n        project_type_id: project.project_type_id,\n        is_private: project.is_private,\n        is_enabled: project.is_enabled,\n        current_plan: project.current_plan,\n        storage_usage: project.storage_usage,\n        processing_usage: project.processing_usage,\n        citizen_scientist_enabled: !!project.citizen_scientist_enabled,\n        cnn_enabled: !!project.cnn_enabled,\n        pattern_matching_enabled: !!project.pattern_matching_enabled,\n        aed_enabled: !!project.aed_enabled,\n        clustering_enabled: !!project.clustering_enabled,\n        reports_enabled: !!project.reports_enabled,\n        plan: {\n          tier: project.tier,\n          storage: project.storage_limit,\n          processing: project.processing_limit,\n          activation: project.plan_activated,\n          duration_period: project.plan_period\n        }\n      };\n      return $http.put('/admin/projects/' + project.project_id, {\n        project: projectData\n      }).then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.audio-bar', ['a2.utils', 'a2.srv.local-storage', 'a2.visualizer.audio-player']).directive('a2AudioBar', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/a2-audio-bar/a2-audio-bar.html',\n    scope: {},\n    replace: true,\n    controller: 'a2AudioBarCtrl as controller'\n  };\n}).factory('a2AudioBarService', function ($rootScope) {\n  return {\n    loadUrl: function (url, play) {\n      $rootScope.$broadcast('a2-audio-load-url', {\n        url: url,\n        play: play\n      });\n    }\n  };\n}).controller('a2AudioBarCtrl', function ($scope, $filter, a2AudioPlayer, $timeout, $q, $localStorage) {\n  Object.assign(this, {\n    initialize: function () {\n      this.audio_player = new a2AudioPlayer($scope);\n      this.expanded = false;\n      this.collapseTimeoutInterval = 6000;\n      this.loading = false;\n      this.audio_player.setGain($localStorage.getItem('a2-audio-param-gain') || 1);\n      this.deregHandlers = [];\n      this.deregHandlers.push($scope.$on('a2-audio-load-url', this.onLoadUrl.bind(this)));\n      this.deregHandlers.push($scope.$on('$destroy', this.onDestroy.bind(this)));\n    },\n    onLoadUrl: function (event, options) {\n      this.loadUrl(options);\n    },\n    onDestroy: function () {\n      (this.deregHandlers || []).forEach(function (fn) {\n        fn();\n      });\n    },\n    setCollapseTimer: function () {\n      if (this.collapseTimer) {\n        $timeout.cancel(this.collapseTimer);\n      }\n\n      if (this.collapseTimeoutInterval) {\n        this.collapseTimer = $timeout(function () {\n          this.expanded = false;\n        }.bind(this), this.collapseTimeoutInterval);\n      }\n    },\n    seekPercent: function (percent) {\n      return this.audio_player.setCurrentTime(percent * this.audio_player.resource.duration);\n    },\n    setGain: function (gain) {\n      this.setCollapseTimer();\n      $localStorage.setItem('a2-audio-param-gain', gain);\n      return this.audio_player.setGain(gain);\n    },\n    play: function () {\n      this.setCollapseTimer();\n      return this.audio_player.play();\n    },\n    pause: function () {\n      this.setCollapseTimer();\n      return this.audio_player.pause();\n    },\n    stop: function () {\n      this.setCollapseTimer();\n      return this.audio_player.stop();\n    },\n    toggleExpanded: function () {\n      this.expanded = !this.expanded;\n\n      if (this.expanded) {\n        this.setCollapseTimer();\n      }\n    },\n    loadUrl: function (options) {\n      options = options || {};\n      const url = options.url;\n      const play = options.play || options.play === undefined;\n\n      if (!url) {\n        return $q.resolve();\n      }\n\n      this.loading = true;\n      this.expanded = true;\n      return this.audio_player.load(url).then(function () {\n        this.loading = false;\n\n        if (play) {\n          return this.play();\n        }\n      }.bind(this)).catch(function (e) {\n        this.loading = false;\n        this.error = e;\n        console.error(e);\n      }.bind(this));\n    }\n  });\n  this.initialize(this);\n});","angular.module('arbimon.directive.a2-switch', []).directive('a2Switch', function () {\n  return {\n    restict: 'E',\n    templateUrl: '/directives/a2-switch/template.html',\n    require: 'ngModel',\n    scope: {\n      onText: '@',\n      offText: '@',\n      disabled: '='\n    },\n    link: function (scope, element, attrs, ngModelCtrl) {\n      scope.toggle = function (event) {\n        scope.value = !scope.value;\n        ngModelCtrl.$setViewValue(scope.value, event && event.type);\n      };\n\n      ngModelCtrl.$render = function () {\n        scope.value = !!ngModelCtrl.$viewValue;\n      };\n    }\n  };\n});","angular.module('a2.utils.facebook-login-button', ['a2.utils', 'a2.utils.global-anonymous-function', 'a2.utils.external-api-loader', 'a2.injected.data']).config(function (externalApiLoaderProvider) {\n  externalApiLoaderProvider.addApi('facebook', {\n    url: \"//connect.facebook.net/en_US/sdk.js\",\n    namespace: 'FB',\n    onload: [\"a2InjectedData\", function (a2InjectedData) {\n      this.module.init(a2InjectedData.facebook_api);\n    }]\n  });\n}).directive('a2FacebookLoginButton', function ($window, $q, $timeout, a2InjectedData, externalApiLoader) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/external/facebook-login-button.html',\n    scope: {\n      onSignedIn: '&?',\n      onError: '&?'\n    },\n    link: function (scope, element, attrs) {\n      element.children('.btn-facebook-login').addClass(element[0].className);\n      element[0].className = '';\n\n      scope.signIn = function () {\n        externalApiLoader.load('facebook').then(function (FB) {\n          FB.login(function (response) {\n            if (response.status === 'connected') {\n              console.log(response);\n              scope.onSignedIn({\n                user: response\n              });\n            } else if (response.status === 'not_authorized') {} else {}\n          }, {\n            scope: 'public_profile,email'\n          });\n        });\n      };\n    }\n  };\n});","angular.module('a2.utils.google-login-button', ['a2.utils', 'a2.utils.q-promisify', 'a2.utils.global-anonymous-function', 'a2.utils.external-api-loader', 'a2.injected.data']).config(function (externalApiLoaderProvider) {\n  externalApiLoaderProvider.addApi('google-api', {\n    url: \"https://apis.google.com/js/client.js\",\n    namespace: 'gapi',\n    jsonpCallback: 'onload'\n  });\n  externalApiLoaderProvider.addApi('google-api/auth2', {\n    parent: 'google-api',\n    loader: [\"$qPromisify\", function ($qPromisify) {\n      return $qPromisify.invoke(this.parent.module, 'load', 'auth2');\n    }],\n    onload: [\"a2InjectedData\", function (a2InjectedData) {\n      var auth2 = this.module.init({\n        client_id: a2InjectedData.google_oauth_client,\n        cookiepolicy: 'single_host_origin'\n      });\n      return auth2.then(function () {\n        this.module.auth2 = auth2;\n      }.bind(this));\n    }],\n    getCachedModule: function () {\n      return this.parent && this.parent.module && this.parent.module.auth2;\n    }\n  });\n}).directive('a2GoogleLoginButton', function ($window, $q, $timeout, globalAnonymousFunction, a2InjectedData, externalApiLoader) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/external/google-login-button.html',\n    scope: {\n      onSignedIn: '&?',\n      onError: '&?'\n    },\n    link: function (scope, element, attrs) {\n      element.children('.btn-google-login').addClass(element[0].className);\n      element[0].className = '';\n\n      scope.signIn = function () {\n        externalApiLoader.load('google-api/auth2').then(function (auth2) {\n          auth2.auth2.signIn().then(function (user) {\n            scope.onSignedIn({\n              user: user\n            });\n          }, function (error) {\n            scope.onError({\n              error: error\n            });\n          });\n        });\n      };\n    }\n  };\n});","angular.module('a2.analysis', ['a2.analysis.patternmatching', 'a2.directive.audio-bar', 'a2.analysis.random-forest-models', 'a2.analysis.cnn', 'a2.analysis.soundscapes', 'a2.analysis.audio-event-detection', 'a2.analysis.audio-event-detections-clustering', 'a2.analysis.clustering-jobs', 'ui.router', 'ct.ui.router.extras', 'a2.srv.api']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/analysis\", \"/analysis/patternmatching\", \"/analysis/clustering-jobs\");\n  $stateProvider.state('analysis', {\n    url: '/analysis',\n    views: {\n      'analysis': {\n        controller: 'AnalysisIndexCtrl as controller',\n        templateUrl: '/app/analysis/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  });\n}).controller('AnalysisIndexCtrl', function ($scope, Project, a2UserPermit) {\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n});","angular.module('a2.audiodata', ['ui.router', 'ct.ui.router.extras', 'a2.directive.sidenav-bar', 'a2.directive.audio-bar', 'a2.audiodata.sites', 'a2.audiodata.species', 'a2.audiodata.uploads', 'a2.audiodata.recordings', 'a2.audiodata.training-sets', 'a2.audiodata.playlists', 'a2.audiodata.templates', 'a2.audiodata.soundscape-composition-classes']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/audiodata\", \"/audiodata/sites\");\n  $stateProvider.state('audiodata', {\n    url: '/audiodata',\n    views: {\n      'audiodata': {\n        controller: 'AudiodataIndexCtrl as controller',\n        templateUrl: '/app/audiodata/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  }).state('audiodata.sites', {\n    url: '/sites?site&show',\n    controller: 'SitesCtrl',\n    templateUrl: '/app/audiodata/sites.html'\n  }).state('audiodata.species', {\n    url: '/species',\n    controller: 'SpeciesCtrl',\n    templateUrl: '/app/audiodata/species.html'\n  }).state('audiodata.trainingSets', {\n    url: '/training-sets?set&show',\n    controller: 'TrainingSetsCtrl as controller',\n    templateUrl: '/app/audiodata/training-sets.html'\n  });\n}).controller('AudiodataIndexCtrl', function ($scope, Project, a2UserPermit) {\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n});","angular.module('a2.audiodata.sites', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane', 'a2.qr-js', 'a2.googlemaps', 'a2.srv.project']).directive('fileChange', ['$parse', function ($parse) {\n  return {\n    require: 'ngModel',\n    restrict: 'A',\n    link: function ($scope, element, attrs) {\n      var attrHandler = $parse(attrs['fileChange']);\n\n      var handler = function (e) {\n        $scope.$apply(function () {\n          attrHandler($scope, {\n            $event: e,\n            files: e.target.files\n          });\n        });\n      };\n\n      element[0].addEventListener('change', handler, false);\n    }\n  };\n}]).controller('SitesCtrl', function ($scope, $state, $anchorScroll, Project, $modal, notify, a2Sites, $window, $controller, $q, a2UserPermit, a2GoogleMapsLoader, $downloadResource) {\n  $scope.loading = true;\n  $scope.markers = [];\n  $scope.search = '';\n  $scope.editing = false;\n  $scope.creating = false;\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  var p = {\n    site: $state.params.site,\n    show: $state.params.show\n  };\n\n  if (p.show) {\n    p.show_path = p.show.split(':');\n    p.show = p.show_path.shift();\n  }\n\n  Project.getSites({\n    count: true,\n    logs: true,\n    deployment: true\n  }, function (sites) {\n    $scope.sortByLastUpdated(sites);\n    $scope.loading = false;\n\n    if (p.site) {\n      var site = sites.filter(function (s) {\n        return s.id == p.site;\n      }).shift();\n\n      if (site && site.id) {\n        $scope.sel(site).then(function () {\n          if (p.show) {\n            $scope.set_show(p.show, p.show_path);\n          }\n        });\n      }\n    }\n\n    a2GoogleMapsLoader.then(function (google) {\n      $scope.map = new google.maps.Map($window.document.getElementById('mapSite'), {\n        center: {\n          lat: 0,\n          lng: 0\n        },\n        mapTypeId: google.maps.MapTypeId.SATELLITE,\n        zoom: 8,\n        minZoom: 2\n      });\n      $scope.fitBounds();\n    });\n    $scope.mapHeader = $window.document.getElementById('mapHeader');\n    $scope.mapHeaderPosition = mapHeader.getBoundingClientRect();\n  });\n\n  $scope.fitBounds = function () {\n    const bounds = new google.maps.LatLngBounds();\n    angular.forEach($scope.sites, function (site) {\n      if (site.lat > 85 || site.lat < -85 || site.lon > 180 || site.lon < -180) {\n        return;\n      }\n\n      var marker;\n      const position = new google.maps.LatLng(site.lat, site.lon); // set custop pin to selected site\n\n      if ($scope.selected && $scope.selected.id === site.id) {\n        marker = new google.maps.Marker({\n          position: position,\n          title: site.name,\n          icon: {\n            url: 'http://icons.iconarchive.com/icons/paomedia/small-n-flat/48/map-marker-icon.png'\n          }\n        });\n      } else {\n        marker = new google.maps.Marker({\n          position: position,\n          title: site.name\n        });\n      } // add draggable layer for an editig site\n\n\n      if (($scope.editing || $scope.creating) && $scope.temp && $scope.temp.id === site.id) {\n        marker.setDraggable(true);\n        $scope.map.panTo(position);\n        $scope.map.setZoom(8);\n        google.maps.event.addListener(marker, 'dragend', function (position) {\n          $scope.$apply(function () {\n            $scope.temp.lat = position.latLng.lat();\n            $scope.temp.lon = position.latLng.lng();\n          });\n        });\n      }\n\n      marker.addListener(\"click\", function () {\n        $scope.sel(site);\n        $scope.scrollTo(site.id);\n      });\n      $scope.markers.push(marker);\n      bounds.extend(position);\n    });\n    $scope.map.fitBounds(bounds);\n\n    if ($scope.markers.length) {\n      $scope.setMapOnAll($scope.map);\n    }\n\n    ;\n  };\n\n  $scope.scrollTo = function (id) {\n    const bookmark = 'site-' + id;\n    $anchorScroll.yOffset = 60;\n    console.log(bookmark);\n    $anchorScroll(bookmark);\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    this.scrollPos = $controller.scrollElement.scrollY;\n    $scope.scrollPos = this.scrollPos;\n    $scope.scrolledPastHeader = this.scrollPos < 600;\n  };\n\n  $scope.getMapHeaderTop = function () {\n    // calculate top offset for the map\n    const defaultOffset = '122px';\n\n    if ($scope.mapHeaderPosition) {\n      const topOffset = $scope.mapHeaderPosition.top + $scope.mapHeader.offsetHeigh;\n      return topOffset < 1 ? defaultOffset : topOffset;\n    } else return defaultOffset;\n  };\n\n  $scope.scrollMap = function ($event, $controller) {\n    return $scope.show.map && $scope.editing === false && $scope.creating === false && $scope.sites && $scope.sites.length > 15 && $scope.scrollPos;\n  }, $scope.onFilterChanged = function () {\n    $scope.sites = $scope.sortByKeywordArray($scope.originalSites, $scope.search);\n  };\n\n  $scope.sortByKeywordArray = function (array, keyword) {\n    if (array && !array.length) return [];\n    return array.filter(function (item) {\n      // Filter results by doing case insensitive match on name\n      return item.name.toLowerCase().includes(keyword.toLowerCase());\n    }).sort(function (a, b) {\n      // Sort results by matching name with keyword position in name\n      if (a.name.toLowerCase().indexOf(keyword.toLowerCase()) > b.name.toLowerCase().indexOf(keyword.toLowerCase())) {\n        return 1;\n      } else if (a.name.toLowerCase().indexOf(keyword.toLowerCase()) < b.name.toLowerCase().indexOf(keyword.toLowerCase())) {\n        return -1;\n      } else {\n        if (a.name > b.name) return 1;else return -1;\n      }\n    });\n  };\n\n  $scope.sortByLastUpdated = function (sites) {\n    $scope.sites = sites.sort(function (a, b) {\n      return a.updated_at < b.updated_at ? 1 : -1;\n    });\n    $scope.originalSites = $scope.sites;\n  }; // Sets the map on all markers in the array\n\n\n  $scope.setMapOnAll = function (map) {\n    for (var i = 0; i < $scope.markers.length; i++) {\n      $scope.markers[i].setMap(map);\n    }\n  }; // Removes the markers from the map, but keeps them in the array\n\n\n  $scope.clearMarkers = function () {\n    $scope.setMapOnAll(null);\n  }; // Shows any markers currently in the array\n\n\n  $scope.showMarkers = function (map) {\n    $scope.setMapOnAll(map);\n  }; // Deletes all markers in the array by removing references to them\n\n\n  $scope.deleteMarkers = function () {\n    $scope.clearMarkers();\n    $scope.markers = [];\n  };\n\n  $scope.editing = false;\n\n  $scope.importSite = function () {\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to add sites\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: \"/app/audiodata/import.html\",\n      controller: \"ImportSiteInstanceCtrl\"\n    });\n    modalInstance.result.then(function (response) {\n      // Check the file is valid\n      const sites = parseSitesFromCsv(response);\n\n      if (!sites) {\n        notify.error(\"Wrong format of csv file\");\n        return;\n      } // Save the sites\n\n\n      createSites(sites).then(function () {\n        notify.log(\"Sites created\"); // Refresh data\n\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites);\n        });\n      }).catch(function (error) {\n        notify.error(\"Error: \" + error);\n      });\n    });\n  };\n\n  function parseSitesFromCsv(allText) {\n    var allTextLines = allText.split(/\\r\\n|\\n/);\n    var headers = allTextLines[0].split(',');\n\n    if (!headers.includes(\"name\") || !headers.includes(\"lat\") || !headers.includes(\"lon\") || !headers.includes(\"alt\")) {\n      return false;\n    }\n\n    var sites = [];\n\n    for (var i = 1; i < allTextLines.length; i++) {\n      var data = allTextLines[i].split(',');\n\n      if (data.length == headers.length) {\n        var site = {};\n\n        for (var j = 0; j < headers.length; j++) {\n          if (headers[j] === \"lat\" && (data[j] > 85 || data[j] < -85)) {\n            return notify.log('Please enter latitude number between -85 to 85');\n          }\n\n          if (headers[j] === \"lon\" && (data[j] > 180 || data[j] < -180)) {\n            return notify.log('Please enter longitude number between -180 to 180');\n          }\n\n          site[headers[j]] = data[j];\n        }\n\n        sites.push(site);\n      }\n    }\n\n    return sites;\n  }\n\n  function createSites(sites) {\n    return Promise.all(sites.map(function (site) {\n      return new Promise(function (resolve, reject) {\n        a2Sites.create(site, function (data) {\n          if (data.error) {\n            reject(data.error);\n          } else {\n            resolve();\n          }\n        });\n      });\n    }));\n  }\n\n  ;\n\n  $scope.close = function () {\n    $scope.creating = false;\n    $scope.editing = false;\n\n    if ($scope.marker) {\n      a2GoogleMapsLoader.then(function (google) {\n        var position = new google.maps.LatLng($scope.selected && $scope.selected.lat, $scope.selected && $scope.selected.lon);\n        $scope.marker.setDraggable(false);\n        $scope.marker.setPosition(position);\n        $scope.marker.setTitle($scope.selected && $scope.selected.name);\n      });\n    }\n  };\n\n  $scope.exportSites = function () {\n    if (a2UserPermit.isSuper()) return $downloadResource(Project.getSitesExportUrl());\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export sites');\n    } else $downloadResource(Project.getSitesExportUrl());\n  };\n\n  $scope.status_controller = $controller('SiteStatusPlotterController', {\n    '$scope': $scope\n  });\n  var onLogsRefreshed = $scope.status_controller.on('logs-refreshed', function (logParams) {\n    if ($scope.show.status) {\n      var new_show = [$state.params.show.split(':').slice(0, 1)].concat(logParams).join(':');\n      console.log(\"logParams\", logParams, new_show);\n      $state.transitionTo($state.current.name, {\n        site: $state.params.site,\n        show: new_show\n      }, {\n        notify: false\n      });\n    }\n  });\n  $scope.$on('$destroy', function () {\n    $scope.status_controller.off('logs-refreshed', onLogsRefreshed);\n  });\n\n  $scope.save = function () {\n    var action = $scope.editing ? 'update' : 'create';\n\n    if ($scope.temp.lat > 85 || $scope.temp.lat < -85) {\n      notify.log('Please enter latitude number between -85 to 85');\n      return;\n    }\n\n    if ($scope.temp.lon > 180 || $scope.temp.lon < -180) {\n      notify.log('Please enter longitude number between -180 to 180');\n      return;\n    }\n\n    if ($scope.siteForm.$invalid) return;\n    var tempObj = Object.assign({}, $scope.temp); // Do not include equal location metadata / updated at data to the update endpoint.\n\n    if (action === 'update') {\n      const attrArray = ['alt', 'updated_at'];\n\n      for (var i = 0; i < attrArray.length; i++) {\n        var key = attrArray[i];\n\n        if ($scope.temp[key] === $scope.selected[key]) {\n          delete tempObj[key];\n        }\n      }\n\n      const locationArray = ['lat', 'lon'];\n\n      if ($scope.temp[locationArray[0]] === $scope.selected[locationArray[0]] && $scope.temp[locationArray[1]] === $scope.selected[locationArray[1]]) {\n        delete tempObj[locationArray[0]];\n        delete tempObj[locationArray[1]];\n      }\n    }\n\n    a2Sites[action](action === 'create' ? $scope.temp : tempObj, function (data) {\n      if (data.error) return notify.error(data.error);\n\n      if (action === 'create') {\n        $scope.creating = false;\n      } else {\n        $scope.editing = false;\n      }\n\n      Project.getSites({\n        count: true,\n        logs: true,\n        deployment: true\n      }, function (sites) {\n        $scope.sortByLastUpdated(sites);\n        $scope.sel(action === 'create' ? $scope.temp : tempObj).then(function () {\n          if (p.show) {\n            $scope.set_show(p.show, p.show_path);\n          }\n        }); // rebuild map pins\n\n        $scope.deleteMarkers();\n        $scope.fitBounds();\n      });\n      var message = action == \"update\" ? \"Site updated\" : \"Site created\";\n      notify.log(message);\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.selected) {\n      notify.log('Please select site to remove');\n      return;\n    }\n\n    if (!a2UserPermit.can('delete site')) {\n      notify.error(\"You do not have permission to remove sites\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"Are you sure you would like to remove the following site?\", $scope.selected.name];\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2Sites.delete([$scope.selected.id], function (data) {\n        if (data.error) return notify.error(data.error);\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites); // rebuild map pins\n\n          $scope.deleteMarkers();\n          $scope.fitBounds();\n        });\n        notify.log('Site removed');\n      });\n    });\n  };\n\n  $scope.delAllEmptySites = function () {\n    if (!a2UserPermit.can('manage project settings')) {\n      notify.error(\"You do not have permission to remove sites\");\n      return;\n    }\n\n    var list = [],\n        siteIds = [];\n    $scope.sites.forEach(function (site, index) {\n      if (site.rec_count === 0 && !list.includes(site.name)) {\n        list.push(site.name);\n        siteIds.push(site.id);\n      }\n    });\n\n    if (!list.length) {\n      notify.log(\"There is no empty site in your project\");\n      return;\n    }\n\n    if (list.length > 3) {\n      const msg = '& ' + (list.length - 3) + ' other sites';\n      list = list.slice(0, 3);\n      list.push(msg);\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"Are you sure you would like to remove the following sites?\"];\n        this.list = list;\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2Sites.delete(siteIds, function (data) {\n        if (data.error) return notify.error(data.error);\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites); // rebuild map pins\n\n          $scope.deleteMarkers();\n          $scope.fitBounds();\n        });\n        notify.log('Empty sites removed');\n      });\n    });\n  };\n\n  $scope.show = {\n    map: false,\n    status: false\n  };\n  $scope.show[p.show || 'map'] = true;\n\n  $scope.set_show = function (new_show, show_path) {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var show_state_param = new_show;\n\n    if (new_show == 'status' && $scope.selected && $scope.selected.has_logs) {\n      show_state_param = [new_show].concat(show_path).join(':');\n      promise = promise.then(function () {\n        return $scope.status_controller.activate($scope.selected, show_path);\n      });\n    } else {\n      promise = promise.then(function () {\n        new_show = 'map';\n      });\n    }\n\n    return promise.then(function () {\n      for (var i in $scope.show) {\n        $scope.show[i] = false;\n      }\n\n      $scope.show[new_show] = true;\n      return $state.transitionTo($state.current.name, {\n        site: $state.params.site,\n        show: show_state_param\n      }, {\n        notify: false\n      });\n    });\n  };\n\n  $scope.create = function () {\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to add sites\");\n      return;\n    }\n\n    $scope.temp = {};\n    $scope.set_show('map');\n    $scope.creating = true; // rebuild map pins\n\n    $scope.deleteMarkers();\n    $scope.fitBounds();\n  };\n\n  $scope.edit = function () {\n    if (!$scope.selected) return;\n\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to edit sites\");\n      return;\n    }\n\n    $scope.set_show('map');\n    $scope.temp = angular.copy($scope.selected);\n    $scope.temp.published = $scope.temp.published === 1;\n    Project.getProjectsList('my', function (data) {\n      $scope.projects = data.map(function (project) {\n        return {\n          project_id: project.project_id,\n          name: project.name,\n          url: project.url\n        };\n      });\n    });\n    Project.getInfo(function (data) {\n      $scope.temp.project = data;\n    });\n    $scope.editing = true; // rebuild map pins\n\n    $scope.deleteMarkers();\n    $scope.fitBounds();\n  };\n\n  $scope.onSelect = function ($item) {\n    $scope.temp.project = $item;\n  };\n\n  $scope.showAssetsCarousel = false;\n\n  $scope.showCarousel = function (id) {\n    $scope.images.forEach(function (image) {\n      image.active = image.id === id;\n    });\n    $scope.showAssetsCarousel = true;\n  };\n\n  $scope.capitalizeFirstLetter = function (string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n  };\n\n  $scope.sel = function (site) {\n    return $state.transitionTo($state.current.name, {\n      site: site && site.id,\n      show: $state.params.show\n    }, {\n      notify: false\n    }).then(function () {\n      $scope.images = [];\n      $scope.close();\n      $scope.selected = site;\n\n      if ($scope.selected && $scope.selected.external_id) {\n        a2Sites.getListOfAssets($scope.selected.external_id).then(function (data) {\n          $scope.assets = data;\n\n          if ($scope.assets && $scope.selected.external_id) {\n            $scope.assets = $scope.assets.filter(function (asset) {\n              return asset.meta !== null;\n            });\n\n            for (var i = 0; i < $scope.assets.length; i++) {\n              var src = '/api/project/' + $scope.project.url + '/streams/' + $scope.selected.external_id + '/assets/' + $scope.assets[i].id;\n              $scope.images.push({\n                id: i,\n                src: src,\n                active: i === 0,\n                label: $scope.assets[i] && $scope.assets[i].meta && $scope.assets[i].meta.label ? $scope.capitalizeFirstLetter($scope.assets[i].meta.label) : 'No label image'\n              });\n            }\n          }\n\n          ;\n        }).catch(function (err) {\n          console.log('\\nerr', err);\n        });\n      } // rebuild map pins\n\n\n      $scope.deleteMarkers();\n      $scope.fitBounds(); // zoom in to the selected pin\n\n      if ($scope.selected) {\n        a2GoogleMapsLoader.then(function (google) {\n          var position = new google.maps.LatLng($scope.selected.lat, $scope.selected.lon);\n          $scope.map.panTo(position);\n          $scope.map.setZoom(12);\n        });\n      }\n    });\n  };\n}).controller('ImportSiteInstanceCtrl', function ($scope, $modalInstance) {\n  $scope.files = [];\n\n  $scope.handler = function (e, files) {\n    var reader = new FileReader();\n\n    reader.onload = function (e) {\n      $modalInstance.close(reader.result);\n    };\n\n    reader.readAsText(files[0]);\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss();\n  };\n}).controller('SitesTokenGenaratorCtrl', function ($scope, a2Sites, $modal, notify) {\n  $scope.site = $scope.selected;\n  $scope.loading = {};\n\n  var confirmRevoke = function (title, btnOk) {\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.title = title;\n        this.messages = [\"This action will revoke the current token for the site <b>\" + $scope.site.name + \"</b>. \" + \"Are you sure you want to do this?\"];\n        this.btnOk = btnOk;\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    });\n    return modalInstance;\n  };\n\n  var genToken = function () {\n    a2Sites.generateToken($scope.site).success(function (data) {\n      $scope.loading.generate = false;\n      if (data.error) return notify.error(data.error);\n      $scope.site.token_created_on = new Date(data.created * 1000);\n      $scope.base64 = data.base64token;\n      $scope.token = {\n        type: data.type,\n        name: data.name,\n        created: data.created,\n        expires: data.expires,\n        token: data.token\n      };\n      notify.log(\"New site token generated.\");\n    }).error(function (data) {\n      $scope.loading.generate = false;\n      notify.serverError();\n    });\n  };\n\n  $scope.generateToken = function () {\n    $scope.loading.generate = true;\n\n    if ($scope.site.token_created_on) {\n      var modalInstance = confirmRevoke(\"<h4>Confirm revoke and generate token</h4>\", \"Yes, revoke and generate a new token\");\n      modalInstance.result.then(function ok() {\n        genToken();\n      }, function cancel() {\n        $scope.loading.generate = false;\n      });\n    } else {\n      genToken();\n    }\n  };\n\n  $scope.revokeToken = function () {\n    var modalInstance = confirmRevoke(\"<h4>Confirm revoke token</h4>\", \"Yes, revoke token\");\n    modalInstance.result.then(function () {\n      $scope.loading.revoke = true;\n      a2Sites.revokeToken($scope.site).success(function (data) {\n        $scope.loading.revoke = false;\n        $scope.site.token_created_on = null;\n        $scope.token = null;\n        notify.log(\"site token revoked.\");\n      }).error(function (data) {\n        $scope.loading.generate = false;\n        notify.serverError();\n      });\n    });\n  };\n}).controller('SiteStatusPlotterController', function ($scope, $q, a2Sites, $debounce, a2EventEmitter) {\n  function mk_time_range_fn(from, delta) {\n    return function () {\n      var fromdt = from == 'now' ? new Date() : new Date(from);\n      var todt = new Date(fromdt.getTime() + delta);\n\n      if (delta < 0) {\n        var t = fromdt;\n        fromdt = todt;\n        todt = t;\n      }\n\n      return [fromdt, todt];\n    };\n  }\n\n  function get_by_tag(arr, tag) {\n    return arr.filter(function (x) {\n      return x.tag == tag;\n    }).shift();\n  }\n\n  function make_setter(options) {\n    var attr = options.data;\n    var selattr = options.sel || attr;\n    var def = options.def;\n    return function set(value, dontRefreshLogs) {\n      if (typeof value == 'string') {\n        value = get_by_tag(this.data[attr], value);\n      }\n\n      if (!value) {\n        value = get_by_tag(this.data[attr], def);\n      }\n\n      this.selected[selattr] = value;\n\n      if (value.apply) {\n        value.apply(this);\n      }\n\n      return dontRefreshLogs ? $q.resolve() : this.refresh_logs();\n    };\n  }\n\n  var events = new a2EventEmitter();\n  this.on = events.on.bind(events);\n  this.off = events.off.bind(events);\n\n  this.itemGroup = function (item) {\n    return item.group;\n  };\n\n  this.data = {\n    series: [{\n      tag: 'status',\n      group: 'Site',\n      name: 'Battery Status',\n      icon: 'fa fa-fw fa-plug',\n      axis: {\n        y: {\n          tick: {\n            values: [0, 1, 2, 3],\n            format: function (x) {\n              return ['unknown', 'charging', 'not charging', 'full'][x | 0];\n            }\n          }\n        }\n      }\n    }, {\n      tag: 'voltage',\n      group: 'Site',\n      name: 'Voltage',\n      icon: 'fa fa-fw fa-bolt'\n    }, {\n      tag: 'power',\n      group: 'Site',\n      name: 'Power',\n      icon: 'fa fa-fw fa-battery-half'\n    }, {\n      tag: 'uploads',\n      group: 'Data',\n      name: 'Uploads',\n      icon: 'fa fa-fw fa-upload'\n    }, {\n      tag: 'recordings',\n      group: 'Data',\n      name: 'Recordings',\n      icon: 'fa fa-fw fa-volume-up'\n    }],\n    time_ranges: [{\n      tag: '1-hour',\n      text: 'Last Hour',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -3600 * 1000)\n    }, {\n      tag: '3-hour',\n      text: 'Last 3 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -3 * 3600 * 1000)\n    }, {\n      tag: '6-hour',\n      text: 'Last 6 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -6 * 3600 * 1000)\n    }, {\n      tag: '12-hour',\n      text: 'Last 12 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -12 * 3600 * 1000)\n    }, {\n      tag: '24-hour',\n      text: 'Last 24 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -24 * 3600 * 1000)\n    }, {\n      tag: '3-days',\n      text: 'Last 3 Days',\n      group: 'Days',\n      range: mk_time_range_fn('now', -3 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-week',\n      text: 'Last Week',\n      group: 'Weeks',\n      range: mk_time_range_fn('now', -7 * 24 * 3600 * 1000)\n    }, {\n      tag: '2-weeks',\n      text: 'Last 2 Weeks',\n      group: 'Weeks',\n      range: mk_time_range_fn('now', -14 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-month',\n      text: 'Last Month',\n      group: 'Month',\n      range: mk_time_range_fn('now', -31 * 24 * 3600 * 1000)\n    }],\n    periods: [{\n      tag: '1-minute',\n      text: '1 Minute',\n      group: 'Minutes',\n      sampling: '1 min',\n      granularity: 1 * 60 * 1000\n    }, {\n      tag: '5-minutes',\n      text: '5 Minutes',\n      group: 'Minutes',\n      sampling: '5 mins',\n      granularity: 5 * 60 * 1000\n    }, {\n      tag: '10-minutes',\n      text: '10 Minutes',\n      group: 'Minutes',\n      sampling: '10 mins',\n      granularity: 10 * 60 * 1000\n    }, {\n      tag: '30-minutes',\n      text: '30 Minutes',\n      group: 'Minutes',\n      sampling: '30 mins',\n      granularity: 30 * 60 * 1000\n    }, {\n      tag: '1-hour',\n      text: '1 Hour',\n      group: 'Hours',\n      sampling: '1 hour',\n      granularity: 1 * 60 * 60 * 1000\n    }, {\n      tag: '3-hours',\n      text: '3 Hours',\n      group: 'Hours',\n      sampling: '3 hours',\n      granularity: 3 * 60 * 60 * 1000\n    }, {\n      tag: '6-hours',\n      text: '6 Hours',\n      group: 'Hours',\n      sampling: '6 hours',\n      granularity: 6 * 60 * 60 * 1000\n    }, {\n      tag: '1-day',\n      text: '1 Day',\n      group: 'Days',\n      sampling: '1 day',\n      granularity: 24 * 60 * 60 * 1000\n    }] // min_date: 0,\n    // max_date: 10000,\n\n  };\n  this.loading = {};\n  this.selected = {\n    series: get_by_tag(this.data.series, 'power'),\n    time_range: get_by_tag(this.data.time_ranges, '1-week'),\n    period: get_by_tag(this.data.periods, '1-hour')\n  };\n  this.set_series = make_setter({\n    data: 'series',\n    sel: 'series',\n    def: 'power'\n  });\n  this.set_time_range = make_setter({\n    data: 'time_ranges',\n    sel: 'time_range',\n    def: '1-week'\n  });\n  this.set_period = make_setter({\n    data: 'periods',\n    sel: 'period',\n    def: '7-days'\n  });\n\n  this.activate = function (selected_site, plot_uri) {\n    this.selected.site = selected_site;\n\n    if (plot_uri) {\n      if (plot_uri.length) {\n        this.set_series(plot_uri.shift());\n      }\n\n      if (plot_uri.length) {\n        this.set_time_range(plot_uri.shift());\n      }\n\n      if (plot_uri.length) {\n        this.set_period(plot_uri.shift());\n      }\n    }\n\n    return this.refresh_logs();\n  };\n\n  this.load_data = function (site, series, range, period) {\n    var loading = this.loading;\n    loading.data = true;\n    return a2Sites.getSiteLogData(site.id, series.tag, range[0], range[1], period.sampling).then(function (data) {\n      loading.data = false;\n      data.x = 'datetime';\n      data.axis = series.axis;\n      data.empty = {\n        label: {\n          text: \"No data to show.\"\n        }\n      };\n      return data;\n    });\n  };\n\n  this.make_chart_struct = function (data) {\n    var axes = {\n      x: {\n        tick: {\n          format: function (x) {\n            return moment(new Date(x)).utc().format('MM-DD-YYYY HH:mm');\n          }\n        }\n      }\n    };\n\n    if (data.axis) {\n      angular.merge(axes, data.axis);\n      delete data.axis;\n    }\n\n    this.chart = {\n      data: data,\n      axes: axes\n    };\n  };\n\n  this.refresh_logs = $debounce(function () {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var site = this.selected.site;\n    var series = this.selected.series;\n    var time_range = this.selected.time_range;\n    var period = this.selected.period;\n\n    if (site && series && time_range && period) {\n      var range = time_range.range();\n      var granularity = period.granularity;\n      promise = d.promise.then(function () {\n        if (series.data) {\n          if (series.data.site != site || series.data.period != period || !(series.data.range[0] - granularity >= range[0] && range[1] <= series.data.range[1] + granularity)) {\n            series.data = null;\n          }\n        }\n\n        if (!series.data) {\n          return this.load_data(site, series, range, period).then(function (data) {\n            series.data = {\n              data: data,\n              site: site,\n              range: range,\n              period: period\n            };\n            return series.data.data;\n          });\n        } else {\n          return series.data.data;\n        }\n      }.bind(this)).then(function (chart_data) {\n        console.log(\"chart_data : \", chart_data);\n\n        if (chart_data) {\n          this.make_chart_struct(chart_data);\n        }\n      }.bind(this)).then(function () {\n        events.emit('logs-refreshed', [series.tag, time_range.tag, period.tag]);\n      });\n    }\n\n    return promise;\n  }, 10);\n});","angular.module('a2.audiodata.soundscape-composition-classes', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.scAnnotationClasses', {\n    url: '/soundscape-annotation-classes',\n    controller: 'SoundscapeCompositionClassesScreenCtrl as controller',\n    templateUrl: '/app/audiodata/soundscape-composition-classes.html'\n  });\n}).controller('SoundscapeCompositionClassesScreenCtrl', function ($modal, notify, Project, a2SoundscapeCompositionService, a2UserPermit) {\n  this.initialize = function () {\n    this.loading = true;\n    this.newClass = {};\n    this.canManageClasses = a2UserPermit.can(\"manage project species\");\n    a2SoundscapeCompositionService.getClassList({\n      tally: 1,\n      groupByType: true,\n      isSystemClass: 1\n    }).then(function (classes) {\n      this.classes = classes;\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.addNewClass = function (groupType) {\n    var className = this.newClass[groupType.typeId];\n    delete this.newClass[groupType.typeId];\n\n    if (className) {\n      if (!a2UserPermit.can(\"manage project species\")) {\n        notify.error(\"You do not have permission to add soundscape composition classes\");\n        return;\n      }\n\n      a2SoundscapeCompositionService.addClass(className, groupType.typeId).then(function (newClass) {\n        groupType.list.push(newClass);\n      }.bind(this)).catch(function (err) {\n        notify.error(err.data || err.message);\n      });\n    }\n  };\n\n  this.removeClass = function (scClass) {\n    if (scClass.isSystemClass) {\n      return;\n    }\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove soundscape composition classes\");\n      return;\n    }\n\n    a2SoundscapeCompositionService.removeClass(scClass.id).then(function () {\n      this.classes.forEach(function (classGroup) {\n        var index = classGroup.list.indexOf(scClass);\n\n        if (index >= 0) {\n          classGroup.list.splice(index, 1);\n        }\n      });\n    }.bind(this)).catch(function (err) {\n      notify.error(err.data || err.message);\n    });\n  };\n\n  this.add = function () {\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to add species\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/select-species.html',\n      controller: 'SelectSoundscapeCompositionClassesScreenCtrl',\n      size: 'lg'\n    });\n    modalInstance.result.then(function (selected) {\n      var cls = {\n        species: selected.species.scientific_name,\n        songtype: selected.song.name\n      };\n      Project.addClass(cls).success(function (result) {\n        notify.log(selected.species.scientific_name + ' ' + selected.song.name + \" added to project\");\n        Project.getClasses(function (classes) {\n          this.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  this.del = function () {\n    if (!this.checked || !this.checked.length) return;\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove species\");\n      return;\n    }\n\n    var speciesClasses = this.checked.map(function (row) {\n      return '\"' + row.species_name + ' | ' + row.songtype_name + '\"';\n    });\n    var message = [\"You are about to delete the following project species: \"];\n    var message2 = [\"Are you sure?\"];\n    this.popup = {\n      messages: message.concat(speciesClasses, message2),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: this\n    });\n    modalInstance.result.then(function () {\n      var classesIds = this.checked.map(function (row) {\n        return row.id;\n      });\n      var params = {\n        project_classes: classesIds\n      };\n      Project.removeClasses(params).success(function (result) {\n        Project.getClasses(function (classes) {\n          this.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  this.initialize();\n});","angular.module('a2.audiodata.species', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).controller('SpeciesCtrl', function ($scope, Project, $modal, notify, a2UserPermit) {\n  $scope.loading = true;\n  $scope.selected = {};\n  Project.getClasses(function (classes) {\n    $scope.classes = classes;\n    $scope.loading = false;\n  });\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n\n  $scope.add = function () {\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to add species\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/select-species.html',\n      controller: 'SelectSpeciesCtrl',\n      size: 'lg'\n    });\n    modalInstance.result.then(function (selected) {\n      var cls = {\n        species: selected.species.scientific_name,\n        songtype: selected.song.name\n      };\n      Project.addClass(cls).success(function (result) {\n        notify.log(selected.species.scientific_name + ' ' + selected.song.name + \" added to project\");\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.checked || !$scope.checked.length) return;\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove species\");\n      return;\n    }\n\n    var speciesClasses = $scope.checked.map(function (row) {\n      return '\"' + row.species_name + ' | ' + row.songtype_name + '\"';\n    });\n    var message = [\"Are you sure you would like to remove the following species call from this project?\"];\n    var message2 = [\"Note: validations for this species call will also be removed from this project.\"];\n    $scope.popup = {\n      messages: message.concat(message2, speciesClasses),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      var classesIds = $scope.checked.map(function (row) {\n        return row.id;\n      });\n      var params = {\n        project_classes: classesIds\n      };\n      Project.removeClasses(params).success(function (result) {\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n}).controller('SelectSpeciesCtrl', function ($scope, Species, Songtypes) {\n  var timeout;\n  Songtypes.get(function (songs) {\n    $scope.songtypes = songs;\n  });\n\n  $scope.searchSpecies = function () {\n    if ($scope.search === \"\") {\n      $scope.species = [];\n      return;\n    }\n\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      Species.search($scope.search, function (results) {\n        $scope.species = results;\n      });\n    }, 500);\n  };\n});","angular.module('a2.audiodata.training-sets', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.visualizer.layers.training-sets', 'humane']).factory('a2TrainingSetHistory', function () {\n  var lastSet, lastPage, lastRoi, lastRoiSet, viewState, lastSpecie, lastSongtype;\n  return {\n    getLastSet: function (callback) {\n      callback({\n        ls: lastSet,\n        lp: lastPage,\n        lr: lastRoi,\n        lrs: lastRoiSet,\n        vs: viewState,\n        sp: lastSpecie,\n        sg: lastSongtype\n      });\n    },\n    setLastSet: function (val) {\n      lastSet = val;\n    },\n    setLastPage: function (val) {\n      lastPage = val;\n    },\n    setLastRoi: function (val) {\n      lastRoi = val;\n    },\n    setLastRoiSet: function (val) {\n      lastRoiSet = val;\n    },\n    setViewState: function (val) {\n      viewState = val;\n    },\n    setLastSpecies: function (valsp, valsg) {\n      lastSpecie = valsp;\n      lastSongtype = valsg;\n    }\n  };\n}).controller('TrainingSetsCtrl', function ($state, a2TrainingSets, Project, $q, $modal, a2TrainingSetHistory, a2UserPermit, notify) {\n  var p = {\n    set: $state.params.set,\n    show: $state.params.show\n  };\n  this.selected = {\n    roi_index: 0,\n    roi: null,\n    page: 0\n  };\n  this.total = {\n    rois: 0,\n    pages: 0\n  };\n  this.loading = {\n    list: false,\n    details: false\n  };\n  this.rois = [];\n  this.species = '';\n  this.songtype = '';\n  this.detailedView = p.show != \"gallery\";\n  this.currentrois = [];\n  this.roisPerpage = 100;\n  this.detailedView = false;\n  this.loaderDisplay = false;\n\n  this.getROIVisualizerUrl = function (roi) {\n    return roi ? \"/project/\" + this.projecturl + \"/#/visualizer/rec/\" + roi.recording : '';\n  };\n\n  this.setROI = function (roi_index) {\n    if (this.total.rois <= 0) {\n      this.selected.roi_index = 0;\n      this.selected.roi = null;\n    } else {\n      this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n      this.selected.roi = this.rois[this.selected.roi_index];\n    }\n\n    a2TrainingSetHistory.setLastRoi(this.selected.roi);\n    return this.selected.roi;\n  };\n\n  this.setPage = function (page) {\n    if (this.total.rois <= 0) {\n      this.selected.page = 0;\n      this.selected.currentrois = [];\n    } else {\n      this.selected.page = Math.max(0, Math.min(page, this.total.rois / this.roisPerpage | 0));\n      this.currentrois = this.rois.slice(this.selected.page * this.roisPerpage, (this.selected.page + 1) * this.roisPerpage);\n    }\n\n    a2TrainingSetHistory.setLastPage(this.selected.page);\n    return this.currentrois;\n  };\n\n  this.setROISet = function (rois) {\n    this.rois = rois;\n    a2TrainingSetHistory.setLastRoiSet(this.rois);\n  };\n\n  this.nextROI = function (step) {\n    return this.setROI(this.selected.roi_index + (step || 1));\n  };\n\n  this.prevROI = function (step) {\n    return this.setROI(this.selected.roi_index - (step || 1));\n  };\n\n  this.nextPage = function (step) {\n    return this.setPage(this.selected.page + (step || 1));\n  };\n\n  this.prevPage = function (step) {\n    return this.setPage(this.selected.page - (step || 1));\n  };\n\n  this.next = function (step) {\n    if (!step) {\n      step = 1;\n    }\n\n    if (this.detailedView) {\n      this.nextROI(step);\n    } else {\n      this.nextPage(step);\n    }\n  };\n\n  this.prev = function (step) {\n    if (!step) {\n      step = 1;\n    }\n\n    return this.next(-step);\n  };\n\n  this.removeRoi = function (roiId) {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"You are about to delete a ROI. Are you sure?\"];\n        this.btnOk = \"Yes, do it!\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2TrainingSets.removeRoi(this.selected.trainingSet.id, roiId, function (data) {\n        if (data.affectedRows) {\n          for (var i = 0; i < this.rois.length; i++) {\n            if (this.rois[i].id == roiId) {\n              this.rois.splice(i, 1);\n              break;\n            }\n          }\n\n          this.total.rois = this.rois.length;\n          this.setROI(this.selected.roi_index);\n          this.setPage(this.selected.page);\n        }\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.closeSetDetails = function () {\n    this.showSetDetails = false;\n  };\n\n  this.getTrainingSetList = function () {\n    this.loading.list = true;\n    return a2TrainingSets.getList(function (data) {\n      this.trainingSets = data.map(function (d) {\n        d.date_created = new Date(d.date_created);\n        return d;\n      });\n\n      if (p.set) {\n        var selected = this.trainingSets.filter(function (tset) {\n          return tset.id == p.set;\n        }).pop();\n\n        if (selected) {\n          this.selectTrainingSet(selected);\n        }\n      }\n\n      this.loading.list = false;\n    }.bind(this));\n  };\n\n  this.addNewTrainingSet = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to create training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/training-data/add_tset_modal.html',\n      controller: 'a2VisualizerAddTrainingSetModalController'\n    }).result.then(this.getTrainingSetList.bind(this));\n  };\n\n  this.selectTrainingSet = function (selected) {\n    $state.transitionTo($state.current.name, {\n      set: selected.id,\n      show: $state.params.show\n    }, {\n      notify: false\n    });\n    this.detailedView = $state.params.show != \"gallery\";\n    this.loaderDisplay = true;\n    a2TrainingSetHistory.setLastSet(selected);\n\n    if (this.selected.trainingSet) {\n      if (this.selected.trainingSet.edit) {\n        delete this.selected.trainingSet.edit;\n      }\n    }\n\n    this.selected.trainingSet = selected;\n    Project.validationBySpeciesSong(selected.species, selected.songtype, function (data) {\n      this.selected.trainingSet.validations = data;\n    }.bind(this));\n    a2TrainingSets.getSpecies(selected.id, function (speciesData) {\n      this.species = speciesData.species;\n      this.songtype = speciesData.songtype;\n      a2TrainingSetHistory.setLastSpecies(this.species, this.songtype);\n      a2TrainingSets.getRois(selected.id, function (data) {\n        this.loaderDisplay = false;\n        this.detailedView = false;\n        this.total.rois = data.length;\n        this.total.pages = Math.ceil(this.total.rois / this.roisPerpage);\n        this.setROISet(data);\n        this.setROI(0);\n        this.setPage(0);\n        this.selected.page = 0;\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.setupExportUrl = function () {\n    this.selected.trainingSet.export_url = a2TrainingSets.getExportUrl(this.selected.trainingSet.id);\n  };\n\n  this.exportTSReport = function ($event) {\n    $event.stopPropagation();\n    if (a2UserPermit.isSuper()) return this.setupExportUrl();\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export Training Set data');\n    } else return this.setupExportUrl();\n  };\n\n  this.setDetailedView = function (detailedView) {\n    $state.transitionTo($state.current.name, {\n      set: $state.params.set,\n      show: detailedView ? \"detail\" : \"gallery\"\n    }, {\n      notify: false\n    });\n    this.detailedView = detailedView;\n    a2TrainingSetHistory.setViewState(this.detailedView);\n  };\n\n  this.editSelectedTrainingSet = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    if (this.selected.trainingSet) {\n      var trainingSet = this.selected.trainingSet;\n      var speciesClass = {\n        species: trainingSet.species,\n        songtype: trainingSet.songtype\n      };\n      speciesClass.species_name = this.species;\n      speciesClass.songtype_name = this.songtype;\n      Project.getClasses().then(function (classes) {\n        var d = $q.defer();\n        var current = classes.filter(function (cls) {\n          return speciesClass.species == cls.species && speciesClass.songtype == cls.songtype;\n        }).pop() || speciesClass;\n        trainingSet.edit = {\n          name: trainingSet.name,\n          class: current,\n          projectClasses: classes\n        };\n        trainingSet.edit.cancel = d.reject.bind(d);\n\n        trainingSet.edit.save = function () {\n          return a2TrainingSets.edit(trainingSet.id, {\n            name: trainingSet.edit.name,\n            class: trainingSet.edit.class.id\n          }).then(function (response) {\n            d.resolve(response.data);\n          }, function (response) {\n            notify.log(response.data);\n          });\n        };\n\n        return d.promise;\n      }).then(function (editedTrainingSet) {\n        for (var i in editedTrainingSet) {\n          trainingSet[i] = editedTrainingSet[i];\n        }\n\n        this.selectTrainingSet(trainingSet);\n      }.bind(this)).finally(function () {\n        delete trainingSet.edit;\n      });\n    }\n  };\n\n  this.deleteSelectedTrainingSet = function () {\n    var trainingSet = this.selected.trainingSet;\n\n    if (!trainingSet) {\n      return;\n    }\n\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"You are about to delete a the training set \\\"\" + trainingSet.name + \"\\\". Are you sure?\"];\n        this.btnOk = \"Yes, do it!\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      a2TrainingSets.delete(trainingSet.id, function (data) {\n        this.trainingSets.splice(this.trainingSets.indexOf(trainingSet), 1);\n        delete this.selected.trainingSet;\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.getTrainingSetList();\n  this.projecturl = Project.getUrl();\n  a2TrainingSetHistory.getLastSet(function (data) {\n    if (data.ls) {\n      this.showSetDetails = true;\n      this.selected.trainingSet = data.ls;\n      this.species = data.sp;\n      this.songtype = data.sg;\n      this.detailedView = data.vs;\n      this.total.rois = data.lrs.length;\n      this.total.pages = Math.ceil(this.total.rois / this.roisPerpage);\n      this.selected.page = data.lp;\n      this.setROISet(data.lrs);\n      this.setPage(data.lp);\n      this.setROI(data.lr || 0);\n    }\n  }.bind(this));\n});","angular.module('a2.jobs', ['a2.services', 'a2.permissions']).config(function ($stateProvider) {\n  $stateProvider.state('jobs', {\n    url: '/jobs',\n    controller: 'StatusBarNavController',\n    templateUrl: '/app/jobs/index.html'\n  });\n}).controller('StatusBarNavController', function ($scope, $http, $modal, $window, Project, JobsData, notify, a2UserPermit) {\n  $scope.show = {};\n  $scope.showClassifications = true;\n  $scope.showTrainings = true;\n  $scope.showSoundscapes = true;\n  $scope.url = '';\n  $scope.successInfo = \"\";\n  $scope.showSuccesss = false;\n  $scope.errorInfo = \"\";\n  $scope.showErrors = false;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = {\n    jobs: false\n  };\n  $scope.loading.jobs = true;\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n  };\n\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n\n  var hideJob = function (jobId, action) {\n    $http.get('/api/project/' + Project.getUrl() + '/jobs/hide/' + jobId).success(function (data) {\n      JobsData.updateJobs();\n      const message = 'Job ' + action + ' successfully.';\n      notify.log(message);\n    }).error(function (data) {\n      if (data.error) {\n        notify.error(error);\n      } else {\n        notify.serverError();\n      }\n    });\n  };\n\n  JobsData.getJobTypes().success(function (data) {\n    var colors = ['#1482f8', '#df3627', '#40af3b', '#9f51bf', '#d37528', '#ffff00', '#5bc0de'];\n    var job_types_id = [1, 2, 4, 6, 7, 8, 9];\n    var job_types = data.filter(function (type) {\n      return job_types_id.includes(type.id);\n    });\n    $scope.job_types = {};\n    $scope.job_types.types = job_types;\n    $scope.job_types.show = {};\n    $scope.job_types.for = {};\n    $scope.job_types.types.forEach(function (c, i) {\n      $scope.show[c.id] = true;\n      $scope.job_types.for[c.id] = c;\n      c.color = colors[i % colors.length];\n    });\n  });\n  $scope.$watch(function () {\n    return JobsData.getJobs();\n  }, function (new_jobs) {\n    $scope.jobs = new_jobs;\n    $scope.loading.jobs = false;\n    JobsData.startTimer();\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n  }, true);\n  $scope.$on('$destroy', function () {\n    JobsData.cancelTimer();\n  });\n\n  $scope.showActiveJobs = function () {\n    return !$scope.loading.jobs && $scope.jobs !== undefined && $scope.jobs.length;\n  };\n\n  $scope.showEmptyList = function () {\n    return !$scope.loading.jobs && $scope.jobs !== undefined && !$scope.jobs.length;\n  };\n\n  $scope.showLoader = function () {\n    return $scope.jobs === undefined;\n  };\n\n  var confirm = function (titlen, action, cb, vl, message) {\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.title = titlen + ' running job';\n        this.messages = [\"This job has not finished yet. Are you sure?\"];\n        this.btnOk = \"Yes, \" + action + \" it\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: \"popup\"\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n    });\n    modalInstance.result.then(function (ok) {\n      cb(vl, message);\n    });\n  };\n\n  $scope.hide = function (job) {\n    if (!a2UserPermit.can('manage project jobs')) {\n      notify.error('You do not have permission to hide or cancel jobs');\n      return;\n    }\n\n    const jobId = job.job_id;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n\n    if (job.percentage < 100) {\n      confirm('Cancel', 'cancel', hideJob, jobId, 'canceled');\n    } else {\n      hideJob(jobId, 'hidden');\n    }\n  };\n\n  $scope.isCompleted = function (row) {\n    return row.state === 'completed';\n  };\n\n  $scope.isProcessing = function (row) {\n    return row.state === 'processing';\n  };\n\n  $scope.isWaiting = function (row) {\n    return row.state === 'waiting';\n  };\n\n  $scope.openJob = function (row) {\n    $window.location.href = '/project/' + Project.getUrl() + '/analysis/' + row.url;\n  };\n}).service('JobsData', function ($http, $interval, Project, $q) {\n  var jobs;\n  var url = Project.getUrl();\n  var intervalPromise;\n  var isProcessing = false;\n\n  updateJobs = function () {\n    if (isProcessing) return;\n    isProcessing = true;\n    $http.get('/api/project/' + url + '/jobs/progress', {\n      params: {\n        last3Months: true\n      }\n    }).success(function (data) {\n      data.forEach(function (item) {\n        if (item.job_type_id === 1 && item.completed === 0 && item.state === 'error') {\n          item.state = 'error: insufficient validations';\n        }\n\n        if (item.job_type_id === 2 && item.completed === 0 && item.state === 'completed') {\n          item.state = 'processing';\n        }\n      });\n      jobs = data;\n      isProcessing = false;\n    });\n  };\n\n  updateJobs();\n  return {\n    geturl: function () {\n      return url;\n    },\n    getJobs: function () {\n      return jobs;\n    },\n    getJobTypes: function () {\n      return $http.get('/api/jobs/types');\n    },\n    updateJobs: function () {\n      return updateJobs();\n    },\n    startTimer: function () {\n      $interval.cancel(intervalPromise);\n\n      if (typeof jobs != 'undefined' && jobs.length > 0) {\n        intervalPromise = $interval(function () {\n          var cancelInterval = true;\n\n          for (var i = 0; i < jobs.length; i++) {\n            if (jobs[i].percentage < 100) {\n              cancelInterval = false;\n              break;\n            }\n          }\n\n          if (cancelInterval) {\n            $interval.cancel(intervalPromise);\n          } else if (jobs.length < 1) {\n            $interval.cancel(intervalPromise);\n          } else {\n            updateJobs();\n          }\n        }, 10000);\n      }\n    },\n    cancelTimer: function () {\n      $interval.cancel(intervalPromise);\n    }\n  };\n});","angular.module('a2.citizen-scientist', ['a2.citizen-scientist.my-stats', 'a2.directive.audio-bar', 'a2.citizen-scientist.patternmatching', 'a2.citizen-scientist.expert', 'a2.citizen-scientist.admin', 'ui.router', 'ct.ui.router.extras']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/citizen-scientist\", \"/citizen-scientist/patternmatching/\");\n  $stateProvider.state('citizen-scientist', {\n    url: '/citizen-scientist',\n    views: {\n      'citizen-scientist': {\n        templateUrl: '/app/citizen-scientist/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  });\n});","angular.module('a2.app.dashboard', ['a2.services', 'a2.directives', 'ui.bootstrap', 'ui.router', 'ct.ui.router.extras', 'a2.forms', 'humane', 'a2.googlemaps', 'a2.directive.warning-banner']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('dashboard', {\n    url: '/dashboard',\n    controller: 'SummaryCtrl',\n    templateUrl: '/app/dashboard/index.html'\n  });\n}).controller('SummaryCtrl', function ($scope, Project, a2Templates, a2GoogleMapsLoader, $timeout, $window, $compile, $templateFetch, a2PatternMatching) {\n  $scope.loading = 5;\n\n  var done = function () {\n    if ($scope.loading > 0) --$scope.loading;\n  };\n\n  Project.getInfo(function (info) {\n    $scope.project = info;\n    $scope.isSpeciesLoading = true;\n    Project.getProjectTotalSpecies(info.project_id, function (data) {\n      $scope.speciesQty = data || 0;\n      $scope.isSpeciesLoading = false;\n    });\n    done();\n  });\n  Project.getSites(function (sites) {\n    $scope.sites = sites;\n    done();\n    $timeout(function () {\n      a2GoogleMapsLoader.then(function (google) {\n        $scope.map = new google.maps.Map($window.document.getElementById('summary-map'), {\n          center: {\n            lat: 0,\n            lng: 0\n          },\n          mapTypeId: google.maps.MapTypeId.SATELLITE,\n          zoom: 8,\n          minZoom: 2\n        });\n        var bounds = new google.maps.LatLngBounds();\n        angular.forEach($scope.sites, function (site) {\n          if (site.lat > 85 || site.lat < -85 || site.lon > 180 || site.lon < -180) {\n            return;\n          }\n\n          var position = new google.maps.LatLng(site.lat, site.lon);\n          var marker = new google.maps.Marker({\n            position: position,\n            title: site.name\n          });\n          bounds.extend(position);\n          marker.setMap($scope.map);\n          $scope.map.fitBounds(bounds);\n        });\n      });\n    }, 100);\n  });\n  Project.getRecTotalQty(function (data) {\n    $scope.recsQty = data;\n    done();\n  });\n  a2Templates.getList().then(function (data) {\n    $scope.templateQty = data.length;\n    done();\n  });\n  a2PatternMatching.getPatternMatchingsTotal(function (data) {\n    $scope.pmQty = data;\n    done();\n  });\n});","angular.module('a2.settings', ['a2.services', 'a2.directives', 'a2.forms', 'a2.orders', 'a2.permissions', 'a2.directive.sidenav-bar', 'ui.bootstrap', 'ui.router', 'ct.ui.router.extras', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/settings\", \"/settings/details\");\n\n  var accessCheck = function (a2UserPermit) {\n    return a2UserPermit.can(\"manage project settings\");\n  };\n\n  $stateProvider.state('settings', {\n    url: '/settings',\n    templateUrl: '/app/settings/index.html',\n    allowAccess: accessCheck\n  }).state('settings.details', {\n    url: '/details',\n    controller: 'SettingsDetailsCtrl',\n    templateUrl: '/app/settings/details.html',\n    allowAccess: accessCheck\n  }).state('settings.users', {\n    url: '/users',\n    controller: 'SettingsUsersCtrl',\n    templateUrl: '/app/settings/users.html',\n    allowAccess: accessCheck\n  });\n}).controller('SettingsDetailsCtrl', function ($scope, Project, notify, $window, $timeout, a2order, a2UserPermit, $modal) {\n  $scope.today = new Date();\n  Project.getInfo(function (info) {\n    if (info.plan_activated && info.plan_period) {\n      info.plan_due = new Date(info.plan_activated);\n      info.plan_due.setFullYear(info.plan_due.getFullYear() + info.plan_period);\n    }\n\n    $scope.project = info;\n  });\n  Project.getUsage().success(function (usage) {\n    $scope.minUsage = usage.min_usage;\n  });\n\n  $scope.save = function () {\n    console.log($scope);\n    if (!$scope.isValid) return;\n\n    if (!$scope.project.description) {\n      $scope.project.description = '';\n    }\n\n    Project.updateInfo({\n      project: $scope.project\n    }, function (err, result) {\n      if (err) {\n        return notify.serverError();\n      }\n\n      if (result.error) {\n        return notify.error(result.error);\n      }\n\n      notify.log('Project info updated');\n\n      if (result.url) {\n        $timeout(function () {\n          $window.location.assign('/project/' + result.url + '/#/settings');\n        }, 1000);\n      }\n    });\n  };\n\n  $scope.deleteProject = function () {\n    if (!a2UserPermit.can('delete project')) {\n      notify.error('You do not have permission to delete this project');\n      return;\n    }\n\n    $scope.popup = {\n      title: 'Delete project',\n      messages: ['Are you sure you want to delete this project?'],\n      btnOk: 'Yes',\n      btnCancel: 'No'\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      return Project.removeProject({\n        external_id: $scope.project.external_id\n      }).then(function () {\n        notify.log('Project deleted');\n        $window.location.href = '/projects';\n      });\n    });\n  };\n\n  $scope.changePlan = function () {\n    var modalInstance = a2order.changePlan({});\n  };\n}).controller('SettingsUsersCtrl', function ($scope, $http, Project, $modal, notify) {\n  $scope.userToAdd = '';\n  $scope.curQuery = '';\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  Project.getUsers(function (err, users) {\n    $scope.users = users;\n  });\n  Project.getRoles(function (err, roles) {\n    $scope.roles = roles;\n  });\n\n  $scope.findUser = function (query) {\n    $scope.curQuery = query;\n    return $http.get('/api/user/search/' + query).then(function (response) {\n      return response.data;\n    });\n  };\n\n  $scope.inviteUser = function (data) {\n    return $http.post('/api/user/invite', data).then(function (response) {\n      return response.data;\n    });\n  };\n\n  $scope.add = function () {\n    if (!$scope.userToAdd) {\n      return;\n    }\n\n    Project.addUser({\n      project_id: $scope.project.project_id,\n      user_id: $scope.userToAdd.id,\n      user_email: $scope.userToAdd.email\n    }, function (err) {\n      if (err) {\n        notify.error(err);\n      } else {\n        $scope.curQuery = '';\n        notify.log('User added to project');\n      }\n\n      Project.getUsers(function (err, users) {\n        $scope.users = users;\n      });\n    });\n  };\n\n  $scope.invite = function () {\n    $scope.showInvitationPopup($scope.curQuery);\n  };\n\n  $scope.showInvitationPopup = function (email) {\n    var modalInstance = $modal.open({\n      templateUrl: '/app/settings/invitation.html',\n      controller: 'UserInvitationCtrl as controller',\n      resolve: {\n        email: function () {\n          return email;\n        },\n        inviteUser: function () {\n          return $scope.inviteUser;\n        }\n      }\n    });\n    modalInstance.result.then(function (user) {\n      $scope.noResults = false;\n      $scope.userToAdd = user;\n      $scope.userToAdd.id = user.user_id;\n      $scope.add();\n    });\n  };\n\n  $scope.changeRole = function ($index) {\n    var role = $scope.roles.filter(function (value) {\n      return $scope.users[$index].rolename === value.name;\n    })[0];\n    Project.changeUserRole({\n      project_id: $scope.project.project_id,\n      user_id: $scope.users[$index].id,\n      user_email: $scope.users[$index].email,\n      role_id: role.id\n    }, function (err) {\n      if (err) {\n        notify.error(err);\n      } else {\n        notify.log('User role updated');\n      }\n\n      Project.getUsers(function (err, users) {\n        $scope.users = users;\n      });\n    });\n  };\n\n  const message = ['Are you sure you would like to remove the following user from this project?'];\n\n  $scope.del = function ($index) {\n    const user = $scope.users[$index];\n    $scope.popup = {\n      messages: message.concat(user.firstname + ' ' + user.lastname + ' ' + '(' + user.email + ')'),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      Project.removeUser({\n        project_id: $scope.project.project_id,\n        user_id: $scope.users[$index].id,\n        user_email: $scope.users[$index].email\n      }, function (err) {\n        if (err) {\n          notify.error(err);\n        } else {\n          notify.log('User deleted from project');\n        }\n\n        Project.getUsers(function (err, users) {\n          $scope.users = users;\n        });\n      });\n    });\n  };\n}).controller('UserInvitationCtrl', function ($modalInstance, notify, email, inviteUser) {\n  Object.assign(this, {\n    initialize: function () {\n      this.isLoading = false;\n      this.data = {\n        email: email,\n        firstname: '',\n        lastname: ''\n      };\n    },\n    submit: function () {\n      var _this = this;\n\n      try {\n        this.isLoading = true;\n        return inviteUser(this.data).then(function (user) {\n          $modalInstance.close(user);\n        }).catch(notify.serverError).finally(function () {\n          _this.isLoading = false;\n        });\n      } catch (error) {\n        console.error('UserInvitationCtrl.submit error: ', error);\n      }\n    },\n    cancel: function () {\n      $modalInstance.close(null);\n    },\n    isDataValid: function () {\n      return this.data.email.trim().length > 0 && this.data.firstname.trim().length > 0 && this.data.lastname.trim().length > 0;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.visualizer.audio-player', []).service('a2AudioPlayer', function (A2AudioObject, $q, notify, a2Playlists, Project, $localStorage, a2UserPermit) {\n  'use strict';\n\n  var a2AudioPlayer = function (scope, options) {\n    this.scope = scope;\n    this.gain = 1;\n    this.gain_levels = [1, 2, 5, 10, 15, 20, 25, 30, 50];\n    this.freq_filter = undefined;\n    this.is_playing = false;\n    this.is_muted = false;\n    this.has_recording = false;\n    this.has_next_recording = false;\n    this.has_prev_recording = false;\n    this.resource = null;\n    this.resource_params = {};\n    this.isPopupOpened = false;\n    this.isSavingPlaylist = false;\n    this.playlistData = {};\n    this.clustersData = null;\n\n    if (options) {\n      if (options.gain) {\n        this.gain = Math.min(Math.max(1, (options && options.gain) | 0), this.gain_levels[this.gain_levels.length - 1]);\n        this.resource_params.gain = this.gain;\n      }\n\n      if (options.filter) {\n        var f = options.filter.split('-');\n        var f0 = f.shift() | 0,\n            f1 = f.shift() | 0;\n        var fmin = Math.min(f0, f1),\n            fmax = Math.max(f0, f1);\n\n        if (fmax) {\n          this.freq_filter = {\n            min: fmin,\n            max: fmax\n          };\n          this.resource_params.maxFreq = fmax;\n          this.resource_params.minFreq = fmin;\n        }\n      }\n    }\n\n    scope.$on('$destroy', this.discard.bind(this));\n  };\n\n  a2AudioPlayer.prototype = {\n    setFrequencyFilter: function (freq_filter) {\n      if (freq_filter) {\n        this.resource_params.maxFreq = freq_filter.max;\n        this.resource_params.minFreq = freq_filter.min;\n      } else {\n        delete this.resource_params.maxFreq;\n        delete this.resource_params.minFreq;\n      }\n\n      return this.load(this.resource_url).then(function () {\n        this.freq_filter = freq_filter;\n      }.bind(this)); // this.resource.setFrequencyFilter(filter).then((function(){\n      //     this.freq_filter = filter;\n      // }).bind(this));\n    },\n    setGain: function (gain) {\n      gain = Math.max(1, gain | 0);\n\n      if (gain != 1) {\n        this.resource_params.gain = gain;\n      } else {\n        delete this.resource_params.gain;\n      }\n\n      return (this.resource_url ? this.load(this.resource_url) : $q.resolve()).then(function () {\n        this.gain = gain;\n      }.bind(this)); // this.resource.setGain(gain).then((function(){\n      //     this.gain = gain;\n      // }).bind(this));\n    },\n    getVolume: function () {\n      return this.resource && this.resource.audio.volume;\n    },\n    setCurrentTime: function (time) {\n      if (this.resource) {\n        this.resource.setCurrentTime(time);\n      }\n    },\n    getCurrentTime: function () {\n      return this.resource && this.resource.audio && this.resource.audio.currentTime;\n    },\n    togglePopup: function () {\n      this.isPopupOpened = !this.isPopupOpened;\n    },\n    isPlaylistDataValid: function () {\n      return this.playlistData.playlistName && this.playlistData.playlistName.trim().length > 0;\n    },\n    closePopup: function () {\n      this.isPopupOpened = false;\n    },\n    savePlaylist: function () {\n      this.isSavingPlaylist = true; // create playlist\n\n      if (this.clustersData && this.clustersData.playlist) {\n        var self = this;\n        a2Playlists.create({\n          playlist_name: this.playlistData.playlistName,\n          params: this.clustersData.playlist.recordings,\n          aedIdsIncluded: true\n        }, function (data) {\n          self.isSavingPlaylist = false;\n          self.closePopup(); // attach aed to playlist\n\n          if (data && data.playlist_id) {\n            a2Playlists.attachAedToPlaylist({\n              playlist_id: data.playlist_id,\n              aed: self.clustersData.aed\n            }, function (data) {\n              self.playlistData = {};\n              notify.log('Audio event detections are saved in the playlist.');\n            });\n          }\n        });\n      }\n    },\n    _load_resource: function (url, params) {\n      this.loading = true;\n\n      if (params) {\n        var pk = Object.keys(params);\n\n        if (pk.length) {\n          var ch = /\\?/.test(url) ? '&' : '?';\n          url += ch + pk.map(function (k) {\n            return k + '=' + params[k];\n          }).join('&');\n        }\n      }\n\n      var resource = new A2AudioObject(url);\n      resource.onCompleteListeners.push(function () {\n        this.is_playing = false;\n      }.bind(this));\n      return resource.load_promise.then(function () {\n        this.loading = false;\n      }.bind(this)).then(function () {\n        return resource;\n      });\n    },\n    load: function (url) {\n      this.discard();\n      this.resource = undefined;\n      return this._load_resource(url, this.resource_params).then(function (resource) {\n        this.resource = resource;\n        this.duration = resource.duration;\n        this.resource_url = url;\n        this.has_recording = true;\n        this.clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n        console.log('clustersData', this.clustersData);\n      }.bind(this));\n    },\n    discard: function () {\n      this.stop();\n\n      if (this.resource) {\n        this.resource.discard();\n      }\n\n      this.has_recording = false;\n      this.resource = undefined;\n      this.resource_url = undefined;\n    },\n    mute: function (muted) {\n      if (this.resource) {\n        this.resource[muted ? 'mute' : 'unmute']();\n      }\n\n      this.is_muted = muted;\n    },\n    play: function () {\n      if (this.resource) {\n        this.resource.play();\n        this.is_playing = true;\n      }\n    },\n    pause: function () {\n      if (this.resource) {\n        this.resource.pause();\n      }\n\n      this.is_playing = false;\n    },\n    stop: function () {\n      if (this.resource) {\n        this.resource.stop();\n      }\n\n      this.is_playing = false;\n    },\n    prev_recording: function () {\n      this.scope.$broadcast('prev-visobject');\n    },\n    next_recording: function () {\n      this.scope.$broadcast('next-visobject');\n    },\n    download: function (visobject) {\n      if (a2UserPermit.isSuper()) return this.getExportUrl(visobject);\n\n      if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n        return notify.error('You do not have permission to download recording');\n      }\n\n      return this.getExportUrl(visobject);\n    },\n    getExportUrl: function (visobject) {\n      const form = document.createElement('form');\n      form.style.display = 'none';\n      form.method = 'GET';\n      const url = '/api/project/' + Project.getUrl() + '/recordings/download/' + visobject.id;\n      form.action = url;\n      document.body.appendChild(form);\n      form.submit();\n      document.body.removeChild(form);\n    }\n  };\n  return a2AudioPlayer;\n}).factory('A2AudioObject', ['$window', '$interval', '$q', function ($window, $interval, $q) {\n  var poll_loop_interval = 50; // 25;\n  // var AudioContext = $window.AudioContext || $window.webkitAudioContext;\n\n  function loadAudio(url) {\n    var deferred = $q.defer();\n    var audio = new $window.Audio();\n    url = url.replace('|', '/');\n    audio.addEventListener('error', function (err) {\n      console.log('err', err);\n      deferred.reject();\n    });\n    audio.addEventListener('loadstart', function () {\n      deferred.resolve(audio);\n    }); // bugfix for chrome...\n\n    $window.setTimeout(function () {\n      audio.src = url;\n    }, 1);\n    return deferred.promise;\n  }\n\n  var A2AudioObject = function (url) {\n    var d = $q.defer();\n    this.url = url;\n    this.onCompleteListeners = [];\n    this.interval = $interval(this._check_current_time.bind(this), poll_loop_interval);\n    this.load_promise = loadAudio(url).then(function (nativeAudio) {\n      this.audio = nativeAudio;\n      this.audio.addEventListener('canplay', function () {\n        this.duration = this.audio.duration;\n        this.paused = this.audio.paused;\n        this.src = this.audio.src;\n        this.canPlay = true;\n      }.bind(this));\n      this.audio.addEventListener('error', function (err) {\n        this.canPlay = false;\n        console.log(err);\n      }.bind(this));\n    }.bind(this), function (error) {\n      this.error = true;\n      console.log('Unable to listen to your recordings due to corrupted data');\n    }.bind(this));\n  };\n\n  A2AudioObject.prototype = {\n    // disconnect_ctx: function(){\n    //     return this.context.suspend().then((function(){\n    //         if(this.ctx_filter){\n    //             this.ctx_filter.max.disconnect();\n    //             this.ctx_filter.min.disconnect();\n    //         }\n    //         if(this.ctx_gain){\n    //             this.ctx_gain.disconnect();\n    //         }\n    //         this.ctx_source.disconnect();\n    //         return this.context.resume();\n    //     }).bind(this));\n    // },\n    // setup_ctx_connections: function(){\n    //     return this.context.suspend().then((function(){\n    //         var output = this.context.destination;\n    //         if(this.ctx_gain){\n    //             this.ctx_gain.connect(output);\n    //             output = this.ctx_gain;\n    //         }\n    //         if(this.ctx_filter){\n    //             this.ctx_filter.min.connect(output);\n    //             this.ctx_filter.max.connect(this.ctx_filter.min);\n    //             output = this.ctx_filter.max;\n    //         }\n    //         this.ctx_source.connect(output);\n    //         return this.context.resume();\n    //     }).bind(this));\n    // },\n    // setGain: function(gain){\n    //     var d = $q.defer();\n    //     this.gain = gain;\n    //     var created=false;\n    //     if(!this.ctx_gain){\n    //         this.ctx_gain = this.context.createGain();\n    //         created=true;\n    //     }\n    //     this.ctx_gain.gain.value = gain;\n    //     if(created){\n    //         this.setup_ctx_connections().then(d.resolve.bind(d), d.reject.bind(d));\n    //     } else {\n    //         d.resolve();\n    //     }\n    //     return d.promise;\n    // },\n    // setFrequencyFilter: function(filter){\n    //     var d = $q.defer();\n    //     d.resolve();\n    //     var promise = d.promise;\n    //     this.filter = filter;\n    //     var need_to_connect=false;\n    //     if(filter){\n    //         var f0 = Math.sqrt(filter.max * (filter.min||1)), bw = filter.max - filter.min;\n    //         var Q  = f0 / bw;\n    //         if(!this.ctx_filter){\n    //             this.ctx_filter = {\n    //                 min:this.context.createBiquadFilter(),\n    //                 max:this.context.createBiquadFilter()\n    //             };\n    //             this.ctx_filter.min.type.value = 'highpass';\n    //             this.ctx_filter.max.type.value = 'lopass';\n    //             this.ctx_filter.min.Q.value = 0.5;\n    //             this.ctx_filter.max.Q.value = 0.5;\n    //             need_to_connect = true;\n    //         }\n    //         this.ctx_filter.max.frequency.value = filter.max;\n    //         this.ctx_filter.min.frequency.value = filter.min;\n    //     } else if(!filter){\n    //         if(this.ctx_filter){\n    //             promise = this.disconnect_ctx().then((function(){\n    //                 this.ctx_filter = undefined;\n    //             }).bind(this));\n    //             need_to_connect = true;\n    //         }\n    //     }\n    //\n    //     if(need_to_connect){\n    //         promise = promise.then((function(){\n    //             return this.setup_ctx_connections();\n    //         }).bind(this));\n    //     }\n    //\n    //     return promise;\n    // },\n    play: function () {\n      // this.context.resume();\n      this.audio.play();\n      return this;\n    },\n    complete: function (callback) {\n      this.onCompleteListeners.push(callback);\n    },\n    pause: function () {\n      this.audio.pause(); // this.context.suspend();\n    },\n    restart: function () {\n      this.audio.pause(); // this.context.suspend();\n\n      this.audio.currentTime = 0;\n    },\n    stop: function () {\n      this.restart();\n    },\n    discard: function () {\n      if (!this.discarded) {\n        this.discarded = true;\n      }\n\n      if (this.context) {\n        this.context.close();\n        this.context = undefined;\n      }\n\n      if (this.interval) {\n        $interval.cancel(this.interval);\n        this.interval = undefined;\n      }\n    },\n    setVolume: function (volume) {\n      this.unmutedVolume = volume;\n      this.muted = false;\n      this.audio.volume = volume;\n    },\n    setPlaybackRate: function (rate) {\n      this.audio.playbackRate = rate;\n    },\n    setMuting: function (muting) {\n      this.muted = muting;\n      this.audio.volume = +this.muted * this.unmutedVolume;\n    },\n    setProgress: function (progress) {\n      if (this.audio && this.audio.duration && isFinite(progress)) {\n        this.audio.currentTime = this.audio.duration * progress;\n      }\n    },\n    setCurrentTime: function (currentTime) {\n      if (this.audio && this.audio.duration) {\n        this.audio.currentTime = currentTime;\n      }\n    },\n    _check_current_time: function () {\n      if (this.audio) {\n        this.currentTime = this.audio.currentTime;\n\n        if (this.currentTime >= this.duration) {\n          this.onCompleteListeners.forEach(function (listener) {\n            listener(this);\n          });\n        }\n      }\n    }\n  };\n  return A2AudioObject;\n}]);","angular.module('visualizer-layers', ['visualizer-services', 'a2.utils']).directive('a2VisualizerLayerItem', function (layer_types, $compile, $templateFetch) {\n  return {\n    restrict: 'E',\n    replace: true,\n    templateUrl: '/app/visualizer/layer-item/default.html',\n    link: function (scope, element, attrs) {\n      var layer_type = layer_types[scope.layer.type] ? scope.layer.type : false;\n      var layer_key = layer_types[layer_type] ? layer_types[layer_type].type : null;\n\n      if (layer_key && layer_key != 'default') {\n        var layer_url = '/app/visualizer/layer-item/' + layer_key + '.html';\n        var layer_tmp = $templateFetch(layer_url, function (layer_tmp) {\n          var layer_el = $compile(layer_tmp)(scope);\n          element.append(layer_el.children().unwrap());\n        });\n      }\n    }\n  };\n});","angular.module('visualizer-services', ['a2.services']).provider('layer_types', function () {\n  var type_array = [];\n  return {\n    addLayerType: function (layerType) {\n      type_array.push(layerType);\n      return this;\n    },\n    $get: function () {\n      var layer_types = {};\n      type_array.forEach(function (lt) {\n        layer_types[lt.type] = lt;\n      });\n      return layer_types;\n    }\n  };\n}).service('a2VisualizerLayers', function (layer_types, $controller) {\n  var layers = function ($scope, VisualizerCtrl) {\n    this.$scope = $scope;\n    this.VisualizerCtrl = VisualizerCtrl;\n    this.list = [];\n  };\n\n  layers.prototype = {\n    types: layer_types,\n    __new_layer__: function (layer_type) {\n      var layer_def = this.types[layer_type];\n\n      if (layer_def) {\n        var layer_maker = function () {};\n\n        layer_maker.prototype = layer_def;\n        var layer = new layer_maker();\n\n        if (layer.controller && typeof layer.controller == 'string') {\n          var cname = /^(.*?)( as (.*?))$/.exec(layer.controller);\n\n          if (cname) {\n            layer[cname[2] ? cname[3] : 'controller'] = $controller(cname[1], {\n              $scope: this.$scope,\n              VisualizerCtrl: this.VisualizerCtrl\n            });\n          }\n        }\n\n        return layer;\n      } else {\n        return null;\n      }\n    },\n    add: function () {\n      for (var a = arguments, i = 0, e = a.length; i < e; ++i) {\n        var layer_type = a[i];\n\n        if (layer_types[layer_type]) {\n          this.list.push(this.__new_layer__(layer_type));\n        } else {\n          console.warn(\"Unknown layer of type \" + layer_type + \".\");\n        }\n      }\n    },\n    __check_type: function (reqtype, curtype) {\n      if (reqtype instanceof Array) {\n        var idx = reqtype.indexOf(curtype);\n\n        if (idx == -1) {\n          return false;\n        }\n      } else if (curtype != reqtype) {\n        return false;\n      }\n\n      return true;\n    },\n    check_requirements: function (req) {\n      var browsetype = this.$scope.visobject_type;\n      var votype = this.$scope.visobject ? this.$scope.visobject.type : browsetype;\n\n      if (!req) {\n        return true;\n      } else if (req.selection && !this.$scope.visobject) {\n        return false;\n      } else if (req.type && !this.__check_type(req.type, votype)) {\n        return false;\n      } else if (req.browsetype && !this.__check_type(req.browsetype, browsetype)) {\n        return false;\n      } else if (req.that && !req.that(this.$scope)) {\n        return false;\n      }\n\n      return true;\n    },\n    sidebar_visible: function (l) {\n      if (l.sidebar_visible && !l.sidebar_visible($scope)) {\n        return false;\n      } else if (!this.check_requirements(l.require)) {\n        return false;\n      }\n\n      return true;\n    },\n    spectrogram_visible: function (l) {\n      return this.check_requirements(l.require) && l.visible;\n    },\n    display_sidebar: function (l) {\n      return !l.display || l.display.sidebar !== false;\n    },\n    display_spectrogram: function (l) {\n      return !l.display || l && l.display && l.display.spectrogram !== false;\n    }\n  };\n  return layers;\n}).provider('training_set_types', function () {\n  var training_set_types = [];\n  return {\n    add: function (type) {\n      training_set_types.push(type);\n      return this;\n    },\n    $get: function () {\n      return training_set_types.reduce(function (_, tst) {\n        _[tst.type] = tst;\n        return _;\n      }, {});\n    }\n  };\n}).controller('a2ProjectClasses', function (Project) {\n  var self = this;\n  Project.getClasses(function (list) {\n    self.list = list;\n  });\n}).service('a22PointBBoxEditor', function ($timeout, a2TrainingSets, training_set_types) {\n  var editor = function () {\n    this.min_eps = 0.001;\n    this.scalex = 1.0;\n    this.scaley = 0.001;\n    this.reset();\n  };\n\n  editor.prototype = {\n    reset: function () {\n      this.bbox = null;\n      this.points = null;\n      this.tracer = null;\n      this.valid = false;\n      return this;\n    },\n    make_new_bbox: function () {\n      this.bbox = {};\n      this.points = [];\n      this.valid = false;\n    },\n    add_tracer_point: function (x, y) {\n      if (this.bbox && !this.valid) {\n        var tracer = [x, y];\n        this.tracer = tracer;\n        this.validate([tracer]);\n      }\n    },\n    add_point: function (x, y, min_eps) {\n      min_eps = min_eps || this.min_eps;\n      var similars = this.points && this.points.filter(function (pt) {\n        var dx = (pt[0] - x) * this.scalex,\n            dy = (pt[1] - y) * this.scaley,\n            dd = dx * dx + dy * dy;\n        return dd <= min_eps;\n      });\n\n      if (similars && similars.length > 0) {\n        return;\n      }\n\n      if (!this.bbox) {\n        this.make_new_bbox();\n      }\n\n      if (this.points.length < 2) {\n        this.points.push([x, y]);\n      }\n\n      this.validate();\n    },\n    validate: function (tmp_points) {\n      var pts_x = this.points.map(function (x) {\n        return x[0];\n      });\n      var pts_y = this.points.map(function (x) {\n        return x[1];\n      });\n\n      if (tmp_points) {\n        pts_x.push.apply(pts_x, tmp_points.map(function (x) {\n          return x[0];\n        }));\n        pts_y.push.apply(pts_y, tmp_points.map(function (x) {\n          return x[1];\n        }));\n      }\n\n      this.bbox.x1 = Math.min.apply(null, pts_x);\n      this.bbox.y1 = Math.min.apply(null, pts_y);\n      this.bbox.x2 = Math.max.apply(null, pts_x);\n      this.bbox.y2 = Math.max.apply(null, pts_y);\n      this.valid = this.points.length >= 2;\n    }\n  };\n  editor.prototype.super = editor.prototype;\n  return editor;\n});","angular.module('a2.soundscapeRegionTags', ['a2.infotags']).directive('a2SoundscapeRegionTag', function ($injector) {\n  var clsprefix = 'label-';\n\n  var resolve_tag = function (scope, element, tag) {\n    var txt = element.children('.txt');\n    var label_classes = ['default', 'primary', 'success', 'info', 'warning', 'danger'];\n    var default_colors_by_type = {\n      species_sound: 'blue'\n    };\n\n    if (!tag) {\n      element.hide();\n    } else {\n      element.show();\n    }\n\n    scope.class = \"\";\n    scope.style = {};\n\n    if (typeof tag == 'string') {\n      txt.text(tag);\n      scope.class = clsprefix + \"default\";\n    } else {\n      var type = tag.type;\n      var text = tag.text || tag.tag;\n      var color = tag.color || 'default';\n      scope.count = tag.count === undefined ? '' : tag.count | 0;\n\n      if (type == 'species_sound') {\n        $injector.invoke(resolve_species_tag, this, {\n          element: txt,\n          text: text,\n          $scope: scope\n        });\n      } else {\n        type = 'normal';\n        txt.text(text);\n      }\n\n      if (color == 'default' && default_colors_by_type[type]) {\n        color = default_colors_by_type[type];\n      }\n\n      if (label_classes.indexOf(color) >= 0) {\n        scope.class = clsprefix + color;\n      } else {\n        scope.style['background-color'] = color;\n      }\n    }\n  };\n\n  var resolve_species_tag = function (element, text, $compile, $scope) {\n    element.empty().append($compile('<a2-species species=\"' + (text | 0) + '\"></a2-species species>')($scope));\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      tag: '=',\n      closeable: '=?',\n      showCount: '=?',\n      onClose: '&'\n    },\n    replace: true,\n    templateUrl: '/app/visualizer/soundscape-region-tag.html',\n    link: function (scope, element, $attrs) {\n      scope.$watch('tag', function (tag) {\n        resolve_tag(scope, element, tag);\n      });\n    }\n  };\n});","angular.module('visualizer-spectrogram', ['visualizer-services', 'a2.filter.round', 'a2.utils']).service('a2AffixCompute', function () {\n  return function ($viewport, $el, layout) {\n    var v;\n    var affix_c = $el.attr('data-affix-container');\n\n    if (affix_c) {\n      v = layout[affix_c];\n    }\n\n    if (!v) {\n      v = {\n        left: 0,\n        top: 0,\n        width: $viewport.width(),\n        height: $viewport.height()\n      };\n    }\n\n    var e = {\n      width: $el.width(),\n      height: $el.height()\n    };\n    var affix_left = $el.attr('data-affix-left') | 0;\n    var affix_right = $el.attr('data-affix-right');\n    var affix_align_h = $el.attr('data-affix-align-h');\n\n    if (affix_right !== undefined) {\n      affix_left = v.left + v.width - $el.width() - (affix_right | 0);\n    } else if (affix_align_h !== undefined) {\n      affix_left = v.left + (v.width - $el.width()) * affix_align_h;\n    } else {\n      affix_left += v.left;\n    }\n\n    var affix_top = $el.attr('data-affix-top') | 0;\n    var affix_bottom = $el.attr('data-affix-bottom');\n    var affix_align_v = $el.attr('data-affix-align-v');\n\n    if (affix_bottom !== undefined) {\n      affix_top = v.top + v.height - $el.height() - (affix_bottom | 0);\n    } else if (affix_align_v !== undefined) {\n      affix_top = v.top + (v.height - $el.height()) * affix_align_v;\n    } else {\n      affix_top += v.top;\n    }\n\n    $el.css({\n      position: 'absolute',\n      left: Math.round(affix_left + $viewport.scrollLeft()),\n      top: Math.round(affix_top + $viewport.scrollTop())\n    });\n  };\n}).directive('a2VisualizerSpectrogram', function (a2BrowserMetrics, a2AffixCompute) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/visualizer/visualizer-spectrogram.html',\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var layout_tmp = $scope.layout.tmp;\n      var views = {\n        viewport: $element.children('.spectrogram-container')\n      };\n\n      $scope.onPlaying = function (e) {\n        $scope.layout.y_axis.left = $element.scrollLeft();\n        $element.children('.axis-y').css({\n          left: $scope.layout.y_axis.left + 'px'\n        });\n        $scope.layout.x_axis.top = Math.min($scope.layout.spectrogram.top + $scope.layout.spectrogram.height, $element.scrollTop() + $element.height() - layout_tmp.axis_sizeh);\n        $element.children('.axis-x').css({\n          top: $scope.layout.x_axis.top + 'px'\n        });\n      };\n\n      $scope.onScrolling = function (e) {\n        var layout = $scope.layout;\n        var max_s_h = layout.spectrogram.height - layout.viewport.height;\n        var max_s_w = layout.spectrogram.width - layout.viewport.width;\n\n        if ($element.scrollTop() > max_s_h) {\n          $element.scrollTop(max_s_h);\n        }\n\n        if ($element.scrollLeft() > max_s_w) {\n          $element.scrollLeft(max_s_w);\n        }\n\n        layout.bbox = {\n          s1: ($element.scrollLeft() - layout.spectrogram.left) / layout.scale.sec2px,\n          s2: ($element.scrollLeft() - layout.spectrogram.left + $element.width()) / layout.scale.sec2px,\n          hz1: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop() - $element.height()) / layout.scale.hz2px,\n          hz2: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop()) / layout.scale.hz2px\n        };\n        layout.center = {\n          s: ($element.scrollLeft() - layout.spectrogram.left + $element.width() / 2.0) / layout.scale.sec2px,\n          hz: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop() - $element.height() / 2.0) / layout.scale.hz2px\n        };\n        layout.y_axis.left = $element.scrollLeft();\n        $element.children('.axis-y').css({\n          left: layout.y_axis.left + 'px'\n        });\n        layout.x_axis.top = $element.scrollTop() + $element.height() - layout_tmp.axis_sizeh - layout_tmp.gutter;\n        $element.children('.axis-x').css({\n          top: layout.x_axis.top - 1 + 'px'\n        });\n\n        if (layout.legend) {\n          layout.legend.left = $element.scrollLeft() + $element.width() - a2BrowserMetrics.scrollSize.width - layout_tmp.legend_width - layout_tmp.legend_gutter;\n          $element.children('.legend').css({\n            left: layout.legend.left + 'px'\n          });\n        }\n\n        $element.find('.a2-visualizer-spectrogram-affixed').each(function (i, el) {\n          a2AffixCompute($element, $(el), layout);\n        });\n      };\n\n      $scope.onMouseMove = function (e) {\n        var elOff = $element.offset();\n        var x = e.pageX - elOff.left + $element.scrollLeft() - $scope.layout.spectrogram.left;\n        var y = e.pageY - elOff.top + $element.scrollTop() - $scope.layout.spectrogram.top;\n        x = Math.min(Math.max(x, 0), $scope.layout.spectrogram.width);\n        y = Math.min(Math.max(y, 0), $scope.layout.spectrogram.height);\n        $scope.pointer.x = x;\n        $scope.pointer.y = y;\n        $scope.pointer.sec = $scope.layout.x2sec(x);\n        $scope.pointer.hz = $scope.layout.y2hz(y);\n      };\n\n      var make_axis = function (domain, scale, orientation) {\n        var axis = d3.svg.axis();\n\n        if (domain.ticks) {\n          axis.ticks(domain.ticks);\n        }\n\n        if (domain.tick_format) {\n          axis.tickFormat(domain.tick_format);\n        } else if (domain.unit_format) {\n          axis.tickFormat(domain.unit_format);\n        }\n\n        axis.scale(scale).orient(orientation);\n        return axis;\n      };\n\n      $scope.layout.listeners.push(function (layout, container, $scope, width, height, fix_scroll_center) {\n        doLayout(layout, container, $scope, width, height, fix_scroll_center);\n      });\n\n      function doLayout(layout, container, $scope, width, height, fix_scroll_center) {\n        var domain = layout.l.domain || {};\n        var components = {\n          visualizer_root: container,\n          spectrogram: container.children('.spectrogram-container'),\n          y_axis: domain.y && container.children('.axis-y'),\n          x_axis: domain.x && container.children('.axis-x'),\n          legend: domain.legend && container.children('.legend')\n        };\n        Object.keys(components).forEach(function (i) {\n          var component = components[i];\n\n          if (component) {\n            var $li = component;\n            var li = layout.l[i];\n\n            if (li.css) {\n              $li.css(li.css);\n            }\n\n            if (li.attr) {\n              $li.attr(li.attr);\n            }\n          }\n        });\n\n        if (domain.x) {\n          doXAxisLayout(layout);\n        }\n\n        if (domain.y) {\n          doYAxisLayout(layout);\n        }\n\n        if (domain.legend) {\n          doLegendLayout(layout);\n        }\n\n        if (fix_scroll_center) {\n          $element.scrollTop(Math.min(layout.l.scroll_center.top, layout.l.spectrogram.css.height - layout.viewport.height));\n          $element.scrollLeft(Math.min(layout.l.scroll_center.left, layout.l.spectrogram.css.width - layout.viewport.width));\n        }\n\n        $scope.onScrolling();\n      }\n\n      function doXAxisLayout(layout) {\n        var d3_x_axis = d3.select($element.children('.axis-x').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        var scalex = layout.l.scale.x;\n        d3_x_axis.style('height', 100);\n        d3_x_axis.style('scale', 'none');\n        d3_x_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 1,\n          width: layout.l.x_axis.attr.width,\n          height: spec_h + layout_tmp.axis_lead\n        });\n        d3_x_axis.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.axis_lead + ', 1)').call(make_axis(domain.x, scalex, \"bottom\"));\n      }\n\n      function doYAxisLayout(layout) {\n        var d3_y_axis = d3.select($element.children('.axis-y').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        var scaley = layout.l.scale.y;\n        d3_y_axis.style('width', 61);\n        d3_y_axis.style('scale', 'none');\n        d3_y_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 0,\n          width: layout.l.y_axis.attr.width + 1,\n          height: spec_h + layout_tmp.axis_lead + 1\n        });\n        d3_y_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 0,\n          width: layout.l.y_axis.attr.width - layout_tmp.axis_lead,\n          height: spec_h + layout_tmp.axis_lead + layout_tmp.axis_sizeh\n        });\n        d3_y_axis.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.axis_sizew + ', ' + layout_tmp.axis_lead + ')').call(make_axis(domain.y, scaley, \"left\"));\n      }\n\n      function doLegendLayout(layout) {\n        var d3_legend = d3.select($element.children('.legend').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        d3_legend.append(\"rect\").attr({\n          class: 'bg',\n          x: layout_tmp.axis_lead,\n          y: 0,\n          width: layout.l.legend.attr.width,\n          height: layout.l.legend.attr.height\n        });\n        d3_legend.append(\"image\").attr({\n          class: 'legend-image',\n          x: layout_tmp.legend_axis_w,\n          y: layout_tmp.axis_lead,\n          width: layout_tmp.legend_width - layout_tmp.legend_axis_w,\n          height: spec_h,\n          preserveAspectRatio: 'none',\n          'xlink:href': domain.legend.src\n        });\n        d3_legend.append(\"rect\").attr({\n          class: 'border',\n          x: layout_tmp.legend_axis_w,\n          y: layout_tmp.axis_lead,\n          width: layout_tmp.legend_width - layout_tmp.legend_axis_w,\n          height: spec_h\n        });\n        d3_legend.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.legend_axis_w + ', ' + (layout_tmp.axis_lead + 1) + ')').call(make_axis(domain.legend, layout.l.scale.legend, \"left\"));\n      }\n\n      $scope.getRecordingPlaybackTime = function () {\n        return $scope.audio_player.getCurrentTime();\n      };\n\n      $scope.$watch(function () {\n        return {\n          'h': $element.height(),\n          'w': $element.width()\n        };\n      }, function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, newValue.w, newValue.h, true);\n      }, true);\n      $scope.$watch(function () {\n        return $scope.layout.scale.sec2px * $scope.getRecordingPlaybackTime() | 0;\n      }, function (newValue, oldValue) {\n        if ($scope.audio_player.is_playing) {\n          var pbh = layout_tmp.axis_sizew + newValue;\n          var sl = $element.scrollLeft(),\n              slw = sl + $element.width() / 2;\n          var dx = pbh - slw;\n\n          if (dx > 0) {\n            $element.scrollLeft(sl + dx);\n          }\n        }\n      }, true);\n      $scope.$watch('visobject', function (newValue, oldValue) {\n        $element.scrollLeft(0);\n        $element.scrollTop(999999);\n        $scope.layout.apply($element, $scope, $element.width(), $element.height());\n      }, true);\n      $element.bind('resize', function () {\n        $scope.$apply();\n      });\n      $scope.$watch('layout.scale.zoom.x', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.$watch('layout.scale.zoom.y', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.$watch('layout.scale.originalScale', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.layout.apply($element, $scope, $element.width(), $element.height());\n      $scope.onScrolling();\n    }\n  };\n}).directive('a2VisualizerSpectrogramLayer', function (layer_types, $compile, $templateFetch) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/visualizer/spectrogram-layer/default.html',\n    replace: true,\n    link: function (scope, element, attrs) {\n      //console.log(\"link     : function(scope, element, attrs){\", scope, element, attrs);\n      var layer_type = layer_types[scope.layer.type] ? scope.layer.type : false;\n      var layer_key = layer_types[layer_type] ? layer_types[layer_type].type : null;\n      element.addClass(layer_type);\n\n      if (layer_key && layer_key != 'default') {\n        var layer_url = '/app/visualizer/spectrogram-layer/' + layer_key + '.html';\n        var layer_tmp = $templateFetch(layer_url, function (layer_tmp) {\n          var layer_el = $compile(layer_tmp)(scope);\n          element.append(layer_el);\n        });\n      }\n    }\n  };\n}).directive('a2VisualizerSpectrogramAffixed', function (a2AffixCompute, $debounce) {\n  return {\n    restrict: 'A',\n    link: function ($scope, $element, $attrs) {\n      $element.addClass('a2-visualizer-spectrogram-affixed');\n      var $root = $element.closest('.visualizer-root');\n      var $eloff = $element.offset(),\n          $roff = $root.offset();\n\n      if ($roff) {\n        if ($element.attr('data-affix-left') === undefined) {\n          $element.attr('data-affix-left', $eloff.left - $roff.left);\n        }\n\n        if ($element.attr('data-affix-top') === undefined) {\n          $element.attr('data-affix-top', $eloff.top - $roff.top);\n        }\n      }\n\n      if ($attrs.a2VisualizerSpectrogramAffixed) {\n        $scope.$watch($attrs.a2VisualizerSpectrogramAffixed, function (newval, oldval) {\n          var i;\n\n          if (oldval) {\n            for (i in oldval) {\n              $element.attr('data-affix-' + i, null);\n            }\n          }\n\n          if (newval) {\n            for (i in newval) {\n              $element.attr('data-affix-' + i, newval[i]);\n            }\n          }\n        });\n        a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      }\n\n      a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      $scope.$watch(function () {\n        return $element.width() * $element.height();\n      }, $debounce(function () {\n        a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      }));\n    }\n  };\n});","angular.module('a2.speciesValidator', ['a2.utils', 'a2.infotags']).directive('a2SpeciesValidator', function (Project, a2UserPermit, notify, $filter) {\n  var project = Project;\n  return {\n    restrict: 'E',\n    scope: {\n      recording: '=recording'\n    },\n    templateUrl: '/app/visualizer/validator-main.html',\n    link: function ($scope, $element, $attrs) {\n      var class2key = function (project_class) {\n        var cls;\n\n        if (/number|string/.test(typeof project_class)) {\n          cls = $scope.classes.filter(function (pc) {\n            return pc.id == project_class;\n          }).shift();\n        } else {\n          cls = project_class;\n        }\n\n        return cls && [cls.species, cls.songtype].join('-');\n      };\n\n      var add_validation = function (validation) {\n        var key = [validation.species, validation.songtype].join('-');\n        var present = Object.values({\n          present: validation.present,\n          presentReview: validation.presentReview,\n          presentAed: validation.presentAed\n        });\n        $scope.validations[key] = present;\n      };\n\n      var load_project_classes = function () {\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n          var taxons = {};\n\n          for (var i = 0; i < classes.length; i++) {\n            var c = classes[i];\n            if (!taxons[c.taxon]) taxons[c.taxon] = [];\n            taxons[c.taxon].push(c);\n          }\n\n          for (var t in taxons) {\n            taxons[t] = $filter('orderBy')(taxons[t], ['species_name', 'songtype_name']);\n          }\n\n          $scope.byTaxon = taxons;\n          $scope.taxons = Object.keys($scope.byTaxon).sort();\n        });\n      };\n\n      $scope.$on('a2-persisted', load_project_classes);\n      $scope.classes = [];\n      $scope.is_selected = {};\n\n      $scope.select = function (taxon, project_class, $event) {\n        if ($($event.target).is('a')) {\n          return;\n        }\n\n        if ($event.shiftKey) {\n          $scope.is_selected[project_class.id] = true;\n          var sel_range = {\n            from: Infinity,\n            to: -Infinity\n          };\n          var taxonSpecies = $scope.byTaxon[taxon];\n          taxonSpecies.forEach(function (pc, idx) {\n            if ($scope.is_selected[pc.id]) {\n              sel_range.from = Math.min(sel_range.from, idx);\n              sel_range.to = Math.max(sel_range.to, idx);\n            }\n          });\n\n          for (var si = sel_range.from, se = sel_range.to + 1; si < se; ++si) {\n            $scope.is_selected[taxonSpecies[si].id] = true;\n          }\n        } else if ($event.ctrlKey) {\n          $scope.is_selected[project_class.id] = !$scope.is_selected[project_class.id];\n        } else {\n          $scope.is_selected = {};\n          $scope.is_selected[project_class.id] = true;\n        }\n      };\n\n      $scope.validations = {};\n\n      $scope.validate = function (val) {\n        if (!a2UserPermit.can('validate species')) {\n          notify.error('You do not have permission to validate species');\n          return;\n        }\n\n        var keys = [],\n            key_idx = {};\n        var k; // var k = class2key(project_class);\n        // if (k && !key_idx[k]) {\n        //     key_idx[k] = true;\n        //     keys.push(k);\n        // }\n        // sel_pc_id -> selected project class id\n\n        for (var sel_pc_id in $scope.is_selected) {\n          if ($scope.is_selected[sel_pc_id]) {\n            k = class2key(sel_pc_id);\n\n            if (k && !key_idx[k]) {\n              key_idx[k] = true;\n              keys.push(k);\n            }\n          }\n        }\n\n        if (keys.length > 0) {\n          Project.validateRecording($scope.recording.id, {\n            'class': keys.join(','),\n            val: val,\n            determinedFrom: 'visualizer'\n          }, function (validations) {\n            validations.forEach(function (validation) {\n              var key = class2key(validation);\n\n              if (validation.val == 2) {\n                delete $scope.validations[key];\n              } else {\n                $scope.validations[key] = Object.values({\n                  present: validation.val,\n                  presentReview: 0\n                });\n              }\n            });\n          });\n        }\n      };\n\n      $scope.val_options = [{\n        label: \"Clear\",\n        val: 2\n      }, {\n        label: \"Present\",\n        val: 1\n      }, {\n        label: \"Absent\",\n        val: 0\n      }];\n\n      $scope.val_state = function (project_class, val_options) {\n        if (!val_options) {\n          val_options = $scope.val_options;\n        }\n\n        var key = class2key(project_class),\n            val = $scope.validations[key];\n\n        if (typeof val === 'undefined') {\n          return;\n        } else {\n          if (val[0] == 1 || val[1] > 0 || val[2] > 0) {\n            val_options[1].showDropdown = val[1] > 0 || val[2] > 0;\n            return val_options[1];\n          }\n\n          if (val[0] == null && val[1] == 0 && val[2] == 0) {\n            return;\n          } else {\n            return val_options[2];\n          }\n        }\n      };\n\n      $scope.$watch('recording', function (recording) {\n        $scope.validations = {};\n\n        if (recording && recording.validations) {\n          recording.validations.forEach(add_validation);\n        }\n      });\n      load_project_classes();\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name visualizer-sidebar\n * @description\n * Sidebar directive for the visualizer module.\n */\nangular.module('a2.visualizer.directive.sidebar', []).directive('visualizerSidebar', function () {\n  return {\n    restrict: 'E',\n    transclude: true,\n    templateUrl: '/app/visualizer/visualizer-sidebar.html',\n    scope: {\n      closed: '=?'\n    },\n    link: function (scope, element, attrs) {\n      element.addClass(\"sidebar show\");\n      checkClosed();\n\n      scope.toggleSidebar = function () {\n        scope.closed = !scope.closed;\n        checkClosed();\n      };\n\n      function checkClosed() {// element[scope.closed ? 'addClass' : 'removeClass'](\"collapsed\");\n      }\n    }\n  };\n});","// $(document)\n//   .on('click.bs.dropdown.data-api', '.dropdown .dropdown-form', function (e) { e.stopPropagation(); });\n\n/**\n * @ngdoc overview\n * @name visualizer\n * @description\n * This is the main visualizer module.\n */\nangular.module('a2.visualizer', ['ui.router', 'ct.ui.router.extras', 'a2.services', 'a2.utils', 'a2.visobjects', 'a2.visualizer.dialog', 'a2.visobjectsbrowser', 'a2.speciesValidator', 'visualizer-layers', 'a2.visualizer.directive.sidebar', 'a2.visualizer.layers.base-image-layer', 'a2.visualizer.layers.annotation-layer', 'a2.visualizer.layers.zoom-input-layer', 'a2.visualizer.layers.data-plot-layer', 'a2.visualizer.layers.recordings', 'a2.visualizer.layers.recording-soundscape-region-tags', 'a2.visualizer.layers.recording-tags', 'a2.visualizer.layers.species-presence', 'a2.visualizer.layers.soundscapes', 'a2.visualizer.layers.soundscape-composition-tool', 'a2.visualizer.layers.training-sets', 'a2.visualizer.layers.templates', 'a2.visualizer.layers.audio-events-layer', 'visualizer-spectrogram', 'visualizer-services', 'a2.visualizer.audio-player', 'a2-visualizer-spectrogram-Layout', 'a2-visualizer-spectrogram-click2zoom', 'a2.url-update-service', 'ui.bootstrap'])\n/**\n * @ngdoc service\n * @name a2-visualizer-spectrogram-Layout.factory:VisualizerLayout\n * @description\n * The layout manager for the spectrogram.\n */\n.config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('visualizer', {\n    url: '/visualizer',\n    views: {\n      'visualizer': {\n        controller: 'VisualizerCtrl',\n        templateUrl: '/app/visualizer/main.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  }).state('visualizer.view', {\n    url: '/:type/:idA/:idB/:idC?gain&filter&a&clusters',\n    params: {\n      type: '',\n      a: null,\n      clusters: null,\n      gain: null,\n      filter: null,\n      idA: {\n        value: '',\n        squash: true\n      },\n      idB: {\n        value: null,\n        squash: true\n      },\n      idC: {\n        value: null,\n        squash: true\n      }\n    },\n    controller: function ($state, $scope) {\n      var p = $state.params;\n      var lc = [p.type];\n\n      if (p.idA) {\n        lc.push(p.idA);\n\n        if (p.idB) {\n          lc.push(p.idB);\n\n          if (p.idC) {\n            lc.push(p.idC);\n          }\n        }\n      }\n\n      var l = lc.join('/');\n      $scope.location.whenBrowserIsAvailable(function () {\n        $scope.$parent.$broadcast('set-browser-location', l, p.a); // Catch the navigation URL query\n\n        if (p.type === 'rec') {\n          $scope.$parent.$broadcast('set-browser-annotations', p.idA ? Number(p.idA) : null, p.a ? p.a : null);\n        }\n      });\n\n      if ($scope.parseAnnotations) {\n        $scope.parseAnnotations(p.a);\n      }\n    }\n  });\n}).directive('a2Visualizer', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {},\n    controller: 'VisualizerCtrl',\n    templateUrl: '/app/visualizer/main.html'\n  };\n}).service('a2VisualizerLocationManager', function ($location) {\n  var locman = function (scope, prefix, state) {\n    this.scope = scope;\n    this.state = state;\n    this.prefix = prefix;\n    this.current = '';\n    this.__expected = '';\n  };\n\n  locman.prototype = {\n    sync: function () {\n      if (this.current == this.__expected) {\n        return;\n      }\n\n      this.__expected = this.current;\n      this.scope.$broadcast('set-browser-location', this.current);\n    },\n    update_path: function () {\n      this.set(this.current);\n    },\n    updateParams: function (params) {\n      var all_params = angular.extend({}, this.state.params);\n\n      for (var pk in params) {\n        var pv = params[pk];\n\n        if (pv === undefined) {\n          delete all_params[pk];\n        } else {\n          all_params[pk] = pv;\n        }\n      }\n\n      console.log(all_params, this.state.current.name);\n      this.state.transitionTo(this.state.current.name, all_params, {\n        notify: false\n      });\n    },\n    set: function (location, dont_sync) {\n      if (dont_sync) {\n        this.__expected = location;\n      }\n\n      if ($location.path() != this.prefix + location) {\n        console.log('a2VisualizerLocationManager::set_location', this.prefix + location, dont_sync);\n        var search = $location.search();\n        delete search.a;\n        $location.path(this.prefix + location);\n        $location.search(search);\n      }\n    },\n    path_changed: function (path) {\n      if (path === undefined) {\n        path = $location.path();\n      }\n\n      path = '' + path;\n\n      if (path.indexOf(this.prefix) === 0) {\n        this.current = path.substr(this.prefix.length);\n      }\n    },\n    whenBrowserIsAvailable: function (callback) {\n      if (this.browserAvailable) {\n        callback();\n      } else {\n        (this.__onBrowserAvailable__ || (this.__onBrowserAvailable__ = [])).push(callback);\n      }\n    },\n    notifyBrowserAvailable: function () {\n      this.browserAvailable = true;\n\n      if (this.__onBrowserAvailable__) {\n        this.__onBrowserAvailable__.forEach(function (callback) {\n          callback();\n        });\n\n        delete this.__onBrowserAvailable__;\n      }\n    }\n  };\n  return locman;\n}).controller('VisualizerCtrl', function (a2VisualizerLayers, $q, $location, $state, $scope, $localStorage, $timeout, itemSelection, Project, $controller, a2UserPermit, a2SpectrogramClick2Zoom, $rootScope, VisualizerObjectTypes, VisualizerLayout, a2AudioPlayer, a2VisualizerLocationManager, a2EventEmitter) {\n  var events = new a2EventEmitter();\n  this.on = events.on.bind(events);\n  this.off = events.off.bind(events);\n  var layers = new a2VisualizerLayers($scope, this);\n  var layer_types = layers.types;\n  var initial_state_params = {\n    gain: $state.params.gain,\n    filter: $state.params.filter\n  };\n\n  $scope.parseAnnotations = function (annotationsString) {\n    $scope.annotations = annotationsString ? (Array.isArray(annotationsString) ? annotationsString : annotationsString.split('|')).map(function (item) {\n      var comps = item.split(',');\n      var parsed = {\n        type: comps.shift(),\n        value: []\n      };\n      comps.forEach(function (comp) {\n        var pair = comp.split(':');\n\n        if (pair.length > 1) {\n          var key = pair.shift();\n          parsed[key] = pair[1].join(':');\n        } else {\n          parsed.value.push(comp);\n        }\n      });\n      return parsed;\n    }) : [];\n  }; // check selected clusters in query\n\n\n  if ($state.params.clusters) {\n    $localStorage.setItem('analysis.clusters.playlist', $state.params.idA);\n  }\n\n  $scope.parseAnnotations($state.params.a);\n  $scope.layers = layers.list; // current layers in the visualizer\n\n  $scope.addLayer = layers.add.bind(layers);\n  $scope.fullfillsRequirements = layers.check_requirements.bind(layers);\n  $scope.isSidebarVisible = layers.sidebar_visible.bind(layers);\n  $scope.isSpectrogramVisible = layers.spectrogram_visible.bind(layers);\n  $scope.canDisplayInSidebar = layers.display_sidebar.bind(layers);\n  $scope.canDisplayInSpectrogram = layers.display_spectrogram.bind(layers);\n\n  if (a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper()) {\n    layers.add('base-image-layer', 'recording-layer', 'templates', 'zoom-input-layer');\n  } else {\n    layers.add('base-image-layer', 'annotation-layer', 'data-plot-layer', 'recording-layer', 'recording-tags-layer', 'soundscape-info-layer', 'soundscape-regions-layer', 'recording-soundscape-region-tags', 'species-presence', 'training-data', 'templates', 'soundscape-composition-tool', 'zoom-input-layer', 'audio-events-layer');\n  }\n\n  $scope.visobject = null;\n  var location = new a2VisualizerLocationManager($scope, '/visualizer' + '/', $state);\n  $scope.location = location;\n  $scope.annotation = {};\n  $scope.set_location = location.set.bind(location);\n  $scope.layout = new VisualizerLayout();\n  $scope.click2zoom = new a2SpectrogramClick2Zoom($scope.layout);\n  $scope.Math = Math;\n  $scope.pointer = {\n    x: 0,\n    y: 0,\n    sec: 0,\n    hz: 0\n  };\n  $scope.selection = itemSelection.make('layer');\n\n  $scope.getLayers = function () {\n    return $scope.layers;\n  };\n\n  $scope.setVisObject = function (visobject, type, location) {\n    if ($scope.isUploading) return;\n    $scope.isUploading = true;\n    return $q.resolve().then(function () {\n      if (visobject) {\n        $scope.visobject_location = location;\n        $scope.location.set(location, true);\n        var visobject_loader = VisualizerObjectTypes.getLoader(type);\n        $scope.loading_visobject = visobject_loader.getCaptionFor(visobject);\n        return visobject_loader.load(visobject, $scope).then(function (visobject) {\n          console.log('VisObject loaded : ', visobject);\n          $scope.$parent.$broadcast('clear-recording-data', true); // check clusters playlist in local storage else clear local storage\n\n          if ($localStorage.getItem('analysis.clusters.playlist') === $state.params.idA) {\n            var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n            console.log('clustersData', this.clustersData);\n\n            if (clustersData && clustersData.boxes && $state.params.idB) {\n              this.parseAnnotations(clustersData.boxes[$state.params.idB]);\n            }\n          } else {\n            $scope.removeFromLocalStorage();\n            this.parseAnnotations($location.search().a);\n          }\n\n          $scope.loading_visobject = false;\n          $scope.visobject = visobject;\n          $scope.visobject_type = visobject.type;\n          $scope.setYScaleOptions();\n        }.bind(this));\n      } else {\n        $scope.visobject = null;\n      }\n    }.bind(this)).then(function () {\n      events.emit('visobject', $scope.visobject);\n      $scope.isUploading = false;\n    });\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  }; // Resize Y scale.\n\n\n  $scope.getSelectedFrequencyCache = function () {\n    try {\n      return JSON.parse($localStorage.getItem('visuilizer.frequencies.cache')) || {\n        originalScale: true\n      };\n    } catch (e) {\n      return {\n        originalScale: true\n      };\n    }\n  };\n\n  $scope.deselectFrequencyOptions = function () {\n    $scope.yAxisOptions.forEach(function (item) {\n      return item.active = false;\n    });\n  };\n\n  $scope.setYScaleOptions = function () {\n    // Get selected frequency.\n    $scope.scaleCache = $scope.getSelectedFrequencyCache(); // Get recording frequency.\n\n    $scope.convertedScale = $scope.visobject && $scope.visobject.max_freq ? +$scope.visobject.max_freq / 1000 : 'X'; // Set frequency options with default y-scale value.\n\n    $scope.yAxisOptions = [{\n      title: '24 kHz scale',\n      value: '24_scale',\n      active: false\n    }, {\n      title: 'Original scale (' + $scope.convertedScale + ' kHz)',\n      value: 'original_scale',\n      active: true\n    }]; // Set frequency options with saved frequency.\n\n    if ($scope.scaleCache && !$scope.scaleCache.originalScale && $scope.convertedScale < 24) {\n      $scope.deselectFrequencyOptions();\n      $scope.yAxisOptions[0].active = true;\n    } // Display original frequency for recording whith 24kHz or more.\n\n\n    if ($scope.convertedScale >= 24) {\n      $scope.deselectFrequencyOptions();\n      $scope.yAxisOptions[1].active = true;\n    }\n  };\n\n  $scope.resizeYScale = function (item) {\n    $scope.deselectFrequencyOptions();\n    item.active = true;\n    var originalScale = item.value === 'original_scale';\n    $localStorage.setItem('visuilizer.frequencies.cache', JSON.stringify({\n      originalScale: originalScale\n    }));\n    $scope.layout.scale.originalScale = originalScale;\n    var span = originalScale ? $scope.visobject.sampling_rate / 2 : 24000;\n    $scope.visobject.domain.y.to = span;\n    $scope.visobject.domain.y.span = span;\n  };\n\n  $scope.audio_player = new a2AudioPlayer($scope, initial_state_params);\n  $scope.$on('browser-vobject-type', function (evt, type) {\n    $scope.visobject_type = type;\n  });\n  $scope.$on('browser-available', function () {\n    $scope.location.notifyBrowserAvailable();\n  });\n  $rootScope.$on('notify-visobj-updated', function () {\n    var args = Array.prototype.slice.call(arguments, 1);\n    args.unshift('visobj-updated');\n    $scope.$broadcast.apply($scope, args);\n  });\n  $scope.$on('visobj-updated', function (visobject) {\n    $scope.setVisObject($scope.visobject, $scope.visobject_type, $scope.visobject_location);\n  });\n}).filter('filterPresentCount', function () {\n  return function (validations) {\n    if (!validations) return 0;\n    var count = 0;\n    validations.forEach(function (validation) {\n      if (validation.presentReview > 0 || validation.presentAed > 0 || validation.present == 1) {\n        count++;\n      }\n    });\n    return count;\n  };\n}).filter('filterAbsentCount', function () {\n  return function (validations) {\n    if (!validations) return 0;\n    var count = 0;\n    validations.forEach(function (validation) {\n      if (validation.presentReview == 0 && validation.presentAed == 0 && validation.present == 0) {\n        count++;\n      }\n    });\n    return count;\n  };\n});\n/**\n * @ngdoc overview\n * @name a2-visualizer-spectrogram-Layout\n * @description\n * This module stores the layout manager for the spectrogram.\n */\n\nangular.module('a2-visualizer-spectrogram-Layout', ['a2.classy', 'a2-plot-specs']).factory('VisualizerLayoutSpecs', function (PlotSpecs) {\n  return PlotSpecs;\n})\n/**\n * @ngdoc service\n * @name a2-visualizer-spectrogram-Layout.factory:VisualizerLayout\n * @description\n * The layout manager for the spectrogram.\n */\n.factory('VisualizerLayout', function (a2BrowserMetrics, makeClass, VisualizerLayoutSpecs, $localStorage) {\n  var align_to_interval = function (unit, domain, align) {\n    if (align === undefined || !domain || !domain.unit_interval) {\n      return unit;\n    } else {\n      var f = domain.from || 0,\n          u = domain.unit_interval;\n      unit = Math.floor((unit - f) / u) * u + f;\n      return unit + align * u;\n    }\n  };\n\n  var get_domain = function (visobject) {\n    return visobject && visobject.domain || {\n      x: {\n        from: 0,\n        to: 60,\n        span: 60,\n        ticks: 60,\n        unit: 'Time ( s )'\n      },\n      y: {\n        from: 0,\n        to: 22050,\n        span: 22050,\n        unit: 'Frequency ( kHz )',\n        tick_format: function (v) {\n          return v / 1000 | 0;\n        }\n      }\n    };\n  };\n\n  var make_scale = function (domain, range) {\n    var s;\n\n    if (domain.ordinal) {\n      var dd = domain.to - domain.from;\n      var dr = range[1] - range[0];\n      var scale = dr / dd;\n      s = d3.scale.linear().domain([domain.from, domain.to]).range([scale / 2 + range[0], range[1] - scale / 2]);\n    } else {\n      s = d3.scale.linear().domain([domain.from, domain.to]).range(range);\n    }\n\n    return s;\n  };\n\n  var linear_interpolate = function (x, levels) {\n    var l = x * (levels.length - 1);\n    var f = Math.floor(l),\n        c = Math.ceil(l),\n        m = l - f;\n    return levels[f] * (1 - m) + levels[c] * m;\n  };\n\n  var interpolate = linear_interpolate;\n  return makeClass({\n    constructor: function () {\n      this.scale = {\n        def_sec2px: 100 / 1.0,\n        def_hz2px: 100 / 5000.0,\n        max_sec2px: 100 / (1.0 / 8),\n        max_hz2px: 100 / (5000.0 / 8),\n        zoom: {\n          x: 0,\n          y: 0\n        },\n        sec2px: 100 / 1.0,\n        hz2px: 100 / 5000.0,\n        originalScale: null\n      };\n      this.offset = {\n        sec: 0,\n        hz: 0\n      };\n      this.tmp = VisualizerLayoutSpecs;\n      this.domain = {};\n      this.listeners = [];\n    },\n    x2sec: function (x, interval_align) {\n      var seconds = x / this.scale.sec2px;\n      seconds += this.offset.sec;\n      return align_to_interval(+seconds, this.domain.x, interval_align);\n    },\n    y2hz: function (y, interval_align) {\n      var h = (this.spectrogram && this.spectrogram.height) | 0;\n      var hertz = (h - y) / this.scale.hz2px;\n      hertz += this.offset.hz;\n      return align_to_interval(+hertz, this.domain.y, interval_align);\n    },\n    sec2x: function (seconds, round, interval_align) {\n      seconds = align_to_interval(seconds - this.offset.sec, this.domain.x, interval_align);\n      var x = seconds * this.scale.sec2px;\n      return round ? x | 0 : +x;\n    },\n    hz2y: function (hertz, round, interval_align) {\n      hertz = align_to_interval(hertz - this.offset.hz, this.domain.y, interval_align);\n      var h = (this.spectrogram && this.spectrogram.height) | 0;\n      var y = h - hertz * this.scale.hz2px;\n      return round ? y | 0 : +y;\n    },\n    dsec2width: function (seconds1, seconds2, round, inclusive) {\n      if (inclusive) {\n        seconds1 = align_to_interval(seconds1, this.domain.x, 1);\n      }\n\n      var w = (seconds1 - seconds2) * this.scale.sec2px;\n      return round ? w | 0 : +w;\n    },\n    dhz2height: function (hz1, hz2, round, inclusive) {\n      if (inclusive) {\n        hz1 = align_to_interval(hz1, this.domain.y, 1);\n      }\n\n      var h = (hz1 - hz2) * this.scale.hz2px;\n      return round ? h | 0 : +h;\n    },\n    apply: function (container, $scope, width, height, fix_scroll_center) {\n      var layout = $scope.visobject && $scope.visobject.layout;\n      this.type = layout || 'spectrogram';\n      this['apply_' + this.type](container, $scope, width, height, fix_scroll_center);\n\n      for (var eh = this.listeners, ehi = 0, ehe = eh.length; ehi < ehe; ++ehi) {\n        eh[ehi](this, container, $scope, width, height, fix_scroll_center);\n      }\n    },\n    apply_spectrogram: function (container, $scope, width, height, fix_scroll_center) {\n      var layout_tmp = this.tmp;\n      var visobject = $scope.visobject;\n      var domain = this.domain = get_domain(visobject);\n      var avail_w = width - layout_tmp.axis_sizew - layout_tmp.axis_lead;\n\n      if (domain.legend) {\n        avail_w -= layout_tmp.legend_width + layout_tmp.legend_gutter;\n      }\n\n      var avail_h = height - layout_tmp.axis_sizeh - layout_tmp.axis_lead - layout_tmp.gutter;\n      var cheight = container[0].clientHeight;\n      var zoom_levels_x = this.scale.zoom.levelx = [avail_w / domain.x.span, this.scale.max_sec2px];\n      var zoom_levels_y = this.scale.zoom.levely = [avail_h / domain.y.span, this.scale.max_hz2px];\n      var zoom_sec2px = interpolate(this.scale.zoom.x, zoom_levels_x);\n      var zoom_hz2px = interpolate(this.scale.zoom.y, zoom_levels_y);\n      var spec_w = Math.max(avail_w, Math.ceil(domain.x.span * zoom_sec2px));\n      var spec_h = Math.max(avail_h, Math.ceil(domain.y.span * zoom_hz2px));\n      var scalex = make_scale(domain.x, [0, spec_w]);\n      var scaley = make_scale(domain.y, [spec_h, 0]);\n      var scalelegend;\n      var l = this.l = {\n        visualizer_root: {\n          css: {\n            'overflow': ''\n          }\n        }\n      };\n      l.spectrogram = {\n        css: {\n          top: layout_tmp.axis_lead,\n          left: layout_tmp.axis_sizew,\n          width: spec_w,\n          height: spec_h\n        }\n      };\n      l.y_axis = {\n        scale: scaley,\n        css: {\n          top: 0,\n          left: container.scrollLeft()\n        },\n        attr: {\n          width: layout_tmp.axis_sizew,\n          height: spec_h + layout_tmp.axis_lead + layout_tmp.axis_sizeh\n        }\n      };\n      l.x_axis = {\n        scale: scalex,\n        css: {\n          left: layout_tmp.axis_sizew - layout_tmp.axis_lead,\n          // left : layout_tmp.axis_sizew -  layout_tmp.axis_lead,\n          top: container.scrollTop() + height - layout_tmp.axis_sizeh - layout_tmp.gutter\n        },\n        attr: {\n          height: layout_tmp.axis_sizeh,\n          width: spec_w + 2 * layout_tmp.axis_lead\n        }\n      };\n      this.has_legend = $scope.has_legend = !!domain.legend;\n\n      if (domain.legend) {\n        l.legend = {\n          scale: scalelegend,\n          css: {\n            top: 0,\n            left: container.scrollLeft() + width - a2BrowserMetrics.scrollSize.width - layout_tmp.legend_width - layout_tmp.legend_gutter\n          },\n          attr: {\n            width: layout_tmp.legend_width,\n            height: spec_h + 2 * layout_tmp.axis_lead\n          }\n        };\n        scalelegend = d3.scale.linear().domain([domain.legend.from, domain.legend.to]).range([spec_h - 2, 0]);\n      } else {\n        l.legend = {};\n      } //l.x_axis.attr.height = cheight - l.x_axis.css.top - 1;\n\n\n      ['spectrogram', 'y_axis', 'x_axis', 'legend'].forEach(function (i) {\n        var li = l[i];\n        this[i] = li.css;\n\n        if (li.attr) {\n          $.extend(this[i], li.attr);\n        }\n\n        if (li.scale) {\n          this[i].scale = li.scale;\n        }\n      }.bind(this));\n      this.offset.sec = domain.x.from;\n      this.offset.hz = domain.y.from;\n      this.scale.sec2px = spec_w / domain.x.span;\n      this.scale.hz2px = spec_h / domain.y.span;\n      this.viewport = {\n        left: l.spectrogram.css.left,\n        top: l.spectrogram.css.top,\n        width: avail_w,\n        height: avail_h\n      };\n      var sh = l.spectrogram.css.height;\n      var sw = l.spectrogram.css.width;\n      this.root = {\n        left: 0,\n        top: 0,\n        //width  : width,\n        //height : height,\n        width: width - (avail_h < sh ? a2BrowserMetrics.scrollSize.width : 0),\n        height: height - (avail_w < sw ? a2BrowserMetrics.scrollSize.height : 0)\n      };\n      var scroll_center;\n\n      if (this.center) {\n        scroll_center = {\n          left: this.scale.sec2px * this.center.s + l.spectrogram.css.left - width / 2.0,\n          top: -this.scale.hz2px * this.center.hz - height / 2.0 + l.spectrogram.css.top + l.spectrogram.css.height\n        };\n      }\n\n      l.domain = domain;\n      l.scroll_center = scroll_center;\n      l.scale = {\n        x: scalex,\n        y: scaley,\n        legend: scalelegend\n      };\n    },\n    apply_plotted: function (container, $scope, width, height, fix_scroll_center) {\n      var layout_tmp = this.tmp;\n      var visobject = $scope.visobject;\n      var avail_w = width;\n      var avail_h = height;\n      var cheight = container[0].clientHeight;\n      this.has_legend = $scope.has_legend = false;\n      var l = this.l = {\n        visualizer_root: {\n          css: {\n            'overflow': 'hidden'\n          }\n        }\n      };\n      l.spectrogram = {\n        css: {\n          top: 0,\n          left: 0,\n          width: avail_w,\n          height: avail_h\n        }\n      };\n      l.scroll_center = {\n        left: 0,\n        top: 0\n      };\n      this.spectrogram = l.spectrogram.css;\n      this.viewport = angular.extend(l.spectrogram.css);\n      this.root = {\n        left: 0,\n        top: 0,\n        width: width,\n        height: height\n      };\n    }\n  });\n});","angular.module('a2-visualizer-spectrogram-click2zoom', ['a2.classy']).service('a2SpectrogramClick2Zoom', function (makeClass, a22PointBBoxEditor) {\n  return makeClass({\n    super: a22PointBBoxEditor.prototype,\n    toggle_active: function () {\n      this.active = !this.active;\n\n      if (this.active) {\n        this.reset();\n      }\n    },\n    constructor: function (layout) {\n      this.super.constructor.call(this);\n      this.layout = layout;\n      this.active = false;\n    },\n    add_point: function (x, y, zoom) {\n      this.super.add_point.call(this, x, y);\n\n      if (zoom) {\n        this.zoom();\n      }\n    },\n    zoom_out: function () {\n      var layout = this.layout;\n      this.active = false;\n      layout.scale.zoom.x = Math.max(0, layout.scale.zoom.x - 0.1);\n      layout.scale.zoom.y = Math.max(0, layout.scale.zoom.y - 0.1);\n    },\n    zoom_reset: function () {\n      var layout = this.layout;\n      this.active = false;\n      layout.scale.zoom.x = 0;\n      layout.scale.zoom.y = 0;\n    },\n    zoom: function () {\n      var layout = this.layout;\n      var bbox = this.bbox;\n      var dx = bbox.x2 - bbox.x1,\n          dy = bbox.y2 - bbox.y1;\n      var cp = [(bbox.x2 + bbox.x1) / 2, (bbox.y2 + bbox.y1) / 2];\n      var avail_h = layout.viewport.height;\n      var avail_w = layout.viewport.width;\n      var lzoom = layout.scale.zoom;\n      var zoom_x = avail_w / dx,\n          zoom_y = avail_h / dy;\n      var zoom_level_x = Math.max(0, Math.min((zoom_x - lzoom.levelx[0]) / (lzoom.levelx[1] - lzoom.levelx[0]), 1));\n      var zoom_level_y = Math.max(0, Math.min((zoom_y - lzoom.levely[0]) / (lzoom.levely[1] - lzoom.levely[0]), 1));\n      this.active = false;\n      layout.center = {\n        s: cp[0],\n        hz: cp[1]\n      };\n      layout.scale.zoom.x = zoom_level_x;\n      layout.scale.zoom.y = zoom_level_y;\n      console.log(\"zoom :: \", [dx, dy], cp, [zoom_level_x, zoom_level_y]);\n    }\n  });\n}).directive('a2ZoomControl', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'level': '='\n    },\n    templateUrl: '/directives/zoom-ctrl.html',\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var delta = +$attrs.delta || 0.1;\n      var horizontal = !!($attrs.horizontal | 0 || /on|yes|true/.test($attrs.horizontal + ''));\n      $scope.horizontal = horizontal;\n      $scope.switched = horizontal;\n\n      $scope.step = function (step) {\n        $scope.level = Math.min(1, Math.max($scope.level + step * delta, 0));\n      };\n\n      $scope.set_by_mouse = function ($event) {\n        var track = $element.find('.zoom-track'),\n            trackpos = track.offset();\n        var px = (track.width() - ($event.pageX - trackpos.left)) / track.width();\n        var py = (track.height() - ($event.pageY - trackpos.top)) / track.height(); // console.log('$scope.set_by_mouse', [px,py]);\n\n        var level = $scope.horizontal ? px : py;\n        $scope.level = $scope.switched ? 1 - level : level;\n      };\n    }\n  };\n});","angular.module('a2.analysis.audio-event-detection', ['a2.filter.as-csv', 'a2.filter.time-from-now', 'a2.srv.resolve', 'a2.srv.open-modal', 'a2.service.audio-event-detection', 'a2.analysis.audio-event-detection.new-modal']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.audio-event-detection', {\n    url: '/audio-event-detection',\n    controller: 'AudioEventDetectionAnalysisStateCtrl as controller',\n    templateUrl: '/app/analysis/audio-event-detection/index.html'\n  });\n}).controller('AudioEventDetectionAnalysisStateCtrl', function ($q, $promisedResolve, $openModal, a2UserPermit) {\n  this.initialize = function () {\n    return this.reload();\n  };\n\n  this.reload = function () {\n    this.loading = true;\n    return $promisedResolve({\n      audioEventDetectionsList: [\"AudioEventDetectionService\", function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getList();\n      }]\n    }, this).then(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.new = function () {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to create audio event detections.');\n      return;\n    }\n\n    return $openModal('audio-event-detection.new-modal', {\n      resolve: {\n        onSubmit: [\"AudioEventDetectionService\", function (AudioEventDetectionService) {\n          return AudioEventDetectionService.new;\n        }]\n      }\n    });\n  };\n\n  this.initialize();\n});","angular.module('a2.analysis.audio-event-detection.new-modal', ['a2.srv.open-modal', 'a2.srv.resolve', 'a2.srv.playlists', 'humane', 'a2.directive.require-non-empty', 'a2.service.audio-event-detection']).config(function ($openModalProvider) {\n  $openModalProvider.define('audio-event-detection.new-modal', {\n    templateUrl: '/app/analysis/audio-event-detection/new-modal.html',\n    controllerAs: 'controller',\n    controller: 'NewAudioEventDetectionModalCtrl',\n    resolve: {\n      onSubmit: function () {\n        return null;\n      }\n    }\n  });\n}).constant('AudioEventDetectionParametersEditTemplateUrls', {\n  fltr: '/app/analysis/audio-event-detection/algorithm-fltr-edit-parameters.html'\n}).controller('NewAudioEventDetectionModalCtrl', function ($q, $modalInstance, $promisedResolve, $parse, notify, AudioEventDetectionParametersEditTemplateUrls, onSubmit) {\n  this.playlists = [];\n  this.algorithmsList = [];\n  this.statisticsList = [];\n  var getDefaultName = $parse(\"[\" + \"(playlist.name || '[Playlist]'), \" + \"(algorithm.name || '[Algorithm]'), \" + \"(parameters ? '(' + (parameters  | asCSV) + ')' : ''), \" + \"(date | moment:'ll')\" + \"] | asCSV:' / '\");\n\n  this.initialize = function () {\n    return this.reload().then(function () {\n      this.aed = {\n        algorithm: this.algorithmsList[0],\n        statistics: this.statisticsList.slice(),\n        playlist: null,\n        date: new Date()\n      };\n      this.notifyAedAlgorithmChanged();\n    }.bind(this));\n  };\n\n  this.reload = function () {\n    this.loading = true;\n    return $promisedResolve({\n      playlists: [\"a2Playlists\", function (a2Playlists) {\n        return a2Playlists.getList();\n      }],\n      algorithmsList: function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getAlgorithmsList();\n      },\n      statisticsList: function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getStatisticsList();\n      }\n    }, this).then(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.notifyAedAlgorithmChanged = function () {\n    var algorithm = this.aed.algorithm || {};\n    this.aed.parameters = algorithm.defaults || {};\n    this.algorithmParametersTemplate = AudioEventDetectionParametersEditTemplateUrls[algorithm.name];\n    this.recomputeDefaultName();\n  };\n\n  this.recomputeDefaultName = function () {\n    this.aed.defaultName = getDefaultName(this.aed);\n  };\n\n  this.ok = function () {\n    return $q.resolve().then(function () {\n      return onSubmit && onSubmit(this.aed);\n    }.bind(this)).then(function () {\n      return $modalInstance.close(this.aed);\n    }.bind(this)).catch(function (error) {\n      notify.error(error);\n    });\n  };\n\n  this.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n\n  this.initialize();\n});","angular.module('a2.analysis.audio-event-detections-clustering', ['ui.bootstrap', 'a2.srv.audio-event-detections-clustering', 'a2.services', 'a2.permissions', 'humane', 'a2.directive.error-message']).config(function ($stateProvider) {\n  $stateProvider.state('analysis.audio-event-detections-clustering', {\n    url: '/audio-event-detections-clustering',\n    controller: 'AudioEventDetectionsClusteringModelCtrl',\n    templateUrl: '/app/analysis/audio-event-detections-clustering/list.html'\n  });\n}).controller('AudioEventDetectionsClusteringModelCtrl', function ($scope, $modal, $location, JobsData, notify, a2AudioEventDetectionsClustering, Project, $localStorage, $window, a2UserPermit) {\n  $scope.loadAudioEventDetections = function () {\n    $scope.loading = true;\n    $scope.showRefreshBtn = false;\n    $scope.projectUrl = Project.getUrl();\n    return a2AudioEventDetectionsClustering.list({\n      user: true,\n      dataExtended: true,\n      completed: true,\n      aedCount: true\n    }).then(function (data) {\n      $scope.audioEventDetectionsOriginal = data;\n      $scope.audioEventDetectionsData = data;\n      $scope.loading = false;\n\n      if (data && data.length) {\n        $scope.showRefreshBtn = true;\n      }\n    });\n  };\n\n  $scope.loadAudioEventDetections();\n\n  $scope.onSelectedJob = function (playlist_id, job_id, first_playlist_recording) {\n    $localStorage.setItem('analysis.audioEventJob', job_id);\n    $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/' + playlist_id + '/' + first_playlist_recording;\n  };\n\n  $scope.createNewClusteringModel = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to create <br> Audio Event Detection job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/audio-event-detections-clustering/new-audio-event-detection-clustering.html',\n      controller: 'CreateNewAudioEventDetectionClusteringCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.create) {\n        JobsData.updateJobs();\n        $scope.showRefreshBtn = true;\n        notify.log(\"Your new Audio Event Detection Clustering model is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteAedJob = function (aedJob, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to delete <br> Audio Event Detection job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/audio-event-detections-clustering/delete-audio-event-detection-clustering-job.html',\n      controller: 'DeleteAedJobCtrl as controller',\n      resolve: {\n        aedJob: function () {\n          return aedJob;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error('Error: ' + ret.err);\n      } else {\n        const modArr = angular.copy($scope.audioEventDetectionsOriginal);\n        const indx = modArr.findIndex(function (item) {\n          return item.job_id === aedJob.job_id;\n        });\n\n        if (indx > -1) {\n          $scope.audioEventDetectionsOriginal.splice(indx, 1);\n          notify.log('Audio Event Detection Job deleted successfully');\n        }\n      }\n    });\n  };\n}).controller('DeleteAedJobCtrl', function ($scope, $modalInstance, a2AudioEventDetectionsClustering, aedJob) {\n  this.aedJob = aedJob;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2AudioEventDetectionsClustering.delete(aedJob.job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewAudioEventDetectionClusteringCtrl', function ($modalInstance, a2AudioEventDetectionsClustering, a2Playlists, a2UserPermit, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false\n      };\n      this.details = {\n        show: false\n      };\n      var list = this.list = {};\n      this.data = {\n        name: null,\n        playlist: null,\n        params: {\n          areaThreshold: 1,\n          amplitudeThreshold: 1,\n          durationThreshold: 0.2,\n          bandwidthThreshold: 0.5,\n          filterSize: 10,\n          minFrequency: 0,\n          maxFrequency: 24\n        }\n      };\n      this.isRfcxUser = a2UserPermit.isRfcx();\n      this.isSuper = a2UserPermit.isSuper();\n      this.errorJobLimit = false;\n      this.loading.playlists = true;\n      a2Playlists.getList({\n        filterPlaylistLimit: true\n      }).then(function (playlists) {\n        this.loading.playlists = false;\n        list.playlists = playlists;\n      }.bind(this));\n    },\n    isRfcx: function () {\n      return this.isRfcxUser || this.isSuper;\n    },\n    checkLimit: function (count) {\n      return count > 10000 && !this.isRfcx();\n    },\n    toggleDetails: function () {\n      this.details.show = !this.details.show;\n    },\n    newJob: function () {\n      try {\n        return a2AudioEventDetectionsClustering.create({\n          playlist_id: this.data.playlist.id,\n          name: this.data.name,\n          params: this.data.params\n        }).then(function (clusteringModel) {\n          $modalInstance.close({\n            create: true,\n            clusteringModel: clusteringModel\n          });\n        }).catch(notify.serverError);\n      } catch (error) {\n        console.error('a2AudioEventDetectionsClustering.create error: ' + error);\n      }\n    },\n    create: function () {\n      var _this = this;\n\n      this.errorJobLimit = false;\n      if (this.isRfcx()) return this.newJob();\n      return a2AudioEventDetectionsClustering.count().then(function (data) {\n        if (_this.checkLimit(data.totalRecordings)) {\n          _this.errorJobLimit = true;\n          return;\n        } else _this.newJob();\n      });\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isJobValid: function () {\n      return this.data && this.data.name && this.data.name.length > 3 && this.data.playlist && !this.isNotDefined(this.data.params.maxFrequency) && !this.isNotDefined(this.data.params.minFrequency);\n    },\n    showNameWarning: function () {\n      return this.data && this.data.name && this.data.name.length > 1 && this.data.name.length < 4;\n    },\n    showPlaylistLimitWarning: function () {\n      if (!this.data && !this.data.playlist) return;\n      return this.data && this.data.playlist && this.data.playlist.count > 2000 && !this.isRfcx();\n    },\n    showFrequencyWarning: function () {\n      return this.data.params.maxFrequency <= this.data.params.minFrequency;\n    },\n    isNotDefined: function (item) {\n      return item === undefined || item === null;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.analysis.cnn', ['ui.bootstrap', 'a2.directive.audio-bar', 'a2.srv.cnn', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.disabled-cnn', {\n    url: '/disabled/cnn',\n    templateUrl: '/app/analysis/cnn/disabled.html'\n  }).state('analysis.cnn', {\n    url: '/cnn/',\n    controller: 'CNNCtrl',\n    templateUrl: '/app/analysis/cnn/list.html'\n  }).state('analysis.cnn-details', {\n    url: '/cnn/:cnnId',\n    ///:detailType/',\n    controller: 'CNNCtrl',\n    templateUrl: '/app/analysis/cnn/list.html'\n  });\n}).controller('CNNCtrl', function ($scope, $modal, $filter, $location, Project, ngTableParams, JobsData, a2CNN, a2Playlists, notify, $q, a2UserPermit, $state, $stateParams) {\n  // this debug line for sanity between servers... Will remove TODO\n  console.log(\"CNN Version 1.0\");\n  $scope.selectedCNNId = $stateParams.cnnId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.cnnOriginal, params.filter()) : $scope.cnnOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.cnnOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No cnn searches found.\";\n        }\n\n        $scope.cnnsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.loadCNNs = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CNN.list().then(function (data) {\n      $scope.cnnOriginal = data;\n      $scope.cnnsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"-timestamp\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No cnns found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedCNNId) {\n    $scope.loadCNNs();\n  }\n\n  $scope.createNewCNN = function () {\n    // TODO: add in real cnn permissions\n    if (!a2UserPermit.can('manage cnns')) {\n      notify.error('You do not have permission to create cnn jobs.');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/cnn/createnewcnn.html',\n      controller: 'CreateNewCNNInstanceCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new cnn is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteCNN = function (cnn, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage cnns')) {\n      notify.error('You do not have permission to delete cnns.');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/cnn/deletecnn.html',\n      controller: 'DeleteCNNInstanceCtrl as controller',\n      resolve: {\n        cnn: function () {\n          return cnn;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        notify.log(\"CNN: (\" + cnn.name + \") deleted successfully\");\n        $scope.loadCNNs();\n        /*\n        var index = -1;\n        var modArr = angular.copy($scope.cnnOriginal);\n        for (var i = 0; i < modArr.length; i++) {\n            if (modArr[i].job_id === cnn.job_id) {\n                index = i;\n                break;\n            }\n        }\n        if (index > -1) {\n            $scope.cnnOriginal.splice(index, 1);\n            notify.log(\"CNN deleted successfully\");\n        }\n        */\n      }\n    });\n  };\n\n  $scope.selectItem = function (cnnId) {\n    if (!cnnId) {\n      $state.go('analysis.cnn', {});\n    } else {\n      $state.go('analysis.cnn-details', {\n        cnnId: cnnId //detailType: 'all'\n\n      });\n    }\n  };\n\n  $scope.setDetailedView = function (detailedView) {\n    $scope.detailedView = detailedView;\n    $state.transitionTo($state.current.name, {\n      patternMatchingId: $scope.selectedPatternMatchingId,\n      show: detailedView ? \"detail\" : \"gallery\"\n    }, {\n      notify: false\n    });\n  };\n}).controller('DeleteCNNInstanceCtrl', function ($scope, $modalInstance, a2CNN, cnn, Project) {\n  this.cnn = cnn;\n  $scope.project_name = Project.getUrl();\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2CNN.delete(cnn.job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewCNNInstanceCtrl', function ($scope, $modalInstance, a2PatternMatching, a2Templates, a2Playlists, a2CNN, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false,\n        models: false\n      };\n      var list = this.list = {};\n      list.lambdas = [{\n        'name': 'call_id_testing:1 - create fake data',\n        'key': \"new_cnn_job_test1\"\n      }, {\n        'name': 'function_id_driver - test real function',\n        'key': \"new_cnn_job_v1\"\n      }];\n      this.data = {\n        name: null,\n        playlist: null,\n        model: null,\n        lambda: list.lambdas[0],\n        params: {}\n      };\n      this.loading.models = true;\n      a2CNN.listModels().then(function (models) {\n        this.loading.models = false;\n        list.models = models;\n      }.bind(this));\n      this.loading.playlists = true;\n      a2Playlists.getList().then(function (playlists) {\n        this.loading.playlists = false;\n        list.playlists = playlists;\n      }.bind(this));\n    },\n    ok: function () {\n      try {\n        return a2CNN.create({\n          playlist_id: this.data.playlist.id,\n          cnn_id: this.data.model.id,\n          name: this.data.name,\n          lambda: this.data.lambda.key,\n          params: this.data.params\n        }).then(function (cnn) {\n          $modalInstance.close({\n            ok: true,\n            cnn: cnn\n          });\n        }).catch(notify.serverError);\n      } catch (error) {\n        console.error(\"a2CNN.create error: \" + error);\n      }\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    }\n  });\n  this.initialize();\n}).directive('a2CnnDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      cnnId: '=',\n      detailedView: '=',\n      onSetDetailedView: '&',\n      onGoBack: '&'\n    },\n    controller: 'CNNDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/cnn/details.html'\n  };\n}).controller('CNNDetailsCtrl', function ($scope, $state, ngTableParams, a2AudioPlayer, $filter, a2CNN, a2UserPermit, Project, a2AudioBarService, notify) {\n  var projecturl = Project.getUrl();\n  $scope.lists = {\n    thumbnails: [{\n      class: 'fa fa-th-large',\n      value: ''\n    }, {\n      class: 'fa fa-th',\n      value: 'is-small'\n    }],\n    search: [{\n      value: 'all',\n      text: 'All',\n      description: 'Show all matched rois.'\n    }, {\n      value: 'present',\n      text: 'Present',\n      description: 'Show all rois marked as present.'\n    }, {\n      value: 'not_present',\n      text: 'Not Present',\n      description: 'Show all rois marked as not present.'\n    }, {\n      value: 'unvalidated',\n      text: 'Unvalidated',\n      description: 'Show all rois without validation.'\n    }, {\n      value: 'by_score',\n      text: 'Score per Species',\n      description: 'Show rois ranked by score per species.'\n    }, {\n      value: 'by_score_per_site',\n      text: 'Score per Site',\n      description: 'Show rois ranked by score per site.'\n    }],\n    selection: [{\n      value: 'all',\n      text: 'All'\n    }, {\n      value: 'none',\n      text: 'None'\n    }, {\n      value: 'not-validated',\n      text: 'Not Validated'\n    }],\n    validation: [{\n      class: \"fa val-1\",\n      text: \"Present\",\n      value: 1\n    }, {\n      class: \"fa val-0\",\n      text: \"Not Present\",\n      value: 0\n    }, {\n      class: \"fa val-null\",\n      text: \"Clear\",\n      value: null\n    }],\n    current: {\n      thumbnailClass: 'is-small'\n    }\n  };\n  $scope.total = {\n    rois: 0,\n    pages: 0\n  };\n  $scope.selected = {\n    roi_index: 0,\n    roi: null,\n    page: 0,\n    search: $scope.lists.search[4]\n  };\n  $scope.validation = {\n    current: $scope.lists.validation[2]\n  };\n  $scope.offset = 0;\n  $scope.limit = 100; //$scope.viewType = \"species\";\n\n  var setupExportUrl = function () {\n    $scope.CNNExportUrl = a2CNN.getExportUrl({\n      cnnId: $scope.cnnId\n    });\n  };\n\n  $scope.exportCnnReport = function ($event) {\n    $event.stopPropagation();\n    if (a2UserPermit.isSuper()) return setupExportUrl();\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export CNN data');\n    } else return setupExportUrl();\n  };\n\n  var audio_player = new a2AudioPlayer($scope);\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.cnnOriginal, params.filter()) : $scope.cnnOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.cnnOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No cnn searches found.\";\n        }\n\n        cnnsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n\n        if ($scope.viewType == \"species\") {\n          $scope.species = cnnsData;\n        } else if ($scope.viewType == \"recordings\") {\n          $scope.recordings = cnnsData;\n        } else {\n          $scope.mainResults = cnnsData;\n        }\n      }\n    });\n  }; //$scope.viewType = \"all\";\n\n\n  $scope.counts = {\n    recordings: null\n  };\n\n  $scope.onSelect = function (item) {\n    $scope.select(item.value);\n  };\n\n  $scope.select = function (option) {\n    var selectFn = null;\n\n    if (option === \"all\") {\n      selectFn = function (roi) {\n        roi.selected = true;\n      };\n    } else if (option === \"none\") {\n      selectFn = function (roi) {\n        roi.selected = false;\n      };\n    } else if (option === \"not-validated\") {\n      selectFn = function (roi) {\n        roi.selected = roi.validated === null;\n      };\n    } else {\n      selectFn = function (roi) {\n        roi.selected = roi.id === option;\n      };\n    }\n\n    ($scope.resultsROIs || []).forEach(selectFn);\n  };\n\n  var refreshDetails = function () {\n    a2CNN.getDetailsFor($scope.cnnId).then(function (data) {\n      $scope.job_details = data;\n    });\n  };\n\n  refreshDetails();\n\n  var bySpecies = function (dataIn) {\n    var dataOut = {};\n    dataIn.forEach(function (element) {\n      var s = element.species_id;\n\n      if (!(s in dataOut)) {\n        dataOut[s] = {\n          count: 0,\n          species_id: s,\n          scientific_name: element.scientific_name\n        };\n      }\n\n      if (element.present == 1) {\n        dataOut[s].count++;\n      }\n    });\n    return dataOut;\n  };\n\n  var byROIs = function (dataIn, thresh) {\n    if (!thresh) {\n      thresh = 0.9;\n    }\n\n    var dataOut = [];\n    dataIn.forEach(function (element) {\n      element.over_thresh = element.score >= thresh;\n      element.present = element.over_thresh;\n      dataOut.push(element);\n    });\n    dataOut.sort(function (a, b) {\n      return a.score < b.score ? 1 : -1;\n    });\n    return dataOut;\n  };\n\n  var byROIsbySpecies = function (dataIn, bySite) {\n    dataOut = {};\n    dataIn.forEach(function (element) {\n      var s = bySite ? element.site : element.species_id + '_' + element.songtype_id;\n\n      if (!(s in dataOut)) {\n        dataOut[s] = {\n          count: 0,\n          species_id: element.species_id,\n          songtype_id: element.songtype_id,\n          scientific_name: element.scientific_name,\n          songtype: element.songtype,\n          rois: []\n        };\n        if (bySite) dataOut[s].site = element.site;\n      }\n\n      dataOut[s].rois.push(element);\n      dataOut[s].count++;\n    });\n    return dataOut;\n  };\n\n  var byRecordings = function (dataIn) {\n    var dataOut = {\n      total: 0\n    };\n    dataIn.forEach(function (element) {\n      var r = element.recording_id;\n      var s = element.species_id;\n\n      if (!(r in dataOut)) {\n        dataOut[r] = {\n          recording_id: r,\n          thumbnail: element.thumbnail,\n          species: {},\n          total: 0,\n          species_list: ''\n        };\n      }\n\n      if (!(s in dataOut[r].species)) {\n        dataOut[r].species[s] = {\n          species_id: s,\n          scientific_name: element.scientific_name,\n          count: 0\n        };\n      }\n\n      if (element.present == 1) {\n        if (dataOut[r].species[s].count == 0) {\n          dataOut[r].species_list = dataOut[r].species_list + ' ' + element.scientific_name;\n        }\n\n        dataOut[r].species[s].count++;\n        dataOut[r].total++;\n      }\n    });\n    return dataOut;\n  };\n\n  var bySpeciesHist = function (dataIn, species_id) {\n    speciesTimes = [];\n    count = 0;\n    speciesName = 'All'; //fix this... ugh\n\n    dataIn.forEach(function (element) {\n      if (species_id == 'all' | element.species_id == species_id) {\n        if (species_id == 'all') {\n          speciesName = 'All';\n        } else {\n          speciesName = element.scientific_name;\n        }\n\n        if (element.present == 1) {\n          var d = new Date(element.datetime);\n          var minutes = d.getHours() * 60 + d.getMinutes();\n          speciesTimes.push(new Date(3000, 0, 1, d.getHours(), d.getMinutes()));\n          count++;\n        }\n      }\n    });\n    return {\n      times: speciesTimes,\n      count: count,\n      name: speciesName\n    };\n  };\n\n  var plotShown = false;\n\n  $scope.showHist = function (species_id) {\n    $scope.speciesInfo = bySpeciesHist($scope.results, species_id);\n    var trace = {\n      x: $scope.speciesInfo.times,\n      type: 'histogram',\n      //xbins: {size: new Date(3000, 0, 2, 2).getTime() - new Date(3000, 0, 2, 0).getTime()}\n      //magic numbers for full day/2 hour bins\n      xbins: {\n        start: 32503698000000,\n        end: 32503791600000,\n        size: 7200000\n      }\n    };\n    var layout = {\n      title: $scope.speciesInfo.name + ' by time of day.',\n      xaxis: {\n        tickformat: '%X',\n        // For more time formatting types, see: https://github.com/d3/d3-time-format/blob/master/README.md\n        range: [new Date(3000, 0, 1).getTime(), new Date(3000, 0, 2).getTime()]\n      }\n    };\n    var data = [trace];\n\n    if (!plotShown) {\n      Plotly.newPlot('speciesHist', data, layout);\n      plotShown = true;\n    } else {\n      Plotly.newPlot('speciesHist', data, layout);\n    }\n  };\n\n  $scope.getRecordingVisualizerUrl = function (recording_id) {\n    return \"/project/\" + Project.getUrl() + \"/visualizer/rec/\" + recording_id;\n  };\n\n  $scope.getRoiVisualizerUrl = function (roi) {\n    var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n    return roi ? \"/project/\" + projecturl + \"/#/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + projecturl + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  };\n\n  $scope.playRoiAudio = function (roi, $event) {\n    if ($event) {\n      $event.preventDefault();\n      $event.stopPropagation();\n    }\n\n    a2AudioBarService.loadUrl(a2CNN.getAudioUrlFor(roi), true);\n  };\n\n  $scope.setPage = function (page, force) {\n    page = Math.max(0, Math.min(page, $scope.total.rois / $scope.limit | 0));\n\n    if (page != $scope.selected.page || force) {\n      $scope.selected.page = page;\n      $scope.offset = page * $scope.limit;\n      loadROIPage();\n    }\n  };\n\n  $scope.moveROIPage = function (n) {\n    var nextPage = $scope.selected.page + n;\n\n    if (nextPage > $scope.total.pages - 1) {\n      $scope.setPage(0);\n    } else if (nextPage < 0) {\n      $scope.setPage($scope.total.pages - 1);\n    } else {\n      $scope.setPage(nextPage);\n    }\n  };\n\n  $scope.setSpecies = function (species) {\n    $scope.selected.species = species;\n    $scope.selected.page = 0;\n    $scope.offset = 0;\n    var site_name = \"site_\" + $scope.selected.site.site_id + \"_\" + $scope.selected.site.name;\n\n    if ($scope.selected.site.site_id == 0) {\n      site_name = 0;\n    }\n\n    $scope.counts.roi_species_counts = getSpeciesCounts(site_name, $scope.roi_species_sites_counts);\n    $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species.species_id, $scope.roi_species_sites_counts);\n    var count_all_species = $scope.counts.roi_species_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    all_species = {\n      species_id: 0,\n      N: count_all_species,\n      scientific_name: \"All Species\"\n    };\n    $scope.counts.roi_species_counts.unshift(all_species);\n    var count_all_sites = $scope.counts.roi_sites_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    var all_site = {\n      site_id: 0,\n      N: count_all_sites,\n      name: \"All Sites\"\n    };\n    $scope.counts.roi_sites_counts.unshift(all_site);\n    $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n      return element.site_id == $scope.selected.site.site_id;\n    });\n    $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n      return element.species_id == $scope.selected.species.species_id;\n    }); //$scope.counts.roi_sites_counts.unshift($scope.selected.site);\n    //$scope.selected.site = all_site;\n\n    $scope.total = {\n      rois: species.N,\n      pages: Math.ceil(species.N / $scope.limit)\n    };\n    loadROIPage();\n  };\n\n  $scope.counts = {};\n\n  $scope.setSite = function (site) {\n    $scope.selected.site = site;\n    $scope.selected.page = 0;\n    $scope.offset = 0;\n    var site_name = \"site_\" + $scope.selected.site.site_id + \"_\" + $scope.selected.site.name;\n\n    if ($scope.selected.site.site_id == 0) {\n      site_name = 0;\n    }\n\n    $scope.counts.roi_species_counts = getSpeciesCounts(site_name, $scope.roi_species_sites_counts);\n    $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species.species_id, $scope.roi_species_sites_counts);\n    var count_all_species = $scope.counts.roi_species_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    all_species = {\n      species_id: 0,\n      N: count_all_species,\n      scientific_name: \"All Species\"\n    };\n    $scope.counts.roi_species_counts.unshift(all_species); //$scope.counts.roi_species_counts.unshift($scope.selected.species);\n\n    var count_all_sites = $scope.counts.roi_sites_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    var all_site = {\n      site_id: 0,\n      N: count_all_sites,\n      name: \"All Sites\"\n    };\n    $scope.counts.roi_sites_counts.unshift(all_site);\n    $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n      return element.species_id == $scope.selected.species.species_id;\n    });\n    $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n      return element.site_id == $scope.selected.site.site_id;\n    });\n    $scope.total = {\n      rois: site.N,\n      pages: Math.ceil(site.N / $scope.limit)\n    };\n    loadROIPage();\n  };\n\n  var loadROIPage = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    a2CNN.listROIs($scope.cnnId, $scope.limit, $scope.offset, $scope.selected.species.species_id, $scope.selected.site.site_id, $scope.selected.search.value).then(function (data) {\n      $scope.resultsROIs = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n      $scope.rois = byROIs($scope.resultsROIs);\n      $scope.rois_species = byROIsbySpecies($scope.rois, $scope.selected.search.value === 'by_score_per_site');\n    });\n  };\n\n  $scope.validate = function () {\n    if (!a2UserPermit.can('validate cnn rois')) {\n      notify.log('You do not have permission to validate the cnn rois.');\n      return;\n    }\n\n    var validation = ($scope.validation.current || {\n      value: null\n    }).value;\n    var rois = [];\n\n    for (var species in $scope.rois_species) {\n      $scope.rois_species[species].rois.forEach(function (roi) {\n        if (roi.selected) {\n          rois.push(roi);\n        }\n      });\n    }\n\n    var roiIds = rois.map(function (roi) {\n      return roi.cnn_result_roi_id;\n    });\n\n    try {\n      a2CNN.validateRois($scope.cnnId, roiIds, validation).then(function (response) {\n        rois.forEach(function (roi) {\n          roi.validated = validation;\n          roi.selected = false;\n        }); //loadROIPage();\n      });\n    } catch (error) {\n      console.error(\"TCL: $scope.validate -> error\", error);\n    }\n\n    refreshDetails();\n  }; //$scope.calcWidth = function(roi) {\n  //};\n\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    var scrollPos = $controller.scrollElement.scrollY;\n    var headerTop = $controller.anchors.header.offset().top;\n    this.headerTop = headerTop | 0;\n    this.scrolledPastHeader = scrollPos >= headerTop;\n  };\n\n  var getSpeciesCounts = function (site, species_sites_matrix) {\n    if (site == 0) {\n      site = 'total';\n    }\n\n    var roi_species_counts = [];\n    species_sites_matrix.forEach(function (species) {\n      roi_species_counts.push({\n        species_id: species.species_id,\n        N: species[site],\n        scientific_name: species.scientific_name\n      });\n    });\n    return roi_species_counts;\n  };\n\n  var getSitesCounts = function (species, species_sites_matrix) {\n    if (species == 0) {\n      species = 'total';\n    }\n\n    var roi_site_counts = [];\n    species_sites_matrix.forEach(function (s) {\n      if (species == 'total' | s.species_id == species) {\n        for (key in s) {\n          split = key.split(\"_\");\n          site_id = split[1];\n          name = split.slice(2).join(\"_\");\n\n          if (split[0] == \"site\") {\n            row = {};\n            row.site_id = site_id;\n            row.N = s[key];\n            row.name = name;\n            roi_site_counts.push(row);\n          }\n        }\n      }\n    });\n\n    if (species == 'total') {\n      roi_site_counts_dict = roi_site_counts.reduce(function (sitesAcc, site) {\n        if (!(site.site_id in sitesAcc)) {\n          sitesAcc[site.site_id] = {\n            site_id: site.site_id,\n            N: 0,\n            name: site.name\n          };\n        }\n\n        sitesAcc[site.site_id].N += site.N;\n        return sitesAcc;\n      }, {});\n      roi_site_counts = Object.values(roi_site_counts_dict);\n    }\n\n    return roi_site_counts;\n  };\n\n  $scope.onSearchChanged = function () {\n    $scope.switchView(\"rois\");\n  };\n\n  $scope.switchView = function (viewType, specie) {\n    if (specie) {\n      window.scrollTo(0, 0);\n    }\n\n    var sortBy = \"-cnn_presence_id\";\n\n    var loadSwitch = function () {\n      if (viewType == \"species\") {\n        $scope.species = bySpecies($scope.results);\n        $scope.viewType = \"species\";\n        sortBy = \"-scientific_name\";\n        $scope.showHist(specie ? specie : \"all\");\n        $scope.cnnOriginal = Object.values($scope.species);\n      } else if (viewType == \"recordings\") {\n        $scope.recordings = byRecordings($scope.results);\n        $scope.counts.recordings = Object.keys($scope.recordings).length;\n        $scope.viewType = \"recordings\";\n        sortBy = \"-recording_id\";\n        $scope.cnnOriginal = Object.values($scope.recordings);\n      } else {\n        $scope.viewType = \"all\";\n        $scope.mainResults = $scope.results;\n        $scope.cnnOriginal = Object.values($scope.results);\n      }\n\n      if ($scope.cnnOriginal.length > 0) {\n        initTable(1, 10, sortBy, {}, $scope.cnnOriginal.length);\n      } else {\n        $scope.infopanedata = \"No cnn results found.\";\n      }\n    };\n\n    if (viewType == \"rois\") {\n      a2CNN.countROIsBySpeciesSites($scope.cnnId, {\n        search: $scope.selected.search.value\n      }).then(function (response) {\n        var data = response.data;\n        $scope.roi_species_sites_counts = data;\n        $scope.counts.roi_species_counts = getSpeciesCounts($scope.selected.site ? $scope.selected.site.site_id : 0, $scope.roi_species_sites_counts);\n        $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species ? $scope.selected.species.species_id : 0, $scope.roi_species_sites_counts);\n        var count_all = $scope.counts.roi_species_counts.reduce(function (count, current) {\n          return count = count + current.N;\n        }, 0);\n        var all_species = {\n          species_id: 0,\n          N: count_all,\n          scientific_name: \"All Species\"\n        };\n        $scope.counts.roi_species_counts.unshift(all_species);\n\n        if (!$scope.selected.species) {\n          $scope.selected.species = all_species;\n        } else {\n          $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n            return element.species_id == $scope.selected.species.species_id;\n          }) || all_species;\n        }\n\n        var all_sites = {\n          site_id: 0,\n          N: count_all,\n          name: \"All Sites\"\n        };\n        $scope.counts.roi_sites_counts.unshift(all_sites);\n\n        if (!$scope.selected.site) {\n          $scope.selected.site = all_sites;\n        } else {\n          $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n            return element.site_id == $scope.selected.site.site_id;\n          }) || all_sites;\n        }\n\n        $scope.total = {\n          rois: count_all,\n          pages: Math.ceil(count_all / $scope.limit)\n        };\n        $scope.viewType = \"rois\";\n        loadROIPage();\n      }); //$scope.viewType = \"rois\";\n      //if (!$scope.resultsROIs) {\n      //    loadROIPage();\n      //} else {\n      //    $scope.rois = byROIs($scope.resultsROIs);\n      //    $scope.rois_species = byROIsbySpecies($scope.rois);\n      //}\n    } else if (!$scope.results) {\n      $scope.loading = true;\n      $scope.infoInfo = \"Loading...\";\n      $scope.showInfo = true;\n      a2CNN.listResults($scope.cnnId).then(function (data) {\n        $scope.results = data;\n        $scope.infoInfo = \"\";\n        $scope.showInfo = false;\n        $scope.loading = false;\n        $scope.infopanedata = \"\";\n        $scope.switchView('rois'); //loadSwitch();\n      });\n    } else {\n      loadSwitch();\n    }\n  };\n\n  $scope.switchView($state.params.detailType ? $state.params.detailType : 'all');\n});","angular.module('a2.analysis.clustering-jobs', ['ui.bootstrap', 'a2.srv.clustering-jobs', 'a2.srv.playlists', 'a2.services', 'a2.permissions', 'a2.directive.audio-bar', 'humane', 'a2.filter.round', 'a2.directive.frequency_filter_range_control']).config(function ($stateProvider) {\n  $stateProvider.state('analysis.clustering-jobs', {\n    url: '/clustering-jobs',\n    controller: 'ClusteringJobsModelCtrl',\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  }).state('analysis.clustering-jobs-details', {\n    url: '/clustering-jobs/:clusteringJobId?freqMin&freqMax',\n    controller: 'ClusteringJobsModelCtrl',\n    params: {\n      freqMin: null,\n      freqMax: null\n    },\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  }).state('analysis.grid-view', {\n    url: '/clustering-jobs/:clusteringJobId/grid-view',\n    controller: 'ClusteringJobsModelCtrl',\n    params: {\n      gridContext: null\n    },\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  });\n}) //------------------- Clustering List page ---------------\n.controller('ClusteringJobsModelCtrl', function ($scope, $state, $stateParams, a2ClusteringJobs, JobsData, notify, $location, $modal, a2UserPermit, $localStorage, Project) {\n  $scope.selectedClusteringJobId = $stateParams.clusteringJobId;\n  $scope.showViewGridPage = false;\n  $scope.getProjectData = function () {\n    Project.getInfo(function (info) {\n      $scope.isProjectDisabled = info.disabled === 1;\n    });\n  }, $scope.getProjectData();\n\n  $scope.loadClusteringJobs = function () {\n    $scope.loading = true;\n    $scope.showRefreshBtn = false;\n    return a2ClusteringJobs.list({\n      completed: true\n    }).then(function (data) {\n      $scope.clusteringJobsOriginal = data;\n      $scope.clusteringJobsData = data;\n      $scope.loading = false;\n\n      if (data && data.length) {\n        $scope.showRefreshBtn = true;\n      }\n    });\n  };\n\n  if (!$scope.selectedClusteringJobId) {\n    $scope.loadClusteringJobs();\n  } // Parse grid view data if it exists\n\n\n  const gridContext = JSON.parse($localStorage.getItem('analysis.gridContext'));\n\n  if ($stateParams.gridContext || gridContext && $state.current.name === 'analysis.grid-view') {\n    $scope.showViewGridPage = true;\n    $scope.gridContext = $stateParams.gridContext ? $stateParams.gridContext : gridContext;\n  } else {\n    $localStorage.setItem('analysis.gridContext', null);\n  }\n\n  $scope.selectItem = function (clusteringJob) {\n    if (!clusteringJob) {\n      $state.go('analysis.clustering-jobs', {});\n    } else {\n      $state.go('analysis.clustering-jobs-details', {\n        clusteringJobId: clusteringJob.clustering_job_id\n      });\n    }\n  };\n\n  $scope.createNewClusteringJob = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to create Clustering job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/new-clustering-job.html',\n      controller: 'CreateNewClusteringJobCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.create) {\n        JobsData.updateJobs();\n        $scope.showRefreshBtn = true;\n        notify.log(\"Your new clustering job is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteClusteringJob = function (clusteringJob, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.log('You do not have permission to delete Clustering job');\n      return;\n    }\n\n    const modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/delete-clustering-job.html',\n      controller: 'DeleteClusteringJobCtrl as controller',\n      resolve: {\n        clusteringJob: function () {\n          return clusteringJob;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error('Error: ' + ret.err);\n      } else {\n        const modArr = angular.copy($scope.clusteringJobsOriginal);\n        const indx = modArr.findIndex(function (item) {\n          return item.clustering_job_id === clusteringJob.clustering_job_id;\n        });\n\n        if (indx > -1) {\n          $scope.clusteringJobsOriginal.splice(indx, 1);\n          notify.log('Clustering Job deleted successfully');\n        }\n      }\n    });\n  };\n}).controller('DeleteClusteringJobCtrl', function ($scope, $modalInstance, a2ClusteringJobs, clusteringJob) {\n  this.clusteringJob = clusteringJob;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2ClusteringJobs.delete(clusteringJob.clustering_job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}) //------------------- Clustering Details page ---------------\n.directive('a2ClusteringDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      clusteringJobId: '=',\n      detailedView: '=',\n      onSetDetailedView: '&',\n      onGoBack: '&'\n    },\n    controller: 'ClusteringDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/clustering-jobs/details.html'\n  };\n}).controller('ClusteringDetailsCtrl', function ($scope, $state, $location, a2ClusteringJobs, $window, Project, a2Playlists, $localStorage, $modal, a2UserPermit) {\n  var d3 = $window.d3;\n  $scope.loading = true;\n  $scope.toggleMenu = false;\n  $scope.selectedCluster = null;\n  var timeout;\n  $scope.frequencyFilter = {\n    min: null,\n    max: null,\n    currentMin: null,\n    currentMax: null\n  };\n\n  $scope.decrementClusters = function () {\n    if ($scope.selectedCluster === 1) return;\n    $scope.selectedCluster -= 1;\n    $scope.selectCluster();\n  };\n\n  $scope.incrementClusters = function () {\n    if ($scope.selectedCluster === $scope.layout.shapes.length) return;\n    $scope.selectedCluster += 1;\n    $scope.selectCluster();\n  }; // Select one cluster\n\n\n  $scope.selectCluster = function () {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      if ($scope.selectedCluster !== null) {\n        $(\"#plotly .select-outline\").remove();\n        $scope.layout.shapes.forEach(function (shape) {\n          shape.line.color = shape.fillcolor;\n          shape.line['stroke-width'] = 1;\n        });\n        var selection = $scope.layout.shapes[$scope.selectedCluster - 1];\n        selection.line.color = '#ffffff';\n        Plotly.relayout(document.getElementById('plotly'), {\n          'selection.line.color': '#ff0000',\n          'selection.line.opacity': 1,\n          'selection.line.stroke-width': 4\n        }); // Example: 3:[0, 1, 2, 3, 4] , where 3 - index of a cluster, array with the index of detections\n\n        $scope.points = [];\n        $scope.points[$scope.selectedCluster - 1] = [];\n        $scope.points[$scope.selectedCluster - 1] = $scope.getShapePoints();\n        $scope.toggleMenu = true;\n        $scope.$apply();\n      }\n    }, 2000);\n  };\n\n  $scope.getShapePoints = function () {\n    var arr = [];\n    var clusters = $scope.isFilteredClusters() ? $scope.sortFilteredData({\n      min: $location.search().freqMin,\n      max: $location.search().freqMax\n    }) : $scope.clusters;\n    var selectedAedList = Object.values(clusters)[$scope.selectedCluster - 1].aed;\n\n    if (selectedAedList && selectedAedList.length) {\n      selectedAedList.forEach(function (item, ind) {\n        arr.push(ind);\n      });\n    }\n\n    return arr;\n  };\n\n  var getClusteringDetails = function () {\n    $scope.infopanedata = '';\n    a2ClusteringJobs.getJobDetails($scope.clusteringJobId).then(function (data) {\n      if (data) $scope.job_details = data;\n    }).catch(function (err) {\n      console.log(err);\n    }); // Get json file which is included aed_id, clusters names, x, y points.\n\n    a2ClusteringJobs.getClusteringDetails({\n      job_id: $scope.clusteringJobId\n    }).then(function (res) {\n      $scope.loading = false;\n\n      if (res && res.aed_id) {\n        $scope.countAudioEventDetected = res.aed_id.length; // Collect clusters data.\n\n        $scope.clusters = {};\n        res.cluster.forEach(function (item, i) {\n          if (!$scope.clusters[item]) {\n            $scope.clusters[item] = {\n              x: [res.x_coord[i]],\n              y: [res.y_coord[i]],\n              aed: [res.aed_id[i]],\n              freq_low: [],\n              freq_high: []\n            };\n          } else {\n            $scope.clusters[item].x.push(res.x_coord[i]);\n            $scope.clusters[item].y.push(res.y_coord[i]);\n            $scope.clusters[item].aed.push(res.aed_id[i]);\n          }\n        }); // Get json file which is included aed_id, recordings, frequency data for the frequency filter.\n\n        a2ClusteringJobs.getClusteringDetails({\n          job_id: $scope.clusteringJobId,\n          aed_info: true\n        }).then(function (data) {\n          if (data !== undefined) {\n            $scope.aedDataInfo = data; // Create frequency object to collect min and max values for the frequency filter.\n\n            $scope.frequency = {\n              freq_low: [],\n              freq_high: []\n            }; // Add frequency min, max values to the clusters array.\n\n            for (var c in $scope.clusters) {\n              if ($scope.clusters[c] && $scope.clusters[c].aed && $scope.clusters[c].aed.length) {\n                $scope.clusters[c].aed.forEach(function (aed) {\n                  const indx = data.aed_id.findIndex(function (item) {\n                    return item === aed;\n                  });\n\n                  if (indx !== -1) {\n                    // Collect frequency min and max values for the frequency filter.\n                    $scope.frequency.freq_low.push(data.freq_low[indx]);\n                    $scope.frequency.freq_high.push(data.freq_high[indx]);\n                    $scope.clusters[c].freq_low.push(data.freq_low[indx]);\n                    $scope.clusters[c].freq_high.push(data.freq_high[indx]);\n                  }\n                });\n              }\n            } // Find frequency min and max values for frequency filter.\n\n\n            $scope.frequencyFilter.min = Math.min.apply(null, $scope.frequency.freq_low);\n            $scope.frequencyFilter.max = Math.max.apply(null, $scope.frequency.freq_high);\n\n            if ($scope.isFilteredClusters()) {\n              $scope.useFrequencyFilterData({\n                min: parseInt($location.search().freqMin),\n                max: parseInt($location.search().freqMax)\n              });\n            }\n          }\n        }).catch(function (err) {\n          console.log(err);\n        });\n        $scope.countClustersDetected = Object.keys($scope.clusters).length;\n\n        if (!$scope.isFilteredClusters()) {\n          drawClusteringPoints($scope.clusters);\n        }\n      }\n    }).catch(function (err) {\n      console.log(err);\n      $scope.loading = false;\n      $scope.infopanedata = 'No data for clustering job found.';\n    });\n  };\n\n  $scope.isFilteredClusters = function () {\n    return $location.search().freqMin && $location.search().freqMax;\n  };\n\n  $scope.isEmpty = function () {\n    return $scope.countAudioEventDetected !== undefined && $scope.countAudioEventDetected === 0 && !$scope.loading;\n  };\n\n  $scope.aedsDetected = function () {\n    if ($scope.countAudioEventDetected === undefined && $scope.loading) return '';\n    if ($scope.countAudioEventDetected === undefined && !$scope.loading) return 'no data';\n    return $scope.countAudioEventDetected;\n  };\n\n  $scope.clustersDetected = function () {\n    if ($scope.countClustersDetected === undefined && $scope.loading) return '';\n    if ($scope.countClustersDetected === undefined && !$scope.loading) return 'no data';\n    return $scope.countClustersDetected;\n  };\n\n  var drawClusteringPoints = function (clusters) {\n    var el = document.getElementById('plotly');\n    var data = [];\n    var shapes = [];\n    $scope.originalData = [];\n\n    for (var c in clusters) {\n      // Collect data for points.\n      data.push({\n        x: clusters[c].x,\n        y: clusters[c].y,\n        type: 'scatter',\n        mode: 'markers',\n        hoverinfo: 'none',\n        name: c,\n        marker: {\n          size: 6\n        }\n      }); // Collect data for shapes.\n\n      shapes.push({\n        type: 'circle',\n        xref: 'x',\n        yref: 'y',\n        x0: d3.min(clusters[c].x),\n        y0: d3.min(clusters[c].y),\n        x1: d3.max(clusters[c].x),\n        y1: d3.max(clusters[c].y),\n        opacity: 0.2\n      }); // Collect data for grid view page.\n\n      $scope.originalData.push({\n        x: clusters[c].x,\n        y: clusters[c].y,\n        cluster: c,\n        aed: clusters[c].aed\n      });\n    } // Shapes layout.\n\n\n    $scope.layout = {\n      shapes: shapes,\n      height: el ? el.offsetWidth - el.offsetWidth / 3 : 800,\n      width: el ? el.offsetWidth : 1390,\n      showlegend: true,\n      dragmode: 'lasso',\n      legend: {\n        title: {\n          text: 'Clusters names',\n          side: 'top',\n          font: {\n            size: 12\n          }\n        },\n        x: 1,\n        xanchor: 'right',\n        y: 1,\n        itemclick: 'toggleothers',\n        font: {\n          color: 'white'\n        }\n      },\n      paper_bgcolor: '#232436',\n      plot_bgcolor: '#232436',\n      xaxis: {\n        color: 'white',\n        title: 'Component 2',\n        side: 'top'\n      },\n      yaxis: {\n        color: 'white',\n        title: 'Component 1'\n      }\n    }; // Function to get color.\n\n    function getColor(n) {\n      const rgb = [0, 0, 0];\n\n      for (var i = 0; i < 24; i++) {\n        rgb[i % 3] <<= 1;\n        rgb[i % 3] |= n & 0x01;\n        n >>= 1;\n      }\n\n      return '#' + rgb.reduce(function (a, c) {\n        return (c > 0x0f ? c.toString(16) : '0' + c.toString(16)) + a;\n      }, '');\n    } // Make random color for shapes and points.\n\n\n    $scope.layout.shapes.forEach(function (shape, i) {\n      var color = getColor(i + 1);\n      data[i].marker = {\n        color: color\n      };\n      shape.fillcolor = color;\n      shape.line = {\n        color: color,\n        'stroke-width': 1\n      };\n    });\n\n    $scope.resetSelect = function () {\n      $scope.toggleMenu = false;\n      $scope.$apply();\n      $scope.layout.shapes.forEach(function (shape) {\n        shape.line.color = shape.fillcolor;\n        shape.line['stroke-width'] = 1;\n      });\n      Plotly.redraw(el);\n      $scope.$apply();\n    };\n\n    if (el) {\n      var config = {\n        scrollZoom: true,\n        displayModeBar: true,\n        displaylogo: false,\n        hoverdistance: 5\n      }; // To draw points\n\n      Plotly.newPlot(el, data, $scope.layout, config);\n      dragLayer = document.getElementsByClassName('nsewdrag')[0];\n      $scope.xAxisRangeStart = $scope.layout.xaxis.range[0]; // Hover on plotly\n\n      el.on('plotly_hover', function (data) {\n        if ($scope.layout.dragmode === 'lasso') {\n          dragLayer.classList.add('lasso-cursor');\n        }\n      }); // Zoom on plotly\n\n      el.on('plotly_unhover', function (data) {\n        dragLayer.classList.remove('lasso-cursor');\n      });\n      el.on('plotly_relayouting', function (data) {\n        if (data['xaxis.range[0]'] > $scope.xAxisRangeStart) {\n          dragLayer.classList.remove('zoom-out-cursor');\n          dragLayer.classList.add('zoom-in-cursor');\n          $scope.xAxisRangeStart = data['xaxis.range[0]'];\n        }\n\n        if (data['xaxis.range[0]'] < $scope.xAxisRangeStart) {\n          dragLayer.classList.remove('zoom-in-cursor');\n          dragLayer.classList.add('zoom-out-cursor');\n          $scope.xAxisRangeStart = data['xaxis.range[0]'];\n        }\n      });\n      el.on('plotly_relayout', function (data) {\n        dragLayer.classList.remove('zoom-out-cursor');\n        dragLayer.classList.remove('zoom-in-cursor');\n      }); // Click on a point\n\n      el.on('plotly_click', function (data) {\n        console.log('plotly_click', data);\n        $(\"#plotly .select-outline\").remove();\n        $scope.resetSelect();\n        $scope.points = {\n          x: data.points[0].x,\n          y: data.points[0].y,\n          name: data.points[0].fullData.name\n        };\n        $scope.layout.shapes.forEach(function (shape, i) {\n          if ($scope.points.x >= shape.x0 && $scope.points.x <= shape.x1 && $scope.points.y >= shape.y0 && $scope.points.y <= shape.y1) {\n            $scope.layout.shapes[i].line.color = '#ffffff';\n            Plotly.relayout(el, {\n              '$scope.layout.shapes[i].line.color': '#ff0000',\n              '$scope.layout.shapes[i].line.stroke-width': 4\n            });\n            $scope.toggleMenu = true;\n            $scope.$apply();\n          }\n        });\n      }); // Select a group of points.\n\n      el.on('plotly_selected', function (data) {\n        if (!data) {\n          $(\"#plotly .select-outline\").remove();\n        }\n\n        ;\n        console.log('plotly_selected', data);\n        $scope.points = []; // Collect selected points indexes in the points array.\n\n        if (data && data.points && data.points.length) {\n          data.points.forEach(function (point) {\n            var cluster = point.curveNumber;\n\n            if (!$scope.points[cluster]) {\n              $scope.points[cluster] = [];\n            }\n\n            ; // Example: 3:[0, 1, 2, 3, 4] , where 3 - index of a cluster, array with the index of detections\n\n            $scope.points[cluster].push(point.pointNumber);\n          });\n          $scope.toggleMenu = true;\n          $scope.$apply();\n        }\n      });\n    }\n  }; // Navigates to the Grid View page.\n\n\n  $scope.onGridViewSelected = function () {\n    $scope.toggleMenu = false;\n    $scope.selectedCluster = null;\n    $scope.showViewGridPage = true; // View all clusters\n\n    if (!$scope.points) {\n      $scope.gridContext = $scope.originalData;\n    } // Get points in different clusters, when the user selects dots by lasso or with the cluster selector\n    else if ($scope.points.length) {\n        $scope.gridContext = {};\n        $scope.points.forEach(function (row, i) {\n          $scope.gridContext[i] = {\n            aed: $scope.originalData[i].aed.filter(function (a, i) {\n              return row.includes(i);\n            }),\n            name: $scope.originalData[i].cluster\n          };\n        });\n      } // Get selected cluster with all points in the shape\n      else {\n          $scope.gridContext = $scope.originalData.find(function (shape) {\n            return shape.x.includes($scope.points.x) && shape.y.includes($scope.points.y);\n          });\n        }\n\n    $state.go('analysis.grid-view', {\n      clusteringJobId: $scope.clusteringJobId,\n      gridContext: $scope.gridContext\n    });\n  }; // Navigates to the Visualizer page.\n\n\n  $scope.showClustersInVisualizer = function () {\n    if ($scope.points.length) {\n      $scope.selectedClusters = {\n        aed: []\n      };\n\n      for (var r in $scope.points) {\n        $scope.originalData[r].aed.forEach(function (a, i) {\n          if ($scope.points[r].includes(i)) {\n            $scope.selectedClusters.aed.push(a);\n          }\n\n          ;\n        });\n      }\n    } else {\n      // User selects any point in one shape. It have to process all points in a shape\n      $scope.selectedClusters = $scope.originalData.find(function (shape) {\n        return shape.x.includes($scope.points.x) && shape.y.includes($scope.points.y);\n      });\n    } // Save temporary palylist with selected clusters to the local storage.\n\n\n    if ($scope.selectedClusters && $scope.selectedClusters.aed && $scope.selectedClusters.aed.length) {\n      if ($scope.aedDataInfo !== undefined) {\n        $scope.selectedClusters.boxes = {};\n        var recIds = [];\n        $scope.selectedClusters.aed.forEach(function (id) {\n          const indx = $scope.aedDataInfo.aed_id.findIndex(function (item) {\n            return item === id;\n          });\n          recIds.push($scope.aedDataInfo.recording_id[indx]);\n          var box = ['box', $scope.aedDataInfo.time_min[indx], $scope.aedDataInfo.freq_low[indx], $scope.aedDataInfo.time_max[indx], $scope.aedDataInfo.freq_high[indx]].join(',');\n\n          if (!$scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]]) {\n            $scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]] = [box];\n          } else {\n            $scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]].push(box);\n          }\n        });\n        $scope.removeFromLocalStorage();\n        tempPlaylistData = {};\n        tempPlaylistData.aed = $scope.selectedClusters.aed;\n        tempPlaylistData.boxes = $scope.selectedClusters.boxes;\n        tempPlaylistData.playlist = {\n          id: 0,\n          name: 'cluster_' + recIds.join(\"_\"),\n          recordings: recIds.filter(function (id, i, a) {\n            return a.indexOf(id) === i;\n          }),\n          count: recIds.filter(function (id, i, a) {\n            return a.indexOf(id) === i;\n          }).length\n        };\n        $localStorage.setItem('analysis.clusters', JSON.stringify(tempPlaylistData));\n        $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/0?clusters';\n      }\n    }\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  };\n\n  $scope.savePlaylist = function (opts) {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to manage AED and Clustering job');\n      return;\n    }\n\n    a2Playlists.create(opts, function (data) {\n      if (data && data.playlist_id) {\n        $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/' + data.playlist_id + '?clusters';\n      }\n    });\n  };\n\n  $scope.showDetailsPage = function () {\n    return !$scope.loading && !$scope.infopanedata && !$scope.gridViewSelected;\n  };\n\n  $scope.openFreqFilterModal = function () {\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/frequency-filter.html',\n      controller: 'a2ClusterFrequencyFilterModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            frequency: $scope.frequencyFilter\n          };\n        }\n      }\n    });\n    modalInstance.result.then(function (result) {\n      if (!result) {\n        return;\n      }\n\n      $scope.useFrequencyFilterData(result);\n    });\n  };\n\n  $scope.sortFilteredData = function (result) {\n    var clusters = {};\n\n    for (var c in $scope.clusters) {\n      if ($scope.clusters[c].aed.length) {\n        clusters[c] = {};\n        clusters[c].y = [];\n        clusters[c].x = [];\n        clusters[c].aed = []; // Find filtered points in each cluster from the user selection.\n\n        $scope.clusters[c].freq_high.forEach(function (freq_high, i) {\n          if ($scope.clusters[c].freq_low[i] >= result.min && freq_high <= result.max) {\n            clusters[c].y.push($scope.clusters[c].y[i]);\n            clusters[c].x.push($scope.clusters[c].x[i]);\n            clusters[c].aed.push($scope.clusters[c].aed[i]);\n          }\n        });\n\n        if (!clusters[c].aed.length) {\n          delete clusters[c];\n        }\n      }\n    }\n\n    return clusters;\n  };\n\n  $scope.useFrequencyFilterData = function (result) {\n    $scope.frequencyFilter.currentMin = result.min;\n    $scope.frequencyFilter.currentMax = result.max;\n    $state.params.freqMin = $scope.frequencyFilter.currentMin;\n    $state.params.freqMax = $scope.frequencyFilter.currentMax;\n    $location.search('freqMin', $scope.frequencyFilter.currentMin);\n    $location.search('freqMax', $scope.frequencyFilter.currentMax);\n    var clusters = $scope.sortFilteredData(result);\n    $scope.countClustersDetected = Object.keys(clusters).length;\n    $scope.countAudioEventDetected = Object.values(clusters).map(function (cluster) {\n      return cluster.aed.length;\n    }).reduce(function (sum, current) {\n      return sum + current;\n    }, 0); // Display filtered points from after selection in the frequency filter.\n\n    drawClusteringPoints(clusters);\n  };\n\n  getClusteringDetails();\n}).controller('a2ClusterFrequencyFilterModalController', function ($scope, $modalInstance, data, Project) {\n  $scope.filterData = {};\n  $scope.filterData.max_freq = data.frequency.max;\n  $scope.filterData.src = \"/api/project/\" + Project.getUrl() + \"/recordings/tiles/3298382/0/0\";\n  $scope.has_previous_filter = true;\n  $scope.frequency = data.frequency && data.frequency.currentMax ? {\n    min: angular.copy(data.frequency.currentMin),\n    max: data.frequency.currentMax\n  } : {\n    min: 0,\n    max: $scope.filterData.max_freq\n  };\n\n  $scope.remove_filter = function () {\n    $modalInstance.close({\n      min: data.frequency.min,\n      max: data.frequency.max\n    });\n  };\n\n  $scope.apply_filter = function () {\n    $modalInstance.close($scope.frequency);\n  };\n}).controller('CreateNewClusteringJobCtrl', function ($modalInstance, a2ClusteringJobs, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        jobs: false,\n        saving: false\n      };\n      var list = this.list = {};\n      this.data = {\n        name: null,\n        aed_job: {},\n        params: {\n          minPoints: 3,\n          distanceThreshold: 0.1,\n          maxClusterSize: 100\n        }\n      };\n      this.timeout;\n      this.loading.jobs = true;\n      a2ClusteringJobs.audioEventDetections({\n        completed: true\n      }).then(function (jobs) {\n        this.loading.jobs = false;\n        list.jobs = jobs.map(function (job) {\n          return {\n            name: job.name,\n            jobId: job.job_id\n          };\n        });\n      }.bind(this));\n    },\n    create: function () {\n      var _this = this;\n\n      this.loading.saving = true;\n\n      try {\n        return a2ClusteringJobs.create({\n          name: this.data.name,\n          aed_job: this.data.aed_job,\n          params: this.data.params\n        }).then(function (clusteringModel) {\n          $modalInstance.close({\n            create: true,\n            clusteringModel: clusteringModel\n          });\n        }.bind(this));\n      } catch (error) {\n        this.loading.saving = false;\n        console.error(error);\n      }\n\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        _this.loading.saving = false;\n      }, 2000);\n    },\n    cancel: function (url) {\n      this.loading.jobs = false;\n      this.loading.saving = false;\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isJobValid: function () {\n      return this.data && this.data.name && this.data.name.length > 3 && this.data.aed_job;\n    }\n  });\n  this.initialize();\n}) //------------------- Gid View page ---------------\n.directive('a2GridView', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      clusteringJobId: '=',\n      gridContext: '=',\n      onGoBack: '&'\n    },\n    controller: 'GridViewCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/clustering-jobs/grid-view.html'\n  };\n}).controller('ExportReportModalCtrl', function ($scope, $modalInstance, a2ClusteringJobs, data) {\n  $scope.userEmail = data.userEmail;\n\n  $scope.accessExportReport = function (email) {\n    data.userEmail = email;\n    $scope.isExporting = true;\n    $scope.errMess = '';\n    a2ClusteringJobs.exportClusteringROIs(data).then(function (data) {\n      $scope.isExporting = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        $modalInstance.close();\n      }\n    });\n  };\n\n  $scope.changedUserEmail = function () {\n    $scope.errMess = null;\n  };\n}).controller('GridViewCtrl', function ($scope, $http, a2UserPermit, a2ClusteringJobs, a2AudioBarService, a2AudioEventDetectionsClustering, Project, Songtypes, a2Playlists, notify, $modal, $localStorage) {\n  $scope.loading = true;\n  $scope.isSquareSize = false;\n  $scope.infopanedata = '';\n  $scope.projectUrl = Project.getUrl();\n  $scope.allRois = [];\n  $scope.selectedRois = [];\n  $scope.paginationSettings = {\n    page: 1,\n    limit: 100,\n    offset: 0,\n    totalItems: 0,\n    totalPages: 0\n  };\n  $scope.lists = {\n    search: [{\n      value: 'all',\n      text: 'All',\n      description: 'Show all matched rois.'\n    }, {\n      value: 'per_cluster',\n      text: 'Sort per Cluster',\n      description: 'Show all rois ranked per Cluster.'\n    }, {\n      value: 'per_site',\n      text: 'Sort per Site',\n      description: 'Show all rois ranked per Site.'\n    }, {\n      value: 'per_date',\n      text: 'Sort per Date',\n      description: 'Show all rois sorted per Date.'\n    }, {\n      value: 'per_species',\n      text: 'Sort per Species',\n      description: 'Show all rois sorted per Species.'\n    }],\n    validation: [{\n      class: \"fa val-1\",\n      text: 'Present',\n      value: 1\n    }, {\n      class: \"fa val-0\",\n      text: 'Not Present',\n      value: 0\n    }, {\n      class: \"fa val-null\",\n      text: 'Clear',\n      value: -1\n    }]\n  };\n  $scope.validation = {\n    status: $scope.lists.validation[2]\n  };\n  $scope.selectedFilterData = $scope.lists.search[1];\n  $scope.playlistData = {};\n  $scope.aedData = {\n    count: 0,\n    id: []\n  };\n  $scope.speciesLoading = false;\n  $scope.selected = {\n    species: null,\n    songtype: null\n  };\n  var timeout;\n  var isShiftKeyHolding = false;\n\n  if ($scope.gridContext && $scope.gridContext.aed) {\n    $scope.gridData = [];\n    $scope.gridData.push($scope.gridContext);\n    $scope.aedData.count = 1;\n    $scope.gridContext.aed.forEach(function (i) {\n      return $scope.aedData.id.push(i);\n    });\n  } else {\n    $scope.gridData = Object.values($scope.gridContext);\n    $scope.aedData.count = $scope.gridData.length;\n    $scope.gridData.forEach(function (data) {\n      data.aed.forEach(function (i) {\n        return $scope.aedData.id.push(i);\n      });\n    });\n  }\n\n  $localStorage.setItem('analysis.gridContext', JSON.stringify($scope.gridContext));\n  a2ClusteringJobs.getJobDetails($scope.clusteringJobId).then(function (data) {\n    if (data) $scope.job_details = data;\n  }).catch(function (err) {\n    console.log(err);\n  });\n\n  $scope.onSearchChanged = function (item) {\n    $scope.selectedFilterData = item;\n    $scope.getRoisDetails(true).then(function () {\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        $scope.markBoxesAsSelected();\n        $scope.updateInputState();\n      }, 100);\n    });\n  };\n\n  $scope.setCurrentPage = function () {\n    this.paginationSettings.offset = $scope.paginationSettings.page - 1;\n    $scope.getRoisDetails();\n  };\n\n  $scope.showPagination = function () {\n    return $scope.paginationSettings.totalItems && $scope.paginationSettings.totalItems > $scope.paginationSettings.limit;\n  };\n\n  $scope.getRoisDetails = function (isFilterChanged) {\n    if (!$scope.aedData.id.length) {\n      return $scope.getStatusForEmptyData();\n    }\n\n    $scope.rows = [];\n    var aedData;\n    $scope.isRoisLoading = true;\n\n    if (isFilterChanged) {\n      $scope.paginationSettings.page = 1;\n      $scope.paginationSettings.offset = 0;\n    }\n\n    $scope.paginationSettings.limit = 100;\n    $scope.paginationSettings.totalItems = $scope.aedData.id.length;\n    aedData = $scope.aedData.id.filter(function (id, i, a) {\n      return i >= $scope.paginationSettings.offset * $scope.paginationSettings.limit && i < $scope.paginationSettings.page * $scope.paginationSettings.limit;\n    });\n    return a2ClusteringJobs.getRoisDetails({\n      jobId: $scope.clusteringJobId,\n      aed: aedData,\n      search: $scope.selectedFilterData.value\n    }).then(function (data) {\n      const groupedData = [];\n      Object.values($scope.gridData).forEach(function (cluster) {\n        Object.entries(cluster).forEach(function (entry) {\n          if (entry[0] == \"aed\") {\n            entry[1].forEach(function (id) {\n              const matched = data.find(function (aed) {\n                return aed.aed_id === id;\n              });\n\n              if (matched) {\n                matched.cluster = cluster.name;\n                groupedData.push(matched);\n              }\n            });\n          }\n        });\n      });\n      $scope.paginationSettings.totalPages = Math.ceil($scope.paginationSettings.totalItems / $scope.paginationSettings.limit);\n      $scope.paginationSettings.limit = 100;\n      $scope.loading = false;\n      $scope.allRois = groupedData;\n      $scope.isRoisLoading = false;\n      $scope.getRoisDetailsSegment();\n      $scope.combineRoisPerCluster();\n    }).catch(function (err) {\n      console.log(err);\n      $scope.getStatusForEmptyData();\n    });\n  };\n\n  $scope.getRoisDetails();\n\n  $scope.combineRoisPerCluster = function () {\n    $scope.roisPerCluster = {};\n    $scope.gridData.forEach(function (cluster) {\n      $scope.roisPerCluster[cluster.name] = cluster.aed;\n    });\n  };\n\n  $scope.exportReport = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to download Clustering details');\n      return;\n    }\n\n    var params = {\n      jobId: $scope.clusteringJobId,\n      aed: $scope.aedData.id,\n      cluster: $scope.roisPerCluster,\n      search: $scope.selectedFilterData.value,\n      userEmail: a2UserPermit.getUserEmail() || ''\n    };\n\n    if ($scope.selectedFilterData.value == 'per_site') {\n      params.perSite = true;\n    } else if ($scope.selectedFilterData.value == 'per_date') {\n      params.perDate = true;\n    } else params.all = true;\n\n    $scope.openExportPopup(params);\n  };\n\n  $scope.openExportPopup = function (listParams) {\n    const modalInstance = $modal.open({\n      controller: 'ExportReportModalCtrl',\n      templateUrl: '/app/analysis/clustering-jobs/export-report.html',\n      resolve: {\n        data: function () {\n          return listParams;\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function () {\n      notify.log('Your report export request is processing <br> and will be sent by email.');\n    });\n  };\n\n  $scope.getStatusForEmptyData = function () {\n    $scope.loading = false;\n    $scope.isRoisLoading = false;\n    $scope.infopanedata = 'No data for clustering job found.';\n  };\n\n  $scope.getRoisDetailsSegment = function () {\n    const data = $scope.allRois;\n\n    if (data && $scope.selectedFilterData.value === 'per_site') {\n      var sites = {};\n      data.forEach(function (item) {\n        if (!sites[item.site_id]) {\n          sites[item.site_id] = {\n            id: item.site_id,\n            site: item.site,\n            species: [item]\n          };\n        } else {\n          sites[item.site_id].species.push(item);\n        }\n      });\n      const rows = Object.values(sites).map(function (site) {\n        return {\n          id: site.id,\n          site: site.site,\n          species: $scope.groupRoisBySpecies(site.species)\n        };\n      });\n      $scope.rows = rows;\n    } else if (data && $scope.selectedFilterData.value === 'per_cluster') {\n      $scope.ids = {};\n\n      if ($scope.aedData.count > 1) {\n        var grids = [];\n        $scope.gridData.forEach(function (row) {\n          grids.push([row]);\n        });\n        grids.forEach(function (row, index) {\n          $scope.ids[index] = {\n            id: row[0].cluster || row[0].name,\n            cluster: row[0].cluster || row[0].name,\n            species: $scope.groupRoisBySpecies(data, row[0].aed)\n          };\n        });\n      } else {\n        $scope.ids[0] = {\n          id: $scope.gridData[0].cluster || $scope.gridData[0].name,\n          cluster: $scope.gridData[0].cluster || $scope.gridData[0].name,\n          species: $scope.groupRoisBySpecies(data)\n        };\n      }\n\n      $scope.rows = Object.values($scope.ids);\n    } else if (data && $scope.selectedFilterData.value === 'per_species') {\n      var speciesObj = {};\n      data.forEach(function (roi) {\n        if (!speciesObj[roi.species_id]) {\n          speciesObj[roi.species_id] = {\n            id: roi.species_id,\n            speciesName: roi.scientific_name,\n            species: [roi]\n          };\n        } else {\n          speciesObj[roi.species_id].species.push(roi);\n        }\n      });\n      const rows = Object.values(speciesObj).map(function (row) {\n        return {\n          id: row.id,\n          speciesName: row.speciesName || 'Unvalidated ROIs',\n          species: $scope.groupRoisBySpecies(row.species)\n        };\n      });\n      $scope.rows = rows;\n    } else {\n      if ($scope.selectedFilterData.value === 'per_date') {\n        data.sort(function (a, b) {\n          return a.date_created < b.date_created ? 1 : -1;\n        });\n      }\n\n      $scope.rows = [];\n      $scope.rows.push({\n        species: [{\n          rois: data\n        }]\n      });\n    }\n  };\n\n  $scope.groupRoisBySpecies = function (data, aeds) {\n    const rois = aeds ? data.filter(function (a, i) {\n      return aeds.includes(a.aed_id);\n    }) : data;\n    var species = {};\n    rois.forEach(function (item) {\n      const key = item.scientific_name ? item.scientific_name + '-' + item.songtype : 'Unvalidated ROIs';\n\n      if (!species[key]) {\n        species[key] = {\n          key: key,\n          rois: [item]\n        };\n      } else {\n        species[key].rois.push(item);\n      }\n    });\n    return Object.values(species);\n  };\n\n  $scope.playRoiAudio = function (recId, aedId, $event) {\n    if ($event) {\n      $event.preventDefault();\n      $event.stopPropagation();\n    }\n\n    a2AudioBarService.loadUrl(a2ClusteringJobs.getAudioUrlFor(recId, aedId), true);\n  };\n\n  $scope.getRoiVisualizerUrl = function (roi) {\n    var projecturl = Project.getUrl();\n    var box = ['box', roi.time_min, roi.frequency_min, roi.time_max, roi.frequency_max].join(',');\n    return roi ? '/project/' + projecturl + '/#/visualizer/rec/' + roi.recording_id + '?a=' + box : '';\n  };\n\n  $scope.togglePopup = function () {\n    $scope.isPopupOpened = !$scope.isPopupOpened;\n  };\n\n  $scope.toggleBoxSize = function () {\n    $scope.isSquareSize = !$scope.isSquareSize;\n  };\n\n  $scope.isPlaylistDataValid = function () {\n    return $scope.selectedRois && $scope.selectedRois.length && $scope.playlistData.playlistName && $scope.playlistData.playlistName.trim().length > 0;\n  };\n\n  $scope.closePopup = function () {\n    $scope.isPopupOpened = false;\n  };\n\n  $scope.savePlaylist = function () {\n    if ($scope.selectedRois.length) {\n      $scope.isSavingPlaylist = true; // Create a new playlist with aed boxes.\n\n      a2Playlists.create({\n        playlist_name: $scope.playlistData.playlistName,\n        params: $scope.selectedRois,\n        recIdsIncluded: true\n      }, function (data) {\n        $scope.isSavingPlaylist = false;\n        $scope.closePopup(); // Attach aed to the new playlist.\n\n        if (data && data.playlist_id) {\n          a2Playlists.attachAedToPlaylist({\n            playlist_id: data.playlist_id,\n            aed: $scope.selectedRois\n          }, function (data) {\n            $scope.playlistData = {};\n            notify.log('Audio event detections are saved in the playlist. <br> Navigates to the Visualizer page to see Audio Event boxes on the spectrogram');\n          });\n        }\n      });\n    }\n  };\n\n  $scope.isValidationAccessible = function () {\n    return a2UserPermit.can('manage AED and Clustering job');\n  };\n\n  $scope.setValidation = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to manage AED and Clustering job');\n      return;\n    }\n\n    if ($scope.validation.status.value === 1 && (!$scope.selected.species || !$scope.selected.songtype)) {\n      notify.error('Please select Species and Song type <br> to validate ROIs with the Present validation');\n      return;\n    }\n\n    if ($scope.validation.status.value === 0 && (!$scope.selected.species || !$scope.selected.songtype)) {\n      notify.error('Please select Species and Song type <br> to validate ROIs with the Absent validation');\n      return;\n    }\n\n    $scope.speciesLoading = true;\n    var opts = {\n      aed: $scope.selectedRois,\n      validated: $scope.validation.status.value\n    };\n    const isClearValidation = $scope.validation.status.value === -1;\n    opts.species_name = isClearValidation ? null : $scope.selected.species.scientific_name;\n    opts.songtype_name = isClearValidation ? null : $scope.selected.songtype.name;\n    opts.species_id = isClearValidation ? null : $scope.selected.species.id;\n    opts.songtype_id = isClearValidation ? null : $scope.selected.songtype.id;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      a2AudioEventDetectionsClustering.validate(opts).then(function (data) {\n        console.info('Validation result', data); // Unselect and mark boxes with current validation without reloading the page\n\n        $scope.markBoxesWithCurrentValidation();\n        $scope.unselectBoxes();\n        $scope.selectedRois = [];\n\n        if ($scope.validation.status.value === 1) {\n          notify.log('Audio event detections are validated as ' + $scope.selected.species.scientific_name + ' ' + $scope.selected.songtype.name);\n        }\n\n        $scope.selected = {\n          species: null,\n          songtype: null\n        };\n        $scope.updateInputState();\n        $scope.getRoisDetails();\n      }).finally(function () {\n        $scope.speciesLoading = false;\n      });\n    }, 500);\n  };\n\n  $scope.markBoxesWithCurrentValidation = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if ($scope.selectedRois.includes(roi.aed_id)) {\n            roi.validated = $scope.validation.status.value;\n          }\n        });\n      });\n    });\n  };\n\n  $scope.unselectBoxes = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if (roi.selected) {\n            roi.selected = false;\n          }\n        });\n      });\n    });\n  };\n\n  $scope.markBoxesAsSelected = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if ($scope.selectedRois.includes(roi.aed_id)) {\n            roi.selected = true;\n          }\n        });\n      });\n    });\n  };\n\n  Songtypes.get(function (songs) {\n    $scope.songtypes = songs;\n  });\n\n  $scope.searchSpecies = function (search) {\n    $scope.selected.songtype = null;\n    $scope.speciesLoading = true;\n    return $http.get('/api/species/search', {\n      params: {\n        q: search\n      }\n    }).then(function (result) {\n      $scope.speciesLoading = false;\n      return result.data;\n    });\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    var scrollPos = $controller.scrollElement.scrollY;\n    var headerTop = $controller.anchors.header.offset().top;\n    this.headerTop = headerTop | 0;\n    this.scrolledPastHeader = scrollPos > headerTop;\n  };\n\n  var getSelectedDetectionIds = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if (roi.selected === true && !$scope.selectedRois.includes(roi.aed_id)) {\n            $scope.selectedRois.push(roi.aed_id);\n          }\n\n          if (roi.selected === false && $scope.selectedRois.includes(roi.aed_id)) {\n            const index = $scope.selectedRois.findIndex(function (item) {\n              return item === roi.aed_id;\n            });\n            $scope.selectedRois.splice(index, 1);\n          }\n        });\n      });\n    });\n    return $scope.selectedRois;\n  };\n\n  $scope.selectCluster = function (cluster) {\n    const isSelected = cluster.selected;\n    cluster.rois = cluster.rois.map(function (roi) {\n      roi.selected = isSelected === true ? true : false;\n      return roi;\n    });\n    $scope.selectedRois = getSelectedDetectionIds();\n    $scope.updateInputState();\n  };\n\n  var getCombinedDetections = function () {\n    var combinedDetections = [];\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        combinedDetections = combinedDetections.concat(cluster.rois);\n      });\n    });\n    return combinedDetections;\n  }; // Selection with a shift key\n\n\n  $scope.toggleDetection = function (event) {\n    isShiftKeyHolding = event.shiftKey;\n\n    if (isShiftKeyHolding) {\n      const combinedDetections = getCombinedDetections();\n      const selectedDetectionIds = getSelectedDetectionIds();\n      const firstInx = combinedDetections.findIndex(function (d) {\n        return d.aed_id === selectedDetectionIds[0];\n      });\n      const secondInx = combinedDetections.findIndex(function (det) {\n        return det.aed_id === selectedDetectionIds[selectedDetectionIds.length - 1];\n      });\n      const arrayOfIndx = [firstInx, secondInx].sort(function (a, b) {\n        return a - b;\n      });\n      const filteredDetections = combinedDetections.filter(function (_det, index) {\n        return index >= arrayOfIndx[0] && index <= arrayOfIndx[1];\n      });\n      const ids = filteredDetections.map(function (det) {\n        return det.aed_id;\n      });\n      $scope.rows.forEach(function (row) {\n        row.species.forEach(function (cluster) {\n          cluster.rois.forEach(function (roi) {\n            if (ids.includes(roi.aed_id)) {\n              roi.selected = true;\n            }\n          });\n        });\n      });\n    }\n\n    $scope.selectedRois = getSelectedDetectionIds();\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      $scope.updateInputState();\n    }, 100);\n  }; // Set cluster's input state\n\n\n  $scope.updateInputState = function () {\n    const inputs = document.querySelectorAll(\"[id^='inputCluster_']\");\n    if (!inputs.length) return;\n    var index = 0;\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        const selectedRois = cluster.rois.filter(function (roi) {\n          return roi.selected;\n        });\n\n        if (!selectedRois.length) {\n          inputs[index].checked = false;\n          inputs[index].indeterminate = false;\n        } else if (selectedRois.length === cluster.rois.length) {\n          inputs[index].indeterminate = false;\n          inputs[index].checked = true;\n        } else {\n          inputs[index].checked = false;\n          inputs[index].indeterminate = true;\n        }\n\n        index++;\n      });\n    });\n  };\n});","angular.module('a2.analysis.patternmatching', ['ui.bootstrap', 'a2.directive.audio-bar', 'a2.srv.patternmatching', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.disabled-patternmatching', {\n    url: '/disabled/patternmatching',\n    templateUrl: '/app/analysis/patternmatching/disabled.html'\n  });\n  $stateProvider.state('analysis.patternmatching', {\n    url: '/patternmatching',\n    controller: 'PatternMatchingCtrl',\n    templateUrl: '/app/analysis/patternmatching/list.html'\n  });\n  $stateProvider.state('analysis.patternmatching-details', {\n    url: '/patternmatching/:patternMatchingId',\n    controller: 'PatternMatchingCtrl',\n    templateUrl: '/app/analysis/patternmatching/list.html'\n  });\n}).controller('PatternMatchingCtrl', function ($scope, $modal, JobsData, $location, notify, $q, a2PatternMatching, a2UserPermit, $state, $stateParams, Project) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n  $scope.loading = {\n    rows: false,\n    showRefreshBtn: false\n  };\n  $scope.paginationSettings = {\n    page: 1,\n    limit: 10,\n    offset: 0,\n    totalJobs: 0,\n    totalPages: 0\n  };\n  $scope.search = {\n    q: ''\n  };\n  var timeout;\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box;\n\n    if (template && template.x1) {\n      box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    }\n\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $scope.selectedPatternMatchingId = patternmatchingId;\n\n    if (!patternmatchingId) {\n      $state.go('analysis.patternmatching', {});\n    } else {\n      $state.go('analysis.patternmatching-details', {\n        patternMatchingId: patternmatchingId\n      });\n    }\n  };\n\n  $scope.setCurrentPage = function () {\n    this.paginationSettings.offset = $scope.paginationSettings.page - 1;\n    $scope.loadPatternMatchings();\n  };\n\n  $scope.update = function (patternMatching, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to edit pattern matchings');\n      return;\n    }\n\n    $scope.pmName = patternMatching.name;\n    const modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/edit-patternmatching.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function (name) {\n      a2PatternMatching.update(patternMatching.id, {\n        name: name\n      }).then(function () {\n        $scope.loadPatternMatchings();\n      });\n    });\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading.rows = true;\n    $scope.showInfo = true;\n    $scope.splitAllSites = false;\n    return a2PatternMatching.list({\n      completed: true,\n      q: $scope.search.q,\n      limit: $scope.paginationSettings.limit,\n      offset: $scope.paginationSettings.offset * $scope.paginationSettings.limit\n    }).then(function (data) {\n      $scope.patternmatchingsOriginal = data.list;\n      $scope.patternmatchingsData = data.list;\n      $scope.paginationSettings.totalJobs = data.count;\n      $scope.paginationSettings.totalPages = Math.ceil($scope.paginationSettings.totalJobs / $scope.paginationSettings.limit);\n      $scope.showInfo = false;\n      $scope.loading.rows = false;\n\n      if (data && data.list.length) {\n        $scope.loading.showRefreshBtn = true;\n      }\n    });\n  };\n\n  $scope.onFilterChanged = function () {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      if ($scope.search.q.trim().length > 0 && $scope.search.q.trim().length < 4) return;\n      $scope.resetPagination();\n      $scope.loadPatternMatchings();\n    }, 1000);\n  };\n\n  $scope.isShowSearch = function () {\n    return $scope.patternmatchingsData && $scope.patternmatchingsData.length || $scope.search.q.trim().length > 0;\n  };\n\n  $scope.resetPagination = function () {\n    $scope.paginationSettings.page = 1;\n    $scope.paginationSettings.offset = 0;\n    $scope.paginationSettings.totalJobs = 0;\n    $scope.paginationSettings.totalPages = 0;\n  };\n\n  $scope.createNewPatternMatching = function () {\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to create pattern matchings');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/createnewpatternmatching.html',\n      controller: 'CreateNewPatternMatchingInstanceCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        $scope.loading.showRefreshBtn = true;\n        notify.log(\"Your new pattern matching is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deletePatternMatching = function (patternMatching, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to delete pattern matchings');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/deletepatternmatching.html',\n      controller: 'DeletePatternMatchingInstanceCtrl as controller',\n      resolve: {\n        patternMatching: function () {\n          return patternMatching;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.patternmatchingsOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].id === patternMatching.id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.patternmatchingsOriginal.splice(index, 1);\n          notify.log(\"PatternMatching deleted successfully\");\n        }\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2PatternMatchingDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'PatternMatchingDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/patternmatching/details.html'\n  };\n}).controller('PatternMatchingDetailsCtrl', function ($scope, $q, a2PatternMatching, a2Templates, a2UserPermit, Project, a2AudioBarService, notify, $anchorScroll, $modal) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 1\n      };\n      this.sitesList = [];\n      this.sitesListBatchSize = 20;\n      this.sitesBatches = [];\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.paginationTotal = 0;\n      this.loading = {\n        details: false,\n        rois: true\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.search = this.lists.search[6];\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        return this.loadSitesList();\n      }.bind(this)).then(function () {\n        return this.loadData(1);\n      }.bind(this));\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      search: [{\n        value: 'all',\n        text: 'All',\n        description: 'Show all matched Region of Interest.'\n      }, {\n        value: 'present',\n        text: 'Present',\n        description: 'Show all Region of Interest marked as present.'\n      }, {\n        value: 'not_present',\n        text: 'Not Present',\n        description: 'Show all Region of Interest marked as not present.'\n      }, {\n        value: 'unvalidated',\n        text: 'Unvalidated',\n        description: 'Show all Region of Interest without validation.'\n      }, {\n        value: 'best_per_site',\n        text: 'Best per Site',\n        description: 'Show the best scored roi per site.'\n      }, {\n        value: 'best_per_site_day',\n        text: 'Best per Site, Day',\n        description: 'Show the best scored roi per site and day.'\n      }, {\n        value: 'by_score',\n        text: 'Score',\n        description: 'Show all Region of Interest ranked by score.'\n      }, {\n        value: 'by_score_per_site',\n        text: 'Score per Site',\n        description: 'Show all Region of Interest ranked by score per site.'\n      }, {\n        value: 'top_200_per_site',\n        text: '200 Top Scores per Site',\n        description: 'Show Top 200 Region of Interest ranked by score per each site.'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      }, {\n        value: 'not-validated',\n        text: 'Not Validated'\n      }],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2PatternMatching.getDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.patternMatching.templateParameters = {\n          'Threshold': this.patternMatching.parameters.threshold,\n          'Matches/Recording': this.patternMatching.parameters.N,\n          'Matches/Site': this.patternMatching.parameters.persite || 'no limit'\n        };\n        this.total = {\n          rois: patternMatching.matches,\n          pages: Math.ceil(patternMatching.matches / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    onSearchChanged: function () {\n      this.selected.page = 1;\n      this.recalculateSiteListBatch();\n      this.loadData(1);\n    },\n    update: function (patternMatching, $event) {\n      const self = this;\n      $event.stopPropagation();\n\n      if (!a2UserPermit.can('manage pattern matchings')) {\n        notify.error('You do not have permission to edit pattern matchings');\n        return;\n      }\n\n      $scope.pmName = patternMatching.name;\n      const modalInstance = $modal.open({\n        templateUrl: '/app/analysis/patternmatching/edit-patternmatching.html',\n        scope: $scope\n      });\n      modalInstance.result.then(function (name) {\n        a2PatternMatching.update(patternMatching.id, {\n          name: name\n        }).then(function () {\n          patternMatching.name = name;\n        });\n      });\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2PatternMatching.getExportUrl({\n        patternMatching: this.patternMatching.id,\n        jobName: encodeURIComponent(this.patternMatching.name)\n      });\n    },\n    exportPmReport: function ($event) {\n      $event.stopPropagation();\n      if (a2UserPermit.isSuper()) return this.setupExportUrl();\n\n      if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n        return notify.error('You do not have permission to export Pattern Matching data');\n      } else return this.setupExportUrl();\n    },\n    onScroll: function ($event, $controller) {\n      if (this.search.value === 'by_score_per_site') {\n        return false;\n      }\n\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadSitesList: function () {\n      return a2PatternMatching.getSitesListFor(this.id).then(function (list) {\n        this.sitesList = list;\n        this.sitesTotal = this.sitesBatches.length;\n        this.splitSitesListIntoBatches();\n      }.bind(this));\n    },\n    splitSitesListIntoBatches: function () {\n      var batches = [];\n\n      for (var i = 0; i < this.sitesList.length; i += this.sitesListBatchSize) {\n        batches.push(this.sitesList.slice(i, i + this.sitesListBatchSize));\n      }\n\n      this.sitesBatches = batches;\n    },\n    getCountPerSite: function () {\n      return this.rois && this.rois[0] && this.rois[0].list[0].countPerSite;\n    },\n    recalculateTotalItems: function () {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n\n      switch (search) {\n        case 'present':\n          this.paginationTotal = this.patternMatching.present;\n          break;\n\n        case 'not_present':\n          this.paginationTotal = this.patternMatching.absent;\n          break;\n\n        case 'by_score':\n          this.paginationTotal = this.patternMatching.matches;\n          break;\n\n        case 'by_score_per_site':\n          this.paginationTotal = this.getCountPerSite();\n          break;\n\n        default:\n          this.paginationTotal = 0;\n      }\n    },\n    recalculateSiteListBatch: function () {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      var shouldRecalculate = false;\n\n      if (['all', 'unvalidated', 'top_200_per_site', 'by_score_per_site'].includes(search)) {\n        if (this.sitesListBatchSize !== 1) {\n          shouldRecalculate = true;\n        }\n\n        this.sitesListBatchSize = 1;\n      } else if (['best_per_site', 'best_per_site_day'].includes(search)) {\n        if (this.sitesListBatchSize !== 10) {\n          shouldRecalculate = true;\n        }\n\n        this.sitesListBatchSize = 10;\n      }\n\n      if (shouldRecalculate) {\n        this.splitSitesListIntoBatches();\n      }\n    },\n    setSiteBookmark: function (site) {\n      const scorePerSite = this.search.value === 'by_score_per_site';\n\n      if (this.shouldGetPerSite() || scorePerSite) {\n        this.selected.page = scorePerSite ? 1 : this.getSiteBatchIndexBySiteId(site.site_id) + 1;\n        return this.loadData();\n      }\n\n      var bookmark = 'site-' + site.site_id;\n      $anchorScroll.yOffset = $('.a2-page-header').height() + 60;\n      $anchorScroll(bookmark);\n    },\n    shouldGetPerSite: function () {\n      return this.search && ['all', 'unvalidated', 'top_200_per_site', 'best_per_site', 'best_per_site_day'].includes(this.search.value);\n    },\n    getSiteBatchIndexBySiteId: function (siteId) {\n      if (!this.sitesBatches || !this.sitesBatches.length) {\n        return undefined;\n      }\n\n      return this.sitesBatches.findIndex(function (batch) {\n        return !!batch.find(function (site) {\n          return site.site_id === siteId;\n        });\n      });\n    },\n    getSiteBatchBySiteId: function (siteId) {\n      const batchIndex = this.getSiteBatchIndexBySiteId(siteId);\n\n      if (batchIndex === undefined) {\n        return undefined;\n      }\n\n      return this.sitesBatches[batchIndex];\n    },\n    getSiteBatchByPageNumber: function (page) {\n      if (!this.sitesBatches || !this.sitesBatches.length) {\n        return undefined;\n      }\n\n      return this.sitesBatches[page - 1];\n    },\n    combOpts: function (data) {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      var opts = {\n        search: search\n      };\n\n      if (data.site) {\n        opts.site = data.site;\n      }\n\n      if (data.sites) {\n        opts.sites = data.sites;\n      }\n\n      var limit, offset;\n      const doubleLimit = 200;\n      const offsetCalc = offset = (data.pageNumber - 1) * this.limit;\n\n      switch (search) {\n        case 'top_200_per_site':\n          limit = doubleLimit;\n          offset = 0;\n          break;\n\n        case 'best_per_site':\n          limit = 1;\n          offset = 0;\n          break;\n\n        case 'all':\n        case 'unvalidated':\n          limit = 100000000;\n          offset = 0;\n          break;\n\n        default:\n          limit = this.limit;\n          offset = offsetCalc;\n      }\n\n      return {\n        limit: limit,\n        offset: offset,\n        opts: opts\n      };\n    },\n    parseRoisResult: function (rois) {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      this.splitAllSites = search === 'by_score';\n\n      if (this.splitAllSites) {\n        return [{\n          list: rois\n        }];\n      } else {\n        return rois.reduce(function (_, roi) {\n          var site_id = roi.site_id;\n          var sitename = roi.site;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename,\n              id: site_id\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n      }\n    },\n    loadData: function (page) {\n      var params;\n\n      if (this.search.value === 'by_score_per_site') {\n        const site = this.selected.siteBookmark ? this.selected.siteBookmark.site_id : this.sitesBatches[0][0].site_id;\n        params = this.combOpts({\n          sites: site,\n          pageNumber: this.selected.page\n        });\n      } else if (this.shouldGetPerSite()) {\n        page = page || this.selected.page;\n        var siteBatch = this.getSiteBatchByPageNumber(page);\n        var siteIds = siteBatch.map(function (s) {\n          return s.site_id;\n        });\n        params = this.combOpts({\n          sites: siteIds\n        });\n      } else {\n        params = this.combOpts({\n          pageNumber: this.selected.page\n        });\n      }\n\n      this.rois = [];\n      this.loading.rois = true;\n      return a2PatternMatching.getRoisFor(this.id, params.limit, params.offset, params.opts).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = this.parseRoisResult(rois);\n        this.selected.roi = Math.min();\n        this.recalculateTotalItems();\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      console.info('play');\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 1;\n        this.rois = [];\n        return $q.resolve(this.rois);\n      } else {\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadData(page);\n        }\n      }\n\n      return $q.resolve();\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('validate pattern matchings')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        0: 0,\n        1: 0,\n        null: 0\n      };\n      var cls = {\n        species: this.patternMatching.species_name,\n        songtype: this.patternMatching.songtype_name\n      };\n      return a2PatternMatching.validateRois(this.id, roiIds, validation, cls).then(function () {\n        rois.forEach(function (roi) {\n          val_delta[roi.validated] -= 1;\n          val_delta[validation] += 1;\n          roi.validated = validation;\n          roi.selected = false;\n        });\n        this.patternMatching.absent += val_delta[0];\n        this.patternMatching.present += val_delta[1];\n      }.bind(this));\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n}).controller('DeletePatternMatchingInstanceCtrl', function ($scope, $modalInstance, a2PatternMatching, patternMatching) {\n  this.patternMatching = patternMatching;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2PatternMatching.delete(patternMatching.id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewPatternMatchingInstanceCtrl', function ($modalInstance, a2PatternMatching, a2Templates, a2Playlists, notify) {\n  var self = this;\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false,\n        templates: false,\n        createPatternMatching: false\n      };\n      this.data = {\n        name: null,\n        playlist: null,\n        template: null,\n        params: {\n          N: 1,\n          threshold: 0.3\n        }\n      };\n      this.list = {};\n      this.loading = {\n        templates: true,\n        playlists: true\n      };\n      this.isSaving = false;\n      this.warningMessage = 'Warning: Large playlist (500,000+ recordings). Save resources by reducing playlist size.';\n      this.getTemplates();\n      this.getPlaylists();\n    },\n    getTemplates: function () {\n      self.loading.templates = true;\n      return a2Templates.getList().then(function (templates) {\n        self.loading = false;\n        self.list.templates = templates.filter(function (t) {\n          return !t.disabled;\n        });\n      }.bind(this)).catch(function (err) {\n        self.loading = false;\n        self.list.templates = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    getPlaylists: function () {\n      self.loading.playlists = true;\n      return a2Playlists.getList().then(function (playlists) {\n        self.playlists = false;\n        self.list.playlists = playlists;\n      }.bind(this)).catch(function (err) {\n        self.playlists = false;\n        self.list.playlists = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    ok: function () {\n      if (self.data.playlist.count === 0) {\n        return notify.error('Note: The playlist should not be empty.');\n      }\n\n      self.isSaving = true;\n      return a2PatternMatching.create({\n        name: self.data.name,\n        playlist: self.data.playlist.id,\n        template: self.data.template.id,\n        params: self.data.params\n      }).then(function (patternMatching) {\n        self.isSaving = false;\n        $modalInstance.close({\n          ok: true,\n          patternMatching: patternMatching\n        });\n      }).catch(function (err) {\n        console.log('err', err);\n        self.isSaving = false;\n        notify.error(err);\n      });\n    },\n    isJobValid: function () {\n      return self.data && self.data.name && self.data.name.length > 3 && self.data.playlist && self.data.template;\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isWarningMessage: function () {\n      return this.data.playlist && this.data.playlist.count > 500000;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.analysis.random-forest-models', ['ui.router', 'a2.analysis.random-forest-models.models', 'a2.analysis.random-forest-models.classification']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models', {\n    url: '/random-forest-models',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.audiodata.playlists.playlist-arithmetic', []).directive('playlistArithmetic', function (a2Playlists) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/playlists/playlist-arithmetic.html',\n    scope: {\n      onExpressionSelected: '&'\n    },\n    controller: 'playlistArithmeticController as controller',\n    requires: '^PlaylistCtrl',\n    link: function (scope, element, attrs) {\n      var controller = scope.controller;\n      controller.initialize({\n        onSelected: function (expression) {\n          scope.onExpressionSelected({\n            expression: expression\n          });\n        }\n      });\n      scope.$on('$destroy', function () {\n        controller.$destroy();\n      });\n    }\n  };\n}).controller('playlistArithmeticController', function (a2Playlists, $interpolate) {\n  this.selected = {};\n  this.operations = [{\n    type: 'union',\n    text: 'Join playlist 1 and 2',\n    icon: 'a2-union',\n    nameTemplate: '{{playlist1}} joined with {{playlist2}}'\n  }, {\n    type: 'intersection',\n    text: 'Intersect playlist 1 and 2',\n    icon: 'a2-intersect',\n    nameTemplate: '{{playlist1}} intersected with {{playlist2}}'\n  }, {\n    type: 'subtraction',\n    text: 'Remove playlist 2 from playlist 1',\n    icon: 'a2-difference',\n    nameTemplate: '{{playlist1}} minus {{playlist2}}'\n  }];\n  var removeOnInvalidateHandler;\n\n  this.initialize = function (options) {\n    this.options = options || {};\n    removeOnInvalidateHandler = a2Playlists.$on('invalidate-list', function () {\n      this.reset();\n    }.bind(this));\n    this.reset();\n    this.updateNamePlaceholder();\n  };\n\n  this.reset = function () {\n    return a2Playlists.getList().then(function (playlists) {\n      this.playlists = playlists;\n    }.bind(this));\n  };\n\n  this.$destroy = function () {\n    removeOnInvalidateHandler();\n  };\n\n  this.updateNamePlaceholder = function () {\n    var nameTemplate = (this.selected.operation || {}).nameTemplate || 'Playlist 3';\n    var term1 = this.selected.term1 || {};\n    var term2 = this.selected.term2 || {};\n    this.namePlaceholder = $interpolate(nameTemplate)({\n      playlist1: term1.name || '(playlist 1)',\n      playlist2: term2.name || '(playlist 2)'\n    });\n  };\n\n  this.submit = function () {\n    var operation = this.selected.operation;\n    var term1 = this.selected.term1;\n    var term2 = this.selected.term2;\n    var name = this.selected.name || this.namePlaceholder;\n\n    if (operation && term1 && term2 && name) {\n      if (this.options.onSelected) {\n        this.options.onSelected({\n          operation: operation.type,\n          term1: term1.id,\n          term2: term2.id,\n          name: name\n        });\n      }\n    }\n  };\n});","angular.module('a2.audiodata.playlists', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.audiodata.playlists.playlist-arithmetic', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.playlists', {\n    url: '/playlists',\n    controller: 'PlaylistCtrl as controller',\n    templateUrl: '/app/audiodata/playlists/playlists.html'\n  });\n}).controller('PlaylistCtrl', function ($scope, a2Playlists, $modal, notify, a2UserPermit, $location) {\n  this.initialize = function () {\n    removeOnInvalidateHandler = a2Playlists.$on('invalidate-list', function () {\n      this.reset();\n    }.bind(this));\n    this.reset();\n  };\n\n  this.reset = function () {\n    $scope.loading = true;\n    a2Playlists.getList({\n      info: true\n    }).then(function (data) {\n      $scope.playlists = data;\n      $scope.loading = false;\n    });\n  };\n\n  this.operate = function (expression) {\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to combine playlists');\n      return;\n    }\n\n    return a2Playlists.combine(expression).then(function () {\n      notify.log('Playlist created');\n    }).catch(function (err) {\n      err = err || {};\n      notify.error(err.message || err.data || 'Server error');\n    });\n  };\n\n  this.edit = function () {\n    if (!$scope.checked.length || $scope.checked.length > 1) {\n      notify.log('Please select one playlist to edit');\n      return;\n    }\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to edit playlists');\n      return;\n    }\n\n    $scope.pname = $scope.checked[0].name;\n    const playlist_id = $scope.checked[0].id;\n    const modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/edit-playlist.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function (playlistName) {\n      a2Playlists.rename({\n        id: playlist_id,\n        name: playlistName\n      }, function (data) {\n        if (data.error) return console.log(data.error);\n      });\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.checked || !$scope.checked.length) return;\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to delete playlists');\n      return;\n    }\n\n    const playlists = $scope.checked.map(function (row) {\n      return '\"' + row.name + '\"';\n    });\n    const message = [\"You are about to delete the following playlists: \"];\n    const message2 = [\"Are you sure?\"];\n    $scope.popup = {\n      messages: message.concat(playlists, message2),\n      btnOk: \"Yes\",\n      btnCancel: \"No\"\n    };\n    const modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      const playlistIds = $scope.checked.map(function (pl) {\n        return pl.id;\n      });\n      $scope.loading = true;\n      a2Playlists.remove(playlistIds, function (data) {\n        if (data.error) return notify.error(data.error);\n        a2Playlists.getList().then(function (data) {\n          $scope.playlists = data;\n          $scope.loading = false;\n          notify.log((playlistIds.length > 1 ? 'Playlists ' : 'Playlist ') + 'deleted');\n        });\n      });\n    });\n  };\n\n  $scope.create = function (url) {\n    $location.path(url);\n  };\n\n  this.initialize();\n});","angular.module('a2.analysis.soundscapes', ['a2.services', 'a2.permissions', 'ui.bootstrap', 'ui-rangeSlider', 'ngCsv']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.soundscapes', {\n    url: '/soundscapes',\n    controller: 'SoundscapesCtrl as controller',\n    templateUrl: '/app/analysis/soundscapes/list.html'\n  });\n}).controller('SoundscapesCtrl', function ($window, $scope, $modal, $filter, Project, JobsData, ngTableParams, a2Playlists, $location, a2Soundscapes, notify, a2UserPermit) {\n  var $ = $window.$;\n  $scope.successInfo = \"\";\n  $scope.showSuccess = false;\n  $scope.errorInfo = \"\";\n  $scope.showError = false;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = true;\n  $scope.infopanedata = '';\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n    $scope.pid = data.project_id;\n    $scope.url = data.url;\n    $scope.isProjectDisabled = data.disabled === 1;\n  });\n  a2Playlists.getList().then(function (data) {\n    $scope.playlists = data;\n  });\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    $scope.tableParams = new ngTableParams({\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    }, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.soundscapesOriginal, params.filter()) : $scope.soundscapesOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.soundscapesOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No classifications found.\";\n        }\n\n        $scope.soundscapesData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Soundscapes.saveState({\n          'data': $scope.soundscapesOriginal,\n          'filtered': $scope.soundscapesData,\n          'f': params.filter(),\n          'o': params.orderBy(),\n          'p': params.page(),\n          'c': params.count(),\n          't': orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.loadSoundscapes = function () {\n    a2Soundscapes.getList2(function (data) {\n      $scope.soundscapesOriginal = data;\n      $scope.soundscapesData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+name\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No soundscapes found.\";\n      }\n    });\n  };\n\n  var stateData = a2Soundscapes.getState();\n\n  if (stateData === null) {\n    $scope.loadSoundscapes();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.soundscapesData = stateData.filtered;\n      $scope.soundscapesOriginal = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n\n  $scope.deleteSoundscape = function (id, name) {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to delete soundscapes');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/soundscapes/deletesoundscape.html',\n      controller: 'DeleteSoundscapeInstanceCtrl',\n      resolve: {\n        name: function () {\n          return name;\n        },\n        id: function () {\n          return id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.error) {\n        notify.error(\"Error: \" + ret.error);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.soundscapesOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].soundscape_id === id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.soundscapesOriginal.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Soundscape deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.createNewSoundscape = function () {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to create soundscapes');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/soundscapes/createnewsoundscape.html',\n      controller: 'CreateNewSoundscapeInstanceCtrl',\n      resolve: {\n        amplitudeReferences: function (a2Soundscapes) {\n          return a2Soundscapes.getAmplitudeReferences();\n        },\n        playlists: function () {\n          return $scope.playlists;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new soundscape is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      }\n\n      if (data.err) {\n        notify.error(data.err);\n      }\n\n      if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.showDetails = function (soundscapeId) {\n    a2Soundscapes.get(soundscapeId, function (soundscape) {\n      a2Playlists.getInfo(soundscape.playlist_id, function (plist) {\n        var modalInstance = $modal.open({\n          controller: 'SoundscapesDetailsCtrl as controller',\n          templateUrl: '/app/analysis/soundscapes/details.html',\n          resolve: {\n            soundscape: function () {\n              return soundscape;\n            },\n            playlist: function () {\n              return plist;\n            }\n          }\n        });\n      });\n    });\n  };\n\n  this.exportSoundscape = function (options) {\n    if (a2UserPermit.isSuper()) return this.getExportUrl(options);\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export soundscape data');\n    }\n\n    this.getExportUrl(options);\n  };\n\n  this.getExportUrl = function (options) {\n    a2Soundscapes.getExportUrl(options).then(function (export_url) {\n      var a = $('<a></a>').attr('target', '_blank').attr('href', export_url).appendTo('body');\n      $window.setTimeout(function () {\n        a[0].click();\n        a.remove();\n      }, 0);\n    });\n  };\n}).controller('DeleteSoundscapeInstanceCtrl', function ($scope, $modalInstance, a2Soundscapes, name, id, projectData) {\n  $scope.name = name;\n  $scope.id = id;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    a2Soundscapes.delete(id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewSoundscapeInstanceCtrl', function ($scope, $modalInstance, a2Soundscapes, $timeout, projectData, playlists) {\n  $scope.projectData = projectData;\n  $scope.playlists = playlists;\n  $scope.buttonEnableFlag = true;\n  $scope.datasubmit = {\n    name: '',\n    playlist: '',\n    aggregation: '',\n    threshold: 0,\n    thresholdReference: 'absolute',\n    bin: 86,\n    bandwidth: 0,\n    normalize: false\n  };\n  $scope.nameMsg = '';\n\n  $scope.aggregationValue = function (val) {\n    $scope.$apply(function () {\n      $scope.datasubmit.aggregation = val;\n    });\n  };\n\n  $scope.ok = function () {\n    var url = $scope.projectData.url;\n    $scope.nameMsg = '';\n    a2Soundscapes.create({\n      n: $scope.datasubmit.name,\n      p: $scope.datasubmit.playlist,\n      a: $scope.datasubmit.aggregation,\n      t: $scope.datasubmit.threshold,\n      tr: $scope.datasubmit.thresholdReference,\n      m: 22050,\n      b: $scope.datasubmit.bin,\n      f: $scope.datasubmit.bandwidth,\n      nv: $scope.datasubmit.normalize\n    }).success(function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    }).error(function (data) {\n      if (data.err) {\n        $modalInstance.close({\n          err: \"Error: \" + data.err\n        });\n      } else {\n        $modalInstance.close({\n          err: \"Error: Cannot create soundscape job\"\n        });\n      }\n    });\n  };\n\n  $scope.buttonEnable = function () {\n    return $scope.datasubmit.bin === 0 || typeof $scope.datasubmit.bin.length == 'string' || $scope.datasubmit.aggregation.length === 0 || typeof $scope.datasubmit.threshold.length == 'string' || typeof $scope.datasubmit.bandwidth.length == 'string' || $scope.datasubmit.name.length === 0 || typeof $scope.datasubmit.playlist == 'string';\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n}).directive('a2Aggregationtypeselector', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      \"selected\": \"=\"\n    },\n    templateUrl: '/app/analysis/soundscapes/aggregationtypetelector.html',\n    controller: function ($scope) {\n      $scope.aggregations = [{\n        name: 'Hour in Day',\n        scale: ['00:00', '01:00', '......', '22:00', '23:00'],\n        id: 'time_of_day'\n      }, {\n        name: 'Day in Week',\n        scale: ['Sun', 'Mon', '......', 'Fri', 'Sat'],\n        id: 'day_of_week'\n      }, {\n        name: 'Day in Month',\n        scale: ['1', '2', '......', '30', '31'],\n        id: 'day_of_month'\n      }, {\n        name: 'Month in Year',\n        scale: ['Jan', 'Feb', '......', 'Nov', 'Dec'],\n        id: 'month_in_year'\n      }, {\n        name: 'Day in Year',\n        scale: ['1', '2', '......', '365', '366'],\n        id: 'day_of_year'\n      }, {\n        name: 'Year',\n        scale: ['2010', '2011', '......', '2016', '2017'],\n        id: 'year'\n      }];\n      $scope.width = 200;\n      $scope.padding = 18;\n      $scope.height = 20;\n\n      $scope.select = function (aggr) {\n        $scope.selected = aggr.id;\n      };\n    }\n  };\n}).directive('a2DrawAggregation', function ($window) {\n  var d3 = $window.d3;\n  return {\n    restrict: 'E',\n    scope: {\n      \"aggregation\": \"=\"\n    },\n    link: function (scope, element, attrs) {\n      // console.log(scope.aggregation);\n      var draw = function (aggre) {\n        var width = 200;\n        var height = 20;\n        var padding = 18;\n        var svgContainer = d3.select(element[0]).append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n        var axisScale = d3.scale.linear().domain([0, 4]).range([padding, width - padding]);\n        var xAxis = d3.svg.axis().scale(axisScale).orient(\"bottom\").ticks(5).tickValues([0, 1, 2, 3, 4]).tickFormat(function (d) {\n          return aggre.scale[d];\n        });\n        var xAxisGroup = svgContainer.append(\"g\").attr(\"transform\", \"translate(0,1)\").attr(\"class\", \"aggregationaxis\").call(xAxis);\n      };\n\n      scope.$watch('aggregation', function (value) {\n        if (value) draw(value);\n      });\n    }\n  };\n}).directive('a2ThresholdSelector', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    scope: {\n      \"threshold\": \"=\",\n      \"thresholdReference\": \"=\",\n      \"bandwidth\": \"=\"\n    },\n    templateUrl: '/app/analysis/soundscapes/thresholdselector.html',\n    link: function ($scope) {\n      $scope.amplitudeReferences = [];\n      var afterGetAmplitudeReferences = a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n        $scope.amplitudeReferences = amplitudeReferences;\n      });\n\n      $scope.setAmplitudeReference = function (amplitudeReference) {\n        console.log(\"amplitudeReference\", amplitudeReference);\n        $scope.thresholdReference = amplitudeReference.value;\n      };\n\n      $scope.$watch('thresholdReference', function (thresholdReference) {\n        afterGetAmplitudeReferences.then(function () {\n          console.log(\"thresholdReference\", thresholdReference, $scope.amplitudeReferences);\n          $scope.amplitudeReference = $scope.amplitudeReferences.reduce(function (_, item) {\n            return _ || (item.value == thresholdReference ? item : null);\n          });\n        });\n      });\n      $scope.$watch('threshold', function (n, o) {\n        console.log('threshold', n, o);\n        $scope.thresholdInvPercent = (1 - $scope.threshold) * 100;\n      });\n      $scope.$watch('thresholdInvPercent', function (n, o) {\n        console.log('thresholdInvPercent', n, o);\n        var precision = 0.1;\n        $scope.threshold = Math.round((100 - $scope.thresholdInvPercent) / precision) / (100 / precision);\n      });\n    }\n  };\n}).directive('a2DrawPeakThreshold', function ($window) {\n  var d3 = $window.d3;\n  return {\n    restrict: 'E',\n    scope: {\n      \"threshold\": \"=\",\n      \"bandwidth\": \"=\"\n    },\n    link: function ($scope, element, attrs) {\n      var data = [0.7, 1.0, 0.1, 0.55, 0.1, 0.6, 0.9, 0.01, 0.15, 0.1, 0.4, 0.1];\n      var data_scale = 0.5;\n      var lineData = [];\n\n      for (var i = 0; i < data.length; i++) {\n        lineData.push({\n          x: i + 1,\n          y: data[i] * data_scale\n        });\n      }\n\n      var peaks = [{\n        x: 2.6,\n        y: 1.0 * data_scale,\n        d: 999999\n      }, {\n        x: 4.4,\n        y: 0.55 * data_scale,\n        d: 210\n      }, {\n        x: 7,\n        y: 0.9 * data_scale,\n        d: 520\n      }, {\n        x: 9,\n        y: 0.15 * data_scale,\n        d: 750\n      }, {\n        x: 11,\n        y: 0.4 * data_scale,\n        d: 950\n      }];\n      var WIDTH = 250,\n          HEIGHT = 70,\n          MARGINS = {\n        top: 10,\n        right: 10,\n        bottom: 10,\n        left: 24\n      };\n      var vis = d3.select(element[0]).append('svg').attr('width', WIDTH).attr('height', HEIGHT);\n      var xRange = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([d3.min(lineData, function (d) {\n        return d.x;\n      }), d3.max(lineData, function (d) {\n        return d.x;\n      })]);\n      var yRange = d3.scale.linear().domain([0, 1]).range([HEIGHT - MARGINS.top, MARGINS.bottom]);\n      var xAxis = d3.svg.axis().scale(xRange).ticks(0);\n      var yAxis = d3.svg.axis().scale(yRange).ticks(3).tickSize(3).orient('left').tickSubdivide(true);\n\n      var drawAmpThreshold = function (ampThresh) {\n        yval = 50 * (1 - ampThresh) + 10;\n        vis.selectAll(\"line.movingline\").remove();\n        $scope.line = vis.append('svg:line').attr(\"x1\", MARGINS.left).attr(\"y1\", yval).attr(\"x2\", WIDTH - MARGINS.right).attr(\"y2\", yval).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none').attr('class', 'movingline');\n        vis.selectAll(\"text.peakText\").remove();\n        var peaki = 1;\n\n        for (var i = 0; i < peaks.length; i++) {\n          if (peaks[i].y >= ampThresh && peaks[i].d >= $scope.bandwidth) {\n            $scope.peakText = vis.append(\"text\").attr(\"x\", WIDTH * (peaks[i].x / lineData.length)).attr(\"y\", 50 * (1 - peaks[i].y) + 10).attr('font-size', '11px').style(\"text-anchor\", \"middle\").attr('class', 'peakText').text(\"P\" + peaki);\n            peaki = peaki + 1;\n          }\n        }\n      };\n\n      $scope.$watch('threshold', function () {\n        if (!$scope.threshold) return;\n        drawAmpThreshold($scope.threshold);\n      });\n      $scope.$watch('bandwidth', function () {\n        // $scope.banwidthPerc = ($scope.bandwidth)/100;\n        // $scope.banwidthValue = Math.round(1000*$scope.banwidthPerc);\n        $scope.banwidthValue = $scope.bandwidth;\n        xval = Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11 + 190 * ($scope.bandwidth / 1000);\n        vis.selectAll(\"line.movingline1\").remove();\n        $scope.line = vis.append('svg:line').attr(\"x1\", xval).attr(\"y1\", 12).attr(\"x2\", xval).attr(\"y2\", 60).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none').attr('class', 'movingline1');\n        vis.selectAll(\"text.peakText\").remove();\n        var peaki = 1;\n\n        for (var i = 0; i < peaks.length; i++) {\n          if (peaks[i].y >= $scope.threshold && peaks[i].d > $scope.banwidthValue) {\n            $scope.peakText = vis.append(\"text\").attr(\"x\", WIDTH * (peaks[i].x / lineData.length)).attr(\"y\", 50 * (1 - peaks[i].y) + 10).attr('font-size', '11px').style(\"text-anchor\", \"middle\").attr('class', 'peakText').text(\"P\" + peaki);\n            peaki = peaki + 1;\n          }\n        } // $scope.onBandwidth($scope.banwidthValue);\n        // console.log($scope.banwidthValue);\n\n      });\n      vis.append('svg:g').attr('class', 'thresholdaxis').attr('transform', 'translate(0,' + (HEIGHT - MARGINS.bottom) + ')').call(xAxis);\n      vis.append('svg:g').attr('class', 'thresholdaxis').attr('transform', 'translate(' + MARGINS.left + ',0)').call(yAxis);\n      var lineFunc = d3.svg.line().x(function (d) {\n        return xRange(d.x);\n      }).y(function (d) {\n        return yRange(d.y);\n      }).interpolate('linear');\n      vis.append('svg:path').attr('d', lineFunc(lineData)).attr('stroke', 'blue').attr('stroke-width', 2).attr('fill', 'none');\n      $scope.line = vis.append('svg:line').attr(\"x1\", Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11).attr(\"y1\", 12).attr(\"x2\", Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11).attr(\"y2\", 60).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none');\n      vis.append(\"text\").attr(\"x\", WIDTH / 2).attr(\"y\", 68).attr('font-size', '9px').style(\"text-anchor\", \"middle\").text(\"Hz\");\n    }\n  };\n}).controller('SoundscapesDetailsCtrl', function ($scope, soundscape, playlist, a2Soundscapes, a2UserPermit) {\n  $scope.showDownload = a2UserPermit.can('manage soundscapes');\n\n  var data2xy = function (offset) {\n    offset = offset || 0;\n    return function (d, i) {\n      return {\n        x: i + offset,\n        y: d\n      };\n    };\n  };\n\n  $scope.soundscape = soundscape;\n  $scope.playlist = playlist;\n  $scope.chartOptions = {\n    lineColor: '#c42',\n    width: 400,\n    height: 400\n  };\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, _1) {\n      _[_1.value] = _1;\n      return _;\n    }, {});\n  }.bind(this));\n  a2Soundscapes.findIndices(soundscape.id, function (result) {\n    if (!result) return;\n    $scope.index = {\n      H: [],\n      ACI: [],\n      NP: []\n    };\n    $scope.indices = [];\n    $scope.indices.push({\n      time: \"TIME\",\n      ACI: \"ACI\",\n      NP: \"NP\"\n    });\n\n    for (var i = 0; i < result.H.length; i++) {\n      var t = i + soundscape.min_t;\n      $scope.indices.push({\n        time: t,\n        ACI: result.ACI[i],\n        NP: result.NP[i]\n      });\n      $scope.index.H.push({\n        x: t,\n        y: result.H[i]\n      });\n      $scope.index.ACI.push({\n        x: t,\n        y: result.ACI[i]\n      });\n      $scope.index.NP.push({\n        x: t,\n        y: result.NP[i]\n      });\n    }\n  });\n});","angular.module('a2.audiodata.recordings.data-export-parameters', ['a2.directive.a2-auto-close-on-outside-click', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane', 'a2.directive.error-message']).directive('recordingDataExportParameters', function ($document, $rootScope) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/recordings/export-parameters.html',\n    scope: {\n      onExport: '&'\n    },\n    controller: 'recordingDataExportParametersController as controller',\n    requires: '^RecsCtrl',\n    link: function (scope, element, attrs, controller) {\n      controller.initialize({\n        onExport: function (parameters) {\n          scope.onExport({\n            parameters: parameters\n          });\n        }\n      });\n    }\n  };\n}).service('recordingDataFieldTypes', function () {\n  return [{\n    title: 'Recording fields',\n    identifier: 'recording',\n    placeholder: 'filename, site, ...',\n    list: [{\n      value: 'filename',\n      caption: 'Filename',\n      tooltip: 'The recording filename'\n    }, {\n      value: 'site',\n      caption: 'Site',\n      tooltip: 'The recording site'\n    }, {\n      value: 'day',\n      caption: 'Day',\n      tooltip: 'The recording day'\n    }, {\n      value: 'hour',\n      caption: 'Hour',\n      tooltip: 'The recording hour'\n    }, {\n      value: 'url',\n      caption: 'Url',\n      tooltip: 'The recording URl'\n    }],\n    preselected: ['filename', 'site', 'day']\n  }, {\n    title: 'Validations by species/song type',\n    identifier: 'validation',\n    placeholder: 'Species - Sound...',\n    getList: function (Project) {\n      return Project.getClasses({\n        validations: true\n      }).then(function (classes) {\n        return classes.map(function (cls) {\n          return {\n            value: cls.id,\n            caption: cls.species_name + ' - ' + cls.songtype_name,\n            badges: [{\n              icon: 'val-1',\n              value: cls.vals_present\n            }, {\n              icon: 'val-0',\n              value: cls.vals_absent\n            }]\n          };\n        });\n      });\n    }\n  }, {\n    title: 'Soundscape Composition',\n    identifier: 'soundscapeComposition',\n    placeholder: 'Wind, Birds, ...',\n    getList: function (a2SoundscapeCompositionService) {\n      return a2SoundscapeCompositionService.getClassList({\n        isSystemClass: 1\n      }).then(function (classes) {\n        return classes.map(function (cls) {\n          return {\n            value: cls.id,\n            caption: cls.name,\n            group: cls.type\n          };\n        });\n      });\n    }\n  }, {\n    title: 'Tags',\n    identifier: 'tag',\n    placeholder: 'Tags...',\n    getList: function (a2Tags) {\n      return a2Tags.getForType('recording').then(function (tags) {\n        return tags.map(function (tag) {\n          return {\n            value: tag.tag_id,\n            caption: tag.tag,\n            icon: 'fa-tag',\n            badges: [{\n              value: tag.count\n            }]\n          };\n        });\n      }.bind(this));\n    }\n  }, {\n    title: 'Grouping of Detections',\n    identifier: 'grouped',\n    placeholder: 'Detections grouped by...',\n    list: [{\n      value: 'site',\n      caption: 'Site',\n      tooltip: 'Detections grouped by Site'\n    }, {\n      value: 'hour',\n      caption: 'Hour',\n      tooltip: 'Detections grouped by Hour'\n    }, {\n      value: 'date',\n      caption: 'Date',\n      tooltip: 'Detections grouped by Date'\n    }]\n  }, {\n    title: 'Occupancy Model Format',\n    identifier: 'species',\n    placeholder: 'Species...',\n    getList: function (Project) {\n      return Project.getClasses().then(function (classes) {\n        // Exclude classes with repeating species names\n        var cl = {};\n        classes.forEach(function (cls) {\n          const id = cls.species_name.split(' ').join('_');\n\n          if (!cl[id]) {\n            cl[id] = {\n              value: cls.species,\n              caption: cls.species_name,\n              name: id\n            };\n          }\n        });\n        return Object.values(cl);\n      });\n    }\n  }];\n}).controller('recordingDataExportParametersController', function ($q, $injector, notify, recordingDataFieldTypes, a2UserPermit) {\n  this.initialize = function (options) {\n    options = options || {};\n\n    if (options.onExport) {\n      this.onExport = options.onExport;\n    }\n\n    this.parameter_set_list = recordingDataFieldTypes;\n    this.selected = [];\n    this.lists = this.parameter_set_list.map(function () {\n      return [];\n    });\n\n    function getList(parameter_set) {\n      return $q.resolve(parameter_set.getList ? $injector.invoke(parameter_set.getList) : parameter_set.list || []);\n    }\n\n    $q.all(this.parameter_set_list.map(getList)).then(function (allLists) {\n      this.lists = allLists; // if (this.lists[1] && this.lists[1].length) {\n      //     this.lists[1].splice(0,0,{value: -1, caption: 'Select all species'});\n      // }\n\n      this.selected = this.parameter_set_list.map(function (parameter_set, idx) {\n        if (parameter_set.preselected) {\n          var listByValue = allLists[idx].reduce(function (_, item) {\n            _[item.value] = item;\n            return _;\n          }, {});\n          return (parameter_set.preselected || []).map(function (value) {\n            return listByValue[value];\n          }).filter(function (_) {\n            return !!_;\n          });\n        } else {\n          return [];\n        }\n      });\n    }.bind(this));\n  };\n\n  this.isSuper = a2UserPermit.isSuper();\n  this.isRfcxUser = a2UserPermit.isRfcx();\n  this.isRfcx = function () {\n    return this.isRfcxUser || this.isSuper;\n  }, this.checkSelectedValue = function (selected) {\n    return selected && selected.find(function (row) {\n      return row.value === -1;\n    });\n  };\n\n  this.onSelected = function (selectedItem) {\n    if (selectedItem && selectedItem.value === -1) {\n      this.selected[1] = [selectedItem];\n    }\n  };\n\n  this.resetFilters = function () {\n    this.selected = [];\n  };\n\n  this.isDisabled = function () {\n    return this.selected && this.selected[1] && this.selected[1].length && this.selected[1].length > 20;\n  };\n\n  this.isRecordingEmpty = function () {\n    return this.selected && this.selected[0] && this.selected[0].length === 0;\n  };\n\n  this.exportData = function () {\n    if (this.isRecordingEmpty()) {\n      notify.log('At least 1 recording field is required');\n      return;\n    }\n\n    var selected = this.selected; // if (selected[1] && selected[1].find(function(row){ return row.value === -1 })) {\n    //     selected[1] = this.lists[1].filter(function(item) { if (item.value !== -1) { return item } });\n    // }\n\n    this.onExport(this.parameter_set_list.reduce(function (_, parameter_set, index) {\n      if (selected[index] && selected[index].length) {\n        _[parameter_set.identifier] = selected[index].map(function (item) {\n          return item.value;\n        });\n      }\n\n      if (selected[index] && parameter_set.identifier === 'species' && selected[index].value) {\n        _[parameter_set.identifier] = selected[index].value;\n        _['species_name'] = selected[index].name;\n      }\n\n      if (selected[index] && parameter_set.identifier === 'grouped' && selected[index].value) {\n        _[parameter_set.identifier] = selected[index].value;\n        _['grouped'] = selected[index].value;\n      }\n\n      return _;\n    }, {}));\n  };\n\n  this.onExport = function (parameters) {\n    console.log(\"export parameters : \", parameters);\n  };\n});","angular.module('a2.audiodata.recordings.filter-parameters', ['a2.directive.a2-auto-close-on-outside-click', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).directive('recordingFilterParameters', function ($document, $rootScope) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/recordings/filter-parameters.html',\n    scope: {\n      isOpen: '=',\n      maxDate: '=',\n      minDate: '=',\n      recTotal: '=',\n      isLoading: '=',\n      onApplyFilters: '&'\n    },\n    controller: 'recordingFilterParametersController as controller',\n    requires: '^RecsCtrl',\n    link: function (scope, element, attrs) {\n      var controller = scope.controller;\n\n      scope.applyFilters = function () {\n        scope.onApplyFilters({\n          filters: controller.getFilters()\n        });\n      };\n\n      scope.resetFilters = function () {\n        controller.params = {};\n        scope.onApplyFilters({\n          filters: controller.getFilters()\n        });\n      };\n\n      controller.fetchOptions();\n    }\n  };\n}).controller('recordingFilterParametersController', function ($scope, Project, a2Classi, a2SoundscapeCompositionService, a2Playlists, $q, a2Tags, $window) {\n  var staticMonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map(function (mon, ind) {\n    return {\n      value: ind,\n      string: mon,\n      count: null\n    };\n  });\n  var staticDays = [];\n\n  for (var day = 1; day <= 31; day++) {\n    staticDays.push({\n      value: day,\n      count: null\n    });\n  }\n\n  var staticHours = [];\n\n  for (var hour = 0; hour < 24; hour++) {\n    staticHours.push({\n      value: hour,\n      string: (hour < 10 ? '0' : '') + hour + ':00',\n      count: null\n    });\n  }\n\n  function _1_get(attribute) {\n    return function (_1) {\n      return _1[attribute];\n    };\n  }\n\n  function _1_mapper(mapFn) {\n    return function (_1) {\n      return _1.length !== undefined && _1.map(mapFn);\n    };\n  }\n\n  var _1_get_value_mapper = _1_mapper(_1_get(\"value\"));\n\n  var _1_get_id_mapper = _1_mapper(_1_get(\"id\"));\n\n  var _1_get_tag_id_mapper = _1_mapper(_1_get(\"tag_id\"));\n\n  var _1_get_flags_mapper = _1_mapper(_1_get(\"flags\"));\n\n  var findObjectWith = function (arr, key, value) {\n    var result = arr.filter(function (obj) {\n      return obj[key] === value;\n    });\n    return result.length > 0 ? result[0] : null;\n  };\n\n  var classification_results = {\n    model_only: [{\n      caption: '<i class=\"fa a2-present\"></i> Present',\n      tooltip: 'Present',\n      flags: {\n        model: 1\n      },\n      equiv: {\n        model_th: [1, 3]\n      }\n    }, {\n      caption: '<i class=\"fa a2-absent\"></i> Absent',\n      tooltip: 'Absent',\n      flags: {\n        model: 0\n      },\n      equiv: {\n        model_th: [0, 2]\n      }\n    }],\n    model_th: [{\n      caption: 'Model: <i class=\"fa a2-present\"></i>, Th: <i class=\"fa a2-present\"></i>',\n      tooltip: 'Model: present, Theshold: present',\n      flags: {\n        model: 1,\n        th: 1\n      },\n      equiv: {\n        model_only: [1]\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-present\"></i>, Th: <i class=\"fa a2-absent\"></i>',\n      tooltip: 'Model: present, Theshold: absent',\n      flags: {\n        model: 1,\n        th: 0\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-absent\"></i>, Th: <i class=\"fa a2-present\"></i>',\n      tooltip: 'Model: absent, Theshold: present',\n      flags: {\n        model: 0,\n        th: 1\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-absent\"></i>, Th: <i class=\"fa a2-absent\"></i>',\n      tooltip: 'Model: absent, Theshold: absent',\n      flags: {\n        model: 0,\n        th: 0\n      },\n      equiv: {\n        model_only: [0]\n      }\n    }]\n  };\n  this.options = {\n    classes: [],\n    presence: ['present', 'absent'],\n    sites: [],\n    sites_ids: [],\n    playlists: [],\n    years: [],\n    months: [],\n    days: [],\n    hours: [],\n    tags: [],\n    classifications: [],\n    classification_results: classification_results.model_only,\n    soundscape_composition: [],\n    soundscape_composition_annotation: ['present', 'absent']\n  };\n  this.params = {};\n  this.loading = {\n    sites: false\n  };\n  var filterDefs = [{\n    name: \"range\",\n    map: function set_range_bounds(range) {\n      return range;\n    }\n  }, {\n    name: \"sites\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"sites_ids\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"hours\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"months\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"years\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"days\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"playlists\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"validations\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"tags\",\n    map: _1_get_tag_id_mapper\n  }, {\n    name: \"presence\"\n  }, {\n    name: \"classifications\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"classification_results\",\n    map: _1_get_flags_mapper\n  }, {\n    name: \"soundscape_composition\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"soundscape_composition_annotation\"\n  }];\n\n  this.getFilters = function () {\n    var filters = {};\n    var params = this.params;\n    filterDefs.forEach(function (filterDef) {\n      var param = params[filterDef.name];\n      var value = param && filterDef.map ? filterDef.map(param) : param;\n\n      if (value instanceof Array ? value.length : value) {\n        filters[filterDef.name] = value;\n      }\n\n      if (value && filterDef.name === 'sites') {\n        const vals = filterDefs[2].map(param);\n        filters['sites_ids'] = vals;\n      }\n    });\n    return filters;\n  };\n\n  this.getRecordingsStatsPerSite = function (sites, filters, options) {\n    var proms = sites.map(function (site) {\n      return Project.getRecordingAvailability('!q:' + site.id + '---[1:31]');\n    });\n    return $q.all(proms).then(function (data) {\n      return data.reduce(function (_, recAv) {\n        return angular.merge(_, recAv);\n      }, {});\n    }).then(function (data) {\n      // loading.sites = false\n      var lists = {\n        sites: [],\n        // sitesList\n        years: [],\n        // yearsList\n        months: [],\n        // monthsList\n        days: [],\n        // daysList\n        hours: [] // hoursList\n\n      };\n      var levelIds = Object.keys(lists);\n\n      var getFilterOptions = function (filters, obj, level) {\n        var count = 0;\n        const currentLevel = levelIds[level];\n\n        for (var child in obj) {\n          if (Object.keys(filters).length && filters[currentLevel] && filters[currentLevel].indexOf(child) === -1) {\n            // skip if filter is define and the value is not in it\n            continue;\n          }\n\n          var item = findObjectWith(lists[currentLevel], 'value', child);\n\n          if (!item) {\n            const siteObj = currentLevel == 'sites' ? sites.find(function (site) {\n              return site.name === child;\n            }) : {};\n            item = {\n              value: child,\n              count: 0\n            };\n\n            if (currentLevel == 'sites') {\n              item.id = siteObj.id;\n            }\n\n            lists[currentLevel].push(item);\n          }\n\n          var itemCount;\n\n          if (typeof obj[child] == 'number') {\n            itemCount = obj[child];\n          } else {\n            if (level === 0) count = 0;\n            itemCount = getFilterOptions(filters, obj[child], level + 1);\n          }\n\n          item.count += itemCount;\n          count += itemCount;\n        }\n\n        return count;\n      };\n\n      getFilterOptions(filters, data, 0);\n      options.sites = lists.sites;\n      options.years = lists.years;\n      options.months = lists.months.map(function (month) {\n        month.value = parseInt(month.value);\n        month.value--;\n        return {\n          value: month.value,\n          string: $window.moment().month(month.value).format('MMM'),\n          count: month.count\n        };\n      });\n      options.days = lists.days.map(function (day) {\n        day.value = parseInt(day.value);\n        return day;\n      });\n      options.hours = lists.hours.map(function (hour) {\n        hour.value = parseInt(hour.value);\n        return {\n          value: hour.value,\n          string: $window.moment().hour(hour.value).minute(0).format('HH:mm'),\n          count: hour.count\n        };\n      });\n\n      var sort = function (a, b) {\n        return a.value > b.value ? 1 : -1;\n      };\n\n      options.sites.sort(sort);\n      options.years.sort(sort);\n      options.months.sort(sort);\n      options.days.sort(sort);\n      options.hours.sort(sort);\n    });\n  };\n\n  this.setRecStatsStatic = function (sites, bounds, options) {\n    options.sites = sites.map(function (site) {\n      return {\n        value: site.name,\n        count: null,\n        id: site.id\n      };\n    });\n    var years = [];\n    var maxYear = (bounds.max ? new Date(bounds.max) : new Date()).getFullYear();\n    var minYear = bounds.min ? new Date(bounds.min).getFullYear() : '1990';\n\n    for (var year = maxYear; year >= minYear; year--) {\n      years.push({\n        value: year,\n        count: null\n      });\n    }\n\n    options.years = years;\n    options.months = staticMonths;\n    options.days = staticDays;\n    options.hours = staticHours;\n  };\n\n  this.fetchOptions = function (filters) {\n    var self = this;\n\n    if (filters === undefined) {\n      filters = {};\n    }\n\n    var options = this.options;\n    var loading = this.loading;\n    var sites;\n\n    if ($scope.recTotal === undefined || $scope.minDate === undefined || $scope.maxDate === undefined) {\n      // wait until all inputs are populated to make proper decision in a condition below\n      setTimeout(function () {\n        this.fetchOptions(filters);\n      }.bind(this), 1000);\n      return;\n    }\n\n    loading.sites = true;\n    Project.getSites().then(function (data) {\n      sites = data;\n\n      if (sites.length < 50 && $scope.recTotal < 100000) {\n        return self.getRecordingsStatsPerSite(sites, filters, options);\n      } else {\n        return self.setRecStatsStatic(sites, {\n          min: $scope.minDate.toISOString(),\n          max: $scope.maxDate.toISOString()\n        }, options);\n      }\n    }).finally(function () {\n      loading.sites = false;\n    });\n    Project.getClasses({\n      validations: true\n    }, function (classes) {\n      options.classes = classes;\n    });\n    a2Playlists.getList().then(function (playlists) {\n      options.playlists = playlists;\n    });\n    a2Tags.getForType('recording').then(function (tags) {\n      var tagsObj = {};\n      tags.forEach(function (t) {\n        var key = t.tag;\n\n        if (!tagsObj[key]) {\n          tagsObj[key] = {\n            tag: key,\n            tag_id: [t.tag_id],\n            count: t.count\n          };\n        } else {\n          tagsObj[key].tag_id.push(t.tag_id);\n          tagsObj[key].count++;\n        }\n      });\n      options.tags = Object.values(tagsObj);\n    }.bind(this));\n    a2Classi.list(function (classifications) {\n      options.classifications = classifications.map(function (c) {\n        c.name = c.cname;\n        c.id = c.job_id;\n        delete c.cname;\n        return c;\n      });\n    }.bind(this));\n    a2SoundscapeCompositionService.getClassList({\n      isSystemClass: 1\n    }).then(function (classes) {\n      options.soundscape_composition = classes;\n    }.bind(this));\n  };\n\n  this.computeClassificationResultsOptions = function (classifications) {\n    console.log(\"this.computeClassificationResults = function(classifications){\", classifications);\n    var haveThreshold = classifications && classifications.reduce(function (a, b) {\n      return a || !!b.threshold;\n    }, false);\n    var old_crs = this.options.classification_results;\n    var crs_key = haveThreshold ? 'model_th' : 'model_only';\n    var new_crs = classification_results[crs_key];\n    this.options.classification_results = new_crs;\n\n    if (old_crs != new_crs) {\n      this.params.classification_results = this.params.classification_results.reduce(function (r, cr) {\n        var equiv = cr.equiv && cr.equiv[crs_key];\n\n        if (equiv) {\n          equiv.forEach(function (i) {\n            var new_cr = new_crs[i];\n\n            if (!r.index[new_cr]) {\n              r.index[i] = 1;\n              r.list.push(new_cr);\n            }\n          });\n        }\n\n        return r;\n      }, {\n        list: [],\n        index: {}\n      }).list;\n    }\n  };\n});","angular.module('a2.audiodata.recordings', ['a2.directive.a2-auto-close-on-outside-click', 'a2.service.download-resource', 'a2.audiodata.recordings.data-export-parameters', 'a2.audiodata.recordings.filter-parameters', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.recordings', {\n    url: '/recordings',\n    controller: 'RecsCtrl as controller',\n    templateUrl: '/app/audiodata/recordings/recordings.html'\n  });\n}).controller('RecsCtrl', function ($scope, Project, a2Classi, $http, $modal, notify, a2UserPermit, $downloadResource) {\n  $scope.selectedRecId = [];\n  $scope.checkedRec = [];\n\n  this.getSearchParameters = function (output) {\n    var params = angular.merge({}, $scope.params);\n    output = output || ['list'];\n    params.output = output;\n    params.limit = $scope.limitPerPage;\n    params.offset = output.indexOf('list') >= 0 ? ($scope.currentPage - 1) * $scope.limitPerPage : 0;\n    params.sortBy = 'r.site_id DESC, r.datetime DESC';\n\n    if (params.range) {\n      params.range.from = moment(params.range.from).format('YYYY-MM-DD') + 'T00:00:00.000Z';\n      params.range.to = moment(params.range.to).format('YYYY-MM-DD') + 'T23:59:59.999Z';\n    }\n\n    return params;\n  };\n\n  this.searchRecs = function (output) {\n    $scope.loading = true;\n    output = output || ['list'];\n    var params = this.getSearchParameters(output);\n    var expect = output.reduce(function (obj, a) {\n      obj[a] = true;\n      return obj;\n    }, {});\n\n    if (expect.list) {\n      $scope.recs = [];\n    }\n\n    if (expect.count) {\n      $scope.totalRecs = undefined;\n    }\n\n    Project.getRecs(params, function (data) {\n      if (output.length == 1) {\n        data = output.reduce(function (obj, a) {\n          obj[a] = data;\n          return obj;\n        }, {});\n      }\n\n      if (expect.list) {\n        $scope.recs = data.list; // Show selected recordings across pagination\n\n        $scope.recs.forEach(function (rec) {\n          if ($scope.selectedRecId.includes(rec.id)) {\n            rec.checked = true;\n          }\n        });\n        $scope.loading = false;\n      }\n\n      if (expect.count) {\n        $scope.totalRecs = data.count;\n      }\n\n      if (expect.date_range && data.date_range.min_date && data.date_range.max_date) {\n        $scope.minDate = new Date(new Date(data.date_range.min_date.substr(0, 10) + \"T00:00:00.000Z\").getTime() - 24 * 60 * 60 * 1000);\n        $scope.maxDate = new Date(new Date(data.date_range.max_date.substr(0, 10) + \"T23:59:59.999Z\").getTime() + 24 * 60 * 60 * 1000);\n      }\n    });\n  };\n\n  this.sortRecs = function (sortKey, reverse) {\n    $scope.sortKey = sortKey;\n    $scope.reverse = reverse;\n    this.searchRecs();\n  };\n\n  this.applyFilters = function (filters) {\n    $scope.currentPage = 1;\n    $scope.params = filters;\n    this.searchRecs(['count', 'list']);\n  };\n\n  this.reloadList = function () {\n    this.searchRecs(['count', 'list']);\n  };\n\n  this.exportPermit = function () {\n    return a2UserPermit.can('manage project recordings');\n  };\n\n  this.createPlaylist = function () {\n    var listParams = angular.merge({}, $scope.params);\n\n    if (!Object.keys(listParams).length) {\n      notify.log('Filter recordings and create a playlist');\n      return;\n    }\n\n    if ($scope.totalRecs == 0) {\n      notify.error('You can\\'t create playlist with 0 recording');\n      return;\n    }\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to create playlists');\n      return;\n    }\n\n    if (listParams.tags && listParams.tags.length) {\n      listParams.tags = listParams.tags.flat();\n    }\n\n    if (listParams.presence && listParams.presence.length) {\n      listParams.presence = listParams.presence[0];\n    }\n\n    if (listParams.range) {\n      listParams.range.from = moment(listParams.range.from).format('YYYY-MM-DD') + 'T00:00:00.000Z';\n      listParams.range.to = moment(listParams.range.to).format('YYYY-MM-DD') + 'T23:59:59.999Z';\n    }\n\n    if ($scope.selectedRecId && $scope.selectedRecId.length) {\n      listParams.recIds = $scope.selectedRecId;\n    }\n\n    var modalInstance = $modal.open({\n      controller: 'SavePlaylistModalInstanceCtrl',\n      templateUrl: '/app/audiodata/create-playlist.html',\n      resolve: {\n        listParams: function () {\n          return listParams;\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function (data) {\n      if (data.message === 'Playlist created') {\n        notify.log(data.message);\n      }\n    });\n  };\n\n  this.isDisableDeleteRecs = function () {\n    return !$scope.checkedRec.length && !$scope.checked;\n  };\n\n  this.deleteRecordings = function () {\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error('You do not have permission to delete recordings');\n      return;\n    }\n\n    const recs = $scope.checkedRec.filter(function (rec) {\n      return !rec.imported;\n    });\n\n    if (!recs || !recs.length) {\n      return notify.log('There are not any recordings to delete');\n    }\n\n    const recCount = recs.reduce(function (_, rec) {\n      _[rec.site] = _[rec.site] + 1 || 1;\n      return _;\n    }, {});\n    const messages = [],\n          list = [];\n    messages.push('Are you sure you want to delete the following?');\n    Object.keys(recCount).forEach(function (site, index) {\n      const s = recCount[site] > 1 ? 's' : '';\n\n      if (index < 3) {\n        list.push(recCount[site] + ' recording' + s + ' from \"' + site + '\"');\n      }\n    });\n\n    if (Object.keys(recCount).length > 3) {\n      var count = 0;\n      Object.keys(recCount).forEach(function (site, index) {\n        if (index >= 3) {\n          count = count + recCount[site];\n        }\n      });\n      const msg = '& ' + count + ' recordings from ' + (Object.keys(recCount).length - 3) + ' other sites';\n      list.push(msg);\n    }\n\n    return $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = messages;\n        this.list = list;\n        this.note = 'Note: analysis results on these recordings will also be deleted';\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      return $http.post('/api/project/' + Project.getUrl() + '/recordings/delete', {\n        recs: recs\n      });\n    }).then(function (response) {\n      if (response.data.error) {\n        return notify.error(response.data.error);\n      }\n\n      this.searchRecs(['count', 'list']);\n      notify.log(response.data.msg);\n    }.bind(this));\n  };\n\n  this.deleteAllRecordings = function () {\n    var filters = $scope.params;\n\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error('You do not have permission to delete recordings');\n      return;\n    }\n\n    if (!$scope.recs.length) {\n      notify.error('Recordings not found');\n      return;\n    }\n\n    return Project.getRecCounts(filters).then(function (recCount) {\n      var messages = [],\n          importedCount = 0,\n          importedSites = [],\n          list = [];\n      messages.push('Are you sure you want to delete the following?');\n      recCount.forEach(function (entry, index) {\n        var s = entry.count > 1 ? 's' : '';\n\n        if (!entry.imported && index < 3) {\n          list.push(entry.count + ' recording' + s + ' from \"' + entry.site + '\"');\n        } else if (entry.imported) {\n          importedCount += entry.count;\n          importedSites.push('\"' + entry.site + '\"');\n        }\n      });\n\n      if (recCount.length > 3) {\n        var count = 0;\n        recCount.forEach(function (entry, index) {\n          if (index >= 3) {\n            count = count + entry.count;\n          }\n        });\n        const msg = '& ' + count + ' recordings from ' + (recCount.length - 3) + ' other sites';\n        list.push(msg);\n      }\n\n      if (importedCount) {\n        messages.push(\"(The filters matched \" + importedCount + \" recordings wich come from \" + importedSites.join(\", \") + \". You cannot delete these from your project, they can only be removed from their original project.)\");\n      }\n\n      return $modal.open({\n        templateUrl: '/common/templates/pop-up.html',\n        controller: function () {\n          this.messages = messages;\n          this.list = list;\n          this.note = 'Note: analysis results on these recordings will also be deleted';\n          this.btnOk = \"Delete\";\n          this.btnCancel = \"Cancel\";\n        },\n        controllerAs: 'popup'\n      }).result;\n    }).then(function () {\n      return $http.post('/api/project/' + Project.getUrl() + '/recordings/delete-matching', filters).error(function (error) {\n        return notify.error(error);\n      });\n    }).then(function (response) {\n      if (response.data.error) {\n        return notify.error(response.data.error);\n      }\n\n      this.searchRecs(['count', 'list']);\n      notify.log(response.data.msg);\n    }.bind(this));\n  };\n\n  $scope.params = {};\n  $scope.loading = true;\n  $scope.currentPage = 1;\n  $scope.limitPerPage = 10;\n  this.searchRecs(['count', 'date_range', 'list']);\n  $scope.$watch('checked', function () {\n    $scope.combineCheckedRecordings();\n  });\n\n  $scope.combineCheckedRecordings = function () {\n    $scope.recs.forEach(function (rec) {\n      if (rec.checked && !$scope.selectedRecId.includes(rec.id)) {\n        $scope.selectedRecId.push(rec.id);\n        $scope.checkedRec.push(rec);\n      }\n    });\n  };\n\n  $scope.selectRec = function (rec) {\n    if (!rec.checked) {\n      const index = $scope.selectedRecId.findIndex(function (id) {\n        return id === rec.id;\n      });\n      $scope.selectedRecId.splice(index, 1);\n      $scope.checkedRec.splice(index, 1);\n      return;\n    }\n\n    if ($scope.selectedRecId.includes(rec.id)) return;\n    $scope.selectedRecId.push(rec.id);\n    $scope.checkedRec.push(rec);\n  };\n\n  this.setCurrentPage = function (currentPage) {\n    $scope.currentPage = currentPage;\n    this.searchRecs();\n  };\n\n  this.setLimitPerPage = function (limitPerPage) {\n    $scope.limitPerPage = limitPerPage;\n    this.searchRecs();\n  };\n\n  this.exportRecordings = function (listParams) {\n    if (a2UserPermit.isSuper()) {\n      return this.openExportPopup(listParams);\n    }\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export data');\n    }\n\n    this.openExportPopup(listParams);\n  };\n\n  this.openExportPopup = function (listParams) {\n    $scope.params.userEmail = a2UserPermit.getUserEmail() || '';\n    const modalInstance = $modal.open({\n      controller: 'ExportRecordingstModalInstanceCtrl',\n      templateUrl: '/app/audiodata/export-report.html',\n      resolve: {\n        data: function () {\n          return {\n            params: $scope.params,\n            listParams: listParams\n          };\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function () {\n      notify.log('Your report export request is processing <br> and will be sent by email.');\n    });\n  };\n}).controller('SavePlaylistModalInstanceCtrl', function ($scope, $modalInstance, a2Playlists, listParams, notify) {\n  var result;\n\n  $scope.savePlaylist = function (name) {\n    $scope.isSavingPlaylist = true;\n    a2Playlists.create({\n      playlist_name: name,\n      params: listParams\n    }, function (data) {\n      $scope.isSavingPlaylist = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        result = data;\n        $modalInstance.close({\n          message: 'Playlist created'\n        });\n      }\n    });\n    var timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      $scope.isSavingPlaylist = false;\n      $modalInstance.close({\n        message: 'Playlist creating'\n      });\n\n      if (!$scope.errMess && !result) {\n        notify.log('Your playlist is being created. <br> Check it in the project playlists');\n      }\n    }, 60000);\n  };\n\n  $scope.changePlaylistName = function () {\n    $scope.errMess = null;\n  };\n}).controller('ExportRecordingstModalInstanceCtrl', function ($scope, $modalInstance, Project, data) {\n  $scope.userEmail = data.params.userEmail;\n\n  $scope.exportRecordings = function (email) {\n    data.params.userEmail = email;\n    $scope.isExportingRecs = true;\n    $scope.errMess = '';\n    Project.getRecordingData(data.params, data.listParams).then(function (data) {\n      $scope.isExportingRecs = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        $modalInstance.close();\n      }\n    });\n  };\n\n  $scope.changeUserEmail = function () {\n    $scope.errMess = null;\n  };\n}).directive(\"customSrc\", function () {\n  return {\n    link: function (scope, element, attrs) {\n      var img, loadImage;\n      img = null;\n\n      loadImage = function () {\n        element[0].src = '';\n        img = new Image();\n        img.src = attrs.customSrc;\n\n        img.onload = function () {\n          element[0].src = attrs.customSrc;\n        };\n\n        img.onerror = function () {\n          element[0].src = 'https://rfcx-web-static.s3.eu-west-1.amazonaws.com/arbimon/unavaliable.png';\n        };\n      };\n\n      scope.$watch(function () {\n        return attrs.customSrc;\n      }, function (newVal, oldVal) {\n        if (oldVal !== newVal) {\n          loadImage();\n        }\n      });\n    }\n  };\n});","angular.module('a2.audiodata.templates', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.templates', 'a2.directive.audio-bar', 'a2.visualizer.audio-player', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.templates', {\n    url: '/templates',\n    controller: 'TemplatesCtrl as controller',\n    templateUrl: '/app/audiodata/templates/templates.html'\n  });\n}).controller('TemplatesCtrl', function ($scope, a2Templates, Project, $localStorage, a2UserPermit, notify, $modal, $window, a2AudioBarService) {\n  var self = this;\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = false;\n      this.isAdding = false;\n      this.templates = [];\n      this.currentTab = 'projectTemplates';\n      this.pagination = {\n        page: 1,\n        limit: 100,\n        offset: 0,\n        totalItems: 0,\n        totalPages: 0\n      };\n      this.projecturl = Project.getUrl();\n      this.search = {\n        q: ''\n      };\n      this.getList();\n      this.timeout;\n    },\n    goToSourceProject: function (projectId) {\n      if (!projectId) return;\n      Project.getProjectById(projectId, function (data) {\n        if (data) {\n          $window.location.pathname = \"/project/\" + data.url + \"/audiodata/templates\";\n        }\n      });\n    },\n    setCurrentPage: function () {\n      self.pagination.offset = self.pagination.page - 1;\n      this.getList();\n    },\n    getList: function () {\n      self.loading = true;\n      const opts = {\n        showRecordingUri: true,\n        q: self.search.q,\n        limit: self.pagination.limit,\n        offset: self.pagination.offset * self.pagination.limit\n      };\n      opts[self.currentTab] = true;\n      return a2Templates.getList(opts).then(function (data) {\n        self.loading = false;\n        self.templates = data.list;\n        self.pagination.totalItems = data.count;\n        self.pagination.totalPages = Math.ceil(self.pagination.totalItems / self.pagination.limit);\n      }.bind(this)).catch(function (err) {\n        self.loading = false;\n        self.templates = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    onSearchChanged: function () {\n      var _this = this;\n\n      clearTimeout(self.timeout);\n      self.timeout = setTimeout(function () {\n        if (self.search.q.trim().length > 0 && self.search.q.trim().length < 3) return;\n\n        _this.reloadPage();\n      }, 1000);\n    },\n    reloadPage: function () {\n      this.resetPagination();\n      this.getList();\n    },\n    getTemplateVisualizerUrl: function (template) {\n      const box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.project_url + \"/#/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    deleteTemplate: function (templateId) {\n      if (!a2UserPermit.can('manage templates')) {\n        notify.error('You do not have permission to delete templates');\n        return;\n      }\n\n      $scope.popup = {\n        title: 'Delete template',\n        messages: ['Are you sure you want to delete this template?'],\n        btnOk: 'Yes',\n        btnCancel: 'No'\n      };\n      var modalInstance = $modal.open({\n        templateUrl: '/common/templates/pop-up.html',\n        scope: $scope\n      });\n      modalInstance.result.then(function (confirmed) {\n        if (confirmed) {\n          return a2Templates.delete(templateId).then(function () {\n            self.getList();\n          });\n        }\n      });\n    },\n    toggleTab: function (access) {\n      self.currentTab = access;\n      this.reloadPage();\n    },\n    resetPagination: function () {\n      self.pagination = {\n        page: 1,\n        limit: 100,\n        offset: 0,\n        totalItems: 0,\n        totalPages: 0\n      };\n    },\n    addTemplate: function (template) {\n      self.isAdding = true;\n      a2Templates.add({\n        name: template.name,\n        recording: template.recording,\n        species: template.species,\n        songtype: template.songtype,\n        roi: {\n          x1: template.x1,\n          y1: template.y1,\n          x2: template.x2,\n          y2: template.y2\n        },\n        source_project_id: template.project\n      }).then(function (template) {\n        console.log('new template', template);\n        self.isAdding = false;\n        if (template.id === 0) notify.error('The template already exists in the project templates.');else if (template.error) notify.error('You do not have permission to manage templates');else notify.log('The template is added to the project.');\n      }).catch(function (err) {\n        console.log('err', err);\n        self.isAdding = false;\n        notify.error(err);\n      });\n    },\n    playTemplateAudio: function (template, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      ;\n      $localStorage.setItem('a2-audio-param-gain', JSON.stringify(2));\n      console.info('play');\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(template), true);\n    }\n  });\n  this.initialize();\n});","angular.module('a2.citizen-scientist.admin', ['ui.router', 'a2.citizen-scientist.admin.classification-stats', 'a2.citizen-scientist.admin.user-stats', 'a2.citizen-scientist.admin.settings']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin', {\n    url: '/admin',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.audiodata.uploads', ['ui.router', 'a2.audiodata.uploads.upload', 'a2.audiodata.uploads.processing']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads', {\n    url: '/uploads',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.audiodata.uploads.processing', ['a2.services', 'a2.srv.uploads', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads.processing', {\n    url: '/processing',\n    controller: 'A2AudioDataUploadsProcessingCtrl as controller',\n    templateUrl: '/app/audiodata/uploads/processing.html'\n  });\n}).controller('A2AudioDataUploadsProcessingCtrl', function ($scope, a2UploadsService) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2UploadsService.getProcessingList().then(function (data) {\n      this.loading = false;\n      this.list = data.list;\n      this.count = data.count;\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.audiodata.uploads.upload', ['a2.services', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'a2.srv.app-listings', 'a2.filter.caps', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads.upload', {\n    url: '/',\n    controller: 'A2AudioDataUploadsUploadCtrl as controller',\n    templateUrl: '/app/audiodata/uploads/upload.html'\n  });\n}).filter('prettyBytes', function () {\n  return function (bytes) {\n    var labels = ['B', 'kB', 'MB', 'GB'];\n    var newBytes;\n    var p;\n\n    for (p = 1; bytes / Math.pow(1024, p) > 1; p++) {\n      newBytes = bytes / Math.pow(1024, p);\n    }\n\n    newBytes = Math.round(newBytes * 100) / 100;\n    return String(newBytes) + ' ' + labels[p - 1];\n  };\n}).controller('A2AudioDataUploadsUploadCtrl', function ($scope, uploads, Project, AppListingsService, a2UserPermit, notify, $interval, a2UploadsService) {\n  $scope.verifyAndUpload = function () {\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error(\"You do not have permission to upload recordings\");\n      return;\n    }\n\n    var index = 0;\n    $scope.uploading = true;\n\n    var _verifyAndUpload = function () {\n      var item = $scope.uploader.queue[index];\n\n      if (item && item.file && !item.file.size) {\n        item.isError = true;\n        item.errorMsg = \"Error of the file size\";\n        return;\n      }\n\n      var next = function () {\n        index++;\n\n        _verifyAndUpload();\n      };\n\n      if (!item || !$scope.uploading) {\n        $scope.uploading = false;\n        return;\n      }\n\n      if (item.isSuccess) // file uploaded on current batch\n        return next();\n      Project.recExists($scope.info.site.id, item.file.name, function (exists) {\n        if (exists) {\n          console.log('duplicated');\n          item.isDuplicate = true;\n          return next();\n        }\n\n        item.url = '/uploads/audio?project=' + $scope.project.project_id + '&site=' + $scope.info.site.id + '&nameformat=' + $scope.info.format.name + '&timezone=' + $scope.info.timezone.format;\n        item.upload();\n        item.onSuccess = next;\n        item.onError = next;\n      });\n    };\n\n    _verifyAndUpload();\n  };\n\n  $scope.isCheckingStatus = false;\n\n  $scope.queueJobToCheckStatus = function () {\n    if ($scope.isCheckingStatus) return;\n    $scope.isCheckingStatus = true;\n    a2UploadsService.getProcessingList({\n      site: $scope.info.site.id\n    }).then(function (files) {\n      const uploadingFiles = $scope.getUploadingFiles();\n\n      if (!uploadingFiles.length) {\n        $scope.cancelTimer();\n        $scope.isCheckingStatus = false;\n        return;\n      }\n\n      const userFiles = uploadingFiles.map(function (fileObj) {\n        return fileObj.file.name;\n      });\n\n      if (files && files.length) {\n        const filesToCheck = files.filter(function (file) {\n          return userFiles.includes(file.name);\n        });\n        const items = filesToCheck.slice(0, 5).map(function (item) {\n          return {\n            uploadUrl: item.uploadUrl,\n            uploadId: item.id,\n            filename: item.name\n          };\n        });\n        a2UploadsService.checkStatus({\n          items: items\n        }).then(function (data) {\n          if (data) {\n            data.forEach(function (item) {\n              const userFile = uploadingFiles.find(function (fileObj) {\n                return fileObj.file.name === item.filename;\n              });\n\n              if (userFile && item.status === 'uploaded') {\n                $scope.makeSuccessItem(userFile);\n              }\n            });\n            $scope.isCheckingStatus = false;\n          }\n        });\n      }\n    });\n  };\n\n  $scope.getUploadingFiles = function () {\n    const uploadingFiles = $scope.uploader.queue.filter(function (file) {\n      return file.isSuccess === true && file.isUploaded === false;\n    });\n    return uploadingFiles && uploadingFiles.length ? uploadingFiles : [];\n  };\n\n  $scope.checkUploadingFiles = function () {\n    if ($scope.getUploadingFiles().length) {\n      $scope.startTimer();\n    }\n  };\n\n  $scope.startTimer = function () {\n    $scope.cancelTimer();\n    $scope.checkStatusInterval = $interval(function () {\n      $scope.queueJobToCheckStatus();\n    }, 10000);\n  };\n\n  $scope.cancelTimer = function () {\n    if ($scope.checkStatusInterval) {\n      $interval.cancel($scope.checkStatusInterval);\n    }\n  };\n\n  $scope.$on('$destroy', function () {\n    $scope.cancelTimer();\n  });\n  AppListingsService.getFor('arbimon2-desktop-uploader').then(function (uploaderAppListing) {\n    this.uploaderAppListing = uploaderAppListing;\n  }.bind(this));\n\n  $scope.stopQueue = function () {\n    $scope.uploading = false;\n    angular.forEach($scope.uploader.queue, function (item) {\n      item.cancel();\n    });\n  };\n\n  $scope.uploader = uploads.getUploader();\n  $scope.info = {};\n  $scope.formats = [{\n    name: \"Arbimon\",\n    format: \"(*-YYYY-MM-DD_HH-MM)\"\n  }, {\n    name: \"AudioMoth\",\n    format: \"(*YYYYMMDD_HHMMSS)\"\n  }, {\n    name: \"AudioMoth legacy\",\n    format: \"(Unix Time code in Hex)\"\n  }, {\n    name: \"Cornell\",\n    format: \"(*_YYYYMMDD_HHMMSSZ)\"\n  }, {\n    name: \"Song Meter\",\n    format: \"(*_YYYYMMDD_HHMMSS)\"\n  }, {\n    name: \"Wildlife\",\n    format: \"(YYYYMMDD_HHMMSS)\"\n  }];\n  $scope.fileTimezone = [{\n    name: \"UTC\",\n    format: \"utc\"\n  }, {\n    name: \"Site timezone\",\n    format: \"local\"\n  }];\n  Project.getSites({\n    utcDiff: true\n  }, function (sites) {\n    $scope.sites = sites.sort(function (a, b) {\n      return new Date(b.updated_at) - new Date(a.updated_at);\n    });\n  });\n\n  $scope.selectSite = function () {\n    const local = $scope.info && $scope.info.site && $scope.info.site.utcOffset ? $scope.info.site.utcOffset + ' (local)' : 'Site timezone';\n    $scope.fileTimezone[1].name = local;\n    $scope.info.timezone = $scope.fileTimezone[1];\n  };\n\n  $scope.isStartUploadDisabled = function () {\n    return !$scope.uploader.queue.length || $scope.isLimitExceeded() || !$scope.info.site || !$scope.info.format || $scope.uploading;\n  };\n\n  $scope.isLimitExceeded = function () {\n    return $scope.uploader.queue.length > 1000;\n  };\n\n  const randomString = Math.round(Math.random() * 100000000);\n  this.uploaderApps = {\n    mac: 'https://rf.cx/ingest-app-latest-mac?r=' + randomString,\n    windows: 'https://rf.cx/ingest-app-latest-win?r=' + randomString\n  };\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  $scope.uploader.filters.push({\n    name: 'supportedFormats',\n    fn: function (item) {\n      var name = item.name.split('.');\n      var extension = name[name.length - 1].toLowerCase();\n      var validFormats = /mp3|flac|wav|opus/i;\n      if (!validFormats.exec(extension)) return false;\n      return true;\n    }\n  });\n  $scope.uploader.filters.push({\n    name: 'notDuplicate',\n    fn: function (item) {\n      var duplicate = $scope.uploader.queue.filter(function (qItem) {\n        return qItem.file.name === item.name;\n      });\n      return !duplicate.length;\n    }\n  });\n\n  $scope.uploader.onErrorItem = function (item, response, status, headers) {\n    if (response.error) {\n      item.errorMsg = response.error;\n    } else if (status >= 500) {\n      item.errorMsg = \"Server error\";\n      return;\n    } else {\n      item.errorMsg = \"An error ocurred\";\n    }\n  };\n\n  $scope.uploader.onSuccessItem = function (item, response, status, headers) {\n    item.isUploaded = false;\n    console.info('count of uploading files', $scope.getUploadingFiles().length);\n    $scope.checkUploadingFiles();\n  };\n\n  $scope.makeSuccessItem = function (item) {\n    item.status = 'uploaded';\n    item.isUploading = false;\n    item.isSuccess = false;\n    item.isUploaded = true;\n    item.progress = 100;\n  };\n\n  $scope.getProgress = function (item) {\n    if (item.isUploading && item.progress === 100) return 90;else if (item.isSuccess && !item.isUploaded) return 90;else return item.progress;\n  };\n\n  $scope.removeCompleted = function () {\n    if (!$scope.uploader.queue.length) return;\n    $scope.uploader.queue = $scope.uploader.queue.filter(function (file) {\n      return !file.isSuccess;\n    });\n  };\n\n  $scope.getCountOfUploaded = function () {\n    if (!$scope.uploader || !$scope.uploader.queue || !$scope.uploader.queue.length) return 0;\n    $scope.uploaded = $scope.uploader.queue.filter(function (file) {\n      return !!file.isUploaded && !file.isError;\n    }).length;\n    return $scope.uploaded;\n  };\n\n  $scope.clearQueue = function () {\n    $scope.uploader.progress = 0;\n    $scope.uploaded = 0;\n  };\n\n  $scope.uploaded = 0;\n\n  $scope.uploader.onProgressAll = function () {};\n}).factory('uploads', function (FileUploader) {\n  var u = new FileUploader();\n  window.addEventListener(\"beforeunload\", function (e) {\n    if (u.isUploading) {\n      var confirmationMessage = \"Upload is in progress, Are you sure to exit?\";\n      (e || window.event).returnValue = confirmationMessage; //Gecko + IE\n\n      return confirmationMessage; //Webkit, Safari, Chrome etc.\n    }\n  });\n  return {\n    getUploader: function () {\n      return u;\n    }\n  };\n});","angular.module('a2.citizen-scientist.my-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.my-stats', {\n    url: '/my-stats',\n    controller: 'A2CitizenScientistMyStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/my-stats/index.html'\n  });\n}).controller('A2CitizenScientistMyStatsCtrl', function ($scope, a2CitizenScientistService, $stateParams, $state, Users) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistService.getMyStats().then(function (data) {\n      this.loading = false;\n      var vars = ['validated', 'consensus', 'non_consensus', 'pending', 'reached_th'];\n      this.stats = data.stats.map(function (item, index) {\n        vars.forEach(function (_var) {\n          item['group_' + _var] = data.groupStats[index][_var];\n        });\n        return item;\n      });\n      this.overall = data.stats.reduce(function (_, item) {\n        vars.forEach(function (_var) {\n          _[_var] += item[_var];\n          _['group_' + _var] += item['group_' + _var];\n        });\n        return _;\n      }, vars.reduce(function (__, _var) {\n        __[_var] = 0;\n        __['group_' + _var] = 0;\n        return __;\n      }, {})); // compute overalls\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.citizen-scientist.expert', ['ui.bootstrap', 'a2.srv.patternmatching', 'a2.srv.citizen-scientist', 'a2.srv.citizen-scientist-expert', 'a2.visualizer.audio-player', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.expert', {\n    url: '/expert/:patternMatchingId?',\n    controller: 'CitizenScientistExpertCtrl',\n    templateUrl: '/app/citizen-scientist/expert/list.html'\n  });\n}).controller('CitizenScientistExpertCtrl', function ($scope, $filter, Project, ngTableParams, a2Playlists, notify, $q, a2CitizenScientistService, a2CitizenScientistExpertService, a2PatternMatching, a2UserPermit, $state, $stateParams) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.patternmatchingsOriginal, params.filter()) : $scope.patternmatchingsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.patternmatchingsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No Pattern matchings searches found.\";\n        }\n\n        $scope.patternmatchingsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $state.go('citizen-scientist.expert', {\n      patternMatchingId: patternmatchingId ? patternmatchingId : undefined\n    });\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CitizenScientistExpertService.getPatternMatchings().then(function (data) {\n      $scope.patternmatchingsOriginal = data;\n      $scope.patternmatchingsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No pattern matchings found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2CitizenScientistExpertDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'CitizenScientistExpertDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/citizen-scientist/expert/details.html'\n  };\n}).filter('pmValidation', function () {\n  return function (validation, cp, cnp) {\n    if (validation == 1) {\n      return 'present';\n    } else if (validation == 0) {\n      return 'not present';\n    } else if (validation === null || validation === undefined) {\n      if (cp > 0 && cnp > 0) {\n        return 'conflicted';\n      } else {\n        return '---';\n      }\n    }\n  };\n}).controller('CitizenScientistExpertDetailsCtrl', function ($scope, a2PatternMatching, a2Templates, a2CitizenScientistExpertService, a2UserPermit, Project, a2AudioBarService, notify) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 0\n      };\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.loading = {\n        details: false,\n        rois: false\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.expertSearch = this.lists.search[0];\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    compositeValidation: function (roi) {\n      var expert_val = roi.expert_validated;\n      var consensus_val = roi.consensus_validated;\n      var cp = roi.cs_val_present;\n      var cnp = roi.cs_val_not_present;\n      return [expert_val, consensus_val, cp > 0 && cnp > 0 ? -1 : null].reduce(function (_, arg) {\n        return _ === null ? arg : _;\n      }, null);\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      search: [{\n        value: 'all',\n        text: 'All',\n        description: 'Show all matched rois.'\n      }, {\n        value: 'consensus',\n        text: 'Consensus',\n        description: 'Show only rois where there is a consensus.'\n      }, {\n        value: 'pending',\n        text: 'Pending',\n        description: 'Show only rois that have not reached a consensus yet.'\n      }, {\n        value: 'conflicted',\n        text: 'Conflicted',\n        description: 'Show only rois where there is a conflict.'\n      }, {\n        value: 'expert',\n        text: 'Expert',\n        description: 'Show only rois that have been decided by an expert.'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      }, {\n        value: 'not-validated',\n        text: 'Not Validated'\n      }],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2CitizenScientistExpertService.getPatternMatchingDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.setupExportUrl();\n        this.total = {\n          rois: patternMatching.matches,\n          pages: Math.ceil(patternMatching.matches / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    onExpertSearchChanged: function () {\n      this.selected.page = 0;\n      this.loadPage(0);\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2CitizenScientistExpertService.getCSExportUrl({\n        patternMatching: this.patternMatching.id\n      });\n    },\n    onScroll: function ($event, $controller) {\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadPage: function (pageNumber) {\n      this.loading.rois = true;\n      return a2CitizenScientistExpertService.getPatternMatchingRoisFor(this.id, this.limit, pageNumber * this.limit, {\n        search: this.expertSearch && this.expertSearch.value\n      }).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = rois.reduce(function (_, roi) {\n          var sitename = roi.site;\n          var recname = roi.recording;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n        this.selected.roi = Math.min();\n\n        if (this.scrollElement) {\n          this.scrollElement.scrollTo(0, 0);\n        }\n\n        return rois;\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 0;\n        this.rois = [];\n        return this.rois;\n      } else {\n        page = Math.max(0, Math.min(page, this.total.rois / this.limit | 0));\n\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadPage(page);\n        }\n      }\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.cs_validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('validate pattern matchings')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        conflict_unresolved: 0,\n        conflict_resolved: 0,\n        null: 0,\n        0: 0,\n        1: 0\n      };\n      return a2CitizenScientistExpertService.validatePatternMatchingRois(this.id, roiIds, validation).then(function () {\n        rois.forEach(function (roi) {\n          var oldtag, newtag;\n\n          if (roi.cs_val_present > 0 && roi.cs_val_not_present > 0) {\n            oldtag = roi.expert_validated !== null ? 'conflict_resolved' : 'conflict_unresolved';\n            newtag = validation !== null ? 'conflict_resolved' : 'conflict_unresolved';\n          }\n\n          val_delta[oldtag] -= 1;\n          val_delta[newtag] += 1;\n          val_delta[roi.expert_validated] -= 1;\n          val_delta[validation] += 1;\n          roi.expert_validated = validation;\n          roi.selected = false;\n        });\n        this.patternMatching.cs_conflict_resolved += val_delta.conflict_resolved;\n        this.patternMatching.cs_conflict_unresolved += val_delta.conflict_unresolved;\n        this.patternMatching.expert_consensus_absent += val_delta[0];\n        this.patternMatching.expert_consensus_present += val_delta[1];\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    nextMatch: function (step) {\n      return this.setRoi(this.selected.roi_index + (step || 1));\n    },\n    prevMatch: function (step) {\n      return this.setRoi(this.selected.roi_index - (step || 1));\n    },\n    nextPage: function (step) {\n      return this.setPage(this.selected.page + (step || 1));\n    },\n    prevPage: function (step) {\n      return this.setPage(this.selected.page - (step || 1));\n    },\n    next: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      this.nextPage(step);\n    },\n    prev: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      return this.next(-step);\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n});","angular.module('a2.citizen-scientist.patternmatching', ['ui.bootstrap', 'a2.srv.patternmatching', 'a2.srv.citizen-scientist', 'a2.visualizer.audio-player', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.patternmatching', {\n    url: '/patternmatching',\n    controller: 'CitizenScientistPatternMatchingCtrl',\n    templateUrl: '/app/citizen-scientist/patternmatching/list.html'\n  });\n  $stateProvider.state('citizen-scientist.patternmatching-details', {\n    url: '/patternmatching/:patternMatchingId?',\n    controller: 'CitizenScientistPatternMatchingCtrl',\n    templateUrl: '/app/citizen-scientist/patternmatching/list.html'\n  });\n}).controller('CitizenScientistPatternMatchingCtrl', function ($scope, $filter, Project, ngTableParams, a2Playlists, notify, $q, a2CitizenScientistService, a2PatternMatching, a2UserPermit, $state, $stateParams) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.patternmatchingsOriginal, params.filter()) : $scope.patternmatchingsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.patternmatchingsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No Pattern matchings searches found.\";\n        }\n\n        $scope.patternmatchingsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $scope.selectedPatternMatchingId = patternmatchingId;\n\n    if (!patternmatchingId) {\n      $state.go('citizen-scientist.patternmatching', {});\n    } else {\n      $state.go('citizen-scientist.patternmatching-details', {\n        patternMatchingId: patternmatchingId\n      });\n    }\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CitizenScientistService.getPatternMatchings().then(function (data) {\n      $scope.patternmatchingsOriginal = data;\n      $scope.patternmatchingsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No pattern matchings found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2CitizenScientistPatternMatchingDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'CitizenScientistPatternMatchingDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/citizen-scientist/patternmatching/details.html'\n  };\n}).controller('CitizenScientistPatternMatchingDetailsCtrl', function ($scope, a2PatternMatching, a2Templates, a2CitizenScientistService, a2UserPermit, Project, a2AudioBarService, notify) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 0\n      };\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.loading = {\n        details: false,\n        rois: false\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      } // {value:'not-validated', text:'Not Validated'},\n      ],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2CitizenScientistService.getPatternMatchingDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.setupExportUrl();\n        this.total = {\n          rois: patternMatching.cs_total,\n          pages: Math.ceil(patternMatching.cs_total / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2PatternMatching.getExportUrl({\n        patternMatching: this.patternMatching.id\n      });\n    },\n    onScroll: function ($event, $controller) {\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadPage: function (pageNumber) {\n      this.loading.rois = true;\n      return a2CitizenScientistService.getPatternMatchingRoisFor(this.id, this.limit, pageNumber * this.limit).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = rois.reduce(function (_, roi) {\n          var sitename = roi.site;\n          var recname = roi.recording;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n        this.selected.roi = Math.min();\n\n        if (this.scrollElement) {\n          this.scrollElement.scrollTo(0, 0);\n        }\n\n        return rois;\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 0;\n        this.rois = [];\n        return this.rois;\n      } else {\n        page = Math.max(0, Math.min(page, this.total.rois / this.limit | 0));\n\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadPage(page);\n        }\n      }\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.cs_validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('use citizen scientist interface')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        0: 0,\n        1: 0,\n        null: 0\n      };\n      rois.forEach(function (roi) {\n        val_delta[roi.cs_validated] -= 1;\n        val_delta[validation] += 1;\n        roi.cs_validated = validation;\n        roi.selected = false;\n      });\n      this.patternMatching.cs_absent += val_delta[0];\n      this.patternMatching.cs_present += val_delta[1];\n      return a2CitizenScientistService.validatePatternMatchingRois(this.id, roiIds, validation);\n    },\n    nextMatch: function (step) {\n      return this.setRoi(this.selected.roi_index + (step || 1));\n    },\n    prevMatch: function (step) {\n      return this.setRoi(this.selected.roi_index - (step || 1));\n    },\n    nextPage: function (step) {\n      return this.setPage(this.selected.page + (step || 1));\n    },\n    prevPage: function (step) {\n      return this.setPage(this.selected.page - (step || 1));\n    },\n    next: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      this.nextPage(step);\n    },\n    prev: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      return this.next(-step);\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n});","angular.module('a2.visobjectsbrowser', ['a2.utils', 'a2.browser_common', 'a2.browser_recordings', 'a2.browser_soundscapes', 'a2.service.serialize-promised-fn'])\n/**\n * @ngdoc directive\n * @name a2visobjectsbrowser.directive:a2VisObjectBrowser\n * @description\n * vis object browser component.\n *\n * @event browser-available Emmited when the browser controller gets initialized\n * @event browser-vobject-type Emmited when the selected visualizer object type changes\n *\n */\n.directive('a2VisObjectBrowser', function ($window, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      location: '=?',\n      onVisObject: '&'\n    },\n    templateUrl: '/app/visualizer/browser/main.html',\n    // require: 'ngModel',\n    controller: 'a2VisObjectBrowserController as browser',\n    link: function (scope, element, attrs, browser) {\n      browser.waitForInitialized.then(function () {\n        scope.$emit('browser-available');\n      });\n      browser.events.on('location-changed', function () {\n        scope.location = this.location;\n      });\n      browser.events.on('browser-vobject-type', function (vobject_type) {\n        scope.$emit('browser-vobject-type', vobject_type);\n      });\n      browser.events.on('on-vis-object', function (location, visobject, type) {\n        scope.onVisObject({\n          location: location,\n          visobject: visobject,\n          type: type\n        });\n        $timeout(function () {\n          var $e = element.find('.visobj-list-item.active');\n\n          if ($e.length) {\n            var $p = $e.parent();\n            var $eo = $e.offset(),\n                $po = $p.offset(),\n                $dt = $eo.top - $po.top;\n            $p.animate({\n              scrollTop: $p.scrollTop() + $dt\n            });\n          }\n        });\n      });\n      scope.selectVisObject = browser.selectVisObject.bind(browser); // scope.$on('a2-persisted', browser.activate.bind(browser));\n\n      scope.$on('prev-visobject', browser.selectPreviousVisObject.bind(browser));\n      scope.$on('next-visobject', browser.selectNextVisObject.bind(browser));\n      scope.$on('set-browser-location', browser.setBrowserLocation.bind(browser)); // Catch the navigation URL query from visualizer view\n\n      scope.$on('set-browser-annotations', browser.setBrowserAnnotations.bind(browser));\n      scope.$on('clear-recording-data', browser.clearRecordingData.bind(browser));\n      scope.$on('visobj-updated', browser.notifyVisobjUpdated.bind(browser));\n      browser.activate(scope.location).catch(console.error.bind(console));\n    }\n  };\n})\n/**\n * @ngdoc controller\n * @name a2visobjectsbrowser.controller:a2VisObjectBrowserController\n * @description\n * Controller for vis object browser.\n *\n * @event browser-available Emmited when the browser controller gets initialized\n * @event browser-vobject-type Emmited when the selected visualizer object type changes\n *\n */\n.controller('a2VisObjectBrowserController', function ($scope, $state, $controller, $q, serializePromisedFn, BrowserLOVOs, BrowserVisObjects, itemSelection, Project, EventlistManager) {\n  var self = this;\n  var project = Project; // Set of available lovo types\n\n  this.types = BrowserLOVOs.$grouping;\n  this.visobjectTypes = BrowserVisObjects; // currently selected lovo type\n  // container for loading flags\n\n  this.loading = {\n    sites: false,\n    dates: false,\n    times: false\n  }; // container for auto-selecting values from the browser controllers\n\n  this.auto = {}; // currently selected visualizer object\n\n  this.visobj = null; // currently selected lovo\n\n  this.lovo = null; // associated EventlistManager\n\n  this.events = new EventlistManager(); // initialized flag\n\n  var initialized = false;\n  var waitForInitializedDefer = $q.defer();\n  this.waitForInitialized = waitForInitializedDefer.promise;\n  this.waitForInitialized.then(function () {\n    if (!this.type) {\n      this.setBrowserType(BrowserLOVOs.$list.filter(function (lovo) {\n        return lovo.default;\n      }).shift());\n    }\n  }.bind(this));\n  /** (Re)-Activates the browser controller.\n   * Sets the browser controller into an active state. On the first time,\n   * the browse gets initialized and sends a 'browser-available' event\n   * asynchronously. This activation cascades into the currently selected\n   * type.\n   *\n   * @event browser-available Emmited when the browser controller gets initialized\n   *\n   */\n\n  this.activate = function (location) {\n    var $type = this.$type;\n    return ($type && $type.activate ? $type.activate().then(function () {\n      if ($scope.browser.currentRecording && $scope.browser.annotations) {\n        return this.setLOVO();\n      }\n\n      if ($type.lovo) return this.setLOVO($type.lovo);\n    }.bind(this)) : $q.resolve()).then(function () {\n      if (!initialized) {\n        initialized = true;\n        waitForInitializedDefer.resolve();\n      }\n    }.bind(this));\n  };\n\n  this.setLOVO = function (lovo, location) {\n    var defer = $q.defer();\n    var old_lovo = self.lovo;\n    self.lovo = lovo;\n    if (self.lovo) self.lovo.loading = true;\n    return $q.resolve().then(function () {\n      if (lovo) {\n        self.lovo.loading = false;\n\n        if (lovo.recordingsBySite) {\n          lovo.updateRecording($scope.browser.currentRecording ? $scope.browser.currentRecording : undefined);\n        }\n\n        lovo.initialize().then(function () {\n          if (location) {\n            self.set_location(location);\n          }\n        }).then(function () {\n          // to set selected recording from the list of recordings\n          if (lovo.recordingsBySite && lovo.list && lovo.recording_id) {\n            self.auto.visobject = lovo.list.find(function (item) {\n              return item.id === self.auto.visobject.id;\n            });\n          }\n\n          if (self.auto.visobject) {\n            return lovo.find(self.auto.visobject).then(function (visobject) {\n              return self.setVisObj(visobject);\n            });\n          }\n        }).then(function () {\n          return $q.resolve(lovo);\n        });\n      }\n    });\n  };\n\n  this.set_location = function (location) {\n    this.location = location;\n    this.events.send({\n      event: 'location-changed',\n      context: this\n    }, location);\n  };\n\n  this.setBrowserType = serializePromisedFn(function (type) {\n    var new_$type,\n        old_$type = self.$type;\n\n    if (type && type.controller) {\n      if (!type.$controller) {\n        type.$controller = $controller(type.controller, {\n          $scope: $scope,\n          a2Browser: self\n        });\n      }\n\n      new_$type = type.$controller;\n    }\n\n    var differ = new_$type !== old_$type;\n    return (differ ? $q.resolve().then(function () {\n      if (differ && old_$type && old_$type.deactivate) {\n        return old_$type.deactivate();\n      }\n    }).then(function () {\n      if (differ && new_$type && new_$type.activate) {\n        self.type = type;\n        self.$type = new_$type;\n        return self.activate();\n      }\n    }) : $q.resolve()).then(function () {\n      self.events.send({\n        'event': 'browser-vobject-type',\n        context: self\n      }, type.vobject_type);\n    });\n  });\n\n  this.setVisObj = function (newValue) {\n    this.visobj = newValue;\n    var location = newValue && self.$type.get_location(newValue);\n    this.cachedLocation = location;\n    this.events.send({\n      event: 'on-vis-object',\n      context: this\n    }, location, newValue, self.lovo ? self.lovo.object_type : null);\n  };\n\n  this.selectVisObject = function (visobject) {\n    console.log(\"this.selectVisObject :: \", visobject);\n    return visobject ? $q.resolve().then(function () {\n      return self.lovo && self.lovo.find(visobject);\n    }).then(function (vobj) {\n      return vobj || visobject;\n    }).then(function (vobj) {\n      self.auto = {\n        visobject: vobj\n      };\n\n      if (self.$type.auto_select) {\n        return self.$type.auto_select(visobject);\n      } else {\n        return self.setVisObj(visobject);\n      }\n    }) : $q.resolve();\n  };\n\n  this.selectPreviousVisObject = function () {\n    // console.log(\"this.selectPreviousVisObject = function(){\");\n    if (self.visobj && self.lovo) {\n      self.lovo.previous(self.visobj.id).then(this.selectVisObject.bind(this));\n    }\n  };\n\n  this.selectNextVisObject = function () {\n    console.log(\"this.selectNextVisObject = function(){\");\n\n    if (self.visobj && self.lovo) {\n      self.lovo.next(self.visobj.id).then(this.selectVisObject.bind(this));\n    }\n  }; // Parse the navigation URL query\n\n\n  this.setBrowserAnnotations = function (evt, recording, query) {\n    this.annotations = query;\n    this.currentRecording = recording;\n  };\n\n  this.clearRecordingData = function (evt, data) {\n    this.currentRecording = null;\n  };\n\n  this.setBrowserLocation = function (evt, location) {\n    var m = /([\\w-+]+)(\\/(.+))?/.exec(location);\n\n    if (this.cachedLocation == location) {\n      return $q.resolve();\n    }\n\n    this.cachedLocation = location;\n\n    if (m && BrowserLOVOs[m[1]]) {\n      var loc = m[3];\n      var lovos_def = BrowserLOVOs[m[1]];\n      this.setBrowserType(lovos_def).then(function () {\n        return lovos_def.$controller.resolve_location(loc);\n      }).then(function (visobject) {\n        if (visobject) {\n          return self.selectVisObject(visobject);\n        }\n      });\n    }\n  };\n\n  this.notifyVisobjUpdated = function (evt, visobject) {\n    if (self.lovo && self.lovo.update) {\n      self.lovo.update(visobject);\n    }\n  };\n});","angular.module('a2.browser_common', []).provider('BrowserVisObjects', function () {\n  var visobjects = {};\n  return {\n    add: function (visobject) {\n      visobjects[visobject.type] = angular.extend(visobjects[visobject.type] || {}, visobject);\n    },\n    $get: function () {\n      return visobjects;\n    }\n  };\n}).provider('BrowserLOVOs', function () {\n  var lovos = {\n    $grouping: [],\n    $list: []\n  };\n  return {\n    add: function (lovo) {\n      lovos.$list.push(lovo);\n    },\n    $get: function () {\n      lovos.$grouping = lovos.$list.reduce(function (_, lovodef) {\n        var group = lovodef.group || '';\n\n        if (!_.$index[group]) {\n          _.groups.push(_.$index[group] = []);\n        }\n\n        _.$index[group].push(lovos[lovodef.name] = lovodef);\n\n        return _;\n      }, {\n        groups: [],\n        $index: {}\n      }).groups;\n      return lovos;\n    }\n  };\n}).service('a2ArrayLOVO', function ($q) {\n  var lovo = function (list, object_type) {\n    this.offset = 0;\n    this.setArray(list, object_type);\n  };\n\n  lovo.prototype = {\n    initialize: function () {\n      var d = $q.defer();\n      d.resolve(true);\n      return d.promise;\n    },\n    setArray: function (list, object_type) {\n      this.list = list || [];\n      this.count = this.list.length;\n      this.object_type = object_type;\n    },\n    find: function (soundscape) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      d.resolve(this.list.filter(function (r) {\n        return r.id == id;\n      }).shift());\n      return d.promise;\n    },\n    previous: function (soundscape) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      var index = 0;\n\n      for (var l = this.list, i = 0, e = l.length; i < e; ++i) {\n        if (s.id == id) {\n          index = Math.min(Math.max(0, i - 1, this.list.length - 1));\n          break;\n        }\n      }\n\n      d.resolve(this.list[index]);\n      return d.promise;\n    },\n    next: function (recording) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      var index = 0;\n\n      for (var l = this.list, i = 0, e = l.length; i < e; ++i) {\n        if (s.id == id) {\n          index = Math.min(Math.max(0, i + 1, this.list.length - 1));\n          break;\n        }\n      }\n\n      d.resolve(this.list[index]);\n      return d.promise;\n    }\n  };\n  return lovo;\n});","/**\n * @ngdoc overview\n * @name dialog\n * @description\n * Visualizer dialog window module.\n */\nangular.module('a2.visualizer.dialog', []).directive('a2VisualizerDialog', function () {\n  return {\n    restrict: 'E',\n    transclude: true,\n    templateUrl: '/app/visualizer/dialog/dialog.html',\n    scope: {\n      show: '=',\n      x1: '=',\n      y1: '=',\n      x2: '=',\n      y2: '='\n    },\n    controller: 'a2VisualizerDialogCtrl'\n  };\n}).controller('a2VisualizerDialogCtrl', function ($scope) {\n  $scope.layout = $scope.$parent.layout;\n\n  $scope.getXSide = function (x1, x2) {\n    var px = Math.max(0, Math.min($scope.layout.sec2x(x2, 1) / $scope.layout.spectrogram.width, 1));\n    return px > .5 ? 'left' : 'right';\n  };\n\n  $scope.getXCoord = function (x1, x2) {\n    return $scope.getXSide(x1, x2) == 'left' ? x1 : x2;\n  };\n\n  $scope.getTransform = function (x1, x2, y1, y2) {\n    var tx = $scope.getXSide(x1, x2) == 'left' ? '-100%' : '0';\n    var ty = $scope.getYTranslation((y1 + y2) / 2, true);\n    return 'translate(' + tx + ', ' + ty + ')';\n  };\n\n  $scope.getYTranslation = function (y, asrelativeoffset) {\n    var py = Math.max(0.1, Math.min($scope.layout.hz2y(y, 1) / $scope.layout.spectrogram.height, .9));\n\n    if (asrelativeoffset) {\n      py = -py;\n    }\n\n    return (100 * py | 0) + '%';\n  };\n});","angular.module('a2.visualizer.layers.recording-tags', ['a2.srv.tags']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.recording-tags.object:recording-tags-layer\n   * @description Recording tags layer.\n   * adds the recording-tags-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-tags-layer\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingTagsLayerController as controller',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n})\n/**\n * @ngdoc controller\n * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController\n * @description Controller for recording tags layer in visualizer.\n * Gets injected an instance of VisualizerCtrl representing the visualizer control.\n * Responds to VisualizerCtrl.event::visobject by loading the visobject tags, if it is a\n * recording.\n */\n.controller('a2VisualizerRecordingTagsLayerController', function (VisualizerCtrl, a2Tags, a2LookaheadHelper, a22PointBBoxEditor, $q, $debounce) {\n  function makeTagsIndex(tags) {\n    return tags.reduce(function (idx, tag) {\n      if (tag.id) {\n        idx[tag.id] = true;\n      }\n\n      return idx;\n    }, {});\n  }\n\n  function groupByBbox(tags) {\n    var bboxes = [];\n    tags.reduce(function (bboxIdx, tag) {\n      if (tag.f0) {\n        var bbox = [tag.t0, tag.f0, tag.t1, tag.f1];\n        var bbox_key = bbox.join(',');\n\n        if (!bboxIdx[bbox_key]) {\n          bboxes.push(bboxIdx[bbox_key] = {\n            bbox: tag,\n            tags: []\n          });\n        }\n\n        bboxIdx[bbox_key].tags.push(tag);\n      }\n\n      return bboxIdx;\n    }, {});\n    return bboxes;\n  }\n\n  var lookaheadHelper = new a2LookaheadHelper({\n    fn: a2Tags.search,\n    minLength: 3,\n    includeSearch: true,\n    searchPromote: function (text) {\n      return {\n        tag: text\n      };\n    },\n    searchCompare: function (text, tag) {\n      return tag.tag == text;\n    }\n  });\n  this.tags = [];\n  this.spectrogramTags = [];\n  this.tagsIndex = {};\n  this.bboxTags = [];\n  this.bboxTagsIndex = {};\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#setVisobject\n   * @description Sets the visobject that will be the focus of this controller.\n   * Causes tags associated to it to be loaded.\n   * @param {visobject} visobject - visobject to set on the controller.\n   * @return Promise resolved with tags of given visobject. If the visobject is\n   * not a recording, then the promise resolves to an empty array.\n   */\n\n  this.setVisobject = function (visobject) {\n    this.visobject = visobject;\n    return this.loadTags();\n  };\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#loadTags\n   * @description Loads the tags for a given visobject and returns them in a promise.\n   * @param {visobject} visobject - visobject for wich to load the tags. Must be a recording visobject.\n   * @return Promise resolved with tags of given visobject. If the visobject is\n   * not a recording, then the promise resolves to an empty array.\n   */\n\n\n  this.loadTags = function () {\n    var visobject = this.visobject;\n\n    if (!visobject || !/^recording$/.test(visobject.type)) {\n      this.tags = [];\n      return $q.resolve(this.tags);\n    }\n\n    this.loading = true;\n    this.visobject = visobject;\n    return a2Tags.getFor(visobject).then(function (tags) {\n      this.tagsIndex = makeTagsIndex(tags);\n      this.spectrogramTags = groupByBbox(tags);\n      this.tags = tags;\n      return tags;\n    }.bind(this)).finally(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#searchedTags\n   * @description Array of tags returned by the last tag search.\n   */\n\n\n  this.searchedTags = [];\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#searchTags\n   * @description Searched for tags using the given text.\n   * @param {String} text - text to match in the tags search.\n   * @return Promise resolved with the searched tags. Also, searched tags are set in searchedTags.\n   */\n\n  this.searchTags = function (text) {\n    if (text === '' || !text) {\n      this.getProjectTags();\n    }\n\n    return lookaheadHelper.search(text).then(function (tags) {\n      this.searchedTags = tags;\n    }.bind(this));\n  };\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#onTagListChanged\n   * @description Called whenever the list of tags needs to be checked for changes.\n   * @return Promise resolved whenever the list of tags has been checked entirely.\n   */\n\n\n  this.onTagListChanged = $debounce(function () {\n    var tagUpdate = this.determineTagUpdate(this.tags, this.tagsIndex);\n    return this.updateTags(tagUpdate);\n  }, 100);\n  this.onBBoxTagListChanged = $debounce(function () {\n    var tagUpdate = this.determineTagUpdate(this.bboxTags);\n    this.bboxTags = [];\n    var bbox = this.bbox.bbox;\n    tagUpdate.add.forEach(function (tag) {\n      tag.t0 = bbox.x1;\n      tag.f0 = bbox.y1;\n      tag.t1 = bbox.x2;\n      tag.f1 = bbox.y2;\n    });\n    return this.updateTags(tagUpdate).then;\n  });\n\n  this.getProjectTags = function () {\n    return a2Tags.getForType('recording').then(function (tags) {\n      this.searchedTags = tags;\n    }.bind(this));\n  };\n\n  this.getProjectTags();\n\n  this.determineTagUpdate = function (tags, oldTagsIndex) {\n    var tagsIndex = makeTagsIndex(tags);\n    var toDelete = Object.keys(oldTagsIndex || {}).filter(function (tagId) {\n      return !tagsIndex[tagId];\n    });\n    var toAdd = tags.filter(function (tag) {\n      return !tag.id;\n    });\n    return {\n      add: toAdd,\n      delete: toDelete\n    };\n  };\n\n  this.updateTags = function (tagUpdate) {\n    var visobject = this.visobject;\n    console.log(\"visobject : \", visobject);\n    console.log(\"tag update : \", tagUpdate);\n    return $q.all([$q.all(tagUpdate.delete.map(function (tagId) {\n      return a2Tags.deleteFor(visobject, tagId);\n    })), $q.all(tagUpdate.add.map(function (tag) {\n      return a2Tags.addFor(visobject, tag);\n    }))]).then(function (updateResponse) {\n      return this.loadTags();\n    }.bind(this)).catch(function () {\n      // TODO:: notify user of failure... maybe should be done through a notification service...\n      return this.loadTags();\n    }.bind(this));\n  };\n\n  this.bbox = angular.extend(new a22PointBBoxEditor(), {\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    resetBboxTags: function () {\n      console.log(\"resetBboxTags\", this.bboxTags);\n      this.bboxTags = [];\n    }.bind(this),\n    reset: function () {\n      this.resetBboxTags();\n      this.super.reset.call(this);\n    }\n  });\n  VisualizerCtrl.on('visobject', this.setVisobject.bind(this));\n}).directive('a2Tag', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      tag: '='\n    },\n    template: '<span class=\"fa fa-tag no-text-wrap\">' + '{{tag.tag}}' + '</span>'\n  };\n});","angular.module('a2.visualizer.layers.soundscape-composition-tool', ['a2.srv.soundscape-composition', 'arbimon2.directive.validation-dropdown']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.soundscape-composition-tool.object:soundscape-composition-tool\n   * @description Recording tags layer.\n   * adds the soundscape-composition-tool layer_type to layer_types. This layer uses\n   * a2.visualizer.layer.soundscape-composition-tool.controller:a2VisualizerSoundscapeCompositionToolController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-composition-tool\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeCompositionToolController as controller',\n    display: {\n      spectrogram: false\n    },\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n})\n/**\n * @ngdoc controller\n * @name a2.visualizer.layer.soundscape-composition-tool.controller:a2VisualizerSoundscapeCompositionToolController\n * @description Controller for recording tags layer in visualizer.\n * Gets injected an instance of VisualizerCtrl representing the visualizer control.\n * Responds to VisualizerCtrl.event::visobject by loading the visobject tags, if it is a\n * recording.\n */\n.controller('a2VisualizerSoundscapeCompositionToolController', function ($q, VisualizerCtrl, a2UserPermit, notify, a2SoundscapeCompositionService) {\n  this.initialize = function () {\n    VisualizerCtrl.on('visobject', this.setVisobject.bind(this));\n    a2SoundscapeCompositionService.getClassList({\n      groupByType: true,\n      isSystemClass: 1\n    }).then(function (classesByType) {\n      this.classTypes = classesByType;\n      this.classesByType = classesByType.reduce(function (_, type) {\n        _[type.type] = type;\n        return _;\n      }, {});\n    }.bind(this));\n    this.annotations = {};\n    this.annotationToolbar = [[{\n      value: 1,\n      caption: \"Annotate as Present\"\n    }, {\n      value: 0,\n      caption: \"Annotate as Absent\"\n    }], [{\n      value: 2,\n      caption: \"Clear Annotation\"\n    }]];\n  };\n\n  this.annotate = function (val, classId) {\n    if (!a2UserPermit.can('validate species')) {\n      notify.error('You do not have permission to add soundscape composition annotations.');\n      return;\n    }\n\n    var keys = [classId];\n\n    if (keys.length > 0) {\n      a2SoundscapeCompositionService.annotate(this.visobject, {\n        'class': keys.join(','),\n        val: val\n      }).then(function (annotations) {\n        this.is_selected = {};\n        annotations.forEach(function (annotation) {\n          if (annotation.present == 2) {\n            delete this.annotations[annotation.scclassId];\n          } else {\n            this.annotations[annotation.scclassId] = annotation.present;\n          }\n        }.bind(this));\n      }.bind(this));\n    }\n  };\n\n  this.setVisobject = function (visobject) {\n    this.visobject = visobject;\n    return this.loadAnnotations();\n  };\n\n  this.loadAnnotations = function () {\n    var visobject = this.visobject;\n\n    if (!visobject || !/^recording$/.test(visobject.type)) {\n      this.annotations = {};\n      return $q.resolve(this.annotations);\n    }\n\n    this.loading = true;\n    this.visobject = visobject;\n    return a2SoundscapeCompositionService.getAnnotationsFor(visobject).then(function (annotations) {\n      this.annotations = annotations;\n      return annotations;\n    }.bind(this)).finally(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.initialize();\n});","angular.module('a2.visualizer.layers.templates', ['visualizer-services', 'a2.utils']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.templates.object:templates\n   * @description Templates layer.\n   * adds the templates layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.templates.controller:a2VisualizerTemplateLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"templates\",\n    title: \"\",\n    controller: 'a2VisualizerTemplateLayerController as templates',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerTemplateLayerController', function ($scope, $modal, $controller, $state, $timeout, a2Templates, a2UserPermit, a22PointBBoxEditor, Project, notify) {\n  var self = this;\n  self.selected = null;\n  self.templates = [];\n  self.recordingTemplates = [];\n  self.citizenScientistUser = a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper();\n  Project.getClasses(function (project_classes) {\n    self.project_classes = project_classes;\n  });\n  var getTemplatesPromise = a2Templates.getList({\n    projectTemplates: true\n  }).then(function (templates) {\n    self.templates = templates;\n    return templates;\n  });\n\n  self.updateState = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n    getTemplatesPromise.then(function () {\n      self.recordingTemplates = self.templates.filter(function (template) {\n        return template.recording == rec;\n      });\n    });\n    self.editor.reset();\n    self.editor.recording = rec;\n  };\n\n  self.goToSpeciesPage = function () {\n    $state.go('audiodata.species', {});\n  };\n\n  self.editor = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.roi = null;\n    },\n    make_new_bbox: function () {\n      this.super.make_new_bbox.call(this);\n      this.roi = this.bbox;\n    },\n    make_new_roi: function () {\n      this.make_new_bbox();\n    },\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      console.log('add_point : function(', point, ', ', min_eps, '){');\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    get_placeholder_name: function () {\n      return this.project_class ? this.project_class.species_name + ' ' + this.project_class.songtype_name : 'Template Name';\n    },\n    submit: function () {\n      if (!a2UserPermit.can('manage templates')) {\n        notify.error('You do not have permission to add a template');\n        return;\n      }\n\n      if (!this.project_class.songtype_name && !this.project_class.species_name) {\n        return;\n      }\n\n      this.submitting = true;\n      a2Templates.add({\n        name: this.template_name || this.project_class.species_name + \" \" + this.project_class.songtype_name,\n        recording: this.recording,\n        species: this.project_class.species,\n        songtype: this.project_class.songtype,\n        roi: this.roi\n      }).then(function (new_template) {\n        console.log('new_template', new_template);\n        this.submitting = false;\n        if (new_template.id === 0) return notify.error('The template with that name already exists for this record.');\n        $timeout(function () {\n          this.reset();\n          self.templates.push(new_template);\n          self.updateState();\n        }.bind(this));\n      }.bind(this));\n    }\n  });\n  $scope.$watch('visobject', self.updateState);\n}) // .controller('a2VisualizerAddTemplateModalController', function($scope, $modalInstance, Project, a2Templates){\n//     $scope.data = {\n//         name : '',\n//         type : null\n//     };\n//\n//     $scope.loadingClasses = true;\n//\n//     Project.getClasses(function(project_classes){\n//         $scope.project_classes = project_classes;\n//         $scope.loadingClasses = false;\n//     });\n//\n//     $scope.loadingTypes = true;\n//\n//     a2Templates.getTypes(function(template_types){\n//         $scope.template_types = template_types;\n//         if(template_types && template_types.length == 1) {\n//             $scope.data.type = template_types[0];\n//             $scope.loadingTypes = false;\n//         }\n//     });\n//\n//     $scope.ok = function(){\n//         $scope.creating = true;\n//         $scope.validation = {\n//             count:0\n//         };\n//\n//         var template_data = {};\n//\n//         if($scope.data.name){\n//             template_data.name = $scope.data.name;\n//         }\n//         else {\n//             $scope.validation.name = \"Training set name is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         if($scope.data.type && $scope.data.type.id){\n//             template_data.type = $scope.data.type.identifier;\n//         }\n//         else {\n//             $scope.validation.type = \"Training set type is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         if($scope.data.class) {\n//             template_data.class = $scope.data.class.id;\n//         }\n//         else {\n//             $scope.validation.class = \"Species sound is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         // $scope.form_data=template_data;\n//\n//         if($scope.validation.count ===  0) {\n//             a2Templates.add(template_data, function(new_template) {\n//                 if(new_template.error) {\n//\n//                     var field = new_template.field || 'error';\n//\n//                     $scope.validation[field] = new_template.error;\n//\n//                     return;\n//                 }\n//                 $modalInstance.close(new_template);\n//             });\n//         }\n//         else {\n//             $scope.creating = false;\n//         }\n//     };\n// })\n;","angular.module('a2.visobjects.audio-event-detection', ['a2.services', 'a2.visobjects.common', 'a2.service.plotly-plot-maker']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'audio-event-detection',\n    $loader: ['VisualizerObjectAudioEventDetectionTypeLoader', function (VisualizerObjectAudioEventDetectionTypeLoader) {\n      return VisualizerObjectAudioEventDetectionTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectAudioEventDetectionTypeLoader', function ($q, AudioEventDetectionService, plotlyPlotMaker, a2UrlUpdate) {\n  var aggregates;\n  var statisticsInfo;\n  var getParameters = $q.resolve().then(function () {\n    return $q.all([AudioEventDetectionService.getDataAggregatesList().then(function (_aggregates) {\n      aggregates = _aggregates;\n    }), AudioEventDetectionService.getDataStatisticsList().then(function (_statistics) {\n      statisticsInfo = _statistics.reduce(function (_, $) {\n        return _[$.statistic] = $, _;\n      }, {});\n    })]);\n  });\n\n  var AudioEventDetection = function (data) {\n    this.update(data).then(function () {\n      return getParameters;\n    }.bind(this)).then(function () {\n      return this.selectData({\n        x: statisticsInfo.tod,\n        y: statisticsInfo.y_max,\n        z: aggregates.reduce(function (_, $) {\n          return $.statistic == 'count' ? $ : _;\n        }, null)\n      });\n    }.bind(this));\n  };\n\n  AudioEventDetection.fetch = function (visobject) {\n    var d = $q.defer();\n    visobject = new AudioEventDetection(visobject);\n    d.resolve(visobject);\n    return d.promise;\n  };\n\n  AudioEventDetection.load = function (visobject, $scope) {\n    return AudioEventDetection.fetch(visobject);\n  };\n\n  AudioEventDetection.getCaptionFor = function (visobject) {\n    return visobject.name;\n  };\n\n  AudioEventDetection.prototype = {\n    type: \"audio-event-detection\",\n    layout: 'plotted',\n    zoomable: false,\n    update: function (data) {\n      console.log(\"AED data : \", data);\n\n      for (var i in data) {\n        this[i] = data[i];\n      }\n\n      this.plot = {\n        layout: {\n          title: data.name\n        },\n        data: []\n      };\n\n      if (data.statistics.indexOf('todsec') == -1) {\n        data.statistics.push('todsec', 'todsecspan', 'freqspan');\n      }\n\n      return getParameters.then(function () {\n        var statistics = data.statistics.reduce(function (_, $) {\n          return statisticsInfo[$] && _.push(statisticsInfo[$]), _;\n        }, []);\n        this.data_selection = {\n          x: statistics,\n          y: statistics,\n          z: aggregates,\n          current: {\n            x: statisticsInfo.tod,\n            y: statisticsInfo.y_max,\n            z: aggregates.reduce(function (_, $) {\n              return $.statistic == 'count' ? $ : _;\n            }, null)\n          }\n        };\n      }.bind(this));\n    },\n    selectData: function (selection) {\n      this.data_selection.current = angular.extend({}, this.data_selection.current, selection);\n      var x = this.data_selection.current.x,\n          y = this.data_selection.current.y,\n          z = this.data_selection.current.z;\n      console.log(\"this.data_selection.current\", this.data_selection.current);\n      return AudioEventDetectionService.getDataFor(this.id, x, y, z).then(function (data) {\n        var plot = x == y ? plotlyPlotMaker.makeBarPlot(x, z, data, this.name) : plotlyPlotMaker.makeHeatmapPlot(x, y, z, data, this.name);\n        this.plot.data = [plot.data];\n        this.plot.layout = plot.layout;\n      }.bind(this));\n    },\n    savePlot: function () {\n      var x = this.data_selection.current.x,\n          y = this.data_selection.current.y,\n          z = this.data_selection.current.z;\n      return AudioEventDetectionService.savePlotFor(this.id, x, y, z).then(function (data) {\n        a2UrlUpdate.update(data.url);\n      });\n    },\n    getCaption: function () {\n      return AudioEventDetection.getCaptionFor(this);\n    }\n  };\n  return AudioEventDetection;\n});","angular.module('a2.visobjects.common', []).provider('VisualizerObjectTypes', function () {\n  var types = {};\n  var defers = {};\n  return {\n    add: function (typeDef) {\n      types[typeDef.type] = angular.extend(types[typeDef.type] || {}, typeDef);\n    },\n    $get: function ($injector) {\n      return {\n        types: types,\n        getLoader: function (type) {\n          if (!types[type]) {\n            throw new Error(\"Visualizer Object Type '\" + type + \"' not found\");\n          }\n\n          return $injector.invoke(types[type].$loader);\n        }\n      };\n    }\n  };\n});","angular.module('a2.visobjects.recording', ['a2.services', 'a2.visobjects.common']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'recording',\n    $loader: ['VisualizerObjectRecordingTypeLoader', function (VisualizerObjectRecordingTypeLoader) {\n      return VisualizerObjectRecordingTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectRecordingTypeLoader', function ($q, Project, $localStorage) {\n  var khz_format = function (v) {\n    return v / 1000 | 0;\n  };\n\n  var getSelectedFrequencyCache = function () {\n    try {\n      return JSON.parse($localStorage.getItem('visuilizer.frequencies.cache')) || {\n        originalScale: true\n      };\n    } catch (e) {\n      return {\n        originalScale: true\n      };\n    }\n  };\n\n  var scaleCache = getSelectedFrequencyCache();\n\n  var recording = function (data, extra) {\n    for (var i in data) {\n      this[i] = data[i];\n    }\n\n    this.sampling_rate = this.sample_rate;\n    this.extra = extra;\n    this.max_freq = this.sampling_rate / 2;\n    this.span = scaleCache && scaleCache.originalScale ? this.max_freq : this.max_freq > 24000 ? this.max_freq : 24000;\n\n    if (!data) {\n      this.span = 44100 / 2;\n      this.duration = 60;\n    }\n\n    this.domain = {\n      x: {\n        from: 0,\n        to: this.duration,\n        span: this.duration,\n        unit: 'Time ( s )',\n        ticks: 60\n      },\n      y: {\n        from: 0,\n        to: this.span,\n        span: this.span,\n        unit: 'Frequency ( kHz )',\n        tick_format: khz_format\n      }\n    };\n\n    if (!this.tiles) {\n      this.isDisabled = true;\n      return;\n    } // set it to the scope\n\n\n    this.tiles.set.forEach(function (tile) {\n      if (!!data.legacy) {\n        tile.src = \"/api/project/\" + Project.getUrl() + \"/recordings/tiles/\" + this.id + \"/\" + tile.i + \"/\" + tile.j;\n      } else {\n        var streamId = data.uri.split('/')[3];\n        const datetime = data.datetime_utc ? data.datetime_utc : data.datetime;\n        var start = new Date(new Date(datetime).valueOf() + Math.round(tile.s * 1000)).toISOString();\n        var end = new Date(new Date(datetime).valueOf() + Math.round((tile.s + tile.ds) * 1000)).toISOString();\n        tile.src = '/api/ingest/recordings/' + streamId + '_t' + start.replace(/-|:|\\./g, '') + '.' + end.replace(/-|:|\\./g, '') + '_z95_wdolph_g1_fspec_mtrue_d1023.255.png';\n      }\n    }.bind(this));\n  };\n\n  recording.layers = [];\n\n  recording.fetch = function (visobject) {\n    var d = $q.defer();\n    Project.getRecordingInfo(visobject.id, function (data) {\n      if (data === 'Server error') {\n        visobject.isDisabled = true;\n        data = {};\n      }\n\n      visobject = new recording(data, visobject.extra);\n      d.resolve(visobject);\n    });\n    return d.promise;\n  };\n\n  recording.load = function (visobject, $scope) {\n    return recording.fetch(visobject).then(function (visobject) {\n      if (visobject.audioUrl) {\n        $scope.audio_player.load(visobject.audioUrl);\n      }\n\n      return visobject;\n    });\n  };\n\n  recording.getCaptionFor = function (visobject) {\n    return visobject.file;\n  };\n\n  recording.prototype = {\n    type: \"recording\",\n    zoomable: true,\n    getCaption: function () {\n      return recording.getCaptionFor(this);\n    }\n  };\n  return recording;\n});","angular.module('a2.visobjects.soundscape', ['a2.services', 'a2.visobjects.common']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'soundscape',\n    $loader: ['VisualizerObjectSoundscapeTypeLoader', function (VisualizerObjectSoundscapeTypeLoader) {\n      return VisualizerObjectSoundscapeTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectSoundscapeTypeLoader', function ($q, Project) {\n  var khz_format = function (v) {\n    return v / 1000 | 0;\n  };\n\n  var khz_unit_fmt = function (v) {\n    return Math.floor(v / 10.0) / 100.0 + \" kHz\";\n  };\n\n  var aggregations = {\n    'time_of_day': {\n      time_unit: 'Time (Hour in Day)',\n      unit_fmt: function (v) {\n        return (v | 0) + \":00\";\n      }\n    },\n    'day_of_month': {\n      time_unit: 'Time (Day in Month)',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'day_of_year': {\n      time_unit: 'Time (Day in Year )',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'month_in_year': {\n      time_unit: 'Time (Month in Year)',\n      unit_fmt: function (v) {\n        return moment().localeData()._months[(v | 0) - 1];\n      }\n    },\n    'day_of_week': {\n      time_unit: 'Time (Weekday) ',\n      unit_fmt: function (v) {\n        return moment().localeData()._weekdays[(v | 0) - 1];\n      }\n    },\n    'year': {\n      time_unit: 'Time (Year) ',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'unknown': {\n      time_unit: 'Time',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    }\n  };\n\n  var soundscape = function (data) {\n    this.update(data);\n  };\n\n  soundscape.fetch = function (visobject) {\n    var d = $q.defer();\n    visobject = new soundscape(visobject);\n    d.resolve(visobject);\n    return d.promise;\n  };\n\n  soundscape.load = function (visobject, $scope) {\n    return soundscape.fetch(visobject);\n  };\n\n  soundscape.getCaptionFor = function (visobject) {\n    var agg = {\n      'time_of_day': 'Time of day',\n      'day_of_month': 'Day of Month',\n      'day_of_year': 'Day of Year',\n      'month_in_year': 'Month in year',\n      'day_of_week': 'Day of week',\n      'year': 'Year '\n    };\n    return visobject.name + \" (\" + agg[visobject.aggregation] + \")\";\n  };\n\n  soundscape.prototype = {\n    type: \"soundscape\",\n    zoomable: true,\n    update: function (data) {\n      for (var i in data) {\n        this[i] = data[i];\n      }\n\n      var t0 = this.min_t,\n          t1 = this.max_t;\n      var f0 = this.min_f,\n          f1 = this.max_f;\n      var v0 = this.min_value,\n          v1 = this.visual_max_value || this.max_value;\n\n      if (this.normalized) {\n        v0 = 0;\n        v1 = 100;\n      }\n\n      var dt = t1 - t0 + 1,\n          df = f1 - f0,\n          dv = v1 - v0;\n      var aggregation = aggregations[this.aggregation] || aggregations.unknown;\n      var time_unit = aggregation.time_unit; // setup the domains\n\n      this.domain = {\n        x: {\n          // from : t0, to : t1 + 1, span : dt + 1, ticks : dt + 1,\n          from: t0,\n          to: t1,\n          span: dt,\n          ticks: dt,\n          ordinal: true,\n          unit_interval: 1,\n          unit_format: aggregation.unit_fmt,\n          unit: time_unit || 'Time ( s )'\n        },\n        y: {\n          from: f0,\n          to: f1,\n          span: df,\n          unit: 'Frequency ( kHz )',\n          unit_interval: this.bin_size,\n          unit_format: khz_unit_fmt,\n          tick_format: khz_format\n        },\n        legend: {\n          from: v0,\n          to: v1,\n          span: dv,\n          ticks: Math.max(2, Math.min(dv | 0, 10)),\n          unit: 'Count',\n          src: '/images/palettes/' + this.visual_palette + '.png'\n        }\n      };\n\n      if (this.normalized) {\n        this.domain.legend.tick_format = function (v) {\n          return v + '%';\n        };\n      } // set it to the scope\n\n\n      this.tiles = {\n        x: 1,\n        y: 1,\n        set: [{\n          i: 0,\n          j: 0,\n          s: 0,\n          hz: f1,\n          ds: dt,\n          dhz: df,\n          src: this.thumbnail,\n          crisp: true\n        }]\n      };\n      this.legend = {\n        min: 0,\n        max: 255\n      };\n    },\n    getCaption: function () {\n      return soundscape.getCaptionFor(this);\n    }\n  };\n  return soundscape;\n});","angular.module('a2.visobjects', ['a2.visobjects.common', 'a2.visobjects.recording', 'a2.visobjects.soundscape', 'a2.visobjects.audio-event-detection']);","angular.module('a2.analysis.random-forest-models.classification', ['ui.bootstrap', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models.classification', {\n    url: '/classification',\n    controller: 'ClassificationCtrl',\n    templateUrl: '/app/analysis/random-forest-models/classification/list.html'\n  });\n}).controller('ClassificationCtrl', function ($scope, $modal, $filter, Project, ngTableParams, JobsData, a2Playlists, notify, $location, a2Classi, a2UserPermit) {\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.classificationsOriginal, params.filter()) : $scope.classificationsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.classificationsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No classifications found.\";\n        }\n\n        $scope.classificationsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Classi.saveState({\n          'data': $scope.classificationsOriginal,\n          'filtered': $scope.classificationsData,\n          'f': params.filter(),\n          'o': params.orderBy(),\n          'p': params.page(),\n          'c': params.count(),\n          't': orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  };\n\n  $scope.capitalize = function (row) {\n    return row.length ? row[0].toUpperCase() + row.slice(1) : row;\n  };\n\n  $scope.loadClassifications = function () {\n    a2Classi.list(function (data) {\n      $scope.classificationsOriginal = data;\n      data.forEach(function (row) {\n        row.muser = $scope.capitalize(row.firstname) + \" \" + $scope.capitalize(row.lastname);\n      });\n      $scope.classificationsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No classifications found.\";\n      }\n    });\n  };\n\n  $scope.showClassificationDetails = function (classi) {\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var data = {\n      id: classi.job_id,\n      name: classi.cname,\n      modelId: classi.model_id,\n      playlist: {\n        name: classi.playlist_name,\n        id: classi.playlist_id\n      }\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/classinfo.html',\n      controller: 'ClassiDetailsInstanceCtrl',\n      windowClass: 'details-modal-window',\n      backdrop: 'static',\n      resolve: {\n        ClassiInfo: function () {\n          return {\n            data: data,\n            project: $scope.projectData\n          };\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n  };\n\n  $scope.createNewClassification = function () {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to create classifications');\n      return;\n    }\n\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/createnewclassification.html',\n      controller: 'CreateNewClassificationInstanceCtrl',\n      resolve: {\n        data: function ($q) {\n          var d = $q.defer();\n          Project.getModels(function (err, data) {\n            if (err) {\n              console.error(err);\n            }\n\n            d.resolve(data || []);\n          });\n          return d.promise;\n        },\n        playlists: function ($q) {\n          var d = $q.defer();\n          a2Playlists.getList().then(function (data) {\n            d.resolve(data || []);\n          });\n          return d.promise;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new classification is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      }\n\n      if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      }\n\n      if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteClassification = function (id, name) {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to delete classifications');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/deleteclassification.html',\n      controller: 'DeleteClassificationInstanceCtrl',\n      resolve: {\n        name: function () {\n          return name;\n        },\n        id: function () {\n          return id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.classificationsOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].job_id === id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.classificationsOriginal.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Classification deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.loading = true;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n  });\n  var stateData = a2Classi.getState();\n\n  if (stateData === null) {\n    $scope.loadClassifications();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.classificationsData = stateData.filtered;\n      $scope.classificationsOriginal = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n}).controller('DeleteClassificationInstanceCtrl', function ($scope, $modalInstance, a2Classi, name, id, projectData) {\n  $scope.name = name;\n  $scope.id = id;\n  $scope.deletingloader = false;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2Classi.delete(id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('ClassiDetailsInstanceCtrl', function ($scope, $modalInstance, a2Classi, a2Models, notify, a2UserPermit, ClassiInfo) {\n  var loadClassifiedRec = function () {\n    a2Classi.getResultDetails($scope.classiData.id, $scope.currentPage * $scope.maxPerPage, $scope.maxPerPage, function (dataRec) {\n      a2Classi.getRecVector($scope.classiData.id, dataRec[0].recording_id).success(function (data) {\n        var maxVal = Math.max.apply(null, data.vector);\n\n        if (typeof $scope.th === 'number') {\n          $scope.htresDeci = maxVal < $scope.th ? 'no' : 'yes';\n        }\n\n        $scope.recVect = data.vector;\n        $scope.recs = dataRec;\n        $scope.minv = dataRec[0].stats.minv;\n        $scope.maxv = dataRec[0].stats.maxv;\n        $scope.maxvRounded = Math.round($scope.maxv * 1000) / 1000;\n      });\n    });\n  };\n\n  $scope.ok = function () {\n    $modalInstance.close();\n  };\n\n  $scope.next = function () {\n    $scope.currentPage = $scope.currentPage + 1;\n\n    if ($scope.currentPage * $scope.maxPerPage >= $scope.classiData.total) {\n      $scope.currentPage = $scope.currentPage - 1;\n    } else {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.prev = function () {\n    $scope.currentPage = $scope.currentPage - 1;\n\n    if ($scope.currentPage < 0) {\n      $scope.currentPage = 0;\n    } else {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.gotoc = function (where) {\n    if (where == 'first') {\n      $scope.currentPage = 0;\n    }\n\n    if (where == 'last') {\n      $scope.currentPage = Math.ceil($scope.classiData.total / $scope.maxPerPage) - 1;\n    }\n\n    loadClassifiedRec();\n  };\n\n  $scope.toggleRecDetails = function () {\n    $scope.showMore = !$scope.showMore;\n\n    if ($scope.showMore && !$scope.recs) {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.loading = true;\n  $scope.htresDeci = '-';\n  $scope.classiData = ClassiInfo.data;\n  $scope.project = ClassiInfo.project;\n  $scope.showMore = false;\n  $scope.currentPage = 0;\n  $scope.maxPerPage = 1;\n  $scope.csvUrl = \"/api/project/\" + $scope.project.url + \"/classifications/csv/\" + $scope.classiData.id;\n  $scope.showDownload = a2UserPermit.can('manage models and classification');\n  console.table($scope.classiData);\n  a2Classi.getDetails($scope.classiData.id, function (data) {\n    if (!data) {\n      $modalInstance.close();\n      notify.log(\"No details available for this classification\");\n      return;\n    }\n\n    angular.extend($scope.classiData, data);\n    $scope.totalRecs = Math.ceil($scope.classiData.total / $scope.maxPerPage);\n    console.log($scope.classiData);\n    $scope.results = [['absent', $scope.classiData.total - $scope.classiData.present], ['present', $scope.classiData.present], ['skipped', $scope.classiData.errCount]];\n    a2Models.findById($scope.classiData.modelId).success(function (modelInfo) {\n      console.log(modelInfo);\n      $scope.model = modelInfo;\n      $scope.loading = false;\n    }).error(function (err) {\n      $scope.loading = false;\n    });\n  });\n}).controller('CreateNewClassificationInstanceCtrl', function ($scope, $modalInstance, a2Classi, data, projectData, playlists) {\n  $scope.data = data;\n  $scope.projectData = projectData;\n  $scope.recselected = '';\n  $scope.showselection = false;\n  $scope.playlists = playlists;\n  $scope.nameMsg = '';\n  $scope.datas = {\n    name: '',\n    classifier: '',\n    playlist: ''\n  };\n  $scope.$watch('recselected', function () {\n    if ($scope.recselected === 'selected') {\n      $scope.showselection = true;\n    } else {\n      $scope.showselection = false;\n    }\n  });\n\n  $scope.ok = function () {\n    $scope.nameMsg = '';\n    var url = $scope.projectData.url;\n    $scope.all = 0;\n    $scope.selectedSites = []; // NOTE temporary block disabled model types\n\n    if (!$scope.datas.classifier.enabled) return;\n    var classiData = {\n      n: $scope.datas.name,\n      c: $scope.datas.classifier.model_id,\n      a: $scope.all,\n      s: $scope.selectedSites.join(),\n      p: $scope.datas.playlist\n    };\n    a2Classi.create(classiData, function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    });\n  };\n\n  $scope.buttonEnable = function () {\n    /*\n        var flag = false;\n        if ($scope.recselected === 'all')\n            flag = true;\n        else\n        {\n            var numberOfChecked = $('input:checkbox:checked').length;\n            if (numberOfChecked>0)\n            {\n                flag = true;\n            }\n         }\n    */\n    return !(typeof $scope.datas.playlist !== 'string' && $scope.datas.name.length && typeof $scope.datas.classifier !== 'string');\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n}).directive('a2Vectorchart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      vectorData: '=',\n      minvect: '=',\n      maxvect: '='\n    },\n    templateUrl: '/app/analysis/random-forest-models/classification/vectorchart.html',\n    controller: function ($scope) {\n      $scope.loadingflag = true;\n\n      $scope.drawVector = function () {\n        if (!$scope.vectorData) return;\n        $scope.loadingflag = true;\n        var canvas = $scope.canvas;\n        var vector = $scope.vectorData;\n        var height = 50;\n        var width = $scope.width;\n        var xStep;\n\n        if (width >= vector.length) {\n          canvas.width = width;\n          xStep = width / vector.length;\n        } else {\n          canvas.width = vector.length;\n          xStep = 1;\n        }\n\n        canvas.height = height;\n        ctx = canvas.getContext('2d');\n        ctx.beginPath();\n        var i = 0;\n        ctx.moveTo(i * xStep, height * (1 - (vector[i] - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n\n        while (i < vector.length) {\n          i++;\n          ctx.lineTo(i * xStep, height * (1 - (vector[i] - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n        }\n\n        ctx.strokeStyle = '#000';\n        ctx.stroke();\n\n        if ($scope.minvect < -0.09) {\n          //code\n          ctx.beginPath();\n          i = 0;\n          ctx.moveTo(i * xStep, height * (1 - (0 - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n\n          while (i < vector.length) {\n            i++;\n            ctx.lineTo(i * xStep, height * (1 - (0 - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n          }\n\n          ctx.strokeStyle = '#aa0000';\n          ctx.stroke();\n        }\n\n        $scope.loadingflag = false;\n      };\n\n      $scope.$watch('vectorData', function () {\n        $scope.drawVector();\n      });\n    },\n    link: function (scope, element) {\n      scope.canvas = element.children()[0];\n      scope.width = parseInt(element.css('width'));\n    }\n  };\n});","angular.module('a2.analysis.random-forest-models.models', ['a2.services', 'a2.permissions', 'a2.utils', 'ui.bootstrap', 'ui.select', 'ngSanitize', 'ngTable', 'ngCsv', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models.models', {\n    url: '/models',\n    controller: 'ModelsCtrl',\n    templateUrl: '/app/analysis/random-forest-models/models/list.html'\n  }).state('analysis.modeldetails', {\n    url: '/model/:modelId',\n    controller: 'ModelDetailsCtrl',\n    templateUrl: '/app/analysis/random-forest-models/models/modelinfo.html'\n  });\n}).controller('ModelsCtrl', function ($scope, $modal, $filter, ngTableParams, Project, a2Models, JobsData, $location, notify, a2UserPermit) {\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = true;\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  };\n\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n  });\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    $scope.tableParams = new ngTableParams({\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    }, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.modelsDataOrig, params.filter()) : $scope.modelsDataOrig;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : filteredData;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No models found.\";\n        }\n\n        $scope.modelsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Models.saveState({\n          data: $scope.modelsDataOrig,\n          filtered: $scope.modelsData,\n          f: params.filter(),\n          o: params.orderBy(),\n          p: params.page(),\n          c: params.count(),\n          t: orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.loadModels = function () {\n    a2Models.list(function (data) {\n      $scope.modelsData = data;\n      $scope.modelsDataOrig = data;\n      $scope.showInfo = false;\n      $scope.loading = false;\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+mname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No models found.\";\n      }\n    });\n  };\n\n  var stateData = a2Models.getState();\n\n  if (stateData === null) {\n    $scope.loadModels();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.modelsData = stateData.filtered;\n      $scope.modelsDataOrig = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n\n  $scope.deleteModel = function (model_id, model_name) {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to delete models');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/models/deletemodel.html',\n      controller: 'DeleteModelInstanceCtrl',\n      resolve: {\n        model_name: function () {\n          return model_name;\n        },\n        model_id: function () {\n          return model_id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.error) {\n        notify.error(\"Error: \" + ret.error);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.modelsDataOrig);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].model_id === model_id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.modelsDataOrig.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Model deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.model_id = null;\n  $scope.validationdata = null;\n\n  $scope.newModel = function () {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to create models');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var url = $scope.projectData.url;\n    a2Models.getFormInfo(function (data) {\n      var modalInstance = $modal.open({\n        templateUrl: '/app/analysis/random-forest-models/models/newmodel.html',\n        controller: 'NewModelInstanceCtrl',\n        resolve: {\n          projectData: function () {\n            return $scope.projectData;\n          },\n          types: function () {\n            var typesEnable = data.types.filter(function (type) {\n              return type.enabled;\n            });\n            return typesEnable;\n          },\n          trainings: function () {\n            return data.trainings;\n          }\n        }\n      });\n      modalInstance.opened.then(function () {\n        $scope.infoInfo = \"\";\n        $scope.showInfo = false;\n        $scope.loading = false;\n      });\n      modalInstance.result.then(function (result) {\n        if (result.ok) {\n          JobsData.updateJobs();\n          notify.log(\"Your new model training is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n        }\n\n        if (result.error) {\n          notify.error(\"Error \" + result.error);\n        }\n\n        if (result.url) {\n          $location.path(result.url);\n        }\n      });\n    });\n  };\n}).controller('NewModelInstanceCtrl', function ($scope, $modalInstance, a2Models, Project, projectData, types, trainings, notify, $http) {\n  $scope.types = types;\n  $scope.projectData = projectData;\n  $scope.trainings = trainings;\n  $scope.nameMsg = '';\n  $scope.data = {\n    training: '',\n    classifier: '',\n    name: '',\n    totalValidations: 'Retrieving...',\n    presentValidations: '-',\n    absentsValidations: '-',\n    usePresentTraining: '',\n    useNotPresentTraining: '',\n    usePresentValidation: -1,\n    useNotPresentValidation: -1\n  };\n  $http.get('/api/jobs/types').success(function (jobTypes) {\n    var training = jobTypes.filter(function (type) {\n      return type.name === \"Model training\";\n    });\n    if (!training.length) return console.error('training job info not found');\n    $scope.jobDisabled = !training[0].enabled;\n  });\n  $scope.totalPresentValidation = 0;\n  $scope.$watch('data.usePresentTraining', function () {\n    var val = $scope.data.presentValidations - $scope.data.usePresentTraining;\n\n    if (val > -1) {\n      $scope.data.usePresentValidation = val;\n    } else {\n      $scope.data.usePresentValidation = 0;\n    }\n\n    if ($scope.data.usePresentTraining > $scope.data.presentValidations) {\n      $scope.data.usePresentTraining = $scope.data.presentValidations;\n    }\n\n    $scope.totalPresentValidation = $scope.data.usePresentValidation;\n  });\n  $scope.totalNotPresentValidation = 0;\n  $scope.$watch('data.useNotPresentTraining', function () {\n    var val = $scope.data.absentsValidations - $scope.data.useNotPresentTraining;\n\n    if (val > -1) {\n      $scope.data.useNotPresentValidation = val;\n    } else $scope.data.useNotPresentValidation = 0;\n\n    if ($scope.data.useNotPresentTraining > $scope.data.absentsValidations) $scope.data.useNotPresentTraining = $scope.data.absentsValidations;\n    $scope.totalNotPresentValidation = $scope.data.useNotPresentValidation;\n  });\n  $scope.$watch('data.usePresentValidation', function () {\n    if ($scope.data.usePresentValidation > $scope.totalPresentValidation) {\n      $scope.data.usePresentValidation = $scope.totalPresentValidation;\n    }\n  });\n  $scope.$watch('data.useNotPresentValidation', function () {\n    if ($scope.data.useNotPresentValidation > $scope.totalNotPresentValidation) {\n      $scope.data.useNotPresentValidation = $scope.totalNotPresentValidation;\n    }\n  });\n  $scope.$watch('data.training', function () {\n    if ($scope.data.training !== '') {\n      Project.validationBySpeciesSong($scope.data.training.species_id, $scope.data.training.songtype_id, function (data) {\n        $scope.data.totalValidations = data.total;\n        $scope.data.presentValidations = data.present;\n        $scope.data.absentsValidations = data.absent;\n      });\n    }\n  });\n\n  $scope.disableCreateButton = function () {\n    return !($scope.trainings.length && $scope.data.name.length && $scope.totalNotPresentValidation > 0 && $scope.totalPresentValidation > 0 && $scope.data.usePresentTraining > 0 && $scope.data.useNotPresentTraining > 0 && $scope.data.usePresentValidation > 0 && $scope.data.useNotPresentValidation > 0 && typeof $scope.data.training !== 'string' && typeof $scope.data.classifier !== 'string' && !$scope.jobDisabled);\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n\n  $scope.ok = function () {\n    $scope.nameMsg = '';\n    a2Models.create({\n      n: $scope.data.name,\n      t: $scope.data.training.training_set_id,\n      c: $scope.data.classifier.model_type_id,\n      tp: parseInt($scope.data.usePresentTraining),\n      tn: parseInt($scope.data.useNotPresentTraining),\n      vp: parseInt($scope.data.usePresentValidation),\n      vn: parseInt($scope.data.useNotPresentValidation)\n    }).success(function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    }).error(function () {\n      $modalInstance.close({\n        err: \"Could not create job\"\n      });\n    });\n  };\n}).controller('DeleteModelInstanceCtrl', function ($scope, $modalInstance, a2Models, model_name, model_id, projectData, notify) {\n  $scope.model_name = model_name;\n  $scope.model_id = model_id;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    a2Models.delete(model_id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('NewClassificationInstanceCtrl', function ($scope, $modalInstance, model_name, model_id) {\n  $scope.model_name = model_name;\n  $scope.model_id = model_id;\n\n  $scope.ok = function () {\n    $modalInstance.close();\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('ModelDetailsCtrl', function ($scope, a2Models, $stateParams, $location, Project, a2Classi, notify, $window, a2UserPermit) {\n  var scopeExited = false;\n  $scope.$on('$destroy', function (argument) {\n    scopeExited = true;\n    a2Models.modelState(false);\n  });\n  /*\n      method recursively get validations vectors and then call waitinFunction()\n   */\n\n  var getVectors = function (index) {\n    if (scopeExited) return;\n    if (index >= $scope.validations.length) return $scope.waitinFunction();\n    var currRec = $scope.validations[index];\n    currRec.date = $window.moment(currRec.date, 'MM-DD-YYYY HH:mm');\n    a2Models.getRecVector($scope.model.id, currRec.id).success(function (data) {\n      if (!(data.err && data.err == \"vector-not-found\")) {\n        var vector = data.vector;\n        var vmax = Math.max.apply(null, vector);\n        var vmin = Math.min.apply(null, vector);\n        currRec.vmax = vmax;\n        currRec.vector = vector;\n        $scope.allMax.push(vmax);\n        $scope.allMin.push(vmin);\n\n        if (currRec.presence == 'no') {\n          if ($scope.vectorNoMax < vmax) {\n            $scope.vectorNoMax = vmax;\n          }\n        } else if (currRec.presence == 'yes') {\n          $scope.allYesMax.push(vmax);\n        }\n      }\n\n      getVectors(++index);\n    });\n  };\n\n  var loadingMsgs = ['', 'Loading validations', 'Loading vectors'];\n  $scope.loading = true;\n  $scope.showValidationsTable = true;\n  $scope.allYesMax = [];\n  $scope.allMax = [];\n  $scope.allMin = [];\n  $scope.vectorNoMax = -1;\n  $scope.loadingValidations = true;\n  $scope.showModelValidations = true;\n  $scope.messageSaved = '';\n  a2Models.modelState(true);\n  Project.getInfo(function (data) {\n    $scope.project_id = data.project_id;\n  });\n  a2Models.findById($stateParams.modelId).success(function (model) {\n    $scope.model = model;\n    $scope.loading = null;\n  }).error(function (data, status) {\n    if (status == 404) {\n      $scope.notFound = true;\n    } else {\n      notify.serverError();\n    }\n  });\n  a2Models.getValidationResults($stateParams.modelId, function (data) {\n    if (data.err || !data.validations.length) {\n      $scope.showModelValidations = false;\n      $scope.loadingValidations = false;\n      return;\n    }\n\n    $scope.validations = data.validations;\n    getVectors(0);\n  });\n\n  $scope.waitinFunction = function () {\n    $scope.loading = null;\n\n    if (!$scope.allYesMax.length) {\n      $scope.showModelValidations = false;\n      $scope.loadingValidations = false;\n    }\n\n    $scope.allYesMax = $scope.allYesMax.sort();\n    var index = 0;\n\n    for (var j = 0; j < $scope.allYesMax.length; j++) {\n      if ($scope.allYesMax[j] >= $scope.vectorNoMax) {\n        index = j;\n      }\n    } // NOTE this value is received from the server and overwritten here, maybe this value can be saved\n\n\n    $scope.model.maxv = Math.max.apply(null, $scope.allMax);\n    $scope.model.minv = Math.min.apply(null, $scope.allMin);\n    $scope.suggestedThreshold = Math.round($scope.allYesMax[index] * 1000000) / 1000000;\n\n    if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold)) {\n      $scope.suggestedThreshold = Math.round($scope.allYesMax[0] * 1000000) / 1000000;\n    }\n\n    if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold)) {\n      $scope.showModelValidations = false;\n    } else {\n      // TODO optimize this section\n      var searchTh = $scope.suggestedThreshold;\n      var thresholdObject = [];\n      var precisionObject = [];\n      var accuracyObject = [];\n      var sensitivityObject = [];\n      var specificityObject = [];\n      var sumObject = [];\n      var tries = 0;\n      var i, ii, jj;\n\n      while (searchTh > 0.01 && tries < 15) {\n        for (jj = 0; jj < $scope.validations.length; jj++) {\n          $scope.validations[jj].threshold = $scope.validations[jj].vmax > searchTh ? 'yes' : 'no';\n        }\n\n        $scope.computeStats();\n        thresholdObject.push(searchTh);\n        precisionObject.push($scope.thres.precision);\n        accuracyObject.push($scope.thres.accuracy);\n        sensitivityObject.push($scope.thres.sensitivity);\n        specificityObject.push($scope.thres.specificity);\n        sumObject.push($scope.thres.specificity + $scope.thres.sensitivity + $scope.thres.accuracy + $scope.thres.precision);\n        searchTh = searchTh - 0.001;\n        tries = tries + 1;\n      }\n\n      var max = sumObject[0];\n      var mindex = 0;\n\n      for (ii = 1; ii < sumObject.length; ii++) {\n        if (sumObject[ii] > max) {\n          max = sumObject[ii];\n          mindex = ii;\n        }\n      }\n\n      max = precisionObject[0];\n\n      for (ii = 0; ii < precisionObject.length; ii++) {\n        if (precisionObject[ii] >= max) {\n          max = precisionObject[ii];\n        }\n      }\n\n      var precisionMaxIndices = [];\n\n      for (ii = 0; ii < precisionObject.length; ii++) {\n        if (precisionObject[ii] == max) {\n          precisionMaxIndices.push(ii);\n        }\n      }\n\n      max = sensitivityObject[precisionMaxIndices[0]];\n\n      for (i = 0; i < precisionMaxIndices.length; i++) {\n        if (sensitivityObject[precisionMaxIndices[i]] >= max) {\n          max = sensitivityObject[precisionMaxIndices[i]];\n        }\n      }\n\n      var sensitivityMaxIndices = [];\n\n      for (i = 0; i < precisionMaxIndices.length; i++) {\n        if (sensitivityObject[precisionMaxIndices[i]] == max) {\n          sensitivityMaxIndices.push(precisionMaxIndices[i]);\n        }\n      }\n\n      max = accuracyObject[sensitivityMaxIndices[0]];\n\n      for (i = 0; i < sensitivityMaxIndices.length; i++) {\n        if (accuracyObject[sensitivityMaxIndices[i]] >= max) {\n          max = accuracyObject[sensitivityMaxIndices[i]];\n        }\n      }\n\n      var accuracyMaxIndices = [];\n\n      for (i = 0; i < sensitivityMaxIndices.length; i++) {\n        if (accuracyObject[sensitivityMaxIndices[i]] == max) {\n          accuracyMaxIndices.push(sensitivityMaxIndices[i]);\n        }\n      }\n\n      max = specificityObject[accuracyMaxIndices[0]];\n\n      for (i = 0; i < accuracyMaxIndices.length; i++) {\n        if (specificityObject[accuracyMaxIndices[i]] >= max) {\n          max = specificityObject[accuracyMaxIndices[i]];\n        }\n      }\n\n      var specificityMaxIndices = [];\n\n      for (i = 0; i < accuracyMaxIndices.length; i++) {\n        if (specificityObject[accuracyMaxIndices[i]] == max) {\n          specificityMaxIndices.push(accuracyMaxIndices[i]);\n        }\n      }\n\n      var accum = 0.0;\n\n      for (i = 0; i < specificityMaxIndices.length; i++) {\n        accum = accum + thresholdObject[specificityMaxIndices[i]];\n      }\n\n      accum = accum / specificityMaxIndices.length;\n      $scope.currentThreshold = $scope.model.threshold != '-' ? $scope.model.threshold : accum;\n      $scope.suggestedThreshold = Math.round(accum * 1000000) / 1000000;\n\n      if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold) || !$scope.suggestedThreshold) {\n        $scope.currentThreshold = $scope.model.threshold != '-' ? $scope.model.threshold : $scope.allYesMax[0];\n        $scope.suggestedThreshold = Math.round($scope.allYesMax[0] * 1000000) / 1000000;\n      }\n\n      for (jj = 0; jj < $scope.validations.length; jj++) {\n        $scope.validations[jj].threshold = $scope.validations[jj].vmax > $scope.currentThreshold ? 'yes' : 'no';\n      }\n\n      $scope.computeStats();\n      $scope.loadingValidations = false;\n    }\n  };\n\n  $scope.computeStats = function () {\n    $scope.thres = {\n      tpos: '-',\n      fpos: '-',\n      tneg: '-',\n      fneg: '-',\n      accuracy: '-',\n      precision: '-',\n      sensitivity: '-',\n      specificity: '-'\n    };\n    var trupositive = 0;\n    var falsepositives = 0;\n    var truenegatives = 0;\n    var falsenegative = 0;\n\n    for (var jj = 0; jj < $scope.validations.length; jj++) {\n      if ($scope.validations[jj].presence == 'yes') {\n        if ($scope.validations[jj].threshold == 'yes') {\n          trupositive = trupositive + 1;\n        } else {\n          falsenegative = falsenegative + 1;\n        }\n      } else {\n        if ($scope.validations[jj].threshold == 'yes') {\n          falsepositives = falsepositives + 1;\n        } else {\n          truenegatives = truenegatives + 1;\n        }\n      }\n    }\n\n    $scope.thres.tpos = trupositive;\n    $scope.thres.fpos = falsepositives;\n    $scope.thres.tneg = truenegatives;\n    $scope.thres.fneg = falsenegative;\n    $scope.thres.accuracy = Math.round((trupositive + truenegatives) / (trupositive + falsepositives + truenegatives + falsenegative) * 100) / 100;\n\n    if (trupositive + falsepositives > 0) {\n      $scope.thres.precision = Math.round(trupositive / (trupositive + falsepositives) * 100) / 100;\n    }\n\n    if (trupositive + falsenegative > 0) {\n      $scope.thres.sensitivity = Math.round(trupositive / (trupositive + falsenegative) * 100) / 100;\n    }\n\n    if (truenegatives + falsepositives > 0) {\n      $scope.thres.specificity = Math.round(truenegatives / (truenegatives + falsepositives) * 100) / 100;\n    }\n  };\n\n  $scope.saveThreshold = function () {\n    $scope.messageSaved = '';\n    $scope.recalculate();\n    a2Models.setThreshold($stateParams.modelId, $scope.currentThreshold).success(function () {\n      $scope.messageSaved = 'Threshold saved';\n      $scope.model.threshold = $scope.currentThreshold;\n    }).error(function () {\n      $scope.messageSaved = 'Error saving threshold';\n    });\n  };\n\n  $scope.recalculate = function () {\n    $scope.messageSaved = '';\n    var newval = parseFloat($scope.newthres);\n\n    if (!isNaN(newval) && newval <= 1.0 && newval >= 0.0) {\n      $scope.currentThreshold = newval;\n\n      for (var jj = 0; jj < $scope.validations.length; jj++) {\n        $scope.validations[jj].threshold = $scope.validations[jj].vmax > $scope.currentThreshold ? 'yes' : 'no';\n      }\n\n      $scope.computeStats();\n    } else {\n      $scope.messageSaved = 'Value should be between 0 and 1.';\n    }\n  }; // TODO use ng-style\n\n\n  $scope.zoomout = function () {\n    $(\"#patternDivMain\").css(\"min-width\", 210);\n    $(\"#patternDivMain\").css(\"height\", 100);\n  };\n\n  $scope.zoomin = function () {\n    $(\"#patternDivMain\").css(\"min-width\", 420);\n    $(\"#patternDivMain\").css(\"height\", 150);\n  };\n\n  $scope.isExport = function () {\n    return a2UserPermit.can('export report') || a2UserPermit.isSuper();\n  };\n\n  $scope.getValidations = function () {\n    var vals = [];\n\n    for (var i = 0; i < $scope.validations.length; i++) {\n      vals.push({\n        site: $scope.validations[i].site,\n        date: $scope.validations[i].date,\n        user: $scope.validations[i].presence,\n        model: $scope.validations[i].model,\n        threshold: $scope.validations[i].threshold,\n        value: $scope.currentThreshold\n      });\n    }\n\n    return vals;\n  };\n\n  $scope.recDetails = function (rec) {\n    $scope.selected = rec;\n    $scope.showValidationsTable = false;\n  };\n\n  $scope.closeRecValidationsDetails = function () {\n    $scope.showValidationsTable = true;\n    $scope.selected = null;\n  };\n\n  $scope.gotoRec = function () {\n    var rurl = \"/visualizer/rec/\" + $scope.selected.id;\n    $location.path(rurl);\n  };\n});","angular.module('a2.citizen-scientist.admin.classification-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.classification-stats', {\n    url: '/classification-stats/:speciesId?',\n    controller: 'A2CitizenScientistAdminClassificationStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/classification-stats/index.html'\n  });\n}).controller('A2CitizenScientistAdminClassificationStatsCtrl', function ($scope, a2CitizenScientistAdminService, $stateParams, $state, Species) {\n  this.setSpecies = function (speciesId) {\n    this.speciesId = speciesId;\n    $state.transitionTo($state.current.name, {\n      speciesId: speciesId\n    }, {\n      notify: false\n    });\n\n    if (this.speciesId) {\n      this.loadForSpecies();\n    }\n  };\n\n  this.speciesId = $stateParams.speciesId;\n\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getClassificationStats().then(function (data) {\n      this.loading = false;\n      this.stats = data.stats;\n    }.bind(this));\n  };\n\n  this.loadForSpecies = function () {\n    this.loadingForSpecies = true;\n    Species.findById(this.speciesId).then(function (species) {\n      this.species = species;\n    }.bind(this));\n    a2CitizenScientistAdminService.getClassificationStats(this.speciesId).then(function (data) {\n      this.loadingForSpecies = false;\n      this.speciesStats = data.stats;\n    }.bind(this));\n  };\n\n  this.patternMatchingExportUrl = function (row, per_user) {\n    return a2CitizenScientistAdminService.getCSExportUrl(row.pattern_matching_id, per_user);\n  };\n\n  this.loadPage();\n\n  if (this.speciesId) {\n    this.loadForSpecies();\n  }\n});","angular.module('a2.citizen-scientist.admin.user-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.user-stats', {\n    url: '/user-stats/:userId?',\n    controller: 'A2CitizenScientistAdminUserStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/user-stats/index.html'\n  });\n}).controller('A2CitizenScientistAdminUserStatsCtrl', function ($scope, a2CitizenScientistAdminService, $stateParams, $state, Users) {\n  this.userStatsExportUrl = a2CitizenScientistAdminService.getUserStatsExportUrl();\n\n  this.setUser = function (userId) {\n    this.userId = userId;\n    $state.transitionTo($state.current.name, {\n      userId: userId\n    }, {\n      notify: false\n    });\n\n    if (this.userId) {\n      this.loadForUser();\n    }\n  };\n\n  this.userId = $stateParams.userId;\n\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getUserStats().then(function (data) {\n      this.loading = false;\n      this.stats = data.stats.filter(function (item) {\n        return !!item.user_id;\n      });\n    }.bind(this));\n  };\n\n  this.loadForUser = function () {\n    this.loadingForUser = true;\n    Users.getInfoForId(this.userId).then(function (user) {\n      this.user = user;\n    }.bind(this));\n    a2CitizenScientistAdminService.getUserStats(this.userId).then(function (data) {\n      this.loadingForUser = false;\n      this.userStats = data.stats;\n    }.bind(this));\n  };\n\n  this.loadPage();\n\n  if (this.userId) {\n    this.loadForUser();\n  }\n});","angular.module('a2.citizen-scientist.admin.settings', ['a2.services', 'a2.srv.citizen-scientist-admin', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.settings', {\n    url: '/settings',\n    controller: 'A2CitizenScientistAdminSettingsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/settings/index.html'\n  });\n}).controller('A2CitizenScientistAdminSettingsCtrl', function ($scope, a2CitizenScientistAdminService, notify) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getSettings().then(function (data) {\n      this.loading = false;\n      this.patternmatchings = data;\n    }.bind(this));\n  };\n\n  this.save = function () {\n    this.saving = true;\n    var settings = this.patternmatchings.filter(function (pm) {\n      return pm.citizen_scientist || pm.cs_expert;\n    }).map(function (pm) {\n      return {\n        id: pm.id,\n        consensus_number: pm.consensus_number,\n        citizen_scientist: pm.citizen_scientist,\n        cs_expert: pm.cs_expert\n      };\n    });\n    return a2CitizenScientistAdminService.setSettings(settings).then(function (data) {\n      this.saving = false;\n      notify.log(\"Settings Saved.\");\n    }.bind(this)).catch(function () {\n      this.saving = false;\n      notify.error(\"An error occured.\");\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.browser_audio-event-detections', ['a2.browser_common', 'a2.filter.as-csv']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'audio-event-detection',\n    cardTemplate: '/app/visualizer/browser/audio-event-detections/card.html'\n  });\n  BrowserLOVOsProvider.add({\n    name: 'audio-event-detection',\n    group: 'audio-event-detections',\n    vobject_type: 'audio-event-detection',\n    icon: 'fa fa-object-group',\n    tooltip: \"Show Audio Event Detections\",\n    controller: 'a2BrowserAudioEventDetectionsController',\n    template: '/app/visualizer/browser/audio-event-detections/audio-event-detections.html'\n  });\n}).controller('a2BrowserAudioEventDetectionsController', function (a2Browser, AudioEventDetectionService, a2ArrayLOVO, $timeout, $q) {\n  var self = this;\n  this.audioEventDetections = [];\n  this.active = false;\n  this.loading = {\n    audioEventDetections: false\n  };\n  this.audioEventDetection = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    var defer = $q.defer();\n    AudioEventDetectionService.getList({\n      show: 'thumbnail-path'\n    }).then(function (audioEventDetections) {\n      console.log(\"audioEventDetections\", audioEventDetections);\n      self.loading.audioEventDetections = false;\n      self.audioEventDetections = audioEventDetections;\n\n      if (!self.audioEventDetections_lovo) {\n        self.audioEventDetections_lovo = new a2ArrayLOVO();\n      }\n\n      self.audioEventDetections_lovo.setArray(self.audioEventDetections, 'audio-event-detection');\n\n      self.audioEventDetections_lovo.update = function () {\n        self.activate();\n      };\n\n      if (!self.lovo) {\n        self.lovo = self.audioEventDetections_lovo;\n        a2Browser.setLOVO(self.lovo);\n      }\n\n      defer.resolve(false);\n\n      if (self.resolve.scd) {\n        self.resolve.scd.resolve(self.audioEventDetections);\n      }\n    });\n    self.loading.audioEventDetections = true;\n    return defer.promise;\n  };\n\n  this.resolve = {};\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    var defer = $q.defer();\n\n    if (m) {\n      var scid = m[1] | 0,\n          regionid = m[3] | 0;\n      var scd = $q.defer();\n\n      if (self.loading.audioEventDetections) {\n        self.resolve = {\n          scd: scd\n        };\n      } else {\n        scd.resolve(self.audioEventDetections);\n      }\n\n      scd.promise.then(function (audioEventDetections) {\n        var audioEventDetection = self.audioEventDetections.filter(function (audioEventDetection) {\n          return audioEventDetection.id == scid;\n        }).shift();\n\n        if (audioEventDetection) {\n          self.audioEventDetection = audioEventDetection;\n\n          if (regionid) {\n            if (!self.audioEventDetection.extra) {\n              self.audioEventDetection.extra = {};\n            }\n\n            self.audioEventDetection.extra.region = regionid;\n          }\n        }\n\n        defer.resolve(audioEventDetection);\n      });\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (audioEventDetection) {\n    return 'audio-event-detection/' + audioEventDetection.id + (audioEventDetection.extra && audioEventDetection.extra.region ? '/' + audioEventDetection.extra.region : '');\n  };\n});","angular.module('a2.browser_recordings', ['a2.browser_common', 'a2.browser_recordings_by_site', 'a2.browser_recordings_by_playlist']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'recording',\n    cardTemplate: '/app/visualizer/browser/recordings/card.html'\n  });\n});","angular.module('a2.browser_soundscapes', ['a2.browser_common']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'soundscape',\n    cardTemplate: '/app/visualizer/browser/soundscapes/card.html'\n  });\n  BrowserLOVOsProvider.add({\n    name: 'soundscape',\n    group: 'soundscapes',\n    vobject_type: 'soundscape',\n    icon: 'fa fa-area-chart',\n    tooltip: \"Show Soundscapes\",\n    controller: 'a2BrowserSoundscapesController',\n    template: '/app/visualizer/browser/soundscapes/soundscapes.html'\n  });\n}).controller('a2BrowserSoundscapesController', function (a2Browser, a2Soundscapes, a2ArrayLOVO, a2UrlUpdate, Project, $q) {\n  var self = this;\n  this.soundscapes = [];\n  this.active = false;\n  this.loading = {\n    soundscapes: false\n  };\n  this.soundscape = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    var defer = $q.defer();\n    a2Soundscapes.getList({\n      show: 'thumbnail-path'\n    }, function (soundscapes) {\n      self.loading.soundscapes = false;\n      self.soundscapes = soundscapes;\n      self.soundscapes.forEach(function (soundscape) {\n        a2UrlUpdate.update(soundscape.thumbnail);\n        soundscape.caption2 = soundscape.normalized ? 'normalized' : 'scale:' + (soundscape.visual_max_value !== null ? soundscape.visual_max_value : soundscape.max_value);\n      });\n\n      if (!self.soundscapes_lovo) {\n        self.soundscapes_lovo = new a2ArrayLOVO();\n      }\n\n      self.soundscapes_lovo.setArray(self.soundscapes, 'soundscape');\n\n      self.soundscapes_lovo.update = function () {\n        self.activate();\n      };\n\n      if (!self.lovo) {\n        self.lovo = self.soundscapes_lovo;\n        a2Browser.setLOVO(self.lovo);\n      }\n\n      defer.resolve(false);\n\n      if (self.resolve.scd) {\n        self.resolve.scd.resolve(self.soundscapes);\n      }\n    });\n    self.loading.soundscapes = true;\n    return defer.promise;\n  };\n\n  this.resolve = {};\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    var defer = $q.defer();\n\n    if (m) {\n      var scid = m[1] | 0,\n          regionid = m[3] | 0;\n      var scd = $q.defer();\n\n      if (self.loading.soundscapes) {\n        self.resolve = {\n          scd: scd\n        };\n      } else {\n        scd.resolve(self.soundscapes);\n      }\n\n      scd.promise.then(function (soundscapes) {\n        var soundscape = self.soundscapes.filter(function (soundscape) {\n          return soundscape.id == scid;\n        }).shift();\n\n        if (soundscape) {\n          self.soundscape = soundscape;\n\n          if (regionid) {\n            if (!self.soundscape.extra) {\n              self.soundscape.extra = {};\n            }\n\n            self.soundscape.extra.region = regionid;\n          }\n        }\n\n        defer.resolve(soundscape);\n      });\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (soundscape) {\n    return 'soundscape/' + soundscape.id + (soundscape.extra && soundscape.extra.region ? '/' + soundscape.extra.region : '');\n  };\n});","angular.module('a2.visualizer.layers.annotation-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.annotation-layer.object:annotation-layer\n   * @description base image layer.\n   * adds the annotation-layer layer_type to layer_types. This layer shows a set of images\n   * associated to the visobject (such as the spectrogram or a soundscape's rendering).\n   * The layer only has a spectrogram component.\n   * The layer requires a selected visobject of recording or soundscape type.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"annotation-layer\",\n    title: \"\",\n    controller: 'a2VisualizerAnnotationController as controller',\n    require: {\n      type: ['recording'],\n      selection: true\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n}).controller('a2VisualizerAnnotationController', function ($scope) {});","angular.module('a2.visualizer.layers.audio-events-layer', []).config(function (layer_typesProvider) {\n  layer_typesProvider.addLayerType({\n    type: \"audio-events-layer\",\n    title: \"\",\n    controller: 'a2VisualizerAudioEventsController as audio_events',\n    require: {\n      type: ['recording'],\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerAudioEventsController', function ($scope, a2AudioEventDetectionsClustering, a2ClusteringJobs, $localStorage) {\n  var self = this;\n  const colors = ['#5340ff33', '#008000', '#ffcd00', '#1F57CC', '#53ff40', '#5bc0de', '#5340ff33'];\n  self.audioEvents = null;\n  self.clusteringEvents = null;\n  self.isAudioEventsPlaylist = null;\n  self.selectedAudioEventJob = null;\n  self.clusterPlaylists = null;\n  self.isPlaylist = false;\n\n  self.toggleAudioEvents = function (isJobsBoxes, id, opacity) {\n    (isJobsBoxes ? self.audioEvents : self.clusteringEvents).forEach(function (item) {\n      if ((isJobsBoxes ? item.job_id : item.playlist_id) === id) {\n        item.opacity = opacity === false ? 0 : 1;\n\n        if (isJobsBoxes) {\n          const index = Object.keys(self.audioEventJobs).findIndex(function (job) {\n            return Number(job) === item.job_id;\n          });\n          const color = colors[index] || colors[0];\n          item.borderColor = self.hexToRGB(color, 0.6);\n          item.backgroundColor = self.hexToRGB(color, 0.2);\n        }\n      }\n    }); // Remove default/selected job from the audio events details page.\n\n    if (isJobsBoxes) {\n      $localStorage.setItem('analysis.audioEventJob', null);\n    }\n  };\n\n  self.hexToRGB = function (hex, opacity) {\n    var r = parseInt(hex.slice(1, 3), 16),\n        g = parseInt(hex.slice(3, 5), 16),\n        b = parseInt(hex.slice(5, 7), 16);\n    return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + opacity + ')';\n  };\n\n  self.isHighlightTitle = function () {\n    return !isNaN($localStorage.getItem('analysis.audioEventJob'));\n  };\n\n  self.fetchAudioEvents = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (rec) {\n      self.isPlaylist = $scope.visobject.extra && $scope.visobject.extra.playlist; // Check local storage on selected job from the audio events details page.\n\n      try {\n        self.selectedAudioEventJob = $localStorage.getItem('analysis.audioEventJob');\n        self.isAudioEventsPlaylist = !isNaN(self.selectedAudioEventJob);\n      } catch (e) {} // Get Detections Jobs data.\n\n\n      a2AudioEventDetectionsClustering.list({\n        rec_id: rec,\n        completed: true\n      }).then(function (audioEvents) {\n        if (audioEvents) {\n          self.audioEventJobs = {}; // Collect detections jobs data for audio events layer.\n\n          if (audioEvents.length) {\n            audioEvents.forEach(function (event) {\n              if (!self.audioEventJobs[event.job_id]) {\n                self.audioEventJobs[event.job_id] = {\n                  job_id: event.job_id,\n                  name: event.name,\n                  count: 1,\n                  parameters: event.parameters,\n                  visible: self.isAudioEventsPlaylist ? Number(self.selectedAudioEventJob) === event.job_id : false // Job not visible by default, except selected job from the audio events details page.\n\n                };\n              }\n\n              ;\n              self.audioEventJobs[event.job_id].count += 1;\n            });\n          }\n\n          self.audioEvents = audioEvents.map(function (event) {\n            return {\n              rec_id: event.rec_id,\n              x1: event.time_min,\n              x2: event.time_max,\n              y1: event.freq_min,\n              y2: event.freq_max,\n              job_id: event.job_id || null,\n              display: event.rec_id === rec ? \"block\" : \"none\",\n              opacity: self.isAudioEventsPlaylist ? Number(self.selectedAudioEventJob) === event.job_id ? 1 : 0 : 0 // Boxes not visible by default, except selected job from the audio events details page.\n\n            };\n          });\n          a2ClusteringJobs.getRoisDetails({\n            rec_id: $scope.visobject.id\n          }).then(function (clusteringEvents) {\n            if (clusteringEvents) {\n              // Collect clustering playlists for audio events layer.\n              self.clusterPlaylists = {};\n              clusteringEvents.forEach(function (event) {\n                if (!self.clusterPlaylists[event.playlist_id]) {\n                  self.clusterPlaylists[event.playlist_id] = {\n                    rec_id: event.recording_id,\n                    playlist_name: event.playlist_name,\n                    playlist_id: event.playlist_id,\n                    count: 1,\n                    visible: false // Playlist is hidden by default.\n\n                  };\n                }\n\n                ;\n                self.clusterPlaylists[event.playlist_id].count += 1;\n              });\n              self.clusteringEvents = clusteringEvents.map(function (event) {\n                return {\n                  rec_id: event.recording_id,\n                  x1: event.time_min,\n                  x2: event.time_max,\n                  y1: event.frequency_min,\n                  y2: event.frequency_max,\n                  playlist_id: event.playlist_id || null,\n                  display: event.recording_id === rec ? \"block\" : \"none\",\n                  opacity: 0 // Boxes not visible by default.\n\n                };\n              });\n            }\n          });\n        }\n      });\n    }\n  };\n\n  $scope.$watch('visobject', self.fetchAudioEvents);\n});","angular.module('a2.visualizer.layers.base-image-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.base-image-layer.object:base-image-layer\n   * @description base image layer. \n   * adds the base-image-layer layer_type to layer_types. This layer shows a set of images\n   * associated to the visobject (such as the spectrogram or a soundscape's rendering).\n   * The layer only has a spectrogram component.\n   * The layer requires a selected visobject of recording or soundscape type.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"base-image-layer\",\n    title: \"\",\n    require: {\n      type: ['recording', 'soundscape'],\n      selection: true\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n});","angular.module('a2.visualizer.layers.recording-soundscape-region-tags', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.recordings.object:recordings-layer\n   * @description Recordings layer. \n   * adds the recordings-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.recordings.controller:a2VisualizerRecordingLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-soundscape-region-tags\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingSoundscapeRegionTagsLayerController as ctrl',\n    require: {\n      type: 'recording',\n      selection: true,\n      that: function (scope) {\n        var pl = scope.visobject && scope.visobject.extra && scope.visobject.extra.playlist;\n        return pl && pl.soundscape && pl.region;\n      }\n    },\n    sidebar_only: true,\n    visible: true,\n    hide_visibility: false\n  });\n}).controller('a2VisualizerRecordingSoundscapeRegionTagsLayerController', function ($scope, a2Soundscapes) {\n  var self = this;\n  self.loading = {};\n  self.tag = {\n    name: null,\n    add: function () {\n      var tag = this.name;\n      this.name = null;\n      a2Soundscapes.addRecordingTag(self.soundscape.id, self.region.id, self.recording.id, tag, function (tag) {\n        var tagid = tag.id | 0;\n\n        if (!self.tags.filter(function (t) {\n          return t.id == tagid;\n        }).length) {\n          self.tags.push(tag);\n        }\n      });\n    },\n    remove: function (tag) {\n      var tagid = tag.id | 0;\n      a2Soundscapes.removeRecordingTag(self.soundscape.id, self.region.id, self.recording.id, tagid, function () {\n        self.tags = self.tags.filter(function (t) {\n          return t.id != tagid;\n        });\n      });\n    }\n  };\n  $scope.$watch('visobject', function (visobject) {\n    self.recording = null;\n    self.playlist = null;\n    self.soundscape = null;\n    self.region = null;\n    self.tags = null;\n\n    if (visobject && visobject.type == 'recording' && visobject.id && visobject.extra && visobject.extra.playlist && visobject.extra.playlist.soundscape && visobject.extra.playlist.region) {\n      self.recording = visobject;\n      self.playlist = visobject.extra.playlist;\n      self.loading.soundscape = true;\n      self.loading.region = true;\n      self.loading.tags = true;\n      a2Soundscapes.get(self.playlist.soundscape, function (soundscape) {\n        self.loading.soundscape = false;\n        self.soundscape = soundscape;\n        a2Soundscapes.getRegion(soundscape.id, self.playlist.region, function (region) {\n          self.loading.region = false;\n          self.region = region;\n          a2Soundscapes.getRecordingTags(soundscape.id, region.id, self.recording.id, function (tags) {\n            self.loading.tags = false;\n            self.tags = tags;\n          });\n        });\n      });\n    }\n  });\n});","angular.module('a2.visualizer.layers.data-plot-layer', ['a2.directive.plotly-plotter', 'arbimon2.directive.a2-dropdown']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.data-plot-layer.object:data-plot-layer\n   * @description base image layer. \n   * adds the data-plot-layer layer_type to layer_types. This layer shows a set of plots\n   * related to the visobject.\n   * The layer only has a spectrogram component.\n   * The layer requires a visobject of type audio-event-detection.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"data-plot-layer\",\n    title: \"\",\n    controller: 'a2VisualizerDataPlotLayerController as controller',\n    require: {\n      type: ['audio-event-detection'],\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerDataPlotLayerController', function ($scope) {});","angular.module('a2.visualizer.layers.soundscapes', ['a2.visualizer.layers.soundscapes.info', 'a2.visualizer.layers.soundscapes.regions']);","angular.module('a2.visualizer.layers.recordings', ['a2.filter.round', 'a2.directive.frequency_filter_range_control']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.recordings.object:recordings-layer\n   * @description Recordings layer.\n   * adds the recordings-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.recordings.controller:a2VisualizerRecordingLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-layer\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingLayerController as controller',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerRecordingLayerController', function ($scope, $modal, $location, $window) {\n  this.setGain = function (gain) {\n    $scope.audio_player.setGain(gain).then(function () {\n      var gain = $scope.audio_player.gain;\n      $scope.location.updateParams({\n        gain: gain >= 1 ? gain : undefined\n      });\n    });\n  };\n\n  this.explorerUrl = function () {\n    if (!$scope.visobject) return null;\n    return $scope.visobject.explorerUrl;\n  };\n\n  this.openFreqFilterModal = function () {\n    if (!$scope.visobject) {\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/recordings/frequency_filter_modal.html',\n      controller: 'a2VisualizerFrequencyFilterModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            recording: $scope.visobject,\n            filter: $scope.audio_player.freq_filter\n          };\n        }\n      }\n    }).result.then($scope.audio_player.setFrequencyFilter.bind($scope.audio_player)).then(function () {\n      var filter = $scope.audio_player.freq_filter;\n      $scope.location.updateParams({\n        filter: filter ? filter.min + '-' + filter.max : undefined\n      });\n    });\n  };\n}).controller('a2VisualizerFrequencyFilterModalController', function ($scope, $modalInstance, data) {\n  $scope.recording = data.recording;\n  $scope.max_freq = data.recording.sample_rate / 2;\n  $scope.has_previous_filter = true; //!!data.filter;\n\n  $scope.filter = data.filter ? angular.copy(data.filter) : {\n    min: 0,\n    max: $scope.max_freq\n  };\n\n  $scope.remove_filter = function () {\n    $modalInstance.close();\n  };\n\n  $scope.apply_filter = function () {\n    $modalInstance.close($scope.filter);\n  };\n});","angular.module('a2.visualizer.layers.species-presence', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.species-presence.object:species-presence\n   * @description species presence validation layer.\n   * Adds the species-presence layer_type to layer_types. This layer shows a\n   * species presence validation interface.\n   * The layer has spectrogram component.\n   * The layer requires a selected visobject of recording type.\n   * The layer has visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"species-presence\",\n    title: \"\",\n    controller: 'a2VisualizerSpeciesPresenceController as species_presence',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerSpeciesPresenceController', function ($scope, a2PatternMatching, a2AudioEventDetectionsClustering) {\n  var self = this;\n  self.speciesPresence = null;\n  self.isRemoving = false;\n\n  self.checkSpectroWidth = function (leftBox, widthBox, widthSpectro) {\n    return leftBox + widthBox + 200 < widthSpectro;\n  };\n\n  self.togglePopup = function (roi) {\n    roi.isPopupOpened = !roi.isPopupOpened;\n  };\n\n  self.confirmPopup = function (roi) {\n    self.isRemoving = true;\n\n    if (roi.aed_id) {\n      return a2AudioEventDetectionsClustering.unvalidate({\n        aed: [roi.aed_id]\n      }).then(function () {\n        self.closePopup(roi);\n        roi.name = '';\n      });\n    } else return a2PatternMatching.validateRois(roi.pattern_matching_id, roi.pattern_matching_roi_id, null).then(function () {\n      self.closePopup(roi);\n      roi.display = \"none\";\n    });\n  };\n\n  self.closePopup = function (roi) {\n    self.isRemoving = false;\n    roi.isPopupOpened = false;\n  };\n\n  self.fetchSpeciesPresence = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (rec) {\n      a2PatternMatching.list({\n        rec_id: rec,\n        validated: 1\n      }).then(function (rois) {\n        self.speciesPresence = rois.map(function (roi) {\n          return {\n            rec_id: roi.recording_id,\n            pattern_matching_id: roi.pattern_matching_id,\n            pattern_matching_roi_id: roi.pattern_matching_roi_id,\n            name: roi.species_name + ' ' + roi.songtype_name,\n            x1: roi.x1,\n            x2: roi.x2,\n            y1: roi.y1,\n            y2: roi.y2,\n            display: roi.recording_id === rec ? \"block\" : \"none\",\n            isPopupOpened: false\n          };\n        }); // Add validated aed species boxes\n\n        if ($scope.visobject && $scope.visobject.aedValidations && $scope.visobject.aedValidations.length) {\n          self.speciesPresence = self.speciesPresence.concat($scope.visobject.aedValidations);\n        }\n      });\n    }\n  };\n\n  $scope.$watch('visobject', self.fetchSpeciesPresence);\n});","angular.module('a2.visualizer.layers.training-sets.roi_set', ['visualizer-services', 'a2.permissions', 'humane']).config(function (training_set_typesProvider) {\n  training_set_typesProvider.add({\n    type: 'roi_set',\n    has_layout: true,\n    templates: {\n      layer_item: '/app/visualizer/layer-item/training-sets/roi_set.html',\n      new_modal: '/app/visualizer/modal/new_roi_set_tset_partial.html'\n    },\n    action: {\n      collect_new_tset_data: function (sdata, tset_data, sval) {\n        if (sdata.class) {\n          tset_data.class = sdata.class.id;\n        } else {\n          sval.class = \"Please select a project class.\";\n          sval.count++;\n        }\n      }\n    },\n    controller: 'a2VisualizerSpectrogramTrainingSetRoiSetData'\n  });\n}).controller('a2VisualizerTrainingSetLayerRoiSetDataController', function ($scope, $timeout, a2TrainingSets, training_set_types, a22PointBBoxEditor, a2UserPermit, notify) {\n  var self = this;\n  self.type = 'roi_set';\n  self.typedef = training_set_types.roi_set;\n\n  $scope.getXCoord = function (x1, x2) {\n    return $scope.getXSide(x1, x2) == 'left' ? x1 : x2;\n  };\n\n  $scope.getXSide = function (x1, x2) {\n    var px = Math.max(0, Math.min($scope.layout.sec2x(x2, 1) / $scope.layout.spectrogram.width, 1));\n    return px > .5 ? 'left' : 'right';\n  };\n\n  $scope.getTransform = function (x1, x2, y1, y2) {\n    var tx = $scope.getXSide(x1, x2) == 'left' ? '-100%' : '0';\n    var ty = $scope.getYTranslation((y1 + y2) / 2, true);\n    return 'translate(' + tx + ', ' + ty + ')';\n  };\n\n  $scope.getYTranslation = function (y, asrelativeoffset) {\n    var py = Math.max(0.1, Math.min($scope.layout.hz2y(y, 1) / $scope.layout.spectrogram.height, .9));\n\n    if (asrelativeoffset) {\n      py = -py;\n    }\n\n    return (100 * py | 0) + '%';\n  };\n\n  self.fetchData = function (tsetId, rec) {\n    self.tsetId = tsetId;\n    self.recording = rec;\n    a2TrainingSets.getData(tsetId, rec, function (data) {\n      $timeout(function () {\n        self.rois = data;\n      });\n    });\n  };\n\n  self.editor = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.roi = null;\n    },\n    make_new_bbox: function () {\n      this.super.make_new_bbox.call(this);\n      this.roi = this.bbox;\n    },\n    make_new_roi: function () {\n      this.make_new_bbox();\n    },\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    submit: function () {\n      if (!a2UserPermit.can('manage training sets')) {\n        notify.error('You do not have permission to add ROIs to training set');\n        return;\n      }\n\n      a2TrainingSets.addData(self.tsetId, {\n        recording: self.recording,\n        roi: this.roi\n      }, function (new_tset_data) {\n        $timeout(function () {\n          this.reset();\n          self.rois.push(new_tset_data);\n        }.bind(this));\n      }.bind(this));\n    }\n  });\n});","angular.module('a2.visualizer.layers.training-sets', ['visualizer-services', 'a2.visualizer.layers.training-sets.roi_set', 'a2.utils']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.training-sets.object:training-data\n   * @description Training Data layer.\n   * adds the training-data layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.training-sets.controller:a2VisualizerTrainingSetLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"training-data\",\n    title: \"\",\n    controller: 'a2VisualizerTrainingSetLayerController as training_data',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerTrainingSetLayerController', function ($scope, $modal, $controller, $timeout, a2TrainingSets, a2UserPermit, notify) {\n  var self = this;\n  self.tset = null;\n  self.tset_type = null;\n  self.tset_list = [];\n  self.data = null;\n  a2TrainingSets.getList(function (training_sets) {\n    self.tset_list = training_sets;\n\n    if (!self.tset && training_sets && training_sets.length > 0) {\n      self.tset = training_sets[0];\n    }\n  });\n\n  self.add_new_tset = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to create training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/training-data/add_tset_modal.html',\n      controller: 'a2VisualizerAddTrainingSetModalController'\n    }).result.then(function (new_tset) {\n      if (new_tset && new_tset.id) {\n        self.tset_list.push(new_tset);\n\n        if (!self.tset) {\n          self.tset = new_tset;\n        }\n      }\n    });\n  };\n\n  var fetchTsetData = function () {\n    var tset = self.tset && self.tset.id;\n    var tset_type = self.tset && self.tset.type;\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (tset && rec) {\n      if (!self.data || self.data.type != tset_type) {\n        var cont_name = tset_type.replace(/(^|-|_)(\\w)/g, function (_, _1, _2, _3) {\n          return _2.toUpperCase();\n        });\n        cont_name = 'a2VisualizerTrainingSetLayer' + cont_name + 'DataController';\n        self.data = $controller(cont_name, {\n          $scope: $scope\n        });\n      }\n\n      self.data.fetchData(tset, rec);\n    }\n  };\n\n  $scope.$watch(function () {\n    return self.tset;\n  }, fetchTsetData);\n  $scope.$watch('visobject', fetchTsetData);\n}).directive('a2VisualizerSpectrogramTrainingSetData', function (training_set_types, $compile, $controller, $templateFetch) {\n  return {\n    restrict: 'A',\n    template: '<div class=\"training-set-data\"></div>',\n    replace: true,\n    link: function (scope, element, attrs) {\n      scope.$watch(attrs.a2VisualizerSpectrogramTrainingSetData, function (tset_type) {\n        var type_def = training_set_types[tset_type];\n        element.attr('data-tset-type', tset_type);\n\n        if (type_def) {\n          if (type_def.has_layout) {\n            var tmp_url = '/app/visualizer/spectrogram-layer/training-sets/' + tset_type + '.html';\n            $templateFetch(tmp_url, function (tmp) {\n              element.empty().append($compile(tmp)(scope));\n            });\n          }\n        }\n      });\n    }\n  };\n}).controller('a2VisualizerAddTrainingSetModalController', function ($scope, $modalInstance, Project, a2TrainingSets, $state) {\n  $scope.data = {\n    name: '',\n    type: null\n  };\n  $scope.loadingClasses = true;\n  Project.getClasses(function (project_classes) {\n    $scope.project_classes = project_classes;\n    $scope.loadingClasses = false;\n  });\n  $scope.loadingTypes = true;\n  a2TrainingSets.getTypes(function (tset_types) {\n    $scope.tset_types = tset_types;\n\n    if (tset_types && tset_types.length == 1) {\n      $scope.data.type = tset_types[0];\n      $scope.loadingTypes = false;\n    }\n  });\n\n  $scope.goToSpeciesPage = function () {\n    $state.go('audiodata.species', {});\n  };\n\n  $scope.ok = function () {\n    $scope.creating = true;\n    $scope.validation = {\n      count: 0\n    };\n    var tset_data = {};\n\n    if ($scope.data.name) {\n      tset_data.name = $scope.data.name;\n    } else {\n      $scope.validation.name = \"Training set name is required.\";\n      $scope.validation.count++;\n    }\n\n    if ($scope.data.type && $scope.data.type.id) {\n      tset_data.type = $scope.data.type.identifier;\n    } else {\n      $scope.validation.type = \"Training set type is required.\";\n      $scope.validation.count++;\n    }\n\n    if ($scope.data.class) {\n      tset_data.class = $scope.data.class.id;\n    } else {\n      $scope.validation.class = \"Species sound is required.\";\n      $scope.validation.count++;\n    } // $scope.form_data=tset_data;\n\n\n    if ($scope.validation.count === 0) {\n      a2TrainingSets.add(tset_data, function (new_tset) {\n        if (new_tset.error) {\n          var field = new_tset.field || 'error';\n          $scope.validation[field] = new_tset.error;\n          return;\n        }\n\n        $modalInstance.close(new_tset);\n      });\n    } else {\n      $scope.creating = false;\n    }\n  };\n});","angular.module('a2.visualizer.layers.zoom-input-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.zoom-input-layer.object:zoom-input-layer\n   * @description base image layer. \n   * adds the zoom-input-layer layer_type to layer_types. This layer collects input forEach\n   * performin zoom actions on the spectrogram.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"zoom-input-layer\",\n    title: \"\",\n    require: {\n      type: ['recording', 'soundscape'],\n      selection: true,\n      that: function (scope) {\n        return scope.visobject && scope.visobject.zoomable;\n      }\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n});","angular.module('a2.browser_recordings_by_site', ['a2.browser_common']).config(function (BrowserLOVOsProvider) {\n  BrowserLOVOsProvider.add({\n    name: 'rec',\n    group: 'recordings',\n    vobject_type: 'recording',\n    default: true,\n    icon: 'fa fa-map-marker',\n    tooltip: 'Browse Recordings by Site',\n    controller: 'a2BrowserRecordingsBySiteController',\n    template: '/app/visualizer/browser/recordings/by-site/recordings-by-site.html'\n  });\n}).factory('rbDateAvailabilityCache', function ($cacheFactory) {\n  return $cacheFactory('recordingsBrowserDateAvailabilityCache');\n}).service('a2RecordingsBySiteLOVO', function ($q, Project, $filter) {\n  var lovo = function (site, date, limit, offset, recording_id) {\n    this.loading = false;\n    this.initialized = false;\n    this.site = site;\n    this.date = date;\n    this.object_type = \"recording\";\n    this.recordingsBySite = true;\n    this.offset = offset || 0;\n    this.limit = limit;\n    this.order = 'datetime';\n    this.count = 0;\n    this.list = [];\n    this.page = 0;\n    this.recording_id = recording_id;\n    this.finished = false;\n  };\n\n  lovo.prototype = {\n    initialize: function () {\n      var d = $q.defer();\n\n      if (this.initialized) {\n        d.resolve(true);\n      } else {\n        return this.loadNext();\n      }\n\n      return d.promise;\n    },\n    updateRecording: function (recording_id) {\n      this.recording_id = recording_id;\n    },\n    getRecordings: function (limit, offset, recording_id) {\n      var d = $q.defer();\n      this.limit = limit, this.offset = offset;\n      var site = this.site,\n          date = this.date;\n      var key = ['!q:' + site.id, date.getFullYear(), date.getMonth() + 1, date.getDate()].join('-');\n      var opts = {\n        show: 'thumbnail-path'\n      };\n\n      if (recording_id === undefined) {\n        opts.limit = limit;\n        opts.offset = offset;\n      }\n\n      ;\n\n      if (recording_id !== undefined) {\n        opts.recording_id = recording_id;\n      }\n\n      ;\n      this.loading = true;\n      Project.getRecordings(key, opts, function (recordings) {\n        recordings = $filter('orderBy')(recordings, 'datetime');\n        recordings.forEach(function (recording) {\n          recording.caption = [recording.site, moment.utc(recording.datetime).format('lll')].join(', ');\n          recording.vaxis = {\n            font: '7px',\n            color: '#333333',\n            range: [0, recording.sample_rate / 2000],\n            count: 5,\n            unit: ''\n          };\n        });\n\n        if (recordings && recordings.length) {\n          // not use infinite-scroll functionality for navigating recording\n          if (recording_id) {\n            if (angular.equals(this.list, recordings)) {\n              this.finished = true;\n            }\n\n            ;\n            this.list = [];\n            this.list = recordings;\n          } else {\n            this.list.push.apply(this.list, recordings);\n            this.page++;\n          }\n        } else {\n          this.finished = true;\n        }\n\n        this.count += recordings.length;\n        this.loading = false;\n        d.resolve(false);\n      }.bind(this));\n      return d.promise;\n    },\n    loadNext: function () {\n      if (this.finished) {\n        return $q.defer().resolve(false);\n      }\n\n      return this.getRecordings(this.limit, this.page * this.limit, this.recording_id);\n    },\n    find: function (recording) {\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      d.resolve(this.list.filter(function (r) {\n        return r.id == id;\n      }).shift());\n      return d.promise;\n    },\n    previous: function (recording) {\n      console.log(\"previous : function(recording){ :: \", recording);\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      Project.getPreviousRecording(id, d.resolve);\n      return d.promise;\n    },\n    next: function (recording) {\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      Project.getNextRecording(id, d.resolve);\n      return d.promise;\n    }\n  };\n  return lovo;\n}).controller('a2BrowserRecordingsBySiteController', function ($scope, a2Browser, rbDateAvailabilityCache, Project, $timeout, $q, a2RecordingsBySiteLOVO) {\n  var project = Project;\n  var self = this;\n  $scope.siteInfo = {};\n  this.sites = [];\n  this.dates = {\n    refreshing: false,\n    max_date: null,\n    min_date: null,\n    display_year: null,\n    date_counts: [],\n    datepickerMode: 'year',\n    cache: rbDateAvailabilityCache,\n    get_counts_for: function (year) {\n      var site = self.site;\n      var site_id = site && site.id;\n\n      if (!site_id) {\n        return true;\n      }\n\n      var key = ['!q:' + site_id, year, '[1:12]'].join('-');\n      var availability = self.dates.cache.get(key);\n\n      if (!availability) {\n        self.dates.fetch_counts(key);\n      } else if (availability.data) {\n        self.dates.date_counts = availability.data;\n      }\n    },\n    fetch_counts: function (key) {\n      self.dates.cache.put(key, {\n        fetching: true\n      });\n      self.loading.dates = true;\n      Project.getRecordingAvailability(key, function (data) {\n        $timeout(function () {\n          var avail = {};\n\n          for (var site in data) {\n            var site_years = data[site];\n\n            for (var year in site_years) {\n              var year_months = site_years[year];\n\n              for (var month in year_months) {\n                var month_days = year_months[month];\n\n                for (var day in month_days) {\n                  var akey = year + '-' + (month < 10 ? '0' : '') + month + '-' + (day < 10 ? '0' : '') + day;\n                  avail[akey] = (avail[akey] | 0) + month_days[day];\n                }\n              }\n            }\n          }\n\n          self.dates.cache.get(key).data = avail || {};\n          self.dates.date_counts = avail;\n          self.loading.dates = false;\n        });\n      });\n    },\n    fetch_year_range: function (site, callback) {\n      var site_id = site && site.id;\n\n      if (!site_id) {\n        return;\n      }\n\n      Project.getRecordingAvailability('!q:' + site_id, function (data) {\n        $timeout(function () {\n          var range = {\n            max: -1 / 0,\n            min: 1 / 0,\n            count: 0\n          };\n\n          for (var site in data) {\n            var site_years = data[site];\n\n            for (var year in site_years) {\n              range.count++;\n              range.min = Math.min(year, range.min);\n              range.max = Math.max(year, range.max);\n            }\n          }\n\n          if (!range.count) {\n            range.max = range.min = new Date().getFullYear();\n          }\n\n          self.dates.min_date = new Date(range.min, 0, 1, 0, 0, 0, 0);\n          self.dates.max_date = new Date(range.max, 11, 31, 23, 59, 59, 999);\n          self.loading.dates = false;\n          callback(range);\n        });\n      });\n    },\n    fetching: false,\n    available: {}\n  };\n  this.loading = {\n    sites: false,\n    dates: false,\n    records: false\n  };\n  this.auto = {};\n  this.site = null;\n  this.date = null;\n  this.lovo = null;\n  $scope.limit = 10;\n\n  this.activate = function () {\n    var defer = $q.defer();\n    self.loading.sites = true;\n    project.getSites({\n      count: true,\n      logs: true\n    }, function (sites) {\n      self.sites = sites;\n      self.loading.sites = false;\n      $timeout(function () {\n        self.active = true;\n        defer.resolve(sites);\n      });\n    });\n    return defer.promise;\n  };\n\n  this.deactivate = function () {\n    var defer = $q.defer();\n    defer.resolve();\n    self.active = false;\n    return defer.promise;\n  }; // Preselect of a site and a date from navigation URL\n\n\n  this.auto_select = function (recording) {\n    if (recording) {\n      var utcdateaslocal = new Date(recording.datetime);\n      var recdate = new Date(utcdateaslocal.getTime() + utcdateaslocal.getTimezoneOffset() * 60 * 1000);\n      self.auto = {\n        site: self.sites.filter(function (s) {\n          return s.name == recording.site;\n        }).pop(),\n        date: new Date(recdate.getFullYear(), recdate.getMonth(), recdate.getDate(), 0, 0, 0, 0)\n      };\n\n      if (self.site != self.auto.site) {\n        self.set_site(self.auto.site);\n      } else if (self.date != self.auto.date) {\n        self.set_date(self.auto.date);\n      } else {\n        a2Browser.setLOVO(make_lovo());\n      }\n    }\n  };\n\n  this.resolve_location = function (location) {\n    var defer = $q.defer();\n\n    if (location) {\n      var site_match = /^site(\\/(\\d+)(\\/([^/]+))?)?/.exec(location);\n\n      if (site_match) {\n        var site = site_match[2] | 0,\n            query = site_match[4];\n\n        if (site) {\n          var key = '!q:' + site + (query ? '-' + query : '');\n          Project.getRecordings(key, function (recordings) {\n            defer.resolve(recordings && recordings.pop());\n          }.bind(this));\n        } else {\n          defer.resolve();\n        }\n      } else {\n        Project.getOneRecording(location, function (recording) {\n          defer.resolve(recording);\n        });\n      }\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (recording) {\n    return 'rec/' + recording.id;\n  };\n\n  var make_lovo = function () {\n    var site = self.site;\n    var date = self.date;\n\n    if (site && date) {\n      // Create current browser state for the one recording in the list of recordings\n      if ($scope.browser.currentRecording) {\n        self.lovo = new a2RecordingsBySiteLOVO(site, date, null, null, Number($scope.browser.currentRecording));\n      } else {\n        self.lovo = new a2RecordingsBySiteLOVO(site, date, $scope.limit);\n      }\n    }\n\n    return self.lovo;\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    $scope.scrollElement = $controller.scrollElement;\n    var scrollTop = $controller.scrollElement.scrollTop();\n    var scrollHeight = $controller.scrollElement[0].scrollHeight;\n    var elementHeight = $controller.scrollElement.height();\n    var diff = scrollTop + elementHeight > scrollHeight * 0.9;\n\n    if (diff) {\n      if (!self.lovo) return;\n      if (self.lovo && self.lovo.loading === true) return;\n      if ($scope.browser.currentRecording && $scope.browser.annotations) return;\n      if (self.lovo.list && self.lovo.list.length < 7) return;\n      self.lovo.loadNext();\n    }\n  };\n\n  this.set_dates_display_year = function (new_display_year) {\n    this.dates.display_year = new_display_year;\n\n    if (!this.active) {\n      return;\n    }\n\n    this.dates.get_counts_for(new_display_year);\n  };\n\n  this.set_site = function (newValue) {\n    this.site = $scope.siteInfo.site = newValue;\n\n    if (!this.active) {\n      return;\n    }\n\n    this.recordings = []; // reset the selections and stuff\n\n    this.date = null;\n    a2Browser.recording = null; // setup auto-selection\n\n    var auto_select = this.auto && this.auto.date;\n\n    if (auto_select) {\n      this.auto.date = null;\n      this.set_date(auto_select);\n    } // reset date picker year range and counts\n\n\n    this.dates.fetch_year_range(newValue, function (year_range) {\n      $timeout(function () {\n        self.dates.display_year = year_range.max;\n        self.dates.get_counts_for(self.dates.display_year);\n      });\n    });\n  };\n\n  this.set_date = function (date) {\n    if (!self.active) {\n      return;\n    }\n\n    this.yearpickOpen = false;\n    var site = this.site;\n    this.date = $scope.siteInfo.date = date;\n\n    if (site && date) {\n      var isNewSiteAndDate = function () {\n        return this.lovo && date && this.lovo.date && date.getTime() === this.lovo.date.getTime() && site.id === this.lovo.site.id;\n      };\n\n      if (isNewSiteAndDate()) {\n        a2Browser.setLOVO(self.lovo);\n      } else {\n        a2Browser.setLOVO(make_lovo()).then(function () {\n          $scope.browser.currentRecording = null;\n          $scope.browser.annotations = null;\n        });\n      }\n    }\n  };\n});","angular.module('a2.browser_recordings_by_playlist', ['a2.classy', 'a2.browser_common']).config(function (BrowserLOVOsProvider) {\n  BrowserLOVOsProvider.add({\n    name: 'playlist',\n    group: 'recordings',\n    vobject_type: 'recording',\n    icon: 'fa fa-list',\n    tooltip: \"Browse Recordings by Playlist\",\n    controller: 'a2BrowserRecordingsByPlaylistController',\n    template: '/app/visualizer/browser/recordings/by-playlist/recordings-by-playlist.html'\n  });\n}).service('a2PlaylistLOVO', function ($q, makeClass, a2Playlists, a2Pager, $state, $localStorage, Project) {\n  return makeClass({\n    static: {\n      PageSize: 10,\n      BlockSize: 7\n    },\n    constructor: function (playlist) {\n      this.loading = false;\n      this.playlist = playlist;\n      this.object_type = \"recording\";\n      this.offset = 0;\n      this.count = 0;\n      this.list = [];\n      this.whole_list = [];\n      var self = this;\n      this.paging = new a2Pager({\n        item_count: playlist.count,\n        page_size: this.constructor.PageSize,\n        block_size: this.constructor.BlockSize,\n        block_tracks_page: true,\n        on_page: function (e) {\n          return self.load_page(e.offset, e.count);\n        }\n      });\n    },\n    initialize: function () {\n      var self = this,\n          d = $q.defer();\n\n      if (this.initialized) {\n        d.resolve(true);\n      } else {\n        this.paging.set_page(0).then(function () {\n          d.resolve(false);\n        });\n      }\n\n      if (self.playlist && self.playlist.id === 0) {\n        d.resolve(true);\n        return d.promise;\n      }\n\n      ;\n      return d.promise.then(function () {\n        a2Playlists.getInfo(self.playlist.id, function (playlist_info) {\n          self.playlist = playlist_info;\n        });\n      }).then(function () {\n        if (self.whole_list) {\n          self.whole_list.forEach(self.append_extras.bind(self));\n        }\n      });\n    },\n    load_page: function (offset, count) {\n      var self = this,\n          d = $q.defer();\n      var opts = {\n        offset: offset,\n        limit: count,\n        show: 'thumbnail-path'\n      }; // get recordings data for temporary clusters playlist\n\n      if ($state.params.clusters) {\n        var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n\n        if (clustersData && clustersData.playlist && clustersData.playlist.recordings) {\n          opts.recordings = clustersData.playlist.recordings.filter(function (id, i, a) {\n            return i >= opts.offset && i < opts.offset + opts.limit;\n          });\n          self.count = clustersData.playlist.recordings.length;\n        }\n      }\n\n      ;\n      self.loading = true;\n      a2Playlists.getData(self.playlist.id, opts, function (recordings) {\n        self.list = recordings;\n        recordings.forEach(function (recording) {\n          recording.caption = [recording.site, moment.utc(recording.datetime).format('lll')].join(', ');\n          recording.vaxis = {\n            font: '7px',\n            color: '#333333',\n            range: [0, recording.sample_rate / 2000],\n            count: 5,\n            unit: ''\n          };\n          self.append_extras(recording);\n        });\n        self.loading = false;\n        d.resolve(recordings);\n      });\n      return d.promise;\n    },\n    append_extras: function (recording) {\n      if (recording) {\n        recording.extra = {\n          playlist: this.playlist\n        };\n      }\n\n      return recording;\n    },\n    find_local: function (recording) {\n      var self = this;\n      var id = recording && recording.id || recording | 0; // console.log(\":: find : \", id);\n\n      return $q.resolve(this.append_extras(this.list && this.list.filter(function (r) {\n        // if(r.id == id){\n        // console.log(\"     :: found\", r.id, r);\n        // }\n        return r.id == id;\n      }).shift()));\n    },\n    find: function (recording) {\n      var self = this;\n      var d = $q.defer();\n      var id = recording && recording.id || recording | 0;\n      self.find_local(recording).then(function (found_rec) {\n        if (found_rec) {\n          d.resolve(found_rec);\n        } else {\n          a2Playlists.getRecordingPosition(self.playlist.id, id).then(function (response) {\n            return self.paging.set_page(self.paging.page_for(response.data));\n          }).then(function (recordings) {\n            return self.find_local(recording);\n          }).then(function (found_rec) {\n            d.resolve(found_rec);\n          });\n        }\n      });\n      return d.promise;\n    },\n    previous: function (recording) {\n      var self = this;\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      a2Playlists.getPreviousRecording(this.playlist.id, id, function (r) {\n        d.resolve(self.append_extras(r));\n      });\n      return d.promise;\n    },\n    next: function (recording) {\n      var self = this;\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      a2Playlists.getNextRecording(this.playlist.id, id, function (r) {\n        d.resolve(self.append_extras(r));\n      });\n      return d.promise;\n    }\n  });\n}).factory('a2Pager', function (makeClass) {\n  return makeClass({\n    constructor: function (options) {\n      this.block_size = 10;\n      this.last_page = 0;\n      this.set_options(options);\n    },\n    resolve_value: function (value, current, first, last) {\n      switch (value) {\n        case 'first':\n          value = first;\n          break;\n\n        case 'previous':\n          value = current - 1;\n          break;\n\n        case 'next':\n          value = current + 1;\n          break;\n\n        case 'last':\n          value = last;\n          break;\n      }\n\n      return Math.max(first, Math.min(+value, last));\n    },\n    set_options: function (options) {\n      if (options.item_count) {\n        this.item_count = options.item_count;\n      }\n\n      if (options.page_size) {\n        this.page_size = options.page_size;\n      }\n\n      if (options.block_size) {\n        this.block_size = options.block_size;\n      }\n\n      if (options.last_page) {\n        this.last_page = options.last_page;\n      }\n\n      if (options.block_tracks_page !== undefined) {\n        this.block_tracks_page = !!options.block_tracks_page;\n      }\n\n      if (options.on_page !== undefined) {\n        this.on_page = options.on_page;\n      }\n\n      this.update();\n    },\n    page_for: function (item) {\n      var page = item / this.page_size | 0;\n      console.log(\"page_for(%s) :: %s\", item, page);\n      return page;\n    },\n    set_page: function (page) {\n      this.current_page = this.resolve_value(page, this.current_page, 0, this.last_page) | 0;\n      this.is_at_first_page = this.current_page === 0;\n      this.is_at_last_page = this.current_page === this.last_page;\n\n      if (this.block_tracks_page) {\n        this.show_block((this.current_page - this.block_size / 2 + this.block_size % 2) / this.block_size);\n      } else {\n        this.show_block(this.current_page / this.block_size);\n      }\n\n      if (this.on_page instanceof Function) {\n        var offset = this.current_page * this.page_size;\n        return this.on_page({\n          page: this.current_page,\n          offset: offset,\n          count: Math.min(this.page_size, this.item_count - offset + 1)\n        });\n      }\n    },\n    update: function () {\n      this.is_at_first_page = this.current_page <= 0;\n      this.last_page = (this.item_count - 1) / this.page_size | 0;\n      this.last_page_block = this.last_page / this.block_size | 0;\n      this.is_at_last_page = this.current_page >= this.last_page;\n      this.show_block(this.block);\n    },\n    show_block: function (block) {\n      if (this.block_tracks_page) {\n        this.current_page_block = this.resolve_value(block, this.current_page_block, 0, this.last_page_block);\n      } else {\n        this.current_page_block = this.resolve_value(block, this.current_page_block, 0, this.last_page_block) | 0;\n      }\n\n      this.is_at_first_page_block = this.current_page_block <= 0;\n      this.is_at_last_page_block = this.current_page_block >= this.last_page_block;\n      this.current_page_block_first_page = this.current_page_block * this.block_size | 0;\n      this.current_page_block_last_page = Math.min((this.current_page_block + 1) * this.block_size - 1 | 0, this.last_page);\n      this.block = [];\n\n      for (var i = this.current_page_block_first_page, e = this.current_page_block_last_page; i <= e; ++i) {\n        this.block.push(i);\n      }\n    },\n    has_page: function (page) {\n      return 0 <= page && page <= this.last_page;\n    }\n  });\n}).controller('a2BrowserRecordingsByPlaylistController', function ($scope, a2Browser, a2Playlists, $q, a2PlaylistLOVO, $state, $localStorage) {\n  var self = this;\n  this.playlists = [];\n  this.active = false;\n  this.loading = {\n    playlists: false\n  };\n  this.playlist = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    self.loading.playlists = true;\n    this.getPlaylists = a2Playlists.getList().then(function (playlists) {\n      // add temporary clusters playlist to playlists' array\n      if ($state.params.clusters) {\n        var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n\n        if (clustersData && clustersData.playlist) {\n          playlists.push(clustersData.playlist);\n        }\n      }\n\n      self.playlists = playlists;\n      self.loading.playlists = false;\n    }).then(function () {\n      self.active = true;\n\n      if (self.resolve.pld) {\n        self.resolve.pld.resolve(playlists);\n        delete self.resolve.pld;\n      }\n    }).then(function () {\n      return self.playlists;\n    });\n    return this.getPlaylists;\n  };\n\n  this.deactivate = function () {\n    self.active = false;\n  };\n\n  this.resolve = {};\n\n  this.resolve_link = function (link) {\n    if (link.location) {\n      a2Browser.set_location(link.location);\n    }\n  };\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    return m ? $q.resolve().then(function () {\n      var plid = m[1] | 0,\n          recid = m[3] | 0;\n      return self.getPlaylists.then(function (playlists) {\n        var playlist = self.playlists.filter(function (playlist) {\n          return playlist.id == plid;\n        }).shift();\n\n        if (playlist) {\n          self.playlist = playlist;\n          self.lovo = new a2PlaylistLOVO(playlist);\n          return self.lovo.initialize().then(function () {\n            return a2Browser.setLOVO(self.lovo);\n          }).then(function () {\n            return self.lovo.find(recid);\n          }).then(function (recording) {\n            return recording;\n          });\n        }\n      });\n    }) : $q.resolve();\n  };\n\n  this.get_location = function (recording) {\n    return 'playlist/' + (this.lovo ? this.lovo.playlist.id + (recording ? \"/\" + recording.id : '') : '');\n  };\n\n  this.set_playlist = function (playlist) {\n    this.playlist = playlist;\n\n    if (!self.active) {\n      return;\n    }\n\n    if (self.lovo && self.lovo.playlist.id != playlist.id) {\n      $scope.removeFromLocalStorage();\n    }\n\n    if (playlist && (self.lovo ? self.lovo.playlist != playlist : true)) {\n      self.lovo = new a2PlaylistLOVO(playlist);\n    }\n\n    a2Browser.setLOVO(self.lovo, self.lovo ? \"playlist/\" + self.lovo.playlist.id : '');\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  };\n});","angular.module('a2.visualizer.layers.soundscapes.regions', ['visualizer-services', 'a2.utils', 'a2.soundscapeRegionTags']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.soundscapes.regions.object:soundscape-regions-layer\n   * @description Soundscape Regions layer. \n   * adds the soundscape-regions-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.soundscapes.regions.controller:a2VisualizerSoundscapeRegionsLayerController as controller,\n   * and requires a visobject of type soundscape to be selected.\n   * The layer has a visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-regions-layer\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeRegionsLayerController as soundscape',\n    require: {\n      type: 'soundscape',\n      browsetype: 'soundscape',\n      selection: true\n    },\n    visible: true // hide_visibility : true\n\n  });\n}).controller('a2VisualizerSoundscapeRegionsLayerController', function ($scope, $modal, $location, a2Soundscapes, a22PointBBoxEditor, a2UserPermit, notify) {\n  var self = this;\n\n  var bbox2string = function (bbox) {\n    var x1 = bbox.x1 | 0;\n    var y1 = bbox.y1 | 0;\n    var x2 = bbox.x2 | 0;\n    var y2 = bbox.y2 | 0;\n    return x1 + ',' + y1 + '-' + x2 + ',' + y2;\n  };\n\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, item) {\n      _[item.value] = item;\n      return _;\n    }, {});\n  }.bind(this));\n  this.show = {\n    names: true,\n    tags: true\n  };\n\n  this.view_playlist = function (region) {\n    console.log(\"this.view_playlist = function(region){\", region);\n\n    if (region.playlist) {\n      $scope.set_location(\"playlist/\" + region.playlist);\n    }\n  };\n\n  this.query = function (bbox) {\n    if (!self.selection.valid) {\n      return;\n    }\n\n    a2Soundscapes.getRecordings(self.soundscape, bbox2string(bbox), {\n      count: 1,\n      threshold: 1\n    }, function (data) {\n      bbox.q = data;\n    });\n  };\n\n  this.submit = function (bbox, name) {\n    if (!self.selection.valid) {\n      return;\n    }\n\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to annotate soundscapes');\n      return;\n    }\n\n    a2Soundscapes.addRegion(self.soundscape, bbox2string(bbox), {\n      name: name,\n      threshold: 1\n    }, function (data) {\n      self.regions.push(data);\n      self.selection.bbox = data;\n    });\n  };\n\n  this.sample = function (bbox, percent) {\n    if (!bbox.id) {\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/soundscapes/regions/sample_soundscape_region_modal.html',\n      controller: 'a2VisualizerSampleSoundscapeRegionModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            soundscape: self.soundscape,\n            region: bbox\n          };\n        }\n      }\n    }).result.then(function (region) {\n      if (region && region.id) {\n        self.regions.forEach(function (r, idx) {\n          if (r.id == region.id) {\n            self.regions[idx] = region;\n          }\n        });\n        self.selection.bbox = region;\n      }\n    });\n  };\n\n  this.selection = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.percent = 100;\n      return this;\n    },\n    quantize: function (x, y, ceil) {\n      var q = ceil ? Math.ceil : Math.floor;\n      var xi = $scope.visobject.domain.x.unit_interval;\n      var yi = $scope.visobject.domain.y.unit_interval;\n      return [q(x / xi) * xi, q(y / yi) * yi];\n    },\n    add_tracer_point: function (x, y) {\n      this.super.add_tracer_point.apply(this, this.quantize(x, y));\n      return this;\n    },\n    add_point: function (x, y) {\n      this.super.add_point.apply(this, this.quantize(x, y));\n      return this;\n    },\n    validate: function (tmp_points) {\n      this.super.validate.call(this, tmp_points);\n      var q = this.quantize(this.bbox.x2 + 0.1, this.bbox.y2 + 0.1, true);\n      this.bbox.y2 = q[1];\n      this.selbox = {\n        x1: this.bbox.x1,\n        y1: this.bbox.y1,\n        x2: q[0],\n        y2: q[1]\n      };\n    },\n    query: function () {\n      self.query(this.bbox);\n    },\n    submit: function () {\n      self.submit(this.bbox, this.bbox.name);\n    },\n    sample: function () {\n      self.sample(this.bbox, this.percent);\n    },\n    view_samples: function () {\n      self.view_playlist(this.bbox);\n    },\n    select: function (region) {\n      this.bbox = region;\n\n      if ($scope.visobject && $scope.visobject.id && region && region.id) {\n        $scope.set_location('soundscape/' + $scope.visobject.id + '/' + region.id, true);\n      }\n    }\n  });\n  $scope.$watch('visobject', function (visobject) {\n    var sc = visobject && visobject.type == 'soundscape' && visobject.id;\n\n    if (sc) {\n      self.soundscape = sc;\n      self.selection.reset();\n      a2Soundscapes.getRegions(sc, {\n        view: 'tags'\n      }, function (regions) {\n        self.regions = regions;\n\n        if (visobject.extra && visobject.extra.region) {\n          self.selection.bbox = self.regions.filter(function (r) {\n            return r.id == visobject.extra.region;\n          }).pop();\n        }\n      });\n    } else {\n      self.soundscape = 0;\n    }\n  });\n}).controller('a2VisualizerSampleSoundscapeRegionModalController', function ($scope, $modalInstance, a2Soundscapes, data) {\n  $scope.soundscape = data.soundscape;\n  $scope.region = data.region;\n  $scope.data = {\n    percent: 100\n  };\n\n  $scope.ok = function () {\n    $scope.validation = {\n      count: 0\n    };\n    var sdata = $scope.data,\n        sval = $scope.validation;\n    var vdata = {};\n    var tst;\n\n    if (sdata.percent > 100) {\n      sval.percent = \"Percent must be between 0% and 100%.\";\n      sval.count++;\n    } else if ((sdata.percent * $scope.region.count | 0) < 1) {\n      sval.percent = \"You must sample at least 1 recording.\";\n      sval.count++;\n    } else {\n      vdata.percent = sdata.percent;\n    }\n\n    $scope.form_data = vdata;\n\n    if (sval.count === 0) {\n      a2Soundscapes.sampleRegion($scope.soundscape, $scope.region.id, vdata, function (region) {\n        $modalInstance.close(region);\n      });\n    }\n  };\n});","angular.module('a2.visualizer.layers.soundscapes.info', ['visualizer-services', 'a2.utils', 'a2.soundscapeRegionTags', 'a2.url-update-service', 'a2.directives', 'a2.directive.a2-palette-drawer', 'a2.service.colorscale-gradients']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.soundscapes.info.object:soundscape-info-layer\n   * @description Soundscape Info layer. \n   * adds the soundscape-info-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.soundscapes.info.controller:a2VisualizerSoundscapeInfoLayerController as controller,\n   * and requires a visobject of type soundscape to be selected.\n   * The layer has a visibility button.\n   * The layer does not have an associated spectrogram layer.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-info-layer\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeInfoLayerController as info',\n    require: {\n      type: 'soundscape',\n      browsetype: 'soundscape',\n      selection: true\n    },\n    display: {\n      spectrogram: false\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerSoundscapeInfoLayerController', function ($scope, $modal, $location, a2Soundscapes, a2UserPermit, notify) {\n  var self = this;\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, item) {\n      _[item.value] = item;\n      return _;\n    }, {});\n  }.bind(this));\n\n  this.edit_visual_scale = function (soundscape) {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to edit soundscapes');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/soundscapes/info/edit_soundscape_visual_scale_modal.html',\n      controller: 'a2VisualizerSampleSoundscapeInfoEditVisualScaleModalController as controller',\n      // size        : 'sm',\n      resolve: {\n        amplitudeReferences: function (a2Soundscapes) {\n          return a2Soundscapes.getAmplitudeReferences();\n        },\n        data: function () {\n          return {\n            soundscape: soundscape\n          };\n        }\n      }\n    }).result.then(function () {/// TODO::: aaa\n    });\n  };\n}).controller('a2VisualizerSampleSoundscapeInfoEditVisualScaleModalController', function ($scope, $modalInstance, a2Soundscapes, amplitudeReferences, data, a2UrlUpdate, ColorscaleGradients) {\n  var soundscape = data.soundscape;\n  $scope.soundscape = soundscape;\n  $scope.palettes = ColorscaleGradients.gradients;\n  $scope.data = {\n    palette: soundscape.visual_palette,\n    visual_max: soundscape.visual_max_value || soundscape.max_value,\n    normalized: !!soundscape.normalized,\n    amplitudeThreshold: soundscape.threshold,\n    amplitudeReference: amplitudeReferences.reduce(function (_, item) {\n      return _ || (item.value == soundscape.threshold_type ? item : null);\n    }, null)\n  };\n  this.amplitudeReferences = amplitudeReferences;\n\n  $scope.ok = function () {\n    a2Soundscapes.setVisualizationOptions(soundscape.id, {\n      max: $scope.data.visual_max,\n      palette: $scope.data.palette,\n      normalized: $scope.data.normalized,\n      amplitude: $scope.data.amplitudeThreshold,\n      amplitudeReference: $scope.data.amplitudeReference.value\n    }, function (sc) {\n      if (soundscape.update) {\n        soundscape.update(sc);\n      }\n\n      a2UrlUpdate.update(soundscape.thumbnail);\n      $modalInstance.close();\n    });\n  };\n\n  console.log($scope);\n}).directive('a2SoundscapeDrawer', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    template: '<canvas class=\"soundscape\"></canvas>',\n    scope: {\n      soundscape: '&',\n      normalized: '&',\n      amplitudeThreshold: '&',\n      amplitudeThresholdType: '&',\n      palette: '&',\n      visualMax: '&'\n    },\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var scidx;\n      var soundscape;\n      var norm_vector;\n\n      var draw = function () {\n        if (!soundscape || !scidx) {\n          return;\n        }\n\n        var vmax = $scope.visualMax() || soundscape.max_value;\n        var ampTh = $scope.amplitudeThreshold && $scope.amplitudeThreshold() || 0;\n\n        if ($scope.amplitudeThresholdType() == 'relative-to-peak-maximum') {\n          var maxAmp = getMaxAmplitude();\n          ampTh *= maxAmp;\n        }\n\n        var pal = $scope.palette();\n\n        if (!pal || !pal.length) {\n          return;\n        }\n\n        var pallen1 = 1.0 * (pal.length - 1);\n\n        var color = function (v) {\n          var i = Math.max(0, Math.min(v * pallen1 / vmax | 0, pallen1));\n          return pal[i];\n        };\n\n        if (norm_vector) {\n          vmax = 1;\n          var _cl = color;\n\n          color = function (v, j) {\n            var n = norm_vector[j] || 1;\n            return _cl(v / n);\n          };\n        }\n\n        var w = scidx.width,\n            h = scidx.height;\n        $element.attr('width', w);\n        $element.attr('height', h);\n        var ctx = $element[0].getContext('2d');\n        ctx.fillStyle = color(0);\n        ctx.fillRect(0, 0, w, h);\n\n        for (var i in scidx.index) {\n          var row = scidx.index[i];\n\n          for (var j in row) {\n            var cell = row[j];\n\n            if (ampTh && cell[1]) {\n              var act = 0;\n\n              for (var al = cell[1], ali = 0, ale = al.length; ali < ale; ++ali) {\n                if (al[ali] > ampTh) {\n                  ++act;\n                }\n              }\n\n              ctx.fillStyle = color(act, j);\n            } else {\n              ctx.fillStyle = color(cell[0], j);\n            }\n\n            ctx.fillRect(j, h - i - 1, 1, 1);\n          }\n        }\n      };\n\n      var getMaxAmplitude = function () {\n        if (scidx.__maxAmplitude === undefined) {\n          scidx.__maxAmplitude = Object.keys(scidx.index).reduce(function (maxAmp, i) {\n            var row = scidx.index[i];\n            return Object.keys(row).reduce(function (maxAmp, j) {\n              var cellMax = Math.max.apply(Math, row[j][1] || [0]);\n              return Math.max(cellMax, maxAmp);\n            }, maxAmp);\n          }, 0);\n          console.log(\"scidx.__maxAmplitude\", scidx.__maxAmplitude);\n        }\n\n        return scidx.__maxAmplitude;\n      };\n\n      $scope.$watch('soundscape()', function (_soundscape) {\n        soundscape = _soundscape;\n        if (soundscape) a2Soundscapes.getSCIdx(soundscape.id, {\n          count: 1\n        }).then(function (_scidx) {\n          scidx = _scidx;\n          draw();\n        });\n      });\n      $scope.$watch('normalized()', function (_normalized) {\n        if (!_normalized) {\n          norm_vector = null;\n          draw();\n        } else {\n          if (norm_vector) {\n            draw();\n          } else {\n            a2Soundscapes.getNormVector(soundscape.id).then(function (_norm_vector) {\n              norm_vector = _norm_vector;\n              draw();\n            });\n          }\n        }\n      });\n      $scope.$watch('palette()', draw);\n      $scope.$watch('amplitudeThreshold()', draw);\n      $scope.$watch('amplitudeThresholdType()', draw);\n      $scope.$watch('visualMax()', draw);\n    }\n  };\n});"]}