{"version":3,"sources":["admin.js","app.js","citizen-scientist.js","home.js","login.js","orders.js","register.js","reset-password.js","user-settings.js","visualizer.js","a2services/api-service.js","a2services/audio-event-detection-service.js","a2services/audio-event-detections-clustering-service.js","a2services/citizen-scientist-admin-service.js","a2services/citizen-scientist-expert-service.js","a2services/citizen-scientist-service.js","a2services/classi-service.js","a2services/clustering-jobs-service.js","a2services/cnn-service.js","a2services/download-resource.js","a2services/index.js","a2services/local-store.js","a2services/models-service.js","a2services/news-service.js","a2services/open-modal.js","a2services/patternmatching-service.js","a2services/playlists-service.js","a2services/project-service.js","a2services/promised-resolve.js","a2services/serialize-promised-fn.js","a2services/sites-service.js","a2services/soundscape-composition.js","a2services/soundscapes-service.js","a2services/species-service.js","a2services/tags-service.js","a2services/templates-service.js","a2services/training-sets-service.js","a2services/uploads-service.js","a2services/users-service.js","filters/a2-filters.js","filters/as-csv.js","filters/caps.js","filters/page-number-to-title.js","filters/page-title-to-number.js","filters/project-url.js","filters/range.js","filters/round.js","filters/time-from-now.js","directives/a2-auto-close-on-outside-click.js","directives/a2-dropdown.js","directives/a2-on-resize.js","directives/a2-palette-drawer.js","directives/a2-percentage-bars.js","directives/a2-require-non-empty.js","directives/a2-sidenav.js","directives/a2-table.js","directives/a2-tags.js","directives/a2directives.js","directives/a2forms.js","directives/a2qrjs.js","directives/c3-charts.js","directives/error-message.js","directives/frequency_filter_range_control.js","directives/g-recaptcha.js","directives/news-feed-item.js","directives/plotly-plotter.js","directives/search-bar.js","directives/validation-dropdown.js","directives/warning-banner.js","services/a2gmaps.js","services/a2heremaps.js","services/a2permissions.js","services/a2utils-browser-metrics.js","services/a2utils.js","services/app-listings.js","services/colorscale-gradients.js","services/countries.js","services/humane.js","services/plot-maker.js","services/plot-specs.js","services/plotly-defaults.js","services/url-updater-service.js","orders/change-project-plan.js","orders/create-project.js","orders/order-summary.js","orders/order-utils.js","orders/orders-service.js","orders/plan-capacity.js","orders/plan-selection.js","orders/process-order.js","orders/project-order-service.js","orders/shipping-form.js","orders/tier-select.js","utils/external-api-loader.js","utils/global-anonymous-function.js","utils/q-promisify.js","admin/jobs/index.js","admin/users/list.js","admin/projects/codes.js","admin/projects/index.js","admin/projects/list.js","admin/dashboard/data-service.js","admin/dashboard/index.js","admin/dashboard/plotter-controller.js","app/analysis/index.js","app/citizen-scientist/index.js","app/audiodata/index.js","app/audiodata/sites.js","app/audiodata/soundscape-composition-classes.js","app/audiodata/species.js","app/audiodata/training-sets.js","app/jobs/index.js","app/dashboard/index.js","app/settings/index.js","app/visualizer/audioplayer.js","app/visualizer/layers.js","app/visualizer/services.js","app/visualizer/soundscape-tags.js","app/visualizer/spectrogram.js","app/visualizer/validator.js","app/visualizer/visualizer-sidebar.js","app/visualizer/visualizer.js","app/visualizer/zoom.js","directives/a2-audio-bar/a2-audio-bar.js","directives/a2-switch/index.js","directives/external/facebook-login-button.js","directives/external/google-login-button.js","app/analysis/clustering-jobs/index.js","app/analysis/audio-event-detection/index.js","app/analysis/audio-event-detection/new-modal.js","app/analysis/cnn/index.js","app/analysis/audio-event-detections-clustering/index.js","app/analysis/patternmatching/index.js","app/analysis/random-forest-models/index.js","app/analysis/soundscapes/index.js","app/citizen-scientist/expert/index.js","app/citizen-scientist/admin/index.js","app/citizen-scientist/my-stats/index.js","app/citizen-scientist/patternmatching/index.js","app/audiodata/playlists/playlist-arithmetic.js","app/audiodata/playlists/playlists.js","app/audiodata/templates/templates.js","app/audiodata/uploads/index.js","app/audiodata/uploads/processing.js","app/audiodata/uploads/upload.js","app/audiodata/recordings/data-export-parameters.js","app/audiodata/recordings/filter-parameters.js","app/audiodata/recordings/recordings.js","app/visualizer/browser/browser.js","app/visualizer/browser/common.js","app/visualizer/dialog/dialog.js","app/visualizer/layers/recording-tags-layer.js","app/visualizer/layers/soundscape-compositions-tool.js","app/visualizer/layers/templates.js","app/visualizer/visobjects/audio-event-detection.js","app/visualizer/visobjects/common.js","app/visualizer/visobjects/recording.js","app/visualizer/visobjects/soundscape.js","app/visualizer/visobjects/visobjects.js","app/analysis/random-forest-models/models/index.js","app/analysis/random-forest-models/classification/index.js","app/citizen-scientist/admin/classification-stats/index.js","app/citizen-scientist/admin/user-stats/index.js","app/citizen-scientist/admin/settings/index.js","app/visualizer/browser/audio-event-detections/audio-event-detections.js","app/visualizer/browser/recordings/recordings.js","app/visualizer/browser/soundscapes/soundscapes.js","app/visualizer/layers/annotation-layer/annotation-layer.js","app/visualizer/layers/audio-events-layer/audio-events-layer.js","app/visualizer/layers/base-image-layer/base-image-layer.js","app/visualizer/layers/data-plot-layer/data-plot-layer.js","app/visualizer/layers/recording-soundscape-region-tags/recording-soundscape-region-tags.js","app/visualizer/layers/recordings/recordings.js","app/visualizer/layers/soundscapes/soundscapes.js","app/visualizer/layers/species-presence/species-presence.js","app/visualizer/layers/training-data/roi-set.js","app/visualizer/layers/training-data/training-sets.js","app/visualizer/layers/zoom-input-layer/zoom-input-layer.js","app/visualizer/browser/recordings/by-playlist/recordings_by_playlist.js","app/visualizer/browser/recordings/by-site/recordings_by_site.js","app/visualizer/layers/soundscapes/info/soundscape-info.js","app/visualizer/layers/soundscapes/regions/soundscape-regions.js"],"names":["angular","module","controller","$scope","$state","e","console","error","provider","this","setEventHandlers","$get","service","init","filter","a2","run","$rootScope","Angularytics","a2UserPermit","notify","Math","$on","to","params","name","startsWith","document","getElementsByTagName","classList","add","remove","isFunction","allowAccess","allowed","undefined","preventDefault","go","config","$urlRouterProvider","$locationProvider","AngularyticsProvider","a2GoogleMapsLoaderProvider","a2InjectedData","setAPIKey","googleAPI","key","html5Mode","otherwise","Project","$window","getInfo","data","bioAnalyticsBaseUrl","reportsEnabled","reports_enabled","getUrlFor","page","projectUrl","getUrl","citizenScientistUser","all","length","includes","can","isSuper","isAppPage","location","pathname","onCitizenScientistPage","title","getData","$http","get","then","projects","recordings","description","jobs","species","$localStorage","a2order","$q","$injector","homeSummaryStatsData","getSummaryData","summary_item","resolve","invoke","getProjectSelectCache","JSON","parse","getItem","setProjectSelectCache","psCache","setItem","stringify","summaryDataLoading","list_summary_data","summary_data","map","allData","bind","isExplorePage","loadProjectList","isFeatured","isAnonymousGuest","isMyProjects","include_location","publicTemplates","featured","type","isLoading","highlightedProjects","success","forEach","p","lastAccessed","id","lat","lon","zoom","mapUrl","mapbox_access_token","item","project","url","projectTemplates","templatesTotal","count","recCount","speciesCount","createProject","result","message","log","selectProject","is_enabled","Date","getTime","assign","valueShortScale","value","formattedNumber","numeral","format","x","split","slice","replace","$modal","login","path","search","post","username","password","captcha","captchaResp","captchaNeeded","showCaptcha","resetCaptcha","redirect","oAuthLogin","user","oauthData","token","getAuthResponse","id_token","authResponse","accessToken","response","catch","status","showEnableOAuthModal","modalData","open","templateUrl","oauthType","messages","authorizeMessage","btnOk","btnCancel","controllerAs","authorized","extend","authorize","hash","loginUrl","encodeURIComponent","$timeout","$interval","testUsername","usernameOk","usernameErr","testUserTimeout","cancel","regis","$error","required","pattern","available","testEmail","emailOk","emailErr","testEmailTimeout","email","invalid","register","$event","passResult","valid","terms_accepted","captchaNotNeeded","loading","newsletter","completed","msg","changePassword","request","requestComplete","reset","copy","save","userData","lastname","oauth","err","serverError","factory","$location","returnData","a2APIServiceClass","prefix","prototype","apiRoute","when","delete","put","nrm","exec","absUrl","projectName","apiURLPrefix","a2APIService","api","getProjectName","getList","getAlgorithmsList","getStatisticsList","getDataStatisticsList","getDataAggregatesList","getDataFor","aed","y","z","args","statistic","join","savePlotFor","new","defaultName","algorithm","parameters","statistics","playlist","list","opts","callback","create","validate","unvalidate","jobId","getClassificationStats","speciesId","getUserStats","userId","getUserStatsExportUrl","getCSExportUrl","pattern_matching_id","per_user","filename","getSettings","setSettings","settings","getPatternMatchings","getPatternMatchingDetailsFor","patternMatchingId","getPatternMatchingRoisFor","limit","offset","options","query","Object","keys","option","validatePatternMatchingRois","rois","validation","patternMatching","getMyStats","saveData","saveState","getState","getDetails","classificationId","getResultDetails","first","getRecVector","recId","classificationData","$httpParamSerializer","getJobDetails","clusteringJobId","getClusteringDetails","job_id","getRoisDetails","rec_id","perSite","perDate","exportClusteringROIs","getAudioUrlFor","aedId","audioEventDetections","listROIs","species_id","site_id","listROIsBySpecies","listResults","listModels","getDetailsFor","cnnId","getRoisFor","countROIsBySpecies","countROIsBySites","countROIsBySpeciesSites","getExportUrl","roi","cnn_result_roi_id","validateRois","resource_url","a","element","attr","appendTo","setTimeout","click","localStorage","openedModel","modelState","s","isModelOpen","getFormInfo","findById","modelId","modelData","getValidationResults","setThreshold","thresholdValue","m","t","loadPage","index","loadFormats","$openModalProvider","defs","define","modalName","modalDef","overrides","getPatternMatchingsTotal","getSitesListFor","jobName","cls","update","filterPlaylistLimit","playlistParams","$emit","combine","expression","getRecordingPosition","recording","r","getPreviousRecording","getNextRecording","rename","playlistIds","playlists","method","event","handler","attachAedToPlaylist","playlist_id","nameRe","getProjectById","projectId","project_id","updateInfo","info","getUsage","getSites","getClasses","getRecs","tags","flat","getRecCounts","project_url","getRecordingData","filters","projection","show","param","serializedParams","species_name","grouped","getSitesExportUrl","getRecTotalQty","getProjectTotalSpecies","getProjectTimeBounds","getRecordings","Function","getRecordingAvailability","getOneRecording","getRecordingInfo","validateRecording","recExists","exists","downloadRecording","addClass","projectClass","removeClasses","projectClasses","getUsers","getRoles","addUser","removeUser","changeUserRole","getModels","getClassi","validationsCount","validationBySpeciesSong","songtypeId","sound_id","getProjectsList","ownershipType","removeProject","resolveMap","context","fn","series","Array","call","arguments","apply","listPublished","import","site","sites","getLogFiles","getSiteLogDataDates","d","defer","reject","promise","getSiteLogDataUrl","from","period","test","getSiteLogData","rows","trim","line","getListOfAssets","generateToken","revokeToken","getClassList","tally","isSystemClass","groupByType","reduce","_","typeId","push","removeClass","scClassid","getAnnotationsFor","visobject","annotate","annotation","Error","getAmplitudeReferences","caption","soundscapeId","getSCIdx","getNormVector","getList2","setVisualizationOptions","addRegion","bbox","sampleRegion","region","soundscape","soundscape_id","raw","getRegion","getRecordingTags","addRecordingTag","tag","removeRecordingTag","getRegions","findIndices","soundscapeData","q","songs","searchId","song","songtype_id","isTaggableType","isTaggableResource","obj","getFor","getForType","resourceType","deleteFor","tagId","addFor","tag_id","text","t0","f0","t1","f1","showRecordingUri","template_data","template","templateId","getImage","tset_data","edit","trainingSetId","addData","recording_uri","getDataImage","dataId","getTypes","getRois","getSpecies","removeRoi","roiId","getProcessingList","checkStatus","items","getInfoForId","user_id","delimiter","v","input","toUpperCase","page_number","page_title","isFinite","step","sign","stepSign","i","val","precision","fmt","moment","fromNow","directive","$document","getElementPath","ancestors","parentElement","restrict","require","link","scope","$attrs","dropdownController","closeDropdown","evt","isOpen","target","htmlIdx","indexOf","documentElement","toggleElementIdx","toggleElement","elementIdx","dropdownMenu","toggle","$$phase","$apply","$set","unbind","$compile","masterTemplate","compile","attrs","tpl","cloneNode","itemTpl","children","selectedItemTpl","elementHtml","html","append","empty","compiledTpl","clone","linkElement","ngModelCtrl","$watch","select","$selectedItem","$setViewValue","$render","$viewValue","Watcher","watchers","watch","scheduleAnimationFrame","animationFramePending","triggered","watcher","width","clientWidth","height","clientHeight","destroy","splice","requestAnimationFrame","newWatcher","$parse","a2OnResizeService","onResize","a2OnResize","newSize","a2Soundscapes","palette","$element","draw","pal","ctx","getContext","fillStyle","fillRect","a2SidenavBarService","total","colors","$filter","DEFAULT_COLORS","numberFilter","getColorClass","getTotal","b","asPercent","rounding","elm","ctrl","$validators","modelValue","viewValue","$isEmpty","$observe","$validate","enableSidenavBar","enabled","disableSidenavBar","$log","a2EventEmitter","SidenavBar","events","getSidenavBar","cache","enable","emit","disable","on","listener","off","registerAnchor","onEnabled","onDisabled","bar","sidebar","unregisterAnchor","nodeName","toLowerCase","_name","$templateCache","compileFields","toArray","field","detach","tdclass","content","tooltip","compileSelectExpand","selectExpand","fieldCount","find","$","selected","onSelect","onCheck","checked","dateFormat","numberDecimals","tplHead","tplFilters","tplBody","hasFilters","fields","hasCheckbox","noCheckbox","hasSelection","noSelect","a2TableCtrl","tableScope","$parent","$new","row","initialize","a2TableController","noCheck","sortKey","defaultSort","updateChecked","setRows","cmpel","$destroy","__onSelect","__onCheck","onFilterChanged","shift","keycomp","visible","toggleAll","allFalse","checkall","check","$index","lastChecked","shiftKey","keyboardSel","sel","currentTarget","after","sortBy","fieldIndex","sort","reverse","a2TagsModule","linkTo","tagType","tcTag","_0","_1","_2","tagName","tagLink","tagElement","closest","hide","expr","UP_PARENT_SPECIAL","times","createPseudo","seed","matches","_3","_4","dups","nodeType","parentNode","di","de","match","needsContext","RegExp","source","onkeyup","mkFunction","locals","a2InfiniteScrollDistance","a2InfiniteScrollDisabled","a2InfiniteScrollImmediateCheck","pscope","fnBind","fnUnbind","a2Scroll","a2ScrollOn","scrollElement","a2InfiniteScroll","a2InfiniteScrollRefraction","scrollHandler","dispose","anchors","addAnchor","anchorElement","removeAnchor","$controller","scrollHeight","scrollTop","time","refraction","a2ScrollController","counter","poc","tElement","tAttrs","_$persistence_","ptag","persisted","_$persistence_tag_","view","stopPropagation","$broadcast","updateHeight","h","top","resize","hideText","d3","ngModel","maxDate","minDate","year","dateCount","mode","onYearChanged","onDateChanged","disableEmpty","setYear","old_year","setDate","date","old_date","popup","is_a_popup","insertAfter","css","weekOfMonth","firstDay","toString","monthOffset","getDay","floor","getDate","monthName","format2Date","txt","computeMax","computeMin","getFullYear","days","svg","cal","legend","prev","next","scale","labels","icon","threshold","domain","range","selectAll","enter","cubesize","drawCounts","classed","hasClass","calendar","exit","mon","months","getMonth","computeMaxMinDateFromCounts","dateCounts","stats","dateFmt","min","max","$attr","img","new_src","image","Image","onload","src","a2TrainingSets","trainingSet","datum","resolve_null_uri","urikey","resolving","datum2","uri","anchor","keep_position","a2KeepPosition","a2InsertIn","replaceChild","reposition_element","comp_pos","el","po","offsetParent","ao","position","left","parents","each","$e","scroll","is","visibility","drawChart","padding","right","bottom","getY","getX","yMin","yMax","tMin","tMax","lineColor","xScale","linear","yScale","interpolate","symbol","xAxis","axis","ticks","yAxis","orient","dataG","totalLength","node","getTotalLength","transition","delay","duration","ease","body","coords","mouse","style","round","values","color","Number","normalize","columns","c3","makeChart","axes","celem","bindto","generate","chart","o","n","load","addSaveBtn","wrap","parentEl","parent","saveBtn","onDirtySaveFN","$name","$modelValue","$setPristine","removeSaveBtn","unwrap","a2BsNgModelOnDirtySaveButton","$viewChangeListeners","$dirty","dataURIToBinaryBuffer","dataURI","base64Index","base64","substring","atob","rawLength","array","Uint8Array","ArrayBuffer","charCodeAt","buffer","getCanvasBlob","canvas","toBlob","blob","toDataURL","BlobBuilder","WebKitBlobBuilder","bb","getBlob","Blob","createObjectURL","URL","revokeObjectURL","webkitURL","revoke","canvasObjectURL","$debounce","computeHash","w","createAxisData","prec","unit","dTick","w1","h1","font","strokeStyle","lineWidth","clearRect","lblSize","loopCt","tW","measureText","textAlign","textBaseline","beginPath","moveTo","lineTo","stroke","strokeText","drawAxisOnImg","axisDataPromise","promiseCache","axisData","elementSize","redrawAxis","selector","targetpos","pageX","pageY","onErrorSrc","loadZXCVBN","createElement","async","insertBefore","attachEvent","addEventListener","userInputs","getValidation","confirm","requiredScore","minLength","maxLength","testConfirm","pass","score","ok","testPass","zxcvbn","waitForZxcvbn","mesgs","size","shields","urlPattern","deriveUrlFromName","nameChanged","verify","urlChanged","good","errorName","errorUrl","is_private","qr","level","imgSrc","filterMin","filterMax","maxFreq","detectMouseUp","pressed","detectMouseMove","detectMouseDown","buttons","which","className","eloff","container","ammount","sitekey","theme","resetWidget","waitForRecaptcha","grecaptcha","widgetId","render","resetTimeout","a2NewsService","parseFormat","lastidx","matchidx","RE_INTERP","startidx","lastIndex","substr","parsedFormatsPromise","formats","news","parsedFormats","PlotlyDefaults","plotlyPlotMaker","layout","mergeData","mergeLayout","Plotly","newPlot","resizeWatcher","relayout","old","projectsLoading","isUnsafe","findProject","empty_option","label","val_options","by_val","updateLabel","$$lastCommittedViewValue","loadScript","cb_name","google","script","apiKey","protocol","appendChild","constant","a2HereMarkerTextIconTemplate","loadOneScript","H","makeTextIcon","DomIcon","platform","Platform","app_id","appId","app_code","appCode","useHTTPS","loadPromise","setAPIIdAndCode","code","userPermit","permits","permit","permissions","super","isRfcx","rfcxUser","isAuthorized","isProjectMember","getUserEmail","userEmail","has","feature","features","perm","isArray","metrics","border","margin","inner","outer","overflow","scrollLeft","scrollSize","linker","linkers","tmp_promise","l","idx","make","item_name","newValue","utc","timezone","tz","arr","currentPage","limitPerPage","rate","timeoutPromise","qDefer","debouncePromise","self","a2LookaheadHelper","searchCompare","includeSearch","pop","unshift","searchPromote","EventlistManager","get_event_def","send","eventdef","oneTime","listeners","fired","Species","newVal","oldVal","Songtypes","songtype","$inheritFrom","classdef","constructor","static","window","qc","object","app","g","j","ColorscaleGradients","gradients","grad","len","countries","humane","timeout","baseCls","spawn","addnCls","start","defaults","merge","makeHeatmapPlot","plot","hoverinfo","colorbar","xaxis","boundsmode","ticksuffix","units","yaxis","matrix","bins","makeBarPlot","orientation","a2BrowserMetrics","gutter","axis_sizew","axis_sizeh","legend_axis_w","legend_width","legend_gutter","axis_lead","set","newDefaults","PlotlyDefaultDefaults","PlotSpecs","titlefont","family","tickfont","showLink","sendData","displaylogo","displayModeBar","scrollZoom","modeBarButtonsToRemove","plot_bgcolor","paper_bgcolor","dragmode","thickness","heatmap","colorscale","clear","url2","qidx","_t_","re","a2UrlUpdate","orderData","$modalInstance","a2orderUtils","today","recorderQty","getOrdersContact","ordersContact","paymentsStatus","autoPaymentsEnabled","payments_enable","currentPlan","storage","storage_limit","processing","processing_limit","plan_period","tier","activation","plan_activated","creation","plan_created","due","setFullYear","plan","usage","minUsage","min_usage","upgrade","action","enterShippingAddress","reviewOrder","dismiss","ProjectOrderService","isValid","makeOrder","order","hasCoupon","isPaidProject","placeOrder","close","address","shipping","changeItems","changePlan","editAddress","submit","waiting","approvalUrl","monthsUntilDue","acticationDate","currentMonth","totalMonths","checkCouponCode","recorder","priceWithPlan","priceNoPlan","formOpener","modalOptions","backdrop","disabled","minutes","freePlan","cost","coupon","class","payload","recorderOptions","planMinutes","planYears","upgradeOnly","hasCouponCode","planData","yearOptions","updatePlan","planStarts","monthsLeft","ceil","recorderCap","availablePlans","reOrderId","orderId","invoice","item_list","amount","number","orderNumber","shipping_address","notFound","needApproval","approvalLink","alreadyProcessed","errorOcurred","currencyFilter","freeProjectLimit","nameExists","urlExists","recorderCost","projectCostLimit","shipping_cost","disableFree","externalApiLoaderProvider","apis","getCachedModule","def","namespace","loader","globalAnonymousFunction","head","jsonpCallback","onerror","addApi","apiName","externalApiLoader","ct","wrapperFn","$qPromisify","cb","$stateProvider","state","findJobs","getTags","key1","value1","key2","value2","states","types","activeJobs","initParams","job_types","argument","jobsStatus","jobTypes","LoaderFactory","AdminProjectsCodesService","newInstance","createNewCode","projectsList","AdminProjectsListService","usersList","AdminUsersListService","lockToUser","lockProject","tieProcessingWithRecordings","computeProcessingAmount","processingCountChanged","loadCodes","showHash","Loader","valueStore","abstract","views","detail","notifyProjectUpdated","projectObject","setProject","projectData","getProjectInfo","getProjectSites","getProjectRecordingCount","updateProject","handleAedToggle","clustering_enabled","aed_enabled","project_type_id","current_plan","storage_usage","processing_usage","citizen_scientist_enabled","cnn_enabled","pattern_matching_enabled","duration_period","getPlotData","convertToCSV","objArray","str","exportCSVFile","headers","fileTitle","jsonObject","csv","exportedFilenmae","navigator","msSaveBlob","download","setAttribute","removeChild","itemsFormatted","firstname","plots","UserStatsExport","newUsers","newProjects","Jobs","allUsers","allSites","allProjects","newSites","getSystemSettings","setSetting","setting","toggleSetting","AdminDashboardDataService","mk_time_range_fn","delta","fromdt","todt","get_by_tag","make_setter","selattr","refresh_logs","time_ranges","periods","sampling","granularity","time_range","set_series","set_time_range","set_period","load_data","make_chart_struct","marker","datetime","activity","chart_data","analysis","deepStateRedirect","sticky","citizen-scientist","audiodata","attrHandler","files","$anchorScroll","a2Sites","a2GoogleMapsLoader","$downloadResource","parseSitesFromCsv","allText","allTextLines","createSites","Promise","markers","editing","creating","show_path","logs","deployment","sortByLastUpdated","set_show","maps","Map","getElementById","center","lng","mapTypeId","MapTypeId","SATELLITE","minZoom","fitBounds","mapHeader","mapHeaderPosition","getBoundingClientRect","bounds","LatLngBounds","LatLng","Marker","temp","setDraggable","panTo","setZoom","addListener","latLng","scrollTo","setMapOnAll","bookmark","yOffset","onScroll","scrollPos","scrollY","scrolledPastHeader","getMapHeaderTop","topOffset","offsetHeigh","scrollMap","sortByKeywordArray","originalSites","keyword","updated_at","setMap","clearMarkers","showMarkers","deleteMarkers","importSite","setPosition","setTitle","exportSites","status_controller","onLogsRefreshed","logParams","new_show","concat","transitionTo","current","siteForm","$invalid","tempObj","attrArray","locationArray","del","delAllEmptySites","siteIds","rec_count","show_state_param","has_logs","activate","published","$item","showAssetsCarousel","showCarousel","images","active","capitalizeFirstLetter","string","charAt","external_id","assets","asset","meta","reader","FileReader","readAsText","confirmRevoke","genToken","token_created_on","created","base64token","expires","dontRefreshLogs","itemGroup","group","tick","selected_site","plot_uri","a2SoundscapeCompositionService","newClass","canManageClasses","classes","addNewClass","groupType","scClass","classGroup","scientific_name","speciesClasses","songtype_name","message2","classesIds","project_classes","songtypes","searchSpecies","clearTimeout","results","lastSet","lastPage","lastRoi","lastRoiSet","viewState","lastSpecie","lastSongtype","getLastSet","ls","lp","lr","lrs","vs","sp","sg","setLastSet","setLastPage","setLastRoi","setLastRoiSet","setViewState","setLastSpecies","valsp","valsg","a2TrainingSetHistory","roi_index","pages","details","detailedView","currentrois","roisPerpage","loaderDisplay","getROIVisualizerUrl","projecturl","setROI","setPage","setROISet","nextROI","prevROI","nextPage","prevPage","affectedRows","closeSetDetails","showSetDetails","getTrainingSetList","trainingSets","date_created","tset","selectTrainingSet","addNewTrainingSet","validations","speciesData","setupExportUrl","export_url","exportTSReport","setDetailedView","editSelectedTrainingSet","speciesClass","editedTrainingSet","finally","deleteSelectedTrainingSet","JobsData","showClassifications","showTrainings","showSoundscapes","successInfo","showSuccesss","errorInfo","showErrors","infoInfo","showInfo","updateFlags","showSuccess","showError","hideJob","updateJobs","getJobTypes","job_types_id","for","c","getJobs","new_jobs","startTimer","cancelTimer","showActiveJobs","showEmptyList","showLoader","titlen","vl","modalInstance","opened","job","percentage","isCompleted","isProcessing","isWaiting","openJob","href","intervalPromise","last3Months","job_type_id","geturl","cancelInterval","a2Templates","$templateFetch","a2PatternMatching","done","isSpeciesLoading","speciesQty","recsQty","templateQty","pmQty","accessCheck","plan_due","deleteProject","userToAdd","curQuery","users","roles","findUser","inviteUser","user_email","invite","showInvitationPopup","noResults","changeRole","role","rolename","role_id","_this","isDataValid","A2AudioObject","a2Playlists","a2AudioPlayer","gain","gain_levels","freq_filter","is_playing","is_muted","has_recording","has_next_recording","has_prev_recording","resource","resource_params","isPopupOpened","isSavingPlaylist","playlistData","clustersData","f","fmin","fmax","minFreq","discard","setFrequencyFilter","setGain","getVolume","audio","volume","setCurrentTime","getCurrentTime","currentTime","togglePopup","isPlaylistDataValid","playlistName","closePopup","savePlaylist","playlist_name","aedIdsIncluded","_load_resource","pk","k","onCompleteListeners","load_promise","stop","mute","muted","play","pause","prev_recording","next_recording","form","display","loadAudio","deferred","Audio","interval","_check_current_time","nativeAudio","paused","canPlay","complete","restart","discarded","setVolume","unmutedVolume","setPlaybackRate","playbackRate","setMuting","muting","setProgress","progress","layer_types","layer_type","layer","layer_key","layer_url","layer_tmp","layer_el","type_array","addLayerType","layerType","lt","layers","VisualizerCtrl","__new_layer__","layer_def","layer_maker","cname","warn","__check_type","reqtype","curtype","check_requirements","req","browsetype","visobject_type","votype","selection","that","sidebar_visible","spectrogram_visible","display_sidebar","display_spectrogram","spectrogram","training_set_types","tst","editor","min_eps","scalex","scaley","points","tracer","make_new_bbox","add_tracer_point","add_point","similars","pt","dx","dy","tmp_points","pts_x","pts_y","x1","y1","x2","y2","resolve_tag","label_classes","default_colors_by_type","species_sound","clsprefix","resolve_species_tag","closeable","showCount","onClose","$viewport","$el","affix_c","affix_left","affix_right","affix_align_h","affix_top","affix_bottom","affix_align_v","a2AffixCompute","doLayout","fix_scroll_center","components","visualizer_root","y_axis","x_axis","component","$li","li","doXAxisLayout","doYAxisLayout","doLegendLayout","scroll_center","viewport","onScrolling","d3_x_axis","spec_h","layout_tmp","make_axis","d3_y_axis","d3_legend","preserveAspectRatio","xlink:href","tmp","onPlaying","max_s_h","max_s_w","s1","sec2px","s2","hz1","hz2px","hz2","hz","onMouseMove","elOff","pointer","sec","x2sec","y2hz","tick_format","tickFormat","unit_format","getRecordingPlaybackTime","audio_player","oldValue","pbh","sl","slw","$root","$eloff","$roff","a2VisualizerSpectrogramAffixed","newval","oldval","class2key","project_class","pc","add_validation","present","presentReview","presentAed","load_project_classes","taxons","taxon","byTaxon","is_selected","sel_range","Infinity","taxonSpecies","si","se","ctrlKey","key_idx","sel_pc_id","determinedFrom","val_state","showDropdown","transclude","closed","toggleSidebar","visualizer","clusters","idA","squash","idB","idC","lc","whenBrowserIsAvailable","parseAnnotations","locman","__expected","sync","update_path","updateParams","all_params","pv","dont_sync","path_changed","browserAvailable","__onBrowserAvailable__","notifyBrowserAvailable","a2VisualizerLayers","itemSelection","a2SpectrogramClick2Zoom","VisualizerObjectTypes","VisualizerLayout","a2VisualizerLocationManager","initial_state_params","annotationsString","annotations","comps","parsed","comp","pair","addLayer","fullfillsRequirements","isSidebarVisible","isSpectrogramVisible","canDisplayInSidebar","canDisplayInSpectrogram","set_location","click2zoom","getLayers","setVisObject","isUploading","visobject_location","visobject_loader","getLoader","loading_visobject","getCaptionFor","boxes","removeFromLocalStorage","setYScaleOptions","getSelectedFrequencyCache","originalScale","deselectFrequencyOptions","yAxisOptions","scaleCache","convertedScale","max_freq","resizeYScale","span","sampling_rate","makeClass","VisualizerLayoutSpecs","align_to_interval","align","unit_interval","u","get_domain","make_scale","ordinal","dd","dr","linear_interpolate","levels","def_sec2px","def_hz2px","max_sec2px","max_hz2px","interval_align","seconds","hertz","sec2x","hz2y","dsec2width","seconds1","seconds2","inclusive","dhz2height","eh","ehi","ehe","apply_spectrogram","avail_w","scalelegend","avail_h","zoom_levels_x","levelx","zoom_levels_y","levely","zoom_sec2px","zoom_hz2px","spec_w","has_legend","sh","sw","root","apply_plotted","a22PointBBoxEditor","toggle_active","zoom_out","zoom_reset","cp","lzoom","zoom_x","zoom_y","zoom_level_x","zoom_level_y","horizontal","switched","set_by_mouse","track","trackpos","px","py","loadUrl","expanded","collapseTimeoutInterval","deregHandlers","onLoadUrl","onDestroy","setCollapseTimer","collapseTimer","seekPercent","percent","toggleExpanded","restict","onText","offText","facebook_api","onSignedIn","onError","signIn","FB","auth2","client_id","google_oauth_client","cookiepolicy","freqMin","freqMax","gridContext","$stateParams","a2ClusteringJobs","selectedClusteringJobId","showViewGridPage","getProjectData","isProjectDisabled","loadClusteringJobs","showRefreshBtn","clusteringJobsOriginal","clusteringJobsData","selectItem","clusteringJob","clustering_job_id","createNewClusteringJob","deleteClusteringJob","ret","modArr","indx","findIndex","deletingloader","onSetDetailedView","onGoBack","toggleMenu","selectedCluster","frequencyFilter","currentMin","currentMax","decrementClusters","selectCluster","incrementClusters","shapes","shape","fillcolor","selection.line.color","selection.line.opacity","selection.line.stroke-width","getShapePoints","isFilteredClusters","sortFilteredData","selectedAedList","ind","isEmpty","countAudioEventDetected","aedsDetected","clustersDetected","countClustersDetected","drawClusteringPoints","getColor","rgb","originalData","xref","yref","x0","y0","opacity","cluster","offsetWidth","showlegend","side","xanchor","itemclick","stroke-width","resetSelect","redraw","hoverdistance","dragLayer","getElementsByClassName","xAxisRangeStart","fullData","$scope.layout.shapes[i].line.color","$scope.layout.shapes[i].line.stroke-width","point","curveNumber","pointNumber","onGridViewSelected","showClustersInVisualizer","selectedClusters","aedDataInfo","recIds","aed_id","recording_id","box","time_min","freq_low","time_max","freq_high","tempPlaylistData","showDetailsPage","infopanedata","gridViewSelected","openFreqFilterModal","frequency","useFrequencyFilterData","sum","job_details","res","x_coord","y_coord","aed_info","parseInt","filterData","has_previous_filter","remove_filter","apply_filter","saving","aed_job","minPoints","distanceThreshold","maxClusterSize","clusteringModel","isJobValid","accessExportReport","isExporting","errMess","changedUserEmail","a2AudioBarService","a2AudioEventDetectionsClustering","isSquareSize","allRois","selectedRois","paginationSettings","totalItems","totalPages","lists","selectedFilterData","aedData","speciesLoading","isShiftKeyHolding","gridData","onSearchChanged","markBoxesAsSelected","updateInputState","setCurrentPage","showPagination","isFilterChanged","getStatusForEmptyData","isRoisLoading","groupedData","entries","entry","matched","getRoisDetailsSegment","combineRoisPerCluster","roisPerCluster","exportReport","openExportPopup","listParams","groupRoisBySpecies","ids","grids","speciesObj","speciesName","aeds","playRoiAudio","getRoiVisualizerUrl","frequency_min","frequency_max","toggleBoxSize","recIdsIncluded","isValidationAccessible","setValidation","validated","isClearValidation","markBoxesWithCurrentValidation","unselectBoxes","headerTop","header","getSelectedDetectionIds","isSelected","getCombinedDetections","combinedDetections","toggleDetection","selectedDetectionIds","firstInx","secondInx","det","arrayOfIndx","filteredDetections","_det","inputs","querySelectorAll","indeterminate","$promisedResolve","$openModal","reload","audioEventDetectionsList","AudioEventDetectionService","onSubmit","fltr","AudioEventDetectionParametersEditTemplateUrls","algorithmsList","statisticsList","getDefaultName","notifyAedAlgorithmChanged","algorithmParametersTemplate","recomputeDefaultName","ngTableParams","a2CNN","selectedCNNId","initTable","acsDesc","tableConfig","sorting","tableParams","$defer","filteredData","cnnOriginal","orderedData","orderBy","cnnsData","loadCNNs","createNewCNN","deleteCNN","cnn","selectedPatternMatchingId","project_name","models","lambdas","model","lambda","cnn_id","thumbnails","thumbnailClass","CNNExportUrl","exportCnnReport","viewType","mainResults","counts","selectFn","resultsROIs","refreshDetails","bySpecies","dataIn","dataOut","byROIs","thresh","over_thresh","byROIsbySpecies","bySite","byRecordings","thumbnail","species_list","bySpeciesHist","speciesTimes","getHours","getMinutes","plotShown","showHist","speciesInfo","trace","xbins","end","tickformat","getRecordingVisualizerUrl","getTemplateVisualizerUrl","force","loadROIPage","moveROIPage","setSpecies","site_name","roi_species_counts","getSpeciesCounts","roi_species_sites_counts","roi_sites_counts","getSitesCounts","count_all_species","N","all_species","count_all_sites","all_site","setSite","rois_species","roiIds","species_sites_matrix","roi_site_counts","roi_site_counts_dict","sitesAcc","switchView","specie","count_all","all_sites","detailType","loadAudioEventDetections","dataExtended","aedCount","audioEventDetectionsOriginal","audioEventDetectionsData","onSelectedJob","first_playlist_recording","createNewClusteringModel","deleteAedJob","aedJob","areaThreshold","amplitudeThreshold","durationThreshold","bandwidthThreshold","filterSize","minFrequency","maxFrequency","isRfcxUser","errorJobLimit","checkLimit","toggleDetails","newJob","totalRecordings","isNotDefined","showNameWarning","showPlaylistLimitWarning","showFrequencyWarning","totalJobs","source_project_uri","patternmatchingId","loadPatternMatchings","pmName","splitAllSites","patternmatchingsOriginal","patternmatchingsData","resetPagination","isShowSearch","createNewPatternMatching","deletePatternMatching","sitesList","sitesListBatchSize","sitesBatches","paginationTotal","fetchDetails","loadSitesList","loadData","templateParameters","Threshold","Matches/Recording","Matches/Site","persite","recalculateSiteListBatch","patternMatchingExportUrl","exportPmReport","sitesTotal","splitSitesListIntoBatches","batches","getCountPerSite","countPerSite","recalculateTotalItems","absent","shouldRecalculate","setSiteBookmark","scorePerSite","shouldGetPerSite","getSiteBatchIndexBySiteId","siteId","batch","getSiteBatchBySiteId","batchIndex","getSiteBatchByPageNumber","combOpts","offsetCalc","pageNumber","parseRoisResult","sitename","siteBookmark","siteBatch","playTemplateAudio","setRoi","forEachRoi","val_delta","0","1","null","templates","createPatternMatching","isSaving","warningMessage","getTemplates","getPlaylists","isWarningMessage","pid","soundscapesOriginal","soundscapesData","filtered","loadSoundscapes","stateData","deleteSoundscape","createNewSoundscape","amplitudeReferences","showDetails","plist","exportSoundscape","buttonEnableFlag","datasubmit","aggregation","thresholdReference","bin","bandwidth","nameMsg","aggregationValue","tr","nv","buttonEnable","aggregations","aggr","aggre","svgContainer","axisScale","tickValues","afterGetAmplitudeReferences","setAmplitudeReference","amplitudeReference","thresholdInvPercent","lineData","peaks","MARGINS","vis","xRange","yRange","tickSize","tickSubdivide","drawAmpThreshold","ampThresh","yval","peaki","peakText","banwidthValue","xval","lineFunc","WIDTH","showDownload","chartOptions","ACI","NP","indices","min_t","a2CitizenScientistService","a2CitizenScientistExpertService","cnp","expertSearch","compositeValidation","expert_val","expert_validated","consensus_val","consensus_validated","cs_val_present","cs_val_not_present","arg","onExpertSearchChanged","cs_validated","conflict_unresolved","conflict_resolved","oldtag","newtag","cs_conflict_resolved","cs_conflict_unresolved","expert_consensus_absent","expert_consensus_present","nextMatch","prevMatch","Users","vars","_var","groupStats","overall","__","cs_total","cs_absent","cs_present","onExpressionSelected","requires","onSelected","$interpolate","operations","nameTemplate","removeOnInvalidateHandler","updateNamePlaceholder","operation","term1","term2","namePlaceholder","playlist1","playlist2","operate","pname","pl","isAdding","currentTab","pagination","goToSourceProject","reloadPage","deleteTemplate","confirmed","toggleTab","access","addTemplate","source_project_id","a2UploadsService","bytes","newBytes","pow","String","uploads","AppListingsService","verifyAndUpload","uploading","_verifyAndUpload","uploader","queue","file","isError","errorMsg","isSuccess","isDuplicate","upload","onSuccess","isCheckingStatus","queueJobToCheckStatus","uploadingFiles","getUploadingFiles","userFiles","fileObj","filesToCheck","uploadUrl","uploadId","userFile","makeSuccessItem","isUploaded","checkUploadingFiles","checkStatusInterval","uploaderAppListing","stopQueue","getUploader","fileTimezone","utcDiff","selectSite","local","utcOffset","isStartUploadDisabled","isLimitExceeded","randomString","random","uploaderApps","mac","windows","qItem","onErrorItem","onSuccessItem","getProgress","removeCompleted","getCountOfUploaded","uploaded","clearQueue","onProgressAll","FileUploader","returnValue","onExport","identifier","placeholder","preselected","badges","vals_present","vals_absent","a2Tags","cl","recordingDataFieldTypes","parameter_set","parameter_set_list","allLists","listByValue","checkSelectedValue","selectedItem","resetFilters","isDisabled","isRecordingEmpty","exportData","recTotal","onApplyFilters","applyFilters","getFilters","fetchOptions","a2Classi","_1_get","attribute","_1_mapper","mapFn","staticMonths","staticDays","day","staticHours","hour","_1_get_value_mapper","_1_get_id_mapper","_1_get_tag_id_mapper","_1_get_flags_mapper","findObjectWith","classification_results","model_only","flags","equiv","model_th","th","presence","sites_ids","years","hours","classifications","soundscape_composition","soundscape_composition_annotation","filterDefs","filterDef","vals","getRecordingsStatsPerSite","proms","recAv","levelIds","getFilterOptions","currentLevel","child","siteObj","itemCount","month","minute","setRecStatsStatic","maxYear","minYear","toISOString","tagsObj","computeClassificationResultsOptions","haveThreshold","old_crs","crs_key","new_crs","cr","new_cr","selectedRecId","checkedRec","getSearchParameters","output","searchRecs","expect","recs","totalRecs","rec","date_range","min_date","max_date","sortRecs","reloadList","exportPermit","createPlaylist","isDisableDeleteRecs","deleteRecordings","imported","note","deleteAllRecordings","importedCount","importedSites","combineCheckedRecordings","selectRec","setLimitPerPage","exportRecordings","changePlaylistName","isExportingRecs","changeUserEmail","loadImage","customSrc","onVisObject","browser","waitForInitialized","vobject_type","$p","$eo","$po","$dt","animate","selectVisObject","selectPreviousVisObject","selectNextVisObject","setBrowserLocation","setBrowserAnnotations","clearRecordingData","notifyVisobjUpdated","serializePromisedFn","BrowserLOVOs","BrowserVisObjects","$grouping","visobjectTypes","dates","auto","visobj","lovo","initialized","waitForInitializedDefer","setBrowserType","$list","default","$type","currentRecording","setLOVO","recordingsBySite","updateRecording","setVisObj","new_$type","old_$type","a2Browser","differ","deactivate","get_location","cachedLocation","object_type","vobj","auto_select","previous","loc","lovos_def","resolve_location","visobjects","lovos","lovodef","groups","setArray","getXSide","getXCoord","getTransform","getYTranslation","asrelativeoffset","layer_typesProvider","hide_visibility","makeTagsIndex","groupByBbox","bboxes","bboxIdx","bbox_key","lookaheadHelper","spectrogramTags","tagsIndex","bboxTags","bboxTagsIndex","setVisobject","loadTags","searchedTags","searchTags","getProjectTags","onTagListChanged","tagUpdate","determineTagUpdate","updateTags","onBBoxTagListChanged","oldTagsIndex","toDelete","updateResponse","resetBboxTags","classesByType","classTypes","annotationToolbar","classId","scclassId","loadAnnotations","recordingTemplates","getTemplatesPromise","updateState","goToSpeciesPage","make_new_roi","get_placeholder_name","submitting","template_name","new_template","VisualizerObjectTypesProvider","$loader","VisualizerObjectAudioEventDetectionTypeLoader","aggregates","statisticsInfo","getParameters","_aggregates","_statistics","AudioEventDetection","selectData","tod","y_max","fetch","zoomable","data_selection","savePlot","getCaption","typeDef","VisualizerObjectRecordingTypeLoader","khz_format","extra","sample_rate","tiles","tile","legacy","streamId","datetime_utc","valueOf","ds","audioUrl","VisualizerObjectSoundscapeTypeLoader","khz_unit_fmt","time_of_day","time_unit","unit_fmt","day_of_month","day_of_year","month_in_year","localeData","_months","day_of_week","_weekdays","unknown","agg","max_t","min_f","max_f","v0","min_value","v1","visual_max_value","max_value","normalized","dt","df","dv","bin_size","visual_palette","dhz","crisp","a2Models","modelsDataOrig","modelsData","loadModels","deleteModel","model_id","model_name","validationdata","newModel","trainings","training","classifier","totalValidations","presentValidations","absentsValidations","usePresentTraining","useNotPresentTraining","usePresentValidation","useNotPresentValidation","jobDisabled","totalPresentValidation","totalNotPresentValidation","disableCreateButton","training_set_id","model_type_id","tp","tn","vp","vn","scopeExited","getVectors","waitinFunction","currRec","vector","vmax","vmin","allMax","allMin","vectorNoMax","allYesMax","showValidationsTable","loadingValidations","showModelValidations","messageSaved","maxv","minv","suggestedThreshold","isNaN","ii","jj","searchTh","thresholdObject","precisionObject","accuracyObject","sensitivityObject","specificityObject","sumObject","tries","computeStats","thres","accuracy","sensitivity","specificity","precisionMaxIndices","sensitivityMaxIndices","accuracyMaxIndices","specificityMaxIndices","accum","currentThreshold","tpos","fpos","tneg","fneg","trupositive","falsepositives","truenegatives","falsenegative","saveThreshold","recalculate","parseFloat","newthres","zoomout","zoomin","isExport","getValidations","recDetails","closeRecValidationsDetails","gotoRec","rurl","classificationsOriginal","classificationsData","capitalize","loadClassifications","muser","showClassificationDetails","classi","windowClass","ClassiInfo","createNewClassification","deleteClassification","loadClassifiedRec","classiData","maxPerPage","dataRec","maxVal","htresDeci","recVect","maxvRounded","gotoc","where","toggleRecDetails","showMore","csvUrl","table","errCount","modelInfo","recselected","showselection","datas","selectedSites","vectorData","minvect","maxvect","loadingflag","drawVector","xStep","a2CitizenScientistAdminService","loadForSpecies","loadingForSpecies","speciesStats","userStatsExportUrl","setUser","loadForUser","loadingForUser","userStats","patternmatchings","pm","citizen_scientist","cs_expert","consensus_number","BrowserVisObjectsProvider","BrowserLOVOsProvider","cardTemplate","a2ArrayLOVO","audioEventDetection","audioEventDetections_lovo","scd","scid","regionid","soundscapes","caption2","soundscapes_lovo","audioEvents","clusteringEvents","isAudioEventsPlaylist","selectedAudioEventJob","clusterPlaylists","isPlaylist","toggleAudioEvents","isJobsBoxes","audioEventJobs","borderColor","hexToRGB","backgroundColor","hex","isHighlightTitle","fetchAudioEvents","freq_min","freq_max","sidebar_only","tagid","explorerUrl","speciesPresence","isRemoving","checkSpectroWidth","leftBox","widthBox","widthSpectro","confirmPopup","pattern_matching_roi_id","fetchSpeciesPresence","aedValidations","training_set_typesProvider","has_layout","layer_item","new_modal","collect_new_tset_data","sdata","sval","typedef","roi_set","fetchData","tsetId","new_tset_data","tset_type","tset_list","training_sets","add_new_tset","new_tset","fetchTsetData","cont_name","a2VisualizerSpectrogramTrainingSetData","type_def","loadingClasses","loadingTypes","tset_types","a2Pager","PageSize","BlockSize","whole_list","paging","item_count","page_size","block_size","block_tracks_page","on_page","load_page","set_page","playlist_info","append_extras","vaxis","find_local","found_rec","page_for","last_page","set_options","resolve_value","last","current_page","is_at_first_page","is_at_last_page","show_block","last_page_block","block","current_page_block","is_at_first_page_block","is_at_last_page_block","current_page_block_first_page","current_page_block_last_page","has_page","a2PlaylistLOVO","pld","resolve_link","plid","recid","set_playlist","$cacheFactory","finished","loadNext","equals","rbDateAvailabilityCache","a2RecordingsBySiteLOVO","siteInfo","refreshing","display_year","date_counts","datepickerMode","get_counts_for","availability","fetch_counts","fetching","avail","site_years","year_months","month_days","akey","fetch_year_range","records","utcdateaslocal","recdate","getTimezoneOffset","set_site","set_date","make_lovo","site_match","set_dates_display_year","new_display_year","year_range","yearpickOpen","edit_visual_scale","palettes","visual_max","threshold_type","amplitude","sc","amplitudeThresholdType","visualMax","scidx","norm_vector","ampTh","getMaxAmplitude","pallen1","_cl","cell","act","al","ali","ale","__maxAmplitude","maxAmp","cellMax","_soundscape","_scidx","_normalized","_norm_vector","bbox2string","names","view_playlist","regions","sample","quantize","xi","yi","selbox","view_samples","vdata","form_data"],"mappings":"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AW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UA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","file":"arbimon2.min.js","sourcesContent":["angular.module('a2.admin', ['a2.directives', 'a2.admin.dashboard', 'a2.admin.projects', 'a2.admin.jobs', 'a2.directive.search-bar']).controller('AdminCtrl', function ($scope, $state) {\n  $scope.$state = $state;\n});","try {\n  angular.module(\"angularytics\"); // this throws if GA script is not loaded\n} catch (e) {\n  console.error(\"GA not available, likely adblocker\", e);\n\n  (function () {\n    angular.module('angularytics', []).provider('Angularytics', function () {\n      this.setEventHandlers = function () {};\n\n      this.$get = [function () {\n        var service = {};\n\n        service.init = function () {};\n\n        return service;\n      }];\n    }).filter('trackEvent', ['Angularytics', function () {\n      return function () {\n        return null;\n      };\n    }]);\n  })();\n}\n\nvar a2 = angular.module('a2.app', ['a2.permissions', 'templates-arbimon2', 'a2.app.dashboard', 'a2.audiodata', 'a2.visualizer', 'a2.analysis', 'a2.citizen-scientist', 'a2.jobs', 'a2.directive.sidenav-bar', 'a2.settings', 'a2.login', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    if (to.name.startsWith('visualizer')) {\n      document.getElementsByTagName('body')[0].classList.add('visualizer-page');\n    } else {\n      document.getElementsByTagName('body')[0].classList.remove('visualizer-page');\n    } // only check permissions if state have allowAccess\n\n\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (allowed === undefined) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      $state.go('dashboard');\n    } else if (allowed === false) {\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/dashboard\");\n}).controller('MainCtrl', function ($scope, $state, Project, a2UserPermit, $window) {\n  $scope.$state = $state;\n  Project.getInfo(function (data) {\n    $scope.bioAnalyticsBaseUrl = data.bioAnalyticsBaseUrl;\n    $scope.reportsEnabled = data.reports_enabled;\n  });\n\n  $scope.getUrlFor = function (page) {\n    const projectUrl = Project.getUrl();\n\n    if (page == 'citizen-scientist') {\n      return '/citizen-scientist/' + projectUrl + '/';\n    } else if (page == 'reports') {\n      return $scope.bioAnalyticsBaseUrl + '/' + projectUrl;\n    }\n  };\n\n  $scope.citizenScientistUser = a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper();\n  $scope.isAppPage = $window.location.pathname.startsWith('/project/');\n});","var a2 = angular.module('a2.cs-app', ['a2.permissions', 'templates-arbimon2', 'a2.app.dashboard', 'a2.audiodata', 'a2.visualizer', 'a2.analysis', 'a2.citizen-scientist', 'a2.directive.sidenav-bar', 'a2.settings', 'a2.login', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    // only check permissions if state have allowAccess\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (allowed === undefined) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      $state.go('citizen-scientist.patternmatching');\n    } else if (allowed === false) {\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/citizen-scientist/patternmatching/\");\n}).controller('MainCtrl', function ($scope, $state, Project) {\n  $scope.$state = $state;\n  $scope.onCitizenScientistPage = true;\n\n  $scope.getUrlFor = function (page) {\n    if (page == 'citizen-scientist') {\n      return '/citizen-scientist/' + Project.getUrl() + '/';\n    }\n  };\n});","angular.module('a2.home', ['templates-arbimon2', 'ui.bootstrap', 'a2.utils', 'a2.forms', 'a2.orders', 'a2.login', 'humane', 'angularytics', 'ui.router', 'a2.srv.local-storage', 'a2.filter.time-from-now', 'a2.directive.search-bar', 'ngSanitize']).config(function (AngularyticsProvider, $locationProvider) {\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).service('homeSummaryStatsData', function () {\n  return [{\n    title: 'projects created',\n    getData: function ($http) {\n      return $http.get('/api/project/projects-count').then(function (projects) {\n        return projects.data;\n      });\n    }\n  }, {\n    title: 'recordings uploaded',\n    getData: function ($http) {\n      return $http.get('/api/project/recordings-count').then(function (recordings) {\n        return recordings.data;\n      });\n    }\n  }, {\n    title: 'analyses performed',\n    description: 'Number of files processed by pattern matching jobs',\n    getData: function ($http) {\n      return $http.get('/api/project/jobs-count').then(function (jobs) {\n        return jobs.data;\n      });\n    }\n  }, {\n    title: 'species identified',\n    getData: function ($http) {\n      return $http.get('/api/project/recordings-species-count').then(function (species) {\n        return species.data;\n      });\n    }\n  }];\n}).controller('HomeCtrl', function ($http, $window, $localStorage, notify, a2order, a2InjectedData, $scope, $q, $injector, homeSummaryStatsData) {\n  $scope.summaryDataLoading = true;\n  $scope.list_summary_data = homeSummaryStatsData;\n  $scope.summary_data = $scope.list_summary_data.map(function () {\n    return [];\n  });\n\n  function getSummaryData(summary_item) {\n    return $q.resolve(summary_item.getData ? $injector.invoke(summary_item.getData) : []);\n  }\n\n  $q.all($scope.list_summary_data.map(getSummaryData)).then(function (allData) {\n    $scope.summaryDataLoading = false;\n    $scope.summary_data = allData;\n  }.bind(this));\n  $scope.isExplorePage = $window.location.pathname === '/';\n\n  function getProjectSelectCache() {\n    try {\n      return JSON.parse($localStorage.getItem('home.project.select.cache')) || {};\n    } catch (e) {\n      return {};\n    }\n  }\n\n  function setProjectSelectCache(psCache) {\n    try {\n      $localStorage.setItem('home.project.select.cache', JSON.stringify(psCache));\n    } catch (e) {}\n  }\n\n  this.loadProjectList = function () {\n    const isFeatured = $scope.isAnonymousGuest || $scope.isExplorePage;\n    const isMyProjects = !$scope.isAnonymousGuest && !$scope.isExplorePage;\n    var config = {\n      params: {\n        include_location: true,\n        publicTemplates: true\n      }\n    };\n\n    if (isFeatured) {\n      config.params.featured = true;\n    }\n\n    if (isMyProjects) {\n      config.params.type = 'my';\n    }\n\n    var psCache = getProjectSelectCache();\n    this.isLoading = true;\n    this.projects = [];\n    this.highlightedProjects = [];\n    $http.get('/api/user/projectlist', config).success(function (data) {\n      data.forEach(function (p) {\n        p.lastAccessed = psCache[p.id] || 0;\n        var lat = p.lat && p.lat >= -85.0511 && p.lat <= 85.0511 ? p.lat : 37.773972;\n        var lon = p.lon && p.lon >= -180 && p.lon <= 180 ? p.lon : -122.431297;\n        var zoom = p.lat && p.lon ? 5.33 : 4;\n        p.mapUrl = \"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/\" + lon + \",\" + lat + \",\" + zoom + \",0,60/274x180?access_token=\" + a2InjectedData.mapbox_access_token;\n      });\n      this.isLoading = false;\n\n      if (isFeatured) {\n        this.projects = [];\n        this.highlightedProjects = data.filter(function (item) {\n          return item.featured === 1;\n        });\n        this.highlightedProjects.forEach(function (project) {\n          project.isLoading = true;\n          $http.get('/api/project/' + project.url + '/templates/count', {\n            params: {\n              projectTemplates: true\n            }\n          }).success(function (data) {\n            project.templatesTotal = data.count || 0;\n            project.isLoading = false;\n          });\n          $http.get('/api/project/' + project.url + '/recordings/count').success(function (count) {\n            project.recCount = count;\n            project.isLoading = false;\n          });\n          $http.get('/api/project/' + project.url + '/species-count').success(function (count) {\n            project.speciesCount = count || 0;\n            project.isLoading = false;\n          });\n        });\n      } else if (isMyProjects) {\n        this.highlightedProjects = [];\n        this.projects = data;\n      }\n    }.bind(this)).error(function () {\n      this.isLoading = false;\n    }.bind(this));\n  };\n\n  this.createProject = function () {\n    var modalInstance = a2order.createProject({});\n    modalInstance.result.then(function (message) {\n      if (message) {\n        notify.log(message);\n      }\n\n      this.loadProjectList();\n    }.bind(this));\n  };\n\n  this.selectProject = function (project) {\n    if (!project.is_enabled) {\n      return;\n    }\n\n    var psCache = getProjectSelectCache();\n    psCache[project.id] = new Date().getTime();\n    setProjectSelectCache(psCache);\n    $window.location.assign(\"/project/\" + project.url + \"/\");\n  };\n\n  $scope.isAnonymousGuest = true;\n  $http.get('/api/user/info').success(function (data) {\n    $scope.isAnonymousGuest = data.isAnonymousGuest;\n    this.loadProjectList();\n  }.bind(this));\n\n  this.valueShortScale = function (value) {\n    const formattedNumber = numeral(value).format('0.0a');\n\n    const firstDecimalDigit = function (x) {\n      return x.split('.')[1].slice(0, 1);\n    };\n\n    return firstDecimalDigit(formattedNumber) === '0' ? formattedNumber.replace('.0', '') : formattedNumber;\n  };\n});","angular.module('a2.login', ['humane', 'ui.bootstrap', 'templates-arbimon2', 'g-recaptcha', 'a2.utils.google-login-button', 'a2.utils.facebook-login-button']).controller('LoginCtrl', function ($scope, $http, $window, $modal, notify) {\n  $scope.login = function () {\n    var path = '/login' + $window.location.search;\n    $http.post(path, {\n      username: $scope.username,\n      password: $scope.password,\n      captcha: $scope.captchaResp\n    }).success(function (data) {\n      if (data.error) {\n        notify.error(data.error);\n\n        if (data.captchaNeeded) {\n          $scope.showCaptcha = true;\n        }\n\n        $scope.resetCaptcha();\n        $scope.captchaResp = '';\n        return;\n      }\n\n      if (data.success) {\n        $window.location.assign(data.redirect);\n      }\n    }).error(function (error) {\n      notify.error(error || 'Something went wrong, try again later');\n    });\n  };\n\n  this.oAuthLogin = function (type, user) {\n    var oauthData;\n\n    if (type == 'google') {\n      oauthData = {\n        type: 'google',\n        token: user.getAuthResponse().id_token\n      };\n    } else if (type == 'facebook') {\n      oauthData = {\n        type: 'facebook',\n        token: user.authResponse.accessToken\n      };\n    } else {\n      return;\n    }\n\n    $http.post('/oauth-login' + $window.location.search, oauthData).then(function (response) {\n      var data = response.data;\n\n      if (data.error) {\n        notify.error(data.error);\n      } else if (data.success) {\n        $window.location.assign(data.redirect);\n      }\n    }).catch(function (response) {\n      if (response.status == 449) {\n        return this.showEnableOAuthModal(oauthData);\n      } else {\n        notify.error(response.data || 'Something went wrong, try again later');\n      }\n    }.bind(this));\n  };\n\n  this.showEnableOAuthModal = function (oauthData) {\n    var modalData = {};\n    $modal.open({\n      templateUrl: '/common/templates/authorize-enter-credentials-pop-up.html',\n      controller: function () {\n        this.title = \"User Authorization Required\";\n        this.data = modalData;\n        this.oauthType = oauthData.type;\n        this.messages = [\"Before using \" + oauthData.type + \" to sign into your account you must first allow it.\"];\n        this.authorizeMessage = \"Authorize \" + oauthData.type + \" sign-in on my account.\";\n        this.btnOk = \"Confirm\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      if (!modalData.authorized) {\n        notify.error(\"Login authorization canceled.\");\n      } else {\n        $http.post('/oauth-login' + $window.location.search, angular.extend({}, oauthData, {\n          authorize: 1,\n          username: modalData.username,\n          password: modalData.password\n        })).then(function (response) {\n          var data = response.data;\n\n          if (data.error) {\n            notify.error(data.error);\n          } else if (data.success) {\n            $window.location.assign(data.redirect);\n          }\n        }).catch(function (response) {\n          if (response.status == 449) {\n            return this.showEnableOAuthModal(oauthData);\n          } else {\n            notify.error(response.data || 'Something went wrong, try again later');\n          }\n        }.bind(this));\n      }\n    });\n  };\n}).controller('RedirectToLoginCtrl', function ($scope, $window) {\n  var redirect = $window.location.pathname + $window.location.search + $window.location.hash;\n  $scope.loginUrl = \"/login?redirect=\" + encodeURIComponent(redirect);\n});","angular.module('a2.orders', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.create-project', 'a2.orders.change-project-plan', 'a2.orders.order-summary', 'a2.orders.plan-selection', 'a2.orders.shipping-form', 'a2.orders.process-order', 'a2.orders.directives.plan-capacity', 'a2.orders.directives.tier-select' // 'ui.bootstrap',\n// 'humane',\n// 'a2.directives',\n// 'a2.services',\n]);","angular.module('a2.register', ['a2.forms', 'a2.directives', 'ui.bootstrap', 'angularytics', 'g-recaptcha', 'humane']).config(function (AngularyticsProvider) {\n  AngularyticsProvider.setEventHandlers(['Console', 'GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).controller('UserRegisterCtrl', function ($scope, $modal, $http, $timeout, $interval, notify) {\n  var captchaResp = '';\n\n  $scope.testUsername = function () {\n    $scope.usernameOk = '';\n    $scope.usernameErr = '';\n\n    if ($scope.testUserTimeout) {\n      $timeout.cancel($scope.testUserTimeout);\n    }\n\n    if ($scope.regis.username.$error.required) {\n      return;\n    } else if ($scope.regis.username.$error.pattern) {\n      $scope.usernameErr = \"Username must be at least 4 characters long \" + \"and can only contain alphanumeric characters,\" + \" dash(-), underscore(_) and dot(.).\";\n      return;\n    }\n\n    $scope.testUserTimeout = $timeout(function () {\n      $http.get('/api/login_available', {\n        params: {\n          username: $scope.user.username\n        }\n      }).success(function (data) {\n        if (data.available) {\n          $scope.usernameOk = $scope.user.username + \" is available\";\n        } else {\n          $scope.usernameErr = $scope.user.username + \" is not available\";\n        }\n      });\n    }, 1000);\n  };\n\n  $scope.testEmail = function () {\n    $scope.emailOk = '';\n    $scope.emailErr = '';\n\n    if ($scope.testEmailTimeout) {\n      $timeout.cancel($scope.testEmailTimeout);\n    }\n\n    if ($scope.regis.email.$error.required) {\n      return;\n    } else if ($scope.regis.email.$error.email) {\n      $scope.emailErr = \"Invalid email\";\n      return;\n    }\n\n    $scope.testEmailTimeout = $timeout(function () {\n      $http.get('/api/email_available', {\n        params: {\n          email: $scope.user.email\n        }\n      }).success(function (data) {\n        if (data.available) {\n          $scope.emailOk = $scope.user.email + \" is available\";\n        } else {\n          if (data.invalid) {\n            $scope.emailErr = $scope.user.email + \" is not a valid address\";\n          } else {\n            $scope.emailErr = $scope.user.email + \" is not available\";\n          }\n        }\n      });\n    }, 1000);\n  };\n\n  $scope.register = function ($event) {\n    if (!$scope.passResult.valid) {\n      notify.error($scope.passResult.msg);\n    } else if ($scope.usernameErr) {\n      notify.error($scope.usernameErr);\n    } else if ($scope.emailErr) {\n      notify.error($scope.emailErr);\n    } else if (!$scope.terms_accepted) {\n      notify.log('To register you must agree with our terms of service');\n    } else if (!$scope.captchaResp && !$scope.captchaNotNeeded) {\n      notify.log('Please complete the captcha');\n    } else {\n      $scope.loading = true;\n      $http.post('/register', {\n        user: $scope.user,\n        captcha: $scope.captchaResp,\n        newsletter: $scope.newsletter\n      }).success(function (data) {\n        $scope.loading = false;\n\n        if (data.success) {\n          $scope.completed = true;\n        }\n      }).error(function (data) {\n        $scope.loading = false;\n\n        if (data.error) {\n          $scope.resetCaptcha();\n          $scope.captchaResp = '';\n          return notify.error(data.error);\n        }\n\n        notify.error(\"something went wrong, please try again later\");\n      });\n    }\n  };\n});","angular.module('a2.reset-password', ['a2.directives', 'a2.forms', 'humane']).controller('ResetPassCtrl', function ($scope, $http, $window, notify) {\n  $scope.changePassword = function () {\n    if (!$scope.passResult.valid) {\n      notify.error($scope.passResult.msg);\n    }\n\n    var path = $window.location.pathname;\n    $http.post(path, {\n      password: $scope.password\n    }).success(function (data) {\n      $scope.completed = true;\n    });\n  };\n}).controller('ResetRequestCtrl', function ($scope, $http, notify) {\n  $scope.request = function () {\n    $scope.loading = true;\n    $http.post('/forgot_request', {\n      email: $scope.email\n    }).success(function (data) {\n      $scope.loading = false;\n\n      if (data.error) {\n        return notify.error(data.error);\n      }\n\n      $scope.requestComplete = true;\n    });\n  };\n});","angular.module('a2.user-settings', ['templates-arbimon2', 'a2.forms', 'ui.bootstrap', 'humane', 'angularytics']).config(function (AngularyticsProvider) {\n  AngularyticsProvider.setEventHandlers(['Console', 'GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).controller('UserSettingsCtrl', function ($scope, $modal, $http, notify) {\n  this.data = {};\n  $http.get('/api/user/info').then(function (response) {\n    $scope.user = response.data;\n    this.user = response.data;\n    this.reset();\n  }.bind(this));\n\n  this.reset = function () {\n    this.data = angular.copy(this.user);\n  };\n\n  this.save = function () {\n    var data = this.data;\n    return $http.post('/api/user/update', {\n      userData: {\n        name: data.name,\n        lastname: data.lastname,\n        oauth: data.oauth\n      }\n    }).then(function (response) {\n      if (response.data.error) {\n        notify.error(response.data.error);\n      } else {\n        notify.log(response.data.message);\n      }\n    }).catch(function (err) {\n      console.log(\"err\", err);\n      notify.serverError();\n    });\n  };\n});","var a2 = angular.module('a2.visualizer-app', ['a2.permissions', 'templates-arbimon2', 'a2.visualizer', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    // only check permissions if state have allowAccess\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (!allowed) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/visualizer\");\n}).controller('MainCtrl', function ($scope, $state, Project, $http, $window) {\n  $scope.$state = $state;\n\n  $scope.getUrlFor = function (page) {\n    if (page == 'visualizer') {\n      return '/visualizer/' + Project.getUrl() + '/';\n    }\n  };\n});","angular.module('a2.srv.api', []).factory('a2APIServiceClass', function ($location, $q, $http) {\n  var a2APIServiceClass = function (prefix) {\n    this.prefix = prefix;\n  };\n\n  function returnData(response) {\n    return response.data;\n  }\n\n  a2APIServiceClass.prototype = {\n    getUrl: function (apiRoute) {\n      return this.prefix + apiRoute;\n    },\n    get: function (apiRoute, params) {\n      return $q.when($http.get(this.prefix + apiRoute, params)).then(returnData);\n    },\n    post: function (apiRoute, data) {\n      return $q.when($http.post(this.prefix + apiRoute, data)).then(returnData);\n    },\n    delete: function (apiRoute, data) {\n      return $q.when($http.delete(this.prefix + apiRoute)).then(returnData);\n    },\n    put: function (apiRoute, data) {\n      return $q.when($http.put(this.prefix + apiRoute, data)).then(returnData);\n    }\n  };\n  return a2APIServiceClass;\n}).factory('a2APIService', function ($location, $q, a2APIServiceClass) {\n  var nrm = /\\/?(project|citizen-scientist|visualizer)\\/([\\w\\_\\-]+)/.exec($location.absUrl());\n  var projectName = nrm ? nrm[2] : '';\n  var apiURLPrefix = '/api/project/' + projectName;\n\n  function returnData(response) {\n    return response.data;\n  }\n\n  var a2APIService = new a2APIServiceClass(apiURLPrefix);\n  a2APIService.api = new a2APIServiceClass('/api');\n  a2APIService.project = new a2APIServiceClass('/project/' + projectName);\n\n  a2APIService.getProjectName = function () {\n    return projectName;\n  };\n\n  return a2APIService;\n});","angular.module('a2.service.audio-event-detection', ['a2.srv.api']).factory('AudioEventDetectionService', function (a2APIService) {\n  var AudioEventDetectionService = {\n    getList: function () {\n      return a2APIService.get('/audio-event-detections/');\n    },\n    getAlgorithmsList: function () {\n      return a2APIService.get('/audio-event-detections/algorithms');\n    },\n    getStatisticsList: function () {\n      return a2APIService.get('/audio-event-detections/statistics');\n    },\n    getDataStatisticsList: function () {\n      return a2APIService.get('/audio-event-detections/data/statistics');\n    },\n    getDataAggregatesList: function () {\n      return a2APIService.get('/audio-event-detections/data/aggregates');\n    },\n    getDataFor: function (aed, x, y, z) {\n      var args = [];\n      return a2APIService.get('/audio-event-detections/data/' + [aed, x.statistic, y.statistic, z.statistic].map(encodeURIComponent).join('/') + '?' + args.join('&'));\n    },\n    savePlotFor: function (aed, x, y, z) {\n      var params = {\n        x: x.statistic,\n        y: y.statistic,\n        z: z.statistic\n      };\n      return a2APIService.post('/audio-event-detections/default-plot/' + [aed].map(encodeURIComponent).join('/'), params);\n    },\n    new: function (aed) {\n      aed = aed || {};\n      var params = {\n        name: aed.name || aed.defaultName,\n        algorithm: aed.algorithm.id,\n        parameters: aed.parameters,\n        statistics: aed.statistics.map(function (statistic) {\n          return statistic.id;\n        }),\n        playlist: aed.playlist.id\n      };\n      return a2APIService.post('/audio-event-detections/new', params);\n    }\n  };\n  return AudioEventDetectionService;\n});","angular.module('a2.srv.audio-event-detections-clustering', ['a2.srv.project', 'humane']).factory('a2AudioEventDetectionsClustering', function ($http, Project, notify) {\n  return {\n    list: function (opts, callback) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    count: function () {\n      return $http.get('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/total-recordings').then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    validate: function (opts) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/validate', opts).then(function (response) {\n        return response.data;\n      });\n    },\n    unvalidate: function (opts) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/unvalidate', opts).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (jobId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/audio-event-detections-clustering/' + jobId + '/remove').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist-admin', ['a2.srv.api']).factory('a2CitizenScientistAdminService', function (a2APIService, Project, notify) {\n  return {\n    getClassificationStats: function (speciesId) {\n      return a2APIService.get('/citizen-scientist/stats/classification' + (speciesId ? '/' + speciesId : '')).catch(notify.serverError);\n    },\n    getUserStats: function (userId) {\n      return a2APIService.get('/citizen-scientist/stats/user' + (userId ? '/' + userId : '')).catch(notify.serverError);\n    },\n    getUserStatsExportUrl: function () {\n      return '/api/project/' + Project.getUrl() + '/citizen-scientist/stats/export/user-stats.csv';\n    },\n    getCSExportUrl: function (pattern_matching_id, per_user) {\n      var filename = per_user ? 'export-per-user.csv' : 'export.csv';\n      return '/api/project/' + Project.getUrl() + '/citizen-scientist/pattern-matchings/' + pattern_matching_id + '/' + filename;\n    },\n    getSettings: function () {\n      return a2APIService.get('/citizen-scientist/settings').catch(notify.serverError);\n    },\n    setSettings: function (settings) {\n      return a2APIService.post('/citizen-scientist/settings', settings).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist-expert', ['a2.srv.api']).factory('a2CitizenScientistExpertService', function (a2APIService, Project, notify) {\n  return {\n    getPatternMatchings: function () {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/expert').catch(notify.serverError);\n    },\n    getPatternMatchingDetailsFor: function (patternMatchingId) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert/details').catch(notify.serverError);\n    },\n    getPatternMatchingRoisFor: function (patternMatchingId, limit, offset, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert-rois/' + (offset || 0) + '_' + (limit || 0) + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    validatePatternMatchingRois: function (patternMatchingId, rois, validation) {\n      return a2APIService.post('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert-validate', {\n        rois: rois,\n        validation: validation\n      }).catch(notify.serverError);\n    },\n    getCSExportUrl: function (options) {\n      options = options || {};\n      return '/api/project/' + Project.getUrl() + '/citizen-scientist/pattern-matchings/' + (options.patternMatching | 0) + '/export.csv';\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist', ['a2.srv.api']).factory('a2CitizenScientistService', function (a2APIService, notify) {\n  return {\n    getMyStats: function (userId) {\n      return a2APIService.get('/citizen-scientist/stats/mine').catch(notify.serverError);\n    },\n    getPatternMatchings: function () {\n      return a2APIService.get('/citizen-scientist/pattern-matchings').catch(notify.serverError);\n    },\n    getPatternMatchingDetailsFor: function (patternMatchingId) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/details').catch(notify.serverError);\n    },\n    getPatternMatchingRoisFor: function (patternMatchingId, limit, offset) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/rois/' + (offset || 0) + '_' + (limit || 0)).catch(notify.serverError);\n    },\n    validatePatternMatchingRois: function (patternMatchingId, rois, validation) {\n      return a2APIService.post('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/validate', {\n        rois: rois,\n        validation: validation\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.classi', ['a2.srv.project', 'humane']).factory('a2Classi', function ($http, Project, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/classifications').then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetails: function (classificationId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId).success(callback).error(notify.serverError);\n    },\n    getResultDetails: function (classificationId, first, limit, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/more/' + first + '/' + limit).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getRecVector: function (classificationId, recId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/vector/' + recId);\n    },\n    create: function (classificationData, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/classifications/new', classificationData).success(callback).error(notify.serverError);\n    },\n    delete: function (classificationId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/delete').success(callback).error(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.clustering-jobs', ['a2.srv.project', 'humane']).factory('a2ClusteringJobs', function ($http, Project, notify, $httpParamSerializer) {\n  return {\n    list: function (opts) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getJobDetails: function (clusteringJobId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs/' + clusteringJobId + '/job-details').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getClusteringDetails: function (opts) {\n      var config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.job_id + '/clustering-details', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getRoisDetails: function (opts) {\n      var params = {};\n\n      if (opts.aed) {\n        params.aed = opts.aed;\n      }\n\n      if (opts.rec_id) {\n        params.rec_id = opts.rec_id;\n      }\n\n      if (opts.search && opts.search == 'per_site') {\n        params.perSite = true;\n      } else if (opts.search && opts.search == 'per_date') {\n        params.perDate = true;\n      } else params.all = true;\n\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.jobId + '/rois-details', params).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    exportClusteringROIs: function (opts) {\n      const config = {\n        params: opts\n      };\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.jobId + '/rois-export', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getAudioUrlFor: function (recId, aedId) {\n      return '/api/project/' + Project.getUrl() + '/clustering-jobs/' + recId + '/audio/' + aedId;\n    },\n    audioEventDetections: function (opts) {\n      var config = {\n        params: {}\n      };\n\n      if (opts.completed) {\n        config.params.completed = opts.completed;\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/clustering-jobs/audio-event-detections', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/new', data).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    delete: function (clusteringJobId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/clustering-jobs/' + clusteringJobId + '/remove').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.cnn', ['a2.srv.project', 'humane']).factory('a2CNN', function ($q, $http, Project, notify) {\n  var saveData = null;\n  return {\n    listROIs: function (job_id, limit, offset, species_id, site_id, search, callback) {\n      if (!limit) {\n        var limit = 100;\n      }\n\n      if (!offset) {\n        var offset = 0;\n      }\n\n      if (!species_id) {\n        species_id = 0;\n      }\n\n      if (!site_id) {\n        site_id = 0;\n      }\n\n      if (!search) {\n        search = \"all\";\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/rois/' + job_id + \"/\" + species_id + \"/\" + site_id + \"/\" + search + \"/\" + offset + \"_\" + limit).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listROIsBySpecies: function (job_id, species_id, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/roisBySpecies/' + job_id + '/' + species_id).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listResults: function (job_id, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/results/' + job_id).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listModels: function (callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/models').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetailsFor: function (cnnId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/details').then(function (response) {\n        return response.data;\n      });\n    },\n    getRoisFor: function (cnnId, limit, offset) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/rois/' + (offset || 0) + '_' + (limit || 0)).then(function (response) {\n        return response.data;\n      });\n    },\n    countROIsBySpecies: function (cnnId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySpecies');\n    },\n    countROIsBySites: function (cnnId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySites');\n    },\n    countROIsBySpeciesSites: function (cnnId, options) {\n      var search = \"all\";\n\n      if (options.search) {\n        search = options.search;\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySpeciesSites/' + search);\n    },\n    getExportUrl: function (params) {\n      return '/api/project/' + Project.getUrl() + '/cnn/' + params.cnnId + '/rois.csv';\n    },\n    getAudioUrlFor: function (roi) {\n      return '/api/project/' + Project.getUrl() + '/cnn/' + roi.job_id + '/audio/' + roi.cnn_result_roi_id;\n    },\n    validateRois: function (cnnId, rois, validation) {\n      return $http.post('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/validate', {\n        rois: rois,\n        validation: validation\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/cnn/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (cnnId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/remove').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.service.download-resource', []).service('$downloadResource', function ($window) {\n  return function $downloadResource(resource_url) {\n    var a = angular.element('<a></a>').attr('target', '_blank').attr('href', resource_url).appendTo('body');\n    $window.setTimeout(function () {\n      a[0].click();\n      a.remove();\n    }, 0);\n  };\n});","angular.module('a2.services', ['a2.srv.classi', 'a2.srv.models', 'a2.srv.playlists', 'a2.srv.project', 'a2.srv.sites', 'a2.srv.soundscapes', 'a2.srv.species', 'a2.srv.users', 'a2.srv.training-sets', 'a2.srv.templates', 'a2.srv.audio-event-detections-clustering', 'a2.srv.clustering-jobs']);","angular.module('a2.srv.local-storage', []).service('$localStorage', function ($window) {\n  return {\n    getItem: function (item) {\n      if ($window.localStorage) {\n        return $window.localStorage.getItem(item);\n      }\n    },\n    setItem: function (item, value) {\n      if ($window.localStorage) {\n        $window.localStorage.setItem(item, value);\n      }\n    }\n  };\n});","angular.module('a2.srv.models', ['a2.srv.project', 'humane']).factory('a2Models', function ($http, Project, notify) {\n  var saveData = null;\n  var openedModel = false;\n  return {\n    modelState: function (s) {\n      openedModel = s;\n    },\n    isModelOpen: function () {\n      return openedModel;\n    },\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models').success(callback).error(notify.serverError);\n    },\n    getFormInfo: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models/forminfo').success(callback).error(notify.serverError);\n    },\n    findById: function (modelId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId);\n    },\n    create: function (modelData) {\n      return $http.post('/api/project/' + Project.getUrl() + '/models/new', modelData);\n    },\n    delete: function (modelId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId + \"/delete\").success(callback).error(notify.serverError);\n    },\n    getValidationResults: function (modelId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId + '/validation-list/').success(callback).error(notify.serverError);\n    },\n    getRecVector: function (modelId, recId, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/models/' + modelId + '/training-vector/' + recId);\n    },\n    setThreshold: function (modelId, thresholdValue) {\n      var data = {\n        m: modelId,\n        t: thresholdValue\n      };\n      return $http.post('/api/project/' + Project.getUrl() + '/models/savethreshold', data);\n    }\n  };\n});","angular.module('a2.srv.news', ['a2.srv.api']).service('a2NewsService', function ($q, a2APIService) {\n  return {\n    loadPage: function (index) {\n      return a2APIService.api.get('/user/feed/' + (index | 0));\n    },\n    loadFormats: function () {\n      return a2APIService.api.get('/user/feed/formats');\n    }\n  };\n});","angular.module('a2.srv.open-modal', ['ui.bootstrap.modal']).provider('$openModal', function () {\n  var $openModalProvider = {\n    defs: {},\n    define: function (modalName, modalDef) {\n      $openModalProvider.defs[modalName] = angular.extend({}, modalDef);\n    },\n    $get: function ($modal) {\n      return function $openModal(modalName, overrides) {\n        var options = angular.extend({}, $openModalProvider.defs[modalName]);\n\n        if (overrides) {\n          if (overrides.resolve) {\n            console.log(\"overrides.resolve\", overrides.resolve);\n            options.resolve = angular.extend(options.resolve, overrides.resolve);\n            console.log(\"options.resolve\", options.resolve);\n            delete overrides.resolve;\n          }\n\n          options = angular.extend(options, overrides);\n        }\n\n        return $modal.open(options);\n      };\n    }\n  };\n  return $openModalProvider;\n});","angular.module('a2.srv.patternmatching', ['a2.srv.project', 'humane']).factory('a2PatternMatching', function ($q, $http, a2APIService, Project, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (opts, callback) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/api/project/' + Project.getUrl() + '/pattern-matchings', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetailsFor: function (patternMatchingId) {\n      return $http.get('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/details').then(function (response) {\n        return response.data;\n      });\n    },\n    getPatternMatchingsTotal: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/pattern-matchings/count').success(function (data) {\n        callback(data);\n      });\n    },\n    getRoisFor: function (patternMatchingId, limit, offset, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/pattern-matchings/' + patternMatchingId + '/rois/' + (offset || 0) + '_' + (limit || 0) + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    getSitesListFor: function (patternMatchingId, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/pattern-matchings/' + patternMatchingId + '/site-index' + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    getExportUrl: function (params) {\n      return '/api/project/' + Project.getUrl() + '/pattern-matchings/' + params.patternMatching + '/' + params.jobName + '.csv';\n    },\n    getAudioUrlFor: function (roi) {\n      const ext = '.mp3';\n      return '/api/project/' + Project.getUrl() + '/pattern-matchings/' + roi.pattern_matching_id + '/audio/' + roi.id + ext;\n    },\n    validateRois: function (patternMatchingId, rois, validation, cls) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/validate', {\n        rois: rois,\n        validation: validation,\n        cls: cls\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    update: function (patternMatchingId, data) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/update', data).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (patternMatchingId) {\n      return $http.post('/api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/remove').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.srv.playlists', ['a2.srv.project']).factory('a2Playlists', function (Project, a2APIService, $rootScope, $http) {\n  var projectName = Project.getUrl();\n  return {\n    getList: function (options) {\n      if (options) {\n        options = {\n          params: options\n        };\n      }\n\n      if (options && options.filterPlaylistLimit) {\n        options.params.filterPlaylistLimit = options.filterPlaylistLimit;\n      }\n\n      return $http.get('/api/project/' + projectName + '/playlists', options).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (playlistParams, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/create', playlistParams).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    combine: function (expression) {\n      return a2APIService.post('/playlists/combine', expression).then(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        return data;\n      });\n    },\n    getRecordingPosition: function (playlist, recording, callback) {\n      var r = $http.get('/api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/position');\n\n      if (callback) {\n        r.success(callback);\n      }\n\n      return r;\n    },\n    // addData: function(playlist, tset_data, callback) {\n    //     var projectName = Project.getUrl();\n    //     $http.post('/api/project/'+projectName+'/playlists/add-data/'+playlist, tset_data).success(function(data) {\n    //         callback(data);\n    //     });\n    // },\n    getPreviousRecording: function (playlist, recording, callback) {\n      return $http.get('/api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/previous').success(function (data) {\n        callback(data);\n      });\n    },\n    getNextRecording: function (playlist, recording, callback) {\n      return $http.get('/api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/next').success(function (data) {\n        callback(data);\n      });\n    },\n    rename: function (playlist, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/rename', playlist).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    remove: function (playlistIds, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/delete', {\n        playlists: playlistIds\n      }).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    getInfo: function (playlist, callback) {\n      $http({\n        method: 'GET',\n        url: '/api/project/' + projectName + '/playlists/info/' + playlist\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getData: function (playlist, params, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/' + playlist, params).success(function (data) {\n        callback(data);\n      });\n    },\n    $on: function (event, handler) {\n      return $rootScope.$on('a2Playlists-' + event, handler);\n    },\n    attachAedToPlaylist: function (opts, callback) {\n      $http.post('/api/project/' + projectName + '/playlists/' + opts.playlist_id + '/aed', {\n        aed: opts.aed\n      }).success(function (data) {\n        callback(data);\n      });\n    }\n  };\n});","angular.module('a2.srv.project', ['a2.srv.api']).factory('Project', function ($location, $http, $q, $httpParamSerializer, a2APIService, notify) {\n  var nameRe = /\\/?(project|citizen-scientist|visualizer)\\/([\\w\\_\\-]+)/;\n  var nrm = nameRe.exec($location.absUrl());\n  var url = nrm ? nrm[2] : '';\n  return {\n    getUrl: function () {\n      return url;\n    },\n    getInfo: function (callback) {\n      $http.get('/api/project/' + url + '/info').success(function (data) {\n        callback(data);\n      });\n    },\n    getProjectById: function (projectId, callback) {\n      var config = {\n        params: {}\n      };\n\n      if (projectId) {\n        config.params.project_id = projectId;\n      }\n\n      $http.get('/api/project/' + url + '/info/source-project', config).success(function (data) {\n        callback(data);\n      });\n    },\n    updateInfo: function (info, callback) {\n      $http.post('/api/project/' + url + '/info/update', info).success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getUsage: function () {\n      return $http.get('/api/project/' + url + '/usage');\n    },\n    getSites: function (options, callback) {\n      if (typeof options == 'function') {\n        callback = options;\n        options = {};\n      }\n\n      return $q.when($http.get('/api/project/' + url + '/sites', {\n        params: options\n      })).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    },\n    getClasses: function (options, callback) {\n      if (typeof options == 'function') {\n        callback = options;\n        options = {};\n      }\n\n      return $q.when($http.get('/api/project/' + url + '/classes', {\n        params: options\n      })).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    },\n    getRecs: function (query, callback) {\n      if (typeof query === \"function\") {\n        callback = query;\n        query = {};\n      }\n\n      if (query && query.tags) {\n        query['tags[]'] = query.tags.flat();\n        delete query.tags;\n      }\n\n      $http.get('/api/project/' + url + '/recordings/search', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecCounts: function (query) {\n      if (query && query.project_url) {\n        delete query.project_url;\n      }\n\n      return a2APIService.get('/recordings/search-count', {\n        params: query || {}\n      });\n    },\n    getRecordingData: function (filters, projection) {\n      if (filters.tags) {\n        filters.tags = filters.tags.flat();\n      }\n\n      var params = {\n        filters: filters,\n        show: projection\n      };\n      Object.keys(params).forEach(function (param) {\n        if (!Object.keys(params[param] || {}).length) {\n          delete params[param];\n        }\n      });\n      var serializedParams = $httpParamSerializer(params);\n      const getUrl = '/api/project/' + url + '/recordings/' + (projection && projection.species ? 'occupancy-models-export/' + projection.species_name : projection && projection.grouped ? 'grouped-detections-export' : 'recordings-export') + (serializedParams.length ? '?' + serializedParams : '');\n      return $http.get(getUrl).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n      ;\n    },\n    getSitesExportUrl: function () {\n      return '/api/project/' + url + '/sites-export.csv';\n    },\n    getRecTotalQty: function (callback) {\n      return a2APIService.get('/recordings/count').then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getProjectTotalSpecies: function (projectId, callback) {\n      $http.get('/api/project/' + url + '/species-count', {\n        project_id: projectId\n      }).success(function (count) {\n        callback(count);\n      });\n    },\n    getProjectTimeBounds: function (callback) {\n      return a2APIService.get('/recordings/time-bounds').then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getRecordings: function (key, options, callback) {\n      if (options instanceof Function) {\n        callback = options;\n        options = {};\n      }\n\n      $http.get('/api/project/' + url + '/recordings/' + key, {\n        params: options\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingAvailability: function (key, callback) {\n      return a2APIService.get('/recordings/available/' + key).then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getOneRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/find/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingInfo: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/info/' + rec_id).success(function (data) {\n        callback(data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getNextRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/next/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    getPreviousRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/previous/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    validateRecording: function (rec_id, validation, callback) {\n      $http.post('/api/project/' + url + '/recordings/validate/' + rec_id, validation).success(function (data) {\n        callback(data);\n      });\n    },\n    recExists: function (site_id, filename, callback) {\n      $http.get('/api/project/' + url + '/recordings/exists/site/' + site_id + '/file/' + filename).success(function (data) {\n        callback(data.exists);\n      });\n    },\n    downloadRecording: function (rec_id, callback) {\n      $http.get('/api/project/' + url + '/recordings/download/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    addClass: function (projectClass, callback) {\n      return $http.post('/api/project/' + url + '/class/add', projectClass);\n    },\n    removeClasses: function (projectClasses, callback) {\n      return $http.post('/api/project/' + url + '/class/del', projectClasses);\n    },\n    getUsers: function (callback) {\n      $http.get('/api/project/' + url + '/users').success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getRoles: function (callback) {\n      $http.get('/api/project/' + url + '/roles').success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    addUser: function (data, callback) {\n      $http.post('/api/project/' + url + '/user/add', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    removeUser: function (data, callback) {\n      $http.post('/api/project/' + url + '/user/del', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    changeUserRole: function (data, callback) {\n      $http.post('/api/project/' + url + '/user/role', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getModels: function (callback) {\n      $http.get('/api/project/' + url + '/models').success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getClassi: function (callback) {\n      $http.get('/api/project/' + url + '/classifications').success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    validationsCount: function (callback) {\n      $http.get('/api/project/' + url + '/validations/count').success(function (response) {\n        callback(response.count);\n      });\n    },\n    validationBySpeciesSong: function (speciesId, songtypeId, callback) {\n      $http.get('/api/project/' + url + '/validations', {\n        params: {\n          species_id: speciesId,\n          sound_id: songtypeId\n        }\n      }).success(callback);\n    },\n    getProjectsList: function (ownershipType, callback) {\n      var config = {\n        params: {}\n      };\n\n      if (ownershipType) {\n        config.params.type = ownershipType;\n      }\n\n      $http.get('/api/user/projectlist', config).success(function (response) {\n        callback(response);\n      });\n    },\n    removeProject: function (data) {\n      return $http.post('/api/project/' + url + '/remove', data);\n    }\n  };\n});","angular.module('a2.srv.resolve', []).factory('$promisedResolve', function ($q, $injector) {\n  return function $resolve(resolveMap, context) {\n    context = context || {};\n    return $q.all(Object.keys(resolveMap).map(function (key) {\n      return $q.resolve().then(function () {\n        return $injector.invoke(resolveMap[key]);\n      }).then(function (value) {\n        context[key] = value;\n      });\n    })).then(function () {\n      return context;\n    });\n  };\n});","angular.module('a2.service.serialize-promised-fn', [])\n/** serializePromisedFn function decorator.\n * Decorates a promise-returning function so that\n * concurrent calls occur in a serialized manner, \n * that is, each call takes turn in a queue and gets\n * processed one at a time, in call order.\n */\n.service('serializePromisedFn', function ($q) {\n  return function serializePromisedFn(fn) {\n    var series = $q.resolve();\n    return function serializedPromisedFn() {\n      var context = this;\n      var args = Array.prototype.slice.call(arguments);\n      series = series.then(function () {\n        return fn.apply(context, args);\n      });\n      return series;\n    };\n  };\n});","angular.module('a2.srv.sites', ['a2.srv.project', 'humane']).factory('a2Sites', function ($http, $q, Project, notify) {\n  return {\n    listPublished: function (callback) {\n      $http.get('/api/sites/published').success(function (data) {\n        callback(data);\n      });\n    },\n    import: function (site, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/import', {\n        site: site\n      }).success(callback);\n    },\n    update: function (site, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/update', {\n        site: site\n      }).success(callback).error(notify.serverError);\n    },\n    create: function (site, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/create', {\n        site: site\n      }).success(callback).error(notify.serverError);\n    },\n    delete: function (sites, callback) {\n      $http.post('/api/project/' + Project.getUrl() + '/sites/delete', {\n        sites: sites\n      }).success(callback).error(notify.serverError);\n    },\n    // Uses Promises :-)\n    getLogFiles: function (site, callback) {\n      return $http.get('/api/project/' + Project.getUrl() + '/sites/' + site + '/logs');\n    },\n    getSiteLogDataDates: function (site, series) {\n      var d = $q.defer();\n      $http.get('/api/project/' + Project.getUrl() + '/sites/' + site + '/log/data.txt?get=dates').success(d.resolve.bind(d)).error(d.reject.bind(d));\n      return d.promise;\n    },\n    getSiteLogDataUrl: function (site, series, from, to, period) {\n      var args = 'q=' + period + '&from=' + from.getTime() + '&to=' + to.getTime();\n\n      if (/uploads/.test(series)) {\n        return $q.resolve('/api/project/' + Project.getUrl() + '/sites/' + site + '/uploads.txt?' + args);\n      } else if (/recordings/.test(series)) {\n        return $q.resolve('/api/project/' + Project.getUrl() + '/sites/' + site + '/data.txt?' + args);\n      } else {\n        return $q.resolve('/api/project/' + Project.getUrl() + '/sites/' + site + '/log/data.txt?stat=' + series + '&' + args);\n      }\n    },\n    getSiteLogData: function (site, series, from, to, period) {\n      return this.getSiteLogDataUrl(site, series, from, to, period).then(function (url) {\n        return $q.when($http.get(url));\n      }).then(function (response) {\n        var data = {};\n\n        if (response.data) {\n          data.rows = response.data.trim().split('\\n').map(function (line) {\n            return line.split(',');\n          });\n        }\n\n        return data;\n      });\n    },\n    // Get list of assets to a site\n    getListOfAssets: function (site_id) {\n      var d = $q.defer();\n      $http.get('/api/project/' + Project.getUrl() + '/streams/' + site_id + '/assets').success(d.resolve.bind(d)).error(d.reject.bind(d));\n      return d.promise;\n    },\n    // Uses Promises\n    generateToken: function (site) {\n      return $http.post('/api/project/' + Project.getUrl() + '/sites/generate-token', {\n        site: site.id\n      });\n    },\n    revokeToken: function (site) {\n      return $http.post('/api/project/' + Project.getUrl() + '/sites/revoke-token', {\n        site: site.id\n      });\n    }\n  };\n});","angular.module('a2.srv.soundscape-composition', ['a2.srv.api']).factory('a2SoundscapeCompositionService', function ($q, a2APIService) {\n  return {\n    getClassList: function (options) {\n      options = options || {};\n      var params = {};\n\n      if (options.tally) {\n        params.tally = 1;\n      }\n\n      if (options.isSystemClass) {\n        params.isSystemClass = 1;\n      }\n\n      return a2APIService.get('/soundscape-composition/classes', {\n        params: params\n      }).then(function (classList) {\n        if (options.groupByType) {\n          return classList.reduce(function (_, item) {\n            if (!_.index[item.typeId]) {\n              _.list.push(_.index[item.typeId] = {\n                type: item.type,\n                typeId: item.typeId,\n                list: []\n              });\n            }\n\n            _.index[item.typeId].list.push(item);\n\n            return _;\n          }, {\n            list: [],\n            index: {}\n          }).list;\n        } else {\n          return classList;\n        }\n      });\n    },\n    addClass: function (name, typeId) {\n      return a2APIService.post('/soundscape-composition/add-class', {\n        name: name,\n        type: typeId\n      });\n    },\n    removeClass: function (scClassid) {\n      return a2APIService.post('/soundscape-composition/remove-class', {\n        id: scClassid\n      });\n    },\n    getAnnotationsFor: function (visobject) {\n      if (visobject && /^recording$/.test(visobject.type)) {\n        return a2APIService.get('/soundscape-composition/annotations/' + (visobject.id | 0));\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    annotate: function (visobject, annotation) {\n      if (visobject && /^recording$/.test(visobject.type)) {\n        return a2APIService.post('/soundscape-composition/annotate/' + (visobject.id | 0), annotation);\n      } else {\n        return $q.reject(new Error(\"Cannot add soundscape composition annotation\" + (visobject ? \" to \" + visobject.type : \"\") + \".\"));\n      }\n    }\n  };\n});","angular.module('a2.srv.soundscapes', ['a2.srv.project', 'humane']).factory('a2Soundscapes', function (Project, $http, $q, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    getAmplitudeReferences: function () {\n      return $q.resolve([{\n        value: 'absolute',\n        caption: \"Absolute\",\n        description: \"The threshold is taken as an absolute value of the amplitude of each peak.\"\n      }, {\n        value: 'relative-to-peak-maximum',\n        caption: \"Relative to maximum\",\n        description: \"The threshold is taken as a relative proportion of the maximum amplitude of the peaks in the soundscape.\"\n      }]);\n    },\n    get: function (soundscapeId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId).success(function (data) {\n        callback(data);\n      });\n    },\n    getSCIdx: function (soundscapeId, params, callback) {\n      if (params instanceof Function) {\n        callback = params;\n        params = undefined;\n      }\n\n      if (!params) {\n        params = {};\n      }\n\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/scidx', {\n        params: params\n      }).success(function (data) {\n        if (callback) callback(data);\n        d.resolve(data);\n      });\n      return d.promise;\n    },\n    getNormVector: function (soundscapeId, callback) {\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/norm-vector').success(function (data) {\n        if (callback) callback(data);\n        d.resolve(data);\n      });\n      return d.promise;\n    },\n    // TODO fusion getList and getList2 routes to return needed data\n    getList: function (query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = {};\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getList2: function (callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/soundscapes/details').success(callback).error(notify.serverError);\n    },\n    setVisualizationOptions: function (soundscapeId, params, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/scale', params).success(function (data) {\n        callback(data);\n      });\n    },\n    addRegion: function (soundscapeId, bbox, params, callback) {\n      var projectName = Project.getUrl();\n      params.bbox = bbox;\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/add', params).success(function (data) {\n        callback(data);\n      });\n    },\n    sampleRegion: function (soundscapeId, region, params, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/sample', params).success(function (data) {\n        callback(data);\n      });\n    },\n    getExportUrl: function (options) {\n      var soundscapeId = options.soundscape.soundscape_id;\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      var args = [];\n\n      if (options.raw) {\n        args.push('raw=1');\n      }\n\n      d.resolve('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/export-list' + (args.length ? '?' + args.join('&') : ''));\n      return d.promise;\n    },\n    getRegion: function (soundscapeId, region, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingTags: function (soundscapeId, region, recording, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording).success(function (data) {\n        callback(data);\n      });\n    },\n    addRecordingTag: function (soundscapeId, region, recording, tag, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording + '/add', {\n        tag: tag\n      }).success(callback);\n    },\n    removeRecordingTag: function (soundscapeId, region, recording, tag, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording + '/remove', {\n        tag: tag\n      }).success(callback);\n    },\n    getRegions: function (soundscapeId, query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = undefined;\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordings: function (soundscapeId, bbox, query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = {};\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/soundscapes/' + soundscapeId + '/recordings/' + bbox, {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    // TODO change method to receive id\n    findIndices: function (soundscapeId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/soundscapes/' + soundscapeId + '/indices').success(callback);\n    },\n    delete: function (soundscapeId, callback) {\n      $http.get('/api/project/' + Project.getUrl() + '/soundscapes/' + soundscapeId + \"/delete\").success(callback).error(notify.serverError);\n    },\n    create: function (soundscapeData) {\n      return $http.post('/api/project/' + Project.getUrl() + '/soundscape/new', soundscapeData);\n    }\n  };\n});","angular.module('a2.srv.species', []).factory('Species', function ($http) {\n  var species;\n  return {\n    get: function (callback) {\n      if (species) return callback(species);\n      $http.get('/api/species/list/100').success(function (data) {\n        species = data;\n        callback(species);\n      });\n    },\n    search: function (query, callback) {\n      $http.get('/api/species/search', {\n        params: {\n          q: query\n        }\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    findById: function (species_id, callback) {\n      return $http.get('/api/species/' + species_id).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    }\n  };\n}).factory('Songtypes', function ($http) {\n  var songs;\n\n  var searchId = function (id, callback) {\n    var s = songs.filter(function (song) {\n      return song.id === id;\n    });\n    if (s !== null) callback(s[0]);\n  };\n\n  return {\n    get: function (callback) {\n      if (songs) return callback(songs);\n      $http.get('/api/songtypes/all').success(function (data) {\n        songs = data;\n        callback(songs);\n      });\n    },\n    findById: function (songtype_id, callback) {\n      if (songs) {\n        searchId(songtype_id, callback);\n        return;\n      }\n\n      $http.get('/api/songtypes/all').success(function (data) {\n        songs = data;\n        searchId(songtype_id, callback);\n      });\n    }\n  };\n});","angular.module('a2.srv.tags', ['a2.srv.api']).factory('a2Tags', function ($q, a2APIService, notify) {\n  function isTaggableType(type) {\n    return /^recording$/.test('' + type);\n  }\n\n  function isTaggableResource(obj) {\n    return obj && isTaggableType(obj.type) && obj.id;\n  }\n\n  return {\n    getFor: function (visobject) {\n      if (isTaggableResource(visobject)) {\n        return a2APIService.get('/tags/' + visobject.type + '/' + (visobject.id | 0));\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    getForType: function (resourceType) {\n      if (isTaggableType(resourceType)) {\n        return a2APIService.get('/tags/' + resourceType);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    deleteFor: function (visobject, tagId) {\n      if (isTaggableResource(visobject)) {\n        return a2APIService.delete('/tags/' + visobject.type + '/' + (visobject.id | 0) + '/' + tagId);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    addFor: function (visobject, tag) {\n      if (isTaggableResource(visobject)) {\n        var data = {};\n\n        if (tag.tag_id) {\n          data.id = tag.tag_id;\n        } else {\n          data.text = tag.tag;\n        }\n\n        if (tag.t0 !== undefined) {\n          data.t0 = tag.t0;\n          data.f0 = tag.f0;\n          data.t1 = tag.t1;\n          data.f1 = tag.f1;\n        }\n\n        return a2APIService.put('/tags/' + visobject.type + '/' + (visobject.id | 0), data).catch(notify.serverError);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    search: function (text) {\n      return a2APIService.get('/tags/?q=' + text);\n    }\n  };\n});","angular.module('a2.srv.templates', ['a2.srv.project']).factory('a2Templates', function (Project, $http, notify) {\n  return {\n    getList: function (opts) {\n      var projectName = Project.getUrl();\n      var config = {\n        params: {}\n      };\n\n      if (opts && opts.showRecordingUri) {\n        config.params.showRecordingUri = opts.showRecordingUri;\n      }\n\n      if (opts && opts.projectTemplates) {\n        config.params.projectTemplates = opts.projectTemplates;\n      }\n\n      if (opts && opts.publicTemplates) {\n        config.params.publicTemplates = opts.publicTemplates;\n      }\n\n      if (opts && opts.q) {\n        config.params.q = opts.q;\n      }\n\n      if (opts && opts.limit) {\n        config.params.limit = opts.limit;\n      }\n\n      if (opts && opts.offset !== undefined) {\n        config.params.offset = opts.offset;\n      }\n\n      return $http.get('/api/project/' + projectName + '/templates', config).then(function (response) {\n        return response.data;\n      });\n    },\n    count: function (opts) {\n      var config = {\n        params: {}\n      };\n\n      if (opts && opts.publicTemplates) {\n        config.params.publicTemplates = opts.publicTemplates;\n      }\n\n      return $http.get('/api/project/' + Project.getUrl() + '/templates/count', config).then(function (response) {\n        return response.data;\n      });\n    },\n    add: function (template_data) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/templates/add', template_data).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getAudioUrlFor: function (template) {\n      const ext = '.mp3';\n      return '/api/project/' + Project.getUrl() + '/templates/audio/' + template.id + ext;\n    },\n    delete: function (templateId) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/templates/' + templateId + '/remove');\n    },\n    getImage: function (templateId) {\n      var projectName = Project.getUrl();\n      return $http.get('/api/project/' + projectName + '/templates/data/' + templateId + '/image').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.srv.training-sets', ['a2.srv.project']).factory('a2TrainingSets', function (Project, $http) {\n  return {\n    getList: function (callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets').success(function (data) {\n        callback(data);\n      });\n    },\n    add: function (tset_data, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/training-sets/add', tset_data).success(function (data) {\n        callback(data);\n      });\n    },\n    edit: function (trainingSetId, tset_data) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/training-sets/edit/' + trainingSetId, tset_data);\n    },\n    delete: function (trainingSetId) {\n      var projectName = Project.getUrl();\n      return $http.post('/api/project/' + projectName + '/training-sets/remove/' + trainingSetId);\n    },\n    addData: function (trainingSetId, tset_data, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/api/project/' + projectName + '/training-sets/add-data/' + trainingSetId, tset_data).success(function (data) {\n        callback(data);\n      });\n    },\n    getData: function (trainingSetId, recording_uri, callback) {\n      if (recording_uri instanceof Function) {\n        callback = recording_uri;\n        recording_uri = \"\";\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/list/' + trainingSetId + '/' + recording_uri).success(function (data) {\n        callback(data);\n      });\n    },\n    getDataImage: function (trainingSetId, dataId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/data/' + trainingSetId + '/get-image/' + dataId).success(function (data) {\n        callback(data);\n      });\n    },\n    getTypes: function (callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/types').success(function (data) {\n        callback(data);\n      });\n    },\n    getRois: function (trainingSetId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/rois/' + trainingSetId).success(function (data) {\n        callback(data);\n      });\n    },\n    getExportUrl: function (trainingSetId) {\n      var projectName = Project.getUrl();\n      return '/api/project/' + projectName + '/training-sets/rois/' + trainingSetId + '?export=1';\n    },\n    getSpecies: function (trainingSetId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/species/' + trainingSetId).success(function (data) {\n        callback(data);\n      });\n    },\n    removeRoi: function (trainingSetId, roiId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/api/project/' + projectName + '/training-sets/' + trainingSetId + '/remove-roi/' + roiId).success(function (data) {\n        callback(data);\n      });\n    }\n  };\n});","angular.module('a2.srv.uploads', ['a2.srv.api']).factory('a2UploadsService', function (a2APIService) {\n  return {\n    getProcessingList: function (opts) {\n      const config = {\n        params: opts\n      };\n      return a2APIService.get('/uploads/processing', config).then(function (data) {\n        return data;\n      });\n    },\n    checkStatus: function (opts) {\n      const config = {\n        params: opts\n      };\n      return a2APIService.get('/uploads/check', config).then(function (data) {\n        return data.items;\n      });\n    }\n  };\n});","angular.module('a2.srv.users', []).factory('Users', function ($http) {\n  var users;\n  return {\n    getInfoForId: function (user_id) {\n      return $http.get('/api/user/info/' + user_id).then(function (response) {\n        return response.data.user;\n      });\n    }\n  };\n});","angular.module('a2.filters', ['a2.filter.as-csv', 'a2.filter.caps', 'a2.filter.a2-page-number-to-title', 'a2.filter.a2-page-title-to-number', 'a2.filter.project-url', 'a2.filter.range', 'a2.filter.round', 'a2.filter.time-from-now']);","angular.module('a2.filter.as-csv', []).filter('asCSV', function () {\n  return function (value, delimiter, filter) {\n    if (!(value instanceof Array)) {\n      if (typeof value == 'object') {\n        value = Object.keys(value).map(function (key) {\n          return key + \"=\" + (value[key] === undefined ? '' : value[key]);\n        });\n      } else {\n        value = [value];\n      }\n    }\n\n    if (filter) {\n      value = value.filter(function (v) {\n        return !!v;\n      });\n    }\n\n    return value.join(delimiter || ', ');\n  };\n});","angular.module('a2.filter.caps', []).filter('caps', function () {\n  return function (input, type) {\n    if (!input) {\n      return undefined;\n    }\n\n    switch (type || 'title') {\n      case 'title-case':\n        return input.replace(/\\b\\w/g, function (_) {\n          return _.toUpperCase();\n        });\n\n      default:\n        return input;\n    }\n  };\n});","angular.module('a2.filter.a2-page-number-to-title', []).filter('a2PageNumberToTitle', function () {\n  return function a2PageNumberToTitle(page_number) {\n    return page_number + 1;\n  };\n});","angular.module('a2.filter.a2-page-title-to-number', []).filter('a2PageTitleToNumber', function () {\n  return function a2PageTitleToNumber(page_title) {\n    var page_number;\n\n    if (!isFinite(page_title) || page_title === '') {\n      page_number = '';\n    } else if (page_title == '0') {\n      page_number = 9;\n    } else {\n      page_number = page_title - 1;\n    }\n\n    return page_number;\n  };\n});","angular.module('a2.filter.project-url', []).filter('projectUrl', function (a2APIService) {\n  return function (url) {\n    return a2APIService.project.getUrl(url);\n  };\n});","angular.module('a2.filter.range', []).filter('a2Range', function () {\n  return function (from, to, step) {\n    if (!to) {\n      to = from;\n      from = 0;\n    }\n\n    if (!step) {\n      step = Math.sign(to - from);\n    }\n\n    var stepSign = Math.sign(step);\n    var list = [];\n\n    if (step != 0) {\n      for (var i = from; (i - to) * stepSign < 0; i += step) {\n        list.push(i);\n      }\n    }\n\n    return list;\n  };\n});","angular.module('a2.filter.round', []).filter('round', function () {\n  return function (val, precision) {\n    precision = precision || 1;\n    return (val / precision | 0) * precision || 0;\n  };\n});","angular.module('a2.filter.time-from-now', []).filter('timeFromNow', function () {\n  return function (input, fmt) {\n    if (!input) return undefined;\n    return moment(input).fromNow();\n  };\n});","angular.module('a2.directive.a2-auto-close-on-outside-click', []).directive('a2AutoCloseOnOutsideClick', function ($document, $rootScope) {\n  function getElementPath(element) {\n    var ancestors = [];\n    element = element;\n\n    while (element) {\n      ancestors.push(element);\n      element = element.parentElement;\n    }\n\n    return ancestors;\n  }\n\n  return {\n    restrict: 'A',\n    require: '?dropdown',\n    link: function (scope, element, $attrs, dropdownController) {\n      $attrs.$set('autoClose', \"disabled\");\n\n      function closeDropdown(evt) {\n        if (!evt || !dropdownController.isOpen()) {\n          return;\n        }\n\n        var ancestors = getElementPath(evt.target);\n        var htmlIdx = ancestors.indexOf($document[0].documentElement);\n        var toggleElementIdx = ancestors.indexOf(dropdownController.toggleElement[0]);\n        var elementIdx = ancestors.indexOf(dropdownController.dropdownMenu[0]); // console.log(htmlIdx, toggleElementIdx, elementIdx);\n\n        if (toggleElementIdx != -1 || elementIdx != -1 || htmlIdx == -1) {\n          return;\n        }\n\n        dropdownController.toggle(false);\n\n        if (!$rootScope.$$phase) {\n          scope.$apply();\n        }\n      }\n\n      $document.bind('click', closeDropdown);\n      scope.$on('$destroy', function () {\n        $document.unbind('click', closeDropdown);\n      });\n    }\n  };\n});","angular.module('arbimon2.directive.a2-dropdown', []).directive('a2Dropdown', function ($compile) {\n  var masterTemplate = angular.element('<div dropdown dropdown-append-to-body>' + '<button class=\"btn btn-sm btn-default dropdown-toggle\" dropdown-toggle>' + '<span></span> <i class=\"fa fa-caret-down\"></i>' + '</button>' + '<ul class=\"dropdown-menu dropup\" role=\"menu\">' + '<li ng-repeat=\"$item in list\" ng-class=\"{active: $item == $selectedItem}\">' + '<a ng-click=\"select($item)\"><span></span></a>' + '</li>' + '</ul>' + '</div>');\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    scope: true,\n    compile: function (element, attrs) {\n      var tpl = angular.element(masterTemplate[0].cloneNode(true));\n      var itemTpl = tpl.children('ul').children('li').children('a').children('span');\n      var selectedItemTpl = tpl.children('button').children('span');\n      var elementHtml = element.html();\n      itemTpl.append(elementHtml);\n      selectedItemTpl.append(elementHtml.replace(/\\$item\\b/g, '$selectedItem'));\n      element.empty();\n      var compiledTpl = $compile(tpl.clone());\n      return function (scope, linkElement, attrs, ngModelCtrl) {\n        linkElement.append(compiledTpl(scope));\n        scope.$watch(attrs.list, function (list) {\n          scope.list = list || [];\n        });\n\n        scope.select = function (item) {\n          scope.$selectedItem = item;\n          ngModelCtrl.$setViewValue(item, true);\n        };\n\n        ngModelCtrl.$render = function () {\n          scope.$selectedItem = ngModelCtrl.$viewValue;\n        };\n      };\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-on-resize\n * @description\n * Directive for detecting size changes in an element.\n */\nangular.module('a2.directive.on-resize', []).service('a2OnResizeService', function ($window, $rootScope) {\n  var watchers = [],\n      animationFramePending = false;\n\n  function Watcher(element, handler) {\n    this.element = element;\n    this.handler = handler;\n    this.value = null;\n    watchers.push(this);\n    watch.scheduleAnimationFrame();\n  }\n\n  Watcher.prototype.destroy = function () {\n    var index = watchers.indexOf(this);\n\n    if (index >= 0) {\n      watchers.splice(index, 1);\n    }\n  };\n\n  function watch() {\n    animationFramePending = false;\n    var triggered = [];\n    watchers.forEach(function (watcher) {\n      var width = watcher.element[0].clientWidth;\n      var height = watcher.element[0].clientHeight;\n\n      if (!watcher.value || watcher.value.width != width || watcher.value.height != height) {\n        watcher.value = {\n          width: width,\n          height: height\n        };\n        triggered.push(watcher);\n      }\n    });\n\n    if (triggered.length) {\n      $rootScope.$apply(function () {\n        triggered.forEach(function (watcher) {\n          try {\n            watcher.handler(watcher.value);\n          } catch (e) {\n            console.error(e);\n          }\n        });\n      });\n    }\n\n    watch.scheduleAnimationFrame();\n  }\n\n  watch.scheduleAnimationFrame = function () {\n    if (watchers.length && !animationFramePending) {\n      animationFramePending = true;\n      $window.requestAnimationFrame(watch);\n    }\n  };\n\n  return {\n    newWatcher: function (element, handler) {\n      return new Watcher(element, handler);\n    }\n  };\n}).directive('a2OnResize', function ($parse, a2OnResizeService) {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var onResize = $parse(attr.a2OnResize);\n      var watcher = a2OnResizeService.newWatcher(element, function (newSize) {\n        onResize(newSize, scope);\n      });\n      scope.$on('$destroy', function () {\n        watcher.destroy();\n      });\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-palette-drawer\n * @description\n * Directive for drawing a color palette.\n */\nangular.module('a2.directive.a2-palette-drawer', []).directive('a2PaletteDrawer', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    template: '<canvas class=\"palette\"></canvas>',\n    replace: true,\n    scope: {\n      palette: '&'\n    },\n    link: function ($scope, $element, $attrs) {\n      var draw = function () {\n        var pal = $scope.palette() || [];\n        var e = pal.length | 0;\n        $element.attr('width', e);\n        $element.attr('height', 1);\n        var ctx = $element[0].getContext('2d');\n\n        for (var i = 0; i < e; ++i) {\n          ctx.fillStyle = pal[i];\n          ctx.fillRect(i, 0, 1, 1);\n        }\n      };\n\n      $scope.$watch('palette()', draw);\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.percentage-bars', ['a2.utils']).directive('a2PercentageBars', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/a2-percentage-bars.html',\n    scope: {\n      data: \"=\",\n      total: \"=\",\n      colors: \"=\"\n    },\n    controller: 'a2PercentageBarsCtrl as bars'\n  };\n}).controller('a2PercentageBarsCtrl', function ($scope, $filter) {\n  var DEFAULT_COLORS = ['0', '1', '2'];\n  var numberFilter = $filter('number');\n\n  $scope.getColorClass = function (index) {\n    var colors = $scope.colors || DEFAULT_COLORS;\n    return 'bar-' + colors[index % colors.length];\n  };\n\n  $scope.getTotal = function () {\n    return $scope.total || $scope.data.reduce(function (a, b) {\n      return a + b;\n    });\n  };\n\n  $scope.asPercent = function (value, rounding) {\n    return numberFilter(value * 100 / $scope.getTotal(), rounding) + '%';\n  };\n});","angular.module('a2.directive.require-non-empty', []).directive('requireNonEmpty', function () {\n  return {\n    restrict: 'A',\n    require: '?ngModel',\n    link: function (scope, elm, attr, ctrl) {\n      if (!ctrl) {\n        return;\n      }\n\n      attr.required = true; // force truthy in case we are on non input element\n\n      ctrl.$validators.required = function (modelValue, viewValue) {\n        return !attr.required || !(ctrl.$isEmpty(viewValue) || viewValue instanceof Array && !viewValue.length);\n      };\n\n      attr.$observe('required', function () {\n        ctrl.$validate();\n      });\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.sidenav-bar', ['a2.utils']).directive('a2SidenavBar', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    compile: function (element, attr) {\n      element.addClass(\"sidenav\");\n      var name = attr.name;\n      var template = element.clone();\n      return function (scope, element, attr) {\n        a2SidenavBarService.enableSidenavBar(name, template, scope);\n\n        if (attr.enabled) {\n          scope.$watch(attr.enabled, function (enabled) {\n            if (enabled) {\n              a2SidenavBarService.enableSidenavBar(name, template, scope);\n            } else {\n              a2SidenavBarService.disableSidenavBar(name);\n            }\n          });\n        }\n\n        scope.$on('$destroy', function () {\n          a2SidenavBarService.disableSidenavBar(name);\n        });\n      };\n    }\n  };\n}).service('a2SidenavBarService', function ($q, $log, a2EventEmitter) {\n  var cache = {};\n\n  function SidenavBar() {\n    this.enabled = false;\n    this.events = new a2EventEmitter();\n  }\n\n  SidenavBar.prototype = {\n    enable: function (template, scope) {\n      if (!this.enabled) {\n        this.enabled = true;\n        this.template = template;\n        this.scope = scope;\n        return this.events.emit('enabled', this);\n      }\n\n      return $q.resolve();\n    },\n    disable: function () {\n      if (this.enabled) {\n        this.enabled = false;\n        delete this.template;\n        delete this.scope;\n        return this.events.emit('disabled', this);\n      }\n\n      return $q.resolve();\n    },\n    on: function (event, listener) {\n      this.events.on(event, listener);\n    },\n    off: function (event, listener) {\n      this.events.off(event, listener);\n    }\n  };\n\n  function getSidenavBar(name) {\n    return cache[name] || (cache[name] = new SidenavBar());\n  }\n\n  a2SidenavBarService = {\n    enableSidenavBar: function (name, template, scope) {\n      return getSidenavBar(name).enable(template, scope);\n    },\n    disableSidenavBar: function (name) {\n      return getSidenavBar(name).disable();\n    },\n    registerAnchor: function (name, onEnabled, onDisabled) {\n      var bar = getSidenavBar(name);\n      bar.on('enabled', onEnabled);\n      bar.on('disabled', onDisabled);\n\n      if (bar.enabled) {\n        $q.resolve().then(onEnabled);\n      }\n\n      return function unregisterAnchor() {\n        bar.off('enabled', onEnabled);\n        bar.off('disabled', onDisabled);\n      };\n    }\n  };\n  return a2SidenavBarService;\n}).directive('a2SidenavBarAnchor', function (a2SidenavBarService, $compile) {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var name;\n      var isUl = element[0].nodeName.toLowerCase() == 'ul';\n      var unregisterAnchor;\n\n      function onEnabled(sidebar) {\n        var template = sidebar.template.clone();\n        element.empty().append($compile(template.children())(sidebar.scope));\n      }\n\n      function onDisabled(sidebar) {\n        element.empty();\n      }\n\n      attr.$observe('a2SidenavBarAnchor', function (_name) {\n        name = _name;\n\n        if (unregisterAnchor) {\n          unregisterAnchor();\n          unregisterAnchor = null;\n        }\n\n        unregisterAnchor = a2SidenavBarService.registerAnchor(name, onEnabled, onDisabled);\n      });\n      scope.$on('$destroy', function () {\n        if (unregisterAnchor) {\n          unregisterAnchor();\n          unregisterAnchor = null;\n        }\n      });\n    }\n  };\n});","angular.module('a2.directive.a2-table', []).directive('a2Table', function ($window, $filter, $templateCache, $compile) {\n  var $ = $window.$;\n\n  function compileFields(element) {\n    return element.children('field').toArray().map(function (field) {\n      field = angular.element(field);\n      var clone = field.clone();\n      field.detach();\n      return {\n        title: clone.attr('title'),\n        key: clone.attr('key'),\n        tdclass: clone.attr('tdclass'),\n        width: clone.attr('width'),\n        filter: clone.attr('filter') !== undefined ? clone.attr('filter') || clone.attr('key') : undefined,\n        content: clone.html(),\n        show: clone.attr('show'),\n        tooltip: clone.attr('tooltip')\n      };\n    });\n  }\n\n  function compileSelectExpand(element, options) {\n    var selectExpand = element.children('expand-select');\n\n    if (!selectExpand.length) {\n      return;\n    }\n\n    var clone = selectExpand.clone(true);\n    selectExpand.detach();\n    selectExpand = angular.element('<tr ng-show=\"selected\"><td colspan=\"' + options.fieldCount + '\"></td></tr>');\n    selectExpand.find('td').append(clone);\n    return selectExpand;\n  }\n\n  return {\n    restrict: 'E',\n    scope: {\n      rows: '=',\n      selected: '=?',\n      // able to work with $scope.selected rows\n      onSelect: '&',\n      onCheck: '&',\n      checked: '=?',\n      // able to work with $scope.checked rows\n      search: '=?',\n      // noCheckbox: '@',    // disable row checkboxes\n      // noSelect: '@',      // disable row selection\n      dateFormat: '@',\n      // moment date format, default: 'lll'\n      numberDecimals: '@' // decimal spaces\n\n    },\n    controller: 'a2TableCtrl as a2TableController',\n    compile: function (element, attrs) {\n      var template = angular.element($templateCache.get('/directives/a2-table.html'));\n      var tplHead = template.find(\"thead tr.headers\");\n      var tplFilters = template.find(\"thead tr.filters\");\n      var tplBody = template.find(\"tbody tr\");\n      var options = {};\n      var filterable = [];\n      var hasFilters = false;\n      options.fields = compileFields(element);\n      options.hasCheckbox = attrs.noCheckbox === undefined;\n      options.hasSelection = attrs.noSelect === undefined;\n      options.fieldCount = options.fields.length + (options.hasCheckbox ? 1 : 0);\n      options.selectExpand = compileSelectExpand(element, options);\n      options.fields.forEach(function (field, index) {\n        tplHead.append(angular.element('<th ng-click=\"a2TableController.sortBy(' + index + ')\" class=\"cs-pointer\"' + (field && field.tooltip !== undefined ? ' title=\"' + field.tooltip + '\"' : '') + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '></th>').addClass(field.tdclass).text(field.title).append(field.key ? '    <i ng-if=\"sortKey == ' + index + '\" class=\"fa\" ng-class=\"reverse ? \\'fa-chevron-up\\': \\'fa-chevron-down\\'\"></i>\\n' : ''));\n        hasFilters |= field.filter !== undefined;\n        tplFilters.append(angular.element('<th' + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '></th>').append(field.filter !== undefined ? '   <input type=\"text\" class=\"a2-table-filter form-control\" ng-model=\"a2TableController.filter[' + index + ']\" ng-change=\"a2TableController.onFilterChanged(' + index + ')\">\\n' : ''));\n        tplBody.append(angular.element('<td ' + (['Project', 'Species'].includes(field.title) ? 'title=\"' + field.content + '\"' : '') + (field.width ? 'width=\"' + field.width + '\"' : '') + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '>').addClass(field.tdclass).html(field.content));\n      });\n      return function (scope, element, attrs, a2TableCtrl) {\n        var tableScope = scope.$parent.$new(false, scope);\n        options.scope = scope;\n        options.tableScope = tableScope;\n\n        options.onSelect = scope.onSelect && function (row) {\n          return scope.onSelect({\n            row: row\n          });\n        };\n\n        options.onCheck = scope.onCheck && function (row) {\n          return scope.onCheck({\n            row: row\n          });\n        };\n\n        a2TableCtrl.initialize(options);\n        tableScope.a2TableController = a2TableCtrl;\n        a2TableCtrl.fields = options.fields;\n\n        if (options.selectExpand) {\n          a2TableCtrl.selectExpand = $compile(options.selectExpand)(tableScope);\n        }\n\n        a2TableCtrl.noCheck = !options.hasCheckbox;\n        a2TableCtrl.noSelect = !options.hasSelection;\n        tableScope.sortKey = attrs.defaultSort || tableScope.sortKey;\n\n        if (attrs.search) {\n          scope.$watch('search', function (value) {\n            tableScope.query = scope.search;\n            a2TableCtrl.updateChecked();\n          });\n        }\n\n        a2TableCtrl.setRows(scope.rows);\n        scope.$watch('rows', function (rows) {\n          a2TableCtrl.setRows(rows);\n        }, true);\n        var cmpel = $compile(template.clone())(tableScope);\n        element.append(cmpel);\n        scope.$on('$destroy', function () {\n          tableScope.$destroy();\n        });\n      };\n    }\n  };\n}).controller('a2TableCtrl', function ($filter) {\n  var scope, tableScope;\n\n  this.initialize = function (options) {\n    scope = options.scope;\n    tableScope = options.tableScope;\n    this.options = options;\n    this.__onSelect = options.onSelect;\n    this.__onCheck = options.onCheck;\n    this.hasFilters = options.fields.reduce(function (_, field) {\n      return _ || field.filter !== undefined;\n    }, false);\n    this.filter = {};\n  };\n\n  this.setRows = function (rows) {\n    this.rows = rows;\n    this.updateChecked();\n  };\n\n  this.onFilterChanged = function (index) {\n    var query = tableScope.query || (tableScope.query = {});\n    var key = this.options.fields[index].filter.split('.');\n    var value = this.filter[index];\n\n    if (value == \"\") {\n      while (key.length > 1) {\n        query = (query || {})[key.shift()];\n      }\n\n      delete query[key.shift()];\n    } else {\n      while (key.length > 1) {\n        var keycomp = key.shift();\n        query = query[keycomp] || (query[keycomp] = {});\n      }\n\n      query[key.shift()] = value;\n    }\n  };\n\n  this.updateChecked = function () {\n    if (this.rows) {\n      var visible = $filter('filter')(this.rows, tableScope.query);\n      scope.checked = visible.filter(function (row) {\n        return row.checked | false;\n      });\n    }\n  };\n\n  this.toggleAll = function () {\n    var allFalse = this.rows.reduce(function (_, row) {\n      return _ && !row.checked;\n    }, true);\n    this.rows.forEach(function (row) {\n      row.checked = allFalse;\n    });\n    tableScope.checkall = allFalse;\n  };\n\n  this.check = function ($event, $index) {\n    if (this.lastChecked && $event.shiftKey) {\n      if (this.lastChecked) {\n        var rows;\n\n        if (this.lastChecked > $index) {\n          rows = this.rows.slice($index, this.lastChecked);\n        } else {\n          rows = this.rows.slice(this.lastChecked, $index);\n        }\n\n        rows.forEach(function (row) {\n          row.checked = true;\n        });\n      }\n    }\n\n    this.lastChecked = $index;\n  };\n\n  this.keyboardSel = function (row, $index, $event) {\n    if ($event.key === \" \" || $event.key === \"Enter\") {\n      this.sel(row, $index);\n    }\n  };\n\n  this.sel = function (row, $index, $event) {\n    if (this.noSelect) {\n      return;\n    }\n\n    if (tableScope.selected === row) {\n      row = undefined;\n    }\n\n    tableScope.selected = row;\n    scope.selected = row;\n\n    if (this.selectExpand) {\n      angular.element($event.currentTarget).after(this.selectExpand);\n    }\n\n    if (this.__onSelect) {\n      this.__onSelect(row);\n    }\n  };\n\n  this.onCheck = function (row, $index, $event) {\n    if (this.__onCheck) {\n      this.__onCheck(row);\n    }\n  };\n\n  this.sortBy = function (fieldIndex) {\n    var field = this.fields[fieldIndex];\n\n    if (tableScope.sortKey !== fieldIndex) {\n      tableScope.sortKey = fieldIndex;\n      tableScope.sort = field.key;\n      tableScope.reverse = false;\n    } else {\n      tableScope.reverse = !tableScope.reverse;\n    }\n  };\n});","(function () {\n  var a2TagsModule = angular.module('a2.directive.a2-tags', ['templates-arbimon2']);\n  var a2TagTypes = ['classi', 'classes', 'model', 'playlist', {\n    tag: 'project',\n    linkTo: function (tagId) {\n      return \"/project/?id=\" + tagId;\n    }\n  }, 'site', 'species', 'song', 'soundscape', 'training_set'];\n  a2TagTypes.forEach(function (tagType) {\n    if ('string' == typeof tagType) {\n      tagType = {\n        tag: tagType\n      };\n    }\n\n    tagType.tcTag = tagType.tag.replace(/(^|\\b|-)(\\w)/, function (_0, _1, _2) {\n      return _2.toUpperCase();\n    });\n    a2TagsModule.directive('a2Tag' + tagType.tcTag, function ($injector) {\n      return {\n        restrict: 'EAC',\n        scope: {\n          tag: '=a2Tag' + tagType.tcTag\n        },\n        link: function (scope, element, attrs) {\n          var tagName, tagId, tagLink;\n          var aElement = element.find('a');\n          element.addClass('a2-tag a2-tag-' + tagType.tag);\n          scope.$watch('tag', function (tag) {\n            if (tag instanceof Array) {\n              tagId = tag[0];\n              tagName = tag[1];\n\n              if (tagId && tagType.linkTo) {\n                tagLink = $injector.invoke(tagType.linkTo, null, {\n                  tagId: tagId\n                });\n              }\n            } else {\n              tagId = null;\n              tagName = tag;\n            }\n\n            var tagElement = angular.element(tagLink ? '<a></a>' : '<span></span>').appendTo(element.empty());\n            tagElement.text(tagName);\n\n            if (tagLink) {\n              tagElement.attr('href', tagLink);\n            }\n          });\n        }\n      };\n    });\n  });\n})();","angular.module('a2.directives', ['a2.services', 'a2.directive.a2-table', 'arbimon.directive.a2-switch', 'a2.directive.percentage-bars', 'templates-arbimon2']).run(function ($window) {\n  var $ = $window.$;\n  $(document).click(function (e) {\n    if ($(e.target).closest('.calendar.popup:visible').length) return;\n    $('.calendar.popup:visible').hide();\n  }); // extend jQuery\n  // add parent tag selector\n\n  $.expr.filter.UP_PARENT_SPECIAL = function (_1) {\n    var times = _1 && _1.length || 1;\n    return $.expr.createPseudo(function (seed, matches, _3, _4) {\n      var dups = [];\n      seed.forEach(function (e, i) {\n        var p = e;\n\n        for (var t = times; t > 0; --t) {\n          p = p && (p.nodeType == 9 || p.parentNode.nodeType == 9 ? p : p.parentNode);\n        }\n\n        if (p) {\n          for (var di = 0, de = dups.length; di < de; ++di) {\n            if (dups[di] === p) {\n              p = null;\n              break;\n            }\n          }\n\n          if (p) {\n            dups.push(p);\n          }\n        }\n\n        matches[i] = p;\n        seed[i] = !p;\n      });\n      return true;\n    });\n  };\n\n  $.expr.match.needsContext = new RegExp($.expr.match.needsContext.source + '|^(\\\\^)');\n  $.expr.match.UP_PARENT_SPECIAL = /^(\\^+)/;\n}).directive('a2GlobalKeyup', function ($window, $timeout) {\n  var $ = $window.$;\n  return {\n    restrict: 'A',\n    scope: {\n      onkeyup: '&a2GlobalKeyup'\n    },\n    link: function ($scope, $element, $attrs) {\n      var handler = function (evt) {\n        $timeout(function () {\n          $scope.onkeyup({\n            $event: evt\n          });\n        });\n      };\n\n      $(document).on('keyup', handler);\n      $element.on('$destroy', function () {\n        $(document).off('keyup', handler);\n      });\n    }\n  };\n}).directive('a2Scroll', function ($parse, $window) {\n  var mkFunction = function (scope, attr) {\n    var fn = $parse(attr);\n    return function (locals) {\n      locals.console = console;\n      return fn(scope, locals);\n    };\n  };\n\n  return {\n    scope: {\n      'a2InfiniteScrollDistance': '=?',\n      'a2InfiniteScrollDisabled': '=?',\n      'a2InfiniteScrollImmediateCheck': '=?'\n    },\n    link: function ($scope, element, attrs, controller) {\n      var pscope = $scope.$parent;\n      var fnBind = 'on';\n      var fnUnbind = 'off';\n\n      if (attrs.a2Scroll) {\n        controller.a2Scroll = mkFunction(pscope, attrs.a2Scroll);\n      }\n\n      controller.element = element;\n\n      if (attrs.a2ScrollOn) {\n        if (attrs.a2ScrollOn == 'window') {\n          controller.scrollElement = $window;\n          fnBind = 'addEventListener';\n          fnUnbind = 'removeEventListener';\n        } else {\n          controller.scrollElement = $(attrs.a2ScrollOn);\n        }\n      } else {\n        controller.scrollElement = element;\n      }\n\n      if (attrs.a2InfiniteScroll) {\n        $scope.a2InfiniteScroll = mkFunction(pscope, attrs.a2InfiniteScroll);\n      }\n\n      if (!$scope.a2InfiniteScrollDistance) {\n        $scope.a2InfiniteScrollDistance = 1;\n      }\n\n      if (!$scope.a2InfiniteScrollRefraction) {\n        $scope.a2InfiniteScrollRefraction = 1000;\n      }\n\n      controller.scrollHandler = controller.scrollHandler.bind(controller);\n      controller.scrollElement[fnBind](\"scroll\", controller.scrollHandler);\n      controller.element.bind(\"$destroy\", function () {\n        controller.scrollElement[fnUnbind]('scroll', controller.scrollHandler);\n        controller.dispose();\n      });\n    },\n    controller: 'a2ScrollController'\n  };\n}).controller('a2ScrollController', function ($scope) {\n  Object.assign(this, {\n    anchors: {},\n    addAnchor: function (name, anchorElement) {\n      this.anchors[name] = anchorElement;\n    },\n    removeAnchor: function (name) {\n      delete this.anchors[name];\n    },\n    scrollHandler: function (event) {\n      try {\n        if (this.a2Scroll) {\n          this.a2Scroll({\n            $event: event,\n            $controller: this\n          });\n        }\n\n        if ($scope.a2InfiniteScroll && !$scope.a2InfiniteScrollDisabled) {\n          var remaining = (element[0].scrollHeight - element[0].scrollTop | 0) / element.height();\n\n          if (remaining < $scope.a2InfiniteScrollDistance) {\n            var time = new Date().getTime();\n\n            if (!$scope.refraction || $scope.refraction < time) {\n              $scope.refraction = time + $scope.a2InfiniteScrollRefraction;\n              $scope.a2InfiniteScroll({\n                $event: e\n              });\n            }\n          }\n        }\n      } finally {\n        $scope.$apply();\n      }\n    },\n    dispose: function () {\n      this.element = null;\n      this.scrollElement = null;\n      this.anchors = {};\n    }\n  });\n}).directive('a2ScrollAnchor', function () {\n  return {\n    require: '^a2Scroll',\n    link: function ($scope, element, attrs, a2ScrollController) {\n      var name = attrs.name;\n      a2ScrollController.addAnchor(name, element);\n      element.bind(\"$destroy\", function () {\n        a2ScrollController.removeAnchor(name);\n      });\n    }\n  };\n}).directive('a2Persistent', function ($rootScope, $compile, $timeout) {\n  var counter = 0;\n  var poc = $('<div></div>');\n  return {\n    restrict: 'E',\n    scope: {},\n    compile: function (tElement, tAttrs) {\n      var children = tElement.children().detach();\n      var tag = tAttrs.name || 'persistent-' + counter++;\n      return function (_1, $element, _3) {\n        if (!$rootScope._$persistence_) {\n          $rootScope._$persistence_ = {};\n        }\n\n        var p = $rootScope._$persistence_;\n        var ptag = p[tag];\n        var persisted = true;\n\n        if (!ptag) {\n          // console.log('new persistent scope \"%s\" created in ', tag, $rootScope);\n          p[tag] = ptag = {};\n          ptag.scope = $rootScope.$new(true);\n          ptag.scope._$persistence_tag_ = tag;\n          ptag.view = $compile(children)(ptag.scope);\n          persisted = false;\n        }\n\n        $element.append(ptag.view);\n        $element.on('$destroy', function (e) {\n          e.stopPropagation();\n          poc.append(ptag.view);\n        });\n\n        if (persisted) {\n          $timeout(function () {\n            ptag.scope.$broadcast('a2-persisted');\n          });\n        }\n      };\n    }\n  };\n}).directive('autoHeight', function ($window) {\n  var $ = $window.$;\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var updateHeight = function () {\n        // console.log('window h:', $(window).height());\n        // console.log('ele pos:',  element.offset());\n        // console.log('ele h:', element.height());\n        var h = $($window).height() - element.offset().top;\n        if (h < 500) return;\n        $window.requestAnimationFrame(function () {\n          element.height(h);\n        });\n      };\n\n      updateHeight();\n      $($window).resize(function () {\n        updateHeight();\n      });\n    }\n  };\n}).directive('stopClick', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      element.bind('click', function (e) {\n        e.stopPropagation();\n      });\n    }\n  };\n}).directive('loader', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      hideText: '@',\n      text: '@'\n    },\n    templateUrl: '/directives/loader.html'\n  };\n})\n/**   yearpick - complete year date picker\n\n  example usage:\n  <div class=\"dropdown\">\n    <button ng-model=\"dia\" yearpick disable-empty=\"true\" year=\"year\" date-count=\"dateData\">\n        <span ng-hide=\"dia\"> Select Date </span>\n        {{ dia | date: short }}\n    </button>\n  </div>\n  or, if you just want to show the component :\n  <yearpick ng-model=\"dia\" yearpick disable-empty=\"true\" year=\"year\" date-count=\"dateData\"></yearpick>\n */\n.directive('yearpick', function ($timeout, $window) {\n  var d3 = $window.d3;\n  var $ = $window.$;\n  return {\n    restrict: 'AE',\n    scope: {\n      ngModel: '=',\n      maxDate: '=?',\n      minDate: '=?',\n      year: '=?',\n      dateCount: '=?',\n      mode: '@',\n      onYearChanged: '&?',\n      onDateChanged: '&?',\n      disableEmpty: '&'\n    },\n    link: function (scope, element, attrs) {\n      var is_a_popup = !/yearpick/i.test(element[0].tagName);\n      var popup;\n\n      if (is_a_popup) {\n        popup = $('<div></div>').insertAfter(element).addClass('calendar popup');\n        element.click(function (e) {\n          e.stopPropagation(); // verify if hidden\n\n          var visible = popup.css('display') === 'none'; // always hide any other open yearpick\n\n          $('.calendar.popup:visible').hide();\n\n          if (visible) {\n            popup.css('display', 'block');\n          }\n        });\n      } else {\n        popup = element.addClass('calendar');\n      }\n\n      var weekOfMonth = function (d) {\n        var firstDay = new Date(d.toString());\n        firstDay.setDate(1);\n        var monthOffset = firstDay.getDay() - 1;\n        return Math.floor((d.getDate() + monthOffset + 7) / 7) - 1;\n      };\n\n      var monthName = d3.time.format('%B');\n      var dateFormat = d3.time.format(\"%Y-%m-%d\");\n\n      var format2Date = function (txt) {\n        var m = /^(\\d+)-(\\d+)-(\\d+)$/.exec(txt);\n        return m && new Date(m[1] | 0, m[2] | 0, m[3] | 0);\n      };\n\n      var canHaveDateCounts = function () {\n        return scope.mode === \"density\" && attrs.dateCount;\n      };\n\n      var computeMax = !attrs.maxDate;\n      var computeMin = !attrs.minDate;\n\n      function setYear(year) {\n        var old_year = scope.year;\n        scope.year = year;\n\n        if (scope.onYearChanged && old_year != year) {\n          $timeout(function () {\n            scope.onYearChanged({\n              year: year\n            });\n          });\n        }\n      }\n\n      function setDate(date) {\n        var old_date = scope.ngModel;\n        scope.ngModel = date;\n\n        if (scope.onDateChanged && old_date != date) {\n          $timeout(function () {\n            scope.onDateChanged({\n              date: date\n            });\n          });\n        }\n      }\n\n      if (!scope.year) {\n        setYear(new Date().getFullYear());\n      }\n\n      var cubesize = 19;\n      var width = 600;\n      var height = 510;\n      var headerHeight = 40;\n      var days;\n      var svg = d3.select(popup[0]).append('svg').attr('width', width).attr('height', height);\n      var cal = svg.append('g');\n      var legend = svg.append('g');\n      var prev = svg.append('g').attr('class', 'btn');\n      var next = svg.append('g').attr('class', 'btn'); // draws previous year button\n\n      prev.append('text').attr('text-anchor', 'start').attr('font-family', 'FontAwesome').attr('font-size', 24).attr('x', 5).attr('y', 24).text('\\uf060');\n      prev.on('click', function (e) {\n        $timeout(function () {\n          setYear(scope.year - 1);\n        });\n      }); // draws next year button\n\n      next.append('text').attr('text-anchor', 'end').attr('font-family', 'FontAwesome').attr('font-size', 24).attr('x', width - 5).attr('y', 24).text('\\uf061');\n      next.on('click', function (e) {\n        $timeout(function () {\n          setYear(scope.year + 1);\n        });\n      }); // draw legend\n\n      if (scope.mode === \"density\") {\n        var scale = {\n          scale: [1, 50, 100],\n          labels: ['0', '1', '50', '100']\n        };\n        var color = d3.scale.threshold().domain(scale.scale).range(scale);\n        var icon = legend.selectAll('g').data(['1', '50', '100']).enter().append('g').attr('transform', function (d, i) {\n          switch (d) {\n            case '50':\n              return 'translate(18,0)';\n\n            default:\n              return 'translate(20,0)';\n          }\n        });\n        icon.append('rect').attr('width', cubesize * 0.63).attr('height', cubesize * 0.63).attr('y', height + 7 - cubesize).attr('x', function (d, i) {\n          return i * 45 + 22;\n        }).attr('class', function (d) {\n          return 'cal-level-' + d;\n        });\n        icon.append('text').attr('text-anchor', 'middle').attr('font-size', 10).attr('y', height - 2).attr('x', function (d, i) {\n          switch (d) {\n            case '1':\n              return i * 45 + 11;\n\n            case '50':\n              return i * 45 + 9;\n\n            case '100':\n              return i * 45 + 6;\n          }\n        }).text(function (d, i) {\n          return '+' + d;\n        });\n      }\n\n      var drawCounts = function () {\n        if (scope.mode === \"density\" && !scope.dateCount) return;\n\n        if (scope.disableEmpty()) {\n          days.classed('day-disabled', function (d) {\n            return $(this).hasClass('cal-oor') || !scope.dateCount[dateFormat(d)];\n          });\n        }\n\n        var squares = days.select('rect');\n        squares.attr('class', function (d) {\n          var color = d3.scale.threshold().domain([1, 50, 100]).range(['0', '1', '50', '100']);\n          var count = scope.dateCount[dateFormat(d)] || 0;\n          return 'cal-level-' + color(count);\n        });\n      };\n\n      var draw = function () {\n        // set calendar year\n        calendar = cal.selectAll('g').data([scope.year]); // append new year\n\n        var title = calendar.enter().append('g'); // set text position\n\n        title.append('text').attr('text-anchor', 'middle').attr('font-size', 30).attr('x', width / 2).attr('y', 30); // set line position\n\n        title.append('line').attr('x1', 5).attr('y1', headerHeight).attr('x2', width - 5).attr('y2', headerHeight).attr('stroke', 'rgba(0,0,0,0.5)').attr('stroke-width', 1); // remove old year\n\n        calendar.exit().remove(); // write year text\n\n        calendar.select('text').text(function (d) {\n          return d;\n        });\n        prev.classed('disabled', scope.minDate && scope.minDate.getFullYear() >= scope.year);\n        next.classed('disabled', scope.maxDate && scope.year >= scope.maxDate.getFullYear()); // setup the months containers and set the years' month date range\n\n        var mon = calendar.append('g').attr('transform', 'translate(0,' + headerHeight + ')').selectAll('g').data(function (d) {\n          return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1));\n        }); // on enter in months, append new months\n\n        mon.enter().append('g'); // in months, transform each month to their place in the yearpick\n\n        mon.attr('transform', function (d, i) {\n          return 'translate(' + (d.getMonth() % 4 * 150 + 5) + ',' + (Math.floor(d.getMonth() / 4) * 150 + 5) + ')';\n        }); // in months, transform each month to their place in the yearpick\n\n        mon.append('text').attr('text-anchor', 'middle').attr('x', cubesize * 7 / 2).attr('y', 15).text(function (d) {\n          return monthName(d);\n        }); // remove old months\n\n        mon.exit().remove(); // setup day containers for each months\n\n        days = mon.selectAll('g').data(function (d) {\n          return d3.time.days(new Date(d.getFullYear(), d.getMonth(), 1), new Date(d.getFullYear(), d.getMonth() + 1, 1));\n        }); //  in days, on enter, append a g of class btn\n\n        days.enter().append('g').attr('class', 'day'); //  for each day, move the text, add class hover and onclick event handler\n\n        days.attr('transform', function () {\n          return 'translate(0,24)';\n        }).classed('hover', true).classed('day-disabled cal-oor', function (d) {\n          return (scope.minDate ? d < scope.minDate : false) || (scope.maxDate ? scope.maxDate < d : false);\n        }).classed('selected', function (d) {\n          return scope.ngModel && dateFormat(d) == dateFormat(scope.ngModel);\n        }).on('click', function (d) {\n          scope.$apply(function () {\n            d3.event.preventDefault();\n            setDate(d);\n            if (is_a_popup) popup.css('display', 'none');\n          });\n        }); // .. also, add a rect on the background\n\n        days.append('rect').attr('width', cubesize).attr('height', cubesize).attr('y', function (d, i) {\n          return weekOfMonth(d) * (cubesize + 1);\n        }).attr('x', function (d, i) {\n          return d.getDay() * (cubesize + 1);\n        }).attr('fill', 'white'); // .. and append a text on the foreground\n\n        days.append('text').attr('text-anchor', 'middle').attr('font-size', 10).attr('y', function (d, i) {\n          return weekOfMonth(d) * (cubesize + 1) + 13;\n        }).attr('x', function (d, i) {\n          return (d.getDay() + 1) * (cubesize + 1) - 10;\n        }).text(function (d, i) {\n          return d.getDate();\n        }); // if we have date counts, then draw them\n\n        if (attrs.dateCount) {\n          drawCounts();\n        } // remove old days\n\n\n        days.exit().remove();\n      };\n\n      scope.$watch('maxDate', function () {\n        if (scope.maxDate && scope.year > scope.maxDate.getFullYear()) {\n          setYear(scope.maxDate.getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('minDate', function () {\n        if (scope.minDate && scope.year < scope.minDate.getFullYear()) {\n          setYear(scope.minDate.getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('year', function () {\n        if (!scope.year) {\n          setYear(new Date().getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('ngModel', function () {\n        if (scope.ngModel) {\n          setYear(scope.ngModel.getFullYear());\n          days.classed('selected', function (d) {\n            return scope.ngModel && dateFormat(d) == dateFormat(scope.ngModel);\n          });\n        }\n      });\n\n      var computeMaxMinDateFromCounts = function (dateCounts, computeMax, computeMin) {\n        var stats = null;\n\n        if (!dateCounts || !computeMax && !computeMin) {\n          return;\n        }\n\n        for (var dateFmt in dateCounts) {\n          var date = format2Date(dateFmt);\n\n          if (stats) {\n            stats.min = Math.min(date, stats.min);\n            stats.max = Math.max(date, stats.max);\n          } else {\n            stats = {\n              min: date,\n              max: date\n            };\n          }\n        }\n\n        if (computeMin) {\n          scope.minDate = new Date(stats.min);\n        }\n\n        if (computeMax) {\n          scope.maxDate = new Date(stats.max);\n        }\n      };\n\n      if (canHaveDateCounts()) {\n        scope.$watch('dateCount', function (value) {\n          computeMaxMinDateFromCounts(value, computeMax, computeMin);\n          drawCounts();\n        });\n      }\n    }\n  };\n}).directive('a2Img', function ($compile, $window) {\n  var $ = $window.$;\n  return {\n    restrict: 'E',\n    scope: {},\n    link: function ($scope, $element, $attr) {\n      $element.addClass('a2-img');\n      var loader = $compile('<loader hide-text=\"yes\"></loader>')($scope).appendTo($element);\n      var img = $('<img>').on('load', function () {\n        $element.removeClass('loading');\n      }).appendTo($element);\n      $attr.$observe('a2Src', function (new_src) {\n        if (!new_src) {\n          img.hide();\n          img.attr('src', '');\n          return;\n        }\n\n        img.show();\n        $element.addClass('loading');\n        var image = new Image();\n\n        image.onload = function () {\n          img.attr('src', this.src);\n        };\n\n        image.src = new_src;\n      });\n    }\n  };\n}).directive('a2TrainingSetDataImage', function ($compile, a2TrainingSets) {\n  return {\n    restrict: 'E',\n    scope: {\n      'trainingSet': '=',\n      'datum': '='\n    },\n    template: '<a2-img a2-src=\"{{datum.uri}}\" ng-class=\"resolving ? \\'resolving-uri\\' : \\'\\'\" style=\"width:100%;height:100%;\"></a2-img>',\n    link: function ($scope, $element, $attr) {\n      $element.addClass('a2-training-set-data-image a2-block-inline');\n\n      var resolve_null_uri = function () {\n        if ($scope.datum && $scope.trainingSet && !$scope.datum.url) {\n          var urikey = [$scope.trainingSet.id, $scope.datum.id].join('-');\n\n          if ($scope.resolving != urikey) {\n            $scope.resolving = urikey;\n            a2TrainingSets.getDataImage($scope.trainingSet.id, $scope.datum.id, function (datum2) {\n              $scope.resolving = false;\n\n              if ($scope.datum.id == datum2.id) {\n                $scope.datum.uri = datum2.uri;\n              }\n            });\n          }\n        }\n      };\n\n      $scope.$watch('datum', resolve_null_uri);\n      $scope.$watch('trainingSet', resolve_null_uri);\n    }\n  };\n}).directive('a2InsertIn', function ($window) {\n  var $ = $window.$;\n  var count = 1;\n  return {\n    restrict: 'A',\n    link: function ($scope, $element, $attr) {\n      var anchor = $('<div class=\"a2-insert-in-anchor\"></div>').attr('id', 'a2InsertInAnchor' + count++);\n\n      var is_truthy = function (v) {\n        return v && !/no|false|0/.test('' + v);\n      };\n\n      var keep_position = is_truthy($attr.a2KeepPosition);\n      var target = $($attr.a2InsertIn);\n      $element[0].parentNode.replaceChild(anchor[0], $element[0]);\n      $element.appendTo(target);\n      var reposition_element = null;\n\n      if (keep_position) {\n        var comp_pos = function (el) {\n          return $(el).offset();\n        };\n\n        reposition_element = function () {\n          $('.a2-insert-in-anchor');\n          var po = comp_pos($element.offsetParent());\n          var ao = comp_pos(anchor);\n          ao.position = 'absolute';\n          ao.top -= po.top;\n          ao.left -= po.left;\n          $element.css(ao);\n        };\n\n        $('.a2-insert-in-anchor').parents().each(function (i, e) {\n          var $e = $(e);\n\n          if (!/visible|hidden/.test($e.css('overflow'))) {\n            $e.scroll(reposition_element);\n          }\n        });\n        $scope.$watch(function () {\n          return anchor.offset();\n        }, reposition_element, true);\n        reposition_element();\n      }\n\n      $scope.$watch(function () {\n        return anchor.is(':visible');\n      }, function (visibility) {\n        $element.css('display', visibility ? 'block' : 'none');\n      });\n      anchor.on('$destroy', function () {\n        $element.remove();\n      });\n    }\n  };\n}).directive('a2LineChart', function ($window) {\n  var d3 = $window.d3;\n\n  var drawChart = function (data, options) {\n    var padding = {\n      left: 30,\n      right: 10,\n      top: 10,\n      bottom: 20\n    };\n\n    var getY = function (value) {\n      return value.y;\n    };\n\n    var getX = function (value) {\n      return value.x;\n    };\n\n    var yMin = d3.min(data, getY);\n    var yMax = d3.max(data, getY);\n    var tMin = d3.min(data, getX);\n    var tMax = d3.max(data, getX);\n    var element = options.element;\n    var lineColor = options.lineColor || \"red\";\n    var width = options.width,\n        height = options.height;\n    var xScale = d3.scale.linear().domain([tMin, tMax]).range([padding.left, width - padding.right]);\n    var yScale = d3.scale.linear().domain([yMin, yMax]).range([height - padding.bottom, padding.top]);\n    var line = d3.svg.line().x(function (d) {\n      return xScale(d.x);\n    }).y(function (d) {\n      return yScale(d.y);\n    }).interpolate(\"linear\");\n    var symbol = d3.svg.symbol().type('circle');\n    var xAxis = d3.svg.axis().scale(xScale).ticks(tMax - tMin);\n    var yAxis = d3.svg.axis().scale(yScale).orient('left').ticks(3);\n    var svg = element.append('svg').attr('class', \"graph\").attr('height', height).attr('width', width);\n    svg.append(\"g\").attr(\"class\", \"x axis\").attr(\"transform\", \"translate(0,\" + (height - padding.bottom) + \")\").call(xAxis);\n    svg.append(\"g\").attr(\"class\", \"y axis\").attr(\"transform\", \"translate(\" + padding.left + \",0)\").call(yAxis);\n    var dataG = svg.append('g').datum(data);\n    var path = dataG.append('path').attr('stroke', lineColor).attr('stroke-width', \"2\").attr('fill', \"none\").attr('d', line);\n    var totalLength = path.node().getTotalLength();\n    path.attr(\"stroke-dasharray\", totalLength).attr(\"stroke-dashoffset\", totalLength).transition().delay(200).duration(1000).ease(\"linear\").attr(\"stroke-dashoffset\", 0).each(\"end\", function () {\n      path.attr(\"stroke-dasharray\", null).attr(\"stroke-dashoffset\", null);\n    });\n    dataG.append(\"g\").selectAll('path').data(function (d) {\n      return d;\n    }).enter().append('path').attr('fill', \"transparent\").attr(\"transform\", function (d) {\n      return \"translate(\" + xScale(d.x) + \",\" + yScale(d.y) + \")scale(0.7,0.7)\";\n    }).attr(\"d\", symbol).attr('fill', lineColor).on('mouseenter', function (d) {\n      var body = d3.select('body');\n      var coords = d3.mouse(body.node());\n      var tooltip = body.append('div').datum(d).attr('class', \"graph-tooltip\").style('top', coords[1] - 10 + 'px').style('left', coords[0] - 10 + 'px').on('mouseleave', function () {\n        body.selectAll('.graph-tooltip').remove();\n      }).append('p').text(Math.round(d.y * 1000) / 1000);\n    });\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      values: '=',\n      height: '@',\n      width: '@',\n      color: '@?'\n    },\n    link: function (scope, element, attrs) {\n      scope.$watch('values', function () {\n        if (!scope.values) return;\n        drawChart(scope.values, {\n          lineColor: scope.color,\n          element: d3.select(element[0]),\n          width: Number(scope.width),\n          height: Number(scope.height)\n        });\n      });\n    }\n  };\n}).directive('c3ChartDisplay', function ($window) {\n  var c3 = $window.c3;\n\n  function normalize(data) {\n    if (typeof data != 'object') {\n      return {\n        columns: data\n      };\n    }\n\n    return data;\n  }\n\n  var makeChart = function (element, data, axes) {\n    var celem = element.find('div');\n\n    if (!data || !axes) {\n      celem.remove();\n      return;\n    }\n\n    if (!celem.length) {\n      celem = angular.element('<div></div>').appendTo(element);\n    }\n\n    var args = {\n      bindto: celem[0],\n      data: normalize(data)\n    };\n\n    if (axes) {\n      args.axis = axes;\n    }\n\n    return c3.generate(args);\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      axes: '='\n    },\n    template: '<span></span>',\n    link: function (scope, element, attrs) {\n      var chart;\n      scope.$watch('axes', function (o, n) {\n        if (!chart || o != n) chart = makeChart(element, scope.data, scope.axes, chart);\n      });\n      scope.$watch('data', function (o, n) {\n        if (!chart || o != n) {\n          chart = makeChart(element, scope.data, scope.axes, chart);\n        } else if (chart) {\n          // chart.unload();\n          chart.load(normalize(scope.data));\n        }\n      });\n    }\n  };\n}).directive('a2Info', function () {\n  return {\n    replace: true,\n    restrict: 'E',\n    template: '<i class=\"text-info fa fa-info-circle\"></i>'\n  };\n}).directive('a2BsNgModelOnDirtySaveButton', function ($parse) {\n  return {\n    restrict: 'A',\n    require: 'ngModel',\n    link: function (scope, element, attrs, ngModel) {\n      var saveBtn;\n      var onDirtySaveFN = $parse(attrs.a2BsNgModelOnDirtySaveButton);\n\n      function addSaveBtn() {\n        element.wrap('<div class=\"input-group\"></div>');\n        var parentEl = element.parent();\n        saveBtn = angular.element('<div class=\"input-group-btn\">' + '    <button class=\"btn btn-primary\"><i class=\"fa fa-save\"></i></button>' + '</div>');\n        saveBtn.find('button.btn').on('click', function () {\n          onDirtySaveFN(scope, {\n            $name: ngModel.$name,\n            $modelValue: ngModel.$modelValue,\n            $setPristine: function () {\n              ngModel.$setPristine();\n              removeSaveBtn();\n            }\n          });\n        });\n        saveBtn.appendTo(parentEl);\n      }\n\n      function removeSaveBtn() {\n        if (saveBtn) {\n          saveBtn.remove();\n        }\n\n        element.unwrap();\n        saveBtn = undefined;\n      }\n\n      ngModel.$viewChangeListeners.push(function () {\n        if (ngModel.$dirty && !saveBtn) {\n          addSaveBtn();\n        } else if (saveBtn) {\n          removeSaveBtn();\n        }\n      });\n    }\n  };\n}).factory('canvasObjectURL', function ($window, $q) {\n  var createObjectURL = $window.URL.createObjectURL;\n  var revokeObjectURL = $window.URL.revokeObjectURL;\n\n  if (!createObjectURL && $window.webkitURL.createObjectURL) {\n    createObjectURL = $window.webkitURL.createObjectURL;\n    revokeObjectURL = $window.webkitURL.revokeObjectURL;\n  }\n\n  if (!createObjectURL) {\n    revokeObjectURL = function () {};\n  }\n\n  function dataURIToBinaryBuffer(dataURI) {\n    var BASE64_MARKER = ';base64,';\n    var base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;\n    var base64 = dataURI.substring(base64Index);\n    var raw = $window.atob(base64);\n    var rawLength = raw.length;\n    var array = new $window.Uint8Array(new $window.ArrayBuffer(rawLength));\n\n    for (i = 0; i < rawLength; i++) {\n      array[i] = raw.charCodeAt(i);\n    }\n\n    return array.buffer;\n  }\n\n  function getCanvasBlob(canvas) {\n    if (canvas.toBlob) {\n      return $q(function (resolve) {\n        canvas.toBlob(resolve);\n      });\n    } else {\n      var data = dataURIToBinaryBuffer(canvas.toDataURL(\"image/png\"));\n      var blob;\n      var BlobBuilder = $window.BlobBuilder || $window.WebKitBlobBuilder;\n\n      if (BlobBuilder) {\n        var bb = new WebKitBlobBuilder();\n        bb.append(data);\n        blob = bb.getBlob(\"image/png\");\n      } else {\n        blob = new $window.Blob([data], {\n          type: 'image/png'\n        });\n      }\n\n      return $q.resolve(blob);\n    }\n  }\n\n  return {\n    create: function (canvas) {\n      if (!createObjectURL) {\n        return $q.resolve(canvas.toDataURL(\"image/png\"));\n      }\n\n      return getCanvasBlob(canvas).then(function (blob) {\n        return createObjectURL(blob);\n      });\n    },\n    revoke: revokeObjectURL\n  };\n}).directive('axis', function (canvasObjectURL, $q, $debounce) {\n  var promiseCache = {};\n  var canvas = angular.element('<canvas></canvas>')[0];\n\n  function computeHash(w, h, type, data) {\n    return JSON.stringify([w, h, type, data]);\n  }\n\n  function createAxisData(canvas, w, h, type, data) {\n    if (!w || !h) {\n      return $q.reject(\"Empty canvas size\");\n    }\n\n    canvas.width = w;\n    canvas.height = h;\n    var i;\n    var prec = data.prec || 1;\n    var min = (data.range[0] / prec | 0) * prec;\n    var max = (data.range[1] / prec | 0) * prec;\n    var scale;\n    var unit = data.unit;\n    var count = data.count || 1;\n    var dTick = (((max - min) / prec | 0) / count | 0) * prec;\n    var ctx = canvas.getContext('2d');\n    var w1 = w - 1,\n        h1 = h - 1; // var compStyle = getComputedStyle(canvas);\n\n    ctx.font = data.font;\n    ctx.strokeStyle = data.color;\n    ctx.lineWidth = 0.5;\n    ctx.clearRect(0, 0, w, h);\n    var val,\n        x,\n        y,\n        pad = 3;\n    var lblSize = {\n      w: 0,\n      h: 10\n    };\n    var loopCt = data.loopCt || 250;\n\n    for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n      var tW = ctx.measureText(val + unit).width;\n\n      if (lblSize.w < tW) {\n        lblSize.w = tW;\n      }\n    }\n\n    if (type == 'h') {\n      ctx.textAlign = 'left';\n      ctx.textBaseline = 'top';\n      scale = w / (max - min);\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(w1, 0);\n      ctx.stroke();\n      loopCt = data.loopCt || 250;\n\n      for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n        x = scale * (val - min);\n\n        if (val >= max - dTick) {\n          ctx.textAlign = 'right';\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(x, pad);\n        ctx.lineTo(x, 0);\n        ctx.stroke();\n        ctx.strokeText(val + unit, x, pad);\n      }\n    } else if (type == 'v') {\n      ctx.textAlign = 'right';\n      ctx.textBaseline = 'alphabet';\n      scale = h / (max - min);\n      ctx.beginPath();\n      ctx.moveTo(w1, 0);\n      ctx.lineTo(w1, h1);\n      ctx.stroke();\n      loopCt = data.loopCt || 250;\n\n      for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n        y = h - scale * (val - min);\n\n        if (val >= max - dTick) {\n          ctx.textBaseline = 'top';\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(w1 - pad, y);\n        ctx.lineTo(w1, y);\n        ctx.stroke();\n        ctx.strokeText(val + unit, lblSize.w, y, w1 - pad - 1);\n      }\n    } // {\n    //     range:[0, recording.sample_rate/2000],\n    //     count:10,\n    //     unit:'kHz'\n    // }\n    // console.log(\"drawAxis(\",canvas, w, h, type, data,\")\");\n\n\n    return canvasObjectURL.create(canvas); // return canvas.toDataURL();\n  }\n\n  function drawAxisOnImg(img, w, h, type, data) {\n    var hash = computeHash(w, h, type, data);\n    var axisDataPromise = promiseCache[hash];\n\n    if (!axisDataPromise) {\n      axisDataPromise = promiseCache[hash] = createAxisData(canvas, w, h, type, data);\n    }\n\n    return axisDataPromise.then(function (axisData) {\n      img.src = axisData;\n    });\n  }\n\n  return {\n    restrict: 'E',\n    template: '<img />',\n    scope: {\n      type: \"@\",\n      data: \"=\"\n    },\n    link: function (scope, element, attrs) {\n      var img = element.find('img')[0];\n      var tout;\n      var redrawAxis = $debounce(function () {\n        drawAxisOnImg(img, element.width(), element.height(), scope.type, scope.data);\n      }, 500);\n\n      function elementSize() {\n        return element.width() * element.height();\n      }\n\n      scope.$watch(elementSize, redrawAxis);\n      scope.$watch('type', redrawAxis);\n      scope.$watch('data', redrawAxis);\n    }\n  };\n}).filter('consoleLog', function () {\n  return function (x, type) {\n    console[type || 'log'](x);\n    return x;\n  };\n}).filter('mouseEventContainerPercent', function () {\n  return function ($event, selector) {\n    var target = angular.element($event.currentTarget);\n\n    if (selector) {\n      target = target.closest(selector);\n    }\n\n    var targetpos = target.offset();\n    var px = ($event.pageX - targetpos.left) / target.width();\n    var py = ($event.pageY - targetpos.top) / target.height();\n    return {\n      x: px,\n      y: py\n    };\n  };\n}).directive('onErrorSrc', function () {\n  return {\n    link: function (scope, element, attrs) {\n      element.bind('error', function () {\n        if (attrs.src != attrs.onErrorSrc) {\n          attrs.$set('src', attrs.onErrorSrc);\n        }\n      });\n    }\n  };\n});","angular.module('a2.forms', ['templates-arbimon2']).run(function ($window) {\n  // load zxcvbn \n  var loadZXCVBN = function () {\n    var a, b;\n    b = $window.document.createElement(\"script\");\n    b.src = \"/assets/zxcvbn/zxcvbn.js\";\n    b.type = \"text/javascript\";\n    b.async = !0;\n    a = $window.document.getElementsByTagName(\"script\")[0];\n    return a.parentNode.insertBefore(b, a);\n  };\n\n  if ($window.attachEvent) $window.attachEvent(\"onload\", loadZXCVBN);else $window.addEventListener(\"load\", loadZXCVBN, !1);\n}).directive('passwordInput', function ($window) {\n  return {\n    restrict: 'E',\n    scope: {\n      password: '=ngModel',\n      // password\n      validation: '=',\n      // validation object\n      userInputs: '=?' // array of strings to test password (username, name, lastname, etc)\n\n    },\n    templateUrl: '/directives/password-input.html',\n    controller: function ($scope) {\n      $scope.requiredScore = 2;\n      $scope.minLength = 6;\n      $scope.maxLength = 32;\n      $scope.validation = getValidation();\n\n      function getValidation() {\n        return $scope.validation || ($scope.validation = {\n          confirm: null,\n          result: {},\n          valid: false,\n          msg: ''\n        });\n      }\n\n      if (!$scope.userInputs) {\n        $scope.userInputs = [];\n      }\n\n      $scope.testConfirm = function () {\n        var validation = getValidation();\n        validation.result.confirm = null;\n\n        if (!validation.result.pass || !$scope.password) {\n          return;\n        } else if (validation.result.pass.score < $scope.requiredScore) {\n          $scope.validation.msg = 'password need to be stronger';\n          return;\n        }\n\n        if ($scope.password === validation.confirm) {\n          validation.result.confirm = {\n            ok: true\n          };\n          validation.valid = true;\n          validation.msg = '';\n        } else {\n          validation.result.confirm = {\n            err: \"Passwords do not match\"\n          };\n          validation.msg = validation.result.confirm.err;\n        }\n      };\n\n      $scope.testPass = function () {\n        var validation = getValidation(); // wait for zxcvbn library to be available\n\n        if (typeof $window.zxcvbn === 'undefined') {\n          if ($scope.waitForZxcvbn) return;\n          $scope.waitForZxcvbn = $interval(function () {\n            if (typeof $window.zxcvbn !== 'undefined') {\n              $interval.cancel($scope.waitForZxcvbn);\n              $scope.testPass();\n            }\n          }, 500);\n          return;\n        }\n\n        if ($scope.waitForZxcvbn) {\n          $interval.cancel($scope.waitForZxcvbn);\n        }\n\n        validation.result.pass = null;\n        var colors = ['#da3939', '#da3939', '#84b522', '#62b522', '#31b523'];\n        var mesgs = ['Very Weak', 'Weak', 'Average', 'Strong', 'Very strong'];\n\n        if (!$scope.password) {\n          return;\n        } else if ($scope.password.length < 6 || $scope.password.length > 32) {\n          var size = $scope.password.length < 6 ? 'short' : 'long';\n          validation.result.pass = {\n            shields: [],\n            color: colors[0],\n            msg: 'Password is too ' + size + ', 6-32 characters'\n          };\n          $scope.validation.msg = validation.result.pass.msg;\n        } else {\n          var test = $window.zxcvbn($scope.password, $scope.userInputs);\n          validation.result.pass = {\n            score: test.score,\n            shields: new Array(test.score + 1),\n            color: colors[test.score],\n            msg: mesgs[test.score]\n          };\n          $scope.testConfirm();\n        }\n      };\n    }\n  };\n}).directive('projectForm', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      project: '=ngModel',\n      // password\n      valid: '=' // validation object\n\n    },\n    templateUrl: '/directives/project-form.html',\n    controllerAs: 'controller',\n    controller: function ($scope) {\n      var urlPattern = /^[a-z0-9]+([-_][a-z0-9]+)*$/i;\n      this.deriveUrlFromName = true;\n\n      this.nameChanged = function () {\n        if (this.deriveUrlFromName) {\n          $scope.project.url = ($scope.project.name || '').replace(/[^a-z0-9A-Z-]/g, '-').replace(/-+/g, '-').replace(/(^-)|(-$)/g, '').replace(/[A-Z]/g, function (_1) {\n            return _1.toLowerCase();\n          });\n        }\n\n        $scope.verify();\n      };\n\n      this.urlChanged = function () {\n        this.deriveUrlFromName = false;\n        $scope.verify();\n      };\n\n      $scope.verify = function () {\n        var good = true;\n        $scope.errorName = '';\n        $scope.errorUrl = ''; // check name\n\n        if (!$scope.project.name) {\n          good = false;\n        } else if ($scope.project.name.length < 6 && $scope.project.name.length > 0) {\n          $scope.errorName = 'Name too short, 6 or more characters required';\n          good = false;\n        } else if ($scope.project.name.length > 50) {\n          $scope.errorName = 'Name too long, 50 characters max';\n          good = false;\n        } //check URL\n\n\n        if (!$scope.project.url) {\n          good = false;\n        } else if (!urlPattern.test($scope.project.url)) {\n          $scope.errorUrl = 'Invalid project URL alphanumeric characters ' + 'separated by dash(-) or underscore(_)';\n          good = false;\n        } else if ($scope.project.url.length < 6) {\n          $scope.errorUrl = 'URL too short, 6 or more alphanumeric characters ' + 'separated by dash(-) or underscore(_)';\n          good = false;\n        } else if ($scope.project.url.length > 50) {\n          $scope.errorUrl = 'URL too long, 50 characters max';\n          good = false;\n        }\n\n        $scope.valid = good;\n        return good;\n      };\n\n      if ($scope.project) {\n        $scope.verify();\n      } else {\n        $scope.project = {\n          is_private: 1\n        };\n        $scope.valid = false;\n      }\n\n      $scope.$watch('project', function () {\n        $scope.verify();\n      });\n    }\n  };\n});","angular.module('a2.qr-js', []).directive('a2QrCode', function ($window) {\n  var qr = $window.qr;\n  var $ = $window.$;\n  return {\n    restrict: 'E',\n    scope: {\n      data: '@'\n    },\n    link: function ($scope, $element, $attr) {\n      var canvas = $('<canvas></canvas>').appendTo($element);\n      $attr.$observe('data', function (data) {\n        qr.canvas({\n          canvas: canvas[0],\n          size: 10,\n          level: 'Q',\n          value: data\n        });\n      });\n    }\n  };\n});","angular.module('c3-charts', []).directive('c3Chart', function ($window) {\n  return {\n    restrict: 'E',\n    scope: {\n      columns: '='\n    },\n    link: function (scope, element, attrs) {\n      console.log('corri');\n      $window.chart = scope.chart = $window.c3.generate({\n        bindto: element[0],\n        size: {\n          width: attrs.width,\n          height: attrs.height\n        },\n        tooltip: {\n          show: false\n        },\n        data: {\n          columns: scope.columns || [],\n          type: attrs.type\n        }\n      });\n      scope.$watch('columns', function () {\n        if (scope.columns) {\n          scope.chart.load({\n            columns: scope.columns || []\n          });\n        }\n      });\n    }\n  };\n});","angular.module('a2.directive.error-message', []).directive('errorMessage', function ($http, $window) {\n  var message = '';\n  return {\n    templateUrl: '/directives/error-message.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      message: \"=\"\n    },\n    link: function ($scope) {\n      message = $scope.message;\n    }\n  };\n});","angular.module('a2.directive.frequency_filter_range_control', []).directive('a2VisualizerFrequencyFilterRangeControl', function () {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/frequency_filter_range_control.html',\n    scope: {\n      imgSrc: \"=\",\n      filterMin: \"=\",\n      filterMax: \"=\",\n      maxFreq: \"=\"\n    },\n    link: function (scope, element, attrs) {\n      'use strict';\n\n      var pressed;\n      var container = element.find('.a2-audio-freq-filter-component');\n\n      function detectMouseUp(event) {\n        pressed = undefined;\n        angular.element(document).off('mousemove', detectMouseMove);\n      }\n\n      function detectMouseDown(event) {\n        var btn = event.buttons === undefined ? event.which : event.buttons;\n\n        if (btn == 1) {\n          pressed = event.target;\n          angular.element(document).on('mousemove', detectMouseMove);\n        }\n      }\n\n      function detectMouseMove(event) {\n        if (pressed) {\n          var m = /bottom|top/.exec(pressed.className);\n\n          if (m) {\n            var eloff = container.offset();\n            var y = event.pageY - eloff.top;\n            var ammount = scope.maxFreq * Math.max(0, Math.min(1 - y / pressed.parentNode.clientHeight, 1));\n            ammount = (ammount / 100 | 0) * 100; // cast to int and quantize\n\n            var attr = m[0] == 'top' ? 'filterMax' : 'filterMin';\n            scope[attr] = ammount;\n\n            if (scope.filterMin > scope.filterMax) {\n              scope.filterMax = ammount;\n              scope.filterMin = ammount;\n            }\n\n            scope.$apply();\n          }\n        }\n      }\n\n      container.find('button').on('mousedown', detectMouseDown);\n      container.on('mousemove', function (event) {});\n      angular.element(document).on('mouseup', detectMouseUp);\n      element.on('$destroy', function () {\n        angular.element(document).off('mouseup', detectMouseUp);\n        angular.element(document).off('mousemove', detectMouseMove);\n      });\n    }\n  };\n});","angular.module('g-recaptcha', []).directive('gRecaptcha', function ($interval, $timeout, $window) {\n  return {\n    restrict: \"A\",\n    scope: {\n      sitekey: '@',\n      theme: '@?',\n      type: '@?',\n      response: '=',\n      // readonly captchaResponse \n      resetWidget: '=?' // readonly method to reset the widget\n\n    },\n    link: function (scope, element, attr) {\n      var waitForRecaptcha = $interval(function () {\n        if (typeof $window.grecaptcha !== 'undefined') {\n          $interval.cancel(waitForRecaptcha);\n          var grecaptcha = $window.grecaptcha;\n          scope.widgetId = grecaptcha.render(element[0], {\n            sitekey: scope.sitekey,\n            theme: scope.theme,\n            type: scope.type,\n            callback: function (response) {\n              scope.response = response;\n              scope.$apply();\n              scope.resetTimeout = $timeout(function () {\n                grecaptcha.reset(scope.widgetId);\n              }, 30000);\n            }\n          });\n\n          scope.resetWidget = function () {\n            if (scope.resetTimeout) {\n              $timeout.cancel(scope.resetTimeout);\n            }\n\n            grecaptcha.reset(scope.widgetId);\n          };\n        }\n      }, 500);\n    }\n  };\n});","angular.module('a2.directive.news-feed-item', ['a2.srv.news', 'templates-arbimon2', 'a2.directive.a2-tags', 'a2.filter.time-from-now']).directive('newsFeedItem', function (a2NewsService, $compile) {\n  function parseFormat(format) {\n    var RE_INTERP = /%\\((\\w+)\\)s/g;\n    var interpolate = [],\n        m;\n    var lastidx,\n        matchidx,\n        startidx = 0; // jshint -W084\n\n    while (m = RE_INTERP.exec(format)) {\n      lastidx = startidx;\n      matchidx = RE_INTERP.lastIndex - m[0].length;\n\n      if (lastidx < matchidx) {\n        interpolate.push(format.substr(lastidx, matchidx - lastidx));\n      }\n\n      interpolate.push(\"<span a2-tag-\" + m[1] + \"=\\\"news.data.\" + m[1] + \"\\\" ></span>\");\n      startidx = RE_INTERP.lastIndex;\n    }\n\n    if (startidx < format.length) {\n      interpolate.push(format.substr(startidx));\n    }\n\n    return '<span>' + interpolate.join('') + '</span>';\n  }\n\n  var parsedFormatsPromise = a2NewsService.loadFormats().then(function (formats) {\n    return Object.keys(formats).reduce(function (_, i) {\n      _[i] = parseFormat(formats[i]);\n      return _;\n    }, {});\n  });\n  return {\n    restrict: 'EAC',\n    scope: {\n      news: '=newsFeedItem'\n    },\n    templateUrl: '/directives/news-feed-item.html',\n    link: function (scope, element, attrs) {\n      var message = element.find('.message');\n      scope.$watch('news', function (news) {\n        parsedFormatsPromise.then(function (parsedFormats) {\n          message.empty().append($compile(parsedFormats[news.type])(scope));\n        });\n      });\n    }\n  };\n});","angular.module('a2.directive.plotly-plotter', ['a2.directive.on-resize', 'a2.service.plotly-defaults', 'a2.service.plotly-plot-maker']).directive('plotlyPlotter', function ($window, a2OnResizeService, PlotlyDefaults, plotlyPlotMaker) {\n  return {\n    restrict: 'E',\n    scope: {\n      layout: '=?',\n      data: '=?'\n    },\n    link: function (scope, element, attrs) {\n      function mergeData(data) {\n        return plotlyPlotMaker.mergeData(data, PlotlyDefaults);\n      }\n\n      function mergeLayout(layout) {\n        return plotlyPlotMaker.mergeLayout(layout, PlotlyDefaults);\n      }\n\n      Plotly.newPlot(element[0], mergeData(scope.data), mergeLayout(scope.layout), PlotlyDefaults.config);\n      var resizeWatcher = a2OnResizeService.newWatcher(element, function (newSize) {\n        Plotly.relayout(element[0], newSize);\n      });\n\n      if (attrs.layout) {\n        scope.$watch('layout', function (layout, old) {\n          if (layout && layout != old) {\n            Plotly.relayout(element[0], mergeLayout(layout));\n          }\n        });\n      }\n\n      if (attrs.data) {\n        scope.$watch('data', function (data, old) {\n          if (data && data != old) {\n            // Plotly.purge(element[0]);\n            console.log(\"Plotly plot data ::\", data, scope.layout);\n            Plotly.newPlot(element[0], mergeData(scope.data), mergeLayout(scope.layout), PlotlyDefaults.config);\n          }\n        });\n      }\n\n      scope.$on('$destroy', function () {\n        resizeWatcher.destroy();\n      });\n    }\n  };\n});","angular.module('a2.directive.search-bar', []).directive('searchBar', function ($http, $window) {\n  var q = '';\n  var projectsLoading;\n  var projects = [];\n  return {\n    templateUrl: '/directives/search-bar.html',\n    restrict: 'E',\n    scope: {\n      projectsLoading: \"=?\",\n      q: \"=?\",\n      isUnsafe: \"@\"\n    },\n    link: function ($scope) {\n      $scope.q = q;\n      $scope.projectsLoading = projectsLoading;\n      $scope.projects = projects;\n\n      $scope.findProject = function () {\n        var config = {\n          params: {\n            publicTemplates: true\n          }\n        };\n\n        if ($scope.q !== '') {\n          config.params.q = $scope.q;\n        }\n\n        $scope.projectsLoading = true;\n        return $http.get('/api/user/projectlist', config).then(function (result) {\n          $scope.projectsLoading = false;\n          $scope.projects = result.data;\n          return result.data;\n        });\n      };\n\n      $scope.selectProject = function () {\n        if (!$scope.q || $scope.q && !$scope.q.is_enabled) {\n          return;\n        }\n\n        $window.location.assign('/project/' + $scope.q.url + '/');\n      };\n    }\n  };\n});","angular.module('arbimon2.directive.validation-dropdown', []).directive('validationDropdown', function () {\n  var empty_option = {\n    label: undefined,\n    val: undefined\n  };\n  var val_options = [{\n    label: \"Clear\",\n    val: 2\n  }, {\n    label: \"Present\",\n    val: 1\n  }, {\n    label: \"Absent\",\n    val: 0\n  }];\n  var by_val = val_options.reduce(function (_, option) {\n    _[option.val] = option;\n    return _;\n  }, {});\n  return {\n    templateUrl: '/directives/validation-dropdown.html',\n    require: 'ngModel',\n    scope: {},\n    link: function (scope, element, attrs, ngModelCtrl) {\n      scope.options = val_options;\n\n      function updateLabel(val) {\n        var option = val < 2 && by_val[val] ? by_val[val] : empty_option;\n        scope.val = option.val;\n        scope.label = option.label;\n      }\n\n      scope.select = function (val) {\n        updateLabel(val);\n        ngModelCtrl.$$lastCommittedViewValue = undefined;\n        ngModelCtrl.$modelValue = undefined;\n        ngModelCtrl.$setViewValue(val, true);\n      };\n\n      ngModelCtrl.$render = function () {\n        updateLabel(ngModelCtrl.$viewValue);\n      };\n    }\n  };\n});","angular.module('a2.directive.warning-banner', []).directive('warningBanner', function ($http, $window) {\n  var message = 0;\n  return {\n    templateUrl: '/directives/warning-banner.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      message: \"=\"\n    },\n    link: function ($scope) {\n      message = $scope.message;\n    }\n  };\n});","angular.module('a2.googlemaps', []).provider(\"a2GoogleMapsLoader\", function () {\n  var defer;\n  var apiKey;\n\n  function loadScript($window, $q) {\n    if (!defer) {\n      return;\n    }\n\n    var cb_name = 'gmcb';\n\n    while ($window[cb_name]) {\n      cb_name += '_';\n    }\n\n    $window[cb_name] = function () {\n      defer.resolve($window.google);\n    };\n\n    var script = $window.document.createElement('script');\n    var params = ['callback=' + cb_name];\n\n    if (apiKey) {\n      params.push('key=' + apiKey);\n    }\n\n    script.src = $window.document.location.protocol + '//maps.googleapis.com/maps/api/js?' + params.join('&');\n    $window.document.body.appendChild(script);\n  }\n\n  return {\n    setAPIKey: function (key) {\n      apiKey = key;\n    },\n    $get: function ($window, $q) {\n      if (!defer) {\n        defer = $q.defer();\n        loadScript($window, $q);\n      }\n\n      return defer.promise;\n    }\n  };\n});","angular.module('a2.heremaps', []).constant('a2HereMarkerTextIconTemplate', '<div class=\"map-marker\">' + '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"28px\" height=\"36px\">' + '<path d=\"M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z\" fill=\"#000\" fill-opacity=\".2\"/>' + '<path d=\"M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z\" fill=\"#fff\"/>' + '<path d=\"M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z\" fill=\"#18d\"/>' + '</svg>' + '<span>${text}</span>' + '</div>').provider(\"a2HereMapsLoader\", function (a2HereMarkerTextIconTemplate) {\n  var loadPromise;\n  var appId;\n  var appCode;\n\n  function loadScript($window, $q) {\n    function loadOneScript(src) {\n      return $q(function (resolve, reject) {\n        var script = $window.document.createElement('script');\n        script.src = $window.document.location.protocol + src;\n        script.addEventListener('load', resolve);\n        script.addEventListener('error', reject);\n        $window.document.body.appendChild(script);\n      });\n    }\n\n    return loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-core.js\").then(function () {\n      return $q.all([loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-service.js\"), loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-ui.js\"), loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-mapevents.js\")]);\n    }).then(function () {\n      var api = $window.H;\n      return {\n        api: api,\n        makeTextIcon: function (text) {\n          return new H.map.DomIcon(a2HereMarkerTextIconTemplate.replace('${text}', text));\n        },\n        platform: new api.service.Platform({\n          app_id: appId,\n          app_code: appCode,\n          useHTTPS: /https/.test($window.document.location.protocol)\n        })\n      };\n    });\n  }\n\n  return {\n    setAPIIdAndCode: function (id, code) {\n      appId = id;\n      appCode = code;\n    },\n    $get: function ($window, $q) {\n      if (!loadPromise) {\n        loadPromise = loadScript($window, $q);\n      }\n\n      return loadPromise;\n    }\n  };\n});","angular.module('a2.permissions', ['a2.services', 'ng-permissions']).run(function ($rootScope, a2UserPermit) {\n  $rootScope.userPermit = a2UserPermit;\n}).service('a2UserPermit', function ($http, Project, $q, permits) {\n  var permit = permits;\n  return {\n    all: permit.permissions,\n    isSuper: function () {\n      return permit.super;\n    },\n    isRfcx: function () {\n      return permit.rfcxUser;\n    },\n    isAuthorized: function () {\n      return permit.isAuthorized;\n    },\n    isProjectMember: function () {\n      return permit.isAuthorized && (permit.permissions && permit.permissions.length > 0 || permit.super || permit.rfcxUser);\n    },\n    getUserEmail: function () {\n      return permit.userEmail;\n    },\n    has: function (feature) {\n      return permit.features && permit.features[feature];\n    },\n    can: function (perm) {\n      var allowed;\n\n      if (permit.permissions) {\n        allowed = (Array.isArray(perm) ? perm : [perm]).reduce(function (_, perm) {\n          return _ && permit.permissions.indexOf(perm) !== -1;\n        }, true);\n      }\n\n      return allowed || permit.super;\n    }\n  };\n});","angular.module('a2.utils-browser-metrics', []).service('a2BrowserMetrics', function () {\n  var metrics = {};\n  var css = {\n    \"border\": \"none\",\n    \"height\": \"200px\",\n    \"margin\": \"0\",\n    \"padding\": \"0\",\n    \"width\": \"200px\"\n  };\n  var inner = $(\"<div>\").css($.extend({}, css));\n  var outer = $(\"<div>\").css($.extend({\n    \"left\": \"-1000px\",\n    \"overflow\": \"scroll\",\n    \"position\": \"absolute\",\n    \"top\": \"-1000px\"\n  }, css)).append(inner).appendTo(\"body\").scrollLeft(1000).scrollTop(1000);\n  metrics.scrollSize = {\n    height: outer.offset().top - inner.offset().top | 0,\n    width: outer.offset().left - inner.offset().left | 0\n  };\n  outer.remove();\n  return metrics;\n});","angular.module('a2.utils', ['a2.utils-browser-metrics']).factory('$templateFetch', function ($http, $templateCache) {\n  return function $templateFetch(templateUrl, linker) {\n    var template = $templateCache.get(templateUrl);\n\n    if (template) {\n      if (template.promise) {\n        template.linkers.push(linker);\n      } else {\n        linker(template);\n      }\n    } else {\n      var tmp_promise = {\n        linkers: [linker],\n        promise: $http.get(templateUrl).success(function (template) {\n          $templateCache.put(templateUrl, template);\n\n          for (var i = 0, l = tmp_promise.linkers, e = l.length; i < e; ++i) {\n            l[i](template);\n          }\n        })\n      };\n      $templateCache.put(templateUrl, tmp_promise);\n    }\n  };\n}).factory('a2EventEmitter', function ($q) {\n  function a2EventEmitter() {\n    this.list = {};\n  }\n\n  a2EventEmitter.prototype = {\n    on: function (event, callback) {\n      var list = this.list[event] || (this.list[event] = []);\n      list.push(callback);\n      return callback;\n    },\n    off: function (event, callback) {\n      var list = this.list[event];\n\n      if (list) {\n        var idx = list.indexOf(callback);\n\n        if (idx) {\n          list.splice(idx, 1);\n        }\n      }\n    },\n    emit: function (event) {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var list = this.list[event];\n\n      if (list) {\n        for (var i = 0, e = list.length; i < e; ++i) {\n          list[i].apply(null, args);\n        }\n      }\n\n      return $q.resolve();\n    }\n  };\n  return a2EventEmitter;\n}).factory('itemSelection', function () {\n  return {\n    make: function make_itemSelection_obj(item_name) {\n      var sel = {};\n\n      if (typeof item_name == 'undefined') {\n        item_name = 'value';\n      }\n\n      sel[item_name] = null;\n\n      sel.select = function (newValue) {\n        sel[item_name] = newValue;\n      };\n\n      return sel;\n    }\n  };\n}) // display localtime formated by momentjs\n.filter('moment', function () {\n  return function (input, fmt) {\n    if (!input) return undefined;\n    return moment(input).format(fmt);\n  };\n}) // display UTC formated by momentjs\n.filter('momentUtc', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return moment(x).utc().format(fmt);\n  };\n}) // display site localtime formated by momentjs\n.filter('momentTz', function () {\n  return function (x, fmt, timezone) {\n    if (!x) {\n      return undefined;\n    }\n\n    return moment.tz(x, timezone).format(fmt);\n  };\n}) // divides array of into pages of limitPerPage size\n.filter('paginate', function () {\n  return function (arr, currentPage, limitPerPage) {\n    if (!arr) return undefined;\n    return arr.slice((currentPage - 1) * limitPerPage, currentPage * limitPerPage);\n  };\n})\n/** Pluralizes singular words accoring to some heuristics that (hopefully)\n *  look like english grammar.\n */\n.filter('plural', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return x + 's';\n  };\n}) // replace underscores or dashes for spaces\n.filter('worded', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return ('' + x).replace(/[_-]/g, ' ');\n  };\n}) // capitalize words\n.filter('wordCaps', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return ('' + x).replace(/\\b(\\w)/g, function (_1) {\n      return _1.toUpperCase();\n    });\n  };\n})\n/**\n * @ngdoc factory\n * @name a2.utils.factory:$debounce\n * @description asynchronous debouncing function decorator\n * Decorates an asynchronous function with a debouncing function. A debouncing\n * function withholds the function call by a set ammount of time and wait for\n * any othe function calls, resetting the wait for time every call. After its wait\n * time, the function gets called with the last given arguments and context.\n * @param {Function} fn - the function to debounce\n * @param {Function} rate - the timeout\n * @return {Promise} resolved with the function's return value.\n */\n.factory('$debounce', function ($timeout, $q, $log) {\n  return function $debounce(fn, rate) {\n    var timeoutPromise, qDefer, debouncePromise;\n    rate = rate || 100;\n    return function () {\n      var self = this;\n      var args = Array.prototype.slice.call(arguments);\n\n      if (timeoutPromise) {\n        $timeout.cancel(timeoutPromise);\n      }\n\n      if (!qDefer) {\n        qDefer = $q.defer();\n        debouncePromise = qDefer.promise.then(function () {\n          // qDefer got resolved. forget it's reference in case of recursivity.\n          qDefer = null;\n          return fn.apply(self, args);\n        });\n      }\n\n      timeoutPromise = $timeout(function () {\n        qDefer.resolve();\n      }, rate);\n      return debouncePromise;\n    };\n  };\n}).factory('a2LookaheadHelper', function ($q) {\n  var a2LookaheadHelper = function (options) {\n    this.options = options || {};\n\n    if (!options.searchCompare) {\n      options.searchCompare = function (a, b) {\n        return a == b;\n      };\n    }\n  };\n\n  a2LookaheadHelper.prototype = {\n    search: function (text) {\n      var options = this.options;\n\n      if (options.minLength && text.length < options.minLength) {\n        return $q.resolve([]);\n      }\n\n      var promise = options.fn(text);\n\n      if (options.includeSearch) {\n        promise = promise.then(function (items) {\n          var textItem = items.filter(function (item) {\n            return options.searchCompare(text, item);\n          }).pop();\n\n          if (!textItem) {\n            items.unshift(options.searchPromote ? options.searchPromote(text) : text);\n          }\n\n          return items;\n        });\n      }\n\n      return promise;\n    }\n  };\n  return a2LookaheadHelper;\n}).service('EventlistManager', function () {\n  var EventlistManager = function () {\n    this.events = {};\n  };\n\n  EventlistManager.prototype.get_event_def = function (event) {\n    if (!this.events[event]) {\n      this.events[event] = {};\n    }\n\n    return this.events[event];\n  };\n\n  EventlistManager.prototype.send = function ()\n  /* ...args */\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var event = args.shift();\n\n    if (typeof event == 'string') {\n      event = {\n        event: event\n      };\n    }\n\n    var eventdef = this.get_event_def(event.event);\n\n    if (event.oneTime) {\n      eventdef.oneTime = true;\n    }\n\n    var context = event.context;\n    var listeners = eventdef.listeners;\n    eventdef.fired = true;\n\n    if (listeners) {\n      listeners.forEach(function (l) {\n        l.apply(context, args);\n      });\n    }\n  };\n\n  EventlistManager.prototype.on = function (event, fn) {\n    var eventdef = this.get_event_def(event);\n\n    if (eventdef.fired && eventdef.oneTime) {\n      fn.apply();\n    } else {\n      if (!eventdef.listeners) {\n        eventdef.listeners = [];\n      }\n\n      eventdef.listeners.push(fn);\n    }\n  };\n\n  return EventlistManager;\n}); // TODO break to multiple files\n\nangular.module('a2.infotags', ['a2.services']).directive('a2Species', function (Species, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      species: '='\n    },\n    template: '{{data.scientific_name}}',\n    link: function ($scope, $element, $attrs) {\n      $scope.$watch('species', function (newVal, oldVal) {\n        $scope.data = null;\n\n        if (newVal) {\n          Species.findById(newVal, function (data) {\n            $timeout(function () {\n              $scope.data = data;\n            });\n          });\n        }\n      });\n    }\n  };\n}).directive('a2.songtype', function (Songtypes, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      songtype: '='\n    },\n    template: '{{data.name}}',\n    link: function ($scope, $element, $attrs) {\n      $scope.$watch('songtype', function (newVal, oldVal) {\n        $scope.data = null;\n\n        if (newVal) {\n          Songtypes.findById(newVal, function (data) {\n            $timeout(function () {\n              $scope.data = data;\n            });\n          });\n        }\n      });\n    }\n  };\n}); // TODO break to multiple files\n\nangular.module('a2.classy', []).factory('makeClass', function ($inheritFrom) {\n  var slice = Array.prototype.slice;\n  return function makeClass(classdef) {\n    if (!classdef.constructor) {\n      classdef.constructor = classdef.super && classdef.super.constructor ? function super_constructor() {\n        this.super.constructor.apply(this, slice.call(arguments));\n      } : function empty_constructor() {};\n    }\n\n    if (classdef.static) {\n      angular.extend(classdef.constructor, classdef.static);\n      delete classdef.static;\n    }\n\n    if (classdef.super) {\n      classdef = $inheritFrom(classdef.super, classdef);\n    }\n\n    classdef.constructor.prototype = classdef;\n    (window.qc || (window.qc = [])).push(classdef);\n    return classdef.constructor;\n  };\n}).value('$inheritFrom', function $inheritFrom(object) {\n  var fn = function () {};\n\n  fn.prototype = object;\n\n  if (arguments.length > 1) {\n    var args = Array.prototype.slice.call(arguments);\n    args[0] = new fn();\n    return angular.extend.apply(angular, args);\n  } else {\n    return new fn();\n  }\n});","angular.module(\"a2.srv.app-listings\", ['a2.srv.api']).service(\"AppListingsService\", function (a2APIService) {\n  return {\n    getFor: function (app) {\n      return a2APIService.api.get('/app-listings/' + app);\n    }\n  };\n});","angular.module('a2.service.colorscale-gradients', []).service('ColorscaleGradients', function () {\n  var g = [];\n\n  for (var i = 0; i < 256; ++i) {\n    var j = 255 - i;\n    g.push('rgb(' + j + ',' + j + ',' + j + ')');\n  }\n\n  var ColorscaleGradients = {\n    gradients: [['#4400e5', '#4000e5', '#3c00e5', '#3700e5', '#3300e5', '#2f00e5', '#2a00e5', '#2600e5', '#2200e5', '#1d00e5', '#1900e5', '#1500e5', '#1100e5', '#0c00e5', '#0800e5', '#0400e5', '#0000e5', '#0004e5', '#0008e5', '#000de5', '#0011e5', '#0015e5', '#001ae5', '#001ee5', '#0022e5', '#0027e5', '#002be5', '#002fe5', '#0034e5', '#0038e5', '#003ce5', '#0041e5', '#0045e5', '#0049e5', '#004ee5', '#0052e5', '#0056e5', '#005ae5', '#005fe5', '#0063e5', '#0067e5', '#006ce5', '#0070e5', '#0074e5', '#0079e5', '#007de5', '#0081e5', '#0086e5', '#008ae5', '#008ee5', '#0093e5', '#0097e5', '#009be5', '#00a0e5', '#00a4e5', '#00a8e5', '#00ade5', '#00b1e5', '#00b5e5', '#00bae5', '#00bee5', '#00c2e5', '#00c6e5', '#00cbe5', '#00e543', '#00e53f', '#00e53b', '#00e536', '#00e532', '#00e52e', '#00e529', '#00e525', '#00e521', '#00e51c', '#00e518', '#00e514', '#00e50f', '#00e50b', '#00e507', '#00e502', '#01e500', '#05e500', '#09e500', '#0ee500', '#12e500', '#16e500', '#1be500', '#1fe500', '#23e500', '#28e500', '#2ce500', '#30e500', '#35e500', '#39e500', '#3de500', '#42e500', '#46e500', '#4ae500', '#4fe500', '#53e500', '#57e500', '#5ce500', '#60e500', '#64e500', '#69e500', '#6de500', '#71e500', '#75e500', '#7ae500', '#7ee500', '#82e500', '#87e500', '#8be500', '#8fe500', '#94e500', '#98e500', '#9ce500', '#a1e500', '#a5e500', '#a9e500', '#aee500', '#b2e500', '#b6e500', '#bbe500', '#bfe500', '#c3e500', '#c8e500', '#cce500', '#e5e401', '#e5e303', '#e5e106', '#e5e008', '#e5df0b', '#e5de0d', '#e5dc10', '#e5db12', '#e5da15', '#e5d917', '#e5d81a', '#e5d71c', '#e5d51f', '#e5d422', '#e5d324', '#e5d227', '#e5d229', '#e5d12c', '#e5d02e', '#e5cf31', '#e5ce33', '#e5cd36', '#e5cd38', '#e5cc3b', '#e5cb3d', '#e5cb40', '#e5ca42', '#e5c945', '#e5c947', '#e5c84a', '#e5c84c', '#e5c74f', '#e5c751', '#e5c754', '#e5c656', '#e5c659', '#e5c65b', '#e5c55e', '#e5c561', '#e5c563', '#e5c566', '#e5c468', '#e5c46b', '#e5c46d', '#e5c470', '#e5c472', '#e5c475', '#e5c477', '#e5c47a', '#e5c47c', '#e5c57f', '#e5c581', '#e5c584', '#e5c586', '#e5c589', '#e5c68b', '#e5c68e', '#e5c690', '#e5c793', '#e5c795', '#e5c898', '#e5c89a', '#e5c99d', '#e5c9a0', '#916225', '#926328', '#93652a', '#95672c', '#96682f', '#986a31', '#996c33', '#9a6d36', '#9c6f38', '#9d713a', '#9f723d', '#a0743f', '#a27641', '#a37744', '#a47946', '#a67a48', '#a77c4b', '#a97e4d', '#aa7f4f', '#ab8152', '#ad8354', '#ae8456', '#b08659', '#b1885b', '#b2895d', '#b48b60', '#b58d62', '#b78e64', '#b89067', '#ba9269', '#bb936b', '#bc956e', '#be9670', '#bf9872', '#c19a75', '#c29b77', '#c39d79', '#c59f7c', '#c6a07e', '#c8a280', '#c9a483', '#caa585', '#cca787', '#cda98a', '#cfaa8c', '#d0ac8e', '#d2ad91', '#d3af93', '#d4b195', '#d6b298', '#d7b49a', '#d9b69c', '#dab79f', '#dbb9a1', '#ddbba3', '#debca6', '#e0bea8', '#e1c0aa', '#e2c1ad', '#e4c3af', '#e5c5b1', '#e7c6b4', '#e8c8b6', '#eacab9'], ['#ffffff', '#fefefe', '#fdfdfd', '#fcfcfc', '#fbfbfb', '#fafafa', '#f9f9f9', '#f8f8f8', '#f7f7f7', '#f6f6f6', '#f5f5f5', '#f4f4f4', '#f3f3f3', '#f2f2f2', '#f1f1f1', '#f0f0f0', '#efefef', '#eeeeee', '#ededed', '#ececec', '#ebebeb', '#eaeaea', '#e9e9e9', '#e8e8e8', '#e7e7e7', '#e6e6e6', '#e5e5e5', '#e4e4e4', '#e3e3e3', '#e2e2e2', '#e1e1e1', '#e0e0e0', '#dfdfdf', '#dedede', '#dddddd', '#dcdcdc', '#dbdbdb', '#dadada', '#d9d9d9', '#d8d8d8', '#d7d7d7', '#d6d6d6', '#d5d5d5', '#d4d4d4', '#d3d3d3', '#d2d2d2', '#d1d1d1', '#d0d0d0', '#cfcfcf', '#cecece', '#cdcdcd', '#cccccc', '#cbcbcb', '#cacaca', '#c9c9c9', '#c8c8c8', '#c7c7c7', '#c6c6c6', '#c5c5c5', '#c4c4c4', '#c3c3c3', '#c2c2c2', '#c1c1c1', '#c0c0c0', '#bfbfbf', '#bebebe', '#bdbdbd', '#bcbcbc', '#bbbbbb', '#bababa', '#b9b9b9', '#b8b8b8', '#b7b7b7', '#b6b6b6', '#b5b5b5', '#b4b4b4', '#b3b3b3', '#b2b2b2', '#b1b1b1', '#b0b0b0', '#afafaf', '#aeaeae', '#adadad', '#acacac', '#ababab', '#aaaaaa', '#a9a9a9', '#a8a8a8', '#a7a7a7', '#a6a6a6', '#a5a5a5', '#a4a4a4', '#a3a3a3', '#a2a2a2', '#a1a1a1', '#a0a0a0', '#9f9f9f', '#9e9e9e', '#9d9d9d', '#9c9c9c', '#9b9b9b', '#9a9a9a', '#999999', '#989898', '#979797', '#969696', '#959595', '#949494', '#939393', '#929292', '#919191', '#909090', '#8f8f8f', '#8e8e8e', '#8d8d8d', '#8c8c8c', '#8b8b8b', '#8a8a8a', '#898989', '#888888', '#878787', '#868686', '#858585', '#848484', '#838383', '#828282', '#818181', '#808080', '#7f7f7f', '#7e7e7e', '#7d7d7d', '#7c7c7c', '#7b7b7b', '#7a7a7a', '#797979', '#787878', '#777777', '#767676', '#757575', '#747474', '#737373', '#727272', '#717171', '#707070', '#6f6f6f', '#6e6e6e', '#6d6d6d', '#6c6c6c', '#6b6b6b', '#6a6a6a', '#696969', '#686868', '#676767', '#666666', '#656565', '#646464', '#636363', '#626262', '#616161', '#606060', '#5f5f5f', '#5e5e5e', '#5d5d5d', '#5c5c5c', '#5b5b5b', '#5a5a5a', '#595959', '#585858', '#575757', '#565656', '#555555', '#545454', '#535353', '#525252', '#515151', '#505050', '#4f4f4f', '#4e4e4e', '#4d4d4d', '#4c4c4c', '#4b4b4b', '#4a4a4a', '#494949', '#484848', '#474747', '#464646', '#454545', '#444444', '#434343', '#424242', '#414141', '#404040', '#3f3f3f', '#3e3e3e', '#3d3d3d', '#3c3c3c', '#3b3b3b', '#3a3a3a', '#393939', '#383838', '#373737', '#363636', '#353535', '#343434', '#333333', '#323232', '#313131', '#303030', '#2f2f2f', '#2e2e2e', '#2d2d2d', '#2c2c2c', '#2b2b2b', '#2a2a2a', '#292929', '#282828', '#272727', '#262626', '#252525', '#242424', '#232323', '#222222', '#212121', '#202020', '#1f1f1f', '#1e1e1e', '#1d1d1d', '#1c1c1c', '#1b1b1b', '#1a1a1a', '#191919', '#181818', '#171717', '#161616', '#151515', '#141414', '#131313', '#121212', '#111111', '#101010', '#0f0f0f', '#0e0e0e', '#0d0d0d', '#0c0c0c', '#0b0b0b', '#0a0a0a', '#090909', '#080808', '#070707', '#060606', '#050505', '#040404', '#030303', '#020202', '#010101', '#000000'], ['#0a0000', '#0d0000', '#0f0000', '#120000', '#150000', '#170000', '#1a0000', '#1c0000', '#1f0000', '#220000', '#240000', '#270000', '#2a0000', '#2c0000', '#2f0000', '#310000', '#340000', '#370000', '#390000', '#3c0000', '#3f0000', '#410000', '#440000', '#460000', '#490000', '#4c0000', '#4e0000', '#510000', '#540000', '#560000', '#590000', '#5b0000', '#5e0000', '#610000', '#630000', '#660000', '#690000', '#6b0000', '#6e0000', '#700000', '#730000', '#760000', '#780000', '#7b0000', '#7e0000', '#800000', '#830000', '#850000', '#880000', '#8b0000', '#8d0000', '#900000', '#930000', '#950000', '#980000', '#9a0000', '#9d0000', '#a00000', '#a20000', '#a50000', '#a80000', '#aa0000', '#ad0000', '#af0000', '#b20000', '#b50000', '#b70000', '#ba0000', '#bd0000', '#bf0000', '#c20000', '#c40000', '#c70000', '#ca0000', '#cc0000', '#cf0000', '#d20000', '#d40000', '#d70000', '#d90000', '#dc0000', '#df0000', '#e10000', '#e40000', '#e70000', '#e90000', '#ec0000', '#ee0000', '#f10000', '#f40000', '#f60000', '#f90000', '#fc0000', '#fe0000', '#ff0200', '#ff0500', '#ff0700', '#ff0a00', '#ff0c00', '#ff0f00', '#ff1200', '#ff1400', '#ff1700', '#ff1a00', '#ff1c00', '#ff1f00', '#ff2100', '#ff2400', '#ff2700', '#ff2900', '#ff2c00', '#ff2f00', '#ff3100', '#ff3400', '#ff3600', '#ff3900', '#ff3c00', '#ff3e00', '#ff4100', '#ff4400', '#ff4600', '#ff4900', '#ff4b00', '#ff4e00', '#ff5100', '#ff5300', '#ff5600', '#ff5900', '#ff5b00', '#ff5e00', '#ff6000', '#ff6300', '#ff6600', '#ff6800', '#ff6b00', '#ff6e00', '#ff7000', '#ff7300', '#ff7500', '#ff7800', '#ff7b00', '#ff7d00', '#ff8000', '#ff8300', '#ff8500', '#ff8800', '#ff8a00', '#ff8d00', '#ff9000', '#ff9200', '#ff9500', '#ff9700', '#ff9a00', '#ff9d00', '#ff9f00', '#ffa200', '#ffa500', '#ffa700', '#ffaa00', '#ffac00', '#ffaf00', '#ffb200', '#ffb400', '#ffb700', '#ffba00', '#ffbc00', '#ffbf00', '#ffc100', '#ffc400', '#ffc700', '#ffc900', '#ffcc00', '#ffcf00', '#ffd100', '#ffd400', '#ffd600', '#ffd900', '#ffdc00', '#ffde00', '#ffe100', '#ffe400', '#ffe600', '#ffe900', '#ffeb00', '#ffee00', '#fff100', '#fff300', '#fff600', '#fff900', '#fffb00', '#fffe00', '#ffff02', '#ffff06', '#ffff0a', '#ffff0e', '#ffff12', '#ffff16', '#ffff1a', '#ffff1e', '#ffff22', '#ffff26', '#ffff2a', '#ffff2e', '#ffff32', '#ffff36', '#ffff3a', '#ffff3e', '#ffff41', '#ffff45', '#ffff49', '#ffff4d', '#ffff51', '#ffff55', '#ffff59', '#ffff5d', '#ffff61', '#ffff65', '#ffff69', '#ffff6d', '#ffff71', '#ffff75', '#ffff79', '#ffff7d', '#ffff80', '#ffff84', '#ffff88', '#ffff8c', '#ffff90', '#ffff94', '#ffff98', '#ffff9c', '#ffffa0', '#ffffa4', '#ffffa8', '#ffffac', '#ffffb0', '#ffffb4', '#ffffb8', '#ffffbc', '#ffffbf', '#ffffc3', '#ffffc7', '#ffffcb', '#ffffcf', '#ffffd3', '#ffffd7', '#ffffdb', '#ffffdf', '#ffffe3', '#ffffe7', '#ffffeb', '#ffffef', '#fffff3', '#fffff7', '#fffffb', '#ffffff'], ['#000000', '#120102', '#240204', '#360306', '#490408', '#5b050a', '#6d060c', '#7f070e', '#920810', '#a40912', '#b60a14', '#c90b16', '#db0c18', '#ed0d1a', '#fe0e1c', '#f90f1e', '#f41020', '#ef1122', '#ea1224', '#e51326', '#e01428', '#db152a', '#d6162c', '#d1172e', '#cc1830', '#c71932', '#c21a34', '#bd1b36', '#b81c38', '#b41d3a', '#af1e3c', '#aa1f3e', '#a52040', '#a02041', '#9b2244', '#962346', '#912448', '#8c2449', '#87264c', '#82274e', '#7d2850', '#782851', '#732a54', '#6e2b56', '#692c58', '#642c59', '#5f2e5c', '#5a2f5e', '#553060', '#503061', '#4b3264', '#463366', '#413468', '#3c3469', '#37366c', '#32376e', '#2d3870', '#283871', '#233a74', '#1e3b76', '#193c78', '#143c79', '#0f3e7c', '#0a3f7e', '#404080', '#414182', '#414183', '#434386', '#444488', '#45458a', '#46468c', '#47478e', '#484890', '#494992', '#494993', '#4b4b96', '#4c4c98', '#4d4d9a', '#4e4e9c', '#4f4f9e', '#5050a0', '#5151a2', '#5151a3', '#5353a6', '#5454a8', '#5555aa', '#5656ac', '#5757ae', '#5858b0', '#5959b2', '#5959b3', '#5b5bb6', '#5c5cb8', '#5d5dba', '#5e5ebc', '#5f5fbe', '#6060c0', '#6161c2', '#6161c3', '#6363c6', '#6464c8', '#6565ca', '#6666cc', '#6767ce', '#6868d0', '#6969d2', '#6969d3', '#6b6bd6', '#6c6cd8', '#6d6dda', '#6e6edc', '#6f6fde', '#7070e0', '#7171e2', '#7171e3', '#7373e6', '#7474e8', '#7575ea', '#7676ec', '#7777ee', '#7878f0', '#7979f2', '#7979f3', '#7b7bf6', '#7c7cf8', '#7d7dfa', '#7e7efc', '#7f7ffe', '#8080fc', '#8181f8', '#8282f4', '#8383f0', '#8383eb', '#8485e7', '#8686e3', '#8787df', '#8888da', '#8989d6', '#8a8ad2', '#8b8bce', '#8c8cc9', '#8d8dc5', '#8e8ec1', '#8f8fbd', '#9090b8', '#9191b4', '#9292b0', '#9393ac', '#9393a7', '#9595a3', '#96969f', '#97979a', '#989896', '#999992', '#9a9a8e', '#9b9b89', '#9c9c85', '#9d9d81', '#9e9e7d', '#9f9f78', '#a0a074', '#a1a170', '#a2a26c', '#a3a367', '#a3a363', '#a5a55f', '#a6a65b', '#a7a756', '#a8a852', '#a9a94e', '#aaaa4a', '#abab45', '#acac41', '#adad3d', '#aeae39', '#afaf34', '#b0b030', '#b1b12c', '#b2b228', '#b3b323', '#b3b31f', '#b5b51b', '#b6b617', '#b7b712', '#b8b80e', '#b9b90a', '#baba06', '#bbbb01', '#bcbc02', '#bdbd05', '#bebe09', '#bfbf0d', '#c0c011', '#c1c115', '#c2c218', '#c3c31c', '#c3c320', '#c4c524', '#c5c627', '#c7c72b', '#c8c82f', '#c9c933', '#caca37', '#cbcb3a', '#cbcc3e', '#cdcd42', '#cece46', '#cfcf49', '#d0d04d', '#d1d151', '#d2d255', '#d3d358', '#d3d35c', '#d5d560', '#d6d664', '#d7d768', '#d8d86b', '#d9d96f', '#dada73', '#dbdb77', '#dcdc7a', '#dddd7e', '#dede82', '#dfdf86', '#e0e08a', '#e1e18d', '#e2e291', '#e3e395', '#e3e399', '#e5e59c', '#e6e6a0', '#e7e7a4', '#e8e8a8', '#e9e9ab', '#eaeaaf', '#ebebb3', '#ececb7', '#ededbb', '#eeeebe', '#efefc2', '#f0f0c6', '#f1f1ca', '#f2f2cd', '#f3f3d1', '#f3f3d5', '#f4f5d9', '#f5f6dd', '#f7f7e0', '#f8f8e4', '#f9f9e8', '#fafaec', '#fbfbef', '#fbfcf3', '#fdfdf7', '#fefefb', '#ffffff'], ['#000080', '#000776', '#000e6d', '#001563', '#001d5a', '#002450', '#002b47', '#00333e', '#003a34', '#00412b', '#004821', '#005018', '#00570f', '#005e05', '#005816', '#005126', '#004a37', '#004348', '#003d58', '#003669', '#002f79', '#00288a', '#00219b', '#001bab', '#0014bc', '#000dcd', '#0006dd', '#0000ee', '#000eff', '#001cff', '#002aff', '#0038ff', '#0046ff', '#0054ff', '#0062ff', '#0070ff', '#007fff', '#008dff', '#009bff', '#00a9ff', '#00b7ff', '#00c0ff', '#00c5ff', '#00caff', '#00ceff', '#00d2ff', '#00d7ff', '#00dbff', '#00e0ff', '#00e4ff', '#00e8ff', '#00edff', '#00f1fe', '#00f6f8', '#00faf1', '#00feeb', '#00fee4', '#00fede', '#00fdd7', '#00fdd1', '#00fcca', '#00fcc3', '#00fbbd', '#00fbb6', '#00fab0', '#00faa9', '#00faa3', '#00fa9c', '#00fa92', '#00fa87', '#00fa7d', '#00fa72', '#00fb68', '#00fb5d', '#00fc53', '#00fc49', '#00fc3e', '#00fd34', '#00fd29', '#00fe1f', '#06fe14', '#0cfe0a', '#13fb00', '#19f700', '#1ff300', '#26ef00', '#2cec00', '#32e800', '#39e400', '#3fe000', '#46dd00', '#4cd900', '#52d500', '#59d100', '#5fce00', '#65d100', '#67d400', '#69d700', '#6bdb00', '#6dde00', '#6fe100', '#71e400', '#73e800', '#75eb00', '#77ee00', '#79f100', '#7bf500', '#7df803', '#7ffb07', '#84fe0b', '#88ff0f', '#8dff13', '#91ff17', '#96ff1b', '#9aff1f', '#9fff23', '#a4ff27', '#a8ff2b', '#adff2f', '#b1ff33', '#b6ff37', '#baff3b', '#bfff37', '#c3ff33', '#c8ff2f', '#ccff2b', '#d1ff27', '#d6ff23', '#daff1f', '#dfff1b', '#e3ff17', '#e8ff13', '#ecff0f', '#f1ff0b', '#f5fc07', '#fafa03', '#fff700', '#fff500', '#fff200', '#fff000', '#ffed00', '#ffeb00', '#ffe800', '#ffe600', '#ffe300', '#ffe100', '#ffde00', '#ffdc00', '#ffda00', '#ffd701', '#ffd502', '#ffd203', '#ffd004', '#ffcd05', '#ffcb06', '#ffc807', '#ffc608', '#ffc309', '#ffc10a', '#ffbe0b', '#ffbc0c', '#ffb90d', '#ffb10d', '#ffa90c', '#ffa10b', '#ff990a', '#ff9109', '#ff8808', '#ff8007', '#ff7806', '#ff7005', '#ff6804', '#ff5f03', '#ff5702', '#ff4f01', '#ff4700', '#ff4200', '#ff3d00', '#ff3900', '#ff3400', '#ff2f00', '#ff2a00', '#ff2600', '#ff2100', '#ff1c00', '#ff1700', '#ff1300', '#ff0e00', '#ff0900', '#ff0411', '#ff0023', '#ff0035', '#ff0046', '#ff0058', '#ff006a', '#ff007b', '#ff008d', '#ff009f', '#ff00b1', '#ff00c2', '#ff00d4', '#ff00e6', '#ff00f8', '#f803fb', '#f106ff', '#ea0aff', '#e30dff', '#dc11ff', '#d514ff', '#ce18ff', '#c71bff', '#c11eff', '#ba22ff', '#b325ff', '#ac29ff', '#a52cfe', '#9e32fd', '#a438fc', '#aa3efb', '#b044fa', '#b64af8', '#bc50f7', '#c256f6', '#c75cf5', '#cd61f4', '#d367f2', '#d96df1', '#df73f0', '#e579ef', '#eb7fee', '#ec84ee', '#ec88ef', '#ed8df0', '#ee92f0', '#ef96f1', '#ef9bf1', '#f09ff2', '#f1a4f3', '#f1a9f3', '#f2adf4', '#f3b2f4', '#f4b7f5', '#f4bbf6', '#f5c0f6', '#f6c5f7', '#f6c9f7', '#f7cef8', '#f8d2f9', '#f9d7f9', '#f9dcfa', '#fae0fa', '#fbe5fb', '#fbeafc', '#fceefc', '#fdf3fd', '#fef7fe'] // ['#ffffff', '#fefefe', '#fdfdfd', '#fcfcfc', '#fbfbfb', '#fafafa', '#f9f9f9', '#f8f8f8', '#f7f7f7', '#f6f6f6', '#f5f5f5', '#f4f4f4', '#f3f3f3', '#f2f2f2', '#f1f1f1', '#f0f0f0', '#efefef', '#eeeeee', '#ededed', '#ececec', '#ebebeb', '#eaeaea', '#e9e9e9', '#e8e8e8', '#e7e7e7', '#e6e6e6', '#e5e5e5', '#e4e4e4', '#e3e3e3', '#e2e2e2', '#e1e1e1', '#e0e0e0', '#dfdfdf', '#dedede', '#dddddd', '#dcdcdc', '#dbdbdb', '#dadada', '#d9d9d9', '#d8d8d8', '#d7d7d7', '#d6d6d6', '#d5d5d5', '#d3d3d3', '#d3d3d3', '#d2d2d2', '#d1d1d1', '#d0d0d0', '#cfcfcf', '#cecece', '#cdcdcd', '#cccccc', '#cbcbcb', '#cacaca', '#c9c9c9', '#c8c8c8', '#c7c7c7', '#c6c6c6', '#c5c5c5', '#c3c3c3', '#c3c3c3', '#c2c2c2', '#c1c1c1', '#c0c0c0', '#bfbfbf', '#bebebe', '#bdbdbd', '#bcbcbc', '#bbbbbb', '#bababa', '#b9b9b9', '#b8b8b8', '#b7b7b7', '#b6b6b6', '#b5b5b5', '#b3b3b3', '#b3b3b3', '#b2b2b2', '#b1b1b1', '#b0b0b0', '#afafaf', '#aeaeae', '#adadad', '#acacac', '#ababab', '#aaaaaa', '#a9a9a9', '#a8a8a8', '#a7a7a7', '#a6a6a6', '#a5a5a5', '#a3a3a3', '#a3a3a3', '#a2a2a2', '#a1a1a1', '#a0a0a0', '#9f9f9f', '#9e9e9e', '#9d9d9d', '#9c9c9c', '#9b9b9b', '#9a9a9a', '#999999', '#989898', '#979797', '#969696', '#959595', '#939393', '#939393', '#929292', '#919191', '#909090', '#8f8f8f', '#8e8e8e', '#8d8d8d', '#8c8c8c', '#8b8b8b', '#8a8a8a', '#898989', '#888888', '#878787', '#868686', '#858585', '#838383', '#838383', '#828282', '#818181', '#808080', '#7f7f7f', '#7e7e7e', '#7d7d7d', '#7c7c7c', '#7b7b7b', '#797979', '#797979', '#787878', '#777777', '#767676', '#757575', '#747474', '#727272', '#717171', '#717171', '#707070', '#6f6f6f', '#6e6e6e', '#6d6d6d', '#6c6c6c', '#6b6b6b', '#696969', '#696969', '#686868', '#676767', '#666666', '#656565', '#646464', '#626262', '#616161', '#616161', '#606060', '#5f5f5f', '#5e5e5e', '#5d5d5d', '#5c5c5c', '#5b5b5b', '#595959', '#595959', '#585858', '#575757', '#565656', '#555555', '#545454', '#525252', '#515151', '#515151', '#505050', '#4f4f4f', '#4e4e4e', '#4d4d4d', '#4c4c4c', '#4b4b4b', '#494949', '#494949', '#484848', '#474747', '#464646', '#454545', '#444444', '#424242', '#414141', '#414141', '#404040', '#3f3f3f', '#3e3e3e', '#3d3d3d', '#3c3c3c', '#3b3b3b', '#393939', '#383838', '#383838', '#373737', '#363636', '#353535', '#343434', '#323232', '#313131', '#303030', '#303030', '#2f2f2f', '#2e2e2e', '#2d2d2d', '#2c2c2c', '#2b2b2b', '#292929', '#282828', '#282828', '#272727', '#262626', '#252525', '#242424', '#222222', '#212121', '#202020', '#202020', '#1f1f1f', '#1e1e1e', '#1d1d1d', '#1c1c1c', '#1b1b1b', '#191919', '#181818', '#181818', '#171717', '#161616', '#151515', '#141414', '#121212', '#111111', '#101010', '#101010', '#0f0f0f', '#0e0e0e', '#0d0d0d', '#0c0c0c', '#0b0b0b', '#090909', '#080808', '#080808', '#070707', '#060606', '#050505', '#040404', '#020202', '#010101', '#000000', '#000000'],\n    // ['#000000', '#010000', '#030000', '#040000', '#060000', '#070000', '#090000', '#0a0000', '#0c0000', '#0d0000', '#0f0000', '#100000', '#120000', '#130000', '#150000', '#160000', '#180000', '#190000', '#1b0000', '#1c0000', '#1e0000', '#1f0000', '#200000', '#220000', '#240000', '#250000', '#270000', '#280000', '#2a0000', '#2b0000', '#2c0000', '#2e0000', '#300000', '#310000', '#330000', '#340000', '#360000', '#370000', '#380000', '#3a0000', '#3c0000', '#3d0000', '#3f0000', '#400000', '#410000', '#430000', '#450000', '#460000', '#480000', '#490000', '#4b0000', '#4c0000', '#4e0000', '#4f0000', '#510000', '#520000', '#540000', '#550000', '#570000', '#580000', '#590000', '#5b0000', '#5d0000', '#5e0000', '#600000', '#610000', '#620000', '#640000', '#660000', '#670000', '#690000', '#6a0000', '#6c0000', '#6d0000', '#6e0000', '#700000', '#710000', '#730000', '#750000', '#760000', '#780000', '#790000', '#7a0000', '#7c0000', '#7e0000', '#7f0000', '#810000', '#820000', '#830000', '#850000', '#860000', '#880000', '#8a0000', '#8b0000', '#8d0000', '#8e0000', '#900000', '#910000', '#930000', '#940000', '#960000', '#970000', '#990000', '#9a0000', '#9c0000', '#9d0000', '#9f0000', '#a00000', '#a20000', '#a30000', '#a50000', '#a60000', '#a80000', '#a90000', '#ab0000', '#ac0000', '#ae0000', '#af0000', '#b10000', '#b20000', '#b30000', '#b50000', '#b60000', '#b80000', '#ba0000', '#bb0000', '#bd0000', '#be0000', '#c00000', '#c10200', '#c30400', '#c40600', '#c50800', '#c70b00', '#c90d00', '#ca0f00', '#cc1000', '#cd1200', '#cf1400', '#d01600', '#d21900', '#d31b00', '#d51d00', '#d61f00', '#d82000', '#d92200', '#db2400', '#dc2600', '#dd2800', '#df2b00', '#e12d00', '#e22f00', '#e33000', '#e53200', '#e63400', '#e83600', '#ea3900', '#eb3b00', '#ed3d00', '#ee3f00', '#f04100', '#f14200', '#f34400', '#f44600', '#f54800', '#f74b00', '#f94d00', '#fa4f00', '#fc5100', '#fd5200', '#ff5400', '#ff5600', '#ff5900', '#ff5b00', '#ff5d00', '#ff5f00', '#ff6100', '#ff6200', '#ff6400', '#ff6600', '#ff6800', '#ff6b00', '#ff6d00', '#ff6f00', '#ff7100', '#ff7200', '#ff7400', '#ff7600', '#ff7900', '#ff7b00', '#ff7d00', '#ff7f00', '#ff8102', '#ff8306', '#ff840a', '#ff860e', '#ff8812', '#ff8b17', '#ff8d1b', '#ff8f1f', '#ff9122', '#ff9326', '#ff942a', '#ff962e', '#ff9933', '#ff9b37', '#ff9d3b', '#ff9f3f', '#ffa142', '#ffa346', '#ffa44a', '#ffa64e', '#ffa852', '#ffab57', '#ffad5b', '#ffaf5f', '#ffb162', '#ffb366', '#ffb46a', '#ffb66e', '#ffb973', '#ffbb77', '#ffbd7b', '#ffbf7f', '#ffc183', '#ffc386', '#ffc48a', '#ffc68e', '#ffc892', '#ffcb97', '#ffcd9b', '#ffcf9f', '#ffd1a3', '#ffd3a6', '#ffd4aa', '#ffd6ae', '#ffd9b3', '#ffdbb7', '#ffddbb', '#ffdfbf', '#ffe1c3', '#ffe3c6', '#ffe4ca', '#ffe6ce', '#ffe8d2', '#ffebd7', '#ffeddb', '#ffefdf', '#fff1e3', '#fff3e6', '#fff4ea', '#fff6ee', '#fff9f3', '#fffbf7', '#fffdfb', '#ffffff'],\n    // ['#00007f', '#000084', '#000088', '#00008d', '#000091', '#000096', '#00009a', '#00009f', '#0000a3', '#0000a8', '#0000ac', '#0000b1', '#0000b6', '#0000ba', '#0000bf', '#0000c3', '#0000c8', '#0000cc', '#0000d1', '#0000d5', '#0000da', '#0000de', '#0000e3', '#0000e8', '#0000ec', '#0000f1', '#0000f5', '#0000fa', '#0000fe', '#0000ff', '#0000ff', '#0000ff', '#0000ff', '#0004ff', '#0008ff', '#000cff', '#0010ff', '#0014ff', '#0018ff', '#001cff', '#0020ff', '#0024ff', '#0028ff', '#002cff', '#0030ff', '#0034ff', '#0038ff', '#003cff', '#0040ff', '#0044ff', '#0048ff', '#004cff', '#0050ff', '#0054ff', '#0058ff', '#005cff', '#0060ff', '#0064ff', '#0068ff', '#006cff', '#0070ff', '#0074ff', '#0078ff', '#007cff', '#0080ff', '#0084ff', '#0088ff', '#008cff', '#0090ff', '#0094ff', '#0098ff', '#009cff', '#00a0ff', '#00a4ff', '#00a8ff', '#00acff', '#00b0ff', '#00b4ff', '#00b8ff', '#00bcff', '#00c0ff', '#00c4ff', '#00c8ff', '#00ccff', '#00d0ff', '#00d4ff', '#00d8ff', '#00dcfe', '#00e0fa', '#00e4f7', '#02e8f4', '#05ecf1', '#08f0ed', '#0cf4ea', '#0ff8e7', '#12fce4', '#15ffe1', '#18ffdd', '#1cffda', '#1fffd7', '#22ffd4', '#25ffd0', '#29ffcd', '#2cffca', '#2fffc7', '#32ffc3', '#36ffc0', '#39ffbd', '#3cffba', '#3fffb7', '#42ffb3', '#46ffb0', '#49ffad', '#4cffaa', '#4fffa6', '#53ffa3', '#56ffa0', '#59ff9d', '#5cff9a', '#5fff96', '#63ff93', '#66ff90', '#69ff8d', '#6cff89', '#70ff86', '#73ff83', '#76ff80', '#79ff7d', '#7cff79', '#80ff76', '#83ff73', '#86ff70', '#89ff6c', '#8dff69', '#90ff66', '#93ff63', '#96ff5f', '#9aff5c', '#9dff59', '#a0ff56', '#a3ff53', '#a6ff4f', '#aaff4c', '#adff49', '#b0ff46', '#b3ff42', '#b7ff3f', '#baff3c', '#bdff39', '#c0ff36', '#c3ff32', '#c7ff2f', '#caff2c', '#cdff29', '#d0ff25', '#d4ff22', '#d7ff1f', '#daff1c', '#ddff18', '#e0ff15', '#e4ff12', '#e7ff0f', '#eaff0c', '#edff08', '#f1fc05', '#f4f802', '#f7f400', '#faf000', '#feed00', '#ffe900', '#ffe500', '#ffe200', '#ffde00', '#ffda00', '#ffd700', '#ffd300', '#ffcf00', '#ffcb00', '#ffc800', '#ffc400', '#ffc000', '#ffbd00', '#ffb900', '#ffb500', '#ffb100', '#ffae00', '#ffaa00', '#ffa600', '#ffa300', '#ff9f00', '#ff9b00', '#ff9800', '#ff9400', '#ff9000', '#ff8c00', '#ff8900', '#ff8500', '#ff8100', '#ff7e00', '#ff7a00', '#ff7600', '#ff7300', '#ff6f00', '#ff6b00', '#ff6700', '#ff6400', '#ff6000', '#ff5c00', '#ff5900', '#ff5500', '#ff5100', '#ff4d00', '#ff4a00', '#ff4600', '#ff4200', '#ff3f00', '#ff3b00', '#ff3700', '#ff3400', '#ff3000', '#ff2c00', '#ff2800', '#ff2500', '#ff2100', '#ff1d00', '#ff1a00', '#ff1600', '#fe1200', '#fa0f00', '#f50b00', '#f10700', '#ec0300', '#e80000', '#e30000', '#de0000', '#da0000', '#d50000', '#d10000', '#cc0000', '#c80000', '#c30000', '#bf0000', '#ba0000', '#b60000', '#b10000', '#ac0000', '#a80000', '#a30000', '#9f0000', '#9a0000', '#960000', '#910000', '#8d0000', '#880000', '#840000', '#7f0000'],\n    // ['#000000', '#00002b', '#010038', '#010043', '#02004e', '#030058', '#030063', '#04006e', '#050273', '#050474', '#060674', '#070974', '#070b74', '#080d74', '#091075', '#091275', '#0a1475', '#0b1675', '#0b1975', '#0c1b75', '#0d1d76', '#0d2076', '#0e2276', '#0f2476', '#0f2776', '#102977', '#112b77', '#112d77', '#123077', '#133277', '#133477', '#143678', '#153878', '#153a78', '#163c78', '#173e78', '#174079', '#184279', '#194579', '#194779', '#1a4979', '#1b4b79', '#1b4d7a', '#1c4f7a', '#1d517a', '#1d537a', '#1e547a', '#1f567b', '#1f587b', '#205a7b', '#215c7b', '#215e7b', '#22607b', '#23617c', '#23637c', '#24657c', '#25667c', '#25687c', '#26697d', '#276b7d', '#276d7d', '#286e7d', '#29707d', '#29717d', '#2a737e', '#2b747e', '#2b767e', '#2c787e', '#2d797e', '#2d7b7f', '#2e7c7f', '#2f7e7f', '#2f7f7f', '#30807e', '#30817d', '#31817b', '#31827a', '#328279', '#328378', '#338477', '#338475', '#348574', '#348573', '#358672', '#358670', '#36876f', '#36886e', '#37886d', '#37896c', '#38896a', '#388a69', '#388a68', '#398b67', '#398c65', '#3a8c64', '#3a8d63', '#3b8d62', '#3b8e61', '#3c8e5f', '#3c8f5e', '#3d905d', '#3d905c', '#3e915a', '#3e9159', '#3f9258', '#3f9357', '#409355', '#409454', '#409453', '#419552', '#419551', '#42964f', '#42974e', '#43974d', '#43984c', '#44984a', '#449949', '#459948', '#479a47', '#499b46', '#4b9b46', '#4e9c47', '#509c47', '#529d48', '#549d48', '#579e49', '#599f4a', '#5b9f4a', '#5da04b', '#5fa04b', '#62a14c', '#64a14d', '#66a24d', '#68a34e', '#6ba34e', '#6da34f', '#6fa44f', '#71a450', '#73a551', '#76a551', '#78a652', '#79a652', '#7ba752', '#7da752', '#7ea753', '#80a853', '#82a853', '#83a954', '#85a954', '#87aa54', '#88aa55', '#8aab55', '#8cab55', '#8dab56', '#8fac56', '#91ac56', '#92ad57', '#94ad57', '#96ae57', '#97ae58', '#99ae58', '#9aaf58', '#9caf58', '#9eb059', '#9fb059', '#a1b159', '#a3b15a', '#a4b25a', '#a6b25a', '#a8b25b', '#a9b35b', '#abb35b', '#adb45c', '#aeb45c', '#b0b55c', '#b2b55d', '#b3b55d', '#b5b65d', '#b6b65e', '#b7b55e', '#b7b55e', '#b8b45f', '#b8b35f', '#b9b25f', '#b9b15f', '#b9b060', '#baaf60', '#baaf60', '#bbae61', '#bbad61', '#bcac61', '#bcab62', '#bcaa62', '#bda962', '#bda963', '#bea863', '#bea763', '#bea664', '#bfa564', '#bfa464', '#c0a365', '#c0a367', '#c1a369', '#c2a36c', '#c3a46e', '#c5a471', '#c6a573', '#c7a676', '#c8a678', '#c9a77b', '#caa87d', '#cba97f', '#ccaa82', '#ceab84', '#cfac87', '#d0ad89', '#d1ad8c', '#d2ae8e', '#d3af91', '#d4b093', '#d5b196', '#d6b298', '#d8b39a', '#d9b59d', '#dab69f', '#dbb7a2', '#dcb9a4', '#ddbaa7', '#debca9', '#dfbdac', '#e1bfaf', '#e2c1b2', '#e3c3b5', '#e4c5b8', '#e5c7bb', '#e6c9be', '#e7cbc1', '#e8cdc4', '#e9cfc7', '#ebd1ca', '#ecd3cd', '#edd5d0', '#eed7d3', '#efd9d6', '#f0dcd9', '#f1dedc', '#f2e0df', '#f4e3e2', '#f5e6e5', '#f6e9e8', '#f7eceb', '#f8efee', '#f9f2f1', '#faf5f4', '#fbf8f7', '#fdfafa'],\n    // ['#000000', '#010101', '#020202', '#030303', '#040404', '#050505', '#060606', '#070707', '#080808', '#090909', '#0a0a0a', '#0b0b0b', '#0c0c0c', '#0d0d0d', '#0e0e0e', '#0f0f0f', '#101010', '#111111', '#121212', '#131313', '#141414', '#151515', '#161616', '#171717', '#181818', '#191919', '#1a1a1a', '#1b1b1b', '#1c1c1c', '#1d1d1d', '#1e1e1e', '#1f1f1f', '#202020', '#202020', '#222222', '#232323', '#242424', '#242424', '#262626', '#272727', '#282828', '#282828', '#2a2a2a', '#2b2b2b', '#2c2c2c', '#2c2c2c', '#2e2e2e', '#2f2f2f', '#303030', '#303030', '#323232', '#333333', '#343434', '#343434', '#363636', '#373737', '#383838', '#383838', '#3a3a3a', '#3b3b3b', '#3c3c3c', '#3c3c3c', '#3e3e3e', '#3f3f3f', '#404040', '#414141', '#414141', '#434343', '#444444', '#454545', '#464646', '#474747', '#484848', '#494949', '#494949', '#4b4b4b', '#4c4c4c', '#4d4d4d', '#4e4e4e', '#4f4f4f', '#505050', '#515151', '#515151', '#535353', '#545454', '#555555', '#565656', '#575757', '#585858', '#595959', '#595959', '#5b5b5b', '#5c5c5c', '#5d5d5d', '#5e5e5e', '#5f5f5f', '#606060', '#616161', '#616161', '#636363', '#646464', '#656565', '#666666', '#676767', '#686868', '#696969', '#696969', '#6b6b6b', '#6c6c6c', '#6d6d6d', '#6e6e6e', '#6f6f6f', '#707070', '#717171', '#717171', '#737373', '#747474', '#757575', '#767676', '#777777', '#787878', '#797979', '#797979', '#7b7b7b', '#7c7c7c', '#7d7d7d', '#7e7e7e', '#7f7f7f', '#808080', '#818181', '#828282', '#838383', '#838383', '#858585', '#868686', '#878787', '#888888', '#898989', '#8a8a8a', '#8b8b8b', '#8c8c8c', '#8d8d8d', '#8e8e8e', '#8f8f8f', '#909090', '#919191', '#929292', '#939393', '#939393', '#959595', '#969696', '#979797', '#989898', '#999999', '#9a9a9a', '#9b9b9b', '#9c9c9c', '#9d9d9d', '#9e9e9e', '#9f9f9f', '#a0a0a0', '#a1a1a1', '#a2a2a2', '#a3a3a3', '#a3a3a3', '#a5a5a5', '#a6a6a6', '#a7a7a7', '#a8a8a8', '#a9a9a9', '#aaaaaa', '#ababab', '#acacac', '#adadad', '#aeaeae', '#afafaf', '#b0b0b0', '#b1b1b1', '#b2b2b2', '#b3b3b3', '#b3b3b3', '#b5b5b5', '#b6b6b6', '#b7b7b7', '#b8b8b8', '#b9b9b9', '#bababa', '#bbbbbb', '#bcbcbc', '#bdbdbd', '#bebebe', '#bfbfbf', '#c0c0c0', '#c1c1c1', '#c2c2c2', '#c3c3c3', '#c3c3c3', '#c5c5c5', '#c6c6c6', '#c7c7c7', '#c8c8c8', '#c9c9c9', '#cacaca', '#cbcbcb', '#cccccc', '#cdcdcd', '#cecece', '#cfcfcf', '#d0d0d0', '#d1d1d1', '#d2d2d2', '#d3d3d3', '#d3d3d3', '#d5d5d5', '#d6d6d6', '#d7d7d7', '#d8d8d8', '#d9d9d9', '#dadada', '#dbdbdb', '#dcdcdc', '#dddddd', '#dedede', '#dfdfdf', '#e0e0e0', '#e1e1e1', '#e2e2e2', '#e3e3e3', '#e3e3e3', '#e5e5e5', '#e6e6e6', '#e7e7e7', '#e8e8e8', '#e9e9e9', '#eaeaea', '#ebebeb', '#ececec', '#ededed', '#eeeeee', '#efefef', '#f0f0f0', '#f1f1f1', '#f2f2f2', '#f3f3f3', '#f3f3f3', '#f5f5f5', '#f6f6f6', '#f7f7f7', '#f8f8f8', '#f9f9f9', '#fafafa', '#fbfbfb', '#fcfcfc', '#fdfdfd', '#fefefe', '#ffffff']\n    ],\n    normalize: function (idx) {\n      var grad = ColorscaleGradients.gradients[idx];\n      var len = grad.length - 1;\n      return grad.map(function (_, i) {\n        return [i / len, _];\n      });\n    }\n  };\n  return ColorscaleGradients;\n});","angular.module('countries-list', []).service('countries', function ($http) {\n  var countries;\n  return {\n    get: function (callback) {\n      if (countries) return callback(countries);\n      $http.get('/api/orders/countries').success(function (data) {\n        countries = data;\n        callback(countries);\n      });\n    }\n  };\n});","angular.module('humane', []).factory('notify', function ($window) {\n  var humane = $window.humane;\n  humane.timeout = 6000;\n  humane.baseCls = \"humane-original\";\n  humane.error = humane.spawn({\n    addnCls: humane.baseCls + '-error'\n  });\n  humane.info = humane.spawn({\n    addnCls: humane.baseCls + '-info'\n  });\n  humane.success = humane.spawn({\n    addnCls: humane.baseCls + '-success'\n  });\n\n  humane.serverError = function () {\n    humane.error(\"Error communicating with server\");\n  };\n\n  return humane;\n});","angular.module('a2.service.plotly-plot-maker', []).service('plotlyPlotMaker', function () {\n  var plotlyPlotMaker = {\n    range: function range(start, count, step) {\n      var _ = [];\n\n      for (var i = 0, x = start; i < count; ++i, x += step) {\n        _.push(x);\n      }\n\n      return _;\n    },\n    mergeData: function mergeData(data, defaults) {\n      return (data || []).map(function (datum) {\n        return angular.merge(angular.copy(defaults[datum.type] || {}), datum);\n      });\n    },\n    mergeLayout: function mergeLayout(layout, defaults) {\n      return angular.merge(angular.copy(defaults.layout), layout);\n    },\n    makeHeatmapPlot: function (x, y, z, data, title) {\n      var plot = {\n        data: {\n          type: 'heatmap',\n          hoverinfo: 'x+y+z',\n          colorbar: {\n            title: z.title\n          } // connectgaps:true,\n\n        },\n        layout: {\n          title: title,\n          xaxis: {\n            boundsmode: 'auto',\n            title: x.title,\n            ticksuffix: x.units || ''\n          },\n          yaxis: {\n            boundsmode: 'auto',\n            title: y.title,\n            ticksuffix: y.units || ''\n          }\n        }\n      };\n\n      if (data.rows) {\n        plot.data.x = data.rows.map(function (_) {\n          return data.x.min + data.x.step * _.x;\n        });\n        plot.data.y = data.rows.map(function (_) {\n          return data.y.min + data.y.step * _.y;\n        });\n        plot.data.z = data.rows.map(function (_) {\n          return _.z;\n        });\n      } else if (data.matrix) {\n        plot.data.x = plotlyPlotMaker.range(data.x.min, data.x.bins, data.x.step);\n        plot.data.y = plotlyPlotMaker.range(data.y.min, data.y.bins, data.y.step);\n        plot.data.z = data.matrix;\n      }\n\n      return plot;\n    },\n    makeBarPlot: function (x, y, data, title) {\n      var plot = {\n        data: {\n          orientation: 'v',\n          type: 'bar'\n        },\n        layout: {\n          title: title,\n          xaxis: {\n            boundsmode: 'auto',\n            title: x.title,\n            ticksuffix: x.units || ''\n          },\n          yaxis: {\n            boundsmode: 'auto',\n            title: y.title\n          }\n        }\n      };\n\n      if (data.rows) {\n        plot.data.x = data.rows.map(function (_) {\n          return data.x.min + data.x.step * _.x;\n        });\n        plot.data.y = data.rows.map(function (_) {\n          return _.z;\n        });\n      } else if (data.matrix) {\n        plot.data.x = plotlyPlotMaker.range(data.x.min, data.x.bins, data.x.step);\n        plot.data.y = data.matrix[0];\n      }\n\n      return plot;\n    }\n  };\n  return plotlyPlotMaker;\n});","angular.module('a2-plot-specs', ['a2.utils-browser-metrics']).factory('PlotSpecs', function (a2BrowserMetrics) {\n  return {\n    gutter: a2BrowserMetrics.scrollSize.height,\n    axis_sizew: 60,\n    axis_sizeh: 60,\n    legend_axis_w: 45,\n    legend_width: 60,\n    legend_gutter: 30,\n    axis_lead: 15\n  };\n});","angular.module('a2.service.plotly-defaults', ['a2-plot-specs', 'a2.service.colorscale-gradients']).provider('PlotlyDefaults', function () {\n  var PlotlyDefaults = {\n    defaults: {},\n    set: function (newDefaults, extend) {\n      if (extend) {\n        PlotlyDefaults.defaults = angular.merge(defaults, newDefaults);\n      } else {\n        PlotlyDefaults.defaults = newDefaults;\n      }\n    },\n    $get: function (PlotlyDefaultDefaults) {\n      return angular.merge(PlotlyDefaultDefaults, PlotlyDefaults.defaults);\n    }\n  };\n  return PlotlyDefaults;\n}).service('PlotlyDefaultDefaults', function (PlotSpecs, ColorscaleGradients) {\n  var defaults = {\n    titlefont: {\n      family: '\"Helvetica Neue\", Helvetica, Arial, sans-serif',\n      size: '14px'\n    },\n    tickfont: {\n      family: 'sans-serif',\n      size: '11px',\n      color: '#fff'\n    }\n  };\n  defaults.config = {\n    showLink: false,\n    sendData: false,\n    displaylogo: false,\n    displayModeBar: true,\n    scrollZoom: true,\n    modeBarButtonsToRemove: ['sendDataToCloud', 'autoScale2d']\n  };\n  defaults.layout = {\n    xaxis: {\n      titlefont: defaults.titlefont,\n      tickfont: defaults.tickfont,\n      color: '#fff'\n    },\n    yaxis: {\n      titlefont: defaults.titlefont,\n      tickfont: defaults.tickfont,\n      color: '#fff'\n    },\n    // margin:{l:70 + 25,r:0,b:25,t:50, pad:0},\n    plot_bgcolor: '#131525',\n    paper_bgcolor: '#131525',\n    dragmode: 'pan'\n  };\n  defaults.colorbar = {\n    tickfont: defaults.tickfont,\n    thickness: PlotSpecs.legend_width - PlotSpecs.legend_axis_w\n  };\n  defaults.heatmap = {\n    colorscale: ColorscaleGradients.normalize(0),\n    colorbar: defaults.colorbar\n  };\n  return defaults;\n});","angular.module('a2.url-update-service', []).factory('a2UrlUpdate', function () {\n  return {\n    cache: {},\n    prefix: '_t_',\n    clear: function () {\n      this.cache = {};\n    },\n    update: function (url) {\n      url = this.get(url);\n      var qidx = url.indexOf('?');\n      var url2;\n\n      var _t_ = new Date().getTime();\n\n      if (qidx >= 0) {\n        var re = new RegExp('(^|&)' + this.prefix + '=(\\\\d+)');\n        var query = url.substr(qidx + 1);\n        var m = re.exec(query);\n\n        if (m) {\n          url2 = url.substr(0, qidx) + '?' + query.replace(re, this.prefix + '=' + _t_);\n        } else {\n          url2 = url + '&' + this.prefix + '=' + _t_;\n        }\n      } else {\n        url2 = url + '?' + this.prefix + '=' + _t_;\n      }\n\n      this.cache[url] = url2;\n      $('[src=\"' + url + '\"]').attr('src', '').attr('src', url2);\n    },\n    get: function (url) {\n      var url2;\n\n      while (url2 = this.cache[url]) {\n        url = url2;\n      }\n\n      return url;\n    }\n  };\n}).filter('a2UpdatedUrl', function (a2UrlUpdate) {\n  return function (url) {\n    return a2UrlUpdate.get(url);\n  };\n});","angular.module('a2.orders.change-project-plan', ['a2.orders.order-utils', 'a2.orders.orders', 'ui.bootstrap', 'humane', 'a2.directives', 'a2.services']).controller('ChangeProjectPlanCtrl', function ($scope, orderData, Project, $window, a2order, $modalInstance, notify, a2orderUtils) {\n  $scope.today = new Date();\n  console.log(orderData);\n  $scope.recorderQty = orderData.recorderQty;\n  a2orderUtils.getOrdersContact().then(function (response) {\n    $scope.ordersContact = response.data;\n  });\n  a2orderUtils.paymentsStatus().then(function (response) {\n    $scope.autoPaymentsEnabled = response.data.payments_enable;\n  });\n  Project.getInfo(function (info) {\n    $scope.project = info;\n    $scope.currentPlan = {\n      storage: info.storage_limit,\n      processing: info.processing_limit,\n      duration: info.plan_period,\n      tier: info.tier,\n      activation: info.plan_activated,\n      creation: info.plan_created\n    };\n\n    if ($scope.currentPlan.activation && $scope.currentPlan.duration) {\n      var due = new Date($scope.currentPlan.activation);\n      due.setFullYear(due.getFullYear() + $scope.currentPlan.duration);\n      $scope.currentPlan.due = due;\n    }\n\n    if ($scope.currentPlan.due && $scope.currentPlan.due < $scope.today) {\n      $scope.mode = 'renew';\n    } else if ($scope.currentPlan.duration) {\n      $scope.mode = 'upgrade';\n    } else {\n      $scope.mode = 'new';\n    }\n\n    $scope.project.plan = orderData.project && orderData.project.plan || {};\n    Project.getUsage().success(function (usage) {\n      $scope.minUsage = usage.min_usage;\n    });\n  });\n\n  $scope.upgrade = function () {\n    if (!$scope.autoPaymentsEnabled) {\n      return notify.log('Payments are unavailable');\n    }\n\n    if ($scope.mode == 'renew') {\n      if ($scope.project.plan.storage < $scope.minUsage) {\n        notify.error('Please select a plan with more capacity or delete recordings from the project');\n        return;\n      }\n    } else {\n      if ($scope.currentPlan.storage && $scope.project.plan.storage - $scope.currentPlan.storage <= 0) {\n        notify.error('To upgrade select a plan with more capacity than the current');\n        return;\n      }\n    }\n\n    orderData = {\n      action: 'update-project',\n      project: $scope.project,\n      recorderQty: $scope.recorderQty,\n      mode: $scope.mode\n    };\n\n    if ($scope.recorderQty > 0 && $scope.project.plan.tier == 'paid') {\n      a2order.enterShippingAddress(orderData);\n    } else {\n      a2order.reviewOrder(orderData);\n    }\n\n    $modalInstance.dismiss();\n  };\n});","angular.module('a2.orders.create-project', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.plan-selection', 'a2.orders.project-order-service', 'ui.bootstrap', 'humane']).controller('CreateProjectCtrl', function ($scope, $http, $modalInstance, $modal, notify, a2order, orderData, a2orderUtils, ProjectOrderService) {\n  $scope.project = orderData.project;\n  $scope.recorderQty = orderData.recorderQty;\n  a2orderUtils.getOrdersContact().then(function (response) {\n    $scope.ordersContact = response.data;\n  });\n  a2orderUtils.paymentsStatus().then(function (response) {\n    $scope.autoPaymentsEnabled = response.data.payments_enable;\n  });\n\n  $scope.create = function () {\n    console.log($scope.isValid);\n\n    if (!$scope.isValid) {\n      return;\n    }\n\n    return ProjectOrderService.makeOrder('create-project', $scope.project, $scope.recorderQty, {\n      autoPaymentsEnabled: $scope.autoPaymentsEnabled\n    }).then(function (order) {\n      console.log(order); // if user added recorders to paid order show shipping address form\n\n      if (order.hasCoupon || !order.isPaidProject) {\n        return ProjectOrderService.placeOrder(order.data).then(function () {\n          return $modalInstance.close();\n        });\n      } else if (order.isPaidProject && order.data.recorderQty > 0) {\n        a2order.enterShippingAddress(order.data);\n        $modalInstance.dismiss();\n      } else {\n        a2order.reviewOrder(order.data);\n        $modalInstance.dismiss();\n      }\n    });\n  };\n});","angular.module('a2.orders.order-summary', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.project-order-service', 'ui.bootstrap', 'humane']).controller('OrderSummaryCtrl', function ($scope, $http, $modalInstance, orderData, notify, $window, a2order, a2orderUtils, ProjectOrderService) {\n  if (orderData.address) {\n    $scope.address = orderData.address;\n  }\n\n  $scope.type = orderData.mode == 'upgrade' ? 'upgrade' : 'new';\n  $scope.info = a2orderUtils.info;\n  $scope.shipping = orderData.shipping || 0;\n  $scope.project = orderData.project;\n  $scope.plan = orderData.project.plan;\n  $scope.recorderQty = orderData.recorderQty || 0;\n\n  $scope.changeItems = function () {\n    if (orderData.action == 'create-project') {\n      a2order.createProject(orderData);\n    } else {\n      a2order.changePlan(orderData);\n    }\n\n    $modalInstance.dismiss();\n  };\n\n  $scope.editAddress = function () {\n    a2order.enterShippingAddress(orderData);\n    $modalInstance.dismiss();\n  };\n\n  $scope.submit = function () {\n    $scope.waiting = true;\n    console.log(orderData);\n    return ProjectOrderService.placeOrder(orderData).then(function (data) {\n      console.log(data);\n\n      if (data.message) {\n        // if free project notify project was created\n        $modalInstance.close();\n      } else if (data.approvalUrl) {\n        // else redirect to paypal\n        $window.location.assign(data.approvalUrl);\n      }\n\n      $scope.waiting = false;\n    }).catch(function (err) {\n      $scope.waiting = false;\n    });\n  };\n});","angular.module('a2.orders.order-utils', []).service('a2orderUtils', function ($http) {\n  return {\n    /**\n        receives a plan activation date and duration period, and calculates \n        how many month are left until the plan is due\n        @param [Date] acticationDate\n        @param [Number] period\n    */\n    monthsUntilDue: function (acticationDate, period) {\n      var d = new Date(acticationDate);\n      var totalMonths = period * 12;\n      var today = new Date();\n      var currentMonth;\n\n      for (var i = 0; i <= totalMonths; i++) {\n        var month = new Date(d.getFullYear(), d.getMonth() + i, d.getDate());\n\n        if (today <= month) {\n          currentMonth = i - 1;\n          break;\n        }\n      }\n\n      return totalMonths - currentMonth;\n    },\n    paymentsStatus: function () {\n      return $http.get('/api/orders/payments-status', {\n        cache: true\n      });\n    },\n    checkCouponCode: function (code, project) {\n      return $http.post('/api/orders/check-coupon', {\n        hash: code,\n        project: project\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    getOrdersContact: function () {\n      return $http.get('/api/orders/contact', {\n        cache: true\n      });\n    },\n    info: {\n      recorder: {\n        name: 'Arbimon Recorder',\n        description: \"includes an Android device preset for acoustic monitoring, \" + \"waterproof case(IP67), microphone, 6500mAh lithium-ion battery \" + \"and USB charger\",\n        priceWithPlan: 125,\n        priceNoPlan: 300\n      },\n      plan: {\n        new: {\n          name: \"Project data plan\",\n          description: function (plan) {\n            return \"includes storage for \" + plan.storage + \" minutes of audio \" + \"and capacity to process \" + plan.processing + \" minutes of audio \" + \"per year, for a term of \" + plan.duration + \" year(s)\";\n          }\n        },\n        upgrade: {\n          name: \"Project data plan upgrade\",\n          description: function (plan) {\n            return \"upgrade your plan storage to \" + plan.storage + \" minutes of audio \" + \"and capacity to process \" + plan.processing + \" minutes of audio \" + \"per year, until this plan due\";\n          }\n        }\n      }\n    }\n  };\n});","angular.module('a2.orders.orders', ['a2.orders.create-project', 'a2.orders.change-project-plan', 'a2.orders.shipping-form', 'a2.orders.order-summary', 'ui.bootstrap']).service('a2order', function ($modal) {\n  var formOpener = function (orderData, view) {\n    var modalOptions = {\n      resolve: {\n        orderData: function () {\n          return orderData;\n        }\n      },\n      backdrop: 'static',\n      templateUrl: view.templateUrl,\n      controller: view.controller\n    };\n    return $modal.open(modalOptions);\n  };\n\n  return {\n    createProject: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/create-project.html',\n        controller: 'CreateProjectCtrl'\n      });\n      return modalInstance;\n    },\n    changePlan: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/change-plan.html',\n        controller: 'ChangeProjectPlanCtrl'\n      });\n      return modalInstance;\n    },\n    enterShippingAddress: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/shipping-address.html',\n        controller: 'ShippingFormCtrl'\n      });\n      return modalInstance;\n    },\n    reviewOrder: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/order-summary.html',\n        controller: 'OrderSummaryCtrl'\n      });\n      return modalInstance;\n    }\n  };\n});","angular.module('a2.orders.directives.plan-capacity', ['a2.orders.plan-selection', 'countries-list', 'ui.bootstrap', 'humane', 'a2.directives', 'a2.services']).directive('planCapacity', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'disabled': '=',\n      'minutes': '='\n    },\n    templateUrl: '/orders/plan-capacity.html',\n    link: function (scope, element, attrs) {\n      if (!attrs.enabled) {\n        scope.enabled = true;\n      }\n    }\n  };\n});","angular.module('a2.orders.plan-selection', ['countries-list', 'ui.bootstrap', 'humane', 'a2.orders.directives.plan-capacity', 'a2.orders.directives.tier-select', 'a2.directives', 'a2.services']).controller('PlanSelectionCtrl', function ($scope, a2orderUtils) {\n  const freePlan = {\n    // Changes must be matched in app/model/projects.js\n    tier: 'free',\n    cost: 0,\n    storage: 100000,\n    processing: 10000000\n  };\n  this.coupon = {\n    code: '',\n    validation: null\n  };\n\n  this.checkCouponCode = function () {\n    if (this.coupon.code) {\n      this.coupon.validation = {\n        class: 'fa fa-spinner fa-spin'\n      };\n      delete this.coupon.payload;\n      delete $scope.plan.coupon;\n      return a2orderUtils.checkCouponCode(this.coupon.code, this.project).then(function (code) {\n        if (code.valid) {\n          $scope.plan.coupon = code;\n          this.coupon.payload = code.payload;\n          this.coupon.validation = {\n            valid: true,\n            class: 'fa fa-check text-success'\n          };\n        } else {\n          this.coupon.validation = {\n            valid: false,\n            class: 'fa fa-times text-danger'\n          };\n        }\n      }.bind(this), function () {\n        this.coupon.validation = {\n          valid: false,\n          class: 'fa fa-times text-danger'\n        };\n      }.bind(this));\n    } else {\n      delete this.coupon.validation;\n    }\n  };\n\n  $scope.plan = freePlan;\n  $scope.recorderOptions = 0;\n  $scope.planMinutes = $scope.planMinutes || freePlan.storage;\n  $scope.planYears = $scope.planYears || 1;\n  $scope.upgradeOnly = false;\n  $scope.recorderQty = $scope.recorderQty || 0;\n  console.log($scope.plan);\n  this.hasCouponCode = false;\n  this.planData = {\n    yearOptions: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n  };\n  $scope.$watch('currentPlan', function () {\n    if (!$scope.currentPlan) return;\n    var due = new Date($scope.currentPlan.activation);\n    due.setFullYear(due.getFullYear() + $scope.currentPlan.duration);\n    $scope.planYears = $scope.currentPlan.duration || 1;\n    $scope.planMinutes = $scope.currentPlan.storage >= freePlan.storage ? $scope.currentPlan.storage : freePlan.storage;\n\n    if ($scope.currentPlan.tier == 'paid' && (!$scope.currentPlan.activation || new Date() < due)) {\n      $scope.upgradeOnly = true;\n      $scope.plan.tier = 'paid';\n    }\n  });\n  $scope.$watch('plan', function (value) {\n    if ($scope.plan) {\n      if ($scope.plan.storage) $scope.planMinutes = $scope.plan.storage;\n      if ($scope.plan.duration) $scope.planYears = $scope.plan.duration;\n    }\n  });\n  $scope.$watch('plan.tier', function (value) {\n    if (!$scope.plan) return;\n\n    if ($scope.plan.tier == 'paid') {\n      $scope.plan.cost = $scope.planMinutes * 0.03 * $scope.planYears;\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n      console.log($scope.plan);\n    } else if ($scope.plan.tier == 'free') {\n      $scope.plan.cost = freePlan.cost;\n      $scope.plan.storage = freePlan.storage;\n      $scope.plan.processing = freePlan.processing;\n      $scope.plan.duration = undefined;\n    }\n  });\n\n  var updatePlan = function () {\n    $scope.plan = $scope.plan || {};\n\n    if ($scope.upgradeOnly) {\n      if ($scope.currentPlan.storage > $scope.planMinutes) {\n        $scope.planMinutes = $scope.currentPlan.storage;\n      }\n\n      var planStarts = $scope.currentPlan.activation || $scope.currentPlan.creation;\n      var monthsLeft = a2orderUtils.monthsUntilDue(planStarts, $scope.currentPlan.duration);\n      console.log('planStarts', planStarts);\n      console.log('monthsLeft', monthsLeft);\n      $scope.plan.cost = ($scope.planMinutes - $scope.currentPlan.storage) * monthsLeft * (0.03 / 12);\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n    } else {\n      if ($scope.usage && $scope.usage > $scope.planMinutes) {\n        $scope.planMinutes = Math.ceil($scope.usage / 5000) * 5000;\n      }\n\n      $scope.plan.cost = $scope.planMinutes * $scope.planYears * 0.03;\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n      var recorderCap = Math.floor($scope.planMinutes / 10000) * $scope.planYears;\n      $scope.recorderQty = $scope.recorderQty || 0;\n\n      if ($scope.recorderQty > recorderCap) {\n        $scope.recorderQty = recorderCap;\n      }\n\n      $scope.recorderOptions = new Array(recorderCap + 1);\n    }\n  };\n\n  this.updatePlan = updatePlan;\n  $scope.$watch('planMinutes', updatePlan);\n  $scope.$watch('planYears', updatePlan);\n}).directive('planSelect', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'project': '=',\n      'plan': '=',\n      'recorderQty': '=',\n      'availablePlans': '=',\n      'ordersContact': '=',\n      'autoPaymentsEnabled': '=',\n      'currentPlan': '=?',\n      'usage': '=?'\n    },\n    templateUrl: '/orders/select-plan.html',\n    controller: 'PlanSelectionCtrl as controller',\n    link: function (scope, element, attrs, controller) {\n      scope.$watch('project', function (project) {\n        controller.project = project;\n      });\n    }\n  };\n});","angular.module('a2.orders.process-order', []).controller('ProcessOrderCtrl', function ($scope, $http, $window, $location) {\n  var reOrderId = /\\/process-order\\/([\\w\\-\\d]+)/;\n  var result = reOrderId.exec($window.location.pathname);\n  var orderId = result !== null ? result[1] : '';\n  console.log('orderId:', orderId);\n  $scope.processing = true;\n  $http.post('/api/orders/process/' + orderId + $window.location.search).success(function (data) {\n    console.log('data', data);\n    $scope.invoice = {\n      items: data.invoice.item_list.items,\n      amount: data.invoice.amount,\n      number: data.orderNumber,\n      user: data.user\n    };\n\n    if (data.invoice.item_list.shipping_address) {\n      $scope.invoice.address = data.invoice.item_list.shipping_address;\n    }\n\n    $scope.action = data.action;\n    $scope.processing = false;\n    $scope.success = true;\n  }).error(function (data, status) {\n    if (status == 404) {\n      $scope.notFound = true;\n    } else if (status == 400 && data.error == 'APPROVAL_NEEDED') {\n      $scope.needApproval = true;\n      $scope.approvalLink = data.approvalLink;\n    } else if (status == 400 && data.error == 'ALREADY_PROCESSED') {\n      $scope.alreadyProcessed = true;\n    } else {\n      $scope.errorOcurred = true;\n    }\n\n    $scope.processing = false;\n  });\n});","angular.module('a2.orders.project-order-service', ['humane']).factory(\"ProjectOrderService\", function ($q, $filter, $http, notify) {\n  var currencyFilter = $filter('currency');\n  var ProjectOrderService = {\n    placeOrder: function (orderData) {\n      if (!/(create|update)-project/.test(orderData.action)) {\n        return $q.reject(\"Invalid action \" + orderData.action);\n      }\n\n      var data = angular.merge({}, orderData);\n      delete data.action;\n      return $http.post('/api/orders/' + orderData.action, orderData).then(function (response) {\n        var data = response.data; // notify any succesfull messages\n\n        if (data.message) {\n          notify.log(data.message);\n        }\n\n        return data;\n      }).catch(function (response) {\n        var err = response.data;\n        console.log(\"err\", err);\n        console.log(\"err resp\", response);\n\n        if (err) {\n          if (err.freeProjectLimit) {\n            notify.error('You already have own a free project, ' + 'the limit is one per user.');\n          } else if (err.nameExists) {\n            notify.error('Name <b>' + orderData.project.name + '</b> not available.');\n          } else if (err.urlExists) {\n            notify.error('URL <b>' + orderData.project.url + '</b> is taken, choose another one.');\n          } else {\n            notify.serverError();\n          }\n        }\n\n        throw err;\n      });\n    },\n    makeOrder: function (action, project, recorderQty, settings) {\n      console.log(\"makeOrder\", action, project, recorderQty, settings);\n\n      if (!project || !project.plan) {\n        return $q.reject(new Error('You need to select a plan'));\n      }\n\n      var isPaidProject = project.plan.tier == 'paid';\n      var coupon = project.plan.coupon && project.plan.coupon.valid ? project.plan.coupon : undefined;\n      settings.recorderCost = settings.recorderCost || 125;\n      settings.projectCostLimit = settings.projectCostLimit || 10000;\n\n      if (coupon) {\n        project = angular.merge({}, project);\n        delete project.plan;\n      } else if (isPaidProject) {\n        if (!settings.autoPaymentsEnabled) {\n          return $q.reject(new Error('Payments are unavailable'));\n        } // don't process orders over $10,000\n\n\n        if (project.plan.cost + recorderQty * settings.recorderCost > settings.projectCostLimit) {\n          return $q.reject(new Error('Cannot process order greater than ' + currencyFilter(settings.projectCostLimit)));\n        }\n      }\n\n      return $q.resolve({\n        hasCoupon: !!coupon,\n        isPaidProject: isPaidProject,\n        data: {\n          action: action,\n          coupon: coupon ? coupon.hash : undefined,\n          project: project,\n          recorderQty: recorderQty\n        }\n      });\n    }\n  };\n  return ProjectOrderService;\n});","angular.module('a2.orders.shipping-form', ['a2.orders.orders', 'countries-list', 'ui.bootstrap']).controller('ShippingFormCtrl', function ($scope, $http, $modalInstance, $modal, orderData, countries, a2order) {\n  if (!orderData.address) {\n    $http.get('/api/user/address').success(function (data) {\n      $scope.address = data.address || {};\n    });\n  } else {\n    $scope.address = orderData.address;\n  }\n\n  countries.get(function (data) {\n    $scope.countries = data;\n  });\n\n  $scope.verify = function () {\n    // TODO this method should validate form and call server to get shipping cost\n    $http.post('/api/orders/calculate-shipping', {\n      address: $scope.address,\n      recorderQty: orderData.recorderQty\n    }).success(function (data) {\n      orderData.shipping = data.shipping_cost;\n      orderData.address = data.address;\n      a2order.reviewOrder(orderData);\n      $modalInstance.dismiss();\n    });\n  };\n});","angular.module('a2.orders.directives.tier-select', []).directive('tierSelect', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'tier': '=',\n      'disableFree': '='\n    },\n    templateUrl: '/orders/tier-select.html'\n  };\n});","angular.module('a2.utils.external-api-loader', ['a2.utils.global-anonymous-function']).provider('externalApiLoader', function () {\n  var externalApiLoaderProvider = {\n    apis: {},\n    defaults: {\n      getCachedModule: [\"$window\", function ($window) {\n        return $window[this.def.namespace];\n      }],\n      loader: [\"$window\", \"$q\", \"globalAnonymousFunction\", function ($window, $q, globalAnonymousFunction) {\n        var api = this;\n        return $q(function (resolve, reject) {\n          var url = api.def.url;\n          var script = $window.document.createElement('script');\n          angular.element($window.document.head).append(script);\n\n          if (api.def.jsonpCallback) {\n            url += (/\\?/.test(url) ? '&' : '?') + api.def.jsonpCallback + '=' + globalAnonymousFunction(resolve, {\n              oneTime: true\n            }).id;\n          } else {\n            script.onload = resolve;\n          }\n\n          script.onerror = function () {\n            reject();\n          };\n\n          script.src = url;\n        });\n      }]\n    },\n    addApi: function (apiName, def) {\n      externalApiLoaderProvider.apis[apiName] = {\n        name: apiName,\n        def: angular.extend({}, externalApiLoaderProvider.defaults, def)\n      };\n    },\n    $get: function ($q, $injector) {\n      var externalApiLoader = {\n        load: function (apiName) {\n          var api = externalApiLoaderProvider.apis[apiName];\n\n          if (!api) {\n            return $q.reject(\"Cannot load unconfigured external api \" + apiName);\n          }\n\n          if (!api.module) {\n            api.module = $injector.invoke(api.def.getCachedModule, api);\n          }\n\n          if (!api.promise) {\n            if (api.module) {\n              api.promise = $q.resolve(api.module);\n            } else {\n              api.promise = $q.resolve();\n\n              if (api.def.parent) {\n                api.promise = api.promise.then(function () {\n                  return externalApiLoader.load(api.def.parent);\n                }).then(function () {\n                  api.parent = externalApiLoaderProvider.apis[api.def.parent];\n                });\n              }\n\n              api.promise = api.promise.then(function () {\n                return $injector.invoke(api.def.loader, api);\n              }).then(function () {\n                api.module = $injector.invoke(api.def.getCachedModule, api);\n              }).then(function () {\n                if (api.def.onload) {\n                  return $injector.invoke(api.def.onload, api);\n                }\n              }).then(function () {\n                return api.module;\n              });\n            }\n          }\n\n          return api.promise;\n        }\n      };\n      return externalApiLoader;\n    }\n  };\n  return externalApiLoaderProvider;\n});","angular.module('a2.utils.global-anonymous-function', []).factory('globalAnonymousFunction', function ($window) {\n  var ct = 0;\n  return function (fn, options) {\n    // console.log(\"return function(fn, options)\", fn, options);\n    var wrapperFn = function () {\n      if (options && options.oneTime) {\n        wrapperFn.remove();\n      }\n\n      fn.apply(this, Array.prototype.slice.call(arguments));\n    };\n\n    wrapperFn.id = '__g_a_f_' + ct++;\n    $window[wrapperFn.id] = wrapperFn;\n\n    wrapperFn.remove = function () {\n      if ($window[wrapperFn.id] == wrapperFn) {\n        delete $window[wrapperFn.id];\n      }\n    };\n\n    return wrapperFn;\n  };\n});","angular.module('a2.utils.q-promisify', []).factory('$qPromisify', function ($q) {\n  function $qPromisify()\n  /*fn, ...args*/\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var fn = args.shift();\n    return $q(function (resolve, reject) {\n      args.push(function (err, value) {\n        if (err) {\n          reject();\n        } else {\n          resolve(value);\n        }\n      });\n      fn.apply(null, args);\n    });\n  }\n\n  $qPromisify.invoke = function ()\n  /*object, method, ...args*/\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var object = args.shift();\n    var method = args.shift();\n    return $qPromisify(function (cb) {\n      args.push(cb);\n      object[method].apply(object, args);\n    });\n  };\n\n  return $qPromisify;\n});","angular.module('a2.admin.jobs', ['ui.router', 'templates-arbimon2']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('jobs', {\n    url: '/jobs',\n    controller: 'AdminJobsCtrl',\n    templateUrl: '/admin/jobs/index.html'\n  });\n}).controller('AdminJobsCtrl', function ($scope, $http, $interval, Project) {\n  var getJobQueueInfo = function (argument) {\n    $http.get('/admin/job-queue').success(function (data) {\n      $scope.jobsStatus = data;\n    });\n  };\n\n  $scope.findJobs = function () {\n    var query = {};\n    var getTags = /(\\w+):[\"'](.+)[\"']|(\\w+):([\\w\\-]+)/g;\n\n    if ($scope.params.search) {\n      // iterate over getTags results\n      $scope.params.search.replace(getTags, function (match, key1, value1, key2, value2) {\n        // key1 matches (\\w+):[\"'](.+)[\"']\n        // key2 matches (\\w+):([\\w\\-]+)\n        var key = key1 ? key1 : key2;\n        var value = value1 ? value1 : value2;\n        if (!query[key]) query[key] = [];\n        query[key].push(value);\n      });\n    }\n\n    if ($scope.params.states) {\n      query.states = $scope.params.states.map(function (s) {\n        return s.name;\n      });\n    }\n\n    if ($scope.params.types) {\n      query.types = $scope.params.types.map(function (t) {\n        return t.id;\n      });\n    }\n\n    $http.get('/admin/jobs', {\n      params: query\n    }).success(function (data) {\n      $scope.activeJobs = data; // console.log(query);\n    });\n  };\n\n  $scope.initParams = function () {\n    $scope.params = {\n      search: \"is:visible \"\n    };\n  };\n\n  $scope.job_types = [];\n  $scope.states = [{\n    name: 'waiting',\n    color: 'black',\n    show: true\n  }, {\n    name: 'initializing',\n    color: 'blue',\n    show: true\n  }, {\n    name: 'ready',\n    color: '#007777',\n    show: true\n  }, {\n    name: 'processing',\n    color: 'olive',\n    show: true\n  }, {\n    name: 'completed',\n    color: 'green',\n    show: false\n  }, {\n    name: 'error',\n    color: 'red',\n    show: true\n  }, {\n    name: 'canceled',\n    color: 'gray',\n    show: false\n  }, {\n    name: 'stalled',\n    color: 'gray',\n    show: false\n  }];\n  $scope.initParams();\n  getJobQueueInfo();\n  $http.get('/api/jobs/types').success(function (jobTypes) {\n    var colors = ['#1482f8', '#df3627', '#40af3b', '#9f51bf', '#d37528'];\n    $scope.colors = {};\n\n    for (var i = 0; i < jobTypes.length; i++) {\n      var t = jobTypes[i];\n      $scope.colors[t.name] = colors[i % colors.length];\n    }\n\n    $scope.job_types = jobTypes;\n  });\n  $scope.findJobs();\n});","angular.module('a2.admin.users.list', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'humane', 'ui.select']) // .config(function($stateProvider, $urlRouterProvider) {\n//     $stateProvider\n//         .state('users.list', {\n//             url: '',\n//             controller:'AdminUsersListCtrl',\n//             templateUrl: '/admin/users/list.html'\n//         });\n// \n// })\n// .controller('AdminUsersCtrl', function($scope, $http) {\n//     $http.get('/admin/users')\n//         .success(function(data) {\n//             $scope.users = data;\n//         });\n// })\n.service('AdminUsersListService', function ($http) {\n  return {\n    getList: function () {\n      return $http.get('/admin/users').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.admin.projects.codes', ['ui.router', 'a2.directives', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'humane', 'ui.select', 'a2.admin.projects.list', 'a2.admin.users.list']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('projects.codes', {\n    url: '/codes',\n    controller: 'AdminProjectsCodesCtrl as controller',\n    templateUrl: '/admin/projects/codes.html'\n  });\n}).controller('AdminProjectsCodesCtrl', function ($modal, notify, LoaderFactory, AdminProjectsCodesService) {\n  var loader = LoaderFactory.newInstance();\n  this.loader = loader;\n\n  this.createNewCode = function () {\n    return $modal.open({\n      templateUrl: '/admin/projects/new-code-modal.html',\n      resolve: {\n        projectsList: function (AdminProjectsListService) {\n          return AdminProjectsListService.getList();\n        },\n        usersList: function (AdminUsersListService) {\n          return AdminUsersListService.getList();\n        }\n      },\n      controller: function (projectsList, usersList) {\n        this.projectsList = projectsList;\n        this.usersList = usersList;\n        this.data = {\n          lockToUser: undefined,\n          lockProject: undefined,\n          duration: 1,\n          recordings: 10000,\n          processing: 1000000,\n          tieProcessingWithRecordings: true\n        };\n\n        this.computeProcessingAmount = function () {\n          if (this.data.tieProcessingWithRecordings) {\n            this.data.processing = this.data.recordings * 100;\n          }\n        };\n\n        this.processingCountChanged = function () {\n          this.data.tieProcessingWithRecordings = false;\n        };\n      },\n      controllerAs: 'popup'\n    }).result.then(AdminProjectsCodesService.createNewCode).then(function () {\n      loader.load(this, 'codes', AdminProjectsCodesService.loadCodes());\n    }.bind(this));\n  };\n\n  this.showHash = function (code) {\n    return $modal.open({\n      templateUrl: '/admin/projects/view-hash.html',\n      resolve: {\n        code: function () {\n          return code;\n        }\n      },\n      controller: function (code) {\n        this.code = code;\n      },\n      controllerAs: 'popup'\n    });\n  }; // editSelectedCode\n  // deleteSelectedCode\n\n\n  loader.load(this, 'codes', AdminProjectsCodesService.loadCodes());\n}).service('AdminProjectsCodesService', function ($http) {\n  return {\n    loadCodes: function () {\n      return $http.get('/admin/projects/codes').then(function (response) {\n        return response.data;\n      });\n    },\n    createNewCode: function (data) {\n      console.log(\"createNewCode\", data);\n      return $http.post('/admin/projects/codes', {\n        user: data.lockToUser && data.lockToUser.id,\n        project: data.lockProject && data.lockProject.id,\n        recordings: data.recordings,\n        duration: data.duration,\n        processing: data.processing\n      }).then(function (data) {\n        return data.response;\n      });\n    }\n  };\n}).factory('LoaderFactory', function ($q) {\n  function Loader() {\n    this.loading = {};\n  }\n\n  Loader.prototype = {\n    load: function (valueStore, key, promise) {\n      this.loading[key] = true;\n      return promise.then(function (value) {\n        this.loading[key] = false;\n\n        if (valueStore) {\n          valueStore[key] = value;\n        }\n\n        return value;\n      }.bind(this), function (err) {\n        this.loading[key] = false;\n        throw err;\n      }.bind(this));\n    }\n  };\n  return {\n    newInstance: function () {\n      return new Loader();\n    }\n  };\n});","angular.module('a2.admin.projects', ['ui.router', 'templates-arbimon2', 'a2.admin.projects.list', 'a2.admin.projects.codes']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('projects', {\n    url: '/projects',\n    abstract: true,\n    templateUrl: '/admin/projects/index.html'\n  });\n});","angular.module('a2.admin.projects.list', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'a2.orders.directives.tier-select', 'humane', 'ui.select']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('projects.list', {\n    url: '',\n    controller: 'AdminProjectsListCtrl as controller',\n    templateUrl: '/admin/projects/list.html'\n  }).state('projects.list.detail', {\n    url: '/:url',\n    views: {\n      'detail': {\n        templateUrl: '/admin/projects/list-detail.html',\n        controller: 'AdminProjectsListDetailCtrl as controller'\n      }\n    }\n  });\n}).controller('AdminProjectsListCtrl', function ($scope, $state, AdminProjectsListService) {\n  this.initialize = function () {\n    AdminProjectsListService.getList().then(function (data) {\n      this.projects = data;\n\n      if ($state.params.url) {\n        var url = $state.params.url;\n        this.selected = this.projects.reduce(function (_, project) {\n          return project.url == url ? project : _;\n        }, null);\n      }\n    }.bind(this));\n  };\n\n  this.select = function (project) {\n    return $state.go('projects.list.detail', {\n      url: project.url\n    });\n  };\n\n  this.notifyProjectUpdated = function (project) {\n    var projectObject = this.projects.reduce(function (_, p, $index) {\n      return p.project_id == project.project_id ? project : _;\n    }, null);\n    angular.merge(projectObject, project);\n  };\n\n  this.initialize();\n}).controller('AdminProjectsListDetailCtrl', function ($scope, $state, $q, notify, AdminProjectsListService) {\n  this.initialize = function () {\n    console.log(\"$state\", $state);\n    this.setProject({\n      url: $state.params.url\n    });\n  };\n\n  this.setProject = function (projectData) {\n    return $q.all([AdminProjectsListService.getProjectInfo(projectData), AdminProjectsListService.getProjectSites(projectData), AdminProjectsListService.getProjectRecordingCount(projectData)]).then(function (all) {\n      this.project = all[0];\n      this.project.is_enabled = this.project.is_enabled | 0;\n      this.sites = all[1];\n      this.recCount = all[2];\n    }.bind(this));\n  };\n\n  this.close = function () {\n    $state.go('projects.list');\n  };\n\n  this.save = function () {\n    return AdminProjectsListService.updateProject(this.project).then(function (project) {\n      this.project = project;\n      notify.log(\"Project \" + project.name + \" info updated.\");\n    }.bind(this)).catch(function (err) {\n      notify.error(err);\n    });\n  };\n\n  this.handleAedToggle = function () {\n    this.project.clustering_enabled = this.project.aed_enabled;\n  };\n\n  this.initialize();\n}).service('AdminProjectsListService', function ($http) {\n  return {\n    getList: function () {\n      return $http.get('/admin/projects').then(function (response) {\n        return response.data;\n      });\n    },\n    getProjectInfo: function (project) {\n      return $http.get('/api/project/' + project.url + '/info').then(function (response) {\n        var data = response.data;\n        data.is_enabled = !!data.is_enabled;\n        return data;\n      });\n    },\n    getProjectSites: function (project) {\n      return $http.get('/api/project/' + project.url + '/sites').then(function (response) {\n        return response.data;\n      });\n    },\n    getProjectRecordingCount: function (project) {\n      return $http.get('/api/project/' + project.url + '/recordings/count').then(function (response) {\n        return response.data.count;\n      });\n    },\n    updateProject: function (project) {\n      var projectData = {\n        project_id: project.project_id,\n        name: project.name,\n        url: project.url,\n        description: project.description,\n        project_type_id: project.project_type_id,\n        is_private: project.is_private,\n        is_enabled: project.is_enabled,\n        current_plan: project.current_plan,\n        storage_usage: project.storage_usage,\n        processing_usage: project.processing_usage,\n        citizen_scientist_enabled: !!project.citizen_scientist_enabled,\n        cnn_enabled: !!project.cnn_enabled,\n        pattern_matching_enabled: !!project.pattern_matching_enabled,\n        aed_enabled: !!project.aed_enabled,\n        clustering_enabled: !!project.clustering_enabled,\n        reports_enabled: !!project.reports_enabled,\n        plan: {\n          tier: project.tier,\n          storage: project.storage_limit,\n          processing: project.processing_limit,\n          activation: project.plan_activated,\n          duration_period: project.plan_period\n        }\n      };\n      return $http.put('/admin/projects/' + project.project_id, {\n        project: projectData\n      }).then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.admin.dashboard.data-service', []).service('AdminDashboardDataService', function ($q) {\n  return {\n    getPlotData: function (series, from, to, period) {\n      return $q.when('/admin/plot-data/data.txt?stat=' + series + '&q=' + period + '&from=' + from.getTime() + '&to=' + to.getTime());\n    }\n  };\n});","angular.module('a2.admin.dashboard', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'a2.directives', 'templates-arbimon2', 'humane', 'ui.select', 'a2.admin.dashboard.data-service', 'a2.admin.dashboard.plotter-controller']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('dashboard', {\n    url: '/dashboard',\n    controller: 'AdminDashboardCtrl as controller',\n    templateUrl: '/admin/dashboard/index.html'\n  });\n}).controller('AdminDashboardCtrl', function ($scope, $http, $q, $controller) {\n  $scope.plots = $controller('AdminDashboardPlotterController', {\n    '$scope': $scope\n  });\n\n  $scope.UserStatsExport = function () {\n    $http.get('/admin/all-users').success(function (data) {\n      download(data);\n    });\n  };\n\n  $http.get('/admin/dashboard-stats').success(function (data) {\n    $scope.newUsers = data.newUsers;\n    $scope.newProjects = data.newProjects;\n    $scope.Jobs = data.jobsStatus;\n    $scope.allUsers = data.allUsers;\n    $scope.allSites = data.allSites;\n    $scope.allProjects = data.allProjects;\n    $scope.newSites = data.newSites;\n  });\n\n  $scope.getSystemSettings = function () {\n    $http.get('/admin/system-settings').success(function (data) {\n      $scope.settings = data;\n    });\n  };\n\n  $scope.getSystemSettings();\n\n  $scope.setSetting = function (setting, value) {\n    var d = $q.defer();\n\n    if (!setting) {\n      d.resolve();\n    } else {\n      $http.put('/admin/system-settings', {\n        setting: setting,\n        value: value\n      }).success(function (data) {\n        $scope.getSystemSettings();\n        d.resolve(data[setting]);\n      }).error(function (data) {\n        console.error(data);\n        $scope.getSystemSettings();\n        d.reject(data);\n      });\n    }\n\n    return d.promise;\n  };\n\n  $scope.toggleSetting = function (setting) {\n    var value = $scope.settings[setting] == 'on' ? 'off' : 'on';\n    return this.setSetting(setting, value);\n  };\n\n  function convertToCSV(objArray) {\n    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;\n    var str = '';\n\n    for (var i = 0; i < array.length; i++) {\n      var line = '';\n\n      for (var index in array[i]) {\n        if (line != '') line += ',';\n        line += array[i][index];\n      }\n\n      str += line + '\\r\\n';\n    }\n\n    return str;\n  }\n\n  function exportCSVFile(headers, items, fileTitle) {\n    if (headers) {\n      items.unshift(headers);\n    } // Convert Object to JSON\n\n\n    var jsonObject = JSON.stringify(items);\n    var csv = convertToCSV(jsonObject);\n    var exportedFilenmae = fileTitle + '.csv' || 'export.csv';\n    var blob = new Blob([csv], {\n      type: 'text/csv;charset=utf-8;'\n    });\n\n    if (navigator.msSaveBlob) {\n      // IE 10+\n      navigator.msSaveBlob(blob, exportedFilenmae);\n    } else {\n      var link = document.createElement(\"a\");\n\n      if (link.download !== undefined) {\n        var url = URL.createObjectURL(blob);\n        link.setAttribute(\"href\", url);\n        link.setAttribute(\"download\", exportedFilenmae);\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    }\n  }\n\n  function download(data) {\n    var headers = {\n      name: 'Name',\n      email: \"Email\"\n    };\n    var itemsFormatted = []; // format the data\n\n    data.forEach(function (item) {\n      itemsFormatted.push({\n        name: item.firstname + \" \" + item.lastname,\n        email: item.email\n      });\n    });\n    exportCSVFile(headers, itemsFormatted, 'users');\n  }\n});","angular.module('a2.admin.dashboard.plotter-controller', ['templates-arbimon2', 'a2.admin.dashboard.data-service', 'a2.directive.plotly-plotter']).controller('AdminDashboardPlotterController', function ($scope, $window, $q, AdminDashboardDataService) {\n  function mk_time_range_fn(from, delta) {\n    return function () {\n      var fromdt = from == 'now' ? new Date() : new Date(from);\n      var todt = new Date(fromdt.getTime() + delta);\n\n      if (delta < 0) {\n        var t = fromdt;\n        fromdt = todt;\n        todt = t;\n      }\n\n      return [fromdt, todt];\n    };\n  }\n\n  function get_by_tag(arr, tag) {\n    return arr.filter(function (x) {\n      return x.tag == tag;\n    }).shift();\n  }\n\n  function make_setter(options) {\n    var attr = options.data;\n    var selattr = options.sel || attr;\n    var def = options.def;\n    return function set(value) {\n      if (typeof value == 'string') {\n        value = get_by_tag(this.data[attr], value);\n      }\n\n      if (!value) {\n        value = get_by_tag(this.data[attr], def);\n      }\n\n      this.selected[selattr] = value;\n\n      if (value.apply) {\n        value.apply(this);\n      }\n\n      return this.refresh_logs();\n    };\n  }\n\n  this.data = {\n    series: [{\n      tag: 'activity',\n      name: 'Activity',\n      icon: 'fa fa-fw fa-ra'\n    } // {tag:'voltage', name:'Voltage', icon:'fa fa-fw fa-bolt'},\n    // {tag:'power', name:'Power', icon:'fa fa-fw fa-battery-half'}\n    ],\n    time_ranges: [{\n      tag: '1-hour',\n      text: 'Last Hour',\n      range: mk_time_range_fn('now', -3600 * 1000)\n    }, {\n      tag: '3-hour',\n      text: 'Last 3 Hours',\n      range: mk_time_range_fn('now', -3 * 3600 * 1000)\n    }, {\n      tag: '6-hour',\n      text: 'Last 6 Hours',\n      range: mk_time_range_fn('now', -6 * 3600 * 1000)\n    }, {\n      tag: '12-hour',\n      text: 'Last 12 Hours',\n      range: mk_time_range_fn('now', -12 * 3600 * 1000)\n    }, {\n      tag: '24-hour',\n      text: 'Last 24 Hours',\n      range: mk_time_range_fn('now', -24 * 3600 * 1000)\n    }, {\n      tag: '3-days',\n      text: 'Last 3 Days',\n      range: mk_time_range_fn('now', -3 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-week',\n      text: 'Last Week',\n      range: mk_time_range_fn('now', -7 * 24 * 3600 * 1000)\n    }, {\n      tag: '2-weeks',\n      text: 'Last 2 Weeks',\n      range: mk_time_range_fn('now', -14 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-month',\n      text: 'Last Month',\n      range: mk_time_range_fn('now', -31 * 24 * 3600 * 1000)\n    }],\n    periods: [{\n      tag: '1-minute',\n      text: '1 Minute',\n      sampling: '1 min',\n      granularity: 1 * 60 * 1000\n    }, {\n      tag: '5-minutes',\n      text: '5 Minutes',\n      sampling: '5 mins',\n      granularity: 5 * 60 * 1000\n    }, {\n      tag: '10-minutes',\n      text: '10 Minutes',\n      sampling: '10 mins',\n      granularity: 10 * 60 * 1000\n    }, {\n      tag: '30-minutes',\n      text: '30 Minutes',\n      sampling: '30 mins',\n      granularity: 30 * 60 * 1000\n    }, {\n      tag: '1-hour',\n      text: '1 Hour',\n      sampling: '1 hour',\n      granularity: 1 * 60 * 60 * 1000\n    }, {\n      tag: '3-hours',\n      text: '3 Hours',\n      sampling: '3 hours',\n      granularity: 3 * 60 * 60 * 1000\n    }, {\n      tag: '6-hours',\n      text: '6 Hours',\n      sampling: '6 hours',\n      granularity: 6 * 60 * 60 * 1000\n    }, {\n      tag: '1-day',\n      text: '1 Day',\n      sampling: '1 day',\n      granularity: 24 * 60 * 60 * 1000\n    }] // min_date: 0,\n    // max_date: 10000,\n\n  };\n  this.loading = {};\n  this.selected = {\n    series: get_by_tag(this.data.series, 'activity'),\n    time_range: get_by_tag(this.data.time_ranges, '1-week'),\n    period: get_by_tag(this.data.periods, '1-day')\n  };\n  this.set_series = make_setter({\n    data: 'series',\n    sel: 'series',\n    def: 'activity'\n  });\n  this.set_time_range = make_setter({\n    data: 'time_ranges',\n    sel: 'time_range',\n    def: '1-week'\n  });\n  this.set_period = make_setter({\n    data: 'periods',\n    sel: 'period',\n    def: '1-day'\n  });\n\n  this.load_data = function (series, range, period) {\n    var loading = this.loading;\n    loading.data = true;\n    return AdminDashboardDataService.getPlotData(series.tag, range[0], range[1], period.sampling).then(function (data) {\n      loading.data = false;\n      return {\n        x: 'datetime',\n        url: data\n      };\n    });\n  };\n\n  this.make_chart_struct = function (data) {\n    return $q(function (resolve, reject) {\n      $window.Plotly.d3.csv(data.url, function (err, data) {\n        if (err) {\n          reject(err);\n        } else if (data) {\n          resolve(data);\n        }\n      });\n    }).then(function (data) {\n      this.chart = {\n        data: [{\n          type: 'scatter',\n          mode: 'lines',\n          marker: {\n            color: '#31984f'\n          },\n          x: data.map(function (_) {\n            return new Date(+_.datetime).toString();\n          }),\n          y: data.map(function (_) {\n            return +_.activity;\n          })\n        }],\n        layout: {\n          xaxis: {\n            boundsmode: 'auto'\n          },\n          yaxis: {\n            boundsmode: 'auto'\n          }\n        } // axes : {\n        //     x : {\n        //         tick: {\n        //             format: function (x) {\n        //                 return moment(new Date(x)).utc().format('MM-DD-YYYY HH:mm');\n        //             }\n        //         }\n        //     }\n        // }\n\n      };\n      console.log(this.chart);\n    }.bind(this));\n  };\n\n  this.refresh_logs = function () {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var series = this.selected.series;\n    var time_range = this.selected.time_range;\n    var period = this.selected.period;\n\n    if (series && time_range && period) {\n      var range = time_range.range();\n      var granularity = period.granularity;\n      promise = d.promise.then(function () {\n        if (series.data) {\n          if (series.data.period != period || !(series.data.range[0] - granularity >= range[0] && range[1] <= series.data.range[1] + granularity)) {\n            series.data = null;\n          }\n        }\n\n        if (!series.data) {\n          return this.load_data(series, range, period).then(function (data) {\n            series.data = {\n              data: data,\n              range: range,\n              period: period\n            };\n            return series.data.data;\n          });\n        } else {\n          return series.data.data;\n        }\n      }.bind(this)).then(function (chart_data) {\n        console.log(\"chart_data : \", chart_data);\n\n        if (chart_data) {\n          this.make_chart_struct(chart_data);\n        }\n      }.bind(this));\n    }\n\n    return promise;\n  };\n\n  $q.when().then(this.refresh_logs.bind(this));\n});","angular.module('a2.analysis', ['a2.analysis.patternmatching', 'a2.directive.audio-bar', 'a2.analysis.random-forest-models', 'a2.analysis.cnn', 'a2.analysis.soundscapes', 'a2.analysis.audio-event-detection', 'a2.analysis.audio-event-detections-clustering', 'a2.analysis.clustering-jobs', 'ui.router', 'ct.ui.router.extras', 'a2.srv.api']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/analysis\", \"/analysis/patternmatching\", \"/analysis/clustering-jobs\");\n  $stateProvider.state('analysis', {\n    url: '/analysis',\n    views: {\n      'analysis': {\n        controller: 'AnalysisIndexCtrl as controller',\n        templateUrl: '/app/analysis/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  });\n}).controller('AnalysisIndexCtrl', function ($scope, Project, a2UserPermit) {\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n});","angular.module('a2.citizen-scientist', ['a2.citizen-scientist.my-stats', 'a2.directive.audio-bar', 'a2.citizen-scientist.patternmatching', 'a2.citizen-scientist.expert', 'a2.citizen-scientist.admin', 'ui.router', 'ct.ui.router.extras']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/citizen-scientist\", \"/citizen-scientist/patternmatching/\");\n  $stateProvider.state('citizen-scientist', {\n    url: '/citizen-scientist',\n    views: {\n      'citizen-scientist': {\n        templateUrl: '/app/citizen-scientist/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  });\n});","angular.module('a2.audiodata', ['ui.router', 'ct.ui.router.extras', 'a2.directive.sidenav-bar', 'a2.directive.audio-bar', 'a2.audiodata.sites', 'a2.audiodata.species', 'a2.audiodata.uploads', 'a2.audiodata.recordings', 'a2.audiodata.training-sets', 'a2.audiodata.playlists', 'a2.audiodata.templates', 'a2.audiodata.soundscape-composition-classes']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/audiodata\", \"/audiodata/sites\");\n  $stateProvider.state('audiodata', {\n    url: '/audiodata',\n    views: {\n      'audiodata': {\n        controller: 'AudiodataIndexCtrl as controller',\n        templateUrl: '/app/audiodata/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  }).state('audiodata.sites', {\n    url: '/sites?site&show',\n    controller: 'SitesCtrl',\n    templateUrl: '/app/audiodata/sites.html'\n  }).state('audiodata.species', {\n    url: '/species',\n    controller: 'SpeciesCtrl',\n    templateUrl: '/app/audiodata/species.html'\n  }).state('audiodata.trainingSets', {\n    url: '/training-sets?set&show',\n    controller: 'TrainingSetsCtrl as controller',\n    templateUrl: '/app/audiodata/training-sets.html'\n  });\n}).controller('AudiodataIndexCtrl', function ($scope, Project, a2UserPermit) {\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n});","angular.module('a2.audiodata.sites', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane', 'a2.qr-js', 'a2.googlemaps', 'a2.srv.project']).directive('fileChange', ['$parse', function ($parse) {\n  return {\n    require: 'ngModel',\n    restrict: 'A',\n    link: function ($scope, element, attrs) {\n      var attrHandler = $parse(attrs['fileChange']);\n\n      var handler = function (e) {\n        $scope.$apply(function () {\n          attrHandler($scope, {\n            $event: e,\n            files: e.target.files\n          });\n        });\n      };\n\n      element[0].addEventListener('change', handler, false);\n    }\n  };\n}]).controller('SitesCtrl', function ($scope, $state, $anchorScroll, Project, $modal, notify, a2Sites, $window, $controller, $q, a2UserPermit, a2GoogleMapsLoader, $downloadResource) {\n  $scope.loading = true;\n  $scope.markers = [];\n  $scope.search = '';\n  $scope.editing = false;\n  $scope.creating = false;\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  var p = {\n    site: $state.params.site,\n    show: $state.params.show\n  };\n\n  if (p.show) {\n    p.show_path = p.show.split(':');\n    p.show = p.show_path.shift();\n  }\n\n  Project.getSites({\n    count: true,\n    logs: true,\n    deployment: true\n  }, function (sites) {\n    $scope.sortByLastUpdated(sites);\n    $scope.loading = false;\n\n    if (p.site) {\n      var site = sites.filter(function (s) {\n        return s.id == p.site;\n      }).shift();\n\n      if (site && site.id) {\n        $scope.sel(site).then(function () {\n          if (p.show) {\n            $scope.set_show(p.show, p.show_path);\n          }\n        });\n      }\n    }\n\n    a2GoogleMapsLoader.then(function (google) {\n      $scope.map = new google.maps.Map($window.document.getElementById('mapSite'), {\n        center: {\n          lat: 0,\n          lng: 0\n        },\n        mapTypeId: google.maps.MapTypeId.SATELLITE,\n        zoom: 8,\n        minZoom: 2\n      });\n      $scope.fitBounds();\n    });\n    $scope.mapHeader = $window.document.getElementById('mapHeader');\n    $scope.mapHeaderPosition = mapHeader.getBoundingClientRect();\n  });\n\n  $scope.fitBounds = function () {\n    const bounds = new google.maps.LatLngBounds();\n    angular.forEach($scope.sites, function (site) {\n      if (site.lat > 85 || site.lat < -85 || site.lon > 180 || site.lon < -180) {\n        return;\n      }\n\n      var marker;\n      const position = new google.maps.LatLng(site.lat, site.lon); // set custop pin to selected site\n\n      if ($scope.selected && $scope.selected.id === site.id) {\n        marker = new google.maps.Marker({\n          position: position,\n          title: site.name,\n          icon: {\n            url: 'http://icons.iconarchive.com/icons/paomedia/small-n-flat/48/map-marker-icon.png'\n          }\n        });\n      } else {\n        marker = new google.maps.Marker({\n          position: position,\n          title: site.name\n        });\n      } // add draggable layer for an editig site\n\n\n      if (($scope.editing || $scope.creating) && $scope.temp && $scope.temp.id === site.id) {\n        marker.setDraggable(true);\n        $scope.map.panTo(position);\n        $scope.map.setZoom(8);\n        google.maps.event.addListener(marker, 'dragend', function (position) {\n          $scope.$apply(function () {\n            $scope.temp.lat = position.latLng.lat();\n            $scope.temp.lon = position.latLng.lng();\n          });\n        });\n      }\n\n      marker.addListener(\"click\", function () {\n        $scope.sel(site);\n        $scope.scrollTo(site.id);\n      });\n      $scope.markers.push(marker);\n      bounds.extend(position);\n    });\n    $scope.map.fitBounds(bounds);\n\n    if ($scope.markers.length) {\n      $scope.setMapOnAll($scope.map);\n    }\n\n    ;\n  };\n\n  $scope.scrollTo = function (id) {\n    const bookmark = 'site-' + id;\n    $anchorScroll.yOffset = 60;\n    console.log(bookmark);\n    $anchorScroll(bookmark);\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    this.scrollPos = $controller.scrollElement.scrollY;\n    $scope.scrollPos = this.scrollPos;\n    $scope.scrolledPastHeader = this.scrollPos < 600;\n  };\n\n  $scope.getMapHeaderTop = function () {\n    // calculate top offset for the map\n    const defaultOffset = '122px';\n\n    if ($scope.mapHeaderPosition) {\n      const topOffset = $scope.mapHeaderPosition.top + $scope.mapHeader.offsetHeigh;\n      return topOffset < 1 ? defaultOffset : topOffset;\n    } else return defaultOffset;\n  };\n\n  $scope.scrollMap = function ($event, $controller) {\n    return $scope.show.map && $scope.editing === false && $scope.creating === false && $scope.sites && $scope.sites.length > 15 && $scope.scrollPos;\n  }, $scope.onFilterChanged = function () {\n    $scope.sites = $scope.sortByKeywordArray($scope.originalSites, $scope.search);\n  };\n\n  $scope.sortByKeywordArray = function (array, keyword) {\n    if (array && !array.length) return [];\n    return array.filter(function (item) {\n      // Filter results by doing case insensitive match on name\n      return item.name.toLowerCase().includes(keyword.toLowerCase());\n    }).sort(function (a, b) {\n      // Sort results by matching name with keyword position in name\n      if (a.name.toLowerCase().indexOf(keyword.toLowerCase()) > b.name.toLowerCase().indexOf(keyword.toLowerCase())) {\n        return 1;\n      } else if (a.name.toLowerCase().indexOf(keyword.toLowerCase()) < b.name.toLowerCase().indexOf(keyword.toLowerCase())) {\n        return -1;\n      } else {\n        if (a.name > b.name) return 1;else return -1;\n      }\n    });\n  };\n\n  $scope.sortByLastUpdated = function (sites) {\n    $scope.sites = sites.sort(function (a, b) {\n      return a.updated_at < b.updated_at ? 1 : -1;\n    });\n    $scope.originalSites = $scope.sites;\n  }; // Sets the map on all markers in the array\n\n\n  $scope.setMapOnAll = function (map) {\n    for (var i = 0; i < $scope.markers.length; i++) {\n      $scope.markers[i].setMap(map);\n    }\n  }; // Removes the markers from the map, but keeps them in the array\n\n\n  $scope.clearMarkers = function () {\n    $scope.setMapOnAll(null);\n  }; // Shows any markers currently in the array\n\n\n  $scope.showMarkers = function (map) {\n    $scope.setMapOnAll(map);\n  }; // Deletes all markers in the array by removing references to them\n\n\n  $scope.deleteMarkers = function () {\n    $scope.clearMarkers();\n    $scope.markers = [];\n  };\n\n  $scope.editing = false;\n\n  $scope.importSite = function () {\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to add sites\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: \"/app/audiodata/import.html\",\n      controller: \"ImportSiteInstanceCtrl\"\n    });\n    modalInstance.result.then(function (response) {\n      // Check the file is valid\n      const sites = parseSitesFromCsv(response);\n\n      if (!sites) {\n        notify.error(\"Wrong format of csv file\");\n        return;\n      } // Save the sites\n\n\n      createSites(sites).then(function () {\n        notify.log(\"Sites created\"); // Refresh data\n\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites);\n        });\n      }).catch(function (error) {\n        notify.error(\"Error: \" + error);\n      });\n    });\n  };\n\n  function parseSitesFromCsv(allText) {\n    var allTextLines = allText.split(/\\r\\n|\\n/);\n    var headers = allTextLines[0].split(',');\n\n    if (!headers.includes(\"name\") || !headers.includes(\"lat\") || !headers.includes(\"lon\") || !headers.includes(\"alt\")) {\n      return false;\n    }\n\n    var sites = [];\n\n    for (var i = 1; i < allTextLines.length; i++) {\n      var data = allTextLines[i].split(',');\n\n      if (data.length == headers.length) {\n        var site = {};\n\n        for (var j = 0; j < headers.length; j++) {\n          if (headers[j] === \"lat\" && (data[j] > 85 || data[j] < -85)) {\n            return notify.log('Please enter latitude number between -85 to 85');\n          }\n\n          if (headers[j] === \"lon\" && (data[j] > 180 || data[j] < -180)) {\n            return notify.log('Please enter longitude number between -180 to 180');\n          }\n\n          site[headers[j]] = data[j];\n        }\n\n        sites.push(site);\n      }\n    }\n\n    return sites;\n  }\n\n  function createSites(sites) {\n    return Promise.all(sites.map(function (site) {\n      return new Promise(function (resolve, reject) {\n        a2Sites.create(site, function (data) {\n          if (data.error) {\n            reject(data.error);\n          } else {\n            resolve();\n          }\n        });\n      });\n    }));\n  }\n\n  ;\n\n  $scope.close = function () {\n    $scope.creating = false;\n    $scope.editing = false;\n\n    if ($scope.marker) {\n      a2GoogleMapsLoader.then(function (google) {\n        var position = new google.maps.LatLng($scope.selected && $scope.selected.lat, $scope.selected && $scope.selected.lon);\n        $scope.marker.setDraggable(false);\n        $scope.marker.setPosition(position);\n        $scope.marker.setTitle($scope.selected && $scope.selected.name);\n      });\n    }\n  };\n\n  $scope.exportSites = function () {\n    if (a2UserPermit.isSuper()) return $downloadResource(Project.getSitesExportUrl());\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export sites');\n    } else $downloadResource(Project.getSitesExportUrl());\n  };\n\n  $scope.status_controller = $controller('SiteStatusPlotterController', {\n    '$scope': $scope\n  });\n  var onLogsRefreshed = $scope.status_controller.on('logs-refreshed', function (logParams) {\n    if ($scope.show.status) {\n      var new_show = [$state.params.show.split(':').slice(0, 1)].concat(logParams).join(':');\n      console.log(\"logParams\", logParams, new_show);\n      $state.transitionTo($state.current.name, {\n        site: $state.params.site,\n        show: new_show\n      }, {\n        notify: false\n      });\n    }\n  });\n  $scope.$on('$destroy', function () {\n    $scope.status_controller.off('logs-refreshed', onLogsRefreshed);\n  });\n\n  $scope.save = function () {\n    var action = $scope.editing ? 'update' : 'create';\n\n    if ($scope.temp.lat > 85 || $scope.temp.lat < -85) {\n      notify.log('Please enter latitude number between -85 to 85');\n      return;\n    }\n\n    if ($scope.temp.lon > 180 || $scope.temp.lon < -180) {\n      notify.log('Please enter longitude number between -180 to 180');\n      return;\n    }\n\n    if ($scope.siteForm.$invalid) return;\n    var tempObj = Object.assign({}, $scope.temp); // Do not include equal location metadata / updated at data to the update endpoint.\n\n    if (action === 'update') {\n      const attrArray = ['alt', 'updated_at'];\n\n      for (var i = 0; i < attrArray.length; i++) {\n        var key = attrArray[i];\n\n        if ($scope.temp[key] === $scope.selected[key]) {\n          delete tempObj[key];\n        }\n      }\n\n      const locationArray = ['lat', 'lon'];\n\n      if ($scope.temp[locationArray[0]] === $scope.selected[locationArray[0]] && $scope.temp[locationArray[1]] === $scope.selected[locationArray[1]]) {\n        delete tempObj[locationArray[0]];\n        delete tempObj[locationArray[1]];\n      }\n    }\n\n    a2Sites[action](action === 'create' ? $scope.temp : tempObj, function (data) {\n      if (data.error) return notify.error(data.error);\n\n      if (action === 'create') {\n        $scope.creating = false;\n      } else {\n        $scope.editing = false;\n      }\n\n      Project.getSites({\n        count: true,\n        logs: true,\n        deployment: true\n      }, function (sites) {\n        $scope.sortByLastUpdated(sites);\n        $scope.sel(action === 'create' ? $scope.temp : tempObj).then(function () {\n          if (p.show) {\n            $scope.set_show(p.show, p.show_path);\n          }\n        }); // rebuild map pins\n\n        $scope.deleteMarkers();\n        $scope.fitBounds();\n      });\n      var message = action == \"update\" ? \"Site updated\" : \"Site created\";\n      notify.log(message);\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.selected) {\n      notify.log('Please select site to remove');\n      return;\n    }\n\n    if (!a2UserPermit.can('delete site')) {\n      notify.error(\"You do not have permission to remove sites\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"Are you sure you would like to remove the following site?\", $scope.selected.name];\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2Sites.delete([$scope.selected.id], function (data) {\n        if (data.error) return notify.error(data.error);\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites); // rebuild map pins\n\n          $scope.deleteMarkers();\n          $scope.fitBounds();\n        });\n        notify.log('Site removed');\n      });\n    });\n  };\n\n  $scope.delAllEmptySites = function () {\n    if (!a2UserPermit.can('manage project settings')) {\n      notify.error(\"You do not have permission to remove sites\");\n      return;\n    }\n\n    var list = [],\n        siteIds = [];\n    $scope.sites.forEach(function (site, index) {\n      if (site.rec_count === 0 && !list.includes(site.name)) {\n        list.push(site.name);\n        siteIds.push(site.id);\n      }\n    });\n\n    if (!list.length) {\n      notify.log(\"There is no empty site in your project\");\n      return;\n    }\n\n    if (list.length > 3) {\n      const msg = '& ' + (list.length - 3) + ' other sites';\n      list = list.slice(0, 3);\n      list.push(msg);\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"Are you sure you would like to remove the following sites?\"];\n        this.list = list;\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2Sites.delete(siteIds, function (data) {\n        if (data.error) return notify.error(data.error);\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites); // rebuild map pins\n\n          $scope.deleteMarkers();\n          $scope.fitBounds();\n        });\n        notify.log('Empty sites removed');\n      });\n    });\n  };\n\n  $scope.show = {\n    map: false,\n    status: false\n  };\n  $scope.show[p.show || 'map'] = true;\n\n  $scope.set_show = function (new_show, show_path) {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var show_state_param = new_show;\n\n    if (new_show == 'status' && $scope.selected && $scope.selected.has_logs) {\n      show_state_param = [new_show].concat(show_path).join(':');\n      promise = promise.then(function () {\n        return $scope.status_controller.activate($scope.selected, show_path);\n      });\n    } else {\n      promise = promise.then(function () {\n        new_show = 'map';\n      });\n    }\n\n    return promise.then(function () {\n      for (var i in $scope.show) {\n        $scope.show[i] = false;\n      }\n\n      $scope.show[new_show] = true;\n      return $state.transitionTo($state.current.name, {\n        site: $state.params.site,\n        show: show_state_param\n      }, {\n        notify: false\n      });\n    });\n  };\n\n  $scope.create = function () {\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to add sites\");\n      return;\n    }\n\n    $scope.temp = {};\n    $scope.set_show('map');\n    $scope.creating = true; // rebuild map pins\n\n    $scope.deleteMarkers();\n    $scope.fitBounds();\n  };\n\n  $scope.edit = function () {\n    if (!$scope.selected) return;\n\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to edit sites\");\n      return;\n    }\n\n    $scope.set_show('map');\n    $scope.temp = angular.copy($scope.selected);\n    $scope.temp.published = $scope.temp.published === 1;\n    Project.getProjectsList('my', function (data) {\n      $scope.projects = data.map(function (project) {\n        return {\n          project_id: project.project_id,\n          name: project.name,\n          url: project.url\n        };\n      });\n    });\n    Project.getInfo(function (data) {\n      $scope.temp.project = data;\n    });\n    $scope.editing = true; // rebuild map pins\n\n    $scope.deleteMarkers();\n    $scope.fitBounds();\n  };\n\n  $scope.onSelect = function ($item) {\n    $scope.temp.project = $item;\n  };\n\n  $scope.showAssetsCarousel = false;\n\n  $scope.showCarousel = function (id) {\n    $scope.images.forEach(function (image) {\n      image.active = image.id === id;\n    });\n    $scope.showAssetsCarousel = true;\n  };\n\n  $scope.capitalizeFirstLetter = function (string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n  };\n\n  $scope.sel = function (site) {\n    return $state.transitionTo($state.current.name, {\n      site: site && site.id,\n      show: $state.params.show\n    }, {\n      notify: false\n    }).then(function () {\n      $scope.images = [];\n      $scope.close();\n      $scope.selected = site;\n\n      if ($scope.selected && $scope.selected.external_id) {\n        a2Sites.getListOfAssets($scope.selected.external_id).then(function (data) {\n          $scope.assets = data;\n\n          if ($scope.assets && $scope.selected.external_id) {\n            $scope.assets = $scope.assets.filter(function (asset) {\n              return asset.meta !== null;\n            });\n\n            for (var i = 0; i < $scope.assets.length; i++) {\n              var src = '/api/project/' + $scope.project.url + '/streams/' + $scope.selected.external_id + '/assets/' + $scope.assets[i].id;\n              $scope.images.push({\n                id: i,\n                src: src,\n                active: i === 0,\n                label: $scope.assets[i] && $scope.assets[i].meta && $scope.assets[i].meta.label ? $scope.capitalizeFirstLetter($scope.assets[i].meta.label) : 'No label image'\n              });\n            }\n          }\n\n          ;\n        }).catch(function (err) {\n          console.log('\\nerr', err);\n        });\n      } // rebuild map pins\n\n\n      $scope.deleteMarkers();\n      $scope.fitBounds(); // zoom in to the selected pin\n\n      if ($scope.selected) {\n        a2GoogleMapsLoader.then(function (google) {\n          var position = new google.maps.LatLng($scope.selected.lat, $scope.selected.lon);\n          $scope.map.panTo(position);\n          $scope.map.setZoom(12);\n        });\n      }\n    });\n  };\n}).controller('ImportSiteInstanceCtrl', function ($scope, $modalInstance) {\n  $scope.files = [];\n\n  $scope.handler = function (e, files) {\n    var reader = new FileReader();\n\n    reader.onload = function (e) {\n      $modalInstance.close(reader.result);\n    };\n\n    reader.readAsText(files[0]);\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss();\n  };\n}).controller('SitesTokenGenaratorCtrl', function ($scope, a2Sites, $modal, notify) {\n  $scope.site = $scope.selected;\n  $scope.loading = {};\n\n  var confirmRevoke = function (title, btnOk) {\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.title = title;\n        this.messages = [\"This action will revoke the current token for the site <b>\" + $scope.site.name + \"</b>. \" + \"Are you sure you want to do this?\"];\n        this.btnOk = btnOk;\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    });\n    return modalInstance;\n  };\n\n  var genToken = function () {\n    a2Sites.generateToken($scope.site).success(function (data) {\n      $scope.loading.generate = false;\n      if (data.error) return notify.error(data.error);\n      $scope.site.token_created_on = new Date(data.created * 1000);\n      $scope.base64 = data.base64token;\n      $scope.token = {\n        type: data.type,\n        name: data.name,\n        created: data.created,\n        expires: data.expires,\n        token: data.token\n      };\n      notify.log(\"New site token generated.\");\n    }).error(function (data) {\n      $scope.loading.generate = false;\n      notify.serverError();\n    });\n  };\n\n  $scope.generateToken = function () {\n    $scope.loading.generate = true;\n\n    if ($scope.site.token_created_on) {\n      var modalInstance = confirmRevoke(\"<h4>Confirm revoke and generate token</h4>\", \"Yes, revoke and generate a new token\");\n      modalInstance.result.then(function ok() {\n        genToken();\n      }, function cancel() {\n        $scope.loading.generate = false;\n      });\n    } else {\n      genToken();\n    }\n  };\n\n  $scope.revokeToken = function () {\n    var modalInstance = confirmRevoke(\"<h4>Confirm revoke token</h4>\", \"Yes, revoke token\");\n    modalInstance.result.then(function () {\n      $scope.loading.revoke = true;\n      a2Sites.revokeToken($scope.site).success(function (data) {\n        $scope.loading.revoke = false;\n        $scope.site.token_created_on = null;\n        $scope.token = null;\n        notify.log(\"site token revoked.\");\n      }).error(function (data) {\n        $scope.loading.generate = false;\n        notify.serverError();\n      });\n    });\n  };\n}).controller('SiteStatusPlotterController', function ($scope, $q, a2Sites, $debounce, a2EventEmitter) {\n  function mk_time_range_fn(from, delta) {\n    return function () {\n      var fromdt = from == 'now' ? new Date() : new Date(from);\n      var todt = new Date(fromdt.getTime() + delta);\n\n      if (delta < 0) {\n        var t = fromdt;\n        fromdt = todt;\n        todt = t;\n      }\n\n      return [fromdt, todt];\n    };\n  }\n\n  function get_by_tag(arr, tag) {\n    return arr.filter(function (x) {\n      return x.tag == tag;\n    }).shift();\n  }\n\n  function make_setter(options) {\n    var attr = options.data;\n    var selattr = options.sel || attr;\n    var def = options.def;\n    return function set(value, dontRefreshLogs) {\n      if (typeof value == 'string') {\n        value = get_by_tag(this.data[attr], value);\n      }\n\n      if (!value) {\n        value = get_by_tag(this.data[attr], def);\n      }\n\n      this.selected[selattr] = value;\n\n      if (value.apply) {\n        value.apply(this);\n      }\n\n      return dontRefreshLogs ? $q.resolve() : this.refresh_logs();\n    };\n  }\n\n  var events = new a2EventEmitter();\n  this.on = events.on.bind(events);\n  this.off = events.off.bind(events);\n\n  this.itemGroup = function (item) {\n    return item.group;\n  };\n\n  this.data = {\n    series: [{\n      tag: 'status',\n      group: 'Site',\n      name: 'Battery Status',\n      icon: 'fa fa-fw fa-plug',\n      axis: {\n        y: {\n          tick: {\n            values: [0, 1, 2, 3],\n            format: function (x) {\n              return ['unknown', 'charging', 'not charging', 'full'][x | 0];\n            }\n          }\n        }\n      }\n    }, {\n      tag: 'voltage',\n      group: 'Site',\n      name: 'Voltage',\n      icon: 'fa fa-fw fa-bolt'\n    }, {\n      tag: 'power',\n      group: 'Site',\n      name: 'Power',\n      icon: 'fa fa-fw fa-battery-half'\n    }, {\n      tag: 'uploads',\n      group: 'Data',\n      name: 'Uploads',\n      icon: 'fa fa-fw fa-upload'\n    }, {\n      tag: 'recordings',\n      group: 'Data',\n      name: 'Recordings',\n      icon: 'fa fa-fw fa-volume-up'\n    }],\n    time_ranges: [{\n      tag: '1-hour',\n      text: 'Last Hour',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -3600 * 1000)\n    }, {\n      tag: '3-hour',\n      text: 'Last 3 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -3 * 3600 * 1000)\n    }, {\n      tag: '6-hour',\n      text: 'Last 6 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -6 * 3600 * 1000)\n    }, {\n      tag: '12-hour',\n      text: 'Last 12 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -12 * 3600 * 1000)\n    }, {\n      tag: '24-hour',\n      text: 'Last 24 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -24 * 3600 * 1000)\n    }, {\n      tag: '3-days',\n      text: 'Last 3 Days',\n      group: 'Days',\n      range: mk_time_range_fn('now', -3 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-week',\n      text: 'Last Week',\n      group: 'Weeks',\n      range: mk_time_range_fn('now', -7 * 24 * 3600 * 1000)\n    }, {\n      tag: '2-weeks',\n      text: 'Last 2 Weeks',\n      group: 'Weeks',\n      range: mk_time_range_fn('now', -14 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-month',\n      text: 'Last Month',\n      group: 'Month',\n      range: mk_time_range_fn('now', -31 * 24 * 3600 * 1000)\n    }],\n    periods: [{\n      tag: '1-minute',\n      text: '1 Minute',\n      group: 'Minutes',\n      sampling: '1 min',\n      granularity: 1 * 60 * 1000\n    }, {\n      tag: '5-minutes',\n      text: '5 Minutes',\n      group: 'Minutes',\n      sampling: '5 mins',\n      granularity: 5 * 60 * 1000\n    }, {\n      tag: '10-minutes',\n      text: '10 Minutes',\n      group: 'Minutes',\n      sampling: '10 mins',\n      granularity: 10 * 60 * 1000\n    }, {\n      tag: '30-minutes',\n      text: '30 Minutes',\n      group: 'Minutes',\n      sampling: '30 mins',\n      granularity: 30 * 60 * 1000\n    }, {\n      tag: '1-hour',\n      text: '1 Hour',\n      group: 'Hours',\n      sampling: '1 hour',\n      granularity: 1 * 60 * 60 * 1000\n    }, {\n      tag: '3-hours',\n      text: '3 Hours',\n      group: 'Hours',\n      sampling: '3 hours',\n      granularity: 3 * 60 * 60 * 1000\n    }, {\n      tag: '6-hours',\n      text: '6 Hours',\n      group: 'Hours',\n      sampling: '6 hours',\n      granularity: 6 * 60 * 60 * 1000\n    }, {\n      tag: '1-day',\n      text: '1 Day',\n      group: 'Days',\n      sampling: '1 day',\n      granularity: 24 * 60 * 60 * 1000\n    }] // min_date: 0,\n    // max_date: 10000,\n\n  };\n  this.loading = {};\n  this.selected = {\n    series: get_by_tag(this.data.series, 'power'),\n    time_range: get_by_tag(this.data.time_ranges, '1-week'),\n    period: get_by_tag(this.data.periods, '1-hour')\n  };\n  this.set_series = make_setter({\n    data: 'series',\n    sel: 'series',\n    def: 'power'\n  });\n  this.set_time_range = make_setter({\n    data: 'time_ranges',\n    sel: 'time_range',\n    def: '1-week'\n  });\n  this.set_period = make_setter({\n    data: 'periods',\n    sel: 'period',\n    def: '7-days'\n  });\n\n  this.activate = function (selected_site, plot_uri) {\n    this.selected.site = selected_site;\n\n    if (plot_uri) {\n      if (plot_uri.length) {\n        this.set_series(plot_uri.shift());\n      }\n\n      if (plot_uri.length) {\n        this.set_time_range(plot_uri.shift());\n      }\n\n      if (plot_uri.length) {\n        this.set_period(plot_uri.shift());\n      }\n    }\n\n    return this.refresh_logs();\n  };\n\n  this.load_data = function (site, series, range, period) {\n    var loading = this.loading;\n    loading.data = true;\n    return a2Sites.getSiteLogData(site.id, series.tag, range[0], range[1], period.sampling).then(function (data) {\n      loading.data = false;\n      data.x = 'datetime';\n      data.axis = series.axis;\n      data.empty = {\n        label: {\n          text: \"No data to show.\"\n        }\n      };\n      return data;\n    });\n  };\n\n  this.make_chart_struct = function (data) {\n    var axes = {\n      x: {\n        tick: {\n          format: function (x) {\n            return moment(new Date(x)).utc().format('MM-DD-YYYY HH:mm');\n          }\n        }\n      }\n    };\n\n    if (data.axis) {\n      angular.merge(axes, data.axis);\n      delete data.axis;\n    }\n\n    this.chart = {\n      data: data,\n      axes: axes\n    };\n  };\n\n  this.refresh_logs = $debounce(function () {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var site = this.selected.site;\n    var series = this.selected.series;\n    var time_range = this.selected.time_range;\n    var period = this.selected.period;\n\n    if (site && series && time_range && period) {\n      var range = time_range.range();\n      var granularity = period.granularity;\n      promise = d.promise.then(function () {\n        if (series.data) {\n          if (series.data.site != site || series.data.period != period || !(series.data.range[0] - granularity >= range[0] && range[1] <= series.data.range[1] + granularity)) {\n            series.data = null;\n          }\n        }\n\n        if (!series.data) {\n          return this.load_data(site, series, range, period).then(function (data) {\n            series.data = {\n              data: data,\n              site: site,\n              range: range,\n              period: period\n            };\n            return series.data.data;\n          });\n        } else {\n          return series.data.data;\n        }\n      }.bind(this)).then(function (chart_data) {\n        console.log(\"chart_data : \", chart_data);\n\n        if (chart_data) {\n          this.make_chart_struct(chart_data);\n        }\n      }.bind(this)).then(function () {\n        events.emit('logs-refreshed', [series.tag, time_range.tag, period.tag]);\n      });\n    }\n\n    return promise;\n  }, 10);\n});","angular.module('a2.audiodata.soundscape-composition-classes', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.scAnnotationClasses', {\n    url: '/soundscape-annotation-classes',\n    controller: 'SoundscapeCompositionClassesScreenCtrl as controller',\n    templateUrl: '/app/audiodata/soundscape-composition-classes.html'\n  });\n}).controller('SoundscapeCompositionClassesScreenCtrl', function ($modal, notify, Project, a2SoundscapeCompositionService, a2UserPermit) {\n  this.initialize = function () {\n    this.loading = true;\n    this.newClass = {};\n    this.canManageClasses = a2UserPermit.can(\"manage project species\");\n    a2SoundscapeCompositionService.getClassList({\n      tally: 1,\n      groupByType: true,\n      isSystemClass: 1\n    }).then(function (classes) {\n      this.classes = classes;\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.addNewClass = function (groupType) {\n    var className = this.newClass[groupType.typeId];\n    delete this.newClass[groupType.typeId];\n\n    if (className) {\n      if (!a2UserPermit.can(\"manage project species\")) {\n        notify.error(\"You do not have permission to add soundscape composition classes\");\n        return;\n      }\n\n      a2SoundscapeCompositionService.addClass(className, groupType.typeId).then(function (newClass) {\n        groupType.list.push(newClass);\n      }.bind(this)).catch(function (err) {\n        notify.error(err.data || err.message);\n      });\n    }\n  };\n\n  this.removeClass = function (scClass) {\n    if (scClass.isSystemClass) {\n      return;\n    }\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove soundscape composition classes\");\n      return;\n    }\n\n    a2SoundscapeCompositionService.removeClass(scClass.id).then(function () {\n      this.classes.forEach(function (classGroup) {\n        var index = classGroup.list.indexOf(scClass);\n\n        if (index >= 0) {\n          classGroup.list.splice(index, 1);\n        }\n      });\n    }.bind(this)).catch(function (err) {\n      notify.error(err.data || err.message);\n    });\n  };\n\n  this.add = function () {\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to add species\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/select-species.html',\n      controller: 'SelectSoundscapeCompositionClassesScreenCtrl',\n      size: 'lg'\n    });\n    modalInstance.result.then(function (selected) {\n      var cls = {\n        species: selected.species.scientific_name,\n        songtype: selected.song.name\n      };\n      Project.addClass(cls).success(function (result) {\n        notify.log(selected.species.scientific_name + ' ' + selected.song.name + \" added to project\");\n        Project.getClasses(function (classes) {\n          this.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  this.del = function () {\n    if (!this.checked || !this.checked.length) return;\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove species\");\n      return;\n    }\n\n    var speciesClasses = this.checked.map(function (row) {\n      return '\"' + row.species_name + ' | ' + row.songtype_name + '\"';\n    });\n    var message = [\"You are about to delete the following project species: \"];\n    var message2 = [\"Are you sure?\"];\n    this.popup = {\n      messages: message.concat(speciesClasses, message2),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: this\n    });\n    modalInstance.result.then(function () {\n      var classesIds = this.checked.map(function (row) {\n        return row.id;\n      });\n      var params = {\n        project_classes: classesIds\n      };\n      Project.removeClasses(params).success(function (result) {\n        Project.getClasses(function (classes) {\n          this.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  this.initialize();\n});","angular.module('a2.audiodata.species', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).controller('SpeciesCtrl', function ($scope, Project, $modal, notify, a2UserPermit) {\n  $scope.loading = true;\n  $scope.selected = {};\n  Project.getClasses(function (classes) {\n    $scope.classes = classes;\n    $scope.loading = false;\n  });\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n\n  $scope.add = function () {\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to add species\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/select-species.html',\n      controller: 'SelectSpeciesCtrl',\n      size: 'lg'\n    });\n    modalInstance.result.then(function (selected) {\n      var cls = {\n        species: selected.species.scientific_name,\n        songtype: selected.song.name\n      };\n      Project.addClass(cls).success(function (result) {\n        notify.log(selected.species.scientific_name + ' ' + selected.song.name + \" added to project\");\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.checked || !$scope.checked.length) return;\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove species\");\n      return;\n    }\n\n    var speciesClasses = $scope.checked.map(function (row) {\n      return '\"' + row.species_name + ' | ' + row.songtype_name + '\"';\n    });\n    var message = [\"Are you sure you would like to remove the following species call from this project?\"];\n    var message2 = [\"Note: validations for this species call will also be removed from this project.\"];\n    $scope.popup = {\n      messages: message.concat(message2, speciesClasses),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      var classesIds = $scope.checked.map(function (row) {\n        return row.id;\n      });\n      var params = {\n        project_classes: classesIds\n      };\n      Project.removeClasses(params).success(function (result) {\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n}).controller('SelectSpeciesCtrl', function ($scope, Species, Songtypes) {\n  var timeout;\n  Songtypes.get(function (songs) {\n    $scope.songtypes = songs;\n  });\n\n  $scope.searchSpecies = function () {\n    if ($scope.search === \"\") {\n      $scope.species = [];\n      return;\n    }\n\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      Species.search($scope.search, function (results) {\n        $scope.species = results;\n      });\n    }, 500);\n  };\n});","angular.module('a2.audiodata.training-sets', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.visualizer.layers.training-sets', 'humane']).factory('a2TrainingSetHistory', function () {\n  var lastSet, lastPage, lastRoi, lastRoiSet, viewState, lastSpecie, lastSongtype;\n  return {\n    getLastSet: function (callback) {\n      callback({\n        ls: lastSet,\n        lp: lastPage,\n        lr: lastRoi,\n        lrs: lastRoiSet,\n        vs: viewState,\n        sp: lastSpecie,\n        sg: lastSongtype\n      });\n    },\n    setLastSet: function (val) {\n      lastSet = val;\n    },\n    setLastPage: function (val) {\n      lastPage = val;\n    },\n    setLastRoi: function (val) {\n      lastRoi = val;\n    },\n    setLastRoiSet: function (val) {\n      lastRoiSet = val;\n    },\n    setViewState: function (val) {\n      viewState = val;\n    },\n    setLastSpecies: function (valsp, valsg) {\n      lastSpecie = valsp;\n      lastSongtype = valsg;\n    }\n  };\n}).controller('TrainingSetsCtrl', function ($state, a2TrainingSets, Project, $q, $modal, a2TrainingSetHistory, a2UserPermit, notify) {\n  var p = {\n    set: $state.params.set,\n    show: $state.params.show\n  };\n  this.selected = {\n    roi_index: 0,\n    roi: null,\n    page: 0\n  };\n  this.total = {\n    rois: 0,\n    pages: 0\n  };\n  this.loading = {\n    list: false,\n    details: false\n  };\n  this.rois = [];\n  this.species = '';\n  this.songtype = '';\n  this.detailedView = p.show != \"gallery\";\n  this.currentrois = [];\n  this.roisPerpage = 100;\n  this.detailedView = false;\n  this.loaderDisplay = false;\n\n  this.getROIVisualizerUrl = function (roi) {\n    return roi ? \"/project/\" + this.projecturl + \"/#/visualizer/rec/\" + roi.recording : '';\n  };\n\n  this.setROI = function (roi_index) {\n    if (this.total.rois <= 0) {\n      this.selected.roi_index = 0;\n      this.selected.roi = null;\n    } else {\n      this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n      this.selected.roi = this.rois[this.selected.roi_index];\n    }\n\n    a2TrainingSetHistory.setLastRoi(this.selected.roi);\n    return this.selected.roi;\n  };\n\n  this.setPage = function (page) {\n    if (this.total.rois <= 0) {\n      this.selected.page = 0;\n      this.selected.currentrois = [];\n    } else {\n      this.selected.page = Math.max(0, Math.min(page, this.total.rois / this.roisPerpage | 0));\n      this.currentrois = this.rois.slice(this.selected.page * this.roisPerpage, (this.selected.page + 1) * this.roisPerpage);\n    }\n\n    a2TrainingSetHistory.setLastPage(this.selected.page);\n    return this.currentrois;\n  };\n\n  this.setROISet = function (rois) {\n    this.rois = rois;\n    a2TrainingSetHistory.setLastRoiSet(this.rois);\n  };\n\n  this.nextROI = function (step) {\n    return this.setROI(this.selected.roi_index + (step || 1));\n  };\n\n  this.prevROI = function (step) {\n    return this.setROI(this.selected.roi_index - (step || 1));\n  };\n\n  this.nextPage = function (step) {\n    return this.setPage(this.selected.page + (step || 1));\n  };\n\n  this.prevPage = function (step) {\n    return this.setPage(this.selected.page - (step || 1));\n  };\n\n  this.next = function (step) {\n    if (!step) {\n      step = 1;\n    }\n\n    if (this.detailedView) {\n      this.nextROI(step);\n    } else {\n      this.nextPage(step);\n    }\n  };\n\n  this.prev = function (step) {\n    if (!step) {\n      step = 1;\n    }\n\n    return this.next(-step);\n  };\n\n  this.removeRoi = function (roiId) {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"You are about to delete a ROI. Are you sure?\"];\n        this.btnOk = \"Yes, do it!\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2TrainingSets.removeRoi(this.selected.trainingSet.id, roiId, function (data) {\n        if (data.affectedRows) {\n          for (var i = 0; i < this.rois.length; i++) {\n            if (this.rois[i].id == roiId) {\n              this.rois.splice(i, 1);\n              break;\n            }\n          }\n\n          this.total.rois = this.rois.length;\n          this.setROI(this.selected.roi_index);\n          this.setPage(this.selected.page);\n        }\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.closeSetDetails = function () {\n    this.showSetDetails = false;\n  };\n\n  this.getTrainingSetList = function () {\n    this.loading.list = true;\n    return a2TrainingSets.getList(function (data) {\n      this.trainingSets = data.map(function (d) {\n        d.date_created = new Date(d.date_created);\n        return d;\n      });\n\n      if (p.set) {\n        var selected = this.trainingSets.filter(function (tset) {\n          return tset.id == p.set;\n        }).pop();\n\n        if (selected) {\n          this.selectTrainingSet(selected);\n        }\n      }\n\n      this.loading.list = false;\n    }.bind(this));\n  };\n\n  this.addNewTrainingSet = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to create training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/training-data/add_tset_modal.html',\n      controller: 'a2VisualizerAddTrainingSetModalController'\n    }).result.then(this.getTrainingSetList.bind(this));\n  };\n\n  this.selectTrainingSet = function (selected) {\n    $state.transitionTo($state.current.name, {\n      set: selected.id,\n      show: $state.params.show\n    }, {\n      notify: false\n    });\n    this.detailedView = $state.params.show != \"gallery\";\n    this.loaderDisplay = true;\n    a2TrainingSetHistory.setLastSet(selected);\n\n    if (this.selected.trainingSet) {\n      if (this.selected.trainingSet.edit) {\n        delete this.selected.trainingSet.edit;\n      }\n    }\n\n    this.selected.trainingSet = selected;\n    Project.validationBySpeciesSong(selected.species, selected.songtype, function (data) {\n      this.selected.trainingSet.validations = data;\n    }.bind(this));\n    a2TrainingSets.getSpecies(selected.id, function (speciesData) {\n      this.species = speciesData.species;\n      this.songtype = speciesData.songtype;\n      a2TrainingSetHistory.setLastSpecies(this.species, this.songtype);\n      a2TrainingSets.getRois(selected.id, function (data) {\n        this.loaderDisplay = false;\n        this.detailedView = false;\n        this.total.rois = data.length;\n        this.total.pages = Math.ceil(this.total.rois / this.roisPerpage);\n        this.setROISet(data);\n        this.setROI(0);\n        this.setPage(0);\n        this.selected.page = 0;\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.setupExportUrl = function () {\n    this.selected.trainingSet.export_url = a2TrainingSets.getExportUrl(this.selected.trainingSet.id);\n  };\n\n  this.exportTSReport = function ($event) {\n    $event.stopPropagation();\n    if (a2UserPermit.isSuper()) return this.setupExportUrl();\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export Training Set data');\n    } else return this.setupExportUrl();\n  };\n\n  this.setDetailedView = function (detailedView) {\n    $state.transitionTo($state.current.name, {\n      set: $state.params.set,\n      show: detailedView ? \"detail\" : \"gallery\"\n    }, {\n      notify: false\n    });\n    this.detailedView = detailedView;\n    a2TrainingSetHistory.setViewState(this.detailedView);\n  };\n\n  this.editSelectedTrainingSet = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    if (this.selected.trainingSet) {\n      var trainingSet = this.selected.trainingSet;\n      var speciesClass = {\n        species: trainingSet.species,\n        songtype: trainingSet.songtype\n      };\n      speciesClass.species_name = this.species;\n      speciesClass.songtype_name = this.songtype;\n      Project.getClasses().then(function (classes) {\n        var d = $q.defer();\n        var current = classes.filter(function (cls) {\n          return speciesClass.species == cls.species && speciesClass.songtype == cls.songtype;\n        }).pop() || speciesClass;\n        trainingSet.edit = {\n          name: trainingSet.name,\n          class: current,\n          projectClasses: classes\n        };\n        trainingSet.edit.cancel = d.reject.bind(d);\n\n        trainingSet.edit.save = function () {\n          return a2TrainingSets.edit(trainingSet.id, {\n            name: trainingSet.edit.name,\n            class: trainingSet.edit.class.id\n          }).then(function (response) {\n            d.resolve(response.data);\n          }, function (response) {\n            notify.log(response.data);\n          });\n        };\n\n        return d.promise;\n      }).then(function (editedTrainingSet) {\n        for (var i in editedTrainingSet) {\n          trainingSet[i] = editedTrainingSet[i];\n        }\n\n        this.selectTrainingSet(trainingSet);\n      }.bind(this)).finally(function () {\n        delete trainingSet.edit;\n      });\n    }\n  };\n\n  this.deleteSelectedTrainingSet = function () {\n    var trainingSet = this.selected.trainingSet;\n\n    if (!trainingSet) {\n      return;\n    }\n\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"You are about to delete a the training set \\\"\" + trainingSet.name + \"\\\". Are you sure?\"];\n        this.btnOk = \"Yes, do it!\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      a2TrainingSets.delete(trainingSet.id, function (data) {\n        this.trainingSets.splice(this.trainingSets.indexOf(trainingSet), 1);\n        delete this.selected.trainingSet;\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.getTrainingSetList();\n  this.projecturl = Project.getUrl();\n  a2TrainingSetHistory.getLastSet(function (data) {\n    if (data.ls) {\n      this.showSetDetails = true;\n      this.selected.trainingSet = data.ls;\n      this.species = data.sp;\n      this.songtype = data.sg;\n      this.detailedView = data.vs;\n      this.total.rois = data.lrs.length;\n      this.total.pages = Math.ceil(this.total.rois / this.roisPerpage);\n      this.selected.page = data.lp;\n      this.setROISet(data.lrs);\n      this.setPage(data.lp);\n      this.setROI(data.lr || 0);\n    }\n  }.bind(this));\n});","angular.module('a2.jobs', ['a2.services', 'a2.permissions']).config(function ($stateProvider) {\n  $stateProvider.state('jobs', {\n    url: '/jobs',\n    controller: 'StatusBarNavController',\n    templateUrl: '/app/jobs/index.html'\n  });\n}).controller('StatusBarNavController', function ($scope, $http, $modal, $window, Project, JobsData, notify, a2UserPermit) {\n  $scope.show = {};\n  $scope.showClassifications = true;\n  $scope.showTrainings = true;\n  $scope.showSoundscapes = true;\n  $scope.url = '';\n  $scope.successInfo = \"\";\n  $scope.showSuccesss = false;\n  $scope.errorInfo = \"\";\n  $scope.showErrors = false;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = {\n    jobs: false\n  };\n  $scope.loading.jobs = true;\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n  };\n\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n\n  var hideJob = function (jobId, action) {\n    $http.get('/api/project/' + Project.getUrl() + '/jobs/hide/' + jobId).success(function (data) {\n      JobsData.updateJobs();\n      const message = 'Job ' + action + ' successfully.';\n      notify.log(message);\n    }).error(function (data) {\n      if (data.error) {\n        notify.error(error);\n      } else {\n        notify.serverError();\n      }\n    });\n  };\n\n  JobsData.getJobTypes().success(function (data) {\n    var colors = ['#1482f8', '#df3627', '#40af3b', '#9f51bf', '#d37528', '#ffff00', '#5bc0de'];\n    var job_types_id = [1, 2, 4, 6, 7, 8, 9];\n    var job_types = data.filter(function (type) {\n      return job_types_id.includes(type.id);\n    });\n    $scope.job_types = {};\n    $scope.job_types.types = job_types;\n    $scope.job_types.show = {};\n    $scope.job_types.for = {};\n    $scope.job_types.types.forEach(function (c, i) {\n      $scope.show[c.id] = true;\n      $scope.job_types.for[c.id] = c;\n      c.color = colors[i % colors.length];\n    });\n  });\n  $scope.$watch(function () {\n    return JobsData.getJobs();\n  }, function (new_jobs) {\n    $scope.jobs = new_jobs;\n    $scope.loading.jobs = false;\n    JobsData.startTimer();\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n  }, true);\n  $scope.$on('$destroy', function () {\n    JobsData.cancelTimer();\n  });\n\n  $scope.showActiveJobs = function () {\n    return !$scope.loading.jobs && $scope.jobs !== undefined && $scope.jobs.length;\n  };\n\n  $scope.showEmptyList = function () {\n    return !$scope.loading.jobs && $scope.jobs !== undefined && !$scope.jobs.length;\n  };\n\n  $scope.showLoader = function () {\n    return $scope.jobs === undefined;\n  };\n\n  var confirm = function (titlen, action, cb, vl, message) {\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.title = titlen + ' running job';\n        this.messages = [\"This job has not finished yet. Are you sure?\"];\n        this.btnOk = \"Yes, \" + action + \" it\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: \"popup\"\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n    });\n    modalInstance.result.then(function (ok) {\n      cb(vl, message);\n    });\n  };\n\n  $scope.hide = function (job) {\n    if (!a2UserPermit.can('manage project jobs')) {\n      notify.error('You do not have permission to hide or cancel jobs');\n      return;\n    }\n\n    const jobId = job.job_id;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n\n    if (job.percentage < 100) {\n      confirm('Cancel', 'cancel', hideJob, jobId, 'canceled');\n    } else {\n      hideJob(jobId, 'hidden');\n    }\n  };\n\n  $scope.isCompleted = function (row) {\n    return row.state === 'completed';\n  };\n\n  $scope.isProcessing = function (row) {\n    return row.state === 'processing';\n  };\n\n  $scope.isWaiting = function (row) {\n    return row.state === 'waiting';\n  };\n\n  $scope.openJob = function (row) {\n    $window.location.href = '/project/' + Project.getUrl() + '/analysis/' + row.url;\n  };\n}).service('JobsData', function ($http, $interval, Project, $q) {\n  var jobs;\n  var url = Project.getUrl();\n  var intervalPromise;\n  var isProcessing = false;\n\n  updateJobs = function () {\n    if (isProcessing) return;\n    isProcessing = true;\n    $http.get('/api/project/' + url + '/jobs/progress', {\n      params: {\n        last3Months: true\n      }\n    }).success(function (data) {\n      data.forEach(function (item) {\n        if (item.job_type_id === 1 && item.completed === 0 && item.state === 'error') {\n          item.state = 'error: insufficient validations';\n        }\n\n        if (item.job_type_id === 2 && item.completed === 0 && item.state === 'completed') {\n          item.state = 'processing';\n        }\n      });\n      jobs = data;\n      isProcessing = false;\n    });\n  };\n\n  updateJobs();\n  return {\n    geturl: function () {\n      return url;\n    },\n    getJobs: function () {\n      return jobs;\n    },\n    getJobTypes: function () {\n      return $http.get('/api/jobs/types');\n    },\n    updateJobs: function () {\n      return updateJobs();\n    },\n    startTimer: function () {\n      $interval.cancel(intervalPromise);\n\n      if (typeof jobs != 'undefined' && jobs.length > 0) {\n        intervalPromise = $interval(function () {\n          var cancelInterval = true;\n\n          for (var i = 0; i < jobs.length; i++) {\n            if (jobs[i].percentage < 100) {\n              cancelInterval = false;\n              break;\n            }\n          }\n\n          if (cancelInterval) {\n            $interval.cancel(intervalPromise);\n          } else if (jobs.length < 1) {\n            $interval.cancel(intervalPromise);\n          } else {\n            updateJobs();\n          }\n        }, 10000);\n      }\n    },\n    cancelTimer: function () {\n      $interval.cancel(intervalPromise);\n    }\n  };\n});","angular.module('a2.app.dashboard', ['a2.services', 'a2.directives', 'ui.bootstrap', 'ui.router', 'ct.ui.router.extras', 'a2.forms', 'humane', 'a2.googlemaps', 'a2.directive.warning-banner']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('dashboard', {\n    url: '/dashboard',\n    controller: 'SummaryCtrl',\n    templateUrl: '/app/dashboard/index.html'\n  });\n}).controller('SummaryCtrl', function ($scope, Project, a2Templates, a2GoogleMapsLoader, $timeout, $window, $compile, $templateFetch, a2PatternMatching) {\n  $scope.loading = 5;\n\n  var done = function () {\n    if ($scope.loading > 0) --$scope.loading;\n  };\n\n  Project.getInfo(function (info) {\n    $scope.project = info;\n    $scope.isSpeciesLoading = true;\n    Project.getProjectTotalSpecies(info.project_id, function (data) {\n      $scope.speciesQty = data || 0;\n      $scope.isSpeciesLoading = false;\n    });\n    done();\n  });\n  Project.getSites(function (sites) {\n    $scope.sites = sites;\n    done();\n    $timeout(function () {\n      a2GoogleMapsLoader.then(function (google) {\n        $scope.map = new google.maps.Map($window.document.getElementById('summary-map'), {\n          center: {\n            lat: 0,\n            lng: 0\n          },\n          mapTypeId: google.maps.MapTypeId.SATELLITE,\n          zoom: 8,\n          minZoom: 2\n        });\n        var bounds = new google.maps.LatLngBounds();\n        angular.forEach($scope.sites, function (site) {\n          if (site.lat > 85 || site.lat < -85 || site.lon > 180 || site.lon < -180) {\n            return;\n          }\n\n          var position = new google.maps.LatLng(site.lat, site.lon);\n          var marker = new google.maps.Marker({\n            position: position,\n            title: site.name\n          });\n          bounds.extend(position);\n          marker.setMap($scope.map);\n          $scope.map.fitBounds(bounds);\n        });\n      });\n    }, 100);\n  });\n  Project.getRecTotalQty(function (data) {\n    $scope.recsQty = data;\n    done();\n  });\n  a2Templates.getList().then(function (data) {\n    $scope.templateQty = data.length;\n    done();\n  });\n  a2PatternMatching.getPatternMatchingsTotal(function (data) {\n    $scope.pmQty = data;\n    done();\n  });\n});","angular.module('a2.settings', ['a2.services', 'a2.directives', 'a2.forms', 'a2.orders', 'a2.permissions', 'a2.directive.sidenav-bar', 'ui.bootstrap', 'ui.router', 'ct.ui.router.extras', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/settings\", \"/settings/details\");\n\n  var accessCheck = function (a2UserPermit) {\n    return a2UserPermit.can(\"manage project settings\");\n  };\n\n  $stateProvider.state('settings', {\n    url: '/settings',\n    templateUrl: '/app/settings/index.html',\n    allowAccess: accessCheck\n  }).state('settings.details', {\n    url: '/details',\n    controller: 'SettingsDetailsCtrl',\n    templateUrl: '/app/settings/details.html',\n    allowAccess: accessCheck\n  }).state('settings.users', {\n    url: '/users',\n    controller: 'SettingsUsersCtrl',\n    templateUrl: '/app/settings/users.html',\n    allowAccess: accessCheck\n  });\n}).controller('SettingsDetailsCtrl', function ($scope, Project, notify, $window, $timeout, a2order, a2UserPermit, $modal) {\n  $scope.today = new Date();\n  Project.getInfo(function (info) {\n    if (info.plan_activated && info.plan_period) {\n      info.plan_due = new Date(info.plan_activated);\n      info.plan_due.setFullYear(info.plan_due.getFullYear() + info.plan_period);\n    }\n\n    $scope.project = info;\n  });\n  Project.getUsage().success(function (usage) {\n    $scope.minUsage = usage.min_usage;\n  });\n\n  $scope.save = function () {\n    console.log($scope);\n    if (!$scope.isValid) return;\n\n    if (!$scope.project.description) {\n      $scope.project.description = '';\n    }\n\n    Project.updateInfo({\n      project: $scope.project\n    }, function (err, result) {\n      if (err) {\n        return notify.serverError();\n      }\n\n      if (result.error) {\n        return notify.error(result.error);\n      }\n\n      notify.log('Project info updated');\n\n      if (result.url) {\n        $timeout(function () {\n          $window.location.assign('/project/' + result.url + '/#/settings');\n        }, 1000);\n      }\n    });\n  };\n\n  $scope.deleteProject = function () {\n    if (!a2UserPermit.can('delete project')) {\n      notify.error('You do not have permission to delete this project');\n      return;\n    }\n\n    $scope.popup = {\n      title: 'Delete project',\n      messages: ['Are you sure you want to delete this project?'],\n      btnOk: 'Yes',\n      btnCancel: 'No'\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      return Project.removeProject({\n        external_id: $scope.project.external_id\n      }).then(function () {\n        notify.log('Project deleted');\n        $window.location.href = '/projects';\n      });\n    });\n  };\n\n  $scope.changePlan = function () {\n    var modalInstance = a2order.changePlan({});\n  };\n}).controller('SettingsUsersCtrl', function ($scope, $http, Project, $modal, notify) {\n  $scope.userToAdd = '';\n  $scope.curQuery = '';\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  Project.getUsers(function (err, users) {\n    $scope.users = users;\n  });\n  Project.getRoles(function (err, roles) {\n    $scope.roles = roles;\n  });\n\n  $scope.findUser = function (query) {\n    $scope.curQuery = query;\n    return $http.get('/api/user/search/' + query).then(function (response) {\n      return response.data;\n    });\n  };\n\n  $scope.inviteUser = function (data) {\n    return $http.post('/api/user/invite', data).then(function (response) {\n      return response.data;\n    });\n  };\n\n  $scope.add = function () {\n    if (!$scope.userToAdd) {\n      return;\n    }\n\n    Project.addUser({\n      project_id: $scope.project.project_id,\n      user_id: $scope.userToAdd.id,\n      user_email: $scope.userToAdd.email\n    }, function (err) {\n      if (err) {\n        notify.error(err);\n      } else {\n        $scope.curQuery = '';\n        notify.log('User added to project');\n      }\n\n      Project.getUsers(function (err, users) {\n        $scope.users = users;\n      });\n    });\n  };\n\n  $scope.invite = function () {\n    $scope.showInvitationPopup($scope.curQuery);\n  };\n\n  $scope.showInvitationPopup = function (email) {\n    var modalInstance = $modal.open({\n      templateUrl: '/app/settings/invitation.html',\n      controller: 'UserInvitationCtrl as controller',\n      resolve: {\n        email: function () {\n          return email;\n        },\n        inviteUser: function () {\n          return $scope.inviteUser;\n        }\n      }\n    });\n    modalInstance.result.then(function (user) {\n      $scope.noResults = false;\n      $scope.userToAdd = user;\n      $scope.userToAdd.id = user.user_id;\n      $scope.add();\n    });\n  };\n\n  $scope.changeRole = function ($index) {\n    var role = $scope.roles.filter(function (value) {\n      return $scope.users[$index].rolename === value.name;\n    })[0];\n    Project.changeUserRole({\n      project_id: $scope.project.project_id,\n      user_id: $scope.users[$index].id,\n      user_email: $scope.users[$index].email,\n      role_id: role.id\n    }, function (err) {\n      if (err) {\n        notify.error(err);\n      } else {\n        notify.log('User role updated');\n      }\n\n      Project.getUsers(function (err, users) {\n        $scope.users = users;\n      });\n    });\n  };\n\n  const message = ['Are you sure you would like to remove the following user from this project?'];\n\n  $scope.del = function ($index) {\n    const user = $scope.users[$index];\n    $scope.popup = {\n      messages: message.concat(user.firstname + ' ' + user.lastname + ' ' + '(' + user.email + ')'),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      Project.removeUser({\n        project_id: $scope.project.project_id,\n        user_id: $scope.users[$index].id,\n        user_email: $scope.users[$index].email\n      }, function (err) {\n        if (err) {\n          notify.error(err);\n        } else {\n          notify.log('User deleted from project');\n        }\n\n        Project.getUsers(function (err, users) {\n          $scope.users = users;\n        });\n      });\n    });\n  };\n}).controller('UserInvitationCtrl', function ($modalInstance, notify, email, inviteUser) {\n  Object.assign(this, {\n    initialize: function () {\n      this.isLoading = false;\n      this.data = {\n        email: email,\n        firstname: '',\n        lastname: ''\n      };\n    },\n    submit: function () {\n      var _this = this;\n\n      try {\n        this.isLoading = true;\n        return inviteUser(this.data).then(function (user) {\n          $modalInstance.close(user);\n        }).catch(notify.serverError).finally(function () {\n          _this.isLoading = false;\n        });\n      } catch (error) {\n        console.error('UserInvitationCtrl.submit error: ', error);\n      }\n    },\n    cancel: function () {\n      $modalInstance.close(null);\n    },\n    isDataValid: function () {\n      return this.data.email.trim().length > 0 && this.data.firstname.trim().length > 0 && this.data.lastname.trim().length > 0;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.visualizer.audio-player', []).service('a2AudioPlayer', function (A2AudioObject, $q, notify, a2Playlists, Project, $localStorage, a2UserPermit) {\n  'use strict';\n\n  var a2AudioPlayer = function (scope, options) {\n    this.scope = scope;\n    this.gain = 1;\n    this.gain_levels = [1, 2, 5, 10, 15, 20, 25, 30, 50];\n    this.freq_filter = undefined;\n    this.is_playing = false;\n    this.is_muted = false;\n    this.has_recording = false;\n    this.has_next_recording = false;\n    this.has_prev_recording = false;\n    this.resource = null;\n    this.resource_params = {};\n    this.isPopupOpened = false;\n    this.isSavingPlaylist = false;\n    this.playlistData = {};\n    this.clustersData = null;\n\n    if (options) {\n      if (options.gain) {\n        this.gain = Math.min(Math.max(1, (options && options.gain) | 0), this.gain_levels[this.gain_levels.length - 1]);\n        this.resource_params.gain = this.gain;\n      }\n\n      if (options.filter) {\n        var f = options.filter.split('-');\n        var f0 = f.shift() | 0,\n            f1 = f.shift() | 0;\n        var fmin = Math.min(f0, f1),\n            fmax = Math.max(f0, f1);\n\n        if (fmax) {\n          this.freq_filter = {\n            min: fmin,\n            max: fmax\n          };\n          this.resource_params.maxFreq = fmax;\n          this.resource_params.minFreq = fmin;\n        }\n      }\n    }\n\n    scope.$on('$destroy', this.discard.bind(this));\n  };\n\n  a2AudioPlayer.prototype = {\n    setFrequencyFilter: function (freq_filter) {\n      if (freq_filter) {\n        this.resource_params.maxFreq = freq_filter.max;\n        this.resource_params.minFreq = freq_filter.min;\n      } else {\n        delete this.resource_params.maxFreq;\n        delete this.resource_params.minFreq;\n      }\n\n      return this.load(this.resource_url).then(function () {\n        this.freq_filter = freq_filter;\n      }.bind(this)); // this.resource.setFrequencyFilter(filter).then((function(){\n      //     this.freq_filter = filter;\n      // }).bind(this));\n    },\n    setGain: function (gain) {\n      gain = Math.max(1, gain | 0);\n\n      if (gain != 1) {\n        this.resource_params.gain = gain;\n      } else {\n        delete this.resource_params.gain;\n      }\n\n      return (this.resource_url ? this.load(this.resource_url) : $q.resolve()).then(function () {\n        this.gain = gain;\n      }.bind(this)); // this.resource.setGain(gain).then((function(){\n      //     this.gain = gain;\n      // }).bind(this));\n    },\n    getVolume: function () {\n      return this.resource && this.resource.audio.volume;\n    },\n    setCurrentTime: function (time) {\n      if (this.resource) {\n        this.resource.setCurrentTime(time);\n      }\n    },\n    getCurrentTime: function () {\n      return this.resource && this.resource.audio && this.resource.audio.currentTime;\n    },\n    togglePopup: function () {\n      this.isPopupOpened = !this.isPopupOpened;\n    },\n    isPlaylistDataValid: function () {\n      return this.playlistData.playlistName && this.playlistData.playlistName.trim().length > 0;\n    },\n    closePopup: function () {\n      this.isPopupOpened = false;\n    },\n    savePlaylist: function () {\n      this.isSavingPlaylist = true; // create playlist\n\n      if (this.clustersData && this.clustersData.playlist) {\n        var self = this;\n        a2Playlists.create({\n          playlist_name: this.playlistData.playlistName,\n          params: this.clustersData.playlist.recordings,\n          aedIdsIncluded: true\n        }, function (data) {\n          self.isSavingPlaylist = false;\n          self.closePopup(); // attach aed to playlist\n\n          if (data && data.playlist_id) {\n            a2Playlists.attachAedToPlaylist({\n              playlist_id: data.playlist_id,\n              aed: self.clustersData.aed\n            }, function (data) {\n              self.playlistData = {};\n              notify.log('Audio event detections are saved in the playlist.');\n            });\n          }\n        });\n      }\n    },\n    _load_resource: function (url, params) {\n      this.loading = true;\n\n      if (params) {\n        var pk = Object.keys(params);\n\n        if (pk.length) {\n          var ch = /\\?/.test(url) ? '&' : '?';\n          url += ch + pk.map(function (k) {\n            return k + '=' + params[k];\n          }).join('&');\n        }\n      }\n\n      var resource = new A2AudioObject(url);\n      resource.onCompleteListeners.push(function () {\n        this.is_playing = false;\n      }.bind(this));\n      return resource.load_promise.then(function () {\n        this.loading = false;\n      }.bind(this)).then(function () {\n        return resource;\n      });\n    },\n    load: function (url) {\n      this.discard();\n      this.resource = undefined;\n      return this._load_resource(url, this.resource_params).then(function (resource) {\n        this.resource = resource;\n        this.duration = resource.duration;\n        this.resource_url = url;\n        this.has_recording = true;\n        this.clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n        console.log('clustersData', this.clustersData);\n      }.bind(this));\n    },\n    discard: function () {\n      this.stop();\n\n      if (this.resource) {\n        this.resource.discard();\n      }\n\n      this.has_recording = false;\n      this.resource = undefined;\n      this.resource_url = undefined;\n    },\n    mute: function (muted) {\n      if (this.resource) {\n        this.resource[muted ? 'mute' : 'unmute']();\n      }\n\n      this.is_muted = muted;\n    },\n    play: function () {\n      if (this.resource) {\n        this.resource.play();\n        this.is_playing = true;\n      }\n    },\n    pause: function () {\n      if (this.resource) {\n        this.resource.pause();\n      }\n\n      this.is_playing = false;\n    },\n    stop: function () {\n      if (this.resource) {\n        this.resource.stop();\n      }\n\n      this.is_playing = false;\n    },\n    prev_recording: function () {\n      this.scope.$broadcast('prev-visobject');\n    },\n    next_recording: function () {\n      this.scope.$broadcast('next-visobject');\n    },\n    download: function (visobject) {\n      if (a2UserPermit.isSuper()) return this.getExportUrl(visobject);\n\n      if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n        return notify.error('You do not have permission to download recording');\n      }\n\n      return this.getExportUrl(visobject);\n    },\n    getExportUrl: function (visobject) {\n      const form = document.createElement('form');\n      form.style.display = 'none';\n      form.method = 'GET';\n      const url = '/api/project/' + Project.getUrl() + '/recordings/download/' + visobject.id;\n      form.action = url;\n      document.body.appendChild(form);\n      form.submit();\n      document.body.removeChild(form);\n    }\n  };\n  return a2AudioPlayer;\n}).factory('A2AudioObject', ['$window', '$interval', '$q', function ($window, $interval, $q) {\n  var poll_loop_interval = 50; // 25;\n  // var AudioContext = $window.AudioContext || $window.webkitAudioContext;\n\n  function loadAudio(url) {\n    var deferred = $q.defer();\n    var audio = new $window.Audio();\n    url = url.replace('|', '/');\n    audio.addEventListener('error', function (err) {\n      console.log('err', err);\n      deferred.reject();\n    });\n    audio.addEventListener('loadstart', function () {\n      deferred.resolve(audio);\n    }); // bugfix for chrome...\n\n    $window.setTimeout(function () {\n      audio.src = url;\n    }, 1);\n    return deferred.promise;\n  }\n\n  var A2AudioObject = function (url) {\n    var d = $q.defer();\n    this.url = url;\n    this.onCompleteListeners = [];\n    this.interval = $interval(this._check_current_time.bind(this), poll_loop_interval);\n    this.load_promise = loadAudio(url).then(function (nativeAudio) {\n      this.audio = nativeAudio;\n      this.audio.addEventListener('canplay', function () {\n        this.duration = this.audio.duration;\n        this.paused = this.audio.paused;\n        this.src = this.audio.src;\n        this.canPlay = true;\n      }.bind(this));\n      this.audio.addEventListener('error', function (err) {\n        this.canPlay = false;\n        console.log(err);\n      }.bind(this));\n    }.bind(this), function (error) {\n      this.error = true;\n      console.log('Unable to listen to your recordings due to corrupted data');\n    }.bind(this));\n  };\n\n  A2AudioObject.prototype = {\n    // disconnect_ctx: function(){\n    //     return this.context.suspend().then((function(){\n    //         if(this.ctx_filter){\n    //             this.ctx_filter.max.disconnect();\n    //             this.ctx_filter.min.disconnect();\n    //         }\n    //         if(this.ctx_gain){\n    //             this.ctx_gain.disconnect();\n    //         }\n    //         this.ctx_source.disconnect();\n    //         return this.context.resume();\n    //     }).bind(this));\n    // },\n    // setup_ctx_connections: function(){\n    //     return this.context.suspend().then((function(){\n    //         var output = this.context.destination;\n    //         if(this.ctx_gain){\n    //             this.ctx_gain.connect(output);\n    //             output = this.ctx_gain;\n    //         }\n    //         if(this.ctx_filter){\n    //             this.ctx_filter.min.connect(output);\n    //             this.ctx_filter.max.connect(this.ctx_filter.min);\n    //             output = this.ctx_filter.max;\n    //         }\n    //         this.ctx_source.connect(output);\n    //         return this.context.resume();\n    //     }).bind(this));\n    // },\n    // setGain: function(gain){\n    //     var d = $q.defer();\n    //     this.gain = gain;\n    //     var created=false;\n    //     if(!this.ctx_gain){\n    //         this.ctx_gain = this.context.createGain();\n    //         created=true;\n    //     }\n    //     this.ctx_gain.gain.value = gain;\n    //     if(created){\n    //         this.setup_ctx_connections().then(d.resolve.bind(d), d.reject.bind(d));\n    //     } else {\n    //         d.resolve();\n    //     }\n    //     return d.promise;\n    // },\n    // setFrequencyFilter: function(filter){\n    //     var d = $q.defer();\n    //     d.resolve();\n    //     var promise = d.promise;\n    //     this.filter = filter;\n    //     var need_to_connect=false;\n    //     if(filter){\n    //         var f0 = Math.sqrt(filter.max * (filter.min||1)), bw = filter.max - filter.min;\n    //         var Q  = f0 / bw;\n    //         if(!this.ctx_filter){\n    //             this.ctx_filter = {\n    //                 min:this.context.createBiquadFilter(),\n    //                 max:this.context.createBiquadFilter()\n    //             };\n    //             this.ctx_filter.min.type.value = 'highpass';\n    //             this.ctx_filter.max.type.value = 'lopass';\n    //             this.ctx_filter.min.Q.value = 0.5;\n    //             this.ctx_filter.max.Q.value = 0.5;\n    //             need_to_connect = true;\n    //         }\n    //         this.ctx_filter.max.frequency.value = filter.max;\n    //         this.ctx_filter.min.frequency.value = filter.min;\n    //     } else if(!filter){\n    //         if(this.ctx_filter){\n    //             promise = this.disconnect_ctx().then((function(){\n    //                 this.ctx_filter = undefined;\n    //             }).bind(this));\n    //             need_to_connect = true;\n    //         }\n    //     }\n    //\n    //     if(need_to_connect){\n    //         promise = promise.then((function(){\n    //             return this.setup_ctx_connections();\n    //         }).bind(this));\n    //     }\n    //\n    //     return promise;\n    // },\n    play: function () {\n      // this.context.resume();\n      this.audio.play();\n      return this;\n    },\n    complete: function (callback) {\n      this.onCompleteListeners.push(callback);\n    },\n    pause: function () {\n      this.audio.pause(); // this.context.suspend();\n    },\n    restart: function () {\n      this.audio.pause(); // this.context.suspend();\n\n      this.audio.currentTime = 0;\n    },\n    stop: function () {\n      this.restart();\n    },\n    discard: function () {\n      if (!this.discarded) {\n        this.discarded = true;\n      }\n\n      if (this.context) {\n        this.context.close();\n        this.context = undefined;\n      }\n\n      if (this.interval) {\n        $interval.cancel(this.interval);\n        this.interval = undefined;\n      }\n    },\n    setVolume: function (volume) {\n      this.unmutedVolume = volume;\n      this.muted = false;\n      this.audio.volume = volume;\n    },\n    setPlaybackRate: function (rate) {\n      this.audio.playbackRate = rate;\n    },\n    setMuting: function (muting) {\n      this.muted = muting;\n      this.audio.volume = +this.muted * this.unmutedVolume;\n    },\n    setProgress: function (progress) {\n      if (this.audio && this.audio.duration && isFinite(progress)) {\n        this.audio.currentTime = this.audio.duration * progress;\n      }\n    },\n    setCurrentTime: function (currentTime) {\n      if (this.audio && this.audio.duration) {\n        this.audio.currentTime = currentTime;\n      }\n    },\n    _check_current_time: function () {\n      if (this.audio) {\n        this.currentTime = this.audio.currentTime;\n\n        if (this.currentTime >= this.duration) {\n          this.onCompleteListeners.forEach(function (listener) {\n            listener(this);\n          });\n        }\n      }\n    }\n  };\n  return A2AudioObject;\n}]);","angular.module('visualizer-layers', ['visualizer-services', 'a2.utils']).directive('a2VisualizerLayerItem', function (layer_types, $compile, $templateFetch) {\n  return {\n    restrict: 'E',\n    replace: true,\n    templateUrl: '/app/visualizer/layer-item/default.html',\n    link: function (scope, element, attrs) {\n      var layer_type = layer_types[scope.layer.type] ? scope.layer.type : false;\n      var layer_key = layer_types[layer_type] ? layer_types[layer_type].type : null;\n\n      if (layer_key && layer_key != 'default') {\n        var layer_url = '/app/visualizer/layer-item/' + layer_key + '.html';\n        var layer_tmp = $templateFetch(layer_url, function (layer_tmp) {\n          var layer_el = $compile(layer_tmp)(scope);\n          element.append(layer_el.children().unwrap());\n        });\n      }\n    }\n  };\n});","angular.module('visualizer-services', ['a2.services']).provider('layer_types', function () {\n  var type_array = [];\n  return {\n    addLayerType: function (layerType) {\n      type_array.push(layerType);\n      return this;\n    },\n    $get: function () {\n      var layer_types = {};\n      type_array.forEach(function (lt) {\n        layer_types[lt.type] = lt;\n      });\n      return layer_types;\n    }\n  };\n}).service('a2VisualizerLayers', function (layer_types, $controller) {\n  var layers = function ($scope, VisualizerCtrl) {\n    this.$scope = $scope;\n    this.VisualizerCtrl = VisualizerCtrl;\n    this.list = [];\n  };\n\n  layers.prototype = {\n    types: layer_types,\n    __new_layer__: function (layer_type) {\n      var layer_def = this.types[layer_type];\n\n      if (layer_def) {\n        var layer_maker = function () {};\n\n        layer_maker.prototype = layer_def;\n        var layer = new layer_maker();\n\n        if (layer.controller && typeof layer.controller == 'string') {\n          var cname = /^(.*?)( as (.*?))$/.exec(layer.controller);\n\n          if (cname) {\n            layer[cname[2] ? cname[3] : 'controller'] = $controller(cname[1], {\n              $scope: this.$scope,\n              VisualizerCtrl: this.VisualizerCtrl\n            });\n          }\n        }\n\n        return layer;\n      } else {\n        return null;\n      }\n    },\n    add: function () {\n      for (var a = arguments, i = 0, e = a.length; i < e; ++i) {\n        var layer_type = a[i];\n\n        if (layer_types[layer_type]) {\n          this.list.push(this.__new_layer__(layer_type));\n        } else {\n          console.warn(\"Unknown layer of type \" + layer_type + \".\");\n        }\n      }\n    },\n    __check_type: function (reqtype, curtype) {\n      if (reqtype instanceof Array) {\n        var idx = reqtype.indexOf(curtype);\n\n        if (idx == -1) {\n          return false;\n        }\n      } else if (curtype != reqtype) {\n        return false;\n      }\n\n      return true;\n    },\n    check_requirements: function (req) {\n      var browsetype = this.$scope.visobject_type;\n      var votype = this.$scope.visobject ? this.$scope.visobject.type : browsetype;\n\n      if (!req) {\n        return true;\n      } else if (req.selection && !this.$scope.visobject) {\n        return false;\n      } else if (req.type && !this.__check_type(req.type, votype)) {\n        return false;\n      } else if (req.browsetype && !this.__check_type(req.browsetype, browsetype)) {\n        return false;\n      } else if (req.that && !req.that(this.$scope)) {\n        return false;\n      }\n\n      return true;\n    },\n    sidebar_visible: function (l) {\n      if (l.sidebar_visible && !l.sidebar_visible($scope)) {\n        return false;\n      } else if (!this.check_requirements(l.require)) {\n        return false;\n      }\n\n      return true;\n    },\n    spectrogram_visible: function (l) {\n      return this.check_requirements(l.require) && l.visible;\n    },\n    display_sidebar: function (l) {\n      return !l.display || l.display.sidebar !== false;\n    },\n    display_spectrogram: function (l) {\n      return !l.display || l && l.display && l.display.spectrogram !== false;\n    }\n  };\n  return layers;\n}).provider('training_set_types', function () {\n  var training_set_types = [];\n  return {\n    add: function (type) {\n      training_set_types.push(type);\n      return this;\n    },\n    $get: function () {\n      return training_set_types.reduce(function (_, tst) {\n        _[tst.type] = tst;\n        return _;\n      }, {});\n    }\n  };\n}).controller('a2ProjectClasses', function (Project) {\n  var self = this;\n  Project.getClasses(function (list) {\n    self.list = list;\n  });\n}).service('a22PointBBoxEditor', function ($timeout, a2TrainingSets, training_set_types) {\n  var editor = function () {\n    this.min_eps = 0.001;\n    this.scalex = 1.0;\n    this.scaley = 0.001;\n    this.reset();\n  };\n\n  editor.prototype = {\n    reset: function () {\n      this.bbox = null;\n      this.points = null;\n      this.tracer = null;\n      this.valid = false;\n      return this;\n    },\n    make_new_bbox: function () {\n      this.bbox = {};\n      this.points = [];\n      this.valid = false;\n    },\n    add_tracer_point: function (x, y) {\n      if (this.bbox && !this.valid) {\n        var tracer = [x, y];\n        this.tracer = tracer;\n        this.validate([tracer]);\n      }\n    },\n    add_point: function (x, y, min_eps) {\n      min_eps = min_eps || this.min_eps;\n      var similars = this.points && this.points.filter(function (pt) {\n        var dx = (pt[0] - x) * this.scalex,\n            dy = (pt[1] - y) * this.scaley,\n            dd = dx * dx + dy * dy;\n        return dd <= min_eps;\n      });\n\n      if (similars && similars.length > 0) {\n        return;\n      }\n\n      if (!this.bbox) {\n        this.make_new_bbox();\n      }\n\n      if (this.points.length < 2) {\n        this.points.push([x, y]);\n      }\n\n      this.validate();\n    },\n    validate: function (tmp_points) {\n      var pts_x = this.points.map(function (x) {\n        return x[0];\n      });\n      var pts_y = this.points.map(function (x) {\n        return x[1];\n      });\n\n      if (tmp_points) {\n        pts_x.push.apply(pts_x, tmp_points.map(function (x) {\n          return x[0];\n        }));\n        pts_y.push.apply(pts_y, tmp_points.map(function (x) {\n          return x[1];\n        }));\n      }\n\n      this.bbox.x1 = Math.min.apply(null, pts_x);\n      this.bbox.y1 = Math.min.apply(null, pts_y);\n      this.bbox.x2 = Math.max.apply(null, pts_x);\n      this.bbox.y2 = Math.max.apply(null, pts_y);\n      this.valid = this.points.length >= 2;\n    }\n  };\n  editor.prototype.super = editor.prototype;\n  return editor;\n});","angular.module('a2.soundscapeRegionTags', ['a2.infotags']).directive('a2SoundscapeRegionTag', function ($injector) {\n  var clsprefix = 'label-';\n\n  var resolve_tag = function (scope, element, tag) {\n    var txt = element.children('.txt');\n    var label_classes = ['default', 'primary', 'success', 'info', 'warning', 'danger'];\n    var default_colors_by_type = {\n      species_sound: 'blue'\n    };\n\n    if (!tag) {\n      element.hide();\n    } else {\n      element.show();\n    }\n\n    scope.class = \"\";\n    scope.style = {};\n\n    if (typeof tag == 'string') {\n      txt.text(tag);\n      scope.class = clsprefix + \"default\";\n    } else {\n      var type = tag.type;\n      var text = tag.text || tag.tag;\n      var color = tag.color || 'default';\n      scope.count = tag.count === undefined ? '' : tag.count | 0;\n\n      if (type == 'species_sound') {\n        $injector.invoke(resolve_species_tag, this, {\n          element: txt,\n          text: text,\n          $scope: scope\n        });\n      } else {\n        type = 'normal';\n        txt.text(text);\n      }\n\n      if (color == 'default' && default_colors_by_type[type]) {\n        color = default_colors_by_type[type];\n      }\n\n      if (label_classes.indexOf(color) >= 0) {\n        scope.class = clsprefix + color;\n      } else {\n        scope.style['background-color'] = color;\n      }\n    }\n  };\n\n  var resolve_species_tag = function (element, text, $compile, $scope) {\n    element.empty().append($compile('<a2-species species=\"' + (text | 0) + '\"></a2-species species>')($scope));\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      tag: '=',\n      closeable: '=?',\n      showCount: '=?',\n      onClose: '&'\n    },\n    replace: true,\n    templateUrl: '/app/visualizer/soundscape-region-tag.html',\n    link: function (scope, element, $attrs) {\n      scope.$watch('tag', function (tag) {\n        resolve_tag(scope, element, tag);\n      });\n    }\n  };\n});","angular.module('visualizer-spectrogram', ['visualizer-services', 'a2.filter.round', 'a2.utils']).service('a2AffixCompute', function () {\n  return function ($viewport, $el, layout) {\n    var v;\n    var affix_c = $el.attr('data-affix-container');\n\n    if (affix_c) {\n      v = layout[affix_c];\n    }\n\n    if (!v) {\n      v = {\n        left: 0,\n        top: 0,\n        width: $viewport.width(),\n        height: $viewport.height()\n      };\n    }\n\n    var e = {\n      width: $el.width(),\n      height: $el.height()\n    };\n    var affix_left = $el.attr('data-affix-left') | 0;\n    var affix_right = $el.attr('data-affix-right');\n    var affix_align_h = $el.attr('data-affix-align-h');\n\n    if (affix_right !== undefined) {\n      affix_left = v.left + v.width - $el.width() - (affix_right | 0);\n    } else if (affix_align_h !== undefined) {\n      affix_left = v.left + (v.width - $el.width()) * affix_align_h;\n    } else {\n      affix_left += v.left;\n    }\n\n    var affix_top = $el.attr('data-affix-top') | 0;\n    var affix_bottom = $el.attr('data-affix-bottom');\n    var affix_align_v = $el.attr('data-affix-align-v');\n\n    if (affix_bottom !== undefined) {\n      affix_top = v.top + v.height - $el.height() - (affix_bottom | 0);\n    } else if (affix_align_v !== undefined) {\n      affix_top = v.top + (v.height - $el.height()) * affix_align_v;\n    } else {\n      affix_top += v.top;\n    }\n\n    $el.css({\n      position: 'absolute',\n      left: Math.round(affix_left + $viewport.scrollLeft()),\n      top: Math.round(affix_top + $viewport.scrollTop())\n    });\n  };\n}).directive('a2VisualizerSpectrogram', function (a2BrowserMetrics, a2AffixCompute) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/visualizer/visualizer-spectrogram.html',\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var layout_tmp = $scope.layout.tmp;\n      var views = {\n        viewport: $element.children('.spectrogram-container')\n      };\n\n      $scope.onPlaying = function (e) {\n        $scope.layout.y_axis.left = $element.scrollLeft();\n        $element.children('.axis-y').css({\n          left: $scope.layout.y_axis.left + 'px'\n        });\n        $scope.layout.x_axis.top = Math.min($scope.layout.spectrogram.top + $scope.layout.spectrogram.height, $element.scrollTop() + $element.height() - layout_tmp.axis_sizeh);\n        $element.children('.axis-x').css({\n          top: $scope.layout.x_axis.top + 'px'\n        });\n      };\n\n      $scope.onScrolling = function (e) {\n        var layout = $scope.layout;\n        var max_s_h = layout.spectrogram.height - layout.viewport.height;\n        var max_s_w = layout.spectrogram.width - layout.viewport.width;\n\n        if ($element.scrollTop() > max_s_h) {\n          $element.scrollTop(max_s_h);\n        }\n\n        if ($element.scrollLeft() > max_s_w) {\n          $element.scrollLeft(max_s_w);\n        }\n\n        layout.bbox = {\n          s1: ($element.scrollLeft() - layout.spectrogram.left) / layout.scale.sec2px,\n          s2: ($element.scrollLeft() - layout.spectrogram.left + $element.width()) / layout.scale.sec2px,\n          hz1: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop() - $element.height()) / layout.scale.hz2px,\n          hz2: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop()) / layout.scale.hz2px\n        };\n        layout.center = {\n          s: ($element.scrollLeft() - layout.spectrogram.left + $element.width() / 2.0) / layout.scale.sec2px,\n          hz: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop() - $element.height() / 2.0) / layout.scale.hz2px\n        };\n        layout.y_axis.left = $element.scrollLeft();\n        $element.children('.axis-y').css({\n          left: layout.y_axis.left + 'px'\n        });\n        layout.x_axis.top = $element.scrollTop() + $element.height() - layout_tmp.axis_sizeh - layout_tmp.gutter;\n        $element.children('.axis-x').css({\n          top: layout.x_axis.top - 1 + 'px'\n        });\n\n        if (layout.legend) {\n          layout.legend.left = $element.scrollLeft() + $element.width() - a2BrowserMetrics.scrollSize.width - layout_tmp.legend_width - layout_tmp.legend_gutter;\n          $element.children('.legend').css({\n            left: layout.legend.left + 'px'\n          });\n        }\n\n        $element.find('.a2-visualizer-spectrogram-affixed').each(function (i, el) {\n          a2AffixCompute($element, $(el), layout);\n        });\n      };\n\n      $scope.onMouseMove = function (e) {\n        var elOff = $element.offset();\n        var x = e.pageX - elOff.left + $element.scrollLeft() - $scope.layout.spectrogram.left;\n        var y = e.pageY - elOff.top + $element.scrollTop() - $scope.layout.spectrogram.top;\n        x = Math.min(Math.max(x, 0), $scope.layout.spectrogram.width);\n        y = Math.min(Math.max(y, 0), $scope.layout.spectrogram.height);\n        $scope.pointer.x = x;\n        $scope.pointer.y = y;\n        $scope.pointer.sec = $scope.layout.x2sec(x);\n        $scope.pointer.hz = $scope.layout.y2hz(y);\n      };\n\n      var make_axis = function (domain, scale, orientation) {\n        var axis = d3.svg.axis();\n\n        if (domain.ticks) {\n          axis.ticks(domain.ticks);\n        }\n\n        if (domain.tick_format) {\n          axis.tickFormat(domain.tick_format);\n        } else if (domain.unit_format) {\n          axis.tickFormat(domain.unit_format);\n        }\n\n        axis.scale(scale).orient(orientation);\n        return axis;\n      };\n\n      $scope.layout.listeners.push(function (layout, container, $scope, width, height, fix_scroll_center) {\n        doLayout(layout, container, $scope, width, height, fix_scroll_center);\n      });\n\n      function doLayout(layout, container, $scope, width, height, fix_scroll_center) {\n        var domain = layout.l.domain || {};\n        var components = {\n          visualizer_root: container,\n          spectrogram: container.children('.spectrogram-container'),\n          y_axis: domain.y && container.children('.axis-y'),\n          x_axis: domain.x && container.children('.axis-x'),\n          legend: domain.legend && container.children('.legend')\n        };\n        Object.keys(components).forEach(function (i) {\n          var component = components[i];\n\n          if (component) {\n            var $li = component;\n            var li = layout.l[i];\n\n            if (li.css) {\n              $li.css(li.css);\n            }\n\n            if (li.attr) {\n              $li.attr(li.attr);\n            }\n          }\n        });\n\n        if (domain.x) {\n          doXAxisLayout(layout);\n        }\n\n        if (domain.y) {\n          doYAxisLayout(layout);\n        }\n\n        if (domain.legend) {\n          doLegendLayout(layout);\n        }\n\n        if (fix_scroll_center) {\n          $element.scrollTop(Math.min(layout.l.scroll_center.top, layout.l.spectrogram.css.height - layout.viewport.height));\n          $element.scrollLeft(Math.min(layout.l.scroll_center.left, layout.l.spectrogram.css.width - layout.viewport.width));\n        }\n\n        $scope.onScrolling();\n      }\n\n      function doXAxisLayout(layout) {\n        var d3_x_axis = d3.select($element.children('.axis-x').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        var scalex = layout.l.scale.x;\n        d3_x_axis.style('height', 100);\n        d3_x_axis.style('scale', 'none');\n        d3_x_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 1,\n          width: layout.l.x_axis.attr.width,\n          height: spec_h + layout_tmp.axis_lead\n        });\n        d3_x_axis.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.axis_lead + ', 1)').call(make_axis(domain.x, scalex, \"bottom\"));\n      }\n\n      function doYAxisLayout(layout) {\n        var d3_y_axis = d3.select($element.children('.axis-y').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        var scaley = layout.l.scale.y;\n        d3_y_axis.style('width', 61);\n        d3_y_axis.style('scale', 'none');\n        d3_y_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 0,\n          width: layout.l.y_axis.attr.width + 1,\n          height: spec_h + layout_tmp.axis_lead + 1\n        });\n        d3_y_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 0,\n          width: layout.l.y_axis.attr.width - layout_tmp.axis_lead,\n          height: spec_h + layout_tmp.axis_lead + layout_tmp.axis_sizeh\n        });\n        d3_y_axis.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.axis_sizew + ', ' + layout_tmp.axis_lead + ')').call(make_axis(domain.y, scaley, \"left\"));\n      }\n\n      function doLegendLayout(layout) {\n        var d3_legend = d3.select($element.children('.legend').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        d3_legend.append(\"rect\").attr({\n          class: 'bg',\n          x: layout_tmp.axis_lead,\n          y: 0,\n          width: layout.l.legend.attr.width,\n          height: layout.l.legend.attr.height\n        });\n        d3_legend.append(\"image\").attr({\n          class: 'legend-image',\n          x: layout_tmp.legend_axis_w,\n          y: layout_tmp.axis_lead,\n          width: layout_tmp.legend_width - layout_tmp.legend_axis_w,\n          height: spec_h,\n          preserveAspectRatio: 'none',\n          'xlink:href': domain.legend.src\n        });\n        d3_legend.append(\"rect\").attr({\n          class: 'border',\n          x: layout_tmp.legend_axis_w,\n          y: layout_tmp.axis_lead,\n          width: layout_tmp.legend_width - layout_tmp.legend_axis_w,\n          height: spec_h\n        });\n        d3_legend.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.legend_axis_w + ', ' + (layout_tmp.axis_lead + 1) + ')').call(make_axis(domain.legend, layout.l.scale.legend, \"left\"));\n      }\n\n      $scope.getRecordingPlaybackTime = function () {\n        return $scope.audio_player.getCurrentTime();\n      };\n\n      $scope.$watch(function () {\n        return {\n          'h': $element.height(),\n          'w': $element.width()\n        };\n      }, function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, newValue.w, newValue.h, true);\n      }, true);\n      $scope.$watch(function () {\n        return $scope.layout.scale.sec2px * $scope.getRecordingPlaybackTime() | 0;\n      }, function (newValue, oldValue) {\n        if ($scope.audio_player.is_playing) {\n          var pbh = layout_tmp.axis_sizew + newValue;\n          var sl = $element.scrollLeft(),\n              slw = sl + $element.width() / 2;\n          var dx = pbh - slw;\n\n          if (dx > 0) {\n            $element.scrollLeft(sl + dx);\n          }\n        }\n      }, true);\n      $scope.$watch('visobject', function (newValue, oldValue) {\n        $element.scrollLeft(0);\n        $element.scrollTop(999999);\n        $scope.layout.apply($element, $scope, $element.width(), $element.height());\n      }, true);\n      $element.bind('resize', function () {\n        $scope.$apply();\n      });\n      $scope.$watch('layout.scale.zoom.x', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.$watch('layout.scale.zoom.y', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.$watch('layout.scale.originalScale', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.layout.apply($element, $scope, $element.width(), $element.height());\n      $scope.onScrolling();\n    }\n  };\n}).directive('a2VisualizerSpectrogramLayer', function (layer_types, $compile, $templateFetch) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/visualizer/spectrogram-layer/default.html',\n    replace: true,\n    link: function (scope, element, attrs) {\n      //console.log(\"link     : function(scope, element, attrs){\", scope, element, attrs);\n      var layer_type = layer_types[scope.layer.type] ? scope.layer.type : false;\n      var layer_key = layer_types[layer_type] ? layer_types[layer_type].type : null;\n      element.addClass(layer_type);\n\n      if (layer_key && layer_key != 'default') {\n        var layer_url = '/app/visualizer/spectrogram-layer/' + layer_key + '.html';\n        var layer_tmp = $templateFetch(layer_url, function (layer_tmp) {\n          var layer_el = $compile(layer_tmp)(scope);\n          element.append(layer_el);\n        });\n      }\n    }\n  };\n}).directive('a2VisualizerSpectrogramAffixed', function (a2AffixCompute, $debounce) {\n  return {\n    restrict: 'A',\n    link: function ($scope, $element, $attrs) {\n      $element.addClass('a2-visualizer-spectrogram-affixed');\n      var $root = $element.closest('.visualizer-root');\n      var $eloff = $element.offset(),\n          $roff = $root.offset();\n\n      if ($roff) {\n        if ($element.attr('data-affix-left') === undefined) {\n          $element.attr('data-affix-left', $eloff.left - $roff.left);\n        }\n\n        if ($element.attr('data-affix-top') === undefined) {\n          $element.attr('data-affix-top', $eloff.top - $roff.top);\n        }\n      }\n\n      if ($attrs.a2VisualizerSpectrogramAffixed) {\n        $scope.$watch($attrs.a2VisualizerSpectrogramAffixed, function (newval, oldval) {\n          var i;\n\n          if (oldval) {\n            for (i in oldval) {\n              $element.attr('data-affix-' + i, null);\n            }\n          }\n\n          if (newval) {\n            for (i in newval) {\n              $element.attr('data-affix-' + i, newval[i]);\n            }\n          }\n        });\n        a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      }\n\n      a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      $scope.$watch(function () {\n        return $element.width() * $element.height();\n      }, $debounce(function () {\n        a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      }));\n    }\n  };\n});","angular.module('a2.speciesValidator', ['a2.utils', 'a2.infotags']).directive('a2SpeciesValidator', function (Project, a2UserPermit, notify, $filter) {\n  var project = Project;\n  return {\n    restrict: 'E',\n    scope: {\n      recording: '=recording'\n    },\n    templateUrl: '/app/visualizer/validator-main.html',\n    link: function ($scope, $element, $attrs) {\n      var class2key = function (project_class) {\n        var cls;\n\n        if (/number|string/.test(typeof project_class)) {\n          cls = $scope.classes.filter(function (pc) {\n            return pc.id == project_class;\n          }).shift();\n        } else {\n          cls = project_class;\n        }\n\n        return cls && [cls.species, cls.songtype].join('-');\n      };\n\n      var add_validation = function (validation) {\n        var key = [validation.species, validation.songtype].join('-');\n        var present = Object.values({\n          present: validation.present,\n          presentReview: validation.presentReview,\n          presentAed: validation.presentAed\n        });\n        $scope.validations[key] = present;\n      };\n\n      var load_project_classes = function () {\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n          var taxons = {};\n\n          for (var i = 0; i < classes.length; i++) {\n            var c = classes[i];\n            if (!taxons[c.taxon]) taxons[c.taxon] = [];\n            taxons[c.taxon].push(c);\n          }\n\n          for (var t in taxons) {\n            taxons[t] = $filter('orderBy')(taxons[t], ['species_name', 'songtype_name']);\n          }\n\n          $scope.byTaxon = taxons;\n          $scope.taxons = Object.keys($scope.byTaxon).sort();\n        });\n      };\n\n      $scope.$on('a2-persisted', load_project_classes);\n      $scope.classes = [];\n      $scope.is_selected = {};\n\n      $scope.select = function (taxon, project_class, $event) {\n        if ($($event.target).is('a')) {\n          return;\n        }\n\n        if ($event.shiftKey) {\n          $scope.is_selected[project_class.id] = true;\n          var sel_range = {\n            from: Infinity,\n            to: -Infinity\n          };\n          var taxonSpecies = $scope.byTaxon[taxon];\n          taxonSpecies.forEach(function (pc, idx) {\n            if ($scope.is_selected[pc.id]) {\n              sel_range.from = Math.min(sel_range.from, idx);\n              sel_range.to = Math.max(sel_range.to, idx);\n            }\n          });\n\n          for (var si = sel_range.from, se = sel_range.to + 1; si < se; ++si) {\n            $scope.is_selected[taxonSpecies[si].id] = true;\n          }\n        } else if ($event.ctrlKey) {\n          $scope.is_selected[project_class.id] = !$scope.is_selected[project_class.id];\n        } else {\n          $scope.is_selected = {};\n          $scope.is_selected[project_class.id] = true;\n        }\n      };\n\n      $scope.validations = {};\n\n      $scope.validate = function (val) {\n        if (!a2UserPermit.can('validate species')) {\n          notify.error('You do not have permission to validate species');\n          return;\n        }\n\n        var keys = [],\n            key_idx = {};\n        var k; // var k = class2key(project_class);\n        // if (k && !key_idx[k]) {\n        //     key_idx[k] = true;\n        //     keys.push(k);\n        // }\n        // sel_pc_id -> selected project class id\n\n        for (var sel_pc_id in $scope.is_selected) {\n          if ($scope.is_selected[sel_pc_id]) {\n            k = class2key(sel_pc_id);\n\n            if (k && !key_idx[k]) {\n              key_idx[k] = true;\n              keys.push(k);\n            }\n          }\n        }\n\n        if (keys.length > 0) {\n          Project.validateRecording($scope.recording.id, {\n            'class': keys.join(','),\n            val: val,\n            determinedFrom: 'visualizer'\n          }, function (validations) {\n            validations.forEach(function (validation) {\n              var key = class2key(validation);\n\n              if (validation.val == 2) {\n                delete $scope.validations[key];\n              } else {\n                $scope.validations[key] = Object.values({\n                  present: validation.val,\n                  presentReview: 0\n                });\n              }\n            });\n          });\n        }\n      };\n\n      $scope.val_options = [{\n        label: \"Clear\",\n        val: 2\n      }, {\n        label: \"Present\",\n        val: 1\n      }, {\n        label: \"Absent\",\n        val: 0\n      }];\n\n      $scope.val_state = function (project_class, val_options) {\n        if (!val_options) {\n          val_options = $scope.val_options;\n        }\n\n        var key = class2key(project_class),\n            val = $scope.validations[key];\n\n        if (typeof val === 'undefined') {\n          return;\n        } else {\n          if (val[0] == 1 || val[1] > 0 || val[2] > 0) {\n            val_options[1].showDropdown = val[1] > 0 || val[2] > 0;\n            return val_options[1];\n          }\n\n          if (val[0] == null && val[1] == 0 && val[2] == 0) {\n            return;\n          } else {\n            return val_options[2];\n          }\n        }\n      };\n\n      $scope.$watch('recording', function (recording) {\n        $scope.validations = {};\n\n        if (recording && recording.validations) {\n          recording.validations.forEach(add_validation);\n        }\n      });\n      load_project_classes();\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name visualizer-sidebar\n * @description\n * Sidebar directive for the visualizer module.\n */\nangular.module('a2.visualizer.directive.sidebar', []).directive('visualizerSidebar', function () {\n  return {\n    restrict: 'E',\n    transclude: true,\n    templateUrl: '/app/visualizer/visualizer-sidebar.html',\n    scope: {\n      closed: '=?'\n    },\n    link: function (scope, element, attrs) {\n      element.addClass(\"sidebar show\");\n      checkClosed();\n\n      scope.toggleSidebar = function () {\n        scope.closed = !scope.closed;\n        checkClosed();\n      };\n\n      function checkClosed() {// element[scope.closed ? 'addClass' : 'removeClass'](\"collapsed\");\n      }\n    }\n  };\n});","// $(document)\n//   .on('click.bs.dropdown.data-api', '.dropdown .dropdown-form', function (e) { e.stopPropagation(); });\n\n/**\n * @ngdoc overview\n * @name visualizer\n * @description\n * This is the main visualizer module.\n */\nangular.module('a2.visualizer', ['ui.router', 'ct.ui.router.extras', 'a2.services', 'a2.utils', 'a2.visobjects', 'a2.visualizer.dialog', 'a2.visobjectsbrowser', 'a2.speciesValidator', 'visualizer-layers', 'a2.visualizer.directive.sidebar', 'a2.visualizer.layers.base-image-layer', 'a2.visualizer.layers.annotation-layer', 'a2.visualizer.layers.zoom-input-layer', 'a2.visualizer.layers.data-plot-layer', 'a2.visualizer.layers.recordings', 'a2.visualizer.layers.recording-soundscape-region-tags', 'a2.visualizer.layers.recording-tags', 'a2.visualizer.layers.species-presence', 'a2.visualizer.layers.soundscapes', 'a2.visualizer.layers.soundscape-composition-tool', 'a2.visualizer.layers.training-sets', 'a2.visualizer.layers.templates', 'a2.visualizer.layers.audio-events-layer', 'visualizer-spectrogram', 'visualizer-services', 'a2.visualizer.audio-player', 'a2-visualizer-spectrogram-Layout', 'a2-visualizer-spectrogram-click2zoom', 'a2.url-update-service', 'ui.bootstrap'])\n/**\n * @ngdoc service\n * @name a2-visualizer-spectrogram-Layout.factory:VisualizerLayout\n * @description\n * The layout manager for the spectrogram.\n */\n.config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('visualizer', {\n    url: '/visualizer',\n    views: {\n      'visualizer': {\n        controller: 'VisualizerCtrl',\n        templateUrl: '/app/visualizer/main.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  }).state('visualizer.view', {\n    url: '/:type/:idA/:idB/:idC?gain&filter&a&clusters',\n    params: {\n      type: '',\n      a: null,\n      clusters: null,\n      gain: null,\n      filter: null,\n      idA: {\n        value: '',\n        squash: true\n      },\n      idB: {\n        value: null,\n        squash: true\n      },\n      idC: {\n        value: null,\n        squash: true\n      }\n    },\n    controller: function ($state, $scope) {\n      var p = $state.params;\n      var lc = [p.type];\n\n      if (p.idA) {\n        lc.push(p.idA);\n\n        if (p.idB) {\n          lc.push(p.idB);\n\n          if (p.idC) {\n            lc.push(p.idC);\n          }\n        }\n      }\n\n      var l = lc.join('/');\n      $scope.location.whenBrowserIsAvailable(function () {\n        $scope.$parent.$broadcast('set-browser-location', l, p.a); // Catch the navigation URL query\n\n        if (p.type === 'rec') {\n          $scope.$parent.$broadcast('set-browser-annotations', p.idA ? Number(p.idA) : null, p.a ? p.a : null);\n        }\n      });\n\n      if ($scope.parseAnnotations) {\n        $scope.parseAnnotations(p.a);\n      }\n    }\n  });\n}).directive('a2Visualizer', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {},\n    controller: 'VisualizerCtrl',\n    templateUrl: '/app/visualizer/main.html'\n  };\n}).service('a2VisualizerLocationManager', function ($location) {\n  var locman = function (scope, prefix, state) {\n    this.scope = scope;\n    this.state = state;\n    this.prefix = prefix;\n    this.current = '';\n    this.__expected = '';\n  };\n\n  locman.prototype = {\n    sync: function () {\n      if (this.current == this.__expected) {\n        return;\n      }\n\n      this.__expected = this.current;\n      this.scope.$broadcast('set-browser-location', this.current);\n    },\n    update_path: function () {\n      this.set(this.current);\n    },\n    updateParams: function (params) {\n      var all_params = angular.extend({}, this.state.params);\n\n      for (var pk in params) {\n        var pv = params[pk];\n\n        if (pv === undefined) {\n          delete all_params[pk];\n        } else {\n          all_params[pk] = pv;\n        }\n      }\n\n      console.log(all_params, this.state.current.name);\n      this.state.transitionTo(this.state.current.name, all_params, {\n        notify: false\n      });\n    },\n    set: function (location, dont_sync) {\n      if (dont_sync) {\n        this.__expected = location;\n      }\n\n      if ($location.path() != this.prefix + location) {\n        console.log('a2VisualizerLocationManager::set_location', this.prefix + location, dont_sync);\n        var search = $location.search();\n        delete search.a;\n        $location.path(this.prefix + location);\n        $location.search(search);\n      }\n    },\n    path_changed: function (path) {\n      if (path === undefined) {\n        path = $location.path();\n      }\n\n      path = '' + path;\n\n      if (path.indexOf(this.prefix) === 0) {\n        this.current = path.substr(this.prefix.length);\n      }\n    },\n    whenBrowserIsAvailable: function (callback) {\n      if (this.browserAvailable) {\n        callback();\n      } else {\n        (this.__onBrowserAvailable__ || (this.__onBrowserAvailable__ = [])).push(callback);\n      }\n    },\n    notifyBrowserAvailable: function () {\n      this.browserAvailable = true;\n\n      if (this.__onBrowserAvailable__) {\n        this.__onBrowserAvailable__.forEach(function (callback) {\n          callback();\n        });\n\n        delete this.__onBrowserAvailable__;\n      }\n    }\n  };\n  return locman;\n}).controller('VisualizerCtrl', function (a2VisualizerLayers, $q, $location, $state, $scope, $localStorage, $timeout, itemSelection, Project, $controller, a2UserPermit, a2SpectrogramClick2Zoom, $rootScope, VisualizerObjectTypes, VisualizerLayout, a2AudioPlayer, a2VisualizerLocationManager, a2EventEmitter) {\n  var events = new a2EventEmitter();\n  this.on = events.on.bind(events);\n  this.off = events.off.bind(events);\n  var layers = new a2VisualizerLayers($scope, this);\n  var layer_types = layers.types;\n  var initial_state_params = {\n    gain: $state.params.gain,\n    filter: $state.params.filter\n  };\n\n  $scope.parseAnnotations = function (annotationsString) {\n    $scope.annotations = annotationsString ? (Array.isArray(annotationsString) ? annotationsString : annotationsString.split('|')).map(function (item) {\n      var comps = item.split(',');\n      var parsed = {\n        type: comps.shift(),\n        value: []\n      };\n      comps.forEach(function (comp) {\n        var pair = comp.split(':');\n\n        if (pair.length > 1) {\n          var key = pair.shift();\n          parsed[key] = pair[1].join(':');\n        } else {\n          parsed.value.push(comp);\n        }\n      });\n      return parsed;\n    }) : [];\n  }; // check selected clusters in query\n\n\n  if ($state.params.clusters) {\n    $localStorage.setItem('analysis.clusters.playlist', $state.params.idA);\n  }\n\n  $scope.parseAnnotations($state.params.a);\n  $scope.layers = layers.list; // current layers in the visualizer\n\n  $scope.addLayer = layers.add.bind(layers);\n  $scope.fullfillsRequirements = layers.check_requirements.bind(layers);\n  $scope.isSidebarVisible = layers.sidebar_visible.bind(layers);\n  $scope.isSpectrogramVisible = layers.spectrogram_visible.bind(layers);\n  $scope.canDisplayInSidebar = layers.display_sidebar.bind(layers);\n  $scope.canDisplayInSpectrogram = layers.display_spectrogram.bind(layers);\n\n  if (a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper()) {\n    layers.add('base-image-layer', 'recording-layer', 'templates', 'zoom-input-layer');\n  } else {\n    layers.add('base-image-layer', 'annotation-layer', 'data-plot-layer', 'recording-layer', 'recording-tags-layer', 'soundscape-info-layer', 'soundscape-regions-layer', 'recording-soundscape-region-tags', 'species-presence', 'training-data', 'templates', 'soundscape-composition-tool', 'zoom-input-layer', 'audio-events-layer');\n  }\n\n  $scope.visobject = null;\n  var location = new a2VisualizerLocationManager($scope, '/visualizer' + '/', $state);\n  $scope.location = location;\n  $scope.annotation = {};\n  $scope.set_location = location.set.bind(location);\n  $scope.layout = new VisualizerLayout();\n  $scope.click2zoom = new a2SpectrogramClick2Zoom($scope.layout);\n  $scope.Math = Math;\n  $scope.pointer = {\n    x: 0,\n    y: 0,\n    sec: 0,\n    hz: 0\n  };\n  $scope.selection = itemSelection.make('layer');\n\n  $scope.getLayers = function () {\n    return $scope.layers;\n  };\n\n  $scope.setVisObject = function (visobject, type, location) {\n    if ($scope.isUploading) return;\n    $scope.isUploading = true;\n    return $q.resolve().then(function () {\n      if (visobject) {\n        $scope.visobject_location = location;\n        $scope.location.set(location, true);\n        var visobject_loader = VisualizerObjectTypes.getLoader(type);\n        $scope.loading_visobject = visobject_loader.getCaptionFor(visobject);\n        return visobject_loader.load(visobject, $scope).then(function (visobject) {\n          console.log('VisObject loaded : ', visobject);\n          $scope.$parent.$broadcast('clear-recording-data', true); // check clusters playlist in local storage else clear local storage\n\n          if ($localStorage.getItem('analysis.clusters.playlist') === $state.params.idA) {\n            var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n            console.log('clustersData', this.clustersData);\n\n            if (clustersData && clustersData.boxes && $state.params.idB) {\n              this.parseAnnotations(clustersData.boxes[$state.params.idB]);\n            }\n          } else {\n            $scope.removeFromLocalStorage();\n            this.parseAnnotations($location.search().a);\n          }\n\n          $scope.loading_visobject = false;\n          $scope.visobject = visobject;\n          $scope.visobject_type = visobject.type;\n          $scope.setYScaleOptions();\n        }.bind(this));\n      } else {\n        $scope.visobject = null;\n      }\n    }.bind(this)).then(function () {\n      events.emit('visobject', $scope.visobject);\n      $scope.isUploading = false;\n    });\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  }; // Resize Y scale.\n\n\n  $scope.getSelectedFrequencyCache = function () {\n    try {\n      return JSON.parse($localStorage.getItem('visuilizer.frequencies.cache')) || {\n        originalScale: true\n      };\n    } catch (e) {\n      return {\n        originalScale: true\n      };\n    }\n  };\n\n  $scope.deselectFrequencyOptions = function () {\n    $scope.yAxisOptions.forEach(function (item) {\n      return item.active = false;\n    });\n  };\n\n  $scope.setYScaleOptions = function () {\n    // Get selected frequency.\n    $scope.scaleCache = $scope.getSelectedFrequencyCache(); // Get recording frequency.\n\n    $scope.convertedScale = $scope.visobject && $scope.visobject.max_freq ? +$scope.visobject.max_freq / 1000 : 'X'; // Set frequency options with default y-scale value.\n\n    $scope.yAxisOptions = [{\n      title: '24 kHz scale',\n      value: '24_scale',\n      active: false\n    }, {\n      title: 'Original scale (' + $scope.convertedScale + ' kHz)',\n      value: 'original_scale',\n      active: true\n    }]; // Set frequency options with saved frequency.\n\n    if ($scope.scaleCache && !$scope.scaleCache.originalScale && $scope.convertedScale < 24) {\n      $scope.deselectFrequencyOptions();\n      $scope.yAxisOptions[0].active = true;\n    } // Display original frequency for recording whith 24kHz or more.\n\n\n    if ($scope.convertedScale >= 24) {\n      $scope.deselectFrequencyOptions();\n      $scope.yAxisOptions[1].active = true;\n    }\n  };\n\n  $scope.resizeYScale = function (item) {\n    $scope.deselectFrequencyOptions();\n    item.active = true;\n    var originalScale = item.value === 'original_scale';\n    $localStorage.setItem('visuilizer.frequencies.cache', JSON.stringify({\n      originalScale: originalScale\n    }));\n    $scope.layout.scale.originalScale = originalScale;\n    var span = originalScale ? $scope.visobject.sampling_rate / 2 : 24000;\n    $scope.visobject.domain.y.to = span;\n    $scope.visobject.domain.y.span = span;\n  };\n\n  $scope.audio_player = new a2AudioPlayer($scope, initial_state_params);\n  $scope.$on('browser-vobject-type', function (evt, type) {\n    $scope.visobject_type = type;\n  });\n  $scope.$on('browser-available', function () {\n    $scope.location.notifyBrowserAvailable();\n  });\n  $rootScope.$on('notify-visobj-updated', function () {\n    var args = Array.prototype.slice.call(arguments, 1);\n    args.unshift('visobj-updated');\n    $scope.$broadcast.apply($scope, args);\n  });\n  $scope.$on('visobj-updated', function (visobject) {\n    $scope.setVisObject($scope.visobject, $scope.visobject_type, $scope.visobject_location);\n  });\n}).filter('filterPresentCount', function () {\n  return function (validations) {\n    if (!validations) return 0;\n    var count = 0;\n    validations.forEach(function (validation) {\n      if (validation.presentReview > 0 || validation.presentAed > 0 || validation.present == 1) {\n        count++;\n      }\n    });\n    return count;\n  };\n}).filter('filterAbsentCount', function () {\n  return function (validations) {\n    if (!validations) return 0;\n    var count = 0;\n    validations.forEach(function (validation) {\n      if (validation.presentReview == 0 && validation.presentAed == 0 && validation.present == 0) {\n        count++;\n      }\n    });\n    return count;\n  };\n});\n/**\n * @ngdoc overview\n * @name a2-visualizer-spectrogram-Layout\n * @description\n * This module stores the layout manager for the spectrogram.\n */\n\nangular.module('a2-visualizer-spectrogram-Layout', ['a2.classy', 'a2-plot-specs']).factory('VisualizerLayoutSpecs', function (PlotSpecs) {\n  return PlotSpecs;\n})\n/**\n * @ngdoc service\n * @name a2-visualizer-spectrogram-Layout.factory:VisualizerLayout\n * @description\n * The layout manager for the spectrogram.\n */\n.factory('VisualizerLayout', function (a2BrowserMetrics, makeClass, VisualizerLayoutSpecs, $localStorage) {\n  var align_to_interval = function (unit, domain, align) {\n    if (align === undefined || !domain || !domain.unit_interval) {\n      return unit;\n    } else {\n      var f = domain.from || 0,\n          u = domain.unit_interval;\n      unit = Math.floor((unit - f) / u) * u + f;\n      return unit + align * u;\n    }\n  };\n\n  var get_domain = function (visobject) {\n    return visobject && visobject.domain || {\n      x: {\n        from: 0,\n        to: 60,\n        span: 60,\n        ticks: 60,\n        unit: 'Time ( s )'\n      },\n      y: {\n        from: 0,\n        to: 22050,\n        span: 22050,\n        unit: 'Frequency ( kHz )',\n        tick_format: function (v) {\n          return v / 1000 | 0;\n        }\n      }\n    };\n  };\n\n  var make_scale = function (domain, range) {\n    var s;\n\n    if (domain.ordinal) {\n      var dd = domain.to - domain.from;\n      var dr = range[1] - range[0];\n      var scale = dr / dd;\n      s = d3.scale.linear().domain([domain.from, domain.to]).range([scale / 2 + range[0], range[1] - scale / 2]);\n    } else {\n      s = d3.scale.linear().domain([domain.from, domain.to]).range(range);\n    }\n\n    return s;\n  };\n\n  var linear_interpolate = function (x, levels) {\n    var l = x * (levels.length - 1);\n    var f = Math.floor(l),\n        c = Math.ceil(l),\n        m = l - f;\n    return levels[f] * (1 - m) + levels[c] * m;\n  };\n\n  var interpolate = linear_interpolate;\n  return makeClass({\n    constructor: function () {\n      this.scale = {\n        def_sec2px: 100 / 1.0,\n        def_hz2px: 100 / 5000.0,\n        max_sec2px: 100 / (1.0 / 8),\n        max_hz2px: 100 / (5000.0 / 8),\n        zoom: {\n          x: 0,\n          y: 0\n        },\n        sec2px: 100 / 1.0,\n        hz2px: 100 / 5000.0,\n        originalScale: null\n      };\n      this.offset = {\n        sec: 0,\n        hz: 0\n      };\n      this.tmp = VisualizerLayoutSpecs;\n      this.domain = {};\n      this.listeners = [];\n    },\n    x2sec: function (x, interval_align) {\n      var seconds = x / this.scale.sec2px;\n      seconds += this.offset.sec;\n      return align_to_interval(+seconds, this.domain.x, interval_align);\n    },\n    y2hz: function (y, interval_align) {\n      var h = (this.spectrogram && this.spectrogram.height) | 0;\n      var hertz = (h - y) / this.scale.hz2px;\n      hertz += this.offset.hz;\n      return align_to_interval(+hertz, this.domain.y, interval_align);\n    },\n    sec2x: function (seconds, round, interval_align) {\n      seconds = align_to_interval(seconds - this.offset.sec, this.domain.x, interval_align);\n      var x = seconds * this.scale.sec2px;\n      return round ? x | 0 : +x;\n    },\n    hz2y: function (hertz, round, interval_align) {\n      hertz = align_to_interval(hertz - this.offset.hz, this.domain.y, interval_align);\n      var h = (this.spectrogram && this.spectrogram.height) | 0;\n      var y = h - hertz * this.scale.hz2px;\n      return round ? y | 0 : +y;\n    },\n    dsec2width: function (seconds1, seconds2, round, inclusive) {\n      if (inclusive) {\n        seconds1 = align_to_interval(seconds1, this.domain.x, 1);\n      }\n\n      var w = (seconds1 - seconds2) * this.scale.sec2px;\n      return round ? w | 0 : +w;\n    },\n    dhz2height: function (hz1, hz2, round, inclusive) {\n      if (inclusive) {\n        hz1 = align_to_interval(hz1, this.domain.y, 1);\n      }\n\n      var h = (hz1 - hz2) * this.scale.hz2px;\n      return round ? h | 0 : +h;\n    },\n    apply: function (container, $scope, width, height, fix_scroll_center) {\n      var layout = $scope.visobject && $scope.visobject.layout;\n      this.type = layout || 'spectrogram';\n      this['apply_' + this.type](container, $scope, width, height, fix_scroll_center);\n\n      for (var eh = this.listeners, ehi = 0, ehe = eh.length; ehi < ehe; ++ehi) {\n        eh[ehi](this, container, $scope, width, height, fix_scroll_center);\n      }\n    },\n    apply_spectrogram: function (container, $scope, width, height, fix_scroll_center) {\n      var layout_tmp = this.tmp;\n      var visobject = $scope.visobject;\n      var domain = this.domain = get_domain(visobject);\n      var avail_w = width - layout_tmp.axis_sizew - layout_tmp.axis_lead;\n\n      if (domain.legend) {\n        avail_w -= layout_tmp.legend_width + layout_tmp.legend_gutter;\n      }\n\n      var avail_h = height - layout_tmp.axis_sizeh - layout_tmp.axis_lead - layout_tmp.gutter;\n      var cheight = container[0].clientHeight;\n      var zoom_levels_x = this.scale.zoom.levelx = [avail_w / domain.x.span, this.scale.max_sec2px];\n      var zoom_levels_y = this.scale.zoom.levely = [avail_h / domain.y.span, this.scale.max_hz2px];\n      var zoom_sec2px = interpolate(this.scale.zoom.x, zoom_levels_x);\n      var zoom_hz2px = interpolate(this.scale.zoom.y, zoom_levels_y);\n      var spec_w = Math.max(avail_w, Math.ceil(domain.x.span * zoom_sec2px));\n      var spec_h = Math.max(avail_h, Math.ceil(domain.y.span * zoom_hz2px));\n      var scalex = make_scale(domain.x, [0, spec_w]);\n      var scaley = make_scale(domain.y, [spec_h, 0]);\n      var scalelegend;\n      var l = this.l = {\n        visualizer_root: {\n          css: {\n            'overflow': ''\n          }\n        }\n      };\n      l.spectrogram = {\n        css: {\n          top: layout_tmp.axis_lead,\n          left: layout_tmp.axis_sizew,\n          width: spec_w,\n          height: spec_h\n        }\n      };\n      l.y_axis = {\n        scale: scaley,\n        css: {\n          top: 0,\n          left: container.scrollLeft()\n        },\n        attr: {\n          width: layout_tmp.axis_sizew,\n          height: spec_h + layout_tmp.axis_lead + layout_tmp.axis_sizeh\n        }\n      };\n      l.x_axis = {\n        scale: scalex,\n        css: {\n          left: layout_tmp.axis_sizew - layout_tmp.axis_lead,\n          // left : layout_tmp.axis_sizew -  layout_tmp.axis_lead,\n          top: container.scrollTop() + height - layout_tmp.axis_sizeh - layout_tmp.gutter\n        },\n        attr: {\n          height: layout_tmp.axis_sizeh,\n          width: spec_w + 2 * layout_tmp.axis_lead\n        }\n      };\n      this.has_legend = $scope.has_legend = !!domain.legend;\n\n      if (domain.legend) {\n        l.legend = {\n          scale: scalelegend,\n          css: {\n            top: 0,\n            left: container.scrollLeft() + width - a2BrowserMetrics.scrollSize.width - layout_tmp.legend_width - layout_tmp.legend_gutter\n          },\n          attr: {\n            width: layout_tmp.legend_width,\n            height: spec_h + 2 * layout_tmp.axis_lead\n          }\n        };\n        scalelegend = d3.scale.linear().domain([domain.legend.from, domain.legend.to]).range([spec_h - 2, 0]);\n      } else {\n        l.legend = {};\n      } //l.x_axis.attr.height = cheight - l.x_axis.css.top - 1;\n\n\n      ['spectrogram', 'y_axis', 'x_axis', 'legend'].forEach(function (i) {\n        var li = l[i];\n        this[i] = li.css;\n\n        if (li.attr) {\n          $.extend(this[i], li.attr);\n        }\n\n        if (li.scale) {\n          this[i].scale = li.scale;\n        }\n      }.bind(this));\n      this.offset.sec = domain.x.from;\n      this.offset.hz = domain.y.from;\n      this.scale.sec2px = spec_w / domain.x.span;\n      this.scale.hz2px = spec_h / domain.y.span;\n      this.viewport = {\n        left: l.spectrogram.css.left,\n        top: l.spectrogram.css.top,\n        width: avail_w,\n        height: avail_h\n      };\n      var sh = l.spectrogram.css.height;\n      var sw = l.spectrogram.css.width;\n      this.root = {\n        left: 0,\n        top: 0,\n        //width  : width,\n        //height : height,\n        width: width - (avail_h < sh ? a2BrowserMetrics.scrollSize.width : 0),\n        height: height - (avail_w < sw ? a2BrowserMetrics.scrollSize.height : 0)\n      };\n      var scroll_center;\n\n      if (this.center) {\n        scroll_center = {\n          left: this.scale.sec2px * this.center.s + l.spectrogram.css.left - width / 2.0,\n          top: -this.scale.hz2px * this.center.hz - height / 2.0 + l.spectrogram.css.top + l.spectrogram.css.height\n        };\n      }\n\n      l.domain = domain;\n      l.scroll_center = scroll_center;\n      l.scale = {\n        x: scalex,\n        y: scaley,\n        legend: scalelegend\n      };\n    },\n    apply_plotted: function (container, $scope, width, height, fix_scroll_center) {\n      var layout_tmp = this.tmp;\n      var visobject = $scope.visobject;\n      var avail_w = width;\n      var avail_h = height;\n      var cheight = container[0].clientHeight;\n      this.has_legend = $scope.has_legend = false;\n      var l = this.l = {\n        visualizer_root: {\n          css: {\n            'overflow': 'hidden'\n          }\n        }\n      };\n      l.spectrogram = {\n        css: {\n          top: 0,\n          left: 0,\n          width: avail_w,\n          height: avail_h\n        }\n      };\n      l.scroll_center = {\n        left: 0,\n        top: 0\n      };\n      this.spectrogram = l.spectrogram.css;\n      this.viewport = angular.extend(l.spectrogram.css);\n      this.root = {\n        left: 0,\n        top: 0,\n        width: width,\n        height: height\n      };\n    }\n  });\n});","angular.module('a2-visualizer-spectrogram-click2zoom', ['a2.classy']).service('a2SpectrogramClick2Zoom', function (makeClass, a22PointBBoxEditor) {\n  return makeClass({\n    super: a22PointBBoxEditor.prototype,\n    toggle_active: function () {\n      this.active = !this.active;\n\n      if (this.active) {\n        this.reset();\n      }\n    },\n    constructor: function (layout) {\n      this.super.constructor.call(this);\n      this.layout = layout;\n      this.active = false;\n    },\n    add_point: function (x, y, zoom) {\n      this.super.add_point.call(this, x, y);\n\n      if (zoom) {\n        this.zoom();\n      }\n    },\n    zoom_out: function () {\n      var layout = this.layout;\n      this.active = false;\n      layout.scale.zoom.x = Math.max(0, layout.scale.zoom.x - 0.1);\n      layout.scale.zoom.y = Math.max(0, layout.scale.zoom.y - 0.1);\n    },\n    zoom_reset: function () {\n      var layout = this.layout;\n      this.active = false;\n      layout.scale.zoom.x = 0;\n      layout.scale.zoom.y = 0;\n    },\n    zoom: function () {\n      var layout = this.layout;\n      var bbox = this.bbox;\n      var dx = bbox.x2 - bbox.x1,\n          dy = bbox.y2 - bbox.y1;\n      var cp = [(bbox.x2 + bbox.x1) / 2, (bbox.y2 + bbox.y1) / 2];\n      var avail_h = layout.viewport.height;\n      var avail_w = layout.viewport.width;\n      var lzoom = layout.scale.zoom;\n      var zoom_x = avail_w / dx,\n          zoom_y = avail_h / dy;\n      var zoom_level_x = Math.max(0, Math.min((zoom_x - lzoom.levelx[0]) / (lzoom.levelx[1] - lzoom.levelx[0]), 1));\n      var zoom_level_y = Math.max(0, Math.min((zoom_y - lzoom.levely[0]) / (lzoom.levely[1] - lzoom.levely[0]), 1));\n      this.active = false;\n      layout.center = {\n        s: cp[0],\n        hz: cp[1]\n      };\n      layout.scale.zoom.x = zoom_level_x;\n      layout.scale.zoom.y = zoom_level_y;\n      console.log(\"zoom :: \", [dx, dy], cp, [zoom_level_x, zoom_level_y]);\n    }\n  });\n}).directive('a2ZoomControl', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'level': '='\n    },\n    templateUrl: '/directives/zoom-ctrl.html',\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var delta = +$attrs.delta || 0.1;\n      var horizontal = !!($attrs.horizontal | 0 || /on|yes|true/.test($attrs.horizontal + ''));\n      $scope.horizontal = horizontal;\n      $scope.switched = horizontal;\n\n      $scope.step = function (step) {\n        $scope.level = Math.min(1, Math.max($scope.level + step * delta, 0));\n      };\n\n      $scope.set_by_mouse = function ($event) {\n        var track = $element.find('.zoom-track'),\n            trackpos = track.offset();\n        var px = (track.width() - ($event.pageX - trackpos.left)) / track.width();\n        var py = (track.height() - ($event.pageY - trackpos.top)) / track.height(); // console.log('$scope.set_by_mouse', [px,py]);\n\n        var level = $scope.horizontal ? px : py;\n        $scope.level = $scope.switched ? 1 - level : level;\n      };\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.audio-bar', ['a2.utils', 'a2.srv.local-storage', 'a2.visualizer.audio-player']).directive('a2AudioBar', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/a2-audio-bar/a2-audio-bar.html',\n    scope: {},\n    replace: true,\n    controller: 'a2AudioBarCtrl as controller'\n  };\n}).factory('a2AudioBarService', function ($rootScope) {\n  return {\n    loadUrl: function (url, play) {\n      $rootScope.$broadcast('a2-audio-load-url', {\n        url: url,\n        play: play\n      });\n    }\n  };\n}).controller('a2AudioBarCtrl', function ($scope, $filter, a2AudioPlayer, $timeout, $q, $localStorage) {\n  Object.assign(this, {\n    initialize: function () {\n      this.audio_player = new a2AudioPlayer($scope);\n      this.expanded = false;\n      this.collapseTimeoutInterval = 6000;\n      this.loading = false;\n      this.audio_player.setGain($localStorage.getItem('a2-audio-param-gain') || 1);\n      this.deregHandlers = [];\n      this.deregHandlers.push($scope.$on('a2-audio-load-url', this.onLoadUrl.bind(this)));\n      this.deregHandlers.push($scope.$on('$destroy', this.onDestroy.bind(this)));\n    },\n    onLoadUrl: function (event, options) {\n      this.loadUrl(options);\n    },\n    onDestroy: function () {\n      (this.deregHandlers || []).forEach(function (fn) {\n        fn();\n      });\n    },\n    setCollapseTimer: function () {\n      if (this.collapseTimer) {\n        $timeout.cancel(this.collapseTimer);\n      }\n\n      if (this.collapseTimeoutInterval) {\n        this.collapseTimer = $timeout(function () {\n          this.expanded = false;\n        }.bind(this), this.collapseTimeoutInterval);\n      }\n    },\n    seekPercent: function (percent) {\n      return this.audio_player.setCurrentTime(percent * this.audio_player.resource.duration);\n    },\n    setGain: function (gain) {\n      this.setCollapseTimer();\n      $localStorage.setItem('a2-audio-param-gain', gain);\n      return this.audio_player.setGain(gain);\n    },\n    play: function () {\n      this.setCollapseTimer();\n      return this.audio_player.play();\n    },\n    pause: function () {\n      this.setCollapseTimer();\n      return this.audio_player.pause();\n    },\n    stop: function () {\n      this.setCollapseTimer();\n      return this.audio_player.stop();\n    },\n    toggleExpanded: function () {\n      this.expanded = !this.expanded;\n\n      if (this.expanded) {\n        this.setCollapseTimer();\n      }\n    },\n    loadUrl: function (options) {\n      options = options || {};\n      const url = options.url;\n      const play = options.play || options.play === undefined;\n\n      if (!url) {\n        return $q.resolve();\n      }\n\n      this.loading = true;\n      this.expanded = true;\n      return this.audio_player.load(url).then(function () {\n        this.loading = false;\n\n        if (play) {\n          return this.play();\n        }\n      }.bind(this)).catch(function (e) {\n        this.loading = false;\n        this.error = e;\n        console.error(e);\n      }.bind(this));\n    }\n  });\n  this.initialize(this);\n});","angular.module('arbimon.directive.a2-switch', []).directive('a2Switch', function () {\n  return {\n    restict: 'E',\n    templateUrl: '/directives/a2-switch/template.html',\n    require: 'ngModel',\n    scope: {\n      onText: '@',\n      offText: '@',\n      disabled: '='\n    },\n    link: function (scope, element, attrs, ngModelCtrl) {\n      scope.toggle = function (event) {\n        scope.value = !scope.value;\n        ngModelCtrl.$setViewValue(scope.value, event && event.type);\n      };\n\n      ngModelCtrl.$render = function () {\n        scope.value = !!ngModelCtrl.$viewValue;\n      };\n    }\n  };\n});","angular.module('a2.utils.facebook-login-button', ['a2.utils', 'a2.utils.global-anonymous-function', 'a2.utils.external-api-loader', 'a2.injected.data']).config(function (externalApiLoaderProvider) {\n  externalApiLoaderProvider.addApi('facebook', {\n    url: \"//connect.facebook.net/en_US/sdk.js\",\n    namespace: 'FB',\n    onload: [\"a2InjectedData\", function (a2InjectedData) {\n      this.module.init(a2InjectedData.facebook_api);\n    }]\n  });\n}).directive('a2FacebookLoginButton', function ($window, $q, $timeout, a2InjectedData, externalApiLoader) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/external/facebook-login-button.html',\n    scope: {\n      onSignedIn: '&?',\n      onError: '&?'\n    },\n    link: function (scope, element, attrs) {\n      element.children('.btn-facebook-login').addClass(element[0].className);\n      element[0].className = '';\n\n      scope.signIn = function () {\n        externalApiLoader.load('facebook').then(function (FB) {\n          FB.login(function (response) {\n            if (response.status === 'connected') {\n              console.log(response);\n              scope.onSignedIn({\n                user: response\n              });\n            } else if (response.status === 'not_authorized') {} else {}\n          }, {\n            scope: 'public_profile,email'\n          });\n        });\n      };\n    }\n  };\n});","angular.module('a2.utils.google-login-button', ['a2.utils', 'a2.utils.q-promisify', 'a2.utils.global-anonymous-function', 'a2.utils.external-api-loader', 'a2.injected.data']).config(function (externalApiLoaderProvider) {\n  externalApiLoaderProvider.addApi('google-api', {\n    url: \"https://apis.google.com/js/client.js\",\n    namespace: 'gapi',\n    jsonpCallback: 'onload'\n  });\n  externalApiLoaderProvider.addApi('google-api/auth2', {\n    parent: 'google-api',\n    loader: [\"$qPromisify\", function ($qPromisify) {\n      return $qPromisify.invoke(this.parent.module, 'load', 'auth2');\n    }],\n    onload: [\"a2InjectedData\", function (a2InjectedData) {\n      var auth2 = this.module.init({\n        client_id: a2InjectedData.google_oauth_client,\n        cookiepolicy: 'single_host_origin'\n      });\n      return auth2.then(function () {\n        this.module.auth2 = auth2;\n      }.bind(this));\n    }],\n    getCachedModule: function () {\n      return this.parent && this.parent.module && this.parent.module.auth2;\n    }\n  });\n}).directive('a2GoogleLoginButton', function ($window, $q, $timeout, globalAnonymousFunction, a2InjectedData, externalApiLoader) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/external/google-login-button.html',\n    scope: {\n      onSignedIn: '&?',\n      onError: '&?'\n    },\n    link: function (scope, element, attrs) {\n      element.children('.btn-google-login').addClass(element[0].className);\n      element[0].className = '';\n\n      scope.signIn = function () {\n        externalApiLoader.load('google-api/auth2').then(function (auth2) {\n          auth2.auth2.signIn().then(function (user) {\n            scope.onSignedIn({\n              user: user\n            });\n          }, function (error) {\n            scope.onError({\n              error: error\n            });\n          });\n        });\n      };\n    }\n  };\n});","angular.module('a2.analysis.clustering-jobs', ['ui.bootstrap', 'a2.srv.clustering-jobs', 'a2.srv.playlists', 'a2.services', 'a2.permissions', 'a2.directive.audio-bar', 'humane', 'a2.filter.round', 'a2.directive.frequency_filter_range_control']).config(function ($stateProvider) {\n  $stateProvider.state('analysis.clustering-jobs', {\n    url: '/clustering-jobs',\n    controller: 'ClusteringJobsModelCtrl',\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  }).state('analysis.clustering-jobs-details', {\n    url: '/clustering-jobs/:clusteringJobId?freqMin&freqMax',\n    controller: 'ClusteringJobsModelCtrl',\n    params: {\n      freqMin: null,\n      freqMax: null\n    },\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  }).state('analysis.grid-view', {\n    url: '/clustering-jobs/:clusteringJobId/grid-view',\n    controller: 'ClusteringJobsModelCtrl',\n    params: {\n      gridContext: null\n    },\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  });\n}) //------------------- Clustering List page ---------------\n.controller('ClusteringJobsModelCtrl', function ($scope, $state, $stateParams, a2ClusteringJobs, JobsData, notify, $location, $modal, a2UserPermit, $localStorage, Project) {\n  $scope.selectedClusteringJobId = $stateParams.clusteringJobId;\n  $scope.showViewGridPage = false;\n  $scope.getProjectData = function () {\n    Project.getInfo(function (info) {\n      $scope.isProjectDisabled = info.disabled === 1;\n    });\n  }, $scope.getProjectData();\n\n  $scope.loadClusteringJobs = function () {\n    $scope.loading = true;\n    $scope.showRefreshBtn = false;\n    return a2ClusteringJobs.list({\n      completed: true\n    }).then(function (data) {\n      $scope.clusteringJobsOriginal = data;\n      $scope.clusteringJobsData = data;\n      $scope.loading = false;\n\n      if (data && data.length) {\n        $scope.showRefreshBtn = true;\n      }\n    });\n  };\n\n  if (!$scope.selectedClusteringJobId) {\n    $scope.loadClusteringJobs();\n  } // Parse grid view data if it exists\n\n\n  const gridContext = JSON.parse($localStorage.getItem('analysis.gridContext'));\n\n  if ($stateParams.gridContext || gridContext && $state.current.name === 'analysis.grid-view') {\n    $scope.showViewGridPage = true;\n    $scope.gridContext = $stateParams.gridContext ? $stateParams.gridContext : gridContext;\n  } else {\n    $localStorage.setItem('analysis.gridContext', null);\n  }\n\n  $scope.selectItem = function (clusteringJob) {\n    if (!clusteringJob) {\n      $state.go('analysis.clustering-jobs', {});\n    } else {\n      $state.go('analysis.clustering-jobs-details', {\n        clusteringJobId: clusteringJob.clustering_job_id\n      });\n    }\n  };\n\n  $scope.createNewClusteringJob = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to create Clustering job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/new-clustering-job.html',\n      controller: 'CreateNewClusteringJobCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.create) {\n        JobsData.updateJobs();\n        $scope.showRefreshBtn = true;\n        notify.log(\"Your new clustering job is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteClusteringJob = function (clusteringJob, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.log('You do not have permission to delete Clustering job');\n      return;\n    }\n\n    const modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/delete-clustering-job.html',\n      controller: 'DeleteClusteringJobCtrl as controller',\n      resolve: {\n        clusteringJob: function () {\n          return clusteringJob;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error('Error: ' + ret.err);\n      } else {\n        const modArr = angular.copy($scope.clusteringJobsOriginal);\n        const indx = modArr.findIndex(function (item) {\n          return item.clustering_job_id === clusteringJob.clustering_job_id;\n        });\n\n        if (indx > -1) {\n          $scope.clusteringJobsOriginal.splice(indx, 1);\n          notify.log('Clustering Job deleted successfully');\n        }\n      }\n    });\n  };\n}).controller('DeleteClusteringJobCtrl', function ($scope, $modalInstance, a2ClusteringJobs, clusteringJob) {\n  this.clusteringJob = clusteringJob;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2ClusteringJobs.delete(clusteringJob.clustering_job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}) //------------------- Clustering Details page ---------------\n.directive('a2ClusteringDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      clusteringJobId: '=',\n      detailedView: '=',\n      onSetDetailedView: '&',\n      onGoBack: '&'\n    },\n    controller: 'ClusteringDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/clustering-jobs/details.html'\n  };\n}).controller('ClusteringDetailsCtrl', function ($scope, $state, $location, a2ClusteringJobs, $window, Project, a2Playlists, $localStorage, $modal, a2UserPermit) {\n  var d3 = $window.d3;\n  $scope.loading = true;\n  $scope.toggleMenu = false;\n  $scope.selectedCluster = null;\n  var timeout;\n  $scope.frequencyFilter = {\n    min: null,\n    max: null,\n    currentMin: null,\n    currentMax: null\n  };\n\n  $scope.decrementClusters = function () {\n    if ($scope.selectedCluster === 1) return;\n    $scope.selectedCluster -= 1;\n    $scope.selectCluster();\n  };\n\n  $scope.incrementClusters = function () {\n    if ($scope.selectedCluster === $scope.layout.shapes.length) return;\n    $scope.selectedCluster += 1;\n    $scope.selectCluster();\n  }; // Select one cluster\n\n\n  $scope.selectCluster = function () {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      if ($scope.selectedCluster !== null) {\n        $(\"#plotly .select-outline\").remove();\n        $scope.layout.shapes.forEach(function (shape) {\n          shape.line.color = shape.fillcolor;\n          shape.line['stroke-width'] = 1;\n        });\n        var selection = $scope.layout.shapes[$scope.selectedCluster - 1];\n        selection.line.color = '#ffffff';\n        Plotly.relayout(document.getElementById('plotly'), {\n          'selection.line.color': '#ff0000',\n          'selection.line.opacity': 1,\n          'selection.line.stroke-width': 4\n        }); // Example: 3:[0, 1, 2, 3, 4] , where 3 - index of a cluster, array with the index of detections\n\n        $scope.points = [];\n        $scope.points[$scope.selectedCluster - 1] = [];\n        $scope.points[$scope.selectedCluster - 1] = $scope.getShapePoints();\n        $scope.toggleMenu = true;\n        $scope.$apply();\n      }\n    }, 2000);\n  };\n\n  $scope.getShapePoints = function () {\n    var arr = [];\n    var clusters = $scope.isFilteredClusters() ? $scope.sortFilteredData({\n      min: $location.search().freqMin,\n      max: $location.search().freqMax\n    }) : $scope.clusters;\n    var selectedAedList = Object.values(clusters)[$scope.selectedCluster - 1].aed;\n\n    if (selectedAedList && selectedAedList.length) {\n      selectedAedList.forEach(function (item, ind) {\n        arr.push(ind);\n      });\n    }\n\n    return arr;\n  };\n\n  var getClusteringDetails = function () {\n    $scope.infopanedata = '';\n    a2ClusteringJobs.getJobDetails($scope.clusteringJobId).then(function (data) {\n      if (data) $scope.job_details = data;\n    }).catch(function (err) {\n      console.log(err);\n    }); // Get json file which is included aed_id, clusters names, x, y points.\n\n    a2ClusteringJobs.getClusteringDetails({\n      job_id: $scope.clusteringJobId\n    }).then(function (res) {\n      $scope.loading = false;\n\n      if (res && res.aed_id) {\n        $scope.countAudioEventDetected = res.aed_id.length; // Collect clusters data.\n\n        $scope.clusters = {};\n        res.cluster.forEach(function (item, i) {\n          if (!$scope.clusters[item]) {\n            $scope.clusters[item] = {\n              x: [res.x_coord[i]],\n              y: [res.y_coord[i]],\n              aed: [res.aed_id[i]],\n              freq_low: [],\n              freq_high: []\n            };\n          } else {\n            $scope.clusters[item].x.push(res.x_coord[i]);\n            $scope.clusters[item].y.push(res.y_coord[i]);\n            $scope.clusters[item].aed.push(res.aed_id[i]);\n          }\n        }); // Get json file which is included aed_id, recordings, frequency data for the frequency filter.\n\n        a2ClusteringJobs.getClusteringDetails({\n          job_id: $scope.clusteringJobId,\n          aed_info: true\n        }).then(function (data) {\n          if (data !== undefined) {\n            $scope.aedDataInfo = data; // Create frequency object to collect min and max values for the frequency filter.\n\n            $scope.frequency = {\n              freq_low: [],\n              freq_high: []\n            }; // Add frequency min, max values to the clusters array.\n\n            for (var c in $scope.clusters) {\n              if ($scope.clusters[c] && $scope.clusters[c].aed && $scope.clusters[c].aed.length) {\n                $scope.clusters[c].aed.forEach(function (aed) {\n                  const indx = data.aed_id.findIndex(function (item) {\n                    return item === aed;\n                  });\n\n                  if (indx !== -1) {\n                    // Collect frequency min and max values for the frequency filter.\n                    $scope.frequency.freq_low.push(data.freq_low[indx]);\n                    $scope.frequency.freq_high.push(data.freq_high[indx]);\n                    $scope.clusters[c].freq_low.push(data.freq_low[indx]);\n                    $scope.clusters[c].freq_high.push(data.freq_high[indx]);\n                  }\n                });\n              }\n            } // Find frequency min and max values for frequency filter.\n\n\n            $scope.frequencyFilter.min = Math.min.apply(null, $scope.frequency.freq_low);\n            $scope.frequencyFilter.max = Math.max.apply(null, $scope.frequency.freq_high);\n\n            if ($scope.isFilteredClusters()) {\n              $scope.useFrequencyFilterData({\n                min: parseInt($location.search().freqMin),\n                max: parseInt($location.search().freqMax)\n              });\n            }\n          }\n        }).catch(function (err) {\n          console.log(err);\n        });\n        $scope.countClustersDetected = Object.keys($scope.clusters).length;\n\n        if (!$scope.isFilteredClusters()) {\n          drawClusteringPoints($scope.clusters);\n        }\n      }\n    }).catch(function (err) {\n      console.log(err);\n      $scope.loading = false;\n      $scope.infopanedata = 'No data for clustering job found.';\n    });\n  };\n\n  $scope.isFilteredClusters = function () {\n    return $location.search().freqMin && $location.search().freqMax;\n  };\n\n  $scope.isEmpty = function () {\n    return $scope.countAudioEventDetected !== undefined && $scope.countAudioEventDetected === 0 && !$scope.loading;\n  };\n\n  $scope.aedsDetected = function () {\n    if ($scope.countAudioEventDetected === undefined && $scope.loading) return '';\n    if ($scope.countAudioEventDetected === undefined && !$scope.loading) return 'no data';\n    return $scope.countAudioEventDetected;\n  };\n\n  $scope.clustersDetected = function () {\n    if ($scope.countClustersDetected === undefined && $scope.loading) return '';\n    if ($scope.countClustersDetected === undefined && !$scope.loading) return 'no data';\n    return $scope.countClustersDetected;\n  };\n\n  var drawClusteringPoints = function (clusters) {\n    var el = document.getElementById('plotly');\n    var data = [];\n    var shapes = [];\n    $scope.originalData = [];\n\n    for (var c in clusters) {\n      // Collect data for points.\n      data.push({\n        x: clusters[c].x,\n        y: clusters[c].y,\n        type: 'scatter',\n        mode: 'markers',\n        hoverinfo: 'none',\n        name: c,\n        marker: {\n          size: 6\n        }\n      }); // Collect data for shapes.\n\n      shapes.push({\n        type: 'circle',\n        xref: 'x',\n        yref: 'y',\n        x0: d3.min(clusters[c].x),\n        y0: d3.min(clusters[c].y),\n        x1: d3.max(clusters[c].x),\n        y1: d3.max(clusters[c].y),\n        opacity: 0.2\n      }); // Collect data for grid view page.\n\n      $scope.originalData.push({\n        x: clusters[c].x,\n        y: clusters[c].y,\n        cluster: c,\n        aed: clusters[c].aed\n      });\n    } // Shapes layout.\n\n\n    $scope.layout = {\n      shapes: shapes,\n      height: el ? el.offsetWidth - el.offsetWidth / 3 : 800,\n      width: el ? el.offsetWidth : 1390,\n      showlegend: true,\n      dragmode: 'lasso',\n      legend: {\n        title: {\n          text: 'Clusters names',\n          side: 'top',\n          font: {\n            size: 12\n          }\n        },\n        x: 1,\n        xanchor: 'right',\n        y: 1,\n        itemclick: 'toggleothers',\n        font: {\n          color: 'white'\n        }\n      },\n      paper_bgcolor: '#232436',\n      plot_bgcolor: '#232436',\n      xaxis: {\n        color: 'white',\n        title: 'Component 2',\n        side: 'top'\n      },\n      yaxis: {\n        color: 'white',\n        title: 'Component 1'\n      }\n    }; // Function to get color.\n\n    function getColor(n) {\n      const rgb = [0, 0, 0];\n\n      for (var i = 0; i < 24; i++) {\n        rgb[i % 3] <<= 1;\n        rgb[i % 3] |= n & 0x01;\n        n >>= 1;\n      }\n\n      return '#' + rgb.reduce(function (a, c) {\n        return (c > 0x0f ? c.toString(16) : '0' + c.toString(16)) + a;\n      }, '');\n    } // Make random color for shapes and points.\n\n\n    $scope.layout.shapes.forEach(function (shape, i) {\n      var color = getColor(i + 1);\n      data[i].marker = {\n        color: color\n      };\n      shape.fillcolor = color;\n      shape.line = {\n        color: color,\n        'stroke-width': 1\n      };\n    });\n\n    $scope.resetSelect = function () {\n      $scope.toggleMenu = false;\n      $scope.$apply();\n      $scope.layout.shapes.forEach(function (shape) {\n        shape.line.color = shape.fillcolor;\n        shape.line['stroke-width'] = 1;\n      });\n      Plotly.redraw(el);\n      $scope.$apply();\n    };\n\n    if (el) {\n      var config = {\n        scrollZoom: true,\n        displayModeBar: true,\n        displaylogo: false,\n        hoverdistance: 5\n      }; // To draw points\n\n      Plotly.newPlot(el, data, $scope.layout, config);\n      dragLayer = document.getElementsByClassName('nsewdrag')[0];\n      $scope.xAxisRangeStart = $scope.layout.xaxis.range[0]; // Hover on plotly\n\n      el.on('plotly_hover', function (data) {\n        if ($scope.layout.dragmode === 'lasso') {\n          dragLayer.classList.add('lasso-cursor');\n        }\n      }); // Zoom on plotly\n\n      el.on('plotly_unhover', function (data) {\n        dragLayer.classList.remove('lasso-cursor');\n      });\n      el.on('plotly_relayouting', function (data) {\n        if (data['xaxis.range[0]'] > $scope.xAxisRangeStart) {\n          dragLayer.classList.remove('zoom-out-cursor');\n          dragLayer.classList.add('zoom-in-cursor');\n          $scope.xAxisRangeStart = data['xaxis.range[0]'];\n        }\n\n        if (data['xaxis.range[0]'] < $scope.xAxisRangeStart) {\n          dragLayer.classList.remove('zoom-in-cursor');\n          dragLayer.classList.add('zoom-out-cursor');\n          $scope.xAxisRangeStart = data['xaxis.range[0]'];\n        }\n      });\n      el.on('plotly_relayout', function (data) {\n        dragLayer.classList.remove('zoom-out-cursor');\n        dragLayer.classList.remove('zoom-in-cursor');\n      }); // Click on a point\n\n      el.on('plotly_click', function (data) {\n        console.log('plotly_click', data);\n        $(\"#plotly .select-outline\").remove();\n        $scope.resetSelect();\n        $scope.points = {\n          x: data.points[0].x,\n          y: data.points[0].y,\n          name: data.points[0].fullData.name\n        };\n        $scope.layout.shapes.forEach(function (shape, i) {\n          if ($scope.points.x >= shape.x0 && $scope.points.x <= shape.x1 && $scope.points.y >= shape.y0 && $scope.points.y <= shape.y1) {\n            $scope.layout.shapes[i].line.color = '#ffffff';\n            Plotly.relayout(el, {\n              '$scope.layout.shapes[i].line.color': '#ff0000',\n              '$scope.layout.shapes[i].line.stroke-width': 4\n            });\n            $scope.toggleMenu = true;\n            $scope.$apply();\n          }\n        });\n      }); // Select a group of points.\n\n      el.on('plotly_selected', function (data) {\n        if (!data) {\n          $(\"#plotly .select-outline\").remove();\n        }\n\n        ;\n        console.log('plotly_selected', data);\n        $scope.points = []; // Collect selected points indexes in the points array.\n\n        if (data && data.points && data.points.length) {\n          data.points.forEach(function (point) {\n            var cluster = point.curveNumber;\n\n            if (!$scope.points[cluster]) {\n              $scope.points[cluster] = [];\n            }\n\n            ; // Example: 3:[0, 1, 2, 3, 4] , where 3 - index of a cluster, array with the index of detections\n\n            $scope.points[cluster].push(point.pointNumber);\n          });\n          $scope.toggleMenu = true;\n          $scope.$apply();\n        }\n      });\n    }\n  }; // Navigates to the Grid View page.\n\n\n  $scope.onGridViewSelected = function () {\n    $scope.toggleMenu = false;\n    $scope.selectedCluster = null;\n    $scope.showViewGridPage = true; // View all clusters\n\n    if (!$scope.points) {\n      $scope.gridContext = $scope.originalData;\n    } // Get points in different clusters, when the user selects dots by lasso or with the cluster selector\n    else if ($scope.points.length) {\n        $scope.gridContext = {};\n        $scope.points.forEach(function (row, i) {\n          $scope.gridContext[i] = {\n            aed: $scope.originalData[i].aed.filter(function (a, i) {\n              return row.includes(i);\n            }),\n            name: $scope.originalData[i].cluster\n          };\n        });\n      } // Get selected cluster with all points in the shape\n      else {\n          $scope.gridContext = $scope.originalData.find(function (shape) {\n            return shape.x.includes($scope.points.x) && shape.y.includes($scope.points.y);\n          });\n        }\n\n    $state.go('analysis.grid-view', {\n      clusteringJobId: $scope.clusteringJobId,\n      gridContext: $scope.gridContext\n    });\n  }; // Navigates to the Visualizer page.\n\n\n  $scope.showClustersInVisualizer = function () {\n    if ($scope.points.length) {\n      $scope.selectedClusters = {\n        aed: []\n      };\n\n      for (var r in $scope.points) {\n        $scope.originalData[r].aed.forEach(function (a, i) {\n          if ($scope.points[r].includes(i)) {\n            $scope.selectedClusters.aed.push(a);\n          }\n\n          ;\n        });\n      }\n    } else {\n      // User selects any point in one shape. It have to process all points in a shape\n      $scope.selectedClusters = $scope.originalData.find(function (shape) {\n        return shape.x.includes($scope.points.x) && shape.y.includes($scope.points.y);\n      });\n    } // Save temporary palylist with selected clusters to the local storage.\n\n\n    if ($scope.selectedClusters && $scope.selectedClusters.aed && $scope.selectedClusters.aed.length) {\n      if ($scope.aedDataInfo !== undefined) {\n        $scope.selectedClusters.boxes = {};\n        var recIds = [];\n        $scope.selectedClusters.aed.forEach(function (id) {\n          const indx = $scope.aedDataInfo.aed_id.findIndex(function (item) {\n            return item === id;\n          });\n          recIds.push($scope.aedDataInfo.recording_id[indx]);\n          var box = ['box', $scope.aedDataInfo.time_min[indx], $scope.aedDataInfo.freq_low[indx], $scope.aedDataInfo.time_max[indx], $scope.aedDataInfo.freq_high[indx]].join(',');\n\n          if (!$scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]]) {\n            $scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]] = [box];\n          } else {\n            $scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]].push(box);\n          }\n        });\n        $scope.removeFromLocalStorage();\n        tempPlaylistData = {};\n        tempPlaylistData.aed = $scope.selectedClusters.aed;\n        tempPlaylistData.boxes = $scope.selectedClusters.boxes;\n        tempPlaylistData.playlist = {\n          id: 0,\n          name: 'cluster_' + recIds.join(\"_\"),\n          recordings: recIds.filter(function (id, i, a) {\n            return a.indexOf(id) === i;\n          }),\n          count: recIds.filter(function (id, i, a) {\n            return a.indexOf(id) === i;\n          }).length\n        };\n        $localStorage.setItem('analysis.clusters', JSON.stringify(tempPlaylistData));\n        $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/0?clusters';\n      }\n    }\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  };\n\n  $scope.savePlaylist = function (opts) {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to manage AED and Clustering job');\n      return;\n    }\n\n    a2Playlists.create(opts, function (data) {\n      if (data && data.playlist_id) {\n        $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/' + data.playlist_id + '?clusters';\n      }\n    });\n  };\n\n  $scope.showDetailsPage = function () {\n    return !$scope.loading && !$scope.infopanedata && !$scope.gridViewSelected;\n  };\n\n  $scope.openFreqFilterModal = function () {\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/frequency-filter.html',\n      controller: 'a2ClusterFrequencyFilterModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            frequency: $scope.frequencyFilter\n          };\n        }\n      }\n    });\n    modalInstance.result.then(function (result) {\n      if (!result) {\n        return;\n      }\n\n      $scope.useFrequencyFilterData(result);\n    });\n  };\n\n  $scope.sortFilteredData = function (result) {\n    var clusters = {};\n\n    for (var c in $scope.clusters) {\n      if ($scope.clusters[c].aed.length) {\n        clusters[c] = {};\n        clusters[c].y = [];\n        clusters[c].x = [];\n        clusters[c].aed = []; // Find filtered points in each cluster from the user selection.\n\n        $scope.clusters[c].freq_high.forEach(function (freq_high, i) {\n          if ($scope.clusters[c].freq_low[i] >= result.min && freq_high <= result.max) {\n            clusters[c].y.push($scope.clusters[c].y[i]);\n            clusters[c].x.push($scope.clusters[c].x[i]);\n            clusters[c].aed.push($scope.clusters[c].aed[i]);\n          }\n        });\n\n        if (!clusters[c].aed.length) {\n          delete clusters[c];\n        }\n      }\n    }\n\n    return clusters;\n  };\n\n  $scope.useFrequencyFilterData = function (result) {\n    $scope.frequencyFilter.currentMin = result.min;\n    $scope.frequencyFilter.currentMax = result.max;\n    $state.params.freqMin = $scope.frequencyFilter.currentMin;\n    $state.params.freqMax = $scope.frequencyFilter.currentMax;\n    $location.search('freqMin', $scope.frequencyFilter.currentMin);\n    $location.search('freqMax', $scope.frequencyFilter.currentMax);\n    var clusters = $scope.sortFilteredData(result);\n    $scope.countClustersDetected = Object.keys(clusters).length;\n    $scope.countAudioEventDetected = Object.values(clusters).map(function (cluster) {\n      return cluster.aed.length;\n    }).reduce(function (sum, current) {\n      return sum + current;\n    }, 0); // Display filtered points from after selection in the frequency filter.\n\n    drawClusteringPoints(clusters);\n  };\n\n  getClusteringDetails();\n}).controller('a2ClusterFrequencyFilterModalController', function ($scope, $modalInstance, data, Project) {\n  $scope.filterData = {};\n  $scope.filterData.max_freq = data.frequency.max;\n  $scope.filterData.src = \"/api/project/\" + Project.getUrl() + \"/recordings/tiles/3298382/0/0\";\n  $scope.has_previous_filter = true;\n  $scope.frequency = data.frequency && data.frequency.currentMax ? {\n    min: angular.copy(data.frequency.currentMin),\n    max: data.frequency.currentMax\n  } : {\n    min: 0,\n    max: $scope.filterData.max_freq\n  };\n\n  $scope.remove_filter = function () {\n    $modalInstance.close({\n      min: data.frequency.min,\n      max: data.frequency.max\n    });\n  };\n\n  $scope.apply_filter = function () {\n    $modalInstance.close($scope.frequency);\n  };\n}).controller('CreateNewClusteringJobCtrl', function ($modalInstance, a2ClusteringJobs, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        jobs: false,\n        saving: false\n      };\n      var list = this.list = {};\n      this.data = {\n        name: null,\n        aed_job: {},\n        params: {\n          minPoints: 3,\n          distanceThreshold: 0.1,\n          maxClusterSize: 100\n        }\n      };\n      this.timeout;\n      this.loading.jobs = true;\n      a2ClusteringJobs.audioEventDetections({\n        completed: true\n      }).then(function (jobs) {\n        this.loading.jobs = false;\n        list.jobs = jobs.map(function (job) {\n          return {\n            name: job.name,\n            jobId: job.job_id\n          };\n        });\n      }.bind(this));\n    },\n    create: function () {\n      var _this = this;\n\n      this.loading.saving = true;\n\n      try {\n        return a2ClusteringJobs.create({\n          name: this.data.name,\n          aed_job: this.data.aed_job,\n          params: this.data.params\n        }).then(function (clusteringModel) {\n          $modalInstance.close({\n            create: true,\n            clusteringModel: clusteringModel\n          });\n        }.bind(this));\n      } catch (error) {\n        this.loading.saving = false;\n        console.error(error);\n      }\n\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        _this.loading.saving = false;\n      }, 2000);\n    },\n    cancel: function (url) {\n      this.loading.jobs = false;\n      this.loading.saving = false;\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isJobValid: function () {\n      return this.data && this.data.name && this.data.name.length > 3 && this.data.aed_job;\n    }\n  });\n  this.initialize();\n}) //------------------- Gid View page ---------------\n.directive('a2GridView', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      clusteringJobId: '=',\n      gridContext: '=',\n      onGoBack: '&'\n    },\n    controller: 'GridViewCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/clustering-jobs/grid-view.html'\n  };\n}).controller('ExportReportModalCtrl', function ($scope, $modalInstance, a2ClusteringJobs, data) {\n  $scope.userEmail = data.userEmail;\n\n  $scope.accessExportReport = function (email) {\n    data.userEmail = email;\n    $scope.isExporting = true;\n    $scope.errMess = '';\n    a2ClusteringJobs.exportClusteringROIs(data).then(function (data) {\n      $scope.isExporting = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        $modalInstance.close();\n      }\n    });\n  };\n\n  $scope.changedUserEmail = function () {\n    $scope.errMess = null;\n  };\n}).controller('GridViewCtrl', function ($scope, $http, a2UserPermit, a2ClusteringJobs, a2AudioBarService, a2AudioEventDetectionsClustering, Project, Songtypes, a2Playlists, notify, $modal, $localStorage) {\n  $scope.loading = true;\n  $scope.isSquareSize = false;\n  $scope.infopanedata = '';\n  $scope.projectUrl = Project.getUrl();\n  $scope.allRois = [];\n  $scope.selectedRois = [];\n  $scope.paginationSettings = {\n    page: 1,\n    limit: 100,\n    offset: 0,\n    totalItems: 0,\n    totalPages: 0\n  };\n  $scope.lists = {\n    search: [{\n      value: 'all',\n      text: 'All',\n      description: 'Show all matched rois.'\n    }, {\n      value: 'per_cluster',\n      text: 'Sort per Cluster',\n      description: 'Show all rois ranked per Cluster.'\n    }, {\n      value: 'per_site',\n      text: 'Sort per Site',\n      description: 'Show all rois ranked per Site.'\n    }, {\n      value: 'per_date',\n      text: 'Sort per Date',\n      description: 'Show all rois sorted per Date.'\n    }, {\n      value: 'per_species',\n      text: 'Sort per Species',\n      description: 'Show all rois sorted per Species.'\n    }],\n    validation: [{\n      class: \"fa val-1\",\n      text: 'Present',\n      value: 1\n    }, {\n      class: \"fa val-0\",\n      text: 'Not Present',\n      value: 0\n    }, {\n      class: \"fa val-null\",\n      text: 'Clear',\n      value: -1\n    }]\n  };\n  $scope.validation = {\n    status: $scope.lists.validation[2]\n  };\n  $scope.selectedFilterData = $scope.lists.search[1];\n  $scope.playlistData = {};\n  $scope.aedData = {\n    count: 0,\n    id: []\n  };\n  $scope.speciesLoading = false;\n  $scope.selected = {\n    species: null,\n    songtype: null\n  };\n  var timeout;\n  var isShiftKeyHolding = false;\n\n  if ($scope.gridContext && $scope.gridContext.aed) {\n    $scope.gridData = [];\n    $scope.gridData.push($scope.gridContext);\n    $scope.aedData.count = 1;\n    $scope.gridContext.aed.forEach(function (i) {\n      return $scope.aedData.id.push(i);\n    });\n  } else {\n    $scope.gridData = Object.values($scope.gridContext);\n    $scope.aedData.count = $scope.gridData.length;\n    $scope.gridData.forEach(function (data) {\n      data.aed.forEach(function (i) {\n        return $scope.aedData.id.push(i);\n      });\n    });\n  }\n\n  $localStorage.setItem('analysis.gridContext', JSON.stringify($scope.gridContext));\n  a2ClusteringJobs.getJobDetails($scope.clusteringJobId).then(function (data) {\n    if (data) $scope.job_details = data;\n  }).catch(function (err) {\n    console.log(err);\n  });\n\n  $scope.onSearchChanged = function (item) {\n    $scope.selectedFilterData = item;\n    $scope.getRoisDetails(true).then(function () {\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        $scope.markBoxesAsSelected();\n        $scope.updateInputState();\n      }, 100);\n    });\n  };\n\n  $scope.setCurrentPage = function () {\n    this.paginationSettings.offset = $scope.paginationSettings.page - 1;\n    $scope.getRoisDetails();\n  };\n\n  $scope.showPagination = function () {\n    if ($scope.selectedFilterData.value === 'per_cluster') {\n      return $scope.paginationSettings.totalItems && $scope.gridData.length && $scope.gridData.length > 1;\n    } else {\n      return $scope.paginationSettings.totalItems && $scope.paginationSettings.totalItems > $scope.paginationSettings.limit;\n    }\n  };\n\n  $scope.getRoisDetails = function (isFilterChanged) {\n    if (!$scope.aedData.id.length) {\n      return $scope.getStatusForEmptyData();\n    }\n\n    $scope.rows = [];\n    var aedData;\n    $scope.isRoisLoading = true;\n\n    if (isFilterChanged) {\n      $scope.paginationSettings.page = 1;\n      $scope.paginationSettings.offset = 0;\n    }\n\n    if ($scope.selectedFilterData.value === 'per_cluster') {\n      aedData = $scope.gridData[$scope.paginationSettings.page - 1].aed;\n      $scope.paginationSettings.totalItems = $scope.gridData.length;\n      $scope.paginationSettings.limit = 1;\n    } else {\n      $scope.paginationSettings.limit = 100;\n      $scope.paginationSettings.totalItems = $scope.aedData.id.length;\n      aedData = $scope.aedData.id.filter(function (id, i, a) {\n        return i >= $scope.paginationSettings.offset * $scope.paginationSettings.limit && i < $scope.paginationSettings.page * $scope.paginationSettings.limit;\n      });\n    }\n\n    return a2ClusteringJobs.getRoisDetails({\n      jobId: $scope.clusteringJobId,\n      aed: aedData,\n      search: $scope.selectedFilterData.value\n    }).then(function (data) {\n      const groupedData = [];\n      Object.values($scope.gridData).forEach(function (cluster) {\n        Object.entries(cluster).forEach(function (entry) {\n          if (entry[0] == \"aed\") {\n            entry[1].forEach(function (id) {\n              const matched = data.find(function (aed) {\n                return aed.aed_id === id;\n              });\n\n              if (matched) {\n                matched.cluster = cluster.name;\n                groupedData.push(matched);\n              }\n            });\n          }\n        });\n      });\n\n      if ($scope.selectedFilterData.value === 'per_cluster') {\n        $scope.paginationSettings.totalPages = $scope.gridData.length;\n        $scope.paginationSettings.limit = 1;\n      } else {\n        $scope.paginationSettings.totalPages = Math.ceil($scope.paginationSettings.totalItems / $scope.paginationSettings.limit);\n        $scope.paginationSettings.limit = 100;\n      }\n\n      $scope.loading = false;\n      $scope.allRois = groupedData;\n      $scope.isRoisLoading = false;\n      $scope.getRoisDetailsSegment();\n      $scope.combineRoisPerCluster();\n    }).catch(function (err) {\n      console.log(err);\n      $scope.getStatusForEmptyData();\n    });\n  };\n\n  $scope.getRoisDetails();\n\n  $scope.combineRoisPerCluster = function () {\n    $scope.roisPerCluster = {};\n    $scope.gridData.forEach(function (cluster) {\n      $scope.roisPerCluster[cluster.name] = cluster.aed;\n    });\n  };\n\n  $scope.exportReport = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to download Clustering details');\n      return;\n    }\n\n    var params = {\n      jobId: $scope.clusteringJobId,\n      aed: $scope.aedData.id,\n      cluster: $scope.roisPerCluster,\n      search: $scope.selectedFilterData.value,\n      userEmail: a2UserPermit.getUserEmail() || ''\n    };\n\n    if ($scope.selectedFilterData.value == 'per_site') {\n      params.perSite = true;\n    } else if ($scope.selectedFilterData.value == 'per_date') {\n      params.perDate = true;\n    } else params.all = true;\n\n    $scope.openExportPopup(params);\n  };\n\n  $scope.openExportPopup = function (listParams) {\n    const modalInstance = $modal.open({\n      controller: 'ExportReportModalCtrl',\n      templateUrl: '/app/analysis/clustering-jobs/export-report.html',\n      resolve: {\n        data: function () {\n          return listParams;\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function () {\n      notify.log('Your report export request is processing <br> and will be sent by email.');\n    });\n  };\n\n  $scope.getStatusForEmptyData = function () {\n    $scope.loading = false;\n    $scope.isRoisLoading = false;\n    $scope.infopanedata = 'No data for clustering job found.';\n  };\n\n  $scope.getRoisDetailsSegment = function () {\n    const data = $scope.allRois;\n\n    if (data && $scope.selectedFilterData.value === 'per_site') {\n      var sites = {};\n      data.forEach(function (item) {\n        if (!sites[item.site_id]) {\n          sites[item.site_id] = {\n            id: item.site_id,\n            site: item.site,\n            species: [item]\n          };\n        } else {\n          sites[item.site_id].species.push(item);\n        }\n      });\n      const rows = Object.values(sites).map(function (site) {\n        return {\n          id: site.id,\n          site: site.site,\n          species: $scope.groupRoisBySpecies(site.species)\n        };\n      });\n      $scope.rows = rows;\n    } else if (data && $scope.selectedFilterData.value === 'per_cluster') {\n      $scope.ids = {};\n\n      if ($scope.aedData.count > 1) {\n        var grids = [];\n        $scope.gridData.forEach(function (row) {\n          grids.push([row]);\n        });\n        grids.forEach(function (row, index) {\n          $scope.ids[index] = {\n            id: row[0].cluster || row[0].name,\n            cluster: row[0].cluster || row[0].name,\n            species: $scope.groupRoisBySpecies(data, row[0].aed)\n          };\n        });\n      } else {\n        $scope.ids[0] = {\n          id: $scope.gridData[0].cluster || $scope.gridData[0].name,\n          cluster: $scope.gridData[0].cluster || $scope.gridData[0].name,\n          species: $scope.groupRoisBySpecies(data)\n        };\n      }\n\n      $scope.rows = Object.values($scope.ids);\n    } else if (data && $scope.selectedFilterData.value === 'per_species') {\n      var speciesObj = {};\n      data.forEach(function (roi) {\n        if (!speciesObj[roi.species_id]) {\n          speciesObj[roi.species_id] = {\n            id: roi.species_id,\n            speciesName: roi.scientific_name,\n            species: [roi]\n          };\n        } else {\n          speciesObj[roi.species_id].species.push(roi);\n        }\n      });\n      const rows = Object.values(speciesObj).map(function (row) {\n        return {\n          id: row.id,\n          speciesName: row.speciesName || 'Unvalidated ROIs',\n          species: $scope.groupRoisBySpecies(row.species)\n        };\n      });\n      $scope.rows = rows;\n    } else {\n      if ($scope.selectedFilterData.value === 'per_date') {\n        data.sort(function (a, b) {\n          return a.date_created < b.date_created ? 1 : -1;\n        });\n      }\n\n      $scope.rows = [];\n      $scope.rows.push({\n        species: [{\n          rois: data\n        }]\n      });\n    }\n  };\n\n  $scope.groupRoisBySpecies = function (data, aeds) {\n    const rois = aeds ? data.filter(function (a, i) {\n      return aeds.includes(a.aed_id);\n    }) : data;\n    var species = {};\n    rois.forEach(function (item) {\n      const key = item.scientific_name ? item.scientific_name + '-' + item.songtype : 'Unvalidated ROIs';\n\n      if (!species[key]) {\n        species[key] = {\n          key: key,\n          rois: [item]\n        };\n      } else {\n        species[key].rois.push(item);\n      }\n    });\n    return Object.values(species);\n  };\n\n  $scope.playRoiAudio = function (recId, aedId, $event) {\n    if ($event) {\n      $event.preventDefault();\n      $event.stopPropagation();\n    }\n\n    a2AudioBarService.loadUrl(a2ClusteringJobs.getAudioUrlFor(recId, aedId), true);\n  };\n\n  $scope.getRoiVisualizerUrl = function (roi) {\n    var projecturl = Project.getUrl();\n    var box = ['box', roi.time_min, roi.frequency_min, roi.time_max, roi.frequency_max].join(',');\n    return roi ? '/project/' + projecturl + '/#/visualizer/rec/' + roi.recording_id + '?a=' + box : '';\n  };\n\n  $scope.togglePopup = function () {\n    $scope.isPopupOpened = !$scope.isPopupOpened;\n  };\n\n  $scope.toggleBoxSize = function () {\n    $scope.isSquareSize = !$scope.isSquareSize;\n  };\n\n  $scope.isPlaylistDataValid = function () {\n    return $scope.selectedRois && $scope.selectedRois.length && $scope.playlistData.playlistName && $scope.playlistData.playlistName.trim().length > 0;\n  };\n\n  $scope.closePopup = function () {\n    $scope.isPopupOpened = false;\n  };\n\n  $scope.savePlaylist = function () {\n    if ($scope.selectedRois.length) {\n      $scope.isSavingPlaylist = true; // Create a new playlist with aed boxes.\n\n      a2Playlists.create({\n        playlist_name: $scope.playlistData.playlistName,\n        params: $scope.selectedRois,\n        recIdsIncluded: true\n      }, function (data) {\n        $scope.isSavingPlaylist = false;\n        $scope.closePopup(); // Attach aed to the new playlist.\n\n        if (data && data.playlist_id) {\n          a2Playlists.attachAedToPlaylist({\n            playlist_id: data.playlist_id,\n            aed: $scope.selectedRois\n          }, function (data) {\n            $scope.playlistData = {};\n            notify.log('Audio event detections are saved in the playlist. <br> Navigates to the Visualizer page to see Audio Event boxes on the spectrogram');\n          });\n        }\n      });\n    }\n  };\n\n  $scope.isValidationAccessible = function () {\n    return a2UserPermit.can('manage AED and Clustering job');\n  };\n\n  $scope.setValidation = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to manage AED and Clustering job');\n      return;\n    }\n\n    if ($scope.validation.status.value === 1 && (!$scope.selected.species || !$scope.selected.songtype)) {\n      notify.error('Please select Species and Song type <br> to validate ROIs with the Present validation');\n      return;\n    }\n\n    if ($scope.validation.status.value === 0 && (!$scope.selected.species || !$scope.selected.songtype)) {\n      notify.error('Please select Species and Song type <br> to validate ROIs with the Absent validation');\n      return;\n    }\n\n    $scope.speciesLoading = true;\n    var opts = {\n      aed: $scope.selectedRois,\n      validated: $scope.validation.status.value\n    };\n    const isClearValidation = $scope.validation.status.value === -1;\n    opts.species_name = isClearValidation ? null : $scope.selected.species.scientific_name;\n    opts.songtype_name = isClearValidation ? null : $scope.selected.songtype.name;\n    opts.species_id = isClearValidation ? null : $scope.selected.species.id;\n    opts.songtype_id = isClearValidation ? null : $scope.selected.songtype.id;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      a2AudioEventDetectionsClustering.validate(opts).then(function (data) {\n        console.info('Validation result', data); // Unselect and mark boxes with current validation without reloading the page\n\n        $scope.markBoxesWithCurrentValidation();\n        $scope.unselectBoxes();\n        $scope.selectedRois = [];\n\n        if ($scope.validation.status.value === 1) {\n          notify.log('Audio event detections are validated as ' + $scope.selected.species.scientific_name + ' ' + $scope.selected.songtype.name);\n        }\n\n        $scope.selected = {\n          species: null,\n          songtype: null\n        };\n        $scope.updateInputState();\n        $scope.getRoisDetails();\n      }).finally(function () {\n        $scope.speciesLoading = false;\n      });\n    }, 500);\n  };\n\n  $scope.markBoxesWithCurrentValidation = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if ($scope.selectedRois.includes(roi.aed_id)) {\n            roi.validated = $scope.validation.status.value;\n          }\n        });\n      });\n    });\n  };\n\n  $scope.unselectBoxes = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if (roi.selected) {\n            roi.selected = false;\n          }\n        });\n      });\n    });\n  };\n\n  $scope.markBoxesAsSelected = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if ($scope.selectedRois.includes(roi.aed_id)) {\n            roi.selected = true;\n          }\n        });\n      });\n    });\n  };\n\n  Songtypes.get(function (songs) {\n    $scope.songtypes = songs;\n  });\n\n  $scope.searchSpecies = function (search) {\n    $scope.selected.songtype = null;\n    $scope.speciesLoading = true;\n    return $http.get('/api/species/search', {\n      params: {\n        q: search\n      }\n    }).then(function (result) {\n      $scope.speciesLoading = false;\n      return result.data;\n    });\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    var scrollPos = $controller.scrollElement.scrollY;\n    var headerTop = $controller.anchors.header.offset().top;\n    this.headerTop = headerTop | 0;\n    this.scrolledPastHeader = scrollPos > headerTop;\n  };\n\n  var getSelectedDetectionIds = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if (roi.selected === true && !$scope.selectedRois.includes(roi.aed_id)) {\n            $scope.selectedRois.push(roi.aed_id);\n          }\n\n          if (roi.selected === false && $scope.selectedRois.includes(roi.aed_id)) {\n            const index = $scope.selectedRois.findIndex(function (item) {\n              return item === roi.aed_id;\n            });\n            $scope.selectedRois.splice(index, 1);\n          }\n        });\n      });\n    });\n    return $scope.selectedRois;\n  };\n\n  $scope.selectCluster = function (cluster) {\n    const isSelected = cluster.selected;\n    cluster.rois = cluster.rois.map(function (roi) {\n      roi.selected = isSelected === true ? true : false;\n      return roi;\n    });\n    $scope.selectedRois = getSelectedDetectionIds();\n    $scope.updateInputState();\n  };\n\n  var getCombinedDetections = function () {\n    var combinedDetections = [];\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        combinedDetections = combinedDetections.concat(cluster.rois);\n      });\n    });\n    return combinedDetections;\n  }; // Selection with a shift key\n\n\n  $scope.toggleDetection = function (event) {\n    isShiftKeyHolding = event.shiftKey;\n\n    if (isShiftKeyHolding) {\n      const combinedDetections = getCombinedDetections();\n      const selectedDetectionIds = getSelectedDetectionIds();\n      const firstInx = combinedDetections.findIndex(function (d) {\n        return d.aed_id === selectedDetectionIds[0];\n      });\n      const secondInx = combinedDetections.findIndex(function (det) {\n        return det.aed_id === selectedDetectionIds[selectedDetectionIds.length - 1];\n      });\n      const arrayOfIndx = [firstInx, secondInx].sort(function (a, b) {\n        return a - b;\n      });\n      const filteredDetections = combinedDetections.filter(function (_det, index) {\n        return index >= arrayOfIndx[0] && index <= arrayOfIndx[1];\n      });\n      const ids = filteredDetections.map(function (det) {\n        return det.aed_id;\n      });\n      $scope.rows.forEach(function (row) {\n        row.species.forEach(function (cluster) {\n          cluster.rois.forEach(function (roi) {\n            if (ids.includes(roi.aed_id)) {\n              roi.selected = true;\n            }\n          });\n        });\n      });\n    }\n\n    $scope.selectedRois = getSelectedDetectionIds();\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      $scope.updateInputState();\n    }, 100);\n  }; // Set cluster's input state\n\n\n  $scope.updateInputState = function () {\n    const inputs = document.querySelectorAll(\"[id^='inputCluster_']\");\n    if (!inputs.length) return;\n    var index = 0;\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        const selectedRois = cluster.rois.filter(function (roi) {\n          return roi.selected;\n        });\n\n        if (!selectedRois.length) {\n          inputs[index].checked = false;\n          inputs[index].indeterminate = false;\n        } else if (selectedRois.length === cluster.rois.length) {\n          inputs[index].indeterminate = false;\n          inputs[index].checked = true;\n        } else {\n          inputs[index].checked = false;\n          inputs[index].indeterminate = true;\n        }\n\n        index++;\n      });\n    });\n  };\n});","angular.module('a2.analysis.audio-event-detection', ['a2.filter.as-csv', 'a2.filter.time-from-now', 'a2.srv.resolve', 'a2.srv.open-modal', 'a2.service.audio-event-detection', 'a2.analysis.audio-event-detection.new-modal']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.audio-event-detection', {\n    url: '/audio-event-detection',\n    controller: 'AudioEventDetectionAnalysisStateCtrl as controller',\n    templateUrl: '/app/analysis/audio-event-detection/index.html'\n  });\n}).controller('AudioEventDetectionAnalysisStateCtrl', function ($q, $promisedResolve, $openModal, a2UserPermit) {\n  this.initialize = function () {\n    return this.reload();\n  };\n\n  this.reload = function () {\n    this.loading = true;\n    return $promisedResolve({\n      audioEventDetectionsList: [\"AudioEventDetectionService\", function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getList();\n      }]\n    }, this).then(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.new = function () {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to create audio event detections.');\n      return;\n    }\n\n    return $openModal('audio-event-detection.new-modal', {\n      resolve: {\n        onSubmit: [\"AudioEventDetectionService\", function (AudioEventDetectionService) {\n          return AudioEventDetectionService.new;\n        }]\n      }\n    });\n  };\n\n  this.initialize();\n});","angular.module('a2.analysis.audio-event-detection.new-modal', ['a2.srv.open-modal', 'a2.srv.resolve', 'a2.srv.playlists', 'humane', 'a2.directive.require-non-empty', 'a2.service.audio-event-detection']).config(function ($openModalProvider) {\n  $openModalProvider.define('audio-event-detection.new-modal', {\n    templateUrl: '/app/analysis/audio-event-detection/new-modal.html',\n    controllerAs: 'controller',\n    controller: 'NewAudioEventDetectionModalCtrl',\n    resolve: {\n      onSubmit: function () {\n        return null;\n      }\n    }\n  });\n}).constant('AudioEventDetectionParametersEditTemplateUrls', {\n  fltr: '/app/analysis/audio-event-detection/algorithm-fltr-edit-parameters.html'\n}).controller('NewAudioEventDetectionModalCtrl', function ($q, $modalInstance, $promisedResolve, $parse, notify, AudioEventDetectionParametersEditTemplateUrls, onSubmit) {\n  this.playlists = [];\n  this.algorithmsList = [];\n  this.statisticsList = [];\n  var getDefaultName = $parse(\"[\" + \"(playlist.name || '[Playlist]'), \" + \"(algorithm.name || '[Algorithm]'), \" + \"(parameters ? '(' + (parameters  | asCSV) + ')' : ''), \" + \"(date | moment:'ll')\" + \"] | asCSV:' / '\");\n\n  this.initialize = function () {\n    return this.reload().then(function () {\n      this.aed = {\n        algorithm: this.algorithmsList[0],\n        statistics: this.statisticsList.slice(),\n        playlist: null,\n        date: new Date()\n      };\n      this.notifyAedAlgorithmChanged();\n    }.bind(this));\n  };\n\n  this.reload = function () {\n    this.loading = true;\n    return $promisedResolve({\n      playlists: [\"a2Playlists\", function (a2Playlists) {\n        return a2Playlists.getList();\n      }],\n      algorithmsList: function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getAlgorithmsList();\n      },\n      statisticsList: function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getStatisticsList();\n      }\n    }, this).then(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.notifyAedAlgorithmChanged = function () {\n    var algorithm = this.aed.algorithm || {};\n    this.aed.parameters = algorithm.defaults || {};\n    this.algorithmParametersTemplate = AudioEventDetectionParametersEditTemplateUrls[algorithm.name];\n    this.recomputeDefaultName();\n  };\n\n  this.recomputeDefaultName = function () {\n    this.aed.defaultName = getDefaultName(this.aed);\n  };\n\n  this.ok = function () {\n    return $q.resolve().then(function () {\n      return onSubmit && onSubmit(this.aed);\n    }.bind(this)).then(function () {\n      return $modalInstance.close(this.aed);\n    }.bind(this)).catch(function (error) {\n      notify.error(error);\n    });\n  };\n\n  this.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n\n  this.initialize();\n});","angular.module('a2.analysis.cnn', ['ui.bootstrap', 'a2.directive.audio-bar', 'a2.srv.cnn', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.disabled-cnn', {\n    url: '/disabled/cnn',\n    templateUrl: '/app/analysis/cnn/disabled.html'\n  }).state('analysis.cnn', {\n    url: '/cnn/',\n    controller: 'CNNCtrl',\n    templateUrl: '/app/analysis/cnn/list.html'\n  }).state('analysis.cnn-details', {\n    url: '/cnn/:cnnId',\n    ///:detailType/',\n    controller: 'CNNCtrl',\n    templateUrl: '/app/analysis/cnn/list.html'\n  });\n}).controller('CNNCtrl', function ($scope, $modal, $filter, $location, Project, ngTableParams, JobsData, a2CNN, a2Playlists, notify, $q, a2UserPermit, $state, $stateParams) {\n  // this debug line for sanity between servers... Will remove TODO\n  console.log(\"CNN Version 1.0\");\n  $scope.selectedCNNId = $stateParams.cnnId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.cnnOriginal, params.filter()) : $scope.cnnOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.cnnOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No cnn searches found.\";\n        }\n\n        $scope.cnnsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.loadCNNs = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CNN.list().then(function (data) {\n      $scope.cnnOriginal = data;\n      $scope.cnnsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"-timestamp\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No cnns found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedCNNId) {\n    $scope.loadCNNs();\n  }\n\n  $scope.createNewCNN = function () {\n    // TODO: add in real cnn permissions\n    if (!a2UserPermit.can('manage cnns')) {\n      notify.error('You do not have permission to create cnn jobs.');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/cnn/createnewcnn.html',\n      controller: 'CreateNewCNNInstanceCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new cnn is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteCNN = function (cnn, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage cnns')) {\n      notify.error('You do not have permission to delete cnns.');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/cnn/deletecnn.html',\n      controller: 'DeleteCNNInstanceCtrl as controller',\n      resolve: {\n        cnn: function () {\n          return cnn;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        notify.log(\"CNN: (\" + cnn.name + \") deleted successfully\");\n        $scope.loadCNNs();\n        /*\n        var index = -1;\n        var modArr = angular.copy($scope.cnnOriginal);\n        for (var i = 0; i < modArr.length; i++) {\n            if (modArr[i].job_id === cnn.job_id) {\n                index = i;\n                break;\n            }\n        }\n        if (index > -1) {\n            $scope.cnnOriginal.splice(index, 1);\n            notify.log(\"CNN deleted successfully\");\n        }\n        */\n      }\n    });\n  };\n\n  $scope.selectItem = function (cnnId) {\n    if (!cnnId) {\n      $state.go('analysis.cnn', {});\n    } else {\n      $state.go('analysis.cnn-details', {\n        cnnId: cnnId //detailType: 'all'\n\n      });\n    }\n  };\n\n  $scope.setDetailedView = function (detailedView) {\n    $scope.detailedView = detailedView;\n    $state.transitionTo($state.current.name, {\n      patternMatchingId: $scope.selectedPatternMatchingId,\n      show: detailedView ? \"detail\" : \"gallery\"\n    }, {\n      notify: false\n    });\n  };\n}).controller('DeleteCNNInstanceCtrl', function ($scope, $modalInstance, a2CNN, cnn, Project) {\n  this.cnn = cnn;\n  $scope.project_name = Project.getUrl();\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2CNN.delete(cnn.job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewCNNInstanceCtrl', function ($scope, $modalInstance, a2PatternMatching, a2Templates, a2Playlists, a2CNN, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false,\n        models: false\n      };\n      var list = this.list = {};\n      list.lambdas = [{\n        'name': 'call_id_testing:1 - create fake data',\n        'key': \"new_cnn_job_test1\"\n      }, {\n        'name': 'function_id_driver - test real function',\n        'key': \"new_cnn_job_v1\"\n      }];\n      this.data = {\n        name: null,\n        playlist: null,\n        model: null,\n        lambda: list.lambdas[0],\n        params: {}\n      };\n      this.loading.models = true;\n      a2CNN.listModels().then(function (models) {\n        this.loading.models = false;\n        list.models = models;\n      }.bind(this));\n      this.loading.playlists = true;\n      a2Playlists.getList().then(function (playlists) {\n        this.loading.playlists = false;\n        list.playlists = playlists;\n      }.bind(this));\n    },\n    ok: function () {\n      try {\n        return a2CNN.create({\n          playlist_id: this.data.playlist.id,\n          cnn_id: this.data.model.id,\n          name: this.data.name,\n          lambda: this.data.lambda.key,\n          params: this.data.params\n        }).then(function (cnn) {\n          $modalInstance.close({\n            ok: true,\n            cnn: cnn\n          });\n        }).catch(notify.serverError);\n      } catch (error) {\n        console.error(\"a2CNN.create error: \" + error);\n      }\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    }\n  });\n  this.initialize();\n}).directive('a2CnnDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      cnnId: '=',\n      detailedView: '=',\n      onSetDetailedView: '&',\n      onGoBack: '&'\n    },\n    controller: 'CNNDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/cnn/details.html'\n  };\n}).controller('CNNDetailsCtrl', function ($scope, $state, ngTableParams, a2AudioPlayer, $filter, a2CNN, a2UserPermit, Project, a2AudioBarService, notify) {\n  var projecturl = Project.getUrl();\n  $scope.lists = {\n    thumbnails: [{\n      class: 'fa fa-th-large',\n      value: ''\n    }, {\n      class: 'fa fa-th',\n      value: 'is-small'\n    }],\n    search: [{\n      value: 'all',\n      text: 'All',\n      description: 'Show all matched rois.'\n    }, {\n      value: 'present',\n      text: 'Present',\n      description: 'Show all rois marked as present.'\n    }, {\n      value: 'not_present',\n      text: 'Not Present',\n      description: 'Show all rois marked as not present.'\n    }, {\n      value: 'unvalidated',\n      text: 'Unvalidated',\n      description: 'Show all rois without validation.'\n    }, {\n      value: 'by_score',\n      text: 'Score per Species',\n      description: 'Show rois ranked by score per species.'\n    }, {\n      value: 'by_score_per_site',\n      text: 'Score per Site',\n      description: 'Show rois ranked by score per site.'\n    }],\n    selection: [{\n      value: 'all',\n      text: 'All'\n    }, {\n      value: 'none',\n      text: 'None'\n    }, {\n      value: 'not-validated',\n      text: 'Not Validated'\n    }],\n    validation: [{\n      class: \"fa val-1\",\n      text: \"Present\",\n      value: 1\n    }, {\n      class: \"fa val-0\",\n      text: \"Not Present\",\n      value: 0\n    }, {\n      class: \"fa val-null\",\n      text: \"Clear\",\n      value: null\n    }],\n    current: {\n      thumbnailClass: 'is-small'\n    }\n  };\n  $scope.total = {\n    rois: 0,\n    pages: 0\n  };\n  $scope.selected = {\n    roi_index: 0,\n    roi: null,\n    page: 0,\n    search: $scope.lists.search[4]\n  };\n  $scope.validation = {\n    current: $scope.lists.validation[2]\n  };\n  $scope.offset = 0;\n  $scope.limit = 100; //$scope.viewType = \"species\";\n\n  var setupExportUrl = function () {\n    $scope.CNNExportUrl = a2CNN.getExportUrl({\n      cnnId: $scope.cnnId\n    });\n  };\n\n  $scope.exportCnnReport = function ($event) {\n    $event.stopPropagation();\n    if (a2UserPermit.isSuper()) return setupExportUrl();\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export CNN data');\n    } else return setupExportUrl();\n  };\n\n  var audio_player = new a2AudioPlayer($scope);\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.cnnOriginal, params.filter()) : $scope.cnnOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.cnnOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No cnn searches found.\";\n        }\n\n        cnnsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n\n        if ($scope.viewType == \"species\") {\n          $scope.species = cnnsData;\n        } else if ($scope.viewType == \"recordings\") {\n          $scope.recordings = cnnsData;\n        } else {\n          $scope.mainResults = cnnsData;\n        }\n      }\n    });\n  }; //$scope.viewType = \"all\";\n\n\n  $scope.counts = {\n    recordings: null\n  };\n\n  $scope.onSelect = function (item) {\n    $scope.select(item.value);\n  };\n\n  $scope.select = function (option) {\n    var selectFn = null;\n\n    if (option === \"all\") {\n      selectFn = function (roi) {\n        roi.selected = true;\n      };\n    } else if (option === \"none\") {\n      selectFn = function (roi) {\n        roi.selected = false;\n      };\n    } else if (option === \"not-validated\") {\n      selectFn = function (roi) {\n        roi.selected = roi.validated === null;\n      };\n    } else {\n      selectFn = function (roi) {\n        roi.selected = roi.id === option;\n      };\n    }\n\n    ($scope.resultsROIs || []).forEach(selectFn);\n  };\n\n  var refreshDetails = function () {\n    a2CNN.getDetailsFor($scope.cnnId).then(function (data) {\n      $scope.job_details = data;\n    });\n  };\n\n  refreshDetails();\n\n  var bySpecies = function (dataIn) {\n    var dataOut = {};\n    dataIn.forEach(function (element) {\n      var s = element.species_id;\n\n      if (!(s in dataOut)) {\n        dataOut[s] = {\n          count: 0,\n          species_id: s,\n          scientific_name: element.scientific_name\n        };\n      }\n\n      if (element.present == 1) {\n        dataOut[s].count++;\n      }\n    });\n    return dataOut;\n  };\n\n  var byROIs = function (dataIn, thresh) {\n    if (!thresh) {\n      thresh = 0.9;\n    }\n\n    var dataOut = [];\n    dataIn.forEach(function (element) {\n      element.over_thresh = element.score >= thresh;\n      element.present = element.over_thresh;\n      dataOut.push(element);\n    });\n    dataOut.sort(function (a, b) {\n      return a.score < b.score ? 1 : -1;\n    });\n    return dataOut;\n  };\n\n  var byROIsbySpecies = function (dataIn, bySite) {\n    dataOut = {};\n    dataIn.forEach(function (element) {\n      var s = bySite ? element.site : element.species_id + '_' + element.songtype_id;\n\n      if (!(s in dataOut)) {\n        dataOut[s] = {\n          count: 0,\n          species_id: element.species_id,\n          songtype_id: element.songtype_id,\n          scientific_name: element.scientific_name,\n          songtype: element.songtype,\n          rois: []\n        };\n        if (bySite) dataOut[s].site = element.site;\n      }\n\n      dataOut[s].rois.push(element);\n      dataOut[s].count++;\n    });\n    return dataOut;\n  };\n\n  var byRecordings = function (dataIn) {\n    var dataOut = {\n      total: 0\n    };\n    dataIn.forEach(function (element) {\n      var r = element.recording_id;\n      var s = element.species_id;\n\n      if (!(r in dataOut)) {\n        dataOut[r] = {\n          recording_id: r,\n          thumbnail: element.thumbnail,\n          species: {},\n          total: 0,\n          species_list: ''\n        };\n      }\n\n      if (!(s in dataOut[r].species)) {\n        dataOut[r].species[s] = {\n          species_id: s,\n          scientific_name: element.scientific_name,\n          count: 0\n        };\n      }\n\n      if (element.present == 1) {\n        if (dataOut[r].species[s].count == 0) {\n          dataOut[r].species_list = dataOut[r].species_list + ' ' + element.scientific_name;\n        }\n\n        dataOut[r].species[s].count++;\n        dataOut[r].total++;\n      }\n    });\n    return dataOut;\n  };\n\n  var bySpeciesHist = function (dataIn, species_id) {\n    speciesTimes = [];\n    count = 0;\n    speciesName = 'All'; //fix this... ugh\n\n    dataIn.forEach(function (element) {\n      if (species_id == 'all' | element.species_id == species_id) {\n        if (species_id == 'all') {\n          speciesName = 'All';\n        } else {\n          speciesName = element.scientific_name;\n        }\n\n        if (element.present == 1) {\n          var d = new Date(element.datetime);\n          var minutes = d.getHours() * 60 + d.getMinutes();\n          speciesTimes.push(new Date(3000, 0, 1, d.getHours(), d.getMinutes()));\n          count++;\n        }\n      }\n    });\n    return {\n      times: speciesTimes,\n      count: count,\n      name: speciesName\n    };\n  };\n\n  var plotShown = false;\n\n  $scope.showHist = function (species_id) {\n    $scope.speciesInfo = bySpeciesHist($scope.results, species_id);\n    var trace = {\n      x: $scope.speciesInfo.times,\n      type: 'histogram',\n      //xbins: {size: new Date(3000, 0, 2, 2).getTime() - new Date(3000, 0, 2, 0).getTime()}\n      //magic numbers for full day/2 hour bins\n      xbins: {\n        start: 32503698000000,\n        end: 32503791600000,\n        size: 7200000\n      }\n    };\n    var layout = {\n      title: $scope.speciesInfo.name + ' by time of day.',\n      xaxis: {\n        tickformat: '%X',\n        // For more time formatting types, see: https://github.com/d3/d3-time-format/blob/master/README.md\n        range: [new Date(3000, 0, 1).getTime(), new Date(3000, 0, 2).getTime()]\n      }\n    };\n    var data = [trace];\n\n    if (!plotShown) {\n      Plotly.newPlot('speciesHist', data, layout);\n      plotShown = true;\n    } else {\n      Plotly.newPlot('speciesHist', data, layout);\n    }\n  };\n\n  $scope.getRecordingVisualizerUrl = function (recording_id) {\n    return \"/project/\" + Project.getUrl() + \"/visualizer/rec/\" + recording_id;\n  };\n\n  $scope.getRoiVisualizerUrl = function (roi) {\n    var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n    return roi ? \"/project/\" + projecturl + \"/#/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + projecturl + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  };\n\n  $scope.playRoiAudio = function (roi, $event) {\n    if ($event) {\n      $event.preventDefault();\n      $event.stopPropagation();\n    }\n\n    a2AudioBarService.loadUrl(a2CNN.getAudioUrlFor(roi), true);\n  };\n\n  $scope.setPage = function (page, force) {\n    page = Math.max(0, Math.min(page, $scope.total.rois / $scope.limit | 0));\n\n    if (page != $scope.selected.page || force) {\n      $scope.selected.page = page;\n      $scope.offset = page * $scope.limit;\n      loadROIPage();\n    }\n  };\n\n  $scope.moveROIPage = function (n) {\n    var nextPage = $scope.selected.page + n;\n\n    if (nextPage > $scope.total.pages - 1) {\n      $scope.setPage(0);\n    } else if (nextPage < 0) {\n      $scope.setPage($scope.total.pages - 1);\n    } else {\n      $scope.setPage(nextPage);\n    }\n  };\n\n  $scope.setSpecies = function (species) {\n    $scope.selected.species = species;\n    $scope.selected.page = 0;\n    $scope.offset = 0;\n    var site_name = \"site_\" + $scope.selected.site.site_id + \"_\" + $scope.selected.site.name;\n\n    if ($scope.selected.site.site_id == 0) {\n      site_name = 0;\n    }\n\n    $scope.counts.roi_species_counts = getSpeciesCounts(site_name, $scope.roi_species_sites_counts);\n    $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species.species_id, $scope.roi_species_sites_counts);\n    var count_all_species = $scope.counts.roi_species_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    all_species = {\n      species_id: 0,\n      N: count_all_species,\n      scientific_name: \"All Species\"\n    };\n    $scope.counts.roi_species_counts.unshift(all_species);\n    var count_all_sites = $scope.counts.roi_sites_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    var all_site = {\n      site_id: 0,\n      N: count_all_sites,\n      name: \"All Sites\"\n    };\n    $scope.counts.roi_sites_counts.unshift(all_site);\n    $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n      return element.site_id == $scope.selected.site.site_id;\n    });\n    $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n      return element.species_id == $scope.selected.species.species_id;\n    }); //$scope.counts.roi_sites_counts.unshift($scope.selected.site);\n    //$scope.selected.site = all_site;\n\n    $scope.total = {\n      rois: species.N,\n      pages: Math.ceil(species.N / $scope.limit)\n    };\n    loadROIPage();\n  };\n\n  $scope.counts = {};\n\n  $scope.setSite = function (site) {\n    $scope.selected.site = site;\n    $scope.selected.page = 0;\n    $scope.offset = 0;\n    var site_name = \"site_\" + $scope.selected.site.site_id + \"_\" + $scope.selected.site.name;\n\n    if ($scope.selected.site.site_id == 0) {\n      site_name = 0;\n    }\n\n    $scope.counts.roi_species_counts = getSpeciesCounts(site_name, $scope.roi_species_sites_counts);\n    $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species.species_id, $scope.roi_species_sites_counts);\n    var count_all_species = $scope.counts.roi_species_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    all_species = {\n      species_id: 0,\n      N: count_all_species,\n      scientific_name: \"All Species\"\n    };\n    $scope.counts.roi_species_counts.unshift(all_species); //$scope.counts.roi_species_counts.unshift($scope.selected.species);\n\n    var count_all_sites = $scope.counts.roi_sites_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    var all_site = {\n      site_id: 0,\n      N: count_all_sites,\n      name: \"All Sites\"\n    };\n    $scope.counts.roi_sites_counts.unshift(all_site);\n    $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n      return element.species_id == $scope.selected.species.species_id;\n    });\n    $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n      return element.site_id == $scope.selected.site.site_id;\n    });\n    $scope.total = {\n      rois: site.N,\n      pages: Math.ceil(site.N / $scope.limit)\n    };\n    loadROIPage();\n  };\n\n  var loadROIPage = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    a2CNN.listROIs($scope.cnnId, $scope.limit, $scope.offset, $scope.selected.species.species_id, $scope.selected.site.site_id, $scope.selected.search.value).then(function (data) {\n      $scope.resultsROIs = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n      $scope.rois = byROIs($scope.resultsROIs);\n      $scope.rois_species = byROIsbySpecies($scope.rois, $scope.selected.search.value === 'by_score_per_site');\n    });\n  };\n\n  $scope.validate = function () {\n    if (!a2UserPermit.can('validate cnn rois')) {\n      notify.log('You do not have permission to validate the cnn rois.');\n      return;\n    }\n\n    var validation = ($scope.validation.current || {\n      value: null\n    }).value;\n    var rois = [];\n\n    for (var species in $scope.rois_species) {\n      $scope.rois_species[species].rois.forEach(function (roi) {\n        if (roi.selected) {\n          rois.push(roi);\n        }\n      });\n    }\n\n    var roiIds = rois.map(function (roi) {\n      return roi.cnn_result_roi_id;\n    });\n\n    try {\n      a2CNN.validateRois($scope.cnnId, roiIds, validation).then(function (response) {\n        rois.forEach(function (roi) {\n          roi.validated = validation;\n          roi.selected = false;\n        }); //loadROIPage();\n      });\n    } catch (error) {\n      console.error(\"TCL: $scope.validate -> error\", error);\n    }\n\n    refreshDetails();\n  }; //$scope.calcWidth = function(roi) {\n  //};\n\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    var scrollPos = $controller.scrollElement.scrollY;\n    var headerTop = $controller.anchors.header.offset().top;\n    this.headerTop = headerTop | 0;\n    this.scrolledPastHeader = scrollPos >= headerTop;\n  };\n\n  var getSpeciesCounts = function (site, species_sites_matrix) {\n    if (site == 0) {\n      site = 'total';\n    }\n\n    var roi_species_counts = [];\n    species_sites_matrix.forEach(function (species) {\n      roi_species_counts.push({\n        species_id: species.species_id,\n        N: species[site],\n        scientific_name: species.scientific_name\n      });\n    });\n    return roi_species_counts;\n  };\n\n  var getSitesCounts = function (species, species_sites_matrix) {\n    if (species == 0) {\n      species = 'total';\n    }\n\n    var roi_site_counts = [];\n    species_sites_matrix.forEach(function (s) {\n      if (species == 'total' | s.species_id == species) {\n        for (key in s) {\n          split = key.split(\"_\");\n          site_id = split[1];\n          name = split.slice(2).join(\"_\");\n\n          if (split[0] == \"site\") {\n            row = {};\n            row.site_id = site_id;\n            row.N = s[key];\n            row.name = name;\n            roi_site_counts.push(row);\n          }\n        }\n      }\n    });\n\n    if (species == 'total') {\n      roi_site_counts_dict = roi_site_counts.reduce(function (sitesAcc, site) {\n        if (!(site.site_id in sitesAcc)) {\n          sitesAcc[site.site_id] = {\n            site_id: site.site_id,\n            N: 0,\n            name: site.name\n          };\n        }\n\n        sitesAcc[site.site_id].N += site.N;\n        return sitesAcc;\n      }, {});\n      roi_site_counts = Object.values(roi_site_counts_dict);\n    }\n\n    return roi_site_counts;\n  };\n\n  $scope.onSearchChanged = function () {\n    $scope.switchView(\"rois\");\n  };\n\n  $scope.switchView = function (viewType, specie) {\n    if (specie) {\n      window.scrollTo(0, 0);\n    }\n\n    var sortBy = \"-cnn_presence_id\";\n\n    var loadSwitch = function () {\n      if (viewType == \"species\") {\n        $scope.species = bySpecies($scope.results);\n        $scope.viewType = \"species\";\n        sortBy = \"-scientific_name\";\n        $scope.showHist(specie ? specie : \"all\");\n        $scope.cnnOriginal = Object.values($scope.species);\n      } else if (viewType == \"recordings\") {\n        $scope.recordings = byRecordings($scope.results);\n        $scope.counts.recordings = Object.keys($scope.recordings).length;\n        $scope.viewType = \"recordings\";\n        sortBy = \"-recording_id\";\n        $scope.cnnOriginal = Object.values($scope.recordings);\n      } else {\n        $scope.viewType = \"all\";\n        $scope.mainResults = $scope.results;\n        $scope.cnnOriginal = Object.values($scope.results);\n      }\n\n      if ($scope.cnnOriginal.length > 0) {\n        initTable(1, 10, sortBy, {}, $scope.cnnOriginal.length);\n      } else {\n        $scope.infopanedata = \"No cnn results found.\";\n      }\n    };\n\n    if (viewType == \"rois\") {\n      a2CNN.countROIsBySpeciesSites($scope.cnnId, {\n        search: $scope.selected.search.value\n      }).then(function (response) {\n        var data = response.data;\n        $scope.roi_species_sites_counts = data;\n        $scope.counts.roi_species_counts = getSpeciesCounts($scope.selected.site ? $scope.selected.site.site_id : 0, $scope.roi_species_sites_counts);\n        $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species ? $scope.selected.species.species_id : 0, $scope.roi_species_sites_counts);\n        var count_all = $scope.counts.roi_species_counts.reduce(function (count, current) {\n          return count = count + current.N;\n        }, 0);\n        var all_species = {\n          species_id: 0,\n          N: count_all,\n          scientific_name: \"All Species\"\n        };\n        $scope.counts.roi_species_counts.unshift(all_species);\n\n        if (!$scope.selected.species) {\n          $scope.selected.species = all_species;\n        } else {\n          $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n            return element.species_id == $scope.selected.species.species_id;\n          }) || all_species;\n        }\n\n        var all_sites = {\n          site_id: 0,\n          N: count_all,\n          name: \"All Sites\"\n        };\n        $scope.counts.roi_sites_counts.unshift(all_sites);\n\n        if (!$scope.selected.site) {\n          $scope.selected.site = all_sites;\n        } else {\n          $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n            return element.site_id == $scope.selected.site.site_id;\n          }) || all_sites;\n        }\n\n        $scope.total = {\n          rois: count_all,\n          pages: Math.ceil(count_all / $scope.limit)\n        };\n        $scope.viewType = \"rois\";\n        loadROIPage();\n      }); //$scope.viewType = \"rois\";\n      //if (!$scope.resultsROIs) {\n      //    loadROIPage();\n      //} else {\n      //    $scope.rois = byROIs($scope.resultsROIs);\n      //    $scope.rois_species = byROIsbySpecies($scope.rois);\n      //}\n    } else if (!$scope.results) {\n      $scope.loading = true;\n      $scope.infoInfo = \"Loading...\";\n      $scope.showInfo = true;\n      a2CNN.listResults($scope.cnnId).then(function (data) {\n        $scope.results = data;\n        $scope.infoInfo = \"\";\n        $scope.showInfo = false;\n        $scope.loading = false;\n        $scope.infopanedata = \"\";\n        $scope.switchView('rois'); //loadSwitch();\n      });\n    } else {\n      loadSwitch();\n    }\n  };\n\n  $scope.switchView($state.params.detailType ? $state.params.detailType : 'all');\n});","angular.module('a2.analysis.audio-event-detections-clustering', ['ui.bootstrap', 'a2.srv.audio-event-detections-clustering', 'a2.services', 'a2.permissions', 'humane', 'a2.directive.error-message']).config(function ($stateProvider) {\n  $stateProvider.state('analysis.audio-event-detections-clustering', {\n    url: '/audio-event-detections-clustering',\n    controller: 'AudioEventDetectionsClusteringModelCtrl',\n    templateUrl: '/app/analysis/audio-event-detections-clustering/list.html'\n  });\n}).controller('AudioEventDetectionsClusteringModelCtrl', function ($scope, $modal, $location, JobsData, notify, a2AudioEventDetectionsClustering, Project, $localStorage, $window, a2UserPermit) {\n  $scope.loadAudioEventDetections = function () {\n    $scope.loading = true;\n    $scope.showRefreshBtn = false;\n    $scope.projectUrl = Project.getUrl();\n    return a2AudioEventDetectionsClustering.list({\n      user: true,\n      dataExtended: true,\n      completed: true,\n      aedCount: true\n    }).then(function (data) {\n      $scope.audioEventDetectionsOriginal = data;\n      $scope.audioEventDetectionsData = data;\n      $scope.loading = false;\n\n      if (data && data.length) {\n        $scope.showRefreshBtn = true;\n      }\n    });\n  };\n\n  $scope.loadAudioEventDetections();\n\n  $scope.onSelectedJob = function (playlist_id, job_id, first_playlist_recording) {\n    $localStorage.setItem('analysis.audioEventJob', job_id);\n    $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/' + playlist_id + '/' + first_playlist_recording;\n  };\n\n  $scope.createNewClusteringModel = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to create <br> Audio Event Detection job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/audio-event-detections-clustering/new-audio-event-detection-clustering.html',\n      controller: 'CreateNewAudioEventDetectionClusteringCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.create) {\n        JobsData.updateJobs();\n        $scope.showRefreshBtn = true;\n        notify.log(\"Your new Audio Event Detection Clustering model is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteAedJob = function (aedJob, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to delete <br> Audio Event Detection job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/audio-event-detections-clustering/delete-audio-event-detection-clustering-job.html',\n      controller: 'DeleteAedJobCtrl as controller',\n      resolve: {\n        aedJob: function () {\n          return aedJob;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error('Error: ' + ret.err);\n      } else {\n        const modArr = angular.copy($scope.audioEventDetectionsOriginal);\n        const indx = modArr.findIndex(function (item) {\n          return item.job_id === aedJob.job_id;\n        });\n\n        if (indx > -1) {\n          $scope.audioEventDetectionsOriginal.splice(indx, 1);\n          notify.log('Audio Event Detection Job deleted successfully');\n        }\n      }\n    });\n  };\n}).controller('DeleteAedJobCtrl', function ($scope, $modalInstance, a2AudioEventDetectionsClustering, aedJob) {\n  this.aedJob = aedJob;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2AudioEventDetectionsClustering.delete(aedJob.job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewAudioEventDetectionClusteringCtrl', function ($modalInstance, a2AudioEventDetectionsClustering, a2Playlists, a2UserPermit, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false\n      };\n      this.details = {\n        show: false\n      };\n      var list = this.list = {};\n      this.data = {\n        name: null,\n        playlist: null,\n        params: {\n          areaThreshold: 1,\n          amplitudeThreshold: 1,\n          durationThreshold: 0.2,\n          bandwidthThreshold: 0.5,\n          filterSize: 10,\n          minFrequency: 0,\n          maxFrequency: 24\n        }\n      };\n      this.isRfcxUser = a2UserPermit.isRfcx();\n      this.isSuper = a2UserPermit.isSuper();\n      this.errorJobLimit = false;\n      this.loading.playlists = true;\n      a2Playlists.getList({\n        filterPlaylistLimit: true\n      }).then(function (playlists) {\n        this.loading.playlists = false;\n        list.playlists = playlists;\n      }.bind(this));\n    },\n    isRfcx: function () {\n      return this.isRfcxUser || this.isSuper;\n    },\n    checkLimit: function (count) {\n      return count > 10000 && !this.isRfcx();\n    },\n    toggleDetails: function () {\n      this.details.show = !this.details.show;\n    },\n    newJob: function () {\n      try {\n        return a2AudioEventDetectionsClustering.create({\n          playlist_id: this.data.playlist.id,\n          name: this.data.name,\n          params: this.data.params\n        }).then(function (clusteringModel) {\n          $modalInstance.close({\n            create: true,\n            clusteringModel: clusteringModel\n          });\n        }).catch(notify.serverError);\n      } catch (error) {\n        console.error('a2AudioEventDetectionsClustering.create error: ' + error);\n      }\n    },\n    create: function () {\n      var _this = this;\n\n      this.errorJobLimit = false;\n      if (this.isRfcx()) return this.newJob();\n      return a2AudioEventDetectionsClustering.count().then(function (data) {\n        if (_this.checkLimit(data.totalRecordings)) {\n          _this.errorJobLimit = true;\n          return;\n        } else _this.newJob();\n      });\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isJobValid: function () {\n      return this.data && this.data.name && this.data.name.length > 3 && this.data.playlist && !this.isNotDefined(this.data.params.maxFrequency) && !this.isNotDefined(this.data.params.minFrequency);\n    },\n    showNameWarning: function () {\n      return this.data && this.data.name && this.data.name.length > 1 && this.data.name.length < 4;\n    },\n    showPlaylistLimitWarning: function () {\n      if (!this.data && !this.data.playlist) return;\n      return this.data && this.data.playlist && this.data.playlist.count > 2000 && !this.isRfcx();\n    },\n    showFrequencyWarning: function () {\n      return this.data.params.maxFrequency <= this.data.params.minFrequency;\n    },\n    isNotDefined: function (item) {\n      return item === undefined || item === null;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.analysis.patternmatching', ['ui.bootstrap', 'a2.directive.audio-bar', 'a2.srv.patternmatching', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.disabled-patternmatching', {\n    url: '/disabled/patternmatching',\n    templateUrl: '/app/analysis/patternmatching/disabled.html'\n  });\n  $stateProvider.state('analysis.patternmatching', {\n    url: '/patternmatching',\n    controller: 'PatternMatchingCtrl',\n    templateUrl: '/app/analysis/patternmatching/list.html'\n  });\n  $stateProvider.state('analysis.patternmatching-details', {\n    url: '/patternmatching/:patternMatchingId',\n    controller: 'PatternMatchingCtrl',\n    templateUrl: '/app/analysis/patternmatching/list.html'\n  });\n}).controller('PatternMatchingCtrl', function ($scope, $modal, JobsData, $location, notify, $q, a2PatternMatching, a2UserPermit, $state, $stateParams, Project) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n  $scope.loading = {\n    rows: false,\n    showRefreshBtn: false\n  };\n  $scope.paginationSettings = {\n    page: 1,\n    limit: 10,\n    offset: 0,\n    totalJobs: 0,\n    totalPages: 0\n  };\n  $scope.search = {\n    q: ''\n  };\n  var timeout;\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box;\n\n    if (template && template.x1) {\n      box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    }\n\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $scope.selectedPatternMatchingId = patternmatchingId;\n\n    if (!patternmatchingId) {\n      $state.go('analysis.patternmatching', {});\n    } else {\n      $state.go('analysis.patternmatching-details', {\n        patternMatchingId: patternmatchingId\n      });\n    }\n  };\n\n  $scope.setCurrentPage = function () {\n    this.paginationSettings.offset = $scope.paginationSettings.page - 1;\n    $scope.loadPatternMatchings();\n  };\n\n  $scope.update = function (patternMatching, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to edit pattern matchings');\n      return;\n    }\n\n    $scope.pmName = patternMatching.name;\n    const modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/edit-patternmatching.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function (name) {\n      a2PatternMatching.update(patternMatching.id, {\n        name: name\n      }).then(function () {\n        $scope.loadPatternMatchings();\n      });\n    });\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading.rows = true;\n    $scope.showInfo = true;\n    $scope.splitAllSites = false;\n    return a2PatternMatching.list({\n      completed: true,\n      q: $scope.search.q,\n      limit: $scope.paginationSettings.limit,\n      offset: $scope.paginationSettings.offset * $scope.paginationSettings.limit\n    }).then(function (data) {\n      $scope.patternmatchingsOriginal = data.list;\n      $scope.patternmatchingsData = data.list;\n      $scope.paginationSettings.totalJobs = data.count;\n      $scope.paginationSettings.totalPages = Math.ceil($scope.paginationSettings.totalJobs / $scope.paginationSettings.limit);\n      $scope.showInfo = false;\n      $scope.loading.rows = false;\n\n      if (data && data.list.length) {\n        $scope.loading.showRefreshBtn = true;\n      }\n    });\n  };\n\n  $scope.onFilterChanged = function () {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      if ($scope.search.q.trim().length > 0 && $scope.search.q.trim().length < 4) return;\n      $scope.resetPagination();\n      $scope.loadPatternMatchings();\n    }, 1000);\n  };\n\n  $scope.isShowSearch = function () {\n    return $scope.patternmatchingsData && $scope.patternmatchingsData.length || $scope.search.q.trim().length > 0;\n  };\n\n  $scope.resetPagination = function () {\n    $scope.paginationSettings.page = 1;\n    $scope.paginationSettings.offset = 0;\n    $scope.paginationSettings.totalJobs = 0;\n    $scope.paginationSettings.totalPages = 0;\n  };\n\n  $scope.createNewPatternMatching = function () {\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to create pattern matchings');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/createnewpatternmatching.html',\n      controller: 'CreateNewPatternMatchingInstanceCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        $scope.loading.showRefreshBtn = true;\n        notify.log(\"Your new pattern matching is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deletePatternMatching = function (patternMatching, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to delete pattern matchings');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/deletepatternmatching.html',\n      controller: 'DeletePatternMatchingInstanceCtrl as controller',\n      resolve: {\n        patternMatching: function () {\n          return patternMatching;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.patternmatchingsOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].id === patternMatching.id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.patternmatchingsOriginal.splice(index, 1);\n          notify.log(\"PatternMatching deleted successfully\");\n        }\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2PatternMatchingDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'PatternMatchingDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/patternmatching/details.html'\n  };\n}).controller('PatternMatchingDetailsCtrl', function ($scope, $q, a2PatternMatching, a2Templates, a2UserPermit, Project, a2AudioBarService, notify, $anchorScroll, $modal) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 1\n      };\n      this.sitesList = [];\n      this.sitesListBatchSize = 20;\n      this.sitesBatches = [];\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.paginationTotal = 0;\n      this.loading = {\n        details: false,\n        rois: true\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.search = this.lists.search[6];\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        return this.loadSitesList();\n      }.bind(this)).then(function () {\n        return this.loadData(1);\n      }.bind(this));\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      search: [{\n        value: 'all',\n        text: 'All',\n        description: 'Show all matched Region of Interest.'\n      }, {\n        value: 'present',\n        text: 'Present',\n        description: 'Show all Region of Interest marked as present.'\n      }, {\n        value: 'not_present',\n        text: 'Not Present',\n        description: 'Show all Region of Interest marked as not present.'\n      }, {\n        value: 'unvalidated',\n        text: 'Unvalidated',\n        description: 'Show all Region of Interest without validation.'\n      }, {\n        value: 'best_per_site',\n        text: 'Best per Site',\n        description: 'Show the best scored roi per site.'\n      }, {\n        value: 'best_per_site_day',\n        text: 'Best per Site, Day',\n        description: 'Show the best scored roi per site and day.'\n      }, {\n        value: 'by_score',\n        text: 'Score',\n        description: 'Show all Region of Interest ranked by score.'\n      }, {\n        value: 'by_score_per_site',\n        text: 'Score per Site',\n        description: 'Show all Region of Interest ranked by score per site.'\n      }, {\n        value: 'top_200_per_site',\n        text: '200 Top Scores per Site',\n        description: 'Show Top 200 Region of Interest ranked by score per each site.'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      }, {\n        value: 'not-validated',\n        text: 'Not Validated'\n      }],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2PatternMatching.getDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.patternMatching.templateParameters = {\n          'Threshold': this.patternMatching.parameters.threshold,\n          'Matches/Recording': this.patternMatching.parameters.N,\n          'Matches/Site': this.patternMatching.parameters.persite || 'no limit'\n        };\n        this.total = {\n          rois: patternMatching.matches,\n          pages: Math.ceil(patternMatching.matches / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    onSearchChanged: function () {\n      this.selected.page = 1;\n      this.recalculateSiteListBatch();\n      this.loadData(1);\n    },\n    update: function (patternMatching, $event) {\n      const self = this;\n      $event.stopPropagation();\n\n      if (!a2UserPermit.can('manage pattern matchings')) {\n        notify.error('You do not have permission to edit pattern matchings');\n        return;\n      }\n\n      $scope.pmName = patternMatching.name;\n      const modalInstance = $modal.open({\n        templateUrl: '/app/analysis/patternmatching/edit-patternmatching.html',\n        scope: $scope\n      });\n      modalInstance.result.then(function (name) {\n        a2PatternMatching.update(patternMatching.id, {\n          name: name\n        }).then(function () {\n          patternMatching.name = name;\n        });\n      });\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2PatternMatching.getExportUrl({\n        patternMatching: this.patternMatching.id,\n        jobName: encodeURIComponent(this.patternMatching.name)\n      });\n    },\n    exportPmReport: function ($event) {\n      $event.stopPropagation();\n      if (a2UserPermit.isSuper()) return this.setupExportUrl();\n\n      if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n        return notify.error('You do not have permission to export Pattern Matching data');\n      } else return this.setupExportUrl();\n    },\n    onScroll: function ($event, $controller) {\n      if (this.search.value === 'by_score_per_site') {\n        return false;\n      }\n\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadSitesList: function () {\n      return a2PatternMatching.getSitesListFor(this.id).then(function (list) {\n        this.sitesList = list;\n        this.sitesTotal = this.sitesBatches.length;\n        this.splitSitesListIntoBatches();\n      }.bind(this));\n    },\n    splitSitesListIntoBatches: function () {\n      var batches = [];\n\n      for (var i = 0; i < this.sitesList.length; i += this.sitesListBatchSize) {\n        batches.push(this.sitesList.slice(i, i + this.sitesListBatchSize));\n      }\n\n      this.sitesBatches = batches;\n    },\n    getCountPerSite: function () {\n      return this.rois && this.rois[0] && this.rois[0].list[0].countPerSite;\n    },\n    recalculateTotalItems: function () {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n\n      switch (search) {\n        case 'present':\n          this.paginationTotal = this.patternMatching.present;\n          break;\n\n        case 'not_present':\n          this.paginationTotal = this.patternMatching.absent;\n          break;\n\n        case 'by_score':\n          this.paginationTotal = this.patternMatching.matches;\n          break;\n\n        case 'by_score_per_site':\n          this.paginationTotal = this.getCountPerSite();\n          break;\n\n        default:\n          this.paginationTotal = 0;\n      }\n    },\n    recalculateSiteListBatch: function () {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      var shouldRecalculate = false;\n\n      if (['all', 'unvalidated', 'top_200_per_site', 'by_score_per_site'].includes(search)) {\n        if (this.sitesListBatchSize !== 1) {\n          shouldRecalculate = true;\n        }\n\n        this.sitesListBatchSize = 1;\n      } else if (['best_per_site', 'best_per_site_day'].includes(search)) {\n        if (this.sitesListBatchSize !== 10) {\n          shouldRecalculate = true;\n        }\n\n        this.sitesListBatchSize = 10;\n      }\n\n      if (shouldRecalculate) {\n        this.splitSitesListIntoBatches();\n      }\n    },\n    setSiteBookmark: function (site) {\n      const scorePerSite = this.search.value === 'by_score_per_site';\n\n      if (this.shouldGetPerSite() || scorePerSite) {\n        this.selected.page = scorePerSite ? 1 : this.getSiteBatchIndexBySiteId(site.site_id) + 1;\n        return this.loadData();\n      }\n\n      var bookmark = 'site-' + site.site_id;\n      $anchorScroll.yOffset = $('.a2-page-header').height() + 60;\n      $anchorScroll(bookmark);\n    },\n    shouldGetPerSite: function () {\n      return this.search && ['all', 'unvalidated', 'top_200_per_site', 'best_per_site', 'best_per_site_day'].includes(this.search.value);\n    },\n    getSiteBatchIndexBySiteId: function (siteId) {\n      if (!this.sitesBatches || !this.sitesBatches.length) {\n        return undefined;\n      }\n\n      return this.sitesBatches.findIndex(function (batch) {\n        return !!batch.find(function (site) {\n          return site.site_id === siteId;\n        });\n      });\n    },\n    getSiteBatchBySiteId: function (siteId) {\n      const batchIndex = this.getSiteBatchIndexBySiteId(siteId);\n\n      if (batchIndex === undefined) {\n        return undefined;\n      }\n\n      return this.sitesBatches[batchIndex];\n    },\n    getSiteBatchByPageNumber: function (page) {\n      if (!this.sitesBatches || !this.sitesBatches.length) {\n        return undefined;\n      }\n\n      return this.sitesBatches[page - 1];\n    },\n    combOpts: function (data) {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      var opts = {\n        search: search\n      };\n\n      if (data.site) {\n        opts.site = data.site;\n      }\n\n      if (data.sites) {\n        opts.sites = data.sites;\n      }\n\n      var limit, offset;\n      const doubleLimit = 200;\n      const offsetCalc = offset = (data.pageNumber - 1) * this.limit;\n\n      switch (search) {\n        case 'top_200_per_site':\n          limit = doubleLimit;\n          offset = 0;\n          break;\n\n        case 'best_per_site':\n          limit = 1;\n          offset = 0;\n          break;\n\n        case 'all':\n        case 'unvalidated':\n          limit = 100000000;\n          offset = 0;\n          break;\n\n        default:\n          limit = this.limit;\n          offset = offsetCalc;\n      }\n\n      return {\n        limit: limit,\n        offset: offset,\n        opts: opts\n      };\n    },\n    parseRoisResult: function (rois) {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      this.splitAllSites = search === 'by_score';\n\n      if (this.splitAllSites) {\n        return [{\n          list: rois\n        }];\n      } else {\n        return rois.reduce(function (_, roi) {\n          var site_id = roi.site_id;\n          var sitename = roi.site;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename,\n              id: site_id\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n      }\n    },\n    loadData: function (page) {\n      var params;\n\n      if (this.search.value === 'by_score_per_site') {\n        const site = this.selected.siteBookmark ? this.selected.siteBookmark.site_id : this.sitesBatches[0][0].site_id;\n        params = this.combOpts({\n          sites: site,\n          pageNumber: this.selected.page\n        });\n      } else if (this.shouldGetPerSite()) {\n        page = page || this.selected.page;\n        var siteBatch = this.getSiteBatchByPageNumber(page);\n        var siteIds = siteBatch.map(function (s) {\n          return s.site_id;\n        });\n        params = this.combOpts({\n          sites: siteIds\n        });\n      } else {\n        params = this.combOpts({\n          pageNumber: this.selected.page\n        });\n      }\n\n      this.rois = [];\n      this.loading.rois = true;\n      return a2PatternMatching.getRoisFor(this.id, params.limit, params.offset, params.opts).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = this.parseRoisResult(rois);\n        this.selected.roi = Math.min();\n        this.recalculateTotalItems();\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      console.info('play');\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 1;\n        this.rois = [];\n        return $q.resolve(this.rois);\n      } else {\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadData(page);\n        }\n      }\n\n      return $q.resolve();\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('validate pattern matchings')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        0: 0,\n        1: 0,\n        null: 0\n      };\n      var cls = {\n        species: this.patternMatching.species_name,\n        songtype: this.patternMatching.songtype_name\n      };\n      return a2PatternMatching.validateRois(this.id, roiIds, validation, cls).then(function () {\n        rois.forEach(function (roi) {\n          val_delta[roi.validated] -= 1;\n          val_delta[validation] += 1;\n          roi.validated = validation;\n          roi.selected = false;\n        });\n        this.patternMatching.absent += val_delta[0];\n        this.patternMatching.present += val_delta[1];\n      }.bind(this));\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n}).controller('DeletePatternMatchingInstanceCtrl', function ($scope, $modalInstance, a2PatternMatching, patternMatching) {\n  this.patternMatching = patternMatching;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2PatternMatching.delete(patternMatching.id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewPatternMatchingInstanceCtrl', function ($modalInstance, a2PatternMatching, a2Templates, a2Playlists, notify) {\n  var self = this;\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false,\n        templates: false,\n        createPatternMatching: false\n      };\n      this.data = {\n        name: null,\n        playlist: null,\n        template: null,\n        params: {\n          N: 1,\n          threshold: 0.3\n        }\n      };\n      this.list = {};\n      this.loading = {\n        templates: true,\n        playlists: true\n      };\n      this.isSaving = false;\n      this.warningMessage = 'Warning: Large playlist (500,000+ recordings). Save resources by reducing playlist size.';\n      this.getTemplates();\n      this.getPlaylists();\n    },\n    getTemplates: function () {\n      self.loading.templates = true;\n      return a2Templates.getList().then(function (templates) {\n        self.loading = false;\n        self.list.templates = templates.filter(function (t) {\n          return !t.disabled;\n        });\n      }.bind(this)).catch(function (err) {\n        self.loading = false;\n        self.list.templates = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    getPlaylists: function () {\n      self.loading.playlists = true;\n      return a2Playlists.getList().then(function (playlists) {\n        self.playlists = false;\n        self.list.playlists = playlists;\n      }.bind(this)).catch(function (err) {\n        self.playlists = false;\n        self.list.playlists = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    ok: function () {\n      if (self.data.playlist.count === 0) {\n        return notify.error('Note: The playlist should not be empty.');\n      }\n\n      self.isSaving = true;\n      return a2PatternMatching.create({\n        name: self.data.name,\n        playlist: self.data.playlist.id,\n        template: self.data.template.id,\n        params: self.data.params\n      }).then(function (patternMatching) {\n        self.isSaving = false;\n        $modalInstance.close({\n          ok: true,\n          patternMatching: patternMatching\n        });\n      }).catch(function (err) {\n        console.log('err', err);\n        self.isSaving = false;\n        notify.error(err);\n      });\n    },\n    isJobValid: function () {\n      return self.data && self.data.name && self.data.name.length > 3 && self.data.playlist && self.data.template;\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isWarningMessage: function () {\n      return this.data.playlist && this.data.playlist.count > 500000;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.analysis.random-forest-models', ['ui.router', 'a2.analysis.random-forest-models.models', 'a2.analysis.random-forest-models.classification']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models', {\n    url: '/random-forest-models',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.analysis.soundscapes', ['a2.services', 'a2.permissions', 'ui.bootstrap', 'ui-rangeSlider', 'ngCsv']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.soundscapes', {\n    url: '/soundscapes',\n    controller: 'SoundscapesCtrl as controller',\n    templateUrl: '/app/analysis/soundscapes/list.html'\n  });\n}).controller('SoundscapesCtrl', function ($window, $scope, $modal, $filter, Project, JobsData, ngTableParams, a2Playlists, $location, a2Soundscapes, notify, a2UserPermit) {\n  var $ = $window.$;\n  $scope.successInfo = \"\";\n  $scope.showSuccess = false;\n  $scope.errorInfo = \"\";\n  $scope.showError = false;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = true;\n  $scope.infopanedata = '';\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n    $scope.pid = data.project_id;\n    $scope.url = data.url;\n    $scope.isProjectDisabled = data.disabled === 1;\n  });\n  a2Playlists.getList().then(function (data) {\n    $scope.playlists = data;\n  });\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    $scope.tableParams = new ngTableParams({\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    }, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.soundscapesOriginal, params.filter()) : $scope.soundscapesOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.soundscapesOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No classifications found.\";\n        }\n\n        $scope.soundscapesData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Soundscapes.saveState({\n          'data': $scope.soundscapesOriginal,\n          'filtered': $scope.soundscapesData,\n          'f': params.filter(),\n          'o': params.orderBy(),\n          'p': params.page(),\n          'c': params.count(),\n          't': orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.loadSoundscapes = function () {\n    a2Soundscapes.getList2(function (data) {\n      $scope.soundscapesOriginal = data;\n      $scope.soundscapesData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+name\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No soundscapes found.\";\n      }\n    });\n  };\n\n  var stateData = a2Soundscapes.getState();\n\n  if (stateData === null) {\n    $scope.loadSoundscapes();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.soundscapesData = stateData.filtered;\n      $scope.soundscapesOriginal = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n\n  $scope.deleteSoundscape = function (id, name) {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to delete soundscapes');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/soundscapes/deletesoundscape.html',\n      controller: 'DeleteSoundscapeInstanceCtrl',\n      resolve: {\n        name: function () {\n          return name;\n        },\n        id: function () {\n          return id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.error) {\n        notify.error(\"Error: \" + ret.error);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.soundscapesOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].soundscape_id === id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.soundscapesOriginal.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Soundscape deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.createNewSoundscape = function () {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to create soundscapes');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/soundscapes/createnewsoundscape.html',\n      controller: 'CreateNewSoundscapeInstanceCtrl',\n      resolve: {\n        amplitudeReferences: function (a2Soundscapes) {\n          return a2Soundscapes.getAmplitudeReferences();\n        },\n        playlists: function () {\n          return $scope.playlists;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new soundscape is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      }\n\n      if (data.err) {\n        notify.error(data.err);\n      }\n\n      if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.showDetails = function (soundscapeId) {\n    a2Soundscapes.get(soundscapeId, function (soundscape) {\n      a2Playlists.getInfo(soundscape.playlist_id, function (plist) {\n        var modalInstance = $modal.open({\n          controller: 'SoundscapesDetailsCtrl as controller',\n          templateUrl: '/app/analysis/soundscapes/details.html',\n          resolve: {\n            soundscape: function () {\n              return soundscape;\n            },\n            playlist: function () {\n              return plist;\n            }\n          }\n        });\n      });\n    });\n  };\n\n  this.exportSoundscape = function (options) {\n    if (a2UserPermit.isSuper()) return this.getExportUrl(options);\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export soundscape data');\n    }\n\n    this.getExportUrl(options);\n  };\n\n  this.getExportUrl = function (options) {\n    a2Soundscapes.getExportUrl(options).then(function (export_url) {\n      var a = $('<a></a>').attr('target', '_blank').attr('href', export_url).appendTo('body');\n      $window.setTimeout(function () {\n        a[0].click();\n        a.remove();\n      }, 0);\n    });\n  };\n}).controller('DeleteSoundscapeInstanceCtrl', function ($scope, $modalInstance, a2Soundscapes, name, id, projectData) {\n  $scope.name = name;\n  $scope.id = id;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    a2Soundscapes.delete(id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewSoundscapeInstanceCtrl', function ($scope, $modalInstance, a2Soundscapes, $timeout, projectData, playlists) {\n  $scope.projectData = projectData;\n  $scope.playlists = playlists;\n  $scope.buttonEnableFlag = true;\n  $scope.datasubmit = {\n    name: '',\n    playlist: '',\n    aggregation: '',\n    threshold: 0,\n    thresholdReference: 'absolute',\n    bin: 86,\n    bandwidth: 0,\n    normalize: false\n  };\n  $scope.nameMsg = '';\n\n  $scope.aggregationValue = function (val) {\n    $scope.$apply(function () {\n      $scope.datasubmit.aggregation = val;\n    });\n  };\n\n  $scope.ok = function () {\n    var url = $scope.projectData.url;\n    $scope.nameMsg = '';\n    a2Soundscapes.create({\n      n: $scope.datasubmit.name,\n      p: $scope.datasubmit.playlist,\n      a: $scope.datasubmit.aggregation,\n      t: $scope.datasubmit.threshold,\n      tr: $scope.datasubmit.thresholdReference,\n      m: 22050,\n      b: $scope.datasubmit.bin,\n      f: $scope.datasubmit.bandwidth,\n      nv: $scope.datasubmit.normalize\n    }).success(function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    }).error(function (data) {\n      if (data.err) {\n        $modalInstance.close({\n          err: \"Error: \" + data.err\n        });\n      } else {\n        $modalInstance.close({\n          err: \"Error: Cannot create soundscape job\"\n        });\n      }\n    });\n  };\n\n  $scope.buttonEnable = function () {\n    return $scope.datasubmit.bin === 0 || typeof $scope.datasubmit.bin.length == 'string' || $scope.datasubmit.aggregation.length === 0 || typeof $scope.datasubmit.threshold.length == 'string' || typeof $scope.datasubmit.bandwidth.length == 'string' || $scope.datasubmit.name.length === 0 || typeof $scope.datasubmit.playlist == 'string';\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n}).directive('a2Aggregationtypeselector', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      \"selected\": \"=\"\n    },\n    templateUrl: '/app/analysis/soundscapes/aggregationtypetelector.html',\n    controller: function ($scope) {\n      $scope.aggregations = [{\n        name: 'Hour in Day',\n        scale: ['00:00', '01:00', '......', '22:00', '23:00'],\n        id: 'time_of_day'\n      }, {\n        name: 'Day in Week',\n        scale: ['Sun', 'Mon', '......', 'Fri', 'Sat'],\n        id: 'day_of_week'\n      }, {\n        name: 'Day in Month',\n        scale: ['1', '2', '......', '30', '31'],\n        id: 'day_of_month'\n      }, {\n        name: 'Month in Year',\n        scale: ['Jan', 'Feb', '......', 'Nov', 'Dec'],\n        id: 'month_in_year'\n      }, {\n        name: 'Day in Year',\n        scale: ['1', '2', '......', '365', '366'],\n        id: 'day_of_year'\n      }, {\n        name: 'Year',\n        scale: ['2010', '2011', '......', '2016', '2017'],\n        id: 'year'\n      }];\n      $scope.width = 200;\n      $scope.padding = 18;\n      $scope.height = 20;\n\n      $scope.select = function (aggr) {\n        $scope.selected = aggr.id;\n      };\n    }\n  };\n}).directive('a2DrawAggregation', function ($window) {\n  var d3 = $window.d3;\n  return {\n    restrict: 'E',\n    scope: {\n      \"aggregation\": \"=\"\n    },\n    link: function (scope, element, attrs) {\n      // console.log(scope.aggregation);\n      var draw = function (aggre) {\n        var width = 200;\n        var height = 20;\n        var padding = 18;\n        var svgContainer = d3.select(element[0]).append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n        var axisScale = d3.scale.linear().domain([0, 4]).range([padding, width - padding]);\n        var xAxis = d3.svg.axis().scale(axisScale).orient(\"bottom\").ticks(5).tickValues([0, 1, 2, 3, 4]).tickFormat(function (d) {\n          return aggre.scale[d];\n        });\n        var xAxisGroup = svgContainer.append(\"g\").attr(\"transform\", \"translate(0,1)\").attr(\"class\", \"aggregationaxis\").call(xAxis);\n      };\n\n      scope.$watch('aggregation', function (value) {\n        if (value) draw(value);\n      });\n    }\n  };\n}).directive('a2ThresholdSelector', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    scope: {\n      \"threshold\": \"=\",\n      \"thresholdReference\": \"=\",\n      \"bandwidth\": \"=\"\n    },\n    templateUrl: '/app/analysis/soundscapes/thresholdselector.html',\n    link: function ($scope) {\n      $scope.amplitudeReferences = [];\n      var afterGetAmplitudeReferences = a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n        $scope.amplitudeReferences = amplitudeReferences;\n      });\n\n      $scope.setAmplitudeReference = function (amplitudeReference) {\n        console.log(\"amplitudeReference\", amplitudeReference);\n        $scope.thresholdReference = amplitudeReference.value;\n      };\n\n      $scope.$watch('thresholdReference', function (thresholdReference) {\n        afterGetAmplitudeReferences.then(function () {\n          console.log(\"thresholdReference\", thresholdReference, $scope.amplitudeReferences);\n          $scope.amplitudeReference = $scope.amplitudeReferences.reduce(function (_, item) {\n            return _ || (item.value == thresholdReference ? item : null);\n          });\n        });\n      });\n      $scope.$watch('threshold', function (n, o) {\n        console.log('threshold', n, o);\n        $scope.thresholdInvPercent = (1 - $scope.threshold) * 100;\n      });\n      $scope.$watch('thresholdInvPercent', function (n, o) {\n        console.log('thresholdInvPercent', n, o);\n        var precision = 0.1;\n        $scope.threshold = Math.round((100 - $scope.thresholdInvPercent) / precision) / (100 / precision);\n      });\n    }\n  };\n}).directive('a2DrawPeakThreshold', function ($window) {\n  var d3 = $window.d3;\n  return {\n    restrict: 'E',\n    scope: {\n      \"threshold\": \"=\",\n      \"bandwidth\": \"=\"\n    },\n    link: function ($scope, element, attrs) {\n      var data = [0.7, 1.0, 0.1, 0.55, 0.1, 0.6, 0.9, 0.01, 0.15, 0.1, 0.4, 0.1];\n      var data_scale = 0.5;\n      var lineData = [];\n\n      for (var i = 0; i < data.length; i++) {\n        lineData.push({\n          x: i + 1,\n          y: data[i] * data_scale\n        });\n      }\n\n      var peaks = [{\n        x: 2.6,\n        y: 1.0 * data_scale,\n        d: 999999\n      }, {\n        x: 4.4,\n        y: 0.55 * data_scale,\n        d: 210\n      }, {\n        x: 7,\n        y: 0.9 * data_scale,\n        d: 520\n      }, {\n        x: 9,\n        y: 0.15 * data_scale,\n        d: 750\n      }, {\n        x: 11,\n        y: 0.4 * data_scale,\n        d: 950\n      }];\n      var WIDTH = 250,\n          HEIGHT = 70,\n          MARGINS = {\n        top: 10,\n        right: 10,\n        bottom: 10,\n        left: 24\n      };\n      var vis = d3.select(element[0]).append('svg').attr('width', WIDTH).attr('height', HEIGHT);\n      var xRange = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([d3.min(lineData, function (d) {\n        return d.x;\n      }), d3.max(lineData, function (d) {\n        return d.x;\n      })]);\n      var yRange = d3.scale.linear().domain([0, 1]).range([HEIGHT - MARGINS.top, MARGINS.bottom]);\n      var xAxis = d3.svg.axis().scale(xRange).ticks(0);\n      var yAxis = d3.svg.axis().scale(yRange).ticks(3).tickSize(3).orient('left').tickSubdivide(true);\n\n      var drawAmpThreshold = function (ampThresh) {\n        yval = 50 * (1 - ampThresh) + 10;\n        vis.selectAll(\"line.movingline\").remove();\n        $scope.line = vis.append('svg:line').attr(\"x1\", MARGINS.left).attr(\"y1\", yval).attr(\"x2\", WIDTH - MARGINS.right).attr(\"y2\", yval).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none').attr('class', 'movingline');\n        vis.selectAll(\"text.peakText\").remove();\n        var peaki = 1;\n\n        for (var i = 0; i < peaks.length; i++) {\n          if (peaks[i].y >= ampThresh && peaks[i].d >= $scope.bandwidth) {\n            $scope.peakText = vis.append(\"text\").attr(\"x\", WIDTH * (peaks[i].x / lineData.length)).attr(\"y\", 50 * (1 - peaks[i].y) + 10).attr('font-size', '11px').style(\"text-anchor\", \"middle\").attr('class', 'peakText').text(\"P\" + peaki);\n            peaki = peaki + 1;\n          }\n        }\n      };\n\n      $scope.$watch('threshold', function () {\n        if (!$scope.threshold) return;\n        drawAmpThreshold($scope.threshold);\n      });\n      $scope.$watch('bandwidth', function () {\n        // $scope.banwidthPerc = ($scope.bandwidth)/100;\n        // $scope.banwidthValue = Math.round(1000*$scope.banwidthPerc);\n        $scope.banwidthValue = $scope.bandwidth;\n        xval = Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11 + 190 * ($scope.bandwidth / 1000);\n        vis.selectAll(\"line.movingline1\").remove();\n        $scope.line = vis.append('svg:line').attr(\"x1\", xval).attr(\"y1\", 12).attr(\"x2\", xval).attr(\"y2\", 60).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none').attr('class', 'movingline1');\n        vis.selectAll(\"text.peakText\").remove();\n        var peaki = 1;\n\n        for (var i = 0; i < peaks.length; i++) {\n          if (peaks[i].y >= $scope.threshold && peaks[i].d > $scope.banwidthValue) {\n            $scope.peakText = vis.append(\"text\").attr(\"x\", WIDTH * (peaks[i].x / lineData.length)).attr(\"y\", 50 * (1 - peaks[i].y) + 10).attr('font-size', '11px').style(\"text-anchor\", \"middle\").attr('class', 'peakText').text(\"P\" + peaki);\n            peaki = peaki + 1;\n          }\n        } // $scope.onBandwidth($scope.banwidthValue);\n        // console.log($scope.banwidthValue);\n\n      });\n      vis.append('svg:g').attr('class', 'thresholdaxis').attr('transform', 'translate(0,' + (HEIGHT - MARGINS.bottom) + ')').call(xAxis);\n      vis.append('svg:g').attr('class', 'thresholdaxis').attr('transform', 'translate(' + MARGINS.left + ',0)').call(yAxis);\n      var lineFunc = d3.svg.line().x(function (d) {\n        return xRange(d.x);\n      }).y(function (d) {\n        return yRange(d.y);\n      }).interpolate('linear');\n      vis.append('svg:path').attr('d', lineFunc(lineData)).attr('stroke', 'blue').attr('stroke-width', 2).attr('fill', 'none');\n      $scope.line = vis.append('svg:line').attr(\"x1\", Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11).attr(\"y1\", 12).attr(\"x2\", Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11).attr(\"y2\", 60).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none');\n      vis.append(\"text\").attr(\"x\", WIDTH / 2).attr(\"y\", 68).attr('font-size', '9px').style(\"text-anchor\", \"middle\").text(\"Hz\");\n    }\n  };\n}).controller('SoundscapesDetailsCtrl', function ($scope, soundscape, playlist, a2Soundscapes, a2UserPermit) {\n  $scope.showDownload = a2UserPermit.can('manage soundscapes');\n\n  var data2xy = function (offset) {\n    offset = offset || 0;\n    return function (d, i) {\n      return {\n        x: i + offset,\n        y: d\n      };\n    };\n  };\n\n  $scope.soundscape = soundscape;\n  $scope.playlist = playlist;\n  $scope.chartOptions = {\n    lineColor: '#c42',\n    width: 400,\n    height: 400\n  };\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, _1) {\n      _[_1.value] = _1;\n      return _;\n    }, {});\n  }.bind(this));\n  a2Soundscapes.findIndices(soundscape.id, function (result) {\n    if (!result) return;\n    $scope.index = {\n      H: [],\n      ACI: [],\n      NP: []\n    };\n    $scope.indices = [];\n    $scope.indices.push({\n      time: \"TIME\",\n      ACI: \"ACI\",\n      NP: \"NP\"\n    });\n\n    for (var i = 0; i < result.H.length; i++) {\n      var t = i + soundscape.min_t;\n      $scope.indices.push({\n        time: t,\n        ACI: result.ACI[i],\n        NP: result.NP[i]\n      });\n      $scope.index.H.push({\n        x: t,\n        y: result.H[i]\n      });\n      $scope.index.ACI.push({\n        x: t,\n        y: result.ACI[i]\n      });\n      $scope.index.NP.push({\n        x: t,\n        y: result.NP[i]\n      });\n    }\n  });\n});","angular.module('a2.citizen-scientist.expert', ['ui.bootstrap', 'a2.srv.patternmatching', 'a2.srv.citizen-scientist', 'a2.srv.citizen-scientist-expert', 'a2.visualizer.audio-player', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.expert', {\n    url: '/expert/:patternMatchingId?',\n    controller: 'CitizenScientistExpertCtrl',\n    templateUrl: '/app/citizen-scientist/expert/list.html'\n  });\n}).controller('CitizenScientistExpertCtrl', function ($scope, $filter, Project, ngTableParams, a2Playlists, notify, $q, a2CitizenScientistService, a2CitizenScientistExpertService, a2PatternMatching, a2UserPermit, $state, $stateParams) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.patternmatchingsOriginal, params.filter()) : $scope.patternmatchingsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.patternmatchingsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No Pattern matchings searches found.\";\n        }\n\n        $scope.patternmatchingsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $state.go('citizen-scientist.expert', {\n      patternMatchingId: patternmatchingId ? patternmatchingId : undefined\n    });\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CitizenScientistExpertService.getPatternMatchings().then(function (data) {\n      $scope.patternmatchingsOriginal = data;\n      $scope.patternmatchingsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No pattern matchings found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2CitizenScientistExpertDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'CitizenScientistExpertDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/citizen-scientist/expert/details.html'\n  };\n}).filter('pmValidation', function () {\n  return function (validation, cp, cnp) {\n    if (validation == 1) {\n      return 'present';\n    } else if (validation == 0) {\n      return 'not present';\n    } else if (validation === null || validation === undefined) {\n      if (cp > 0 && cnp > 0) {\n        return 'conflicted';\n      } else {\n        return '---';\n      }\n    }\n  };\n}).controller('CitizenScientistExpertDetailsCtrl', function ($scope, a2PatternMatching, a2Templates, a2CitizenScientistExpertService, a2UserPermit, Project, a2AudioBarService, notify) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 0\n      };\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.loading = {\n        details: false,\n        rois: false\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.expertSearch = this.lists.search[0];\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    compositeValidation: function (roi) {\n      var expert_val = roi.expert_validated;\n      var consensus_val = roi.consensus_validated;\n      var cp = roi.cs_val_present;\n      var cnp = roi.cs_val_not_present;\n      return [expert_val, consensus_val, cp > 0 && cnp > 0 ? -1 : null].reduce(function (_, arg) {\n        return _ === null ? arg : _;\n      }, null);\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      search: [{\n        value: 'all',\n        text: 'All',\n        description: 'Show all matched rois.'\n      }, {\n        value: 'consensus',\n        text: 'Consensus',\n        description: 'Show only rois where there is a consensus.'\n      }, {\n        value: 'pending',\n        text: 'Pending',\n        description: 'Show only rois that have not reached a consensus yet.'\n      }, {\n        value: 'conflicted',\n        text: 'Conflicted',\n        description: 'Show only rois where there is a conflict.'\n      }, {\n        value: 'expert',\n        text: 'Expert',\n        description: 'Show only rois that have been decided by an expert.'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      }, {\n        value: 'not-validated',\n        text: 'Not Validated'\n      }],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2CitizenScientistExpertService.getPatternMatchingDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.setupExportUrl();\n        this.total = {\n          rois: patternMatching.matches,\n          pages: Math.ceil(patternMatching.matches / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    onExpertSearchChanged: function () {\n      this.selected.page = 0;\n      this.loadPage(0);\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2CitizenScientistExpertService.getCSExportUrl({\n        patternMatching: this.patternMatching.id\n      });\n    },\n    onScroll: function ($event, $controller) {\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadPage: function (pageNumber) {\n      this.loading.rois = true;\n      return a2CitizenScientistExpertService.getPatternMatchingRoisFor(this.id, this.limit, pageNumber * this.limit, {\n        search: this.expertSearch && this.expertSearch.value\n      }).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = rois.reduce(function (_, roi) {\n          var sitename = roi.site;\n          var recname = roi.recording;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n        this.selected.roi = Math.min();\n\n        if (this.scrollElement) {\n          this.scrollElement.scrollTo(0, 0);\n        }\n\n        return rois;\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 0;\n        this.rois = [];\n        return this.rois;\n      } else {\n        page = Math.max(0, Math.min(page, this.total.rois / this.limit | 0));\n\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadPage(page);\n        }\n      }\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.cs_validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('validate pattern matchings')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        conflict_unresolved: 0,\n        conflict_resolved: 0,\n        null: 0,\n        0: 0,\n        1: 0\n      };\n      return a2CitizenScientistExpertService.validatePatternMatchingRois(this.id, roiIds, validation).then(function () {\n        rois.forEach(function (roi) {\n          var oldtag, newtag;\n\n          if (roi.cs_val_present > 0 && roi.cs_val_not_present > 0) {\n            oldtag = roi.expert_validated !== null ? 'conflict_resolved' : 'conflict_unresolved';\n            newtag = validation !== null ? 'conflict_resolved' : 'conflict_unresolved';\n          }\n\n          val_delta[oldtag] -= 1;\n          val_delta[newtag] += 1;\n          val_delta[roi.expert_validated] -= 1;\n          val_delta[validation] += 1;\n          roi.expert_validated = validation;\n          roi.selected = false;\n        });\n        this.patternMatching.cs_conflict_resolved += val_delta.conflict_resolved;\n        this.patternMatching.cs_conflict_unresolved += val_delta.conflict_unresolved;\n        this.patternMatching.expert_consensus_absent += val_delta[0];\n        this.patternMatching.expert_consensus_present += val_delta[1];\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    nextMatch: function (step) {\n      return this.setRoi(this.selected.roi_index + (step || 1));\n    },\n    prevMatch: function (step) {\n      return this.setRoi(this.selected.roi_index - (step || 1));\n    },\n    nextPage: function (step) {\n      return this.setPage(this.selected.page + (step || 1));\n    },\n    prevPage: function (step) {\n      return this.setPage(this.selected.page - (step || 1));\n    },\n    next: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      this.nextPage(step);\n    },\n    prev: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      return this.next(-step);\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n});","angular.module('a2.citizen-scientist.admin', ['ui.router', 'a2.citizen-scientist.admin.classification-stats', 'a2.citizen-scientist.admin.user-stats', 'a2.citizen-scientist.admin.settings']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin', {\n    url: '/admin',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.citizen-scientist.my-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.my-stats', {\n    url: '/my-stats',\n    controller: 'A2CitizenScientistMyStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/my-stats/index.html'\n  });\n}).controller('A2CitizenScientistMyStatsCtrl', function ($scope, a2CitizenScientistService, $stateParams, $state, Users) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistService.getMyStats().then(function (data) {\n      this.loading = false;\n      var vars = ['validated', 'consensus', 'non_consensus', 'pending', 'reached_th'];\n      this.stats = data.stats.map(function (item, index) {\n        vars.forEach(function (_var) {\n          item['group_' + _var] = data.groupStats[index][_var];\n        });\n        return item;\n      });\n      this.overall = data.stats.reduce(function (_, item) {\n        vars.forEach(function (_var) {\n          _[_var] += item[_var];\n          _['group_' + _var] += item['group_' + _var];\n        });\n        return _;\n      }, vars.reduce(function (__, _var) {\n        __[_var] = 0;\n        __['group_' + _var] = 0;\n        return __;\n      }, {})); // compute overalls\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.citizen-scientist.patternmatching', ['ui.bootstrap', 'a2.srv.patternmatching', 'a2.srv.citizen-scientist', 'a2.visualizer.audio-player', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.patternmatching', {\n    url: '/patternmatching',\n    controller: 'CitizenScientistPatternMatchingCtrl',\n    templateUrl: '/app/citizen-scientist/patternmatching/list.html'\n  });\n  $stateProvider.state('citizen-scientist.patternmatching-details', {\n    url: '/patternmatching/:patternMatchingId?',\n    controller: 'CitizenScientistPatternMatchingCtrl',\n    templateUrl: '/app/citizen-scientist/patternmatching/list.html'\n  });\n}).controller('CitizenScientistPatternMatchingCtrl', function ($scope, $filter, Project, ngTableParams, a2Playlists, notify, $q, a2CitizenScientistService, a2PatternMatching, a2UserPermit, $state, $stateParams) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.patternmatchingsOriginal, params.filter()) : $scope.patternmatchingsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.patternmatchingsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No Pattern matchings searches found.\";\n        }\n\n        $scope.patternmatchingsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $scope.selectedPatternMatchingId = patternmatchingId;\n\n    if (!patternmatchingId) {\n      $state.go('citizen-scientist.patternmatching', {});\n    } else {\n      $state.go('citizen-scientist.patternmatching-details', {\n        patternMatchingId: patternmatchingId\n      });\n    }\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CitizenScientistService.getPatternMatchings().then(function (data) {\n      $scope.patternmatchingsOriginal = data;\n      $scope.patternmatchingsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No pattern matchings found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2CitizenScientistPatternMatchingDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'CitizenScientistPatternMatchingDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/citizen-scientist/patternmatching/details.html'\n  };\n}).controller('CitizenScientistPatternMatchingDetailsCtrl', function ($scope, a2PatternMatching, a2Templates, a2CitizenScientistService, a2UserPermit, Project, a2AudioBarService, notify) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 0\n      };\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.loading = {\n        details: false,\n        rois: false\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      } // {value:'not-validated', text:'Not Validated'},\n      ],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2CitizenScientistService.getPatternMatchingDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.setupExportUrl();\n        this.total = {\n          rois: patternMatching.cs_total,\n          pages: Math.ceil(patternMatching.cs_total / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2PatternMatching.getExportUrl({\n        patternMatching: this.patternMatching.id\n      });\n    },\n    onScroll: function ($event, $controller) {\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadPage: function (pageNumber) {\n      this.loading.rois = true;\n      return a2CitizenScientistService.getPatternMatchingRoisFor(this.id, this.limit, pageNumber * this.limit).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = rois.reduce(function (_, roi) {\n          var sitename = roi.site;\n          var recname = roi.recording;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n        this.selected.roi = Math.min();\n\n        if (this.scrollElement) {\n          this.scrollElement.scrollTo(0, 0);\n        }\n\n        return rois;\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 0;\n        this.rois = [];\n        return this.rois;\n      } else {\n        page = Math.max(0, Math.min(page, this.total.rois / this.limit | 0));\n\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadPage(page);\n        }\n      }\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.cs_validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('use citizen scientist interface')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        0: 0,\n        1: 0,\n        null: 0\n      };\n      rois.forEach(function (roi) {\n        val_delta[roi.cs_validated] -= 1;\n        val_delta[validation] += 1;\n        roi.cs_validated = validation;\n        roi.selected = false;\n      });\n      this.patternMatching.cs_absent += val_delta[0];\n      this.patternMatching.cs_present += val_delta[1];\n      return a2CitizenScientistService.validatePatternMatchingRois(this.id, roiIds, validation);\n    },\n    nextMatch: function (step) {\n      return this.setRoi(this.selected.roi_index + (step || 1));\n    },\n    prevMatch: function (step) {\n      return this.setRoi(this.selected.roi_index - (step || 1));\n    },\n    nextPage: function (step) {\n      return this.setPage(this.selected.page + (step || 1));\n    },\n    prevPage: function (step) {\n      return this.setPage(this.selected.page - (step || 1));\n    },\n    next: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      this.nextPage(step);\n    },\n    prev: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      return this.next(-step);\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n});","angular.module('a2.audiodata.playlists.playlist-arithmetic', []).directive('playlistArithmetic', function (a2Playlists) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/playlists/playlist-arithmetic.html',\n    scope: {\n      onExpressionSelected: '&'\n    },\n    controller: 'playlistArithmeticController as controller',\n    requires: '^PlaylistCtrl',\n    link: function (scope, element, attrs) {\n      var controller = scope.controller;\n      controller.initialize({\n        onSelected: function (expression) {\n          scope.onExpressionSelected({\n            expression: expression\n          });\n        }\n      });\n      scope.$on('$destroy', function () {\n        controller.$destroy();\n      });\n    }\n  };\n}).controller('playlistArithmeticController', function (a2Playlists, $interpolate) {\n  this.selected = {};\n  this.operations = [{\n    type: 'union',\n    text: 'Join playlist 1 and 2',\n    icon: 'a2-union',\n    nameTemplate: '{{playlist1}} joined with {{playlist2}}'\n  }, {\n    type: 'intersection',\n    text: 'Intersect playlist 1 and 2',\n    icon: 'a2-intersect',\n    nameTemplate: '{{playlist1}} intersected with {{playlist2}}'\n  }, {\n    type: 'subtraction',\n    text: 'Remove playlist 2 from playlist 1',\n    icon: 'a2-difference',\n    nameTemplate: '{{playlist1}} minus {{playlist2}}'\n  }];\n  var removeOnInvalidateHandler;\n\n  this.initialize = function (options) {\n    this.options = options || {};\n    removeOnInvalidateHandler = a2Playlists.$on('invalidate-list', function () {\n      this.reset();\n    }.bind(this));\n    this.reset();\n    this.updateNamePlaceholder();\n  };\n\n  this.reset = function () {\n    return a2Playlists.getList().then(function (playlists) {\n      this.playlists = playlists;\n    }.bind(this));\n  };\n\n  this.$destroy = function () {\n    removeOnInvalidateHandler();\n  };\n\n  this.updateNamePlaceholder = function () {\n    var nameTemplate = (this.selected.operation || {}).nameTemplate || 'Playlist 3';\n    var term1 = this.selected.term1 || {};\n    var term2 = this.selected.term2 || {};\n    this.namePlaceholder = $interpolate(nameTemplate)({\n      playlist1: term1.name || '(playlist 1)',\n      playlist2: term2.name || '(playlist 2)'\n    });\n  };\n\n  this.submit = function () {\n    var operation = this.selected.operation;\n    var term1 = this.selected.term1;\n    var term2 = this.selected.term2;\n    var name = this.selected.name || this.namePlaceholder;\n\n    if (operation && term1 && term2 && name) {\n      if (this.options.onSelected) {\n        this.options.onSelected({\n          operation: operation.type,\n          term1: term1.id,\n          term2: term2.id,\n          name: name\n        });\n      }\n    }\n  };\n});","angular.module('a2.audiodata.playlists', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.audiodata.playlists.playlist-arithmetic', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.playlists', {\n    url: '/playlists',\n    controller: 'PlaylistCtrl as controller',\n    templateUrl: '/app/audiodata/playlists/playlists.html'\n  });\n}).controller('PlaylistCtrl', function ($scope, a2Playlists, $modal, notify, a2UserPermit, $location) {\n  this.initialize = function () {\n    removeOnInvalidateHandler = a2Playlists.$on('invalidate-list', function () {\n      this.reset();\n    }.bind(this));\n    this.reset();\n  };\n\n  this.reset = function () {\n    $scope.loading = true;\n    a2Playlists.getList({\n      info: true\n    }).then(function (data) {\n      $scope.playlists = data;\n      $scope.loading = false;\n    });\n  };\n\n  this.operate = function (expression) {\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to combine playlists');\n      return;\n    }\n\n    return a2Playlists.combine(expression).then(function () {\n      notify.log('Playlist created');\n    }).catch(function (err) {\n      err = err || {};\n      notify.error(err.message || err.data || 'Server error');\n    });\n  };\n\n  this.edit = function () {\n    if (!$scope.checked.length || $scope.checked.length > 1) {\n      notify.log('Please select one playlist to edit');\n      return;\n    }\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to edit playlists');\n      return;\n    }\n\n    $scope.pname = $scope.checked[0].name;\n    const playlist_id = $scope.checked[0].id;\n    const modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/edit-playlist.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function (playlistName) {\n      a2Playlists.rename({\n        id: playlist_id,\n        name: playlistName\n      }, function (data) {\n        if (data.error) return console.log(data.error);\n      });\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.checked || !$scope.checked.length) return;\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to delete playlists');\n      return;\n    }\n\n    const playlists = $scope.checked.map(function (row) {\n      return '\"' + row.name + '\"';\n    });\n    const message = [\"You are about to delete the following playlists: \"];\n    const message2 = [\"Are you sure?\"];\n    $scope.popup = {\n      messages: message.concat(playlists, message2),\n      btnOk: \"Yes\",\n      btnCancel: \"No\"\n    };\n    const modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      const playlistIds = $scope.checked.map(function (pl) {\n        return pl.id;\n      });\n      $scope.loading = true;\n      a2Playlists.remove(playlistIds, function (data) {\n        if (data.error) return notify.error(data.error);\n        a2Playlists.getList().then(function (data) {\n          $scope.playlists = data;\n          $scope.loading = false;\n          notify.log((playlistIds.length > 1 ? 'Playlists ' : 'Playlist ') + 'deleted');\n        });\n      });\n    });\n  };\n\n  $scope.create = function (url) {\n    $location.path(url);\n  };\n\n  this.initialize();\n});","angular.module('a2.audiodata.templates', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.templates', 'a2.directive.audio-bar', 'a2.visualizer.audio-player', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.templates', {\n    url: '/templates',\n    controller: 'TemplatesCtrl as controller',\n    templateUrl: '/app/audiodata/templates/templates.html'\n  });\n}).controller('TemplatesCtrl', function ($scope, a2Templates, Project, $localStorage, a2UserPermit, notify, $modal, $window, a2AudioBarService) {\n  var self = this;\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = false;\n      this.isAdding = false;\n      this.templates = [];\n      this.currentTab = 'projectTemplates';\n      this.pagination = {\n        page: 1,\n        limit: 100,\n        offset: 0,\n        totalItems: 0,\n        totalPages: 0\n      };\n      this.projecturl = Project.getUrl();\n      this.search = {\n        q: ''\n      };\n      this.getList();\n      this.timeout;\n    },\n    goToSourceProject: function (projectId) {\n      if (!projectId) return;\n      Project.getProjectById(projectId, function (data) {\n        if (data) {\n          $window.location.pathname = \"/project/\" + data.url + \"/audiodata/templates\";\n        }\n      });\n    },\n    setCurrentPage: function () {\n      self.pagination.offset = self.pagination.page - 1;\n      this.getList();\n    },\n    getList: function () {\n      self.loading = true;\n      const opts = {\n        showRecordingUri: true,\n        q: self.search.q,\n        limit: self.pagination.limit,\n        offset: self.pagination.offset * self.pagination.limit\n      };\n      opts[self.currentTab] = true;\n      return a2Templates.getList(opts).then(function (data) {\n        self.loading = false;\n        self.templates = data.list;\n        self.pagination.totalItems = data.count;\n        self.pagination.totalPages = Math.ceil(self.pagination.totalItems / self.pagination.limit);\n      }.bind(this)).catch(function (err) {\n        self.loading = false;\n        self.templates = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    onSearchChanged: function () {\n      var _this = this;\n\n      clearTimeout(self.timeout);\n      self.timeout = setTimeout(function () {\n        if (self.search.q.trim().length > 0 && self.search.q.trim().length < 3) return;\n\n        _this.reloadPage();\n      }, 1000);\n    },\n    reloadPage: function () {\n      this.resetPagination();\n      this.getList();\n    },\n    getTemplateVisualizerUrl: function (template) {\n      const box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.project_url + \"/#/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    deleteTemplate: function (templateId) {\n      if (!a2UserPermit.can('manage templates')) {\n        notify.error('You do not have permission to delete templates');\n        return;\n      }\n\n      $scope.popup = {\n        title: 'Delete template',\n        messages: ['Are you sure you want to delete this template?'],\n        btnOk: 'Yes',\n        btnCancel: 'No'\n      };\n      var modalInstance = $modal.open({\n        templateUrl: '/common/templates/pop-up.html',\n        scope: $scope\n      });\n      modalInstance.result.then(function (confirmed) {\n        if (confirmed) {\n          return a2Templates.delete(templateId).then(function () {\n            self.getList();\n          });\n        }\n      });\n    },\n    toggleTab: function (access) {\n      self.currentTab = access;\n      this.reloadPage();\n    },\n    resetPagination: function () {\n      self.pagination = {\n        page: 1,\n        limit: 100,\n        offset: 0,\n        totalItems: 0,\n        totalPages: 0\n      };\n    },\n    addTemplate: function (template) {\n      self.isAdding = true;\n      a2Templates.add({\n        name: template.name,\n        recording: template.recording,\n        species: template.species,\n        songtype: template.songtype,\n        roi: {\n          x1: template.x1,\n          y1: template.y1,\n          x2: template.x2,\n          y2: template.y2\n        },\n        source_project_id: template.project\n      }).then(function (template) {\n        console.log('new template', template);\n        self.isAdding = false;\n        if (template.id === 0) notify.error('The template already exists in the project templates.');else if (template.error) notify.error('You do not have permission to manage templates');else notify.log('The template is added to the project.');\n      }).catch(function (err) {\n        console.log('err', err);\n        self.isAdding = false;\n        notify.error(err);\n      });\n    },\n    playTemplateAudio: function (template, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      ;\n      $localStorage.setItem('a2-audio-param-gain', JSON.stringify(2));\n      console.info('play');\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(template), true);\n    }\n  });\n  this.initialize();\n});","angular.module('a2.audiodata.uploads', ['ui.router', 'a2.audiodata.uploads.upload', 'a2.audiodata.uploads.processing']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads', {\n    url: '/uploads',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.audiodata.uploads.processing', ['a2.services', 'a2.srv.uploads', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads.processing', {\n    url: '/processing',\n    controller: 'A2AudioDataUploadsProcessingCtrl as controller',\n    templateUrl: '/app/audiodata/uploads/processing.html'\n  });\n}).controller('A2AudioDataUploadsProcessingCtrl', function ($scope, a2UploadsService) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2UploadsService.getProcessingList().then(function (data) {\n      this.loading = false;\n      this.list = data.list;\n      this.count = data.count;\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.audiodata.uploads.upload', ['a2.services', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'a2.srv.app-listings', 'a2.filter.caps', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads.upload', {\n    url: '/',\n    controller: 'A2AudioDataUploadsUploadCtrl as controller',\n    templateUrl: '/app/audiodata/uploads/upload.html'\n  });\n}).filter('prettyBytes', function () {\n  return function (bytes) {\n    var labels = ['B', 'kB', 'MB', 'GB'];\n    var newBytes;\n    var p;\n\n    for (p = 1; bytes / Math.pow(1024, p) > 1; p++) {\n      newBytes = bytes / Math.pow(1024, p);\n    }\n\n    newBytes = Math.round(newBytes * 100) / 100;\n    return String(newBytes) + ' ' + labels[p - 1];\n  };\n}).controller('A2AudioDataUploadsUploadCtrl', function ($scope, uploads, Project, AppListingsService, a2UserPermit, notify, $interval, a2UploadsService) {\n  $scope.verifyAndUpload = function () {\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error(\"You do not have permission to upload recordings\");\n      return;\n    }\n\n    var index = 0;\n    $scope.uploading = true;\n\n    var _verifyAndUpload = function () {\n      var item = $scope.uploader.queue[index];\n\n      if (item && item.file && !item.file.size) {\n        item.isError = true;\n        item.errorMsg = \"Error of the file size\";\n        return;\n      }\n\n      var next = function () {\n        index++;\n\n        _verifyAndUpload();\n      };\n\n      if (!item || !$scope.uploading) {\n        $scope.uploading = false;\n        return;\n      }\n\n      if (item.isSuccess) // file uploaded on current batch\n        return next();\n      Project.recExists($scope.info.site.id, item.file.name, function (exists) {\n        if (exists) {\n          console.log('duplicated');\n          item.isDuplicate = true;\n          return next();\n        }\n\n        item.url = '/uploads/audio?project=' + $scope.project.project_id + '&site=' + $scope.info.site.id + '&nameformat=' + $scope.info.format.name + '&timezone=' + $scope.info.timezone.format;\n        item.upload();\n        item.onSuccess = next;\n        item.onError = next;\n      });\n    };\n\n    _verifyAndUpload();\n  };\n\n  $scope.isCheckingStatus = false;\n\n  $scope.queueJobToCheckStatus = function () {\n    if ($scope.isCheckingStatus) return;\n    $scope.isCheckingStatus = true;\n    a2UploadsService.getProcessingList({\n      site: $scope.info.site.id\n    }).then(function (files) {\n      const uploadingFiles = $scope.getUploadingFiles();\n\n      if (!uploadingFiles.length) {\n        $scope.cancelTimer();\n        $scope.isCheckingStatus = false;\n        return;\n      }\n\n      const userFiles = uploadingFiles.map(function (fileObj) {\n        return fileObj.file.name;\n      });\n\n      if (files && files.length) {\n        const filesToCheck = files.filter(function (file) {\n          return userFiles.includes(file.name);\n        });\n        const items = filesToCheck.slice(0, 5).map(function (item) {\n          return {\n            uploadUrl: item.uploadUrl,\n            uploadId: item.id,\n            filename: item.name\n          };\n        });\n        a2UploadsService.checkStatus({\n          items: items\n        }).then(function (data) {\n          if (data) {\n            data.forEach(function (item) {\n              const userFile = uploadingFiles.find(function (fileObj) {\n                return fileObj.file.name === item.filename;\n              });\n\n              if (userFile && item.status === 'uploaded') {\n                $scope.makeSuccessItem(userFile);\n              }\n            });\n            $scope.isCheckingStatus = false;\n          }\n        });\n      }\n    });\n  };\n\n  $scope.getUploadingFiles = function () {\n    const uploadingFiles = $scope.uploader.queue.filter(function (file) {\n      return file.isSuccess === true && file.isUploaded === false;\n    });\n    return uploadingFiles && uploadingFiles.length ? uploadingFiles : [];\n  };\n\n  $scope.checkUploadingFiles = function () {\n    if ($scope.getUploadingFiles().length) {\n      $scope.startTimer();\n    }\n  };\n\n  $scope.startTimer = function () {\n    $scope.cancelTimer();\n    $scope.checkStatusInterval = $interval(function () {\n      $scope.queueJobToCheckStatus();\n    }, 10000);\n  };\n\n  $scope.cancelTimer = function () {\n    if ($scope.checkStatusInterval) {\n      $interval.cancel($scope.checkStatusInterval);\n    }\n  };\n\n  $scope.$on('$destroy', function () {\n    $scope.cancelTimer();\n  });\n  AppListingsService.getFor('arbimon2-desktop-uploader').then(function (uploaderAppListing) {\n    this.uploaderAppListing = uploaderAppListing;\n  }.bind(this));\n\n  $scope.stopQueue = function () {\n    $scope.uploading = false;\n    angular.forEach($scope.uploader.queue, function (item) {\n      item.cancel();\n    });\n  };\n\n  $scope.uploader = uploads.getUploader();\n  $scope.info = {};\n  $scope.formats = [{\n    name: \"Arbimon\",\n    format: \"(*-YYYY-MM-DD_HH-MM)\"\n  }, {\n    name: \"AudioMoth\",\n    format: \"(*YYYYMMDD_HHMMSS)\"\n  }, {\n    name: \"AudioMoth legacy\",\n    format: \"(Unix Time code in Hex)\"\n  }, {\n    name: \"Cornell\",\n    format: \"(*_YYYYMMDD_HHMMSSZ)\"\n  }, {\n    name: \"Song Meter\",\n    format: \"(*_YYYYMMDD_HHMMSS)\"\n  }, {\n    name: \"Wildlife\",\n    format: \"(YYYYMMDD_HHMMSS)\"\n  }];\n  $scope.fileTimezone = [{\n    name: \"UTC\",\n    format: \"utc\"\n  }, {\n    name: \"Site timezone\",\n    format: \"local\"\n  }];\n  Project.getSites({\n    utcDiff: true\n  }, function (sites) {\n    $scope.sites = sites.sort(function (a, b) {\n      return new Date(b.updated_at) - new Date(a.updated_at);\n    });\n  });\n\n  $scope.selectSite = function () {\n    const local = $scope.info && $scope.info.site && $scope.info.site.utcOffset ? $scope.info.site.utcOffset + ' (local)' : 'Site timezone';\n    $scope.fileTimezone[1].name = local;\n    $scope.info.timezone = $scope.fileTimezone[1];\n  };\n\n  $scope.isStartUploadDisabled = function () {\n    return !$scope.uploader.queue.length || $scope.isLimitExceeded() || !$scope.info.site || !$scope.info.format || $scope.uploading;\n  };\n\n  $scope.isLimitExceeded = function () {\n    return $scope.uploader.queue.length > 1000;\n  };\n\n  const randomString = Math.round(Math.random() * 100000000);\n  this.uploaderApps = {\n    mac: 'https://rf.cx/ingest-app-latest-mac?r=' + randomString,\n    windows: 'https://rf.cx/ingest-app-latest-win?r=' + randomString\n  };\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  $scope.uploader.filters.push({\n    name: 'supportedFormats',\n    fn: function (item) {\n      var name = item.name.split('.');\n      var extension = name[name.length - 1].toLowerCase();\n      var validFormats = /mp3|flac|wav|opus/i;\n      if (!validFormats.exec(extension)) return false;\n      return true;\n    }\n  });\n  $scope.uploader.filters.push({\n    name: 'notDuplicate',\n    fn: function (item) {\n      var duplicate = $scope.uploader.queue.filter(function (qItem) {\n        return qItem.file.name === item.name;\n      });\n      return !duplicate.length;\n    }\n  });\n\n  $scope.uploader.onErrorItem = function (item, response, status, headers) {\n    if (response.error) {\n      item.errorMsg = response.error;\n    } else if (status >= 500) {\n      item.errorMsg = \"Server error\";\n      return;\n    } else {\n      item.errorMsg = \"An error ocurred\";\n    }\n  };\n\n  $scope.uploader.onSuccessItem = function (item, response, status, headers) {\n    item.isUploaded = false;\n    console.info('count of uploading files', $scope.getUploadingFiles().length);\n    $scope.checkUploadingFiles();\n  };\n\n  $scope.makeSuccessItem = function (item) {\n    item.status = 'uploaded';\n    item.isUploading = false;\n    item.isSuccess = false;\n    item.isUploaded = true;\n    item.progress = 100;\n  };\n\n  $scope.getProgress = function (item) {\n    if (item.isUploading && item.progress === 100) return 90;else if (item.isSuccess && !item.isUploaded) return 90;else return item.progress;\n  };\n\n  $scope.removeCompleted = function () {\n    if (!$scope.uploader.queue.length) return;\n    $scope.uploader.queue = $scope.uploader.queue.filter(function (file) {\n      return !file.isSuccess;\n    });\n  };\n\n  $scope.getCountOfUploaded = function () {\n    if (!$scope.uploader || !$scope.uploader.queue || !$scope.uploader.queue.length) return 0;\n    $scope.uploaded = $scope.uploader.queue.filter(function (file) {\n      return !!file.isUploaded && !file.isError;\n    }).length;\n    return $scope.uploaded;\n  };\n\n  $scope.clearQueue = function () {\n    $scope.uploader.progress = 0;\n    $scope.uploaded = 0;\n  };\n\n  $scope.uploaded = 0;\n\n  $scope.uploader.onProgressAll = function () {};\n}).factory('uploads', function (FileUploader) {\n  var u = new FileUploader();\n  window.addEventListener(\"beforeunload\", function (e) {\n    if (u.isUploading) {\n      var confirmationMessage = \"Upload is in progress, Are you sure to exit?\";\n      (e || window.event).returnValue = confirmationMessage; //Gecko + IE\n\n      return confirmationMessage; //Webkit, Safari, Chrome etc.\n    }\n  });\n  return {\n    getUploader: function () {\n      return u;\n    }\n  };\n});","angular.module('a2.audiodata.recordings.data-export-parameters', ['a2.directive.a2-auto-close-on-outside-click', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane', 'a2.directive.error-message']).directive('recordingDataExportParameters', function ($document, $rootScope) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/recordings/export-parameters.html',\n    scope: {\n      onExport: '&'\n    },\n    controller: 'recordingDataExportParametersController as controller',\n    requires: '^RecsCtrl',\n    link: function (scope, element, attrs, controller) {\n      controller.initialize({\n        onExport: function (parameters) {\n          scope.onExport({\n            parameters: parameters\n          });\n        }\n      });\n    }\n  };\n}).service('recordingDataFieldTypes', function () {\n  return [{\n    title: 'Recording fields',\n    identifier: 'recording',\n    placeholder: 'filename, site, ...',\n    list: [{\n      value: 'filename',\n      caption: 'Filename',\n      tooltip: 'The recording filename'\n    }, {\n      value: 'site',\n      caption: 'Site',\n      tooltip: 'The recording site'\n    }, {\n      value: 'day',\n      caption: 'Day',\n      tooltip: 'The recording day'\n    }, {\n      value: 'hour',\n      caption: 'Hour',\n      tooltip: 'The recording hour'\n    }, {\n      value: 'url',\n      caption: 'Url',\n      tooltip: 'The recording URl'\n    }],\n    preselected: ['filename', 'site', 'day']\n  }, {\n    title: 'Validations by species/song type',\n    identifier: 'validation',\n    placeholder: 'Species - Sound...',\n    getList: function (Project) {\n      return Project.getClasses({\n        validations: true\n      }).then(function (classes) {\n        return classes.map(function (cls) {\n          return {\n            value: cls.id,\n            caption: cls.species_name + ' - ' + cls.songtype_name,\n            badges: [{\n              icon: 'val-1',\n              value: cls.vals_present\n            }, {\n              icon: 'val-0',\n              value: cls.vals_absent\n            }]\n          };\n        });\n      });\n    }\n  }, {\n    title: 'Soundscape Composition',\n    identifier: 'soundscapeComposition',\n    placeholder: 'Wind, Birds, ...',\n    getList: function (a2SoundscapeCompositionService) {\n      return a2SoundscapeCompositionService.getClassList({\n        isSystemClass: 1\n      }).then(function (classes) {\n        return classes.map(function (cls) {\n          return {\n            value: cls.id,\n            caption: cls.name,\n            group: cls.type\n          };\n        });\n      });\n    }\n  }, {\n    title: 'Tags',\n    identifier: 'tag',\n    placeholder: 'Tags...',\n    getList: function (a2Tags) {\n      return a2Tags.getForType('recording').then(function (tags) {\n        return tags.map(function (tag) {\n          return {\n            value: tag.tag_id,\n            caption: tag.tag,\n            icon: 'fa-tag',\n            badges: [{\n              value: tag.count\n            }]\n          };\n        });\n      }.bind(this));\n    }\n  }, {\n    title: 'Grouping of Detections',\n    identifier: 'grouped',\n    placeholder: 'Detections grouped by...',\n    list: [{\n      value: 'site',\n      caption: 'Site',\n      tooltip: 'Detections grouped by Site'\n    }, {\n      value: 'hour',\n      caption: 'Hour',\n      tooltip: 'Detections grouped by Hour'\n    }, {\n      value: 'date',\n      caption: 'Date',\n      tooltip: 'Detections grouped by Date'\n    }]\n  }, {\n    title: 'Occupancy Model Format',\n    identifier: 'species',\n    placeholder: 'Species...',\n    getList: function (Project) {\n      return Project.getClasses().then(function (classes) {\n        // Exclude classes with repeating species names\n        var cl = {};\n        classes.forEach(function (cls) {\n          const id = cls.species_name.split(' ').join('_');\n\n          if (!cl[id]) {\n            cl[id] = {\n              value: cls.species,\n              caption: cls.species_name,\n              name: id\n            };\n          }\n        });\n        return Object.values(cl);\n      });\n    }\n  }];\n}).controller('recordingDataExportParametersController', function ($q, $injector, notify, recordingDataFieldTypes, a2UserPermit) {\n  this.initialize = function (options) {\n    options = options || {};\n\n    if (options.onExport) {\n      this.onExport = options.onExport;\n    }\n\n    this.parameter_set_list = recordingDataFieldTypes;\n    this.selected = [];\n    this.lists = this.parameter_set_list.map(function () {\n      return [];\n    });\n\n    function getList(parameter_set) {\n      return $q.resolve(parameter_set.getList ? $injector.invoke(parameter_set.getList) : parameter_set.list || []);\n    }\n\n    $q.all(this.parameter_set_list.map(getList)).then(function (allLists) {\n      this.lists = allLists; // if (this.lists[1] && this.lists[1].length) {\n      //     this.lists[1].splice(0,0,{value: -1, caption: 'Select all species'});\n      // }\n\n      this.selected = this.parameter_set_list.map(function (parameter_set, idx) {\n        if (parameter_set.preselected) {\n          var listByValue = allLists[idx].reduce(function (_, item) {\n            _[item.value] = item;\n            return _;\n          }, {});\n          return (parameter_set.preselected || []).map(function (value) {\n            return listByValue[value];\n          }).filter(function (_) {\n            return !!_;\n          });\n        } else {\n          return [];\n        }\n      });\n    }.bind(this));\n  };\n\n  this.isSuper = a2UserPermit.isSuper();\n  this.isRfcxUser = a2UserPermit.isRfcx();\n  this.isRfcx = function () {\n    return this.isRfcxUser || this.isSuper;\n  }, this.checkSelectedValue = function (selected) {\n    return selected && selected.find(function (row) {\n      return row.value === -1;\n    });\n  };\n\n  this.onSelected = function (selectedItem) {\n    if (selectedItem && selectedItem.value === -1) {\n      this.selected[1] = [selectedItem];\n    }\n  };\n\n  this.resetFilters = function () {\n    this.selected = [];\n  };\n\n  this.isDisabled = function () {\n    return this.selected && this.selected[1] && this.selected[1].length && this.selected[1].length > 20;\n  };\n\n  this.isRecordingEmpty = function () {\n    return this.selected && this.selected[0] && this.selected[0].length === 0;\n  };\n\n  this.exportData = function () {\n    if (this.isRecordingEmpty()) {\n      notify.log('At least 1 recording field is required');\n      return;\n    }\n\n    var selected = this.selected; // if (selected[1] && selected[1].find(function(row){ return row.value === -1 })) {\n    //     selected[1] = this.lists[1].filter(function(item) { if (item.value !== -1) { return item } });\n    // }\n\n    this.onExport(this.parameter_set_list.reduce(function (_, parameter_set, index) {\n      if (selected[index] && selected[index].length) {\n        _[parameter_set.identifier] = selected[index].map(function (item) {\n          return item.value;\n        });\n      }\n\n      if (selected[index] && parameter_set.identifier === 'species' && selected[index].value) {\n        _[parameter_set.identifier] = selected[index].value;\n        _['species_name'] = selected[index].name;\n      }\n\n      if (selected[index] && parameter_set.identifier === 'grouped' && selected[index].value) {\n        _[parameter_set.identifier] = selected[index].value;\n        _['grouped'] = selected[index].value;\n      }\n\n      return _;\n    }, {}));\n  };\n\n  this.onExport = function (parameters) {\n    console.log(\"export parameters : \", parameters);\n  };\n});","angular.module('a2.audiodata.recordings.filter-parameters', ['a2.directive.a2-auto-close-on-outside-click', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).directive('recordingFilterParameters', function ($document, $rootScope) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/recordings/filter-parameters.html',\n    scope: {\n      isOpen: '=',\n      maxDate: '=',\n      minDate: '=',\n      recTotal: '=',\n      isLoading: '=',\n      onApplyFilters: '&'\n    },\n    controller: 'recordingFilterParametersController as controller',\n    requires: '^RecsCtrl',\n    link: function (scope, element, attrs) {\n      var controller = scope.controller;\n\n      scope.applyFilters = function () {\n        scope.onApplyFilters({\n          filters: controller.getFilters()\n        });\n      };\n\n      scope.resetFilters = function () {\n        controller.params = {};\n        scope.onApplyFilters({\n          filters: controller.getFilters()\n        });\n      };\n\n      controller.fetchOptions();\n    }\n  };\n}).controller('recordingFilterParametersController', function ($scope, Project, a2Classi, a2SoundscapeCompositionService, a2Playlists, $q, a2Tags, $window) {\n  var staticMonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map(function (mon, ind) {\n    return {\n      value: ind,\n      string: mon,\n      count: null\n    };\n  });\n  var staticDays = [];\n\n  for (var day = 1; day <= 31; day++) {\n    staticDays.push({\n      value: day,\n      count: null\n    });\n  }\n\n  var staticHours = [];\n\n  for (var hour = 0; hour < 24; hour++) {\n    staticHours.push({\n      value: hour,\n      string: (hour < 10 ? '0' : '') + hour + ':00',\n      count: null\n    });\n  }\n\n  function _1_get(attribute) {\n    return function (_1) {\n      return _1[attribute];\n    };\n  }\n\n  function _1_mapper(mapFn) {\n    return function (_1) {\n      return _1.length !== undefined && _1.map(mapFn);\n    };\n  }\n\n  var _1_get_value_mapper = _1_mapper(_1_get(\"value\"));\n\n  var _1_get_id_mapper = _1_mapper(_1_get(\"id\"));\n\n  var _1_get_tag_id_mapper = _1_mapper(_1_get(\"tag_id\"));\n\n  var _1_get_flags_mapper = _1_mapper(_1_get(\"flags\"));\n\n  var findObjectWith = function (arr, key, value) {\n    var result = arr.filter(function (obj) {\n      return obj[key] === value;\n    });\n    return result.length > 0 ? result[0] : null;\n  };\n\n  var classification_results = {\n    model_only: [{\n      caption: '<i class=\"fa a2-present\"></i> Present',\n      tooltip: 'Present',\n      flags: {\n        model: 1\n      },\n      equiv: {\n        model_th: [1, 3]\n      }\n    }, {\n      caption: '<i class=\"fa a2-absent\"></i> Absent',\n      tooltip: 'Absent',\n      flags: {\n        model: 0\n      },\n      equiv: {\n        model_th: [0, 2]\n      }\n    }],\n    model_th: [{\n      caption: 'Model: <i class=\"fa a2-present\"></i>, Th: <i class=\"fa a2-present\"></i>',\n      tooltip: 'Model: present, Theshold: present',\n      flags: {\n        model: 1,\n        th: 1\n      },\n      equiv: {\n        model_only: [1]\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-present\"></i>, Th: <i class=\"fa a2-absent\"></i>',\n      tooltip: 'Model: present, Theshold: absent',\n      flags: {\n        model: 1,\n        th: 0\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-absent\"></i>, Th: <i class=\"fa a2-present\"></i>',\n      tooltip: 'Model: absent, Theshold: present',\n      flags: {\n        model: 0,\n        th: 1\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-absent\"></i>, Th: <i class=\"fa a2-absent\"></i>',\n      tooltip: 'Model: absent, Theshold: absent',\n      flags: {\n        model: 0,\n        th: 0\n      },\n      equiv: {\n        model_only: [0]\n      }\n    }]\n  };\n  this.options = {\n    classes: [],\n    presence: ['present', 'absent'],\n    sites: [],\n    sites_ids: [],\n    playlists: [],\n    years: [],\n    months: [],\n    days: [],\n    hours: [],\n    tags: [],\n    classifications: [],\n    classification_results: classification_results.model_only,\n    soundscape_composition: [],\n    soundscape_composition_annotation: ['present', 'absent']\n  };\n  this.params = {};\n  this.loading = {\n    sites: false\n  };\n  var filterDefs = [{\n    name: \"range\",\n    map: function set_range_bounds(range) {\n      return range;\n    }\n  }, {\n    name: \"sites\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"sites_ids\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"hours\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"months\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"years\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"days\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"playlists\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"validations\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"tags\",\n    map: _1_get_tag_id_mapper\n  }, {\n    name: \"presence\"\n  }, {\n    name: \"classifications\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"classification_results\",\n    map: _1_get_flags_mapper\n  }, {\n    name: \"soundscape_composition\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"soundscape_composition_annotation\"\n  }];\n\n  this.getFilters = function () {\n    var filters = {};\n    var params = this.params;\n    filterDefs.forEach(function (filterDef) {\n      var param = params[filterDef.name];\n      var value = param && filterDef.map ? filterDef.map(param) : param;\n\n      if (value instanceof Array ? value.length : value) {\n        filters[filterDef.name] = value;\n      }\n\n      if (value && filterDef.name === 'sites') {\n        const vals = filterDefs[2].map(param);\n        filters['sites_ids'] = vals;\n      }\n    });\n    return filters;\n  };\n\n  this.getRecordingsStatsPerSite = function (sites, filters, options) {\n    var proms = sites.map(function (site) {\n      return Project.getRecordingAvailability('!q:' + site.id + '---[1:31]');\n    });\n    return $q.all(proms).then(function (data) {\n      return data.reduce(function (_, recAv) {\n        return angular.merge(_, recAv);\n      }, {});\n    }).then(function (data) {\n      // loading.sites = false\n      var lists = {\n        sites: [],\n        // sitesList\n        years: [],\n        // yearsList\n        months: [],\n        // monthsList\n        days: [],\n        // daysList\n        hours: [] // hoursList\n\n      };\n      var levelIds = Object.keys(lists);\n\n      var getFilterOptions = function (filters, obj, level) {\n        var count = 0;\n        const currentLevel = levelIds[level];\n\n        for (var child in obj) {\n          if (Object.keys(filters).length && filters[currentLevel] && filters[currentLevel].indexOf(child) === -1) {\n            // skip if filter is define and the value is not in it\n            continue;\n          }\n\n          var item = findObjectWith(lists[currentLevel], 'value', child);\n\n          if (!item) {\n            const siteObj = currentLevel == 'sites' ? sites.find(function (site) {\n              return site.name === child;\n            }) : {};\n            item = {\n              value: child,\n              count: 0\n            };\n\n            if (currentLevel == 'sites') {\n              item.id = siteObj.id;\n            }\n\n            lists[currentLevel].push(item);\n          }\n\n          var itemCount;\n\n          if (typeof obj[child] == 'number') {\n            itemCount = obj[child];\n          } else {\n            if (level === 0) count = 0;\n            itemCount = getFilterOptions(filters, obj[child], level + 1);\n          }\n\n          item.count += itemCount;\n          count += itemCount;\n        }\n\n        return count;\n      };\n\n      getFilterOptions(filters, data, 0);\n      options.sites = lists.sites;\n      options.years = lists.years;\n      options.months = lists.months.map(function (month) {\n        month.value = parseInt(month.value);\n        month.value--;\n        return {\n          value: month.value,\n          string: $window.moment().month(month.value).format('MMM'),\n          count: month.count\n        };\n      });\n      options.days = lists.days.map(function (day) {\n        day.value = parseInt(day.value);\n        return day;\n      });\n      options.hours = lists.hours.map(function (hour) {\n        hour.value = parseInt(hour.value);\n        return {\n          value: hour.value,\n          string: $window.moment().hour(hour.value).minute(0).format('HH:mm'),\n          count: hour.count\n        };\n      });\n\n      var sort = function (a, b) {\n        return a.value > b.value ? 1 : -1;\n      };\n\n      options.sites.sort(sort);\n      options.years.sort(sort);\n      options.months.sort(sort);\n      options.days.sort(sort);\n      options.hours.sort(sort);\n    });\n  };\n\n  this.setRecStatsStatic = function (sites, bounds, options) {\n    options.sites = sites.map(function (site) {\n      return {\n        value: site.name,\n        count: null,\n        id: site.id\n      };\n    });\n    var years = [];\n    var maxYear = (bounds.max ? new Date(bounds.max) : new Date()).getFullYear();\n    var minYear = bounds.min ? new Date(bounds.min).getFullYear() : '1990';\n\n    for (var year = maxYear; year >= minYear; year--) {\n      years.push({\n        value: year,\n        count: null\n      });\n    }\n\n    options.years = years;\n    options.months = staticMonths;\n    options.days = staticDays;\n    options.hours = staticHours;\n  };\n\n  this.fetchOptions = function (filters) {\n    var self = this;\n\n    if (filters === undefined) {\n      filters = {};\n    }\n\n    var options = this.options;\n    var loading = this.loading;\n    var sites;\n\n    if ($scope.recTotal === undefined || $scope.minDate === undefined || $scope.maxDate === undefined) {\n      // wait until all inputs are populated to make proper decision in a condition below\n      setTimeout(function () {\n        this.fetchOptions(filters);\n      }.bind(this), 1000);\n      return;\n    }\n\n    loading.sites = true;\n    Project.getSites().then(function (data) {\n      sites = data;\n\n      if (sites.length < 50 && $scope.recTotal < 100000) {\n        return self.getRecordingsStatsPerSite(sites, filters, options);\n      } else {\n        return self.setRecStatsStatic(sites, {\n          min: $scope.minDate.toISOString(),\n          max: $scope.maxDate.toISOString()\n        }, options);\n      }\n    }).finally(function () {\n      loading.sites = false;\n    });\n    Project.getClasses({\n      validations: true\n    }, function (classes) {\n      options.classes = classes;\n    });\n    a2Playlists.getList().then(function (playlists) {\n      options.playlists = playlists;\n    });\n    a2Tags.getForType('recording').then(function (tags) {\n      var tagsObj = {};\n      tags.forEach(function (t) {\n        var key = t.tag;\n\n        if (!tagsObj[key]) {\n          tagsObj[key] = {\n            tag: key,\n            tag_id: [t.tag_id],\n            count: t.count\n          };\n        } else {\n          tagsObj[key].tag_id.push(t.tag_id);\n          tagsObj[key].count++;\n        }\n      });\n      options.tags = Object.values(tagsObj);\n    }.bind(this));\n    a2Classi.list(function (classifications) {\n      options.classifications = classifications.map(function (c) {\n        c.name = c.cname;\n        c.id = c.job_id;\n        delete c.cname;\n        return c;\n      });\n    }.bind(this));\n    a2SoundscapeCompositionService.getClassList({\n      isSystemClass: 1\n    }).then(function (classes) {\n      options.soundscape_composition = classes;\n    }.bind(this));\n  };\n\n  this.computeClassificationResultsOptions = function (classifications) {\n    console.log(\"this.computeClassificationResults = function(classifications){\", classifications);\n    var haveThreshold = classifications && classifications.reduce(function (a, b) {\n      return a || !!b.threshold;\n    }, false);\n    var old_crs = this.options.classification_results;\n    var crs_key = haveThreshold ? 'model_th' : 'model_only';\n    var new_crs = classification_results[crs_key];\n    this.options.classification_results = new_crs;\n\n    if (old_crs != new_crs) {\n      this.params.classification_results = this.params.classification_results.reduce(function (r, cr) {\n        var equiv = cr.equiv && cr.equiv[crs_key];\n\n        if (equiv) {\n          equiv.forEach(function (i) {\n            var new_cr = new_crs[i];\n\n            if (!r.index[new_cr]) {\n              r.index[i] = 1;\n              r.list.push(new_cr);\n            }\n          });\n        }\n\n        return r;\n      }, {\n        list: [],\n        index: {}\n      }).list;\n    }\n  };\n});","angular.module('a2.audiodata.recordings', ['a2.directive.a2-auto-close-on-outside-click', 'a2.service.download-resource', 'a2.audiodata.recordings.data-export-parameters', 'a2.audiodata.recordings.filter-parameters', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.recordings', {\n    url: '/recordings',\n    controller: 'RecsCtrl as controller',\n    templateUrl: '/app/audiodata/recordings/recordings.html'\n  });\n}).controller('RecsCtrl', function ($scope, Project, a2Classi, $http, $modal, notify, a2UserPermit, $downloadResource) {\n  $scope.selectedRecId = [];\n  $scope.checkedRec = [];\n\n  this.getSearchParameters = function (output) {\n    var params = angular.merge({}, $scope.params);\n    output = output || ['list'];\n    params.output = output;\n    params.limit = $scope.limitPerPage;\n    params.offset = output.indexOf('list') >= 0 ? ($scope.currentPage - 1) * $scope.limitPerPage : 0;\n    params.sortBy = 'r.site_id DESC, r.datetime DESC';\n\n    if (params.range) {\n      params.range.from = moment(params.range.from).format('YYYY-MM-DD') + 'T00:00:00.000Z';\n      params.range.to = moment(params.range.to).format('YYYY-MM-DD') + 'T23:59:59.999Z';\n    }\n\n    return params;\n  };\n\n  this.searchRecs = function (output) {\n    $scope.loading = true;\n    output = output || ['list'];\n    var params = this.getSearchParameters(output);\n    var expect = output.reduce(function (obj, a) {\n      obj[a] = true;\n      return obj;\n    }, {});\n\n    if (expect.list) {\n      $scope.recs = [];\n    }\n\n    if (expect.count) {\n      $scope.totalRecs = undefined;\n    }\n\n    Project.getRecs(params, function (data) {\n      if (output.length == 1) {\n        data = output.reduce(function (obj, a) {\n          obj[a] = data;\n          return obj;\n        }, {});\n      }\n\n      if (expect.list) {\n        $scope.recs = data.list; // Show selected recordings across pagination\n\n        $scope.recs.forEach(function (rec) {\n          if ($scope.selectedRecId.includes(rec.id)) {\n            rec.checked = true;\n          }\n        });\n        $scope.loading = false;\n      }\n\n      if (expect.count) {\n        $scope.totalRecs = data.count;\n      }\n\n      if (expect.date_range && data.date_range.min_date && data.date_range.max_date) {\n        $scope.minDate = new Date(new Date(data.date_range.min_date.substr(0, 10) + \"T00:00:00.000Z\").getTime() - 24 * 60 * 60 * 1000);\n        $scope.maxDate = new Date(new Date(data.date_range.max_date.substr(0, 10) + \"T23:59:59.999Z\").getTime() + 24 * 60 * 60 * 1000);\n      }\n    });\n  };\n\n  this.sortRecs = function (sortKey, reverse) {\n    $scope.sortKey = sortKey;\n    $scope.reverse = reverse;\n    this.searchRecs();\n  };\n\n  this.applyFilters = function (filters) {\n    $scope.currentPage = 1;\n    $scope.params = filters;\n    this.searchRecs(['count', 'list']);\n  };\n\n  this.reloadList = function () {\n    this.searchRecs(['count', 'list']);\n  };\n\n  this.exportPermit = function () {\n    return a2UserPermit.can('manage project recordings');\n  };\n\n  this.createPlaylist = function () {\n    var listParams = angular.merge({}, $scope.params);\n\n    if (!Object.keys(listParams).length) {\n      notify.log('Filter recordings and create a playlist');\n      return;\n    }\n\n    if ($scope.totalRecs == 0) {\n      notify.error('You can\\'t create playlist with 0 recording');\n      return;\n    }\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to create playlists');\n      return;\n    }\n\n    if (listParams.tags && listParams.tags.length) {\n      listParams.tags = listParams.tags.flat();\n    }\n\n    if (listParams.presence && listParams.presence.length) {\n      listParams.presence = listParams.presence[0];\n    }\n\n    if (listParams.range) {\n      listParams.range.from = moment(listParams.range.from).format('YYYY-MM-DD') + 'T00:00:00.000Z';\n      listParams.range.to = moment(listParams.range.to).format('YYYY-MM-DD') + 'T23:59:59.999Z';\n    }\n\n    if ($scope.selectedRecId && $scope.selectedRecId.length) {\n      listParams.recIds = $scope.selectedRecId;\n    }\n\n    var modalInstance = $modal.open({\n      controller: 'SavePlaylistModalInstanceCtrl',\n      templateUrl: '/app/audiodata/create-playlist.html',\n      resolve: {\n        listParams: function () {\n          return listParams;\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function (data) {\n      if (data.message === 'Playlist created') {\n        notify.log(data.message);\n      }\n    });\n  };\n\n  this.isDisableDeleteRecs = function () {\n    return !$scope.checkedRec.length && !$scope.checked;\n  };\n\n  this.deleteRecordings = function () {\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error('You do not have permission to delete recordings');\n      return;\n    }\n\n    const recs = $scope.checkedRec.filter(function (rec) {\n      return !rec.imported;\n    });\n\n    if (!recs || !recs.length) {\n      return notify.log('There are not any recordings to delete');\n    }\n\n    const recCount = recs.reduce(function (_, rec) {\n      _[rec.site] = _[rec.site] + 1 || 1;\n      return _;\n    }, {});\n    const messages = [],\n          list = [];\n    messages.push('Are you sure you want to delete the following?');\n    Object.keys(recCount).forEach(function (site, index) {\n      const s = recCount[site] > 1 ? 's' : '';\n\n      if (index < 3) {\n        list.push(recCount[site] + ' recording' + s + ' from \"' + site + '\"');\n      }\n    });\n\n    if (Object.keys(recCount).length > 3) {\n      var count = 0;\n      Object.keys(recCount).forEach(function (site, index) {\n        if (index >= 3) {\n          count = count + recCount[site];\n        }\n      });\n      const msg = '& ' + count + ' recordings from ' + (Object.keys(recCount).length - 3) + ' other sites';\n      list.push(msg);\n    }\n\n    return $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = messages;\n        this.list = list;\n        this.note = 'Note: analysis results on these recordings will also be deleted';\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      return $http.post('/api/project/' + Project.getUrl() + '/recordings/delete', {\n        recs: recs\n      });\n    }).then(function (response) {\n      if (response.data.error) {\n        return notify.error(response.data.error);\n      }\n\n      this.searchRecs(['count', 'list']);\n      notify.log(response.data.msg);\n    }.bind(this));\n  };\n\n  this.deleteAllRecordings = function () {\n    var filters = $scope.params;\n\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error('You do not have permission to delete recordings');\n      return;\n    }\n\n    if (!$scope.recs.length) {\n      notify.error('Recordings not found');\n      return;\n    }\n\n    return Project.getRecCounts(filters).then(function (recCount) {\n      var messages = [],\n          importedCount = 0,\n          importedSites = [],\n          list = [];\n      messages.push('Are you sure you want to delete the following?');\n      recCount.forEach(function (entry, index) {\n        var s = entry.count > 1 ? 's' : '';\n\n        if (!entry.imported && index < 3) {\n          list.push(entry.count + ' recording' + s + ' from \"' + entry.site + '\"');\n        } else if (entry.imported) {\n          importedCount += entry.count;\n          importedSites.push('\"' + entry.site + '\"');\n        }\n      });\n\n      if (recCount.length > 3) {\n        var count = 0;\n        recCount.forEach(function (entry, index) {\n          if (index >= 3) {\n            count = count + entry.count;\n          }\n        });\n        const msg = '& ' + count + ' recordings from ' + (recCount.length - 3) + ' other sites';\n        list.push(msg);\n      }\n\n      if (importedCount) {\n        messages.push(\"(The filters matched \" + importedCount + \" recordings wich come from \" + importedSites.join(\", \") + \". You cannot delete these from your project, they can only be removed from their original project.)\");\n      }\n\n      return $modal.open({\n        templateUrl: '/common/templates/pop-up.html',\n        controller: function () {\n          this.messages = messages;\n          this.list = list;\n          this.note = 'Note: analysis results on these recordings will also be deleted';\n          this.btnOk = \"Delete\";\n          this.btnCancel = \"Cancel\";\n        },\n        controllerAs: 'popup'\n      }).result;\n    }).then(function () {\n      return $http.post('/api/project/' + Project.getUrl() + '/recordings/delete-matching', filters).error(function (error) {\n        return notify.error(error);\n      });\n    }).then(function (response) {\n      if (response.data.error) {\n        return notify.error(response.data.error);\n      }\n\n      this.searchRecs(['count', 'list']);\n      notify.log(response.data.msg);\n    }.bind(this));\n  };\n\n  $scope.params = {};\n  $scope.loading = true;\n  $scope.currentPage = 1;\n  $scope.limitPerPage = 10;\n  this.searchRecs(['count', 'date_range', 'list']);\n  $scope.$watch('checked', function () {\n    $scope.combineCheckedRecordings();\n  });\n\n  $scope.combineCheckedRecordings = function () {\n    $scope.recs.forEach(function (rec) {\n      if (rec.checked && !$scope.selectedRecId.includes(rec.id)) {\n        $scope.selectedRecId.push(rec.id);\n        $scope.checkedRec.push(rec);\n      }\n    });\n  };\n\n  $scope.selectRec = function (rec) {\n    if (!rec.checked) {\n      const index = $scope.selectedRecId.findIndex(function (id) {\n        return id === rec.id;\n      });\n      $scope.selectedRecId.splice(index, 1);\n      $scope.checkedRec.splice(index, 1);\n      return;\n    }\n\n    if ($scope.selectedRecId.includes(rec.id)) return;\n    $scope.selectedRecId.push(rec.id);\n    $scope.checkedRec.push(rec);\n  };\n\n  this.setCurrentPage = function (currentPage) {\n    $scope.currentPage = currentPage;\n    this.searchRecs();\n  };\n\n  this.setLimitPerPage = function (limitPerPage) {\n    $scope.limitPerPage = limitPerPage;\n    this.searchRecs();\n  };\n\n  this.exportRecordings = function (listParams) {\n    if (a2UserPermit.isSuper()) {\n      return this.openExportPopup(listParams);\n    }\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export data');\n    }\n\n    this.openExportPopup(listParams);\n  };\n\n  this.openExportPopup = function (listParams) {\n    $scope.params.userEmail = a2UserPermit.getUserEmail() || '';\n    const modalInstance = $modal.open({\n      controller: 'ExportRecordingstModalInstanceCtrl',\n      templateUrl: '/app/audiodata/export-report.html',\n      resolve: {\n        data: function () {\n          return {\n            params: $scope.params,\n            listParams: listParams\n          };\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function () {\n      notify.log('Your report export request is processing <br> and will be sent by email.');\n    });\n  };\n}).controller('SavePlaylistModalInstanceCtrl', function ($scope, $modalInstance, a2Playlists, listParams, notify) {\n  var result;\n\n  $scope.savePlaylist = function (name) {\n    $scope.isSavingPlaylist = true;\n    a2Playlists.create({\n      playlist_name: name,\n      params: listParams\n    }, function (data) {\n      $scope.isSavingPlaylist = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        result = data;\n        $modalInstance.close({\n          message: 'Playlist created'\n        });\n      }\n    });\n    var timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      $scope.isSavingPlaylist = false;\n      $modalInstance.close({\n        message: 'Playlist creating'\n      });\n\n      if (!$scope.errMess && !result) {\n        notify.log('Your playlist is being created. <br> Check it in the project playlists');\n      }\n    }, 60000);\n  };\n\n  $scope.changePlaylistName = function () {\n    $scope.errMess = null;\n  };\n}).controller('ExportRecordingstModalInstanceCtrl', function ($scope, $modalInstance, Project, data) {\n  $scope.userEmail = data.params.userEmail;\n\n  $scope.exportRecordings = function (email) {\n    data.params.userEmail = email;\n    $scope.isExportingRecs = true;\n    $scope.errMess = '';\n    Project.getRecordingData(data.params, data.listParams).then(function (data) {\n      $scope.isExportingRecs = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        $modalInstance.close();\n      }\n    });\n  };\n\n  $scope.changeUserEmail = function () {\n    $scope.errMess = null;\n  };\n}).directive(\"customSrc\", function () {\n  return {\n    link: function (scope, element, attrs) {\n      var img, loadImage;\n      img = null;\n\n      loadImage = function () {\n        element[0].src = '';\n        img = new Image();\n        img.src = attrs.customSrc;\n\n        img.onload = function () {\n          element[0].src = attrs.customSrc;\n        };\n\n        img.onerror = function () {\n          element[0].src = 'https://rfcx-web-static.s3.eu-west-1.amazonaws.com/arbimon/unavaliable.png';\n        };\n      };\n\n      scope.$watch(function () {\n        return attrs.customSrc;\n      }, function (newVal, oldVal) {\n        if (oldVal !== newVal) {\n          loadImage();\n        }\n      });\n    }\n  };\n});","angular.module('a2.visobjectsbrowser', ['a2.utils', 'a2.browser_common', 'a2.browser_recordings', 'a2.browser_soundscapes', 'a2.service.serialize-promised-fn'])\n/**\n * @ngdoc directive\n * @name a2visobjectsbrowser.directive:a2VisObjectBrowser\n * @description\n * vis object browser component.\n *\n * @event browser-available Emmited when the browser controller gets initialized\n * @event browser-vobject-type Emmited when the selected visualizer object type changes\n *\n */\n.directive('a2VisObjectBrowser', function ($window, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      location: '=?',\n      onVisObject: '&'\n    },\n    templateUrl: '/app/visualizer/browser/main.html',\n    // require: 'ngModel',\n    controller: 'a2VisObjectBrowserController as browser',\n    link: function (scope, element, attrs, browser) {\n      browser.waitForInitialized.then(function () {\n        scope.$emit('browser-available');\n      });\n      browser.events.on('location-changed', function () {\n        scope.location = this.location;\n      });\n      browser.events.on('browser-vobject-type', function (vobject_type) {\n        scope.$emit('browser-vobject-type', vobject_type);\n      });\n      browser.events.on('on-vis-object', function (location, visobject, type) {\n        scope.onVisObject({\n          location: location,\n          visobject: visobject,\n          type: type\n        });\n        $timeout(function () {\n          var $e = element.find('.visobj-list-item.active');\n\n          if ($e.length) {\n            var $p = $e.parent();\n            var $eo = $e.offset(),\n                $po = $p.offset(),\n                $dt = $eo.top - $po.top;\n            $p.animate({\n              scrollTop: $p.scrollTop() + $dt\n            });\n          }\n        });\n      });\n      scope.selectVisObject = browser.selectVisObject.bind(browser); // scope.$on('a2-persisted', browser.activate.bind(browser));\n\n      scope.$on('prev-visobject', browser.selectPreviousVisObject.bind(browser));\n      scope.$on('next-visobject', browser.selectNextVisObject.bind(browser));\n      scope.$on('set-browser-location', browser.setBrowserLocation.bind(browser)); // Catch the navigation URL query from visualizer view\n\n      scope.$on('set-browser-annotations', browser.setBrowserAnnotations.bind(browser));\n      scope.$on('clear-recording-data', browser.clearRecordingData.bind(browser));\n      scope.$on('visobj-updated', browser.notifyVisobjUpdated.bind(browser));\n      browser.activate(scope.location).catch(console.error.bind(console));\n    }\n  };\n})\n/**\n * @ngdoc controller\n * @name a2visobjectsbrowser.controller:a2VisObjectBrowserController\n * @description\n * Controller for vis object browser.\n *\n * @event browser-available Emmited when the browser controller gets initialized\n * @event browser-vobject-type Emmited when the selected visualizer object type changes\n *\n */\n.controller('a2VisObjectBrowserController', function ($scope, $state, $controller, $q, serializePromisedFn, BrowserLOVOs, BrowserVisObjects, itemSelection, Project, EventlistManager) {\n  var self = this;\n  var project = Project; // Set of available lovo types\n\n  this.types = BrowserLOVOs.$grouping;\n  this.visobjectTypes = BrowserVisObjects; // currently selected lovo type\n  // container for loading flags\n\n  this.loading = {\n    sites: false,\n    dates: false,\n    times: false\n  }; // container for auto-selecting values from the browser controllers\n\n  this.auto = {}; // currently selected visualizer object\n\n  this.visobj = null; // currently selected lovo\n\n  this.lovo = null; // associated EventlistManager\n\n  this.events = new EventlistManager(); // initialized flag\n\n  var initialized = false;\n  var waitForInitializedDefer = $q.defer();\n  this.waitForInitialized = waitForInitializedDefer.promise;\n  this.waitForInitialized.then(function () {\n    if (!this.type) {\n      this.setBrowserType(BrowserLOVOs.$list.filter(function (lovo) {\n        return lovo.default;\n      }).shift());\n    }\n  }.bind(this));\n  /** (Re)-Activates the browser controller.\n   * Sets the browser controller into an active state. On the first time,\n   * the browse gets initialized and sends a 'browser-available' event\n   * asynchronously. This activation cascades into the currently selected\n   * type.\n   *\n   * @event browser-available Emmited when the browser controller gets initialized\n   *\n   */\n\n  this.activate = function (location) {\n    var $type = this.$type;\n    return ($type && $type.activate ? $type.activate().then(function () {\n      if ($scope.browser.currentRecording && $scope.browser.annotations) {\n        return this.setLOVO();\n      }\n\n      if ($type.lovo) return this.setLOVO($type.lovo);\n    }.bind(this)) : $q.resolve()).then(function () {\n      if (!initialized) {\n        initialized = true;\n        waitForInitializedDefer.resolve();\n      }\n    }.bind(this));\n  };\n\n  this.setLOVO = function (lovo, location) {\n    var defer = $q.defer();\n    var old_lovo = self.lovo;\n    self.lovo = lovo;\n    if (self.lovo) self.lovo.loading = true;\n    return $q.resolve().then(function () {\n      if (lovo) {\n        self.lovo.loading = false;\n\n        if (lovo.recordingsBySite) {\n          lovo.updateRecording($scope.browser.currentRecording ? $scope.browser.currentRecording : undefined);\n        }\n\n        lovo.initialize().then(function () {\n          if (location) {\n            self.set_location(location);\n          }\n        }).then(function () {\n          // to set selected recording from the list of recordings\n          if (lovo.recordingsBySite && lovo.list && lovo.recording_id) {\n            self.auto.visobject = lovo.list.find(function (item) {\n              return item.id === self.auto.visobject.id;\n            });\n          }\n\n          if (self.auto.visobject) {\n            return lovo.find(self.auto.visobject).then(function (visobject) {\n              return self.setVisObj(visobject);\n            });\n          }\n        }).then(function () {\n          return $q.resolve(lovo);\n        });\n      }\n    });\n  };\n\n  this.set_location = function (location) {\n    this.location = location;\n    this.events.send({\n      event: 'location-changed',\n      context: this\n    }, location);\n  };\n\n  this.setBrowserType = serializePromisedFn(function (type) {\n    var new_$type,\n        old_$type = self.$type;\n\n    if (type && type.controller) {\n      if (!type.$controller) {\n        type.$controller = $controller(type.controller, {\n          $scope: $scope,\n          a2Browser: self\n        });\n      }\n\n      new_$type = type.$controller;\n    }\n\n    var differ = new_$type !== old_$type;\n    return (differ ? $q.resolve().then(function () {\n      if (differ && old_$type && old_$type.deactivate) {\n        return old_$type.deactivate();\n      }\n    }).then(function () {\n      if (differ && new_$type && new_$type.activate) {\n        self.type = type;\n        self.$type = new_$type;\n        return self.activate();\n      }\n    }) : $q.resolve()).then(function () {\n      self.events.send({\n        'event': 'browser-vobject-type',\n        context: self\n      }, type.vobject_type);\n    });\n  });\n\n  this.setVisObj = function (newValue) {\n    this.visobj = newValue;\n    var location = newValue && self.$type.get_location(newValue);\n    this.cachedLocation = location;\n    this.events.send({\n      event: 'on-vis-object',\n      context: this\n    }, location, newValue, self.lovo ? self.lovo.object_type : null);\n  };\n\n  this.selectVisObject = function (visobject) {\n    console.log(\"this.selectVisObject :: \", visobject);\n    return visobject ? $q.resolve().then(function () {\n      return self.lovo && self.lovo.find(visobject);\n    }).then(function (vobj) {\n      return vobj || visobject;\n    }).then(function (vobj) {\n      self.auto = {\n        visobject: vobj\n      };\n\n      if (self.$type.auto_select) {\n        return self.$type.auto_select(visobject);\n      } else {\n        return self.setVisObj(visobject);\n      }\n    }) : $q.resolve();\n  };\n\n  this.selectPreviousVisObject = function () {\n    // console.log(\"this.selectPreviousVisObject = function(){\");\n    if (self.visobj && self.lovo) {\n      self.lovo.previous(self.visobj.id).then(this.selectVisObject.bind(this));\n    }\n  };\n\n  this.selectNextVisObject = function () {\n    console.log(\"this.selectNextVisObject = function(){\");\n\n    if (self.visobj && self.lovo) {\n      self.lovo.next(self.visobj.id).then(this.selectVisObject.bind(this));\n    }\n  }; // Parse the navigation URL query\n\n\n  this.setBrowserAnnotations = function (evt, recording, query) {\n    this.annotations = query;\n    this.currentRecording = recording;\n  };\n\n  this.clearRecordingData = function (evt, data) {\n    this.currentRecording = null;\n  };\n\n  this.setBrowserLocation = function (evt, location) {\n    var m = /([\\w-+]+)(\\/(.+))?/.exec(location);\n\n    if (this.cachedLocation == location) {\n      return $q.resolve();\n    }\n\n    this.cachedLocation = location;\n\n    if (m && BrowserLOVOs[m[1]]) {\n      var loc = m[3];\n      var lovos_def = BrowserLOVOs[m[1]];\n      this.setBrowserType(lovos_def).then(function () {\n        return lovos_def.$controller.resolve_location(loc);\n      }).then(function (visobject) {\n        if (visobject) {\n          return self.selectVisObject(visobject);\n        }\n      });\n    }\n  };\n\n  this.notifyVisobjUpdated = function (evt, visobject) {\n    if (self.lovo && self.lovo.update) {\n      self.lovo.update(visobject);\n    }\n  };\n});","angular.module('a2.browser_common', []).provider('BrowserVisObjects', function () {\n  var visobjects = {};\n  return {\n    add: function (visobject) {\n      visobjects[visobject.type] = angular.extend(visobjects[visobject.type] || {}, visobject);\n    },\n    $get: function () {\n      return visobjects;\n    }\n  };\n}).provider('BrowserLOVOs', function () {\n  var lovos = {\n    $grouping: [],\n    $list: []\n  };\n  return {\n    add: function (lovo) {\n      lovos.$list.push(lovo);\n    },\n    $get: function () {\n      lovos.$grouping = lovos.$list.reduce(function (_, lovodef) {\n        var group = lovodef.group || '';\n\n        if (!_.$index[group]) {\n          _.groups.push(_.$index[group] = []);\n        }\n\n        _.$index[group].push(lovos[lovodef.name] = lovodef);\n\n        return _;\n      }, {\n        groups: [],\n        $index: {}\n      }).groups;\n      return lovos;\n    }\n  };\n}).service('a2ArrayLOVO', function ($q) {\n  var lovo = function (list, object_type) {\n    this.offset = 0;\n    this.setArray(list, object_type);\n  };\n\n  lovo.prototype = {\n    initialize: function () {\n      var d = $q.defer();\n      d.resolve(true);\n      return d.promise;\n    },\n    setArray: function (list, object_type) {\n      this.list = list || [];\n      this.count = this.list.length;\n      this.object_type = object_type;\n    },\n    find: function (soundscape) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      d.resolve(this.list.filter(function (r) {\n        return r.id == id;\n      }).shift());\n      return d.promise;\n    },\n    previous: function (soundscape) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      var index = 0;\n\n      for (var l = this.list, i = 0, e = l.length; i < e; ++i) {\n        if (s.id == id) {\n          index = Math.min(Math.max(0, i - 1, this.list.length - 1));\n          break;\n        }\n      }\n\n      d.resolve(this.list[index]);\n      return d.promise;\n    },\n    next: function (recording) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      var index = 0;\n\n      for (var l = this.list, i = 0, e = l.length; i < e; ++i) {\n        if (s.id == id) {\n          index = Math.min(Math.max(0, i + 1, this.list.length - 1));\n          break;\n        }\n      }\n\n      d.resolve(this.list[index]);\n      return d.promise;\n    }\n  };\n  return lovo;\n});","/**\n * @ngdoc overview\n * @name dialog\n * @description\n * Visualizer dialog window module.\n */\nangular.module('a2.visualizer.dialog', []).directive('a2VisualizerDialog', function () {\n  return {\n    restrict: 'E',\n    transclude: true,\n    templateUrl: '/app/visualizer/dialog/dialog.html',\n    scope: {\n      show: '=',\n      x1: '=',\n      y1: '=',\n      x2: '=',\n      y2: '='\n    },\n    controller: 'a2VisualizerDialogCtrl'\n  };\n}).controller('a2VisualizerDialogCtrl', function ($scope) {\n  $scope.layout = $scope.$parent.layout;\n\n  $scope.getXSide = function (x1, x2) {\n    var px = Math.max(0, Math.min($scope.layout.sec2x(x2, 1) / $scope.layout.spectrogram.width, 1));\n    return px > .5 ? 'left' : 'right';\n  };\n\n  $scope.getXCoord = function (x1, x2) {\n    return $scope.getXSide(x1, x2) == 'left' ? x1 : x2;\n  };\n\n  $scope.getTransform = function (x1, x2, y1, y2) {\n    var tx = $scope.getXSide(x1, x2) == 'left' ? '-100%' : '0';\n    var ty = $scope.getYTranslation((y1 + y2) / 2, true);\n    return 'translate(' + tx + ', ' + ty + ')';\n  };\n\n  $scope.getYTranslation = function (y, asrelativeoffset) {\n    var py = Math.max(0.1, Math.min($scope.layout.hz2y(y, 1) / $scope.layout.spectrogram.height, .9));\n\n    if (asrelativeoffset) {\n      py = -py;\n    }\n\n    return (100 * py | 0) + '%';\n  };\n});","angular.module('a2.visualizer.layers.recording-tags', ['a2.srv.tags']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.recording-tags.object:recording-tags-layer\n   * @description Recording tags layer.\n   * adds the recording-tags-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-tags-layer\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingTagsLayerController as controller',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n})\n/**\n * @ngdoc controller\n * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController\n * @description Controller for recording tags layer in visualizer.\n * Gets injected an instance of VisualizerCtrl representing the visualizer control.\n * Responds to VisualizerCtrl.event::visobject by loading the visobject tags, if it is a\n * recording.\n */\n.controller('a2VisualizerRecordingTagsLayerController', function (VisualizerCtrl, a2Tags, a2LookaheadHelper, a22PointBBoxEditor, $q, $debounce) {\n  function makeTagsIndex(tags) {\n    return tags.reduce(function (idx, tag) {\n      if (tag.id) {\n        idx[tag.id] = true;\n      }\n\n      return idx;\n    }, {});\n  }\n\n  function groupByBbox(tags) {\n    var bboxes = [];\n    tags.reduce(function (bboxIdx, tag) {\n      if (tag.f0) {\n        var bbox = [tag.t0, tag.f0, tag.t1, tag.f1];\n        var bbox_key = bbox.join(',');\n\n        if (!bboxIdx[bbox_key]) {\n          bboxes.push(bboxIdx[bbox_key] = {\n            bbox: tag,\n            tags: []\n          });\n        }\n\n        bboxIdx[bbox_key].tags.push(tag);\n      }\n\n      return bboxIdx;\n    }, {});\n    return bboxes;\n  }\n\n  var lookaheadHelper = new a2LookaheadHelper({\n    fn: a2Tags.search,\n    minLength: 3,\n    includeSearch: true,\n    searchPromote: function (text) {\n      return {\n        tag: text\n      };\n    },\n    searchCompare: function (text, tag) {\n      return tag.tag == text;\n    }\n  });\n  this.tags = [];\n  this.spectrogramTags = [];\n  this.tagsIndex = {};\n  this.bboxTags = [];\n  this.bboxTagsIndex = {};\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#setVisobject\n   * @description Sets the visobject that will be the focus of this controller.\n   * Causes tags associated to it to be loaded.\n   * @param {visobject} visobject - visobject to set on the controller.\n   * @return Promise resolved with tags of given visobject. If the visobject is\n   * not a recording, then the promise resolves to an empty array.\n   */\n\n  this.setVisobject = function (visobject) {\n    this.visobject = visobject;\n    return this.loadTags();\n  };\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#loadTags\n   * @description Loads the tags for a given visobject and returns them in a promise.\n   * @param {visobject} visobject - visobject for wich to load the tags. Must be a recording visobject.\n   * @return Promise resolved with tags of given visobject. If the visobject is\n   * not a recording, then the promise resolves to an empty array.\n   */\n\n\n  this.loadTags = function () {\n    var visobject = this.visobject;\n\n    if (!visobject || !/^recording$/.test(visobject.type)) {\n      this.tags = [];\n      return $q.resolve(this.tags);\n    }\n\n    this.loading = true;\n    this.visobject = visobject;\n    return a2Tags.getFor(visobject).then(function (tags) {\n      this.tagsIndex = makeTagsIndex(tags);\n      this.spectrogramTags = groupByBbox(tags);\n      this.tags = tags;\n      return tags;\n    }.bind(this)).finally(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#searchedTags\n   * @description Array of tags returned by the last tag search.\n   */\n\n\n  this.searchedTags = [];\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#searchTags\n   * @description Searched for tags using the given text.\n   * @param {String} text - text to match in the tags search.\n   * @return Promise resolved with the searched tags. Also, searched tags are set in searchedTags.\n   */\n\n  this.searchTags = function (text) {\n    if (text === '' || !text) {\n      this.getProjectTags();\n    }\n\n    return lookaheadHelper.search(text).then(function (tags) {\n      this.searchedTags = tags;\n    }.bind(this));\n  };\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#onTagListChanged\n   * @description Called whenever the list of tags needs to be checked for changes.\n   * @return Promise resolved whenever the list of tags has been checked entirely.\n   */\n\n\n  this.onTagListChanged = $debounce(function () {\n    var tagUpdate = this.determineTagUpdate(this.tags, this.tagsIndex);\n    return this.updateTags(tagUpdate);\n  }, 100);\n  this.onBBoxTagListChanged = $debounce(function () {\n    var tagUpdate = this.determineTagUpdate(this.bboxTags);\n    this.bboxTags = [];\n    var bbox = this.bbox.bbox;\n    tagUpdate.add.forEach(function (tag) {\n      tag.t0 = bbox.x1;\n      tag.f0 = bbox.y1;\n      tag.t1 = bbox.x2;\n      tag.f1 = bbox.y2;\n    });\n    return this.updateTags(tagUpdate).then;\n  });\n\n  this.getProjectTags = function () {\n    return a2Tags.getForType('recording').then(function (tags) {\n      this.searchedTags = tags;\n    }.bind(this));\n  };\n\n  this.getProjectTags();\n\n  this.determineTagUpdate = function (tags, oldTagsIndex) {\n    var tagsIndex = makeTagsIndex(tags);\n    var toDelete = Object.keys(oldTagsIndex || {}).filter(function (tagId) {\n      return !tagsIndex[tagId];\n    });\n    var toAdd = tags.filter(function (tag) {\n      return !tag.id;\n    });\n    return {\n      add: toAdd,\n      delete: toDelete\n    };\n  };\n\n  this.updateTags = function (tagUpdate) {\n    var visobject = this.visobject;\n    console.log(\"visobject : \", visobject);\n    console.log(\"tag update : \", tagUpdate);\n    return $q.all([$q.all(tagUpdate.delete.map(function (tagId) {\n      return a2Tags.deleteFor(visobject, tagId);\n    })), $q.all(tagUpdate.add.map(function (tag) {\n      return a2Tags.addFor(visobject, tag);\n    }))]).then(function (updateResponse) {\n      return this.loadTags();\n    }.bind(this)).catch(function () {\n      // TODO:: notify user of failure... maybe should be done through a notification service...\n      return this.loadTags();\n    }.bind(this));\n  };\n\n  this.bbox = angular.extend(new a22PointBBoxEditor(), {\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    resetBboxTags: function () {\n      console.log(\"resetBboxTags\", this.bboxTags);\n      this.bboxTags = [];\n    }.bind(this),\n    reset: function () {\n      this.resetBboxTags();\n      this.super.reset.call(this);\n    }\n  });\n  VisualizerCtrl.on('visobject', this.setVisobject.bind(this));\n}).directive('a2Tag', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      tag: '='\n    },\n    template: '<span class=\"fa fa-tag no-text-wrap\">' + '{{tag.tag}}' + '</span>'\n  };\n});","angular.module('a2.visualizer.layers.soundscape-composition-tool', ['a2.srv.soundscape-composition', 'arbimon2.directive.validation-dropdown']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.soundscape-composition-tool.object:soundscape-composition-tool\n   * @description Recording tags layer.\n   * adds the soundscape-composition-tool layer_type to layer_types. This layer uses\n   * a2.visualizer.layer.soundscape-composition-tool.controller:a2VisualizerSoundscapeCompositionToolController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-composition-tool\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeCompositionToolController as controller',\n    display: {\n      spectrogram: false\n    },\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n})\n/**\n * @ngdoc controller\n * @name a2.visualizer.layer.soundscape-composition-tool.controller:a2VisualizerSoundscapeCompositionToolController\n * @description Controller for recording tags layer in visualizer.\n * Gets injected an instance of VisualizerCtrl representing the visualizer control.\n * Responds to VisualizerCtrl.event::visobject by loading the visobject tags, if it is a\n * recording.\n */\n.controller('a2VisualizerSoundscapeCompositionToolController', function ($q, VisualizerCtrl, a2UserPermit, notify, a2SoundscapeCompositionService) {\n  this.initialize = function () {\n    VisualizerCtrl.on('visobject', this.setVisobject.bind(this));\n    a2SoundscapeCompositionService.getClassList({\n      groupByType: true,\n      isSystemClass: 1\n    }).then(function (classesByType) {\n      this.classTypes = classesByType;\n      this.classesByType = classesByType.reduce(function (_, type) {\n        _[type.type] = type;\n        return _;\n      }, {});\n    }.bind(this));\n    this.annotations = {};\n    this.annotationToolbar = [[{\n      value: 1,\n      caption: \"Annotate as Present\"\n    }, {\n      value: 0,\n      caption: \"Annotate as Absent\"\n    }], [{\n      value: 2,\n      caption: \"Clear Annotation\"\n    }]];\n  };\n\n  this.annotate = function (val, classId) {\n    if (!a2UserPermit.can('validate species')) {\n      notify.error('You do not have permission to add soundscape composition annotations.');\n      return;\n    }\n\n    var keys = [classId];\n\n    if (keys.length > 0) {\n      a2SoundscapeCompositionService.annotate(this.visobject, {\n        'class': keys.join(','),\n        val: val\n      }).then(function (annotations) {\n        this.is_selected = {};\n        annotations.forEach(function (annotation) {\n          if (annotation.present == 2) {\n            delete this.annotations[annotation.scclassId];\n          } else {\n            this.annotations[annotation.scclassId] = annotation.present;\n          }\n        }.bind(this));\n      }.bind(this));\n    }\n  };\n\n  this.setVisobject = function (visobject) {\n    this.visobject = visobject;\n    return this.loadAnnotations();\n  };\n\n  this.loadAnnotations = function () {\n    var visobject = this.visobject;\n\n    if (!visobject || !/^recording$/.test(visobject.type)) {\n      this.annotations = {};\n      return $q.resolve(this.annotations);\n    }\n\n    this.loading = true;\n    this.visobject = visobject;\n    return a2SoundscapeCompositionService.getAnnotationsFor(visobject).then(function (annotations) {\n      this.annotations = annotations;\n      return annotations;\n    }.bind(this)).finally(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.initialize();\n});","angular.module('a2.visualizer.layers.templates', ['visualizer-services', 'a2.utils']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.templates.object:templates\n   * @description Templates layer.\n   * adds the templates layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.templates.controller:a2VisualizerTemplateLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"templates\",\n    title: \"\",\n    controller: 'a2VisualizerTemplateLayerController as templates',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerTemplateLayerController', function ($scope, $modal, $controller, $state, $timeout, a2Templates, a2UserPermit, a22PointBBoxEditor, Project, notify) {\n  var self = this;\n  self.selected = null;\n  self.templates = [];\n  self.recordingTemplates = [];\n  self.citizenScientistUser = a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper();\n  Project.getClasses(function (project_classes) {\n    self.project_classes = project_classes;\n  });\n  var getTemplatesPromise = a2Templates.getList({\n    projectTemplates: true\n  }).then(function (templates) {\n    self.templates = templates;\n    return templates;\n  });\n\n  self.updateState = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n    getTemplatesPromise.then(function () {\n      self.recordingTemplates = self.templates.filter(function (template) {\n        return template.recording == rec;\n      });\n    });\n    self.editor.reset();\n    self.editor.recording = rec;\n  };\n\n  self.goToSpeciesPage = function () {\n    $state.go('audiodata.species', {});\n  };\n\n  self.editor = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.roi = null;\n    },\n    make_new_bbox: function () {\n      this.super.make_new_bbox.call(this);\n      this.roi = this.bbox;\n    },\n    make_new_roi: function () {\n      this.make_new_bbox();\n    },\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      console.log('add_point : function(', point, ', ', min_eps, '){');\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    get_placeholder_name: function () {\n      return this.project_class ? this.project_class.species_name + ' ' + this.project_class.songtype_name : 'Template Name';\n    },\n    submit: function () {\n      if (!a2UserPermit.can('manage templates')) {\n        notify.error('You do not have permission to add a template');\n        return;\n      }\n\n      if (!this.project_class.songtype_name && !this.project_class.species_name) {\n        return;\n      }\n\n      this.submitting = true;\n      a2Templates.add({\n        name: this.template_name || this.project_class.species_name + \" \" + this.project_class.songtype_name,\n        recording: this.recording,\n        species: this.project_class.species,\n        songtype: this.project_class.songtype,\n        roi: this.roi\n      }).then(function (new_template) {\n        console.log('new_template', new_template);\n        this.submitting = false;\n        if (new_template.id === 0) return notify.error('The template with that name already exists for this record.');\n        $timeout(function () {\n          this.reset();\n          self.templates.push(new_template);\n          self.updateState();\n        }.bind(this));\n      }.bind(this));\n    }\n  });\n  $scope.$watch('visobject', self.updateState);\n}) // .controller('a2VisualizerAddTemplateModalController', function($scope, $modalInstance, Project, a2Templates){\n//     $scope.data = {\n//         name : '',\n//         type : null\n//     };\n//\n//     $scope.loadingClasses = true;\n//\n//     Project.getClasses(function(project_classes){\n//         $scope.project_classes = project_classes;\n//         $scope.loadingClasses = false;\n//     });\n//\n//     $scope.loadingTypes = true;\n//\n//     a2Templates.getTypes(function(template_types){\n//         $scope.template_types = template_types;\n//         if(template_types && template_types.length == 1) {\n//             $scope.data.type = template_types[0];\n//             $scope.loadingTypes = false;\n//         }\n//     });\n//\n//     $scope.ok = function(){\n//         $scope.creating = true;\n//         $scope.validation = {\n//             count:0\n//         };\n//\n//         var template_data = {};\n//\n//         if($scope.data.name){\n//             template_data.name = $scope.data.name;\n//         }\n//         else {\n//             $scope.validation.name = \"Training set name is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         if($scope.data.type && $scope.data.type.id){\n//             template_data.type = $scope.data.type.identifier;\n//         }\n//         else {\n//             $scope.validation.type = \"Training set type is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         if($scope.data.class) {\n//             template_data.class = $scope.data.class.id;\n//         }\n//         else {\n//             $scope.validation.class = \"Species sound is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         // $scope.form_data=template_data;\n//\n//         if($scope.validation.count ===  0) {\n//             a2Templates.add(template_data, function(new_template) {\n//                 if(new_template.error) {\n//\n//                     var field = new_template.field || 'error';\n//\n//                     $scope.validation[field] = new_template.error;\n//\n//                     return;\n//                 }\n//                 $modalInstance.close(new_template);\n//             });\n//         }\n//         else {\n//             $scope.creating = false;\n//         }\n//     };\n// })\n;","angular.module('a2.visobjects.audio-event-detection', ['a2.services', 'a2.visobjects.common', 'a2.service.plotly-plot-maker']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'audio-event-detection',\n    $loader: ['VisualizerObjectAudioEventDetectionTypeLoader', function (VisualizerObjectAudioEventDetectionTypeLoader) {\n      return VisualizerObjectAudioEventDetectionTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectAudioEventDetectionTypeLoader', function ($q, AudioEventDetectionService, plotlyPlotMaker, a2UrlUpdate) {\n  var aggregates;\n  var statisticsInfo;\n  var getParameters = $q.resolve().then(function () {\n    return $q.all([AudioEventDetectionService.getDataAggregatesList().then(function (_aggregates) {\n      aggregates = _aggregates;\n    }), AudioEventDetectionService.getDataStatisticsList().then(function (_statistics) {\n      statisticsInfo = _statistics.reduce(function (_, $) {\n        return _[$.statistic] = $, _;\n      }, {});\n    })]);\n  });\n\n  var AudioEventDetection = function (data) {\n    this.update(data).then(function () {\n      return getParameters;\n    }.bind(this)).then(function () {\n      return this.selectData({\n        x: statisticsInfo.tod,\n        y: statisticsInfo.y_max,\n        z: aggregates.reduce(function (_, $) {\n          return $.statistic == 'count' ? $ : _;\n        }, null)\n      });\n    }.bind(this));\n  };\n\n  AudioEventDetection.fetch = function (visobject) {\n    var d = $q.defer();\n    visobject = new AudioEventDetection(visobject);\n    d.resolve(visobject);\n    return d.promise;\n  };\n\n  AudioEventDetection.load = function (visobject, $scope) {\n    return AudioEventDetection.fetch(visobject);\n  };\n\n  AudioEventDetection.getCaptionFor = function (visobject) {\n    return visobject.name;\n  };\n\n  AudioEventDetection.prototype = {\n    type: \"audio-event-detection\",\n    layout: 'plotted',\n    zoomable: false,\n    update: function (data) {\n      console.log(\"AED data : \", data);\n\n      for (var i in data) {\n        this[i] = data[i];\n      }\n\n      this.plot = {\n        layout: {\n          title: data.name\n        },\n        data: []\n      };\n\n      if (data.statistics.indexOf('todsec') == -1) {\n        data.statistics.push('todsec', 'todsecspan', 'freqspan');\n      }\n\n      return getParameters.then(function () {\n        var statistics = data.statistics.reduce(function (_, $) {\n          return statisticsInfo[$] && _.push(statisticsInfo[$]), _;\n        }, []);\n        this.data_selection = {\n          x: statistics,\n          y: statistics,\n          z: aggregates,\n          current: {\n            x: statisticsInfo.tod,\n            y: statisticsInfo.y_max,\n            z: aggregates.reduce(function (_, $) {\n              return $.statistic == 'count' ? $ : _;\n            }, null)\n          }\n        };\n      }.bind(this));\n    },\n    selectData: function (selection) {\n      this.data_selection.current = angular.extend({}, this.data_selection.current, selection);\n      var x = this.data_selection.current.x,\n          y = this.data_selection.current.y,\n          z = this.data_selection.current.z;\n      console.log(\"this.data_selection.current\", this.data_selection.current);\n      return AudioEventDetectionService.getDataFor(this.id, x, y, z).then(function (data) {\n        var plot = x == y ? plotlyPlotMaker.makeBarPlot(x, z, data, this.name) : plotlyPlotMaker.makeHeatmapPlot(x, y, z, data, this.name);\n        this.plot.data = [plot.data];\n        this.plot.layout = plot.layout;\n      }.bind(this));\n    },\n    savePlot: function () {\n      var x = this.data_selection.current.x,\n          y = this.data_selection.current.y,\n          z = this.data_selection.current.z;\n      return AudioEventDetectionService.savePlotFor(this.id, x, y, z).then(function (data) {\n        a2UrlUpdate.update(data.url);\n      });\n    },\n    getCaption: function () {\n      return AudioEventDetection.getCaptionFor(this);\n    }\n  };\n  return AudioEventDetection;\n});","angular.module('a2.visobjects.common', []).provider('VisualizerObjectTypes', function () {\n  var types = {};\n  var defers = {};\n  return {\n    add: function (typeDef) {\n      types[typeDef.type] = angular.extend(types[typeDef.type] || {}, typeDef);\n    },\n    $get: function ($injector) {\n      return {\n        types: types,\n        getLoader: function (type) {\n          if (!types[type]) {\n            throw new Error(\"Visualizer Object Type '\" + type + \"' not found\");\n          }\n\n          return $injector.invoke(types[type].$loader);\n        }\n      };\n    }\n  };\n});","angular.module('a2.visobjects.recording', ['a2.services', 'a2.visobjects.common']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'recording',\n    $loader: ['VisualizerObjectRecordingTypeLoader', function (VisualizerObjectRecordingTypeLoader) {\n      return VisualizerObjectRecordingTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectRecordingTypeLoader', function ($q, Project, $localStorage) {\n  var khz_format = function (v) {\n    return v / 1000 | 0;\n  };\n\n  var getSelectedFrequencyCache = function () {\n    try {\n      return JSON.parse($localStorage.getItem('visuilizer.frequencies.cache')) || {\n        originalScale: true\n      };\n    } catch (e) {\n      return {\n        originalScale: true\n      };\n    }\n  };\n\n  var scaleCache = getSelectedFrequencyCache();\n\n  var recording = function (data, extra) {\n    for (var i in data) {\n      this[i] = data[i];\n    }\n\n    this.sampling_rate = this.sample_rate;\n    this.extra = extra;\n    this.max_freq = this.sampling_rate / 2;\n    this.span = scaleCache && scaleCache.originalScale ? this.max_freq : this.max_freq > 24000 ? this.max_freq : 24000;\n\n    if (!data) {\n      this.span = 44100 / 2;\n      this.duration = 60;\n    }\n\n    this.domain = {\n      x: {\n        from: 0,\n        to: this.duration,\n        span: this.duration,\n        unit: 'Time ( s )',\n        ticks: 60\n      },\n      y: {\n        from: 0,\n        to: this.span,\n        span: this.span,\n        unit: 'Frequency ( kHz )',\n        tick_format: khz_format\n      }\n    };\n\n    if (!this.tiles) {\n      this.isDisabled = true;\n      return;\n    } // set it to the scope\n\n\n    this.tiles.set.forEach(function (tile) {\n      if (!!data.legacy) {\n        tile.src = \"/api/project/\" + Project.getUrl() + \"/recordings/tiles/\" + this.id + \"/\" + tile.i + \"/\" + tile.j;\n      } else {\n        var streamId = data.uri.split('/')[3];\n        const datetime = data.datetime_utc ? data.datetime_utc : data.datetime;\n        var start = new Date(new Date(datetime).valueOf() + Math.round(tile.s * 1000)).toISOString();\n        var end = new Date(new Date(datetime).valueOf() + Math.round((tile.s + tile.ds) * 1000)).toISOString();\n        tile.src = '/api/ingest/recordings/' + streamId + '_t' + start.replace(/-|:|\\./g, '') + '.' + end.replace(/-|:|\\./g, '') + '_z95_wdolph_g1_fspec_mtrue_d1023.255.png';\n      }\n    }.bind(this));\n  };\n\n  recording.layers = [];\n\n  recording.fetch = function (visobject) {\n    var d = $q.defer();\n    Project.getRecordingInfo(visobject.id, function (data) {\n      if (data === 'Server error') {\n        visobject.isDisabled = true;\n        data = {};\n      }\n\n      visobject = new recording(data, visobject.extra);\n      d.resolve(visobject);\n    });\n    return d.promise;\n  };\n\n  recording.load = function (visobject, $scope) {\n    return recording.fetch(visobject).then(function (visobject) {\n      if (visobject.audioUrl) {\n        $scope.audio_player.load(visobject.audioUrl);\n      }\n\n      return visobject;\n    });\n  };\n\n  recording.getCaptionFor = function (visobject) {\n    return visobject.file;\n  };\n\n  recording.prototype = {\n    type: \"recording\",\n    zoomable: true,\n    getCaption: function () {\n      return recording.getCaptionFor(this);\n    }\n  };\n  return recording;\n});","angular.module('a2.visobjects.soundscape', ['a2.services', 'a2.visobjects.common']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'soundscape',\n    $loader: ['VisualizerObjectSoundscapeTypeLoader', function (VisualizerObjectSoundscapeTypeLoader) {\n      return VisualizerObjectSoundscapeTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectSoundscapeTypeLoader', function ($q, Project) {\n  var khz_format = function (v) {\n    return v / 1000 | 0;\n  };\n\n  var khz_unit_fmt = function (v) {\n    return Math.floor(v / 10.0) / 100.0 + \" kHz\";\n  };\n\n  var aggregations = {\n    'time_of_day': {\n      time_unit: 'Time (Hour in Day)',\n      unit_fmt: function (v) {\n        return (v | 0) + \":00\";\n      }\n    },\n    'day_of_month': {\n      time_unit: 'Time (Day in Month)',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'day_of_year': {\n      time_unit: 'Time (Day in Year )',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'month_in_year': {\n      time_unit: 'Time (Month in Year)',\n      unit_fmt: function (v) {\n        return moment().localeData()._months[(v | 0) - 1];\n      }\n    },\n    'day_of_week': {\n      time_unit: 'Time (Weekday) ',\n      unit_fmt: function (v) {\n        return moment().localeData()._weekdays[(v | 0) - 1];\n      }\n    },\n    'year': {\n      time_unit: 'Time (Year) ',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'unknown': {\n      time_unit: 'Time',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    }\n  };\n\n  var soundscape = function (data) {\n    this.update(data);\n  };\n\n  soundscape.fetch = function (visobject) {\n    var d = $q.defer();\n    visobject = new soundscape(visobject);\n    d.resolve(visobject);\n    return d.promise;\n  };\n\n  soundscape.load = function (visobject, $scope) {\n    return soundscape.fetch(visobject);\n  };\n\n  soundscape.getCaptionFor = function (visobject) {\n    var agg = {\n      'time_of_day': 'Time of day',\n      'day_of_month': 'Day of Month',\n      'day_of_year': 'Day of Year',\n      'month_in_year': 'Month in year',\n      'day_of_week': 'Day of week',\n      'year': 'Year '\n    };\n    return visobject.name + \" (\" + agg[visobject.aggregation] + \")\";\n  };\n\n  soundscape.prototype = {\n    type: \"soundscape\",\n    zoomable: true,\n    update: function (data) {\n      for (var i in data) {\n        this[i] = data[i];\n      }\n\n      var t0 = this.min_t,\n          t1 = this.max_t;\n      var f0 = this.min_f,\n          f1 = this.max_f;\n      var v0 = this.min_value,\n          v1 = this.visual_max_value || this.max_value;\n\n      if (this.normalized) {\n        v0 = 0;\n        v1 = 100;\n      }\n\n      var dt = t1 - t0 + 1,\n          df = f1 - f0,\n          dv = v1 - v0;\n      var aggregation = aggregations[this.aggregation] || aggregations.unknown;\n      var time_unit = aggregation.time_unit; // setup the domains\n\n      this.domain = {\n        x: {\n          // from : t0, to : t1 + 1, span : dt + 1, ticks : dt + 1,\n          from: t0,\n          to: t1,\n          span: dt,\n          ticks: dt,\n          ordinal: true,\n          unit_interval: 1,\n          unit_format: aggregation.unit_fmt,\n          unit: time_unit || 'Time ( s )'\n        },\n        y: {\n          from: f0,\n          to: f1,\n          span: df,\n          unit: 'Frequency ( kHz )',\n          unit_interval: this.bin_size,\n          unit_format: khz_unit_fmt,\n          tick_format: khz_format\n        },\n        legend: {\n          from: v0,\n          to: v1,\n          span: dv,\n          ticks: Math.max(2, Math.min(dv | 0, 10)),\n          unit: 'Count',\n          src: '/images/palettes/' + this.visual_palette + '.png'\n        }\n      };\n\n      if (this.normalized) {\n        this.domain.legend.tick_format = function (v) {\n          return v + '%';\n        };\n      } // set it to the scope\n\n\n      this.tiles = {\n        x: 1,\n        y: 1,\n        set: [{\n          i: 0,\n          j: 0,\n          s: 0,\n          hz: f1,\n          ds: dt,\n          dhz: df,\n          src: this.thumbnail,\n          crisp: true\n        }]\n      };\n      this.legend = {\n        min: 0,\n        max: 255\n      };\n    },\n    getCaption: function () {\n      return soundscape.getCaptionFor(this);\n    }\n  };\n  return soundscape;\n});","angular.module('a2.visobjects', ['a2.visobjects.common', 'a2.visobjects.recording', 'a2.visobjects.soundscape', 'a2.visobjects.audio-event-detection']);","angular.module('a2.analysis.random-forest-models.models', ['a2.services', 'a2.permissions', 'a2.utils', 'ui.bootstrap', 'ui.select', 'ngSanitize', 'ngTable', 'ngCsv', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models.models', {\n    url: '/models',\n    controller: 'ModelsCtrl',\n    templateUrl: '/app/analysis/random-forest-models/models/list.html'\n  }).state('analysis.modeldetails', {\n    url: '/model/:modelId',\n    controller: 'ModelDetailsCtrl',\n    templateUrl: '/app/analysis/random-forest-models/models/modelinfo.html'\n  });\n}).controller('ModelsCtrl', function ($scope, $modal, $filter, ngTableParams, Project, a2Models, JobsData, $location, notify, a2UserPermit) {\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = true;\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  };\n\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n  });\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    $scope.tableParams = new ngTableParams({\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    }, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.modelsDataOrig, params.filter()) : $scope.modelsDataOrig;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : filteredData;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No models found.\";\n        }\n\n        $scope.modelsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Models.saveState({\n          data: $scope.modelsDataOrig,\n          filtered: $scope.modelsData,\n          f: params.filter(),\n          o: params.orderBy(),\n          p: params.page(),\n          c: params.count(),\n          t: orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.loadModels = function () {\n    a2Models.list(function (data) {\n      $scope.modelsData = data;\n      $scope.modelsDataOrig = data;\n      $scope.showInfo = false;\n      $scope.loading = false;\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+mname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No models found.\";\n      }\n    });\n  };\n\n  var stateData = a2Models.getState();\n\n  if (stateData === null) {\n    $scope.loadModels();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.modelsData = stateData.filtered;\n      $scope.modelsDataOrig = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n\n  $scope.deleteModel = function (model_id, model_name) {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to delete models');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/models/deletemodel.html',\n      controller: 'DeleteModelInstanceCtrl',\n      resolve: {\n        model_name: function () {\n          return model_name;\n        },\n        model_id: function () {\n          return model_id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.error) {\n        notify.error(\"Error: \" + ret.error);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.modelsDataOrig);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].model_id === model_id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.modelsDataOrig.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Model deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.model_id = null;\n  $scope.validationdata = null;\n\n  $scope.newModel = function () {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to create models');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var url = $scope.projectData.url;\n    a2Models.getFormInfo(function (data) {\n      var modalInstance = $modal.open({\n        templateUrl: '/app/analysis/random-forest-models/models/newmodel.html',\n        controller: 'NewModelInstanceCtrl',\n        resolve: {\n          projectData: function () {\n            return $scope.projectData;\n          },\n          types: function () {\n            var typesEnable = data.types.filter(function (type) {\n              return type.enabled;\n            });\n            return typesEnable;\n          },\n          trainings: function () {\n            return data.trainings;\n          }\n        }\n      });\n      modalInstance.opened.then(function () {\n        $scope.infoInfo = \"\";\n        $scope.showInfo = false;\n        $scope.loading = false;\n      });\n      modalInstance.result.then(function (result) {\n        if (result.ok) {\n          JobsData.updateJobs();\n          notify.log(\"Your new model training is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n        }\n\n        if (result.error) {\n          notify.error(\"Error \" + result.error);\n        }\n\n        if (result.url) {\n          $location.path(result.url);\n        }\n      });\n    });\n  };\n}).controller('NewModelInstanceCtrl', function ($scope, $modalInstance, a2Models, Project, projectData, types, trainings, notify, $http) {\n  $scope.types = types;\n  $scope.projectData = projectData;\n  $scope.trainings = trainings;\n  $scope.nameMsg = '';\n  $scope.data = {\n    training: '',\n    classifier: '',\n    name: '',\n    totalValidations: 'Retrieving...',\n    presentValidations: '-',\n    absentsValidations: '-',\n    usePresentTraining: '',\n    useNotPresentTraining: '',\n    usePresentValidation: -1,\n    useNotPresentValidation: -1\n  };\n  $http.get('/api/jobs/types').success(function (jobTypes) {\n    var training = jobTypes.filter(function (type) {\n      return type.name === \"Model training\";\n    });\n    if (!training.length) return console.error('training job info not found');\n    $scope.jobDisabled = !training[0].enabled;\n  });\n  $scope.totalPresentValidation = 0;\n  $scope.$watch('data.usePresentTraining', function () {\n    var val = $scope.data.presentValidations - $scope.data.usePresentTraining;\n\n    if (val > -1) {\n      $scope.data.usePresentValidation = val;\n    } else {\n      $scope.data.usePresentValidation = 0;\n    }\n\n    if ($scope.data.usePresentTraining > $scope.data.presentValidations) {\n      $scope.data.usePresentTraining = $scope.data.presentValidations;\n    }\n\n    $scope.totalPresentValidation = $scope.data.usePresentValidation;\n  });\n  $scope.totalNotPresentValidation = 0;\n  $scope.$watch('data.useNotPresentTraining', function () {\n    var val = $scope.data.absentsValidations - $scope.data.useNotPresentTraining;\n\n    if (val > -1) {\n      $scope.data.useNotPresentValidation = val;\n    } else $scope.data.useNotPresentValidation = 0;\n\n    if ($scope.data.useNotPresentTraining > $scope.data.absentsValidations) $scope.data.useNotPresentTraining = $scope.data.absentsValidations;\n    $scope.totalNotPresentValidation = $scope.data.useNotPresentValidation;\n  });\n  $scope.$watch('data.usePresentValidation', function () {\n    if ($scope.data.usePresentValidation > $scope.totalPresentValidation) {\n      $scope.data.usePresentValidation = $scope.totalPresentValidation;\n    }\n  });\n  $scope.$watch('data.useNotPresentValidation', function () {\n    if ($scope.data.useNotPresentValidation > $scope.totalNotPresentValidation) {\n      $scope.data.useNotPresentValidation = $scope.totalNotPresentValidation;\n    }\n  });\n  $scope.$watch('data.training', function () {\n    if ($scope.data.training !== '') {\n      Project.validationBySpeciesSong($scope.data.training.species_id, $scope.data.training.songtype_id, function (data) {\n        $scope.data.totalValidations = data.total;\n        $scope.data.presentValidations = data.present;\n        $scope.data.absentsValidations = data.absent;\n      });\n    }\n  });\n\n  $scope.disableCreateButton = function () {\n    return !($scope.trainings.length && $scope.data.name.length && $scope.totalNotPresentValidation > 0 && $scope.totalPresentValidation > 0 && $scope.data.usePresentTraining > 0 && $scope.data.useNotPresentTraining > 0 && $scope.data.usePresentValidation > 0 && $scope.data.useNotPresentValidation > 0 && typeof $scope.data.training !== 'string' && typeof $scope.data.classifier !== 'string' && !$scope.jobDisabled);\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n\n  $scope.ok = function () {\n    $scope.nameMsg = '';\n    a2Models.create({\n      n: $scope.data.name,\n      t: $scope.data.training.training_set_id,\n      c: $scope.data.classifier.model_type_id,\n      tp: parseInt($scope.data.usePresentTraining),\n      tn: parseInt($scope.data.useNotPresentTraining),\n      vp: parseInt($scope.data.usePresentValidation),\n      vn: parseInt($scope.data.useNotPresentValidation)\n    }).success(function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    }).error(function () {\n      $modalInstance.close({\n        err: \"Could not create job\"\n      });\n    });\n  };\n}).controller('DeleteModelInstanceCtrl', function ($scope, $modalInstance, a2Models, model_name, model_id, projectData, notify) {\n  $scope.model_name = model_name;\n  $scope.model_id = model_id;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    a2Models.delete(model_id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('NewClassificationInstanceCtrl', function ($scope, $modalInstance, model_name, model_id) {\n  $scope.model_name = model_name;\n  $scope.model_id = model_id;\n\n  $scope.ok = function () {\n    $modalInstance.close();\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('ModelDetailsCtrl', function ($scope, a2Models, $stateParams, $location, Project, a2Classi, notify, $window, a2UserPermit) {\n  var scopeExited = false;\n  $scope.$on('$destroy', function (argument) {\n    scopeExited = true;\n    a2Models.modelState(false);\n  });\n  /*\n      method recursively get validations vectors and then call waitinFunction()\n   */\n\n  var getVectors = function (index) {\n    if (scopeExited) return;\n    if (index >= $scope.validations.length) return $scope.waitinFunction();\n    var currRec = $scope.validations[index];\n    currRec.date = $window.moment(currRec.date, 'MM-DD-YYYY HH:mm');\n    a2Models.getRecVector($scope.model.id, currRec.id).success(function (data) {\n      if (!(data.err && data.err == \"vector-not-found\")) {\n        var vector = data.vector;\n        var vmax = Math.max.apply(null, vector);\n        var vmin = Math.min.apply(null, vector);\n        currRec.vmax = vmax;\n        currRec.vector = vector;\n        $scope.allMax.push(vmax);\n        $scope.allMin.push(vmin);\n\n        if (currRec.presence == 'no') {\n          if ($scope.vectorNoMax < vmax) {\n            $scope.vectorNoMax = vmax;\n          }\n        } else if (currRec.presence == 'yes') {\n          $scope.allYesMax.push(vmax);\n        }\n      }\n\n      getVectors(++index);\n    });\n  };\n\n  var loadingMsgs = ['', 'Loading validations', 'Loading vectors'];\n  $scope.loading = true;\n  $scope.showValidationsTable = true;\n  $scope.allYesMax = [];\n  $scope.allMax = [];\n  $scope.allMin = [];\n  $scope.vectorNoMax = -1;\n  $scope.loadingValidations = true;\n  $scope.showModelValidations = true;\n  $scope.messageSaved = '';\n  a2Models.modelState(true);\n  Project.getInfo(function (data) {\n    $scope.project_id = data.project_id;\n  });\n  a2Models.findById($stateParams.modelId).success(function (model) {\n    $scope.model = model;\n    $scope.loading = null;\n  }).error(function (data, status) {\n    if (status == 404) {\n      $scope.notFound = true;\n    } else {\n      notify.serverError();\n    }\n  });\n  a2Models.getValidationResults($stateParams.modelId, function (data) {\n    if (data.err || !data.validations.length) {\n      $scope.showModelValidations = false;\n      $scope.loadingValidations = false;\n      return;\n    }\n\n    $scope.validations = data.validations;\n    getVectors(0);\n  });\n\n  $scope.waitinFunction = function () {\n    $scope.loading = null;\n\n    if (!$scope.allYesMax.length) {\n      $scope.showModelValidations = false;\n      $scope.loadingValidations = false;\n    }\n\n    $scope.allYesMax = $scope.allYesMax.sort();\n    var index = 0;\n\n    for (var j = 0; j < $scope.allYesMax.length; j++) {\n      if ($scope.allYesMax[j] >= $scope.vectorNoMax) {\n        index = j;\n      }\n    } // NOTE this value is received from the server and overwritten here, maybe this value can be saved\n\n\n    $scope.model.maxv = Math.max.apply(null, $scope.allMax);\n    $scope.model.minv = Math.min.apply(null, $scope.allMin);\n    $scope.suggestedThreshold = Math.round($scope.allYesMax[index] * 1000000) / 1000000;\n\n    if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold)) {\n      $scope.suggestedThreshold = Math.round($scope.allYesMax[0] * 1000000) / 1000000;\n    }\n\n    if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold)) {\n      $scope.showModelValidations = false;\n    } else {\n      // TODO optimize this section\n      var searchTh = $scope.suggestedThreshold;\n      var thresholdObject = [];\n      var precisionObject = [];\n      var accuracyObject = [];\n      var sensitivityObject = [];\n      var specificityObject = [];\n      var sumObject = [];\n      var tries = 0;\n      var i, ii, jj;\n\n      while (searchTh > 0.01 && tries < 15) {\n        for (jj = 0; jj < $scope.validations.length; jj++) {\n          $scope.validations[jj].threshold = $scope.validations[jj].vmax > searchTh ? 'yes' : 'no';\n        }\n\n        $scope.computeStats();\n        thresholdObject.push(searchTh);\n        precisionObject.push($scope.thres.precision);\n        accuracyObject.push($scope.thres.accuracy);\n        sensitivityObject.push($scope.thres.sensitivity);\n        specificityObject.push($scope.thres.specificity);\n        sumObject.push($scope.thres.specificity + $scope.thres.sensitivity + $scope.thres.accuracy + $scope.thres.precision);\n        searchTh = searchTh - 0.001;\n        tries = tries + 1;\n      }\n\n      var max = sumObject[0];\n      var mindex = 0;\n\n      for (ii = 1; ii < sumObject.length; ii++) {\n        if (sumObject[ii] > max) {\n          max = sumObject[ii];\n          mindex = ii;\n        }\n      }\n\n      max = precisionObject[0];\n\n      for (ii = 0; ii < precisionObject.length; ii++) {\n        if (precisionObject[ii] >= max) {\n          max = precisionObject[ii];\n        }\n      }\n\n      var precisionMaxIndices = [];\n\n      for (ii = 0; ii < precisionObject.length; ii++) {\n        if (precisionObject[ii] == max) {\n          precisionMaxIndices.push(ii);\n        }\n      }\n\n      max = sensitivityObject[precisionMaxIndices[0]];\n\n      for (i = 0; i < precisionMaxIndices.length; i++) {\n        if (sensitivityObject[precisionMaxIndices[i]] >= max) {\n          max = sensitivityObject[precisionMaxIndices[i]];\n        }\n      }\n\n      var sensitivityMaxIndices = [];\n\n      for (i = 0; i < precisionMaxIndices.length; i++) {\n        if (sensitivityObject[precisionMaxIndices[i]] == max) {\n          sensitivityMaxIndices.push(precisionMaxIndices[i]);\n        }\n      }\n\n      max = accuracyObject[sensitivityMaxIndices[0]];\n\n      for (i = 0; i < sensitivityMaxIndices.length; i++) {\n        if (accuracyObject[sensitivityMaxIndices[i]] >= max) {\n          max = accuracyObject[sensitivityMaxIndices[i]];\n        }\n      }\n\n      var accuracyMaxIndices = [];\n\n      for (i = 0; i < sensitivityMaxIndices.length; i++) {\n        if (accuracyObject[sensitivityMaxIndices[i]] == max) {\n          accuracyMaxIndices.push(sensitivityMaxIndices[i]);\n        }\n      }\n\n      max = specificityObject[accuracyMaxIndices[0]];\n\n      for (i = 0; i < accuracyMaxIndices.length; i++) {\n        if (specificityObject[accuracyMaxIndices[i]] >= max) {\n          max = specificityObject[accuracyMaxIndices[i]];\n        }\n      }\n\n      var specificityMaxIndices = [];\n\n      for (i = 0; i < accuracyMaxIndices.length; i++) {\n        if (specificityObject[accuracyMaxIndices[i]] == max) {\n          specificityMaxIndices.push(accuracyMaxIndices[i]);\n        }\n      }\n\n      var accum = 0.0;\n\n      for (i = 0; i < specificityMaxIndices.length; i++) {\n        accum = accum + thresholdObject[specificityMaxIndices[i]];\n      }\n\n      accum = accum / specificityMaxIndices.length;\n      $scope.currentThreshold = $scope.model.threshold != '-' ? $scope.model.threshold : accum;\n      $scope.suggestedThreshold = Math.round(accum * 1000000) / 1000000;\n\n      if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold) || !$scope.suggestedThreshold) {\n        $scope.currentThreshold = $scope.model.threshold != '-' ? $scope.model.threshold : $scope.allYesMax[0];\n        $scope.suggestedThreshold = Math.round($scope.allYesMax[0] * 1000000) / 1000000;\n      }\n\n      for (jj = 0; jj < $scope.validations.length; jj++) {\n        $scope.validations[jj].threshold = $scope.validations[jj].vmax > $scope.currentThreshold ? 'yes' : 'no';\n      }\n\n      $scope.computeStats();\n      $scope.loadingValidations = false;\n    }\n  };\n\n  $scope.computeStats = function () {\n    $scope.thres = {\n      tpos: '-',\n      fpos: '-',\n      tneg: '-',\n      fneg: '-',\n      accuracy: '-',\n      precision: '-',\n      sensitivity: '-',\n      specificity: '-'\n    };\n    var trupositive = 0;\n    var falsepositives = 0;\n    var truenegatives = 0;\n    var falsenegative = 0;\n\n    for (var jj = 0; jj < $scope.validations.length; jj++) {\n      if ($scope.validations[jj].presence == 'yes') {\n        if ($scope.validations[jj].threshold == 'yes') {\n          trupositive = trupositive + 1;\n        } else {\n          falsenegative = falsenegative + 1;\n        }\n      } else {\n        if ($scope.validations[jj].threshold == 'yes') {\n          falsepositives = falsepositives + 1;\n        } else {\n          truenegatives = truenegatives + 1;\n        }\n      }\n    }\n\n    $scope.thres.tpos = trupositive;\n    $scope.thres.fpos = falsepositives;\n    $scope.thres.tneg = truenegatives;\n    $scope.thres.fneg = falsenegative;\n    $scope.thres.accuracy = Math.round((trupositive + truenegatives) / (trupositive + falsepositives + truenegatives + falsenegative) * 100) / 100;\n\n    if (trupositive + falsepositives > 0) {\n      $scope.thres.precision = Math.round(trupositive / (trupositive + falsepositives) * 100) / 100;\n    }\n\n    if (trupositive + falsenegative > 0) {\n      $scope.thres.sensitivity = Math.round(trupositive / (trupositive + falsenegative) * 100) / 100;\n    }\n\n    if (truenegatives + falsepositives > 0) {\n      $scope.thres.specificity = Math.round(truenegatives / (truenegatives + falsepositives) * 100) / 100;\n    }\n  };\n\n  $scope.saveThreshold = function () {\n    $scope.messageSaved = '';\n    $scope.recalculate();\n    a2Models.setThreshold($stateParams.modelId, $scope.currentThreshold).success(function () {\n      $scope.messageSaved = 'Threshold saved';\n      $scope.model.threshold = $scope.currentThreshold;\n    }).error(function () {\n      $scope.messageSaved = 'Error saving threshold';\n    });\n  };\n\n  $scope.recalculate = function () {\n    $scope.messageSaved = '';\n    var newval = parseFloat($scope.newthres);\n\n    if (!isNaN(newval) && newval <= 1.0 && newval >= 0.0) {\n      $scope.currentThreshold = newval;\n\n      for (var jj = 0; jj < $scope.validations.length; jj++) {\n        $scope.validations[jj].threshold = $scope.validations[jj].vmax > $scope.currentThreshold ? 'yes' : 'no';\n      }\n\n      $scope.computeStats();\n    } else {\n      $scope.messageSaved = 'Value should be between 0 and 1.';\n    }\n  }; // TODO use ng-style\n\n\n  $scope.zoomout = function () {\n    $(\"#patternDivMain\").css(\"min-width\", 210);\n    $(\"#patternDivMain\").css(\"height\", 100);\n  };\n\n  $scope.zoomin = function () {\n    $(\"#patternDivMain\").css(\"min-width\", 420);\n    $(\"#patternDivMain\").css(\"height\", 150);\n  };\n\n  $scope.isExport = function () {\n    return a2UserPermit.can('export report') || a2UserPermit.isSuper();\n  };\n\n  $scope.getValidations = function () {\n    var vals = [];\n\n    for (var i = 0; i < $scope.validations.length; i++) {\n      vals.push({\n        site: $scope.validations[i].site,\n        date: $scope.validations[i].date,\n        user: $scope.validations[i].presence,\n        model: $scope.validations[i].model,\n        threshold: $scope.validations[i].threshold,\n        value: $scope.currentThreshold\n      });\n    }\n\n    return vals;\n  };\n\n  $scope.recDetails = function (rec) {\n    $scope.selected = rec;\n    $scope.showValidationsTable = false;\n  };\n\n  $scope.closeRecValidationsDetails = function () {\n    $scope.showValidationsTable = true;\n    $scope.selected = null;\n  };\n\n  $scope.gotoRec = function () {\n    var rurl = \"/visualizer/rec/\" + $scope.selected.id;\n    $location.path(rurl);\n  };\n});","angular.module('a2.analysis.random-forest-models.classification', ['ui.bootstrap', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models.classification', {\n    url: '/classification',\n    controller: 'ClassificationCtrl',\n    templateUrl: '/app/analysis/random-forest-models/classification/list.html'\n  });\n}).controller('ClassificationCtrl', function ($scope, $modal, $filter, Project, ngTableParams, JobsData, a2Playlists, notify, $location, a2Classi, a2UserPermit) {\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.classificationsOriginal, params.filter()) : $scope.classificationsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.classificationsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No classifications found.\";\n        }\n\n        $scope.classificationsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Classi.saveState({\n          'data': $scope.classificationsOriginal,\n          'filtered': $scope.classificationsData,\n          'f': params.filter(),\n          'o': params.orderBy(),\n          'p': params.page(),\n          'c': params.count(),\n          't': orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  };\n\n  $scope.capitalize = function (row) {\n    return row.length ? row[0].toUpperCase() + row.slice(1) : row;\n  };\n\n  $scope.loadClassifications = function () {\n    a2Classi.list(function (data) {\n      $scope.classificationsOriginal = data;\n      data.forEach(function (row) {\n        row.muser = $scope.capitalize(row.firstname) + \" \" + $scope.capitalize(row.lastname);\n      });\n      $scope.classificationsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No classifications found.\";\n      }\n    });\n  };\n\n  $scope.showClassificationDetails = function (classi) {\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var data = {\n      id: classi.job_id,\n      name: classi.cname,\n      modelId: classi.model_id,\n      playlist: {\n        name: classi.playlist_name,\n        id: classi.playlist_id\n      }\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/classinfo.html',\n      controller: 'ClassiDetailsInstanceCtrl',\n      windowClass: 'details-modal-window',\n      backdrop: 'static',\n      resolve: {\n        ClassiInfo: function () {\n          return {\n            data: data,\n            project: $scope.projectData\n          };\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n  };\n\n  $scope.createNewClassification = function () {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to create classifications');\n      return;\n    }\n\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/createnewclassification.html',\n      controller: 'CreateNewClassificationInstanceCtrl',\n      resolve: {\n        data: function ($q) {\n          var d = $q.defer();\n          Project.getModels(function (err, data) {\n            if (err) {\n              console.error(err);\n            }\n\n            d.resolve(data || []);\n          });\n          return d.promise;\n        },\n        playlists: function ($q) {\n          var d = $q.defer();\n          a2Playlists.getList().then(function (data) {\n            d.resolve(data || []);\n          });\n          return d.promise;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new classification is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      }\n\n      if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      }\n\n      if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteClassification = function (id, name) {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to delete classifications');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/deleteclassification.html',\n      controller: 'DeleteClassificationInstanceCtrl',\n      resolve: {\n        name: function () {\n          return name;\n        },\n        id: function () {\n          return id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.classificationsOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].job_id === id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.classificationsOriginal.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Classification deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.loading = true;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n  });\n  var stateData = a2Classi.getState();\n\n  if (stateData === null) {\n    $scope.loadClassifications();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.classificationsData = stateData.filtered;\n      $scope.classificationsOriginal = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n}).controller('DeleteClassificationInstanceCtrl', function ($scope, $modalInstance, a2Classi, name, id, projectData) {\n  $scope.name = name;\n  $scope.id = id;\n  $scope.deletingloader = false;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2Classi.delete(id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('ClassiDetailsInstanceCtrl', function ($scope, $modalInstance, a2Classi, a2Models, notify, a2UserPermit, ClassiInfo) {\n  var loadClassifiedRec = function () {\n    a2Classi.getResultDetails($scope.classiData.id, $scope.currentPage * $scope.maxPerPage, $scope.maxPerPage, function (dataRec) {\n      a2Classi.getRecVector($scope.classiData.id, dataRec[0].recording_id).success(function (data) {\n        var maxVal = Math.max.apply(null, data.vector);\n\n        if (typeof $scope.th === 'number') {\n          $scope.htresDeci = maxVal < $scope.th ? 'no' : 'yes';\n        }\n\n        $scope.recVect = data.vector;\n        $scope.recs = dataRec;\n        $scope.minv = dataRec[0].stats.minv;\n        $scope.maxv = dataRec[0].stats.maxv;\n        $scope.maxvRounded = Math.round($scope.maxv * 1000) / 1000;\n      });\n    });\n  };\n\n  $scope.ok = function () {\n    $modalInstance.close();\n  };\n\n  $scope.next = function () {\n    $scope.currentPage = $scope.currentPage + 1;\n\n    if ($scope.currentPage * $scope.maxPerPage >= $scope.classiData.total) {\n      $scope.currentPage = $scope.currentPage - 1;\n    } else {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.prev = function () {\n    $scope.currentPage = $scope.currentPage - 1;\n\n    if ($scope.currentPage < 0) {\n      $scope.currentPage = 0;\n    } else {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.gotoc = function (where) {\n    if (where == 'first') {\n      $scope.currentPage = 0;\n    }\n\n    if (where == 'last') {\n      $scope.currentPage = Math.ceil($scope.classiData.total / $scope.maxPerPage) - 1;\n    }\n\n    loadClassifiedRec();\n  };\n\n  $scope.toggleRecDetails = function () {\n    $scope.showMore = !$scope.showMore;\n\n    if ($scope.showMore && !$scope.recs) {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.loading = true;\n  $scope.htresDeci = '-';\n  $scope.classiData = ClassiInfo.data;\n  $scope.project = ClassiInfo.project;\n  $scope.showMore = false;\n  $scope.currentPage = 0;\n  $scope.maxPerPage = 1;\n  $scope.csvUrl = \"/api/project/\" + $scope.project.url + \"/classifications/csv/\" + $scope.classiData.id;\n  $scope.showDownload = a2UserPermit.can('manage models and classification');\n  console.table($scope.classiData);\n  a2Classi.getDetails($scope.classiData.id, function (data) {\n    if (!data) {\n      $modalInstance.close();\n      notify.log(\"No details available for this classification\");\n      return;\n    }\n\n    angular.extend($scope.classiData, data);\n    $scope.totalRecs = Math.ceil($scope.classiData.total / $scope.maxPerPage);\n    console.log($scope.classiData);\n    $scope.results = [['absent', $scope.classiData.total - $scope.classiData.present], ['present', $scope.classiData.present], ['skipped', $scope.classiData.errCount]];\n    a2Models.findById($scope.classiData.modelId).success(function (modelInfo) {\n      console.log(modelInfo);\n      $scope.model = modelInfo;\n      $scope.loading = false;\n    }).error(function (err) {\n      $scope.loading = false;\n    });\n  });\n}).controller('CreateNewClassificationInstanceCtrl', function ($scope, $modalInstance, a2Classi, data, projectData, playlists) {\n  $scope.data = data;\n  $scope.projectData = projectData;\n  $scope.recselected = '';\n  $scope.showselection = false;\n  $scope.playlists = playlists;\n  $scope.nameMsg = '';\n  $scope.datas = {\n    name: '',\n    classifier: '',\n    playlist: ''\n  };\n  $scope.$watch('recselected', function () {\n    if ($scope.recselected === 'selected') {\n      $scope.showselection = true;\n    } else {\n      $scope.showselection = false;\n    }\n  });\n\n  $scope.ok = function () {\n    $scope.nameMsg = '';\n    var url = $scope.projectData.url;\n    $scope.all = 0;\n    $scope.selectedSites = []; // NOTE temporary block disabled model types\n\n    if (!$scope.datas.classifier.enabled) return;\n    var classiData = {\n      n: $scope.datas.name,\n      c: $scope.datas.classifier.model_id,\n      a: $scope.all,\n      s: $scope.selectedSites.join(),\n      p: $scope.datas.playlist\n    };\n    a2Classi.create(classiData, function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    });\n  };\n\n  $scope.buttonEnable = function () {\n    /*\n        var flag = false;\n        if ($scope.recselected === 'all')\n            flag = true;\n        else\n        {\n            var numberOfChecked = $('input:checkbox:checked').length;\n            if (numberOfChecked>0)\n            {\n                flag = true;\n            }\n         }\n    */\n    return !(typeof $scope.datas.playlist !== 'string' && $scope.datas.name.length && typeof $scope.datas.classifier !== 'string');\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n}).directive('a2Vectorchart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      vectorData: '=',\n      minvect: '=',\n      maxvect: '='\n    },\n    templateUrl: '/app/analysis/random-forest-models/classification/vectorchart.html',\n    controller: function ($scope) {\n      $scope.loadingflag = true;\n\n      $scope.drawVector = function () {\n        if (!$scope.vectorData) return;\n        $scope.loadingflag = true;\n        var canvas = $scope.canvas;\n        var vector = $scope.vectorData;\n        var height = 50;\n        var width = $scope.width;\n        var xStep;\n\n        if (width >= vector.length) {\n          canvas.width = width;\n          xStep = width / vector.length;\n        } else {\n          canvas.width = vector.length;\n          xStep = 1;\n        }\n\n        canvas.height = height;\n        ctx = canvas.getContext('2d');\n        ctx.beginPath();\n        var i = 0;\n        ctx.moveTo(i * xStep, height * (1 - (vector[i] - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n\n        while (i < vector.length) {\n          i++;\n          ctx.lineTo(i * xStep, height * (1 - (vector[i] - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n        }\n\n        ctx.strokeStyle = '#000';\n        ctx.stroke();\n\n        if ($scope.minvect < -0.09) {\n          //code\n          ctx.beginPath();\n          i = 0;\n          ctx.moveTo(i * xStep, height * (1 - (0 - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n\n          while (i < vector.length) {\n            i++;\n            ctx.lineTo(i * xStep, height * (1 - (0 - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n          }\n\n          ctx.strokeStyle = '#aa0000';\n          ctx.stroke();\n        }\n\n        $scope.loadingflag = false;\n      };\n\n      $scope.$watch('vectorData', function () {\n        $scope.drawVector();\n      });\n    },\n    link: function (scope, element) {\n      scope.canvas = element.children()[0];\n      scope.width = parseInt(element.css('width'));\n    }\n  };\n});","angular.module('a2.citizen-scientist.admin.classification-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.classification-stats', {\n    url: '/classification-stats/:speciesId?',\n    controller: 'A2CitizenScientistAdminClassificationStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/classification-stats/index.html'\n  });\n}).controller('A2CitizenScientistAdminClassificationStatsCtrl', function ($scope, a2CitizenScientistAdminService, $stateParams, $state, Species) {\n  this.setSpecies = function (speciesId) {\n    this.speciesId = speciesId;\n    $state.transitionTo($state.current.name, {\n      speciesId: speciesId\n    }, {\n      notify: false\n    });\n\n    if (this.speciesId) {\n      this.loadForSpecies();\n    }\n  };\n\n  this.speciesId = $stateParams.speciesId;\n\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getClassificationStats().then(function (data) {\n      this.loading = false;\n      this.stats = data.stats;\n    }.bind(this));\n  };\n\n  this.loadForSpecies = function () {\n    this.loadingForSpecies = true;\n    Species.findById(this.speciesId).then(function (species) {\n      this.species = species;\n    }.bind(this));\n    a2CitizenScientistAdminService.getClassificationStats(this.speciesId).then(function (data) {\n      this.loadingForSpecies = false;\n      this.speciesStats = data.stats;\n    }.bind(this));\n  };\n\n  this.patternMatchingExportUrl = function (row, per_user) {\n    return a2CitizenScientistAdminService.getCSExportUrl(row.pattern_matching_id, per_user);\n  };\n\n  this.loadPage();\n\n  if (this.speciesId) {\n    this.loadForSpecies();\n  }\n});","angular.module('a2.citizen-scientist.admin.user-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.user-stats', {\n    url: '/user-stats/:userId?',\n    controller: 'A2CitizenScientistAdminUserStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/user-stats/index.html'\n  });\n}).controller('A2CitizenScientistAdminUserStatsCtrl', function ($scope, a2CitizenScientistAdminService, $stateParams, $state, Users) {\n  this.userStatsExportUrl = a2CitizenScientistAdminService.getUserStatsExportUrl();\n\n  this.setUser = function (userId) {\n    this.userId = userId;\n    $state.transitionTo($state.current.name, {\n      userId: userId\n    }, {\n      notify: false\n    });\n\n    if (this.userId) {\n      this.loadForUser();\n    }\n  };\n\n  this.userId = $stateParams.userId;\n\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getUserStats().then(function (data) {\n      this.loading = false;\n      this.stats = data.stats.filter(function (item) {\n        return !!item.user_id;\n      });\n    }.bind(this));\n  };\n\n  this.loadForUser = function () {\n    this.loadingForUser = true;\n    Users.getInfoForId(this.userId).then(function (user) {\n      this.user = user;\n    }.bind(this));\n    a2CitizenScientistAdminService.getUserStats(this.userId).then(function (data) {\n      this.loadingForUser = false;\n      this.userStats = data.stats;\n    }.bind(this));\n  };\n\n  this.loadPage();\n\n  if (this.userId) {\n    this.loadForUser();\n  }\n});","angular.module('a2.citizen-scientist.admin.settings', ['a2.services', 'a2.srv.citizen-scientist-admin', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.settings', {\n    url: '/settings',\n    controller: 'A2CitizenScientistAdminSettingsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/settings/index.html'\n  });\n}).controller('A2CitizenScientistAdminSettingsCtrl', function ($scope, a2CitizenScientistAdminService, notify) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getSettings().then(function (data) {\n      this.loading = false;\n      this.patternmatchings = data;\n    }.bind(this));\n  };\n\n  this.save = function () {\n    this.saving = true;\n    var settings = this.patternmatchings.filter(function (pm) {\n      return pm.citizen_scientist || pm.cs_expert;\n    }).map(function (pm) {\n      return {\n        id: pm.id,\n        consensus_number: pm.consensus_number,\n        citizen_scientist: pm.citizen_scientist,\n        cs_expert: pm.cs_expert\n      };\n    });\n    return a2CitizenScientistAdminService.setSettings(settings).then(function (data) {\n      this.saving = false;\n      notify.log(\"Settings Saved.\");\n    }.bind(this)).catch(function () {\n      this.saving = false;\n      notify.error(\"An error occured.\");\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.browser_audio-event-detections', ['a2.browser_common', 'a2.filter.as-csv']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'audio-event-detection',\n    cardTemplate: '/app/visualizer/browser/audio-event-detections/card.html'\n  });\n  BrowserLOVOsProvider.add({\n    name: 'audio-event-detection',\n    group: 'audio-event-detections',\n    vobject_type: 'audio-event-detection',\n    icon: 'fa fa-object-group',\n    tooltip: \"Show Audio Event Detections\",\n    controller: 'a2BrowserAudioEventDetectionsController',\n    template: '/app/visualizer/browser/audio-event-detections/audio-event-detections.html'\n  });\n}).controller('a2BrowserAudioEventDetectionsController', function (a2Browser, AudioEventDetectionService, a2ArrayLOVO, $timeout, $q) {\n  var self = this;\n  this.audioEventDetections = [];\n  this.active = false;\n  this.loading = {\n    audioEventDetections: false\n  };\n  this.audioEventDetection = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    var defer = $q.defer();\n    AudioEventDetectionService.getList({\n      show: 'thumbnail-path'\n    }).then(function (audioEventDetections) {\n      console.log(\"audioEventDetections\", audioEventDetections);\n      self.loading.audioEventDetections = false;\n      self.audioEventDetections = audioEventDetections;\n\n      if (!self.audioEventDetections_lovo) {\n        self.audioEventDetections_lovo = new a2ArrayLOVO();\n      }\n\n      self.audioEventDetections_lovo.setArray(self.audioEventDetections, 'audio-event-detection');\n\n      self.audioEventDetections_lovo.update = function () {\n        self.activate();\n      };\n\n      if (!self.lovo) {\n        self.lovo = self.audioEventDetections_lovo;\n        a2Browser.setLOVO(self.lovo);\n      }\n\n      defer.resolve(false);\n\n      if (self.resolve.scd) {\n        self.resolve.scd.resolve(self.audioEventDetections);\n      }\n    });\n    self.loading.audioEventDetections = true;\n    return defer.promise;\n  };\n\n  this.resolve = {};\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    var defer = $q.defer();\n\n    if (m) {\n      var scid = m[1] | 0,\n          regionid = m[3] | 0;\n      var scd = $q.defer();\n\n      if (self.loading.audioEventDetections) {\n        self.resolve = {\n          scd: scd\n        };\n      } else {\n        scd.resolve(self.audioEventDetections);\n      }\n\n      scd.promise.then(function (audioEventDetections) {\n        var audioEventDetection = self.audioEventDetections.filter(function (audioEventDetection) {\n          return audioEventDetection.id == scid;\n        }).shift();\n\n        if (audioEventDetection) {\n          self.audioEventDetection = audioEventDetection;\n\n          if (regionid) {\n            if (!self.audioEventDetection.extra) {\n              self.audioEventDetection.extra = {};\n            }\n\n            self.audioEventDetection.extra.region = regionid;\n          }\n        }\n\n        defer.resolve(audioEventDetection);\n      });\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (audioEventDetection) {\n    return 'audio-event-detection/' + audioEventDetection.id + (audioEventDetection.extra && audioEventDetection.extra.region ? '/' + audioEventDetection.extra.region : '');\n  };\n});","angular.module('a2.browser_recordings', ['a2.browser_common', 'a2.browser_recordings_by_site', 'a2.browser_recordings_by_playlist']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'recording',\n    cardTemplate: '/app/visualizer/browser/recordings/card.html'\n  });\n});","angular.module('a2.browser_soundscapes', ['a2.browser_common']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'soundscape',\n    cardTemplate: '/app/visualizer/browser/soundscapes/card.html'\n  });\n  BrowserLOVOsProvider.add({\n    name: 'soundscape',\n    group: 'soundscapes',\n    vobject_type: 'soundscape',\n    icon: 'fa fa-area-chart',\n    tooltip: \"Show Soundscapes\",\n    controller: 'a2BrowserSoundscapesController',\n    template: '/app/visualizer/browser/soundscapes/soundscapes.html'\n  });\n}).controller('a2BrowserSoundscapesController', function (a2Browser, a2Soundscapes, a2ArrayLOVO, a2UrlUpdate, Project, $q) {\n  var self = this;\n  this.soundscapes = [];\n  this.active = false;\n  this.loading = {\n    soundscapes: false\n  };\n  this.soundscape = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    var defer = $q.defer();\n    a2Soundscapes.getList({\n      show: 'thumbnail-path'\n    }, function (soundscapes) {\n      self.loading.soundscapes = false;\n      self.soundscapes = soundscapes;\n      self.soundscapes.forEach(function (soundscape) {\n        a2UrlUpdate.update(soundscape.thumbnail);\n        soundscape.caption2 = soundscape.normalized ? 'normalized' : 'scale:' + (soundscape.visual_max_value !== null ? soundscape.visual_max_value : soundscape.max_value);\n      });\n\n      if (!self.soundscapes_lovo) {\n        self.soundscapes_lovo = new a2ArrayLOVO();\n      }\n\n      self.soundscapes_lovo.setArray(self.soundscapes, 'soundscape');\n\n      self.soundscapes_lovo.update = function () {\n        self.activate();\n      };\n\n      if (!self.lovo) {\n        self.lovo = self.soundscapes_lovo;\n        a2Browser.setLOVO(self.lovo);\n      }\n\n      defer.resolve(false);\n\n      if (self.resolve.scd) {\n        self.resolve.scd.resolve(self.soundscapes);\n      }\n    });\n    self.loading.soundscapes = true;\n    return defer.promise;\n  };\n\n  this.resolve = {};\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    var defer = $q.defer();\n\n    if (m) {\n      var scid = m[1] | 0,\n          regionid = m[3] | 0;\n      var scd = $q.defer();\n\n      if (self.loading.soundscapes) {\n        self.resolve = {\n          scd: scd\n        };\n      } else {\n        scd.resolve(self.soundscapes);\n      }\n\n      scd.promise.then(function (soundscapes) {\n        var soundscape = self.soundscapes.filter(function (soundscape) {\n          return soundscape.id == scid;\n        }).shift();\n\n        if (soundscape) {\n          self.soundscape = soundscape;\n\n          if (regionid) {\n            if (!self.soundscape.extra) {\n              self.soundscape.extra = {};\n            }\n\n            self.soundscape.extra.region = regionid;\n          }\n        }\n\n        defer.resolve(soundscape);\n      });\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (soundscape) {\n    return 'soundscape/' + soundscape.id + (soundscape.extra && soundscape.extra.region ? '/' + soundscape.extra.region : '');\n  };\n});","angular.module('a2.visualizer.layers.annotation-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.annotation-layer.object:annotation-layer\n   * @description base image layer.\n   * adds the annotation-layer layer_type to layer_types. This layer shows a set of images\n   * associated to the visobject (such as the spectrogram or a soundscape's rendering).\n   * The layer only has a spectrogram component.\n   * The layer requires a selected visobject of recording or soundscape type.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"annotation-layer\",\n    title: \"\",\n    controller: 'a2VisualizerAnnotationController as controller',\n    require: {\n      type: ['recording'],\n      selection: true\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n}).controller('a2VisualizerAnnotationController', function ($scope) {});","angular.module('a2.visualizer.layers.audio-events-layer', []).config(function (layer_typesProvider) {\n  layer_typesProvider.addLayerType({\n    type: \"audio-events-layer\",\n    title: \"\",\n    controller: 'a2VisualizerAudioEventsController as audio_events',\n    require: {\n      type: ['recording'],\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerAudioEventsController', function ($scope, a2AudioEventDetectionsClustering, a2ClusteringJobs, $localStorage) {\n  var self = this;\n  const colors = ['#5340ff33', '#008000', '#ffcd00', '#1F57CC', '#53ff40', '#5bc0de', '#5340ff33'];\n  self.audioEvents = null;\n  self.clusteringEvents = null;\n  self.isAudioEventsPlaylist = null;\n  self.selectedAudioEventJob = null;\n  self.clusterPlaylists = null;\n  self.isPlaylist = false;\n\n  self.toggleAudioEvents = function (isJobsBoxes, id, opacity) {\n    (isJobsBoxes ? self.audioEvents : self.clusteringEvents).forEach(function (item) {\n      if ((isJobsBoxes ? item.job_id : item.playlist_id) === id) {\n        item.opacity = opacity === false ? 0 : 1;\n\n        if (isJobsBoxes) {\n          const index = Object.keys(self.audioEventJobs).findIndex(function (job) {\n            return Number(job) === item.job_id;\n          });\n          const color = colors[index] || colors[0];\n          item.borderColor = self.hexToRGB(color, 0.6);\n          item.backgroundColor = self.hexToRGB(color, 0.2);\n        }\n      }\n    }); // Remove default/selected job from the audio events details page.\n\n    if (isJobsBoxes) {\n      $localStorage.setItem('analysis.audioEventJob', null);\n    }\n  };\n\n  self.hexToRGB = function (hex, opacity) {\n    var r = parseInt(hex.slice(1, 3), 16),\n        g = parseInt(hex.slice(3, 5), 16),\n        b = parseInt(hex.slice(5, 7), 16);\n    return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + opacity + ')';\n  };\n\n  self.isHighlightTitle = function () {\n    return !isNaN($localStorage.getItem('analysis.audioEventJob'));\n  };\n\n  self.fetchAudioEvents = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (rec) {\n      self.isPlaylist = $scope.visobject.extra && $scope.visobject.extra.playlist; // Check local storage on selected job from the audio events details page.\n\n      try {\n        self.selectedAudioEventJob = $localStorage.getItem('analysis.audioEventJob');\n        self.isAudioEventsPlaylist = !isNaN(self.selectedAudioEventJob);\n      } catch (e) {} // Get Detections Jobs data.\n\n\n      a2AudioEventDetectionsClustering.list({\n        rec_id: rec,\n        completed: true\n      }).then(function (audioEvents) {\n        if (audioEvents) {\n          self.audioEventJobs = {}; // Collect detections jobs data for audio events layer.\n\n          if (audioEvents.length) {\n            audioEvents.forEach(function (event) {\n              if (!self.audioEventJobs[event.job_id]) {\n                self.audioEventJobs[event.job_id] = {\n                  job_id: event.job_id,\n                  name: event.name,\n                  count: 1,\n                  parameters: event.parameters,\n                  visible: self.isAudioEventsPlaylist ? Number(self.selectedAudioEventJob) === event.job_id : false // Job not visible by default, except selected job from the audio events details page.\n\n                };\n              }\n\n              ;\n              self.audioEventJobs[event.job_id].count += 1;\n            });\n          }\n\n          self.audioEvents = audioEvents.map(function (event) {\n            return {\n              rec_id: event.rec_id,\n              x1: event.time_min,\n              x2: event.time_max,\n              y1: event.freq_min,\n              y2: event.freq_max,\n              job_id: event.job_id || null,\n              display: event.rec_id === rec ? \"block\" : \"none\",\n              opacity: self.isAudioEventsPlaylist ? Number(self.selectedAudioEventJob) === event.job_id ? 1 : 0 : 0 // Boxes not visible by default, except selected job from the audio events details page.\n\n            };\n          });\n          a2ClusteringJobs.getRoisDetails({\n            rec_id: $scope.visobject.id\n          }).then(function (clusteringEvents) {\n            if (clusteringEvents) {\n              // Collect clustering playlists for audio events layer.\n              self.clusterPlaylists = {};\n              clusteringEvents.forEach(function (event) {\n                if (!self.clusterPlaylists[event.playlist_id]) {\n                  self.clusterPlaylists[event.playlist_id] = {\n                    rec_id: event.recording_id,\n                    playlist_name: event.playlist_name,\n                    playlist_id: event.playlist_id,\n                    count: 1,\n                    visible: false // Playlist is hidden by default.\n\n                  };\n                }\n\n                ;\n                self.clusterPlaylists[event.playlist_id].count += 1;\n              });\n              self.clusteringEvents = clusteringEvents.map(function (event) {\n                return {\n                  rec_id: event.recording_id,\n                  x1: event.time_min,\n                  x2: event.time_max,\n                  y1: event.frequency_min,\n                  y2: event.frequency_max,\n                  playlist_id: event.playlist_id || null,\n                  display: event.recording_id === rec ? \"block\" : \"none\",\n                  opacity: 0 // Boxes not visible by default.\n\n                };\n              });\n            }\n          });\n        }\n      });\n    }\n  };\n\n  $scope.$watch('visobject', self.fetchAudioEvents);\n});","angular.module('a2.visualizer.layers.base-image-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.base-image-layer.object:base-image-layer\n   * @description base image layer. \n   * adds the base-image-layer layer_type to layer_types. This layer shows a set of images\n   * associated to the visobject (such as the spectrogram or a soundscape's rendering).\n   * The layer only has a spectrogram component.\n   * The layer requires a selected visobject of recording or soundscape type.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"base-image-layer\",\n    title: \"\",\n    require: {\n      type: ['recording', 'soundscape'],\n      selection: true\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n});","angular.module('a2.visualizer.layers.data-plot-layer', ['a2.directive.plotly-plotter', 'arbimon2.directive.a2-dropdown']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.data-plot-layer.object:data-plot-layer\n   * @description base image layer. \n   * adds the data-plot-layer layer_type to layer_types. This layer shows a set of plots\n   * related to the visobject.\n   * The layer only has a spectrogram component.\n   * The layer requires a visobject of type audio-event-detection.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"data-plot-layer\",\n    title: \"\",\n    controller: 'a2VisualizerDataPlotLayerController as controller',\n    require: {\n      type: ['audio-event-detection'],\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerDataPlotLayerController', function ($scope) {});","angular.module('a2.visualizer.layers.recording-soundscape-region-tags', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.recordings.object:recordings-layer\n   * @description Recordings layer. \n   * adds the recordings-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.recordings.controller:a2VisualizerRecordingLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-soundscape-region-tags\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingSoundscapeRegionTagsLayerController as ctrl',\n    require: {\n      type: 'recording',\n      selection: true,\n      that: function (scope) {\n        var pl = scope.visobject && scope.visobject.extra && scope.visobject.extra.playlist;\n        return pl && pl.soundscape && pl.region;\n      }\n    },\n    sidebar_only: true,\n    visible: true,\n    hide_visibility: false\n  });\n}).controller('a2VisualizerRecordingSoundscapeRegionTagsLayerController', function ($scope, a2Soundscapes) {\n  var self = this;\n  self.loading = {};\n  self.tag = {\n    name: null,\n    add: function () {\n      var tag = this.name;\n      this.name = null;\n      a2Soundscapes.addRecordingTag(self.soundscape.id, self.region.id, self.recording.id, tag, function (tag) {\n        var tagid = tag.id | 0;\n\n        if (!self.tags.filter(function (t) {\n          return t.id == tagid;\n        }).length) {\n          self.tags.push(tag);\n        }\n      });\n    },\n    remove: function (tag) {\n      var tagid = tag.id | 0;\n      a2Soundscapes.removeRecordingTag(self.soundscape.id, self.region.id, self.recording.id, tagid, function () {\n        self.tags = self.tags.filter(function (t) {\n          return t.id != tagid;\n        });\n      });\n    }\n  };\n  $scope.$watch('visobject', function (visobject) {\n    self.recording = null;\n    self.playlist = null;\n    self.soundscape = null;\n    self.region = null;\n    self.tags = null;\n\n    if (visobject && visobject.type == 'recording' && visobject.id && visobject.extra && visobject.extra.playlist && visobject.extra.playlist.soundscape && visobject.extra.playlist.region) {\n      self.recording = visobject;\n      self.playlist = visobject.extra.playlist;\n      self.loading.soundscape = true;\n      self.loading.region = true;\n      self.loading.tags = true;\n      a2Soundscapes.get(self.playlist.soundscape, function (soundscape) {\n        self.loading.soundscape = false;\n        self.soundscape = soundscape;\n        a2Soundscapes.getRegion(soundscape.id, self.playlist.region, function (region) {\n          self.loading.region = false;\n          self.region = region;\n          a2Soundscapes.getRecordingTags(soundscape.id, region.id, self.recording.id, function (tags) {\n            self.loading.tags = false;\n            self.tags = tags;\n          });\n        });\n      });\n    }\n  });\n});","angular.module('a2.visualizer.layers.recordings', ['a2.filter.round', 'a2.directive.frequency_filter_range_control']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.recordings.object:recordings-layer\n   * @description Recordings layer.\n   * adds the recordings-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.recordings.controller:a2VisualizerRecordingLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-layer\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingLayerController as controller',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerRecordingLayerController', function ($scope, $modal, $location, $window) {\n  this.setGain = function (gain) {\n    $scope.audio_player.setGain(gain).then(function () {\n      var gain = $scope.audio_player.gain;\n      $scope.location.updateParams({\n        gain: gain >= 1 ? gain : undefined\n      });\n    });\n  };\n\n  this.explorerUrl = function () {\n    if (!$scope.visobject) return null;\n    return $scope.visobject.explorerUrl;\n  };\n\n  this.openFreqFilterModal = function () {\n    if (!$scope.visobject) {\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/recordings/frequency_filter_modal.html',\n      controller: 'a2VisualizerFrequencyFilterModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            recording: $scope.visobject,\n            filter: $scope.audio_player.freq_filter\n          };\n        }\n      }\n    }).result.then($scope.audio_player.setFrequencyFilter.bind($scope.audio_player)).then(function () {\n      var filter = $scope.audio_player.freq_filter;\n      $scope.location.updateParams({\n        filter: filter ? filter.min + '-' + filter.max : undefined\n      });\n    });\n  };\n}).controller('a2VisualizerFrequencyFilterModalController', function ($scope, $modalInstance, data) {\n  $scope.recording = data.recording;\n  $scope.max_freq = data.recording.sample_rate / 2;\n  $scope.has_previous_filter = true; //!!data.filter;\n\n  $scope.filter = data.filter ? angular.copy(data.filter) : {\n    min: 0,\n    max: $scope.max_freq\n  };\n\n  $scope.remove_filter = function () {\n    $modalInstance.close();\n  };\n\n  $scope.apply_filter = function () {\n    $modalInstance.close($scope.filter);\n  };\n});","angular.module('a2.visualizer.layers.soundscapes', ['a2.visualizer.layers.soundscapes.info', 'a2.visualizer.layers.soundscapes.regions']);","angular.module('a2.visualizer.layers.species-presence', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.species-presence.object:species-presence\n   * @description species presence validation layer.\n   * Adds the species-presence layer_type to layer_types. This layer shows a\n   * species presence validation interface.\n   * The layer has spectrogram component.\n   * The layer requires a selected visobject of recording type.\n   * The layer has visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"species-presence\",\n    title: \"\",\n    controller: 'a2VisualizerSpeciesPresenceController as species_presence',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerSpeciesPresenceController', function ($scope, a2PatternMatching, a2AudioEventDetectionsClustering) {\n  var self = this;\n  self.speciesPresence = null;\n  self.isRemoving = false;\n\n  self.checkSpectroWidth = function (leftBox, widthBox, widthSpectro) {\n    return leftBox + widthBox + 200 < widthSpectro;\n  };\n\n  self.togglePopup = function (roi) {\n    roi.isPopupOpened = !roi.isPopupOpened;\n  };\n\n  self.confirmPopup = function (roi) {\n    self.isRemoving = true;\n\n    if (roi.aed_id) {\n      return a2AudioEventDetectionsClustering.unvalidate({\n        aed: [roi.aed_id]\n      }).then(function () {\n        self.closePopup(roi);\n        roi.name = '';\n      });\n    } else return a2PatternMatching.validateRois(roi.pattern_matching_id, roi.pattern_matching_roi_id, null).then(function () {\n      self.closePopup(roi);\n      roi.display = \"none\";\n    });\n  };\n\n  self.closePopup = function (roi) {\n    self.isRemoving = false;\n    roi.isPopupOpened = false;\n  };\n\n  self.fetchSpeciesPresence = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (rec) {\n      a2PatternMatching.list({\n        rec_id: rec,\n        validated: 1\n      }).then(function (rois) {\n        self.speciesPresence = rois.map(function (roi) {\n          return {\n            rec_id: roi.recording_id,\n            pattern_matching_id: roi.pattern_matching_id,\n            pattern_matching_roi_id: roi.pattern_matching_roi_id,\n            name: roi.species_name + ' ' + roi.songtype_name,\n            x1: roi.x1,\n            x2: roi.x2,\n            y1: roi.y1,\n            y2: roi.y2,\n            display: roi.recording_id === rec ? \"block\" : \"none\",\n            isPopupOpened: false\n          };\n        }); // Add validated aed species boxes\n\n        if ($scope.visobject && $scope.visobject.aedValidations && $scope.visobject.aedValidations.length) {\n          self.speciesPresence = self.speciesPresence.concat($scope.visobject.aedValidations);\n        }\n      });\n    }\n  };\n\n  $scope.$watch('visobject', self.fetchSpeciesPresence);\n});","angular.module('a2.visualizer.layers.training-sets.roi_set', ['visualizer-services', 'a2.permissions', 'humane']).config(function (training_set_typesProvider) {\n  training_set_typesProvider.add({\n    type: 'roi_set',\n    has_layout: true,\n    templates: {\n      layer_item: '/app/visualizer/layer-item/training-sets/roi_set.html',\n      new_modal: '/app/visualizer/modal/new_roi_set_tset_partial.html'\n    },\n    action: {\n      collect_new_tset_data: function (sdata, tset_data, sval) {\n        if (sdata.class) {\n          tset_data.class = sdata.class.id;\n        } else {\n          sval.class = \"Please select a project class.\";\n          sval.count++;\n        }\n      }\n    },\n    controller: 'a2VisualizerSpectrogramTrainingSetRoiSetData'\n  });\n}).controller('a2VisualizerTrainingSetLayerRoiSetDataController', function ($scope, $timeout, a2TrainingSets, training_set_types, a22PointBBoxEditor, a2UserPermit, notify) {\n  var self = this;\n  self.type = 'roi_set';\n  self.typedef = training_set_types.roi_set;\n\n  $scope.getXCoord = function (x1, x2) {\n    return $scope.getXSide(x1, x2) == 'left' ? x1 : x2;\n  };\n\n  $scope.getXSide = function (x1, x2) {\n    var px = Math.max(0, Math.min($scope.layout.sec2x(x2, 1) / $scope.layout.spectrogram.width, 1));\n    return px > .5 ? 'left' : 'right';\n  };\n\n  $scope.getTransform = function (x1, x2, y1, y2) {\n    var tx = $scope.getXSide(x1, x2) == 'left' ? '-100%' : '0';\n    var ty = $scope.getYTranslation((y1 + y2) / 2, true);\n    return 'translate(' + tx + ', ' + ty + ')';\n  };\n\n  $scope.getYTranslation = function (y, asrelativeoffset) {\n    var py = Math.max(0.1, Math.min($scope.layout.hz2y(y, 1) / $scope.layout.spectrogram.height, .9));\n\n    if (asrelativeoffset) {\n      py = -py;\n    }\n\n    return (100 * py | 0) + '%';\n  };\n\n  self.fetchData = function (tsetId, rec) {\n    self.tsetId = tsetId;\n    self.recording = rec;\n    a2TrainingSets.getData(tsetId, rec, function (data) {\n      $timeout(function () {\n        self.rois = data;\n      });\n    });\n  };\n\n  self.editor = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.roi = null;\n    },\n    make_new_bbox: function () {\n      this.super.make_new_bbox.call(this);\n      this.roi = this.bbox;\n    },\n    make_new_roi: function () {\n      this.make_new_bbox();\n    },\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    submit: function () {\n      if (!a2UserPermit.can('manage training sets')) {\n        notify.error('You do not have permission to add ROIs to training set');\n        return;\n      }\n\n      a2TrainingSets.addData(self.tsetId, {\n        recording: self.recording,\n        roi: this.roi\n      }, function (new_tset_data) {\n        $timeout(function () {\n          this.reset();\n          self.rois.push(new_tset_data);\n        }.bind(this));\n      }.bind(this));\n    }\n  });\n});","angular.module('a2.visualizer.layers.training-sets', ['visualizer-services', 'a2.visualizer.layers.training-sets.roi_set', 'a2.utils']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.training-sets.object:training-data\n   * @description Training Data layer.\n   * adds the training-data layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.training-sets.controller:a2VisualizerTrainingSetLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"training-data\",\n    title: \"\",\n    controller: 'a2VisualizerTrainingSetLayerController as training_data',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerTrainingSetLayerController', function ($scope, $modal, $controller, $timeout, a2TrainingSets, a2UserPermit, notify) {\n  var self = this;\n  self.tset = null;\n  self.tset_type = null;\n  self.tset_list = [];\n  self.data = null;\n  a2TrainingSets.getList(function (training_sets) {\n    self.tset_list = training_sets;\n\n    if (!self.tset && training_sets && training_sets.length > 0) {\n      self.tset = training_sets[0];\n    }\n  });\n\n  self.add_new_tset = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to create training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/training-data/add_tset_modal.html',\n      controller: 'a2VisualizerAddTrainingSetModalController'\n    }).result.then(function (new_tset) {\n      if (new_tset && new_tset.id) {\n        self.tset_list.push(new_tset);\n\n        if (!self.tset) {\n          self.tset = new_tset;\n        }\n      }\n    });\n  };\n\n  var fetchTsetData = function () {\n    var tset = self.tset && self.tset.id;\n    var tset_type = self.tset && self.tset.type;\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (tset && rec) {\n      if (!self.data || self.data.type != tset_type) {\n        var cont_name = tset_type.replace(/(^|-|_)(\\w)/g, function (_, _1, _2, _3) {\n          return _2.toUpperCase();\n        });\n        cont_name = 'a2VisualizerTrainingSetLayer' + cont_name + 'DataController';\n        self.data = $controller(cont_name, {\n          $scope: $scope\n        });\n      }\n\n      self.data.fetchData(tset, rec);\n    }\n  };\n\n  $scope.$watch(function () {\n    return self.tset;\n  }, fetchTsetData);\n  $scope.$watch('visobject', fetchTsetData);\n}).directive('a2VisualizerSpectrogramTrainingSetData', function (training_set_types, $compile, $controller, $templateFetch) {\n  return {\n    restrict: 'A',\n    template: '<div class=\"training-set-data\"></div>',\n    replace: true,\n    link: function (scope, element, attrs) {\n      scope.$watch(attrs.a2VisualizerSpectrogramTrainingSetData, function (tset_type) {\n        var type_def = training_set_types[tset_type];\n        element.attr('data-tset-type', tset_type);\n\n        if (type_def) {\n          if (type_def.has_layout) {\n            var tmp_url = '/app/visualizer/spectrogram-layer/training-sets/' + tset_type + '.html';\n            $templateFetch(tmp_url, function (tmp) {\n              element.empty().append($compile(tmp)(scope));\n            });\n          }\n        }\n      });\n    }\n  };\n}).controller('a2VisualizerAddTrainingSetModalController', function ($scope, $modalInstance, Project, a2TrainingSets, $state) {\n  $scope.data = {\n    name: '',\n    type: null\n  };\n  $scope.loadingClasses = true;\n  Project.getClasses(function (project_classes) {\n    $scope.project_classes = project_classes;\n    $scope.loadingClasses = false;\n  });\n  $scope.loadingTypes = true;\n  a2TrainingSets.getTypes(function (tset_types) {\n    $scope.tset_types = tset_types;\n\n    if (tset_types && tset_types.length == 1) {\n      $scope.data.type = tset_types[0];\n      $scope.loadingTypes = false;\n    }\n  });\n\n  $scope.goToSpeciesPage = function () {\n    $state.go('audiodata.species', {});\n  };\n\n  $scope.ok = function () {\n    $scope.creating = true;\n    $scope.validation = {\n      count: 0\n    };\n    var tset_data = {};\n\n    if ($scope.data.name) {\n      tset_data.name = $scope.data.name;\n    } else {\n      $scope.validation.name = \"Training set name is required.\";\n      $scope.validation.count++;\n    }\n\n    if ($scope.data.type && $scope.data.type.id) {\n      tset_data.type = $scope.data.type.identifier;\n    } else {\n      $scope.validation.type = \"Training set type is required.\";\n      $scope.validation.count++;\n    }\n\n    if ($scope.data.class) {\n      tset_data.class = $scope.data.class.id;\n    } else {\n      $scope.validation.class = \"Species sound is required.\";\n      $scope.validation.count++;\n    } // $scope.form_data=tset_data;\n\n\n    if ($scope.validation.count === 0) {\n      a2TrainingSets.add(tset_data, function (new_tset) {\n        if (new_tset.error) {\n          var field = new_tset.field || 'error';\n          $scope.validation[field] = new_tset.error;\n          return;\n        }\n\n        $modalInstance.close(new_tset);\n      });\n    } else {\n      $scope.creating = false;\n    }\n  };\n});","angular.module('a2.visualizer.layers.zoom-input-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.zoom-input-layer.object:zoom-input-layer\n   * @description base image layer. \n   * adds the zoom-input-layer layer_type to layer_types. This layer collects input forEach\n   * performin zoom actions on the spectrogram.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"zoom-input-layer\",\n    title: \"\",\n    require: {\n      type: ['recording', 'soundscape'],\n      selection: true,\n      that: function (scope) {\n        return scope.visobject && scope.visobject.zoomable;\n      }\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n});","angular.module('a2.browser_recordings_by_playlist', ['a2.classy', 'a2.browser_common']).config(function (BrowserLOVOsProvider) {\n  BrowserLOVOsProvider.add({\n    name: 'playlist',\n    group: 'recordings',\n    vobject_type: 'recording',\n    icon: 'fa fa-list',\n    tooltip: \"Browse Recordings by Playlist\",\n    controller: 'a2BrowserRecordingsByPlaylistController',\n    template: '/app/visualizer/browser/recordings/by-playlist/recordings-by-playlist.html'\n  });\n}).service('a2PlaylistLOVO', function ($q, makeClass, a2Playlists, a2Pager, $state, $localStorage, Project) {\n  return makeClass({\n    static: {\n      PageSize: 10,\n      BlockSize: 7\n    },\n    constructor: function (playlist) {\n      this.loading = false;\n      this.playlist = playlist;\n      this.object_type = \"recording\";\n      this.offset = 0;\n      this.count = 0;\n      this.list = [];\n      this.whole_list = [];\n      var self = this;\n      this.paging = new a2Pager({\n        item_count: playlist.count,\n        page_size: this.constructor.PageSize,\n        block_size: this.constructor.BlockSize,\n        block_tracks_page: true,\n        on_page: function (e) {\n          return self.load_page(e.offset, e.count);\n        }\n      });\n    },\n    initialize: function () {\n      var self = this,\n          d = $q.defer();\n\n      if (this.initialized) {\n        d.resolve(true);\n      } else {\n        this.paging.set_page(0).then(function () {\n          d.resolve(false);\n        });\n      }\n\n      if (self.playlist && self.playlist.id === 0) {\n        d.resolve(true);\n        return d.promise;\n      }\n\n      ;\n      return d.promise.then(function () {\n        a2Playlists.getInfo(self.playlist.id, function (playlist_info) {\n          self.playlist = playlist_info;\n        });\n      }).then(function () {\n        if (self.whole_list) {\n          self.whole_list.forEach(self.append_extras.bind(self));\n        }\n      });\n    },\n    load_page: function (offset, count) {\n      var self = this,\n          d = $q.defer();\n      var opts = {\n        offset: offset,\n        limit: count,\n        show: 'thumbnail-path'\n      }; // get recordings data for temporary clusters playlist\n\n      if ($state.params.clusters) {\n        var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n\n        if (clustersData && clustersData.playlist && clustersData.playlist.recordings) {\n          opts.recordings = clustersData.playlist.recordings.filter(function (id, i, a) {\n            return i >= opts.offset && i < opts.offset + opts.limit;\n          });\n          self.count = clustersData.playlist.recordings.length;\n        }\n      }\n\n      ;\n      self.loading = true;\n      a2Playlists.getData(self.playlist.id, opts, function (recordings) {\n        self.list = recordings;\n        recordings.forEach(function (recording) {\n          recording.caption = [recording.site, moment.utc(recording.datetime).format('lll')].join(', ');\n          recording.vaxis = {\n            font: '7px',\n            color: '#333333',\n            range: [0, recording.sample_rate / 2000],\n            count: 5,\n            unit: ''\n          };\n          self.append_extras(recording);\n        });\n        self.loading = false;\n        d.resolve(recordings);\n      });\n      return d.promise;\n    },\n    append_extras: function (recording) {\n      if (recording) {\n        recording.extra = {\n          playlist: this.playlist\n        };\n      }\n\n      return recording;\n    },\n    find_local: function (recording) {\n      var self = this;\n      var id = recording && recording.id || recording | 0; // console.log(\":: find : \", id);\n\n      return $q.resolve(this.append_extras(this.list && this.list.filter(function (r) {\n        // if(r.id == id){\n        // console.log(\"     :: found\", r.id, r);\n        // }\n        return r.id == id;\n      }).shift()));\n    },\n    find: function (recording) {\n      var self = this;\n      var d = $q.defer();\n      var id = recording && recording.id || recording | 0;\n      self.find_local(recording).then(function (found_rec) {\n        if (found_rec) {\n          d.resolve(found_rec);\n        } else {\n          a2Playlists.getRecordingPosition(self.playlist.id, id).then(function (response) {\n            return self.paging.set_page(self.paging.page_for(response.data));\n          }).then(function (recordings) {\n            return self.find_local(recording);\n          }).then(function (found_rec) {\n            d.resolve(found_rec);\n          });\n        }\n      });\n      return d.promise;\n    },\n    previous: function (recording) {\n      var self = this;\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      a2Playlists.getPreviousRecording(this.playlist.id, id, function (r) {\n        d.resolve(self.append_extras(r));\n      });\n      return d.promise;\n    },\n    next: function (recording) {\n      var self = this;\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      a2Playlists.getNextRecording(this.playlist.id, id, function (r) {\n        d.resolve(self.append_extras(r));\n      });\n      return d.promise;\n    }\n  });\n}).factory('a2Pager', function (makeClass) {\n  return makeClass({\n    constructor: function (options) {\n      this.block_size = 10;\n      this.last_page = 0;\n      this.set_options(options);\n    },\n    resolve_value: function (value, current, first, last) {\n      switch (value) {\n        case 'first':\n          value = first;\n          break;\n\n        case 'previous':\n          value = current - 1;\n          break;\n\n        case 'next':\n          value = current + 1;\n          break;\n\n        case 'last':\n          value = last;\n          break;\n      }\n\n      return Math.max(first, Math.min(+value, last));\n    },\n    set_options: function (options) {\n      if (options.item_count) {\n        this.item_count = options.item_count;\n      }\n\n      if (options.page_size) {\n        this.page_size = options.page_size;\n      }\n\n      if (options.block_size) {\n        this.block_size = options.block_size;\n      }\n\n      if (options.last_page) {\n        this.last_page = options.last_page;\n      }\n\n      if (options.block_tracks_page !== undefined) {\n        this.block_tracks_page = !!options.block_tracks_page;\n      }\n\n      if (options.on_page !== undefined) {\n        this.on_page = options.on_page;\n      }\n\n      this.update();\n    },\n    page_for: function (item) {\n      var page = item / this.page_size | 0;\n      console.log(\"page_for(%s) :: %s\", item, page);\n      return page;\n    },\n    set_page: function (page) {\n      this.current_page = this.resolve_value(page, this.current_page, 0, this.last_page) | 0;\n      this.is_at_first_page = this.current_page === 0;\n      this.is_at_last_page = this.current_page === this.last_page;\n\n      if (this.block_tracks_page) {\n        this.show_block((this.current_page - this.block_size / 2 + this.block_size % 2) / this.block_size);\n      } else {\n        this.show_block(this.current_page / this.block_size);\n      }\n\n      if (this.on_page instanceof Function) {\n        var offset = this.current_page * this.page_size;\n        return this.on_page({\n          page: this.current_page,\n          offset: offset,\n          count: Math.min(this.page_size, this.item_count - offset + 1)\n        });\n      }\n    },\n    update: function () {\n      this.is_at_first_page = this.current_page <= 0;\n      this.last_page = (this.item_count - 1) / this.page_size | 0;\n      this.last_page_block = this.last_page / this.block_size | 0;\n      this.is_at_last_page = this.current_page >= this.last_page;\n      this.show_block(this.block);\n    },\n    show_block: function (block) {\n      if (this.block_tracks_page) {\n        this.current_page_block = this.resolve_value(block, this.current_page_block, 0, this.last_page_block);\n      } else {\n        this.current_page_block = this.resolve_value(block, this.current_page_block, 0, this.last_page_block) | 0;\n      }\n\n      this.is_at_first_page_block = this.current_page_block <= 0;\n      this.is_at_last_page_block = this.current_page_block >= this.last_page_block;\n      this.current_page_block_first_page = this.current_page_block * this.block_size | 0;\n      this.current_page_block_last_page = Math.min((this.current_page_block + 1) * this.block_size - 1 | 0, this.last_page);\n      this.block = [];\n\n      for (var i = this.current_page_block_first_page, e = this.current_page_block_last_page; i <= e; ++i) {\n        this.block.push(i);\n      }\n    },\n    has_page: function (page) {\n      return 0 <= page && page <= this.last_page;\n    }\n  });\n}).controller('a2BrowserRecordingsByPlaylistController', function ($scope, a2Browser, a2Playlists, $q, a2PlaylistLOVO, $state, $localStorage) {\n  var self = this;\n  this.playlists = [];\n  this.active = false;\n  this.loading = {\n    playlists: false\n  };\n  this.playlist = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    self.loading.playlists = true;\n    this.getPlaylists = a2Playlists.getList().then(function (playlists) {\n      // add temporary clusters playlist to playlists' array\n      if ($state.params.clusters) {\n        var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n\n        if (clustersData && clustersData.playlist) {\n          playlists.push(clustersData.playlist);\n        }\n      }\n\n      self.playlists = playlists;\n      self.loading.playlists = false;\n    }).then(function () {\n      self.active = true;\n\n      if (self.resolve.pld) {\n        self.resolve.pld.resolve(playlists);\n        delete self.resolve.pld;\n      }\n    }).then(function () {\n      return self.playlists;\n    });\n    return this.getPlaylists;\n  };\n\n  this.deactivate = function () {\n    self.active = false;\n  };\n\n  this.resolve = {};\n\n  this.resolve_link = function (link) {\n    if (link.location) {\n      a2Browser.set_location(link.location);\n    }\n  };\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    return m ? $q.resolve().then(function () {\n      var plid = m[1] | 0,\n          recid = m[3] | 0;\n      return self.getPlaylists.then(function (playlists) {\n        var playlist = self.playlists.filter(function (playlist) {\n          return playlist.id == plid;\n        }).shift();\n\n        if (playlist) {\n          self.playlist = playlist;\n          self.lovo = new a2PlaylistLOVO(playlist);\n          return self.lovo.initialize().then(function () {\n            return a2Browser.setLOVO(self.lovo);\n          }).then(function () {\n            return self.lovo.find(recid);\n          }).then(function (recording) {\n            return recording;\n          });\n        }\n      });\n    }) : $q.resolve();\n  };\n\n  this.get_location = function (recording) {\n    return 'playlist/' + (this.lovo ? this.lovo.playlist.id + (recording ? \"/\" + recording.id : '') : '');\n  };\n\n  this.set_playlist = function (playlist) {\n    this.playlist = playlist;\n\n    if (!self.active) {\n      return;\n    }\n\n    if (self.lovo && self.lovo.playlist.id != playlist.id) {\n      $scope.removeFromLocalStorage();\n    }\n\n    if (playlist && (self.lovo ? self.lovo.playlist != playlist : true)) {\n      self.lovo = new a2PlaylistLOVO(playlist);\n    }\n\n    a2Browser.setLOVO(self.lovo, self.lovo ? \"playlist/\" + self.lovo.playlist.id : '');\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  };\n});","angular.module('a2.browser_recordings_by_site', ['a2.browser_common']).config(function (BrowserLOVOsProvider) {\n  BrowserLOVOsProvider.add({\n    name: 'rec',\n    group: 'recordings',\n    vobject_type: 'recording',\n    default: true,\n    icon: 'fa fa-map-marker',\n    tooltip: 'Browse Recordings by Site',\n    controller: 'a2BrowserRecordingsBySiteController',\n    template: '/app/visualizer/browser/recordings/by-site/recordings-by-site.html'\n  });\n}).factory('rbDateAvailabilityCache', function ($cacheFactory) {\n  return $cacheFactory('recordingsBrowserDateAvailabilityCache');\n}).service('a2RecordingsBySiteLOVO', function ($q, Project, $filter) {\n  var lovo = function (site, date, limit, offset, recording_id) {\n    this.loading = false;\n    this.initialized = false;\n    this.site = site;\n    this.date = date;\n    this.object_type = \"recording\";\n    this.recordingsBySite = true;\n    this.offset = offset || 0;\n    this.limit = limit;\n    this.order = 'datetime';\n    this.count = 0;\n    this.list = [];\n    this.page = 0;\n    this.recording_id = recording_id;\n    this.finished = false;\n  };\n\n  lovo.prototype = {\n    initialize: function () {\n      var d = $q.defer();\n\n      if (this.initialized) {\n        d.resolve(true);\n      } else {\n        return this.loadNext();\n      }\n\n      return d.promise;\n    },\n    updateRecording: function (recording_id) {\n      this.recording_id = recording_id;\n    },\n    getRecordings: function (limit, offset, recording_id) {\n      var d = $q.defer();\n      this.limit = limit, this.offset = offset;\n      var site = this.site,\n          date = this.date;\n      var key = ['!q:' + site.id, date.getFullYear(), date.getMonth() + 1, date.getDate()].join('-');\n      var opts = {\n        show: 'thumbnail-path'\n      };\n\n      if (recording_id === undefined) {\n        opts.limit = limit;\n        opts.offset = offset;\n      }\n\n      ;\n\n      if (recording_id !== undefined) {\n        opts.recording_id = recording_id;\n      }\n\n      ;\n      this.loading = true;\n      Project.getRecordings(key, opts, function (recordings) {\n        recordings = $filter('orderBy')(recordings, 'datetime');\n        recordings.forEach(function (recording) {\n          recording.caption = [recording.site, moment.utc(recording.datetime).format('lll')].join(', ');\n          recording.vaxis = {\n            font: '7px',\n            color: '#333333',\n            range: [0, recording.sample_rate / 2000],\n            count: 5,\n            unit: ''\n          };\n        });\n\n        if (recordings && recordings.length) {\n          // not use infinite-scroll functionality for navigating recording\n          if (recording_id) {\n            if (angular.equals(this.list, recordings)) {\n              this.finished = true;\n            }\n\n            ;\n            this.list = [];\n            this.list = recordings;\n          } else {\n            this.list.push.apply(this.list, recordings);\n            this.page++;\n          }\n        } else {\n          this.finished = true;\n        }\n\n        this.count += recordings.length;\n        this.loading = false;\n        d.resolve(false);\n      }.bind(this));\n      return d.promise;\n    },\n    loadNext: function () {\n      if (this.finished) {\n        return $q.defer().resolve(false);\n      }\n\n      return this.getRecordings(this.limit, this.page * this.limit, this.recording_id);\n    },\n    find: function (recording) {\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      d.resolve(this.list.filter(function (r) {\n        return r.id == id;\n      }).shift());\n      return d.promise;\n    },\n    previous: function (recording) {\n      console.log(\"previous : function(recording){ :: \", recording);\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      Project.getPreviousRecording(id, d.resolve);\n      return d.promise;\n    },\n    next: function (recording) {\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      Project.getNextRecording(id, d.resolve);\n      return d.promise;\n    }\n  };\n  return lovo;\n}).controller('a2BrowserRecordingsBySiteController', function ($scope, a2Browser, rbDateAvailabilityCache, Project, $timeout, $q, a2RecordingsBySiteLOVO) {\n  var project = Project;\n  var self = this;\n  $scope.siteInfo = {};\n  this.sites = [];\n  this.dates = {\n    refreshing: false,\n    max_date: null,\n    min_date: null,\n    display_year: null,\n    date_counts: [],\n    datepickerMode: 'year',\n    cache: rbDateAvailabilityCache,\n    get_counts_for: function (year) {\n      var site = self.site;\n      var site_id = site && site.id;\n\n      if (!site_id) {\n        return true;\n      }\n\n      var key = ['!q:' + site_id, year, '[1:12]'].join('-');\n      var availability = self.dates.cache.get(key);\n\n      if (!availability) {\n        self.dates.fetch_counts(key);\n      } else if (availability.data) {\n        self.dates.date_counts = availability.data;\n      }\n    },\n    fetch_counts: function (key) {\n      self.dates.cache.put(key, {\n        fetching: true\n      });\n      self.loading.dates = true;\n      Project.getRecordingAvailability(key, function (data) {\n        $timeout(function () {\n          var avail = {};\n\n          for (var site in data) {\n            var site_years = data[site];\n\n            for (var year in site_years) {\n              var year_months = site_years[year];\n\n              for (var month in year_months) {\n                var month_days = year_months[month];\n\n                for (var day in month_days) {\n                  var akey = year + '-' + (month < 10 ? '0' : '') + month + '-' + (day < 10 ? '0' : '') + day;\n                  avail[akey] = (avail[akey] | 0) + month_days[day];\n                }\n              }\n            }\n          }\n\n          self.dates.cache.get(key).data = avail || {};\n          self.dates.date_counts = avail;\n          self.loading.dates = false;\n        });\n      });\n    },\n    fetch_year_range: function (site, callback) {\n      var site_id = site && site.id;\n\n      if (!site_id) {\n        return;\n      }\n\n      Project.getRecordingAvailability('!q:' + site_id, function (data) {\n        $timeout(function () {\n          var range = {\n            max: -1 / 0,\n            min: 1 / 0,\n            count: 0\n          };\n\n          for (var site in data) {\n            var site_years = data[site];\n\n            for (var year in site_years) {\n              range.count++;\n              range.min = Math.min(year, range.min);\n              range.max = Math.max(year, range.max);\n            }\n          }\n\n          if (!range.count) {\n            range.max = range.min = new Date().getFullYear();\n          }\n\n          self.dates.min_date = new Date(range.min, 0, 1, 0, 0, 0, 0);\n          self.dates.max_date = new Date(range.max, 11, 31, 23, 59, 59, 999);\n          self.loading.dates = false;\n          callback(range);\n        });\n      });\n    },\n    fetching: false,\n    available: {}\n  };\n  this.loading = {\n    sites: false,\n    dates: false,\n    records: false\n  };\n  this.auto = {};\n  this.site = null;\n  this.date = null;\n  this.lovo = null;\n  $scope.limit = 10;\n\n  this.activate = function () {\n    var defer = $q.defer();\n    self.loading.sites = true;\n    project.getSites({\n      count: true,\n      logs: true\n    }, function (sites) {\n      self.sites = sites;\n      self.loading.sites = false;\n      $timeout(function () {\n        self.active = true;\n        defer.resolve(sites);\n      });\n    });\n    return defer.promise;\n  };\n\n  this.deactivate = function () {\n    var defer = $q.defer();\n    defer.resolve();\n    self.active = false;\n    return defer.promise;\n  }; // Preselect of a site and a date from navigation URL\n\n\n  this.auto_select = function (recording) {\n    if (recording) {\n      var utcdateaslocal = new Date(recording.datetime);\n      var recdate = new Date(utcdateaslocal.getTime() + utcdateaslocal.getTimezoneOffset() * 60 * 1000);\n      self.auto = {\n        site: self.sites.filter(function (s) {\n          return s.name == recording.site;\n        }).pop(),\n        date: new Date(recdate.getFullYear(), recdate.getMonth(), recdate.getDate(), 0, 0, 0, 0)\n      };\n\n      if (self.site != self.auto.site) {\n        self.set_site(self.auto.site);\n      } else if (self.date != self.auto.date) {\n        self.set_date(self.auto.date);\n      } else {\n        a2Browser.setLOVO(make_lovo());\n      }\n    }\n  };\n\n  this.resolve_location = function (location) {\n    var defer = $q.defer();\n\n    if (location) {\n      var site_match = /^site(\\/(\\d+)(\\/([^/]+))?)?/.exec(location);\n\n      if (site_match) {\n        var site = site_match[2] | 0,\n            query = site_match[4];\n\n        if (site) {\n          var key = '!q:' + site + (query ? '-' + query : '');\n          Project.getRecordings(key, function (recordings) {\n            defer.resolve(recordings && recordings.pop());\n          }.bind(this));\n        } else {\n          defer.resolve();\n        }\n      } else {\n        Project.getOneRecording(location, function (recording) {\n          defer.resolve(recording);\n        });\n      }\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (recording) {\n    return 'rec/' + recording.id;\n  };\n\n  var make_lovo = function () {\n    var site = self.site;\n    var date = self.date;\n\n    if (site && date) {\n      // Create current browser state for the one recording in the list of recordings\n      if ($scope.browser.currentRecording) {\n        self.lovo = new a2RecordingsBySiteLOVO(site, date, null, null, Number($scope.browser.currentRecording));\n      } else {\n        self.lovo = new a2RecordingsBySiteLOVO(site, date, $scope.limit);\n      }\n    }\n\n    return self.lovo;\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    $scope.scrollElement = $controller.scrollElement;\n    var scrollTop = $controller.scrollElement.scrollTop();\n    var scrollHeight = $controller.scrollElement[0].scrollHeight;\n    var elementHeight = $controller.scrollElement.height();\n    var diff = scrollTop + elementHeight > scrollHeight * 0.9;\n\n    if (diff) {\n      if (!self.lovo) return;\n      if (self.lovo && self.lovo.loading === true) return;\n      if ($scope.browser.currentRecording && $scope.browser.annotations) return;\n      if (self.lovo.list && self.lovo.list.length < 7) return;\n      self.lovo.loadNext();\n    }\n  };\n\n  this.set_dates_display_year = function (new_display_year) {\n    this.dates.display_year = new_display_year;\n\n    if (!this.active) {\n      return;\n    }\n\n    this.dates.get_counts_for(new_display_year);\n  };\n\n  this.set_site = function (newValue) {\n    this.site = $scope.siteInfo.site = newValue;\n\n    if (!this.active) {\n      return;\n    }\n\n    this.recordings = []; // reset the selections and stuff\n\n    this.date = null;\n    a2Browser.recording = null; // setup auto-selection\n\n    var auto_select = this.auto && this.auto.date;\n\n    if (auto_select) {\n      this.auto.date = null;\n      this.set_date(auto_select);\n    } // reset date picker year range and counts\n\n\n    this.dates.fetch_year_range(newValue, function (year_range) {\n      $timeout(function () {\n        self.dates.display_year = year_range.max;\n        self.dates.get_counts_for(self.dates.display_year);\n      });\n    });\n  };\n\n  this.set_date = function (date) {\n    if (!self.active) {\n      return;\n    }\n\n    this.yearpickOpen = false;\n    var site = this.site;\n    this.date = $scope.siteInfo.date = date;\n\n    if (site && date) {\n      var isNewSiteAndDate = function () {\n        return this.lovo && date && this.lovo.date && date.getTime() === this.lovo.date.getTime() && site.id === this.lovo.site.id;\n      };\n\n      if (isNewSiteAndDate()) {\n        a2Browser.setLOVO(self.lovo);\n      } else {\n        a2Browser.setLOVO(make_lovo()).then(function () {\n          $scope.browser.currentRecording = null;\n          $scope.browser.annotations = null;\n        });\n      }\n    }\n  };\n});","angular.module('a2.visualizer.layers.soundscapes.info', ['visualizer-services', 'a2.utils', 'a2.soundscapeRegionTags', 'a2.url-update-service', 'a2.directives', 'a2.directive.a2-palette-drawer', 'a2.service.colorscale-gradients']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.soundscapes.info.object:soundscape-info-layer\n   * @description Soundscape Info layer. \n   * adds the soundscape-info-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.soundscapes.info.controller:a2VisualizerSoundscapeInfoLayerController as controller,\n   * and requires a visobject of type soundscape to be selected.\n   * The layer has a visibility button.\n   * The layer does not have an associated spectrogram layer.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-info-layer\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeInfoLayerController as info',\n    require: {\n      type: 'soundscape',\n      browsetype: 'soundscape',\n      selection: true\n    },\n    display: {\n      spectrogram: false\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerSoundscapeInfoLayerController', function ($scope, $modal, $location, a2Soundscapes, a2UserPermit, notify) {\n  var self = this;\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, item) {\n      _[item.value] = item;\n      return _;\n    }, {});\n  }.bind(this));\n\n  this.edit_visual_scale = function (soundscape) {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to edit soundscapes');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/soundscapes/info/edit_soundscape_visual_scale_modal.html',\n      controller: 'a2VisualizerSampleSoundscapeInfoEditVisualScaleModalController as controller',\n      // size        : 'sm',\n      resolve: {\n        amplitudeReferences: function (a2Soundscapes) {\n          return a2Soundscapes.getAmplitudeReferences();\n        },\n        data: function () {\n          return {\n            soundscape: soundscape\n          };\n        }\n      }\n    }).result.then(function () {/// TODO::: aaa\n    });\n  };\n}).controller('a2VisualizerSampleSoundscapeInfoEditVisualScaleModalController', function ($scope, $modalInstance, a2Soundscapes, amplitudeReferences, data, a2UrlUpdate, ColorscaleGradients) {\n  var soundscape = data.soundscape;\n  $scope.soundscape = soundscape;\n  $scope.palettes = ColorscaleGradients.gradients;\n  $scope.data = {\n    palette: soundscape.visual_palette,\n    visual_max: soundscape.visual_max_value || soundscape.max_value,\n    normalized: !!soundscape.normalized,\n    amplitudeThreshold: soundscape.threshold,\n    amplitudeReference: amplitudeReferences.reduce(function (_, item) {\n      return _ || (item.value == soundscape.threshold_type ? item : null);\n    }, null)\n  };\n  this.amplitudeReferences = amplitudeReferences;\n\n  $scope.ok = function () {\n    a2Soundscapes.setVisualizationOptions(soundscape.id, {\n      max: $scope.data.visual_max,\n      palette: $scope.data.palette,\n      normalized: $scope.data.normalized,\n      amplitude: $scope.data.amplitudeThreshold,\n      amplitudeReference: $scope.data.amplitudeReference.value\n    }, function (sc) {\n      if (soundscape.update) {\n        soundscape.update(sc);\n      }\n\n      a2UrlUpdate.update(soundscape.thumbnail);\n      $modalInstance.close();\n    });\n  };\n\n  console.log($scope);\n}).directive('a2SoundscapeDrawer', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    template: '<canvas class=\"soundscape\"></canvas>',\n    scope: {\n      soundscape: '&',\n      normalized: '&',\n      amplitudeThreshold: '&',\n      amplitudeThresholdType: '&',\n      palette: '&',\n      visualMax: '&'\n    },\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var scidx;\n      var soundscape;\n      var norm_vector;\n\n      var draw = function () {\n        if (!soundscape || !scidx) {\n          return;\n        }\n\n        var vmax = $scope.visualMax() || soundscape.max_value;\n        var ampTh = $scope.amplitudeThreshold && $scope.amplitudeThreshold() || 0;\n\n        if ($scope.amplitudeThresholdType() == 'relative-to-peak-maximum') {\n          var maxAmp = getMaxAmplitude();\n          ampTh *= maxAmp;\n        }\n\n        var pal = $scope.palette();\n\n        if (!pal || !pal.length) {\n          return;\n        }\n\n        var pallen1 = 1.0 * (pal.length - 1);\n\n        var color = function (v) {\n          var i = Math.max(0, Math.min(v * pallen1 / vmax | 0, pallen1));\n          return pal[i];\n        };\n\n        if (norm_vector) {\n          vmax = 1;\n          var _cl = color;\n\n          color = function (v, j) {\n            var n = norm_vector[j] || 1;\n            return _cl(v / n);\n          };\n        }\n\n        var w = scidx.width,\n            h = scidx.height;\n        $element.attr('width', w);\n        $element.attr('height', h);\n        var ctx = $element[0].getContext('2d');\n        ctx.fillStyle = color(0);\n        ctx.fillRect(0, 0, w, h);\n\n        for (var i in scidx.index) {\n          var row = scidx.index[i];\n\n          for (var j in row) {\n            var cell = row[j];\n\n            if (ampTh && cell[1]) {\n              var act = 0;\n\n              for (var al = cell[1], ali = 0, ale = al.length; ali < ale; ++ali) {\n                if (al[ali] > ampTh) {\n                  ++act;\n                }\n              }\n\n              ctx.fillStyle = color(act, j);\n            } else {\n              ctx.fillStyle = color(cell[0], j);\n            }\n\n            ctx.fillRect(j, h - i - 1, 1, 1);\n          }\n        }\n      };\n\n      var getMaxAmplitude = function () {\n        if (scidx.__maxAmplitude === undefined) {\n          scidx.__maxAmplitude = Object.keys(scidx.index).reduce(function (maxAmp, i) {\n            var row = scidx.index[i];\n            return Object.keys(row).reduce(function (maxAmp, j) {\n              var cellMax = Math.max.apply(Math, row[j][1] || [0]);\n              return Math.max(cellMax, maxAmp);\n            }, maxAmp);\n          }, 0);\n          console.log(\"scidx.__maxAmplitude\", scidx.__maxAmplitude);\n        }\n\n        return scidx.__maxAmplitude;\n      };\n\n      $scope.$watch('soundscape()', function (_soundscape) {\n        soundscape = _soundscape;\n        if (soundscape) a2Soundscapes.getSCIdx(soundscape.id, {\n          count: 1\n        }).then(function (_scidx) {\n          scidx = _scidx;\n          draw();\n        });\n      });\n      $scope.$watch('normalized()', function (_normalized) {\n        if (!_normalized) {\n          norm_vector = null;\n          draw();\n        } else {\n          if (norm_vector) {\n            draw();\n          } else {\n            a2Soundscapes.getNormVector(soundscape.id).then(function (_norm_vector) {\n              norm_vector = _norm_vector;\n              draw();\n            });\n          }\n        }\n      });\n      $scope.$watch('palette()', draw);\n      $scope.$watch('amplitudeThreshold()', draw);\n      $scope.$watch('amplitudeThresholdType()', draw);\n      $scope.$watch('visualMax()', draw);\n    }\n  };\n});","angular.module('a2.visualizer.layers.soundscapes.regions', ['visualizer-services', 'a2.utils', 'a2.soundscapeRegionTags']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.soundscapes.regions.object:soundscape-regions-layer\n   * @description Soundscape Regions layer. \n   * adds the soundscape-regions-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.soundscapes.regions.controller:a2VisualizerSoundscapeRegionsLayerController as controller,\n   * and requires a visobject of type soundscape to be selected.\n   * The layer has a visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-regions-layer\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeRegionsLayerController as soundscape',\n    require: {\n      type: 'soundscape',\n      browsetype: 'soundscape',\n      selection: true\n    },\n    visible: true // hide_visibility : true\n\n  });\n}).controller('a2VisualizerSoundscapeRegionsLayerController', function ($scope, $modal, $location, a2Soundscapes, a22PointBBoxEditor, a2UserPermit, notify) {\n  var self = this;\n\n  var bbox2string = function (bbox) {\n    var x1 = bbox.x1 | 0;\n    var y1 = bbox.y1 | 0;\n    var x2 = bbox.x2 | 0;\n    var y2 = bbox.y2 | 0;\n    return x1 + ',' + y1 + '-' + x2 + ',' + y2;\n  };\n\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, item) {\n      _[item.value] = item;\n      return _;\n    }, {});\n  }.bind(this));\n  this.show = {\n    names: true,\n    tags: true\n  };\n\n  this.view_playlist = function (region) {\n    console.log(\"this.view_playlist = function(region){\", region);\n\n    if (region.playlist) {\n      $scope.set_location(\"playlist/\" + region.playlist);\n    }\n  };\n\n  this.query = function (bbox) {\n    if (!self.selection.valid) {\n      return;\n    }\n\n    a2Soundscapes.getRecordings(self.soundscape, bbox2string(bbox), {\n      count: 1,\n      threshold: 1\n    }, function (data) {\n      bbox.q = data;\n    });\n  };\n\n  this.submit = function (bbox, name) {\n    if (!self.selection.valid) {\n      return;\n    }\n\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to annotate soundscapes');\n      return;\n    }\n\n    a2Soundscapes.addRegion(self.soundscape, bbox2string(bbox), {\n      name: name,\n      threshold: 1\n    }, function (data) {\n      self.regions.push(data);\n      self.selection.bbox = data;\n    });\n  };\n\n  this.sample = function (bbox, percent) {\n    if (!bbox.id) {\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/soundscapes/regions/sample_soundscape_region_modal.html',\n      controller: 'a2VisualizerSampleSoundscapeRegionModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            soundscape: self.soundscape,\n            region: bbox\n          };\n        }\n      }\n    }).result.then(function (region) {\n      if (region && region.id) {\n        self.regions.forEach(function (r, idx) {\n          if (r.id == region.id) {\n            self.regions[idx] = region;\n          }\n        });\n        self.selection.bbox = region;\n      }\n    });\n  };\n\n  this.selection = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.percent = 100;\n      return this;\n    },\n    quantize: function (x, y, ceil) {\n      var q = ceil ? Math.ceil : Math.floor;\n      var xi = $scope.visobject.domain.x.unit_interval;\n      var yi = $scope.visobject.domain.y.unit_interval;\n      return [q(x / xi) * xi, q(y / yi) * yi];\n    },\n    add_tracer_point: function (x, y) {\n      this.super.add_tracer_point.apply(this, this.quantize(x, y));\n      return this;\n    },\n    add_point: function (x, y) {\n      this.super.add_point.apply(this, this.quantize(x, y));\n      return this;\n    },\n    validate: function (tmp_points) {\n      this.super.validate.call(this, tmp_points);\n      var q = this.quantize(this.bbox.x2 + 0.1, this.bbox.y2 + 0.1, true);\n      this.bbox.y2 = q[1];\n      this.selbox = {\n        x1: this.bbox.x1,\n        y1: this.bbox.y1,\n        x2: q[0],\n        y2: q[1]\n      };\n    },\n    query: function () {\n      self.query(this.bbox);\n    },\n    submit: function () {\n      self.submit(this.bbox, this.bbox.name);\n    },\n    sample: function () {\n      self.sample(this.bbox, this.percent);\n    },\n    view_samples: function () {\n      self.view_playlist(this.bbox);\n    },\n    select: function (region) {\n      this.bbox = region;\n\n      if ($scope.visobject && $scope.visobject.id && region && region.id) {\n        $scope.set_location('soundscape/' + $scope.visobject.id + '/' + region.id, true);\n      }\n    }\n  });\n  $scope.$watch('visobject', function (visobject) {\n    var sc = visobject && visobject.type == 'soundscape' && visobject.id;\n\n    if (sc) {\n      self.soundscape = sc;\n      self.selection.reset();\n      a2Soundscapes.getRegions(sc, {\n        view: 'tags'\n      }, function (regions) {\n        self.regions = regions;\n\n        if (visobject.extra && visobject.extra.region) {\n          self.selection.bbox = self.regions.filter(function (r) {\n            return r.id == visobject.extra.region;\n          }).pop();\n        }\n      });\n    } else {\n      self.soundscape = 0;\n    }\n  });\n}).controller('a2VisualizerSampleSoundscapeRegionModalController', function ($scope, $modalInstance, a2Soundscapes, data) {\n  $scope.soundscape = data.soundscape;\n  $scope.region = data.region;\n  $scope.data = {\n    percent: 100\n  };\n\n  $scope.ok = function () {\n    $scope.validation = {\n      count: 0\n    };\n    var sdata = $scope.data,\n        sval = $scope.validation;\n    var vdata = {};\n    var tst;\n\n    if (sdata.percent > 100) {\n      sval.percent = \"Percent must be between 0% and 100%.\";\n      sval.count++;\n    } else if ((sdata.percent * $scope.region.count | 0) < 1) {\n      sval.percent = \"You must sample at least 1 recording.\";\n      sval.count++;\n    } else {\n      vdata.percent = sdata.percent;\n    }\n\n    $scope.form_data = vdata;\n\n    if (sval.count === 0) {\n      a2Soundscapes.sampleRegion($scope.soundscape, $scope.region.id, vdata, function (region) {\n        $modalInstance.close(region);\n      });\n    }\n  };\n});"]}