{"version":3,"sources":["admin.js","app.js","citizen-scientist.js","home.js","login.js","orders.js","register.js","reset-password.js","user-settings.js","visualizer.js","a2services/api-service.js","a2services/audio-event-detection-service.js","a2services/audio-event-detections-clustering-service.js","a2services/citizen-scientist-admin-service.js","a2services/citizen-scientist-expert-service.js","a2services/citizen-scientist-service.js","a2services/classi-service.js","a2services/clustering-jobs-service.js","a2services/cnn-service.js","a2services/download-resource.js","a2services/index.js","a2services/local-store.js","a2services/models-service.js","a2services/news-service.js","a2services/open-modal.js","a2services/patternmatching-service.js","a2services/playlists-service.js","a2services/project-service.js","a2services/promised-resolve.js","a2services/serialize-promised-fn.js","a2services/sites-service.js","a2services/soundscape-composition.js","a2services/soundscapes-service.js","a2services/species-service.js","a2services/tags-service.js","a2services/templates-service.js","a2services/training-sets-service.js","a2services/uploads-service.js","a2services/users-service.js","filters/a2-filters.js","filters/as-csv.js","filters/caps.js","filters/page-number-to-title.js","filters/page-title-to-number.js","filters/project-url.js","filters/range.js","filters/round.js","filters/time-from-now.js","orders/change-project-plan.js","orders/create-project.js","orders/order-summary.js","orders/order-utils.js","orders/orders-service.js","orders/plan-capacity.js","orders/plan-selection.js","orders/process-order.js","orders/project-order-service.js","orders/shipping-form.js","orders/tier-select.js","directives/a2-auto-close-on-outside-click.js","directives/a2-dropdown.js","directives/a2-on-resize.js","directives/a2-palette-drawer.js","directives/a2-percentage-bars.js","directives/a2-require-non-empty.js","directives/a2-sidenav.js","directives/a2-table.js","directives/a2-tags.js","directives/a2directives.js","directives/a2forms.js","directives/a2qrjs.js","directives/c3-charts.js","directives/error-message.js","directives/frequency_filter_range_control.js","directives/g-recaptcha.js","directives/news-feed-item.js","directives/plotly-plotter.js","directives/search-bar.js","directives/validation-dropdown.js","directives/warning-banner.js","services/a2gmaps.js","services/a2heremaps.js","services/a2permissions.js","services/a2utils-browser-metrics.js","services/a2utils.js","services/app-listings.js","services/colorscale-gradients.js","services/countries.js","services/humane.js","services/plot-maker.js","services/plot-specs.js","services/plotly-defaults.js","services/url-updater-service.js","utils/external-api-loader.js","utils/global-anonymous-function.js","utils/q-promisify.js","admin/jobs/index.js","admin/dashboard/data-service.js","admin/dashboard/index.js","admin/dashboard/plotter-controller.js","admin/projects/codes.js","admin/projects/index.js","admin/projects/list.js","admin/users/list.js","app/analysis/index.js","app/audiodata/index.js","app/audiodata/sites.js","app/audiodata/soundscape-composition-classes.js","app/audiodata/species.js","app/audiodata/training-sets.js","app/citizen-scientist/index.js","app/dashboard/index.js","app/jobs/index.js","app/settings/index.js","app/visualizer/audioplayer.js","app/visualizer/layers.js","app/visualizer/services.js","app/visualizer/soundscape-tags.js","app/visualizer/spectrogram.js","app/visualizer/validator.js","app/visualizer/visualizer-sidebar.js","app/visualizer/visualizer.js","app/visualizer/zoom.js","directives/a2-audio-bar/a2-audio-bar.js","directives/a2-switch/index.js","directives/external/facebook-login-button.js","directives/external/google-login-button.js","app/analysis/audio-event-detection/index.js","app/analysis/audio-event-detection/new-modal.js","app/analysis/audio-event-detections-clustering/index.js","app/analysis/clustering-jobs/index.js","app/analysis/cnn/index.js","app/analysis/patternmatching/index.js","app/analysis/random-forest-models/index.js","app/analysis/soundscapes/index.js","app/audiodata/playlists/playlist-arithmetic.js","app/audiodata/playlists/playlists.js","app/audiodata/recordings/data-export-parameters.js","app/audiodata/recordings/filter-parameters.js","app/audiodata/recordings/recordings.js","app/audiodata/templates/templates.js","app/audiodata/uploads/index.js","app/audiodata/uploads/processing.js","app/audiodata/uploads/upload.js","app/citizen-scientist/admin/index.js","app/citizen-scientist/expert/index.js","app/citizen-scientist/my-stats/index.js","app/citizen-scientist/patternmatching/index.js","app/visualizer/browser/browser.js","app/visualizer/browser/common.js","app/visualizer/dialog/dialog.js","app/visualizer/layers/recording-tags-layer.js","app/visualizer/layers/soundscape-compositions-tool.js","app/visualizer/layers/templates.js","app/visualizer/visobjects/audio-event-detection.js","app/visualizer/visobjects/common.js","app/visualizer/visobjects/recording.js","app/visualizer/visobjects/soundscape.js","app/visualizer/visobjects/visobjects.js","app/analysis/random-forest-models/classification/index.js","app/analysis/random-forest-models/models/index.js","app/citizen-scientist/admin/classification-stats/index.js","app/citizen-scientist/admin/settings/index.js","app/citizen-scientist/admin/user-stats/index.js","app/visualizer/browser/audio-event-detections/audio-event-detections.js","app/visualizer/browser/recordings/recordings.js","app/visualizer/browser/soundscapes/soundscapes.js","app/visualizer/layers/annotation-layer/annotation-layer.js","app/visualizer/layers/audio-events-layer/audio-events-layer.js","app/visualizer/layers/data-plot-layer/data-plot-layer.js","app/visualizer/layers/base-image-layer/base-image-layer.js","app/visualizer/layers/recording-soundscape-region-tags/recording-soundscape-region-tags.js","app/visualizer/layers/recordings/recordings.js","app/visualizer/layers/soundscapes/soundscapes.js","app/visualizer/layers/zoom-input-layer/zoom-input-layer.js","app/visualizer/layers/training-data/roi-set.js","app/visualizer/layers/training-data/training-sets.js","app/visualizer/layers/species-presence/species-presence.js","app/visualizer/browser/recordings/by-playlist/recordings_by_playlist.js","app/visualizer/browser/recordings/by-site/recordings_by_site.js","app/visualizer/layers/soundscapes/info/soundscape-info.js","app/visualizer/layers/soundscapes/regions/soundscape-regions.js"],"names":["angular","module","controller","$scope","$state","e","console","error","provider","this","setEventHandlers","$get","service","init","filter","a2","run","$rootScope","Angularytics","a2UserPermit","notify","Math","$on","to","params","name","startsWith","document","getElementsByTagName","classList","add","remove","isFunction","allowAccess","allowed","undefined","preventDefault","go","config","$urlRouterProvider","$locationProvider","AngularyticsProvider","a2GoogleMapsLoaderProvider","a2InjectedData","setAPIKey","googleAPI","key","html5Mode","otherwise","Project","$window","getInfo","data","bioAnalyticsBaseUrl","reportsEnabled","reports_enabled","getUrlFor","page","projectUrl","getUrl","citizenScientistUser","all","length","includes","can","isSuper","isAppPage","location","pathname","onCitizenScientistPage","title","getData","$http","get","then","projects","recordings","description","jobs","species","$localStorage","a2order","$q","$injector","homeSummaryStatsData","getSummaryData","summary_item","resolve","invoke","getProjectSelectCache","JSON","parse","getItem","setProjectSelectCache","psCache","setItem","stringify","summaryDataLoading","list_summary_data","summary_data","map","allData","bind","isExplorePage","loadProjectList","isFeatured","isAnonymousGuest","isMyProjects","include_location","publicTemplates","featured","type","isLoading","highlightedProjects","success","forEach","p","lastAccessed","id","lat","lon","zoom","mapUrl","mapbox_access_token","item","project","url","projectTemplates","templatesTotal","count","recCount","speciesCount","createProject","result","message","log","selectProject","is_enabled","Date","getTime","assign","valueShortScale","value","Number","toString","substring","numeral","format","$modal","login","path","search","post","username","password","captcha","captchaResp","captchaNeeded","showCaptcha","resetCaptcha","redirect","oAuthLogin","user","oauthData","token","getAuthResponse","id_token","authResponse","accessToken","response","catch","status","showEnableOAuthModal","modalData","open","templateUrl","oauthType","messages","authorizeMessage","btnOk","btnCancel","controllerAs","authorized","extend","authorize","hash","loginUrl","encodeURIComponent","$timeout","$interval","testUsername","usernameOk","usernameErr","testUserTimeout","cancel","regis","$error","required","pattern","available","testEmail","emailOk","emailErr","testEmailTimeout","email","invalid","register","$event","passResult","valid","terms_accepted","captchaNotNeeded","loading","newsletter","completed","msg","changePassword","request","requestComplete","reset","copy","save","userData","lastname","oauth","err","serverError","factory","$location","returnData","a2APIServiceClass","prefix","prototype","apiRoute","when","delete","put","nrm","exec","absUrl","projectName","apiURLPrefix","a2APIService","api","getProjectName","getList","getAlgorithmsList","getStatisticsList","getDataStatisticsList","getDataAggregatesList","getDataFor","aed","x","y","z","args","statistic","join","savePlotFor","new","defaultName","algorithm","parameters","statistics","playlist","list","opts","callback","create","validate","unvalidate","jobId","getClassificationStats","speciesId","getUserStats","userId","getUserStatsExportUrl","getCSExportUrl","pattern_matching_id","per_user","filename","getSettings","setSettings","settings","getPatternMatchings","getPatternMatchingDetailsFor","patternMatchingId","getPatternMatchingRoisFor","limit","offset","options","query","Object","keys","option","validatePatternMatchingRois","rois","validation","patternMatching","getMyStats","saveData","saveState","getState","getDetails","classificationId","getResultDetails","first","getRecVector","recId","classificationData","$httpParamSerializer","getJobDetails","clusteringJobId","getClusteringDetails","job_id","getRoisDetails","rec_id","perSite","perDate","exportClusteringROIs","getAudioUrlFor","aedId","audioEventDetections","listROIs","species_id","site_id","listROIsBySpecies","listResults","listModels","getDetailsFor","cnnId","getRoisFor","countROIsBySpecies","countROIsBySites","countROIsBySpeciesSites","getExportUrl","roi","cnn_result_roi_id","validateRois","resource_url","a","element","attr","appendTo","setTimeout","click","localStorage","openedModel","modelState","s","isModelOpen","getFormInfo","findById","modelId","modelData","getValidationResults","setThreshold","thresholdValue","m","t","loadPage","index","loadFormats","$openModalProvider","defs","define","modalName","modalDef","overrides","getPatternMatchingsTotal","getSitesListFor","fileName","cls","update","filterPlaylistLimit","playlistParams","$emit","combine","expression","getRecordingPosition","recording","r","getPreviousRecording","getNextRecording","rename","playlistIds","playlists","method","event","handler","attachAedToPlaylist","playlist_id","nameRe","getProjectById","projectId","project_id","updateInfo","info","getUsage","getSites","getClasses","getRecs","tags","flat","getRecCounts","project_url","getRecordingData","filters","projection","range","from","moment","show","grouped","getSitesExportUrl","getRecTotalQty","getProjectTotalSpecies","getProjectTimeBounds","getRecordings","Function","getRecordingAvailability","getOneRecording","getRecordingInfo","validateRecording","recExists","exists","downloadRecording","addClass","projectClass","removeClasses","projectClasses","getUsers","getRoles","addUser","removeUser","changeUserRole","getModels","getClassi","validationsCount","validationBySpeciesSong","songtypeId","sound_id","getProjectsList","ownershipType","removeProject","resolveMap","context","fn","series","Array","slice","call","arguments","apply","listPublished","import","site","sites","getLogFiles","getSiteLogDataDates","d","defer","reject","promise","getSiteLogDataUrl","period","test","getSiteLogData","rows","trim","split","line","getListOfAssets","generateToken","revokeToken","getClassList","tally","isSystemClass","groupByType","reduce","_","typeId","push","removeClass","scClassid","getAnnotationsFor","visobject","annotate","annotation","Error","getAmplitudeReferences","caption","soundscapeId","getSCIdx","getNormVector","getList2","setVisualizationOptions","addRegion","bbox","sampleRegion","region","soundscape","soundscape_id","raw","getRegion","getRecordingTags","addRecordingTag","tag","removeRecordingTag","getRegions","findIndices","soundscapeData","q","songs","searchId","song","songtype_id","speciesTaxons","isTaggableType","isTaggableResource","obj","getFor","getForType","resourceType","deleteFor","tagId","addFor","tag_id","text","t0","f0","t1","f1","showRecordingUri","taxon","template_data","template","templateId","getImage","tset_data","edit","trainingSetId","addData","recording_uri","getDataImage","dataId","getTypes","getRois","getSpecies","removeRoi","roiId","getProcessingList","checkStatus","items","getInfoForId","user_id","delimiter","v","input","replace","toUpperCase","page_number","page_title","isFinite","step","sign","stepSign","i","val","precision","fmt","fromNow","orderData","$modalInstance","a2orderUtils","today","recorderQty","getOrdersContact","ordersContact","paymentsStatus","autoPaymentsEnabled","payments_enable","currentPlan","storage","storage_limit","processing","processing_limit","duration","plan_period","tier","activation","plan_activated","creation","plan_created","due","setFullYear","getFullYear","mode","plan","usage","minUsage","min_usage","upgrade","action","enterShippingAddress","reviewOrder","dismiss","ProjectOrderService","isValid","makeOrder","order","hasCoupon","isPaidProject","placeOrder","close","address","shipping","changeItems","changePlan","editAddress","submit","waiting","approvalUrl","monthsUntilDue","acticationDate","currentMonth","totalMonths","getMonth","getDate","cache","checkCouponCode","code","recorder","priceWithPlan","priceNoPlan","formOpener","view","modalOptions","backdrop","directive","restrict","scope","disabled","minutes","link","attrs","enabled","freePlan","cost","coupon","class","payload","recorderOptions","planMinutes","planYears","upgradeOnly","hasCouponCode","planData","yearOptions","$watch","updatePlan","planStarts","monthsLeft","ceil","recorderCap","floor","availablePlans","reOrderId","orderId","invoice","item_list","amount","number","orderNumber","shipping_address","notFound","needApproval","approvalLink","alreadyProcessed","errorOcurred","$filter","currencyFilter","merge","freeProjectLimit","nameExists","urlExists","recorderCost","projectCostLimit","countries","verify","shipping_cost","disableFree","$document","getElementPath","ancestors","parentElement","require","$attrs","dropdownController","closeDropdown","evt","isOpen","target","htmlIdx","indexOf","documentElement","toggleElementIdx","toggleElement","elementIdx","dropdownMenu","toggle","$$phase","$apply","$set","unbind","$compile","masterTemplate","compile","tpl","cloneNode","itemTpl","children","selectedItemTpl","elementHtml","html","append","empty","compiledTpl","clone","linkElement","ngModelCtrl","select","$selectedItem","$setViewValue","$render","$viewValue","Watcher","watchers","watch","scheduleAnimationFrame","animationFramePending","triggered","watcher","width","clientWidth","height","clientHeight","destroy","splice","requestAnimationFrame","newWatcher","$parse","a2OnResizeService","onResize","a2OnResize","newSize","a2Soundscapes","palette","$element","draw","pal","ctx","getContext","fillStyle","fillRect","a2SidenavBarService","total","colors","DEFAULT_COLORS","numberFilter","getColorClass","getTotal","b","asPercent","rounding","elm","ctrl","$validators","modelValue","viewValue","$isEmpty","$observe","$validate","enableSidenavBar","disableSidenavBar","$log","a2EventEmitter","SidenavBar","events","getSidenavBar","enable","emit","disable","on","listener","off","registerAnchor","onEnabled","onDisabled","bar","sidebar","unregisterAnchor","nodeName","toLowerCase","_name","$templateCache","compileFields","toArray","field","detach","tdclass","content","tooltip","compileSelectExpand","selectExpand","fieldCount","find","$","selected","onSelect","onCheck","checked","dateFormat","numberDecimals","tplHead","tplFilters","tplBody","hasFilters","fields","hasCheckbox","noCheckbox","hasSelection","noSelect","a2TableCtrl","tableScope","$parent","$new","row","initialize","a2TableController","noCheck","sortKey","defaultSort","updateChecked","setRows","cmpel","$destroy","__onSelect","__onCheck","onFilterChanged","shift","keycomp","visible","toggleAll","allFalse","checkall","check","$index","lastChecked","shiftKey","keyboardSel","sel","currentTarget","after","sortBy","fieldIndex","sort","reverse","a2TagsModule","linkTo","tagType","tcTag","_0","_1","_2","tagName","tagLink","tagElement","closest","hide","expr","UP_PARENT_SPECIAL","times","createPseudo","seed","matches","_3","_4","dups","nodeType","parentNode","di","de","match","needsContext","RegExp","source","onkeyup","mkFunction","locals","a2InfiniteScrollDistance","a2InfiniteScrollDisabled","a2InfiniteScrollImmediateCheck","pscope","fnBind","fnUnbind","a2Scroll","a2ScrollOn","scrollElement","a2InfiniteScroll","a2InfiniteScrollRefraction","scrollHandler","dispose","anchors","addAnchor","anchorElement","removeAnchor","$controller","scrollHeight","scrollTop","time","refraction","a2ScrollController","counter","poc","tElement","tAttrs","_$persistence_","ptag","persisted","_$persistence_tag_","stopPropagation","$broadcast","updateHeight","h","top","resize","hideText","d3","ngModel","maxDate","minDate","year","dateCount","onYearChanged","onDateChanged","disableEmpty","setYear","old_year","setDate","date","old_date","popup","is_a_popup","insertAfter","css","weekOfMonth","firstDay","monthOffset","getDay","monthName","format2Date","txt","computeMax","computeMin","days","svg","cal","legend","prev","next","scale","labels","icon","threshold","domain","selectAll","enter","cubesize","drawCounts","classed","hasClass","calendar","exit","mon","months","computeMaxMinDateFromCounts","dateCounts","stats","dateFmt","min","max","$attr","img","new_src","image","Image","onload","src","a2TrainingSets","trainingSet","datum","resolve_null_uri","urikey","resolving","datum2","uri","anchor","keep_position","a2KeepPosition","a2InsertIn","replaceChild","reposition_element","comp_pos","el","po","offsetParent","ao","position","left","parents","each","$e","scroll","is","visibility","drawChart","padding","right","bottom","getY","getX","yMin","yMax","tMin","tMax","lineColor","xScale","linear","yScale","interpolate","symbol","xAxis","axis","ticks","yAxis","orient","dataG","totalLength","node","getTotalLength","transition","delay","ease","body","coords","mouse","style","round","values","color","normalize","columns","c3","makeChart","axes","celem","bindto","generate","chart","o","n","load","addSaveBtn","wrap","parentEl","parent","saveBtn","onDirtySaveFN","$name","$modelValue","$setPristine","removeSaveBtn","unwrap","a2BsNgModelOnDirtySaveButton","$viewChangeListeners","$dirty","dataURIToBinaryBuffer","dataURI","base64Index","base64","atob","rawLength","array","Uint8Array","ArrayBuffer","charCodeAt","buffer","getCanvasBlob","canvas","toBlob","blob","toDataURL","BlobBuilder","WebKitBlobBuilder","bb","getBlob","Blob","createObjectURL","URL","revokeObjectURL","webkitURL","revoke","canvasObjectURL","$debounce","computeHash","w","createAxisData","prec","unit","dTick","w1","h1","font","strokeStyle","lineWidth","clearRect","lblSize","loopCt","tW","measureText","textAlign","textBaseline","beginPath","moveTo","lineTo","stroke","strokeText","drawAxisOnImg","axisDataPromise","promiseCache","axisData","elementSize","redrawAxis","selector","targetpos","pageX","pageY","onErrorSrc","loadZXCVBN","createElement","async","insertBefore","attachEvent","addEventListener","userInputs","getValidation","confirm","requiredScore","minLength","maxLength","testConfirm","pass","score","ok","testPass","zxcvbn","waitForZxcvbn","mesgs","size","shields","urlPattern","deriveUrlFromName","nameChanged","urlChanged","good","errorName","errorUrl","is_private","qr","level","imgSrc","filterMin","filterMax","maxFreq","detectMouseUp","pressed","detectMouseMove","detectMouseDown","buttons","which","className","eloff","container","ammount","sitekey","theme","resetWidget","waitForRecaptcha","grecaptcha","widgetId","render","resetTimeout","a2NewsService","parseFormat","lastidx","matchidx","RE_INTERP","startidx","lastIndex","substr","parsedFormatsPromise","formats","news","parsedFormats","PlotlyDefaults","plotlyPlotMaker","layout","mergeData","mergeLayout","Plotly","newPlot","resizeWatcher","relayout","old","projectsLoading","isUnsafe","findProject","empty_option","label","val_options","by_val","updateLabel","$$lastCommittedViewValue","loadScript","cb_name","google","script","apiKey","protocol","appendChild","constant","a2HereMarkerTextIconTemplate","loadOneScript","H","makeTextIcon","DomIcon","platform","Platform","app_id","appId","app_code","appCode","useHTTPS","loadPromise","setAPIIdAndCode","userPermit","permits","permit","permissions","super","isRfcx","rfcxUser","isAuthorized","isProjectMember","getUserEmail","userEmail","has","feature","features","perm","isArray","metrics","border","margin","inner","outer","overflow","scrollLeft","scrollSize","linker","linkers","tmp_promise","l","idx","make","item_name","newValue","utc","timezone","tz","arr","currentPage","limitPerPage","rate","timeoutPromise","qDefer","debouncePromise","self","a2LookaheadHelper","searchCompare","includeSearch","pop","unshift","searchPromote","EventlistManager","get_event_def","send","eventdef","oneTime","listeners","fired","Species","newVal","oldVal","Songtypes","songtype","$inheritFrom","classdef","constructor","static","window","qc","object","app","g","j","ColorscaleGradients","gradients","grad","len","humane","timeout","baseCls","spawn","addnCls","start","defaults","makeHeatmapPlot","plot","hoverinfo","colorbar","xaxis","boundsmode","ticksuffix","units","yaxis","matrix","bins","makeBarPlot","orientation","a2BrowserMetrics","gutter","axis_sizew","axis_sizeh","legend_axis_w","legend_width","legend_gutter","axis_lead","set","newDefaults","PlotlyDefaultDefaults","PlotSpecs","titlefont","family","tickfont","showLink","sendData","displaylogo","displayModeBar","scrollZoom","modeBarButtonsToRemove","plot_bgcolor","paper_bgcolor","dragmode","thickness","heatmap","colorscale","clear","url2","qidx","_t_","re","a2UrlUpdate","externalApiLoaderProvider","apis","getCachedModule","def","namespace","loader","globalAnonymousFunction","head","jsonpCallback","onerror","addApi","apiName","externalApiLoader","ct","wrapperFn","$qPromisify","cb","$stateProvider","state","findJobs","getTags","key1","value1","key2","value2","states","types","activeJobs","initParams","job_types","argument","jobsStatus","jobTypes","getPlotData","convertToCSV","objArray","str","exportCSVFile","headers","fileTitle","jsonObject","csv","exportedFilenmae","navigator","msSaveBlob","download","setAttribute","removeChild","itemsFormatted","firstname","plots","UserStatsExport","newUsers","newProjects","Jobs","allUsers","allSites","allProjects","newSites","getSystemSettings","setSetting","setting","toggleSetting","AdminDashboardDataService","mk_time_range_fn","delta","fromdt","todt","get_by_tag","make_setter","selattr","refresh_logs","time_ranges","periods","sampling","granularity","time_range","set_series","set_time_range","set_period","load_data","make_chart_struct","marker","datetime","activity","chart_data","LoaderFactory","AdminProjectsCodesService","newInstance","createNewCode","projectsList","AdminProjectsListService","usersList","AdminUsersListService","lockToUser","lockProject","tieProcessingWithRecordings","computeProcessingAmount","processingCountChanged","loadCodes","showHash","Loader","valueStore","abstract","views","detail","notifyProjectUpdated","projectObject","setProject","projectData","getProjectInfo","getProjectSites","getProjectRecordingCount","updateProject","handleAedToggle","clustering_enabled","aed_enabled","project_type_id","current_plan","storage_usage","processing_usage","citizen_scientist_enabled","cnn_enabled","pattern_matching_enabled","duration_period","analysis","deepStateRedirect","sticky","audiodata","attrHandler","files","$anchorScroll","a2Sites","a2GoogleMapsLoader","$downloadResource","parseSitesFromCsv","allText","allTextLines","createSites","Promise","markers","editing","creating","show_path","logs","deployment","sortByLastUpdated","set_show","maps","Map","getElementById","center","lng","mapTypeId","MapTypeId","SATELLITE","minZoom","fitBounds","mapHeader","mapHeaderPosition","getBoundingClientRect","bounds","LatLngBounds","LatLng","Marker","temp","setDraggable","panTo","setZoom","addListener","latLng","scrollTo","setMapOnAll","bookmark","yOffset","onScroll","scrollPos","scrollY","scrolledPastHeader","getMapHeaderTop","topOffset","offsetHeigh","scrollMap","sortByKeywordArray","originalSites","keyword","updated_at","setMap","clearMarkers","showMarkers","deleteMarkers","importSite","setPosition","setTitle","exportSites","status_controller","onLogsRefreshed","logParams","new_show","concat","transitionTo","current","siteForm","$invalid","tempObj","attrArray","locationArray","del","delAllEmptySites","siteIds","rec_count","show_state_param","has_logs","activate","published","$item","showAssetsCarousel","showCarousel","images","active","capitalizeFirstLetter","string","charAt","external_id","assets","asset","meta","reader","FileReader","readAsText","confirmRevoke","genToken","token_created_on","created","base64token","expires","dontRefreshLogs","itemGroup","group","tick","selected_site","plot_uri","a2SoundscapeCompositionService","newClass","canManageClasses","classes","addNewClass","groupType","scClass","classGroup","scientific_name","speciesClasses","species_name","songtype_name","message2","classesIds","project_classes","songtypes","searchSpecies","clearTimeout","results","lastSet","lastPage","lastRoi","lastRoiSet","viewState","lastSpecie","lastSongtype","getLastSet","ls","lp","lr","lrs","vs","sp","sg","setLastSet","setLastPage","setLastRoi","setLastRoiSet","setViewState","setLastSpecies","valsp","valsg","a2TrainingSetHistory","roi_index","pages","details","detailedView","currentrois","roisPerpage","loaderDisplay","getROIVisualizerUrl","projecturl","setROI","setPage","setROISet","nextROI","prevROI","nextPage","prevPage","affectedRows","closeSetDetails","showSetDetails","getTrainingSetList","trainingSets","date_created","tset","selectTrainingSet","addNewTrainingSet","validations","speciesData","setupExportUrl","export_url","exportTSReport","setDetailedView","editSelectedTrainingSet","speciesClass","editedTrainingSet","finally","deleteSelectedTrainingSet","citizen-scientist","a2Templates","$templateFetch","a2PatternMatching","done","isSpeciesLoading","speciesQty","recsQty","templateQty","pmQty","JobsData","showClassifications","showTrainings","showSoundscapes","successInfo","showSuccesss","errorInfo","showErrors","infoInfo","showInfo","updateFlags","showSuccess","showError","hideJob","updateJobs","getJobTypes","job_types_id","for","c","getJobs","new_jobs","startTimer","cancelTimer","showActiveJobs","showEmptyList","showLoader","titlen","vl","modalInstance","opened","job","percentage","isCompleted","isProcessing","isWaiting","openJob","href","intervalPromise","last3Months","job_type_id","geturl","cancelInterval","accessCheck","plan_due","deleteProject","userToAdd","curQuery","users","roles","findUser","inviteUser","user_email","invite","showInvitationPopup","noResults","changeRole","role","rolename","role_id","_this","isDataValid","A2AudioObject","a2Playlists","a2AudioPlayer","gain","gain_levels","freq_filter","is_playing","is_muted","has_recording","has_next_recording","has_prev_recording","resource","resource_params","isPopupOpened","isSavingPlaylist","playlistData","clustersData","f","fmin","fmax","minFreq","discard","setFrequencyFilter","setGain","getVolume","audio","volume","setCurrentTime","getCurrentTime","currentTime","togglePopup","isPlaylistDataValid","playlistName","closePopup","savePlaylist","playlist_name","aedIdsIncluded","_load_resource","pk","k","onCompleteListeners","load_promise","stop","mute","muted","play","pause","prev_recording","next_recording","form","display","loadAudio","deferred","Audio","interval","_check_current_time","nativeAudio","paused","canPlay","complete","restart","discarded","setVolume","unmutedVolume","setPlaybackRate","playbackRate","setMuting","muting","setProgress","progress","layer_types","layer_type","layer","layer_key","layer_url","layer_tmp","layer_el","type_array","addLayerType","layerType","lt","layers","VisualizerCtrl","__new_layer__","layer_def","layer_maker","cname","warn","__check_type","reqtype","curtype","check_requirements","req","browsetype","visobject_type","votype","selection","that","sidebar_visible","spectrogram_visible","display_sidebar","display_spectrogram","spectrogram","training_set_types","tst","editor","min_eps","scalex","scaley","points","tracer","make_new_bbox","add_tracer_point","add_point","similars","pt","dx","dy","tmp_points","pts_x","pts_y","x1","y1","x2","y2","resolve_tag","label_classes","default_colors_by_type","species_sound","clsprefix","resolve_species_tag","closeable","showCount","onClose","$viewport","$el","affix_c","affix_left","affix_right","affix_align_h","affix_top","affix_bottom","affix_align_v","a2AffixCompute","doLayout","fix_scroll_center","components","visualizer_root","y_axis","x_axis","component","$li","li","doXAxisLayout","doYAxisLayout","doLegendLayout","scroll_center","viewport","onScrolling","d3_x_axis","spec_h","layout_tmp","make_axis","d3_y_axis","d3_legend","preserveAspectRatio","xlink:href","tmp","onPlaying","max_s_h","max_s_w","s1","sec2px","s2","hz1","hz2px","hz2","hz","onMouseMove","elOff","pointer","sec","x2sec","y2hz","tick_format","tickFormat","unit_format","getRecordingPlaybackTime","audio_player","oldValue","pbh","sl","slw","$root","$eloff","$roff","a2VisualizerSpectrogramAffixed","newval","oldval","class2key","project_class","pc","add_validation","present","presentReview","presentAed","load_project_classes","taxons","byTaxon","is_selected","sel_range","Infinity","taxonSpecies","si","se","ctrlKey","key_idx","sel_pc_id","determinedFrom","val_state","showDropdown","transclude","closed","toggleSidebar","visualizer","clusters","idA","squash","idB","idC","lc","whenBrowserIsAvailable","parseAnnotations","locman","__expected","sync","update_path","updateParams","all_params","pv","dont_sync","path_changed","browserAvailable","__onBrowserAvailable__","notifyBrowserAvailable","a2VisualizerLayers","itemSelection","a2SpectrogramClick2Zoom","VisualizerObjectTypes","VisualizerLayout","a2VisualizerLocationManager","initial_state_params","annotationsString","annotations","comps","parsed","comp","pair","addLayer","fullfillsRequirements","isSidebarVisible","isSpectrogramVisible","canDisplayInSidebar","canDisplayInSpectrogram","set_location","click2zoom","getLayers","setVisObject","isUploading","visobject_location","visobject_loader","getLoader","loading_visobject","getCaptionFor","boxes","removeFromLocalStorage","setYScaleOptions","getSelectedFrequencyCache","originalScale","deselectFrequencyOptions","yAxisOptions","scaleCache","convertedScale","max_freq","resizeYScale","span","sampling_rate","makeClass","VisualizerLayoutSpecs","align_to_interval","align","unit_interval","u","get_domain","make_scale","ordinal","dd","dr","linear_interpolate","levels","def_sec2px","def_hz2px","max_sec2px","max_hz2px","interval_align","seconds","hertz","sec2x","hz2y","dsec2width","seconds1","seconds2","inclusive","dhz2height","eh","ehi","ehe","apply_spectrogram","avail_w","scalelegend","avail_h","zoom_levels_x","levelx","zoom_levels_y","levely","zoom_sec2px","zoom_hz2px","spec_w","has_legend","sh","sw","root","apply_plotted","a22PointBBoxEditor","toggle_active","zoom_out","zoom_reset","cp","lzoom","zoom_x","zoom_y","zoom_level_x","zoom_level_y","horizontal","switched","set_by_mouse","track","trackpos","px","py","loadUrl","expanded","collapseTimeoutInterval","deregHandlers","onLoadUrl","onDestroy","setCollapseTimer","collapseTimer","seekPercent","percent","toggleExpanded","restict","onText","offText","facebook_api","onSignedIn","onError","signIn","FB","auth2","client_id","google_oauth_client","cookiepolicy","$promisedResolve","$openModal","reload","audioEventDetectionsList","AudioEventDetectionService","onSubmit","fltr","AudioEventDetectionParametersEditTemplateUrls","algorithmsList","statisticsList","getDefaultName","notifyAedAlgorithmChanged","algorithmParametersTemplate","recomputeDefaultName","a2AudioEventDetectionsClustering","isNewJob","newJob","loadAudioEventDetections","showRefreshBtn","dataExtended","aedCount","audioEventDetectionsOriginal","audioEventDetectionsData","onSelectedJob","first_playlist_recording","createNewClusteringModel","deleteAedJob","aedJob","ret","modArr","indx","findIndex","deletingloader","areaThreshold","amplitudeThreshold","durationThreshold","bandwidthThreshold","filterSize","minFrequency","maxFrequency","isRfcxUser","errorJobLimit","checkLimit","toggleDetails","clusteringModel","totalRecordings","isJobValid","isNotDefined","showNameWarning","showPlaylistLimitWarning","showFrequencyWarning","freqMin","freqMax","gridContext","$stateParams","a2ClusteringJobs","selectedClusteringJobId","showViewGridPage","getProjectData","isProjectDisabled","loadClusteringJobs","clusteringJobsOriginal","clusteringJobsData","selectItem","clusteringJob","clustering_job_id","createNewClusteringJob","deleteClusteringJob","onSetDetailedView","onGoBack","toggleMenu","selectedCluster","frequencyFilter","currentMin","currentMax","decrementClusters","selectCluster","incrementClusters","shapes","shape","fillcolor","selection.line.color","selection.line.opacity","selection.line.stroke-width","getShapePoints","isFilteredClusters","sortFilteredData","selectedAedList","ind","isEmpty","countAudioEventDetected","aedsDetected","clustersDetected","countClustersDetected","drawClusteringPoints","getColor","rgb","originalData","xref","yref","x0","y0","opacity","cluster","offsetWidth","showlegend","side","xanchor","itemclick","stroke-width","resetSelect","redraw","hoverdistance","dragLayer","getElementsByClassName","xAxisRangeStart","fullData","$scope.layout.shapes[i].line.color","$scope.layout.shapes[i].line.stroke-width","point","curveNumber","pointNumber","onGridViewSelected","showClustersInVisualizer","selectedClusters","aedDataInfo","recIds","aed_id","recording_id","box","time_min","freq_low","time_max","freq_high","tempPlaylistData","showDetailsPage","infopanedata","gridViewSelected","openFreqFilterModal","frequency","useFrequencyFilterData","sum","job_details","res","x_coord","y_coord","aed_info","parseInt","filterData","has_previous_filter","remove_filter","apply_filter","saving","aed_job","minPoints","distanceThreshold","maxClusterSize","accessExportReport","isExporting","errMess","changedUserEmail","a2AudioBarService","isSquareSize","allRois","selectedRois","paginationSettings","totalItems","totalPages","lists","selectedFilterData","aedData","speciesLoading","isShiftKeyHolding","gridData","onSearchChanged","markBoxesAsSelected","updateInputState","setCurrentPage","showPagination","isFilterChanged","getStatusForEmptyData","isRoisLoading","groupedData","entries","entry","matched","getRoisDetailsSegment","combineRoisPerCluster","roisPerCluster","exportReport","openExportPopup","listParams","groupRoisBySpecies","ids","grids","speciesObj","speciesName","aeds","playRoiAudio","getRoiVisualizerUrl","frequency_min","frequency_max","toggleBoxSize","recIdsIncluded","isValidationAccessible","setValidation","validated","isClearValidation","markBoxesWithCurrentValidation","unselectBoxes","headerTop","header","getSelectedDetectionIds","isSelected","getCombinedDetections","combinedDetections","toggleDetection","selectedDetectionIds","firstInx","secondInx","det","arrayOfIndx","filteredDetections","_det","inputs","querySelectorAll","indeterminate","ngTableParams","a2CNN","selectedCNNId","initTable","acsDesc","tableConfig","sorting","tableParams","$defer","filteredData","cnnOriginal","orderedData","orderBy","cnnsData","loadCNNs","createNewCNN","deleteCNN","cnn","selectedPatternMatchingId","project_name","models","lambdas","model","lambda","cnn_id","thumbnails","thumbnailClass","CNNExportUrl","exportCnnReport","viewType","mainResults","counts","selectFn","resultsROIs","refreshDetails","bySpecies","dataIn","dataOut","byROIs","thresh","over_thresh","byROIsbySpecies","bySite","byRecordings","thumbnail","species_list","bySpeciesHist","speciesTimes","getHours","getMinutes","plotShown","showHist","speciesInfo","trace","xbins","end","tickformat","getRecordingVisualizerUrl","getTemplateVisualizerUrl","force","loadROIPage","moveROIPage","setSpecies","site_name","roi_species_counts","getSpeciesCounts","roi_species_sites_counts","roi_sites_counts","getSitesCounts","count_all_species","N","all_species","count_all_sites","all_site","setSite","rois_species","roiIds","species_sites_matrix","roi_site_counts","roi_site_counts_dict","sitesAcc","switchView","specie","count_all","all_sites","detailType","totalJobs","source_project_uri","patternmatchingId","loadPatternMatchings","pmName","splitAllSites","patternmatchingsOriginal","patternmatchingsData","resetPagination","isShowSearch","createNewPatternMatching","deletePatternMatching","sitesList","sitesListBatchSize","sitesBatches","paginationTotal","fetchDetails","loadSitesList","loadData","templateParameters","Threshold","Matches/Recording","Matches/Site","persite","recalculateSiteListBatch","songtypeName","patternMatchingExportUrl","exportPmReport","sitesTotal","splitSitesListIntoBatches","batches","getCountPerSite","countPerSite","recalculateTotalItems","absent","shouldRecalculate","setSiteBookmark","scorePerSite","shouldGetPerSite","getSiteBatchIndexBySiteId","siteId","batch","getSiteBatchBySiteId","batchIndex","getSiteBatchByPageNumber","combOpts","offsetCalc","pageNumber","parseRoisResult","sitename","siteBookmark","siteBatch","playTemplateAudio","setRoi","forEachRoi","val_delta","0","1","null","templates","createPatternMatching","isSaving","warningMessage","getTemplates","getPlaylists","isWarningMessage","pid","soundscapesOriginal","soundscapesData","filtered","loadSoundscapes","stateData","deleteSoundscape","createNewSoundscape","amplitudeReferences","showDetails","plist","exportSoundscape","buttonEnableFlag","datasubmit","aggregation","thresholdReference","bin","bandwidth","nameMsg","aggregationValue","tr","nv","buttonEnable","aggregations","aggr","aggre","svgContainer","axisScale","tickValues","afterGetAmplitudeReferences","setAmplitudeReference","amplitudeReference","thresholdInvPercent","lineData","peaks","MARGINS","vis","xRange","yRange","tickSize","tickSubdivide","drawAmpThreshold","ampThresh","yval","peaki","peakText","banwidthValue","xval","lineFunc","WIDTH","showDownload","chartOptions","ACI","NP","indices","min_t","onExpressionSelected","requires","onSelected","$interpolate","operations","nameTemplate","removeOnInvalidateHandler","updateNamePlaceholder","operation","term1","term2","namePlaceholder","playlist1","playlist2","operate","pname","pl","onExport","identifier","placeholder","preselected","badges","vals_present","vals_absent","a2Tags","cl","recordingDataFieldTypes","parameter_set","parameter_set_list","allLists","listByValue","checkSelectedValue","selectedItem","resetFilters","isDisabled","isRecordingEmpty","exportData","recTotal","onApplyFilters","applyFilters","getFilters","fetchOptions","a2Classi","_1_get","attribute","_1_mapper","mapFn","staticMonths","staticDays","day","staticHours","hour","_1_get_value_mapper","_1_get_id_mapper","_1_get_tag_id_mapper","_1_get_flags_mapper","findObjectWith","classification_results","model_only","flags","equiv","model_th","th","presence","sites_ids","years","hours","classifications","soundscape_composition","soundscape_composition_annotation","filterDefs","filterDef","param","vals","getRecordingsStatsPerSite","proms","recAv","levelIds","getFilterOptions","currentLevel","child","siteObj","itemCount","month","minute","setRecStatsStatic","maxYear","minYear","toISOString","tagsObj","computeClassificationResultsOptions","haveThreshold","old_crs","crs_key","new_crs","cr","new_cr","selectedRecId","checkedRec","getSearchParameters","output","searchRecs","expect","recs","totalRecs","rec","date_range","min_date","max_date","sortRecs","reloadList","exportPermit","createPlaylist","isDisableDeleteRecs","deleteRecordings","imported","note","deleteAllRecordings","importedCount","importedSites","combineCheckedRecordings","selectRec","setLimitPerPage","exportRecordings","changePlaylistName","isExportingRecs","changeUserEmail","loadImage","customSrc","SpeciesTaxons","isAdding","currentTab","pagination","getTaxons","goToSourceProject","reloadPage","deleteTemplate","confirmed","toggleTab","access","addTemplate","source_project_id","a2UploadsService","bytes","newBytes","pow","String","uploads","AppListingsService","verifyAndUpload","uploading","_verifyAndUpload","uploader","queue","file","isError","errorMsg","isSuccess","isDuplicate","upload","onSuccess","isCheckingStatus","queueJobToCheckStatus","uploadingFiles","getUploadingFiles","userFiles","fileObj","filesToCheck","uploadUrl","uploadId","userFile","makeSuccessItem","isUploaded","checkUploadingFiles","checkStatusInterval","uploaderAppListing","stopQueue","getUploader","fileTimezone","utcDiff","selectSite","local","utcOffset","isStartUploadDisabled","isLimitExceeded","randomString","random","uploaderApps","mac","windows","qItem","onErrorItem","onSuccessItem","getProgress","removeCompleted","getCountOfUploaded","uploaded","clearQueue","onProgressAll","FileUploader","returnValue","a2CitizenScientistService","a2CitizenScientistExpertService","cnp","expertSearch","compositeValidation","expert_val","expert_validated","consensus_val","consensus_validated","cs_val_present","cs_val_not_present","arg","onExpertSearchChanged","cs_validated","conflict_unresolved","conflict_resolved","oldtag","newtag","cs_conflict_resolved","cs_conflict_unresolved","expert_consensus_absent","expert_consensus_present","nextMatch","prevMatch","Users","vars","_var","groupStats","overall","__","cs_total","cs_absent","cs_present","onVisObject","browser","waitForInitialized","vobject_type","$p","$eo","$po","$dt","animate","selectVisObject","selectPreviousVisObject","selectNextVisObject","setBrowserLocation","setBrowserAnnotations","clearRecordingData","notifyVisobjUpdated","serializePromisedFn","BrowserLOVOs","BrowserVisObjects","$grouping","visobjectTypes","dates","auto","visobj","lovo","initialized","waitForInitializedDefer","setBrowserType","$list","default","$type","currentRecording","setLOVO","recordingsBySite","updateRecording","setVisObj","new_$type","old_$type","a2Browser","differ","deactivate","get_location","cachedLocation","object_type","vobj","auto_select","previous","loc","lovos_def","resolve_location","visobjects","lovos","lovodef","groups","setArray","getXSide","getXCoord","getTransform","getYTranslation","asrelativeoffset","layer_typesProvider","hide_visibility","makeTagsIndex","groupByBbox","bboxes","bboxIdx","bbox_key","lookaheadHelper","spectrogramTags","tagsIndex","bboxTags","bboxTagsIndex","setVisobject","loadTags","searchedTags","searchTags","getProjectTags","onTagListChanged","tagUpdate","determineTagUpdate","updateTags","onBBoxTagListChanged","oldTagsIndex","toDelete","updateResponse","resetBboxTags","classesByType","classTypes","annotationToolbar","classId","scclassId","loadAnnotations","recordingTemplates","getTemplatesPromise","updateState","goToSpeciesPage","make_new_roi","get_placeholder_name","submitting","template_name","new_template","VisualizerObjectTypesProvider","$loader","VisualizerObjectAudioEventDetectionTypeLoader","aggregates","statisticsInfo","getParameters","_aggregates","_statistics","AudioEventDetection","selectData","tod","y_max","fetch","zoomable","data_selection","savePlot","getCaption","typeDef","VisualizerObjectRecordingTypeLoader","khz_format","extra","sample_rate","tiles","tile","legacy","streamId","datetime_utc","valueOf","ds","audioUrl","VisualizerObjectSoundscapeTypeLoader","khz_unit_fmt","time_of_day","time_unit","unit_fmt","day_of_month","day_of_year","month_in_year","localeData","_months","day_of_week","_weekdays","unknown","agg","max_t","min_f","max_f","v0","min_value","v1","visual_max_value","max_value","normalized","dt","df","dv","bin_size","visual_palette","dhz","crisp","classificationsOriginal","classificationsData","capitalize","loadClassifications","muser","showClassificationDetails","classi","model_id","windowClass","ClassiInfo","createNewClassification","deleteClassification","a2Models","loadClassifiedRec","classiData","maxPerPage","dataRec","maxVal","vector","htresDeci","recVect","minv","maxv","maxvRounded","gotoc","where","toggleRecDetails","showMore","csvUrl","table","errCount","modelInfo","recselected","showselection","datas","classifier","selectedSites","vectorData","minvect","maxvect","loadingflag","drawVector","xStep","modelsDataOrig","modelsData","loadModels","deleteModel","model_name","validationdata","newModel","trainings","training","totalValidations","presentValidations","absentsValidations","usePresentTraining","useNotPresentTraining","usePresentValidation","useNotPresentValidation","jobDisabled","totalPresentValidation","totalNotPresentValidation","disableCreateButton","training_set_id","model_type_id","tp","tn","vp","vn","scopeExited","getVectors","waitinFunction","currRec","vmax","vmin","allMax","allMin","vectorNoMax","allYesMax","showValidationsTable","loadingValidations","showModelValidations","messageSaved","suggestedThreshold","isNaN","ii","jj","searchTh","thresholdObject","precisionObject","accuracyObject","sensitivityObject","specificityObject","sumObject","tries","computeStats","thres","accuracy","sensitivity","specificity","precisionMaxIndices","sensitivityMaxIndices","accuracyMaxIndices","specificityMaxIndices","accum","currentThreshold","tpos","fpos","tneg","fneg","trupositive","falsepositives","truenegatives","falsenegative","saveThreshold","recalculate","parseFloat","newthres","zoomout","zoomin","isExport","getValidations","recDetails","closeRecValidationsDetails","gotoRec","rurl","a2CitizenScientistAdminService","loadForSpecies","loadingForSpecies","speciesStats","patternmatchings","pm","citizen_scientist","cs_expert","consensus_number","userStatsExportUrl","setUser","loadForUser","loadingForUser","userStats","BrowserVisObjectsProvider","BrowserLOVOsProvider","cardTemplate","a2ArrayLOVO","audioEventDetection","audioEventDetections_lovo","scd","scid","regionid","soundscapes","caption2","soundscapes_lovo","audioEvents","clusteringEvents","isAudioEventsPlaylist","selectedAudioEventJob","clusterPlaylists","isPlaylist","toggleAudioEvents","isJobsBoxes","audioEventJobs","borderColor","hexToRGB","backgroundColor","hex","isHighlightTitle","fetchAudioEvents","freq_min","freq_max","sidebar_only","tagid","explorerUrl","training_set_typesProvider","has_layout","layer_item","new_modal","collect_new_tset_data","sdata","sval","typedef","roi_set","fetchData","tsetId","new_tset_data","tset_type","tset_list","training_sets","add_new_tset","new_tset","fetchTsetData","cont_name","a2VisualizerSpectrogramTrainingSetData","type_def","loadingClasses","loadingTypes","tset_types","speciesPresence","isRemoving","checkSpectroWidth","leftBox","widthBox","widthSpectro","confirmPopup","pattern_matching_roi_id","fetchSpeciesPresence","aedValidations","a2Pager","PageSize","BlockSize","whole_list","paging","item_count","page_size","block_size","block_tracks_page","on_page","load_page","set_page","playlist_info","append_extras","vaxis","find_local","found_rec","page_for","last_page","set_options","resolve_value","last","current_page","is_at_first_page","is_at_last_page","show_block","last_page_block","block","current_page_block","is_at_first_page_block","is_at_last_page_block","current_page_block_first_page","current_page_block_last_page","has_page","a2PlaylistLOVO","pld","resolve_link","plid","recid","set_playlist","$cacheFactory","finished","loadNext","equals","rbDateAvailabilityCache","a2RecordingsBySiteLOVO","siteInfo","refreshing","display_year","date_counts","datepickerMode","get_counts_for","availability","fetch_counts","fetching","avail","site_years","year_months","month_days","akey","fetch_year_range","records","utcdateaslocal","recdate","getTimezoneOffset","set_site","set_date","make_lovo","site_match","set_dates_display_year","new_display_year","year_range","yearpickOpen","edit_visual_scale","palettes","visual_max","threshold_type","amplitude","sc","amplitudeThresholdType","visualMax","scidx","norm_vector","ampTh","getMaxAmplitude","pallen1","_cl","cell","act","al","ali","ale","__maxAmplitude","maxAmp","cellMax","_soundscape","_scidx","_normalized","_norm_vector","bbox2string","names","view_playlist","regions","sample","quantize","xi","yi","selbox","view_samples","vdata","form_data"],"mappings":"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AI,IAAMA,EAAI,IAAMA,EAAI,KAG1C,GAAIC,IACFC,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,YAAa,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UA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","file":"arbimon2.min.js","sourcesContent":["angular.module('a2.admin', ['a2.directives', 'a2.admin.dashboard', 'a2.admin.projects', 'a2.admin.jobs', 'a2.directive.search-bar']).controller('AdminCtrl', function ($scope, $state) {\n  $scope.$state = $state;\n});","try {\n  angular.module(\"angularytics\"); // this throws if GA script is not loaded\n} catch (e) {\n  console.error(\"GA not available, likely adblocker\", e);\n\n  (function () {\n    angular.module('angularytics', []).provider('Angularytics', function () {\n      this.setEventHandlers = function () {};\n\n      this.$get = [function () {\n        var service = {};\n\n        service.init = function () {};\n\n        return service;\n      }];\n    }).filter('trackEvent', ['Angularytics', function () {\n      return function () {\n        return null;\n      };\n    }]);\n  })();\n}\n\nvar a2 = angular.module('a2.app', ['a2.permissions', 'templates-arbimon2', 'a2.app.dashboard', 'a2.audiodata', 'a2.visualizer', 'a2.analysis', 'a2.citizen-scientist', 'a2.jobs', 'a2.directive.sidenav-bar', 'a2.settings', 'a2.login', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    if (to.name.startsWith('visualizer')) {\n      document.getElementsByTagName('body')[0].classList.add('visualizer-page');\n    } else {\n      document.getElementsByTagName('body')[0].classList.remove('visualizer-page');\n    } // only check permissions if state have allowAccess\n\n\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (allowed === undefined) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      $state.go('dashboard');\n    } else if (allowed === false) {\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/dashboard\");\n}).controller('MainCtrl', function ($scope, $state, Project, a2UserPermit, $window) {\n  $scope.$state = $state;\n  Project.getInfo(function (data) {\n    $scope.bioAnalyticsBaseUrl = data.bioAnalyticsBaseUrl;\n    $scope.reportsEnabled = data.reports_enabled;\n  });\n\n  $scope.getUrlFor = function (page) {\n    const projectUrl = Project.getUrl();\n\n    if (page == 'citizen-scientist') {\n      return '/citizen-scientist/' + projectUrl + '/';\n    } else if (page == 'reports') {\n      return $scope.bioAnalyticsBaseUrl + '/' + projectUrl;\n    }\n  };\n\n  $scope.citizenScientistUser = a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper();\n  $scope.isAppPage = $window.location.pathname.startsWith('/project/');\n});","var a2 = angular.module('a2.cs-app', ['a2.permissions', 'templates-arbimon2', 'a2.app.dashboard', 'a2.audiodata', 'a2.visualizer', 'a2.analysis', 'a2.citizen-scientist', 'a2.directive.sidenav-bar', 'a2.settings', 'a2.login', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    // only check permissions if state have allowAccess\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (allowed === undefined) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      $state.go('citizen-scientist.patternmatching');\n    } else if (allowed === false) {\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/citizen-scientist/patternmatching/\");\n}).controller('MainCtrl', function ($scope, $state, Project) {\n  $scope.$state = $state;\n  $scope.onCitizenScientistPage = true;\n\n  $scope.getUrlFor = function (page) {\n    if (page == 'citizen-scientist') {\n      return '/citizen-scientist/' + Project.getUrl() + '/';\n    }\n  };\n});","angular.module('a2.home', ['templates-arbimon2', 'ui.bootstrap', 'a2.utils', 'a2.forms', 'a2.orders', 'a2.login', 'humane', 'angularytics', 'ui.router', 'a2.srv.local-storage', 'a2.filter.time-from-now', 'a2.directive.search-bar', 'ngSanitize']).config(function (AngularyticsProvider, $locationProvider) {\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).service('homeSummaryStatsData', function () {\n  return [{\n    title: 'projects created',\n    getData: function ($http) {\n      return $http.get('/legacy-api/project/projects-count').then(function (projects) {\n        return projects.data;\n      });\n    }\n  }, {\n    title: 'recordings uploaded',\n    getData: function ($http) {\n      return $http.get('/legacy-api/project/recordings-count').then(function (recordings) {\n        return recordings.data;\n      });\n    }\n  }, {\n    title: 'analyses performed',\n    description: 'Number of files processed by pattern matching jobs',\n    getData: function ($http) {\n      return $http.get('/legacy-api/project/jobs-count').then(function (jobs) {\n        return jobs.data;\n      });\n    }\n  }, {\n    title: 'species identified',\n    getData: function ($http) {\n      return $http.get('/legacy-api/project/recordings-species-count').then(function (species) {\n        return species.data;\n      });\n    }\n  }];\n}).controller('HomeCtrl', function ($http, $window, $localStorage, notify, a2order, a2InjectedData, $scope, $q, $injector, homeSummaryStatsData) {\n  $scope.summaryDataLoading = true;\n  $scope.list_summary_data = homeSummaryStatsData;\n  $scope.summary_data = $scope.list_summary_data.map(function () {\n    return [];\n  });\n\n  function getSummaryData(summary_item) {\n    return $q.resolve(summary_item.getData ? $injector.invoke(summary_item.getData) : []);\n  }\n\n  $q.all($scope.list_summary_data.map(getSummaryData)).then(function (allData) {\n    $scope.summaryDataLoading = false;\n    $scope.summary_data = allData;\n  }.bind(this));\n  $scope.isExplorePage = $window.location.pathname === '/';\n\n  function getProjectSelectCache() {\n    try {\n      return JSON.parse($localStorage.getItem('home.project.select.cache')) || {};\n    } catch (e) {\n      return {};\n    }\n  }\n\n  function setProjectSelectCache(psCache) {\n    try {\n      $localStorage.setItem('home.project.select.cache', JSON.stringify(psCache));\n    } catch (e) {}\n  }\n\n  this.loadProjectList = function () {\n    const isFeatured = $scope.isAnonymousGuest || $scope.isExplorePage;\n    const isMyProjects = !$scope.isAnonymousGuest && !$scope.isExplorePage;\n    var config = {\n      params: {\n        include_location: true,\n        publicTemplates: true\n      }\n    };\n\n    if (isFeatured) {\n      config.params.featured = true;\n    }\n\n    if (isMyProjects) {\n      config.params.type = 'my';\n    }\n\n    var psCache = getProjectSelectCache();\n    this.isLoading = true;\n    this.projects = [];\n    this.highlightedProjects = [];\n    $http.get('/legacy-api/user/projectlist', config).success(function (data) {\n      data.forEach(function (p) {\n        p.lastAccessed = psCache[p.id] || 0;\n        var lat = p.lat && p.lat >= -85.0511 && p.lat <= 85.0511 ? p.lat : 37.773972;\n        var lon = p.lon && p.lon >= -180 && p.lon <= 180 ? p.lon : -122.431297;\n        var zoom = p.lat && p.lon ? 5.33 : 4;\n        p.mapUrl = \"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/\" + lon + \",\" + lat + \",\" + zoom + \",0,60/274x180?access_token=\" + a2InjectedData.mapbox_access_token;\n      });\n      this.isLoading = false;\n\n      if (isFeatured) {\n        this.projects = [];\n        this.highlightedProjects = data.filter(function (item) {\n          return item.featured === 1;\n        });\n        this.highlightedProjects.forEach(function (project) {\n          project.isLoading = true;\n          $http.get('/legacy-api/project/' + project.url + '/templates/count', {\n            params: {\n              projectTemplates: true\n            }\n          }).success(function (data) {\n            project.templatesTotal = data.count || 0;\n            project.isLoading = false;\n          });\n          $http.get('/legacy-api/project/' + project.url + '/recordings/count').success(function (count) {\n            project.recCount = count;\n            project.isLoading = false;\n          });\n          $http.get('/legacy-api/project/' + project.url + '/species-count').success(function (count) {\n            project.speciesCount = count || 0;\n            project.isLoading = false;\n          });\n        });\n      } else if (isMyProjects) {\n        this.highlightedProjects = [];\n        this.projects = data;\n      }\n    }.bind(this)).error(function () {\n      this.isLoading = false;\n    }.bind(this));\n  };\n\n  this.createProject = function () {\n    var modalInstance = a2order.createProject({});\n    modalInstance.result.then(function (message) {\n      if (message) {\n        notify.log(message);\n      }\n\n      this.loadProjectList();\n    }.bind(this));\n  };\n\n  this.selectProject = function (project) {\n    if (!project.is_enabled) {\n      return;\n    }\n\n    var psCache = getProjectSelectCache();\n    psCache[project.id] = new Date().getTime();\n    setProjectSelectCache(psCache);\n    $window.location.assign(\"/project/\" + project.url + \"/\");\n  };\n\n  $scope.isAnonymousGuest = true;\n  $http.get('/legacy-api/user/info').success(function (data) {\n    $scope.isAnonymousGuest = data.isAnonymousGuest;\n    this.loadProjectList();\n  }.bind(this));\n\n  this.valueShortScale = function (value) {\n    if (value && Number(value) > 999999999) {\n      value = value.toString().substring(0, 4);\n      console.log(value);\n      const formattedNumber = numeral(value.toString().substring(0, 4)).format('0,0');\n      value = formattedNumber + ' million';\n      return value;\n    } else {\n      return numeral(value).format('0,0');\n    } // const formattedNumber = numeral(value).format('0.0a')\n    // const firstDecimalDigit = (x) => x.split('.')[1].slice(0, 1)\n    // return firstDecimalDigit(formattedNumber) === '0' ? formattedNumber.replace('.0', '') : formattedNumber\n\n  };\n});","angular.module('a2.login', ['humane', 'ui.bootstrap', 'templates-arbimon2', 'g-recaptcha', 'a2.utils.google-login-button', 'a2.utils.facebook-login-button']).controller('LoginCtrl', function ($scope, $http, $window, $modal, notify) {\n  $scope.login = function () {\n    var path = '/login' + $window.location.search;\n    $http.post(path, {\n      username: $scope.username,\n      password: $scope.password,\n      captcha: $scope.captchaResp\n    }).success(function (data) {\n      if (data.error) {\n        notify.error(data.error);\n\n        if (data.captchaNeeded) {\n          $scope.showCaptcha = true;\n        }\n\n        $scope.resetCaptcha();\n        $scope.captchaResp = '';\n        return;\n      }\n\n      if (data.success) {\n        $window.location.assign(data.redirect);\n      }\n    }).error(function (error) {\n      notify.error(error || 'Something went wrong, try again later');\n    });\n  };\n\n  this.oAuthLogin = function (type, user) {\n    var oauthData;\n\n    if (type == 'google') {\n      oauthData = {\n        type: 'google',\n        token: user.getAuthResponse().id_token\n      };\n    } else if (type == 'facebook') {\n      oauthData = {\n        type: 'facebook',\n        token: user.authResponse.accessToken\n      };\n    } else {\n      return;\n    }\n\n    $http.post('/oauth-login' + $window.location.search, oauthData).then(function (response) {\n      var data = response.data;\n\n      if (data.error) {\n        notify.error(data.error);\n      } else if (data.success) {\n        $window.location.assign(data.redirect);\n      }\n    }).catch(function (response) {\n      if (response.status == 449) {\n        return this.showEnableOAuthModal(oauthData);\n      } else {\n        notify.error(response.data || 'Something went wrong, try again later');\n      }\n    }.bind(this));\n  };\n\n  this.showEnableOAuthModal = function (oauthData) {\n    var modalData = {};\n    $modal.open({\n      templateUrl: '/common/templates/authorize-enter-credentials-pop-up.html',\n      controller: function () {\n        this.title = \"User Authorization Required\";\n        this.data = modalData;\n        this.oauthType = oauthData.type;\n        this.messages = [\"Before using \" + oauthData.type + \" to sign into your account you must first allow it.\"];\n        this.authorizeMessage = \"Authorize \" + oauthData.type + \" sign-in on my account.\";\n        this.btnOk = \"Confirm\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      if (!modalData.authorized) {\n        notify.error(\"Login authorization canceled.\");\n      } else {\n        $http.post('/oauth-login' + $window.location.search, angular.extend({}, oauthData, {\n          authorize: 1,\n          username: modalData.username,\n          password: modalData.password\n        })).then(function (response) {\n          var data = response.data;\n\n          if (data.error) {\n            notify.error(data.error);\n          } else if (data.success) {\n            $window.location.assign(data.redirect);\n          }\n        }).catch(function (response) {\n          if (response.status == 449) {\n            return this.showEnableOAuthModal(oauthData);\n          } else {\n            notify.error(response.data || 'Something went wrong, try again later');\n          }\n        }.bind(this));\n      }\n    });\n  };\n}).controller('RedirectToLoginCtrl', function ($scope, $window) {\n  var redirect = $window.location.pathname + $window.location.search + $window.location.hash;\n  $scope.loginUrl = \"/login?redirect=\" + encodeURIComponent(redirect);\n});","angular.module('a2.orders', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.create-project', 'a2.orders.change-project-plan', 'a2.orders.order-summary', 'a2.orders.plan-selection', 'a2.orders.shipping-form', 'a2.orders.process-order', 'a2.orders.directives.plan-capacity', 'a2.orders.directives.tier-select' // 'ui.bootstrap',\n// 'humane',\n// 'a2.directives',\n// 'a2.services',\n]);","angular.module('a2.register', ['a2.forms', 'a2.directives', 'ui.bootstrap', 'angularytics', 'g-recaptcha', 'humane']).config(function (AngularyticsProvider) {\n  AngularyticsProvider.setEventHandlers(['Console', 'GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).controller('UserRegisterCtrl', function ($scope, $modal, $http, $timeout, $interval, notify) {\n  var captchaResp = '';\n\n  $scope.testUsername = function () {\n    $scope.usernameOk = '';\n    $scope.usernameErr = '';\n\n    if ($scope.testUserTimeout) {\n      $timeout.cancel($scope.testUserTimeout);\n    }\n\n    if ($scope.regis.username.$error.required) {\n      return;\n    } else if ($scope.regis.username.$error.pattern) {\n      $scope.usernameErr = \"Username must be at least 4 characters long \" + \"and can only contain alphanumeric characters,\" + \" dash(-), underscore(_) and dot(.).\";\n      return;\n    }\n\n    $scope.testUserTimeout = $timeout(function () {\n      $http.get('/legacy-api/login_available', {\n        params: {\n          username: $scope.user.username\n        }\n      }).success(function (data) {\n        if (data.available) {\n          $scope.usernameOk = $scope.user.username + \" is available\";\n        } else {\n          $scope.usernameErr = $scope.user.username + \" is not available\";\n        }\n      });\n    }, 1000);\n  };\n\n  $scope.testEmail = function () {\n    $scope.emailOk = '';\n    $scope.emailErr = '';\n\n    if ($scope.testEmailTimeout) {\n      $timeout.cancel($scope.testEmailTimeout);\n    }\n\n    if ($scope.regis.email.$error.required) {\n      return;\n    } else if ($scope.regis.email.$error.email) {\n      $scope.emailErr = \"Invalid email\";\n      return;\n    }\n\n    $scope.testEmailTimeout = $timeout(function () {\n      $http.get('/legacy-api/email_available', {\n        params: {\n          email: $scope.user.email\n        }\n      }).success(function (data) {\n        if (data.available) {\n          $scope.emailOk = $scope.user.email + \" is available\";\n        } else {\n          if (data.invalid) {\n            $scope.emailErr = $scope.user.email + \" is not a valid address\";\n          } else {\n            $scope.emailErr = $scope.user.email + \" is not available\";\n          }\n        }\n      });\n    }, 1000);\n  };\n\n  $scope.register = function ($event) {\n    if (!$scope.passResult.valid) {\n      notify.error($scope.passResult.msg);\n    } else if ($scope.usernameErr) {\n      notify.error($scope.usernameErr);\n    } else if ($scope.emailErr) {\n      notify.error($scope.emailErr);\n    } else if (!$scope.terms_accepted) {\n      notify.log('To register you must agree with our terms of service');\n    } else if (!$scope.captchaResp && !$scope.captchaNotNeeded) {\n      notify.log('Please complete the captcha');\n    } else {\n      $scope.loading = true;\n      $http.post('/register', {\n        user: $scope.user,\n        captcha: $scope.captchaResp,\n        newsletter: $scope.newsletter\n      }).success(function (data) {\n        $scope.loading = false;\n\n        if (data.success) {\n          $scope.completed = true;\n        }\n      }).error(function (data) {\n        $scope.loading = false;\n\n        if (data.error) {\n          $scope.resetCaptcha();\n          $scope.captchaResp = '';\n          return notify.error(data.error);\n        }\n\n        notify.error(\"something went wrong, please try again later\");\n      });\n    }\n  };\n});","angular.module('a2.reset-password', ['a2.directives', 'a2.forms', 'humane']).controller('ResetPassCtrl', function ($scope, $http, $window, notify) {\n  $scope.changePassword = function () {\n    if (!$scope.passResult.valid) {\n      notify.error($scope.passResult.msg);\n    }\n\n    var path = $window.location.pathname;\n    $http.post(path, {\n      password: $scope.password\n    }).success(function (data) {\n      $scope.completed = true;\n    });\n  };\n}).controller('ResetRequestCtrl', function ($scope, $http, notify) {\n  $scope.request = function () {\n    $scope.loading = true;\n    $http.post('/forgot_request', {\n      email: $scope.email\n    }).success(function (data) {\n      $scope.loading = false;\n\n      if (data.error) {\n        return notify.error(data.error);\n      }\n\n      $scope.requestComplete = true;\n    });\n  };\n});","angular.module('a2.user-settings', ['templates-arbimon2', 'a2.forms', 'ui.bootstrap', 'humane', 'angularytics']).config(function (AngularyticsProvider) {\n  AngularyticsProvider.setEventHandlers(['Console', 'GoogleUniversal']);\n}).run(function (Angularytics) {\n  Angularytics.init();\n}).controller('UserSettingsCtrl', function ($scope, $modal, $http, notify) {\n  this.data = {};\n  $http.get('/legacy-api/user/info').then(function (response) {\n    $scope.user = response.data;\n    this.user = response.data;\n    this.reset();\n  }.bind(this));\n\n  this.reset = function () {\n    this.data = angular.copy(this.user);\n  };\n\n  this.save = function () {\n    var data = this.data;\n    return $http.post('/legacy-api/user/update', {\n      userData: {\n        name: data.name,\n        lastname: data.lastname,\n        oauth: data.oauth\n      }\n    }).then(function (response) {\n      if (response.data.error) {\n        notify.error(response.data.error);\n      } else {\n        notify.log(response.data.message);\n      }\n    }).catch(function (err) {\n      console.log(\"err\", err);\n      notify.serverError();\n    });\n  };\n});","var a2 = angular.module('a2.visualizer-app', ['a2.permissions', 'templates-arbimon2', 'a2.visualizer', 'angularytics', 'ui.router', 'ct.ui.router.extras', 'a2.filters', 'humane', 'a2.googlemaps', 'a2.injected.data', 'a2.directive.search-bar']).run(function ($rootScope, Angularytics, a2UserPermit, notify, $state) {\n  $rootScope.Math = Math; // export math library to angular :-)\n\n  Angularytics.init();\n  $rootScope.$on('$stateChangeStart', function (e, to, params) {\n    // only check permissions if state have allowAccess\n    if (!angular.isFunction(to.allowAccess)) return;\n    var allowed = to.allowAccess(a2UserPermit);\n\n    if (!allowed) {\n      // if permissions have not loaded go dashboard\n      e.preventDefault();\n      notify.error('You do not have access to this section');\n    }\n  });\n}).config(function ($urlRouterProvider, $locationProvider, AngularyticsProvider, a2GoogleMapsLoaderProvider, a2InjectedData) {\n  a2GoogleMapsLoaderProvider.setAPIKey(a2InjectedData.googleAPI.key);\n  AngularyticsProvider.setEventHandlers(['GoogleUniversal']);\n  $locationProvider.html5Mode(true);\n  $urlRouterProvider.otherwise(\"/visualizer\");\n}).controller('MainCtrl', function ($scope, $state, Project, $http, $window) {\n  $scope.$state = $state;\n\n  $scope.getUrlFor = function (page) {\n    if (page == 'visualizer') {\n      return '/visualizer/' + Project.getUrl() + '/';\n    }\n  };\n});","angular.module('a2.srv.api', []).factory('a2APIServiceClass', function ($location, $q, $http) {\n  var a2APIServiceClass = function (prefix) {\n    this.prefix = prefix;\n  };\n\n  function returnData(response) {\n    return response.data;\n  }\n\n  a2APIServiceClass.prototype = {\n    getUrl: function (apiRoute) {\n      return this.prefix + apiRoute;\n    },\n    get: function (apiRoute, params) {\n      return $q.when($http.get(this.prefix + apiRoute, params)).then(returnData);\n    },\n    post: function (apiRoute, data) {\n      return $q.when($http.post(this.prefix + apiRoute, data)).then(returnData);\n    },\n    delete: function (apiRoute, data) {\n      return $q.when($http.delete(this.prefix + apiRoute)).then(returnData);\n    },\n    put: function (apiRoute, data) {\n      return $q.when($http.put(this.prefix + apiRoute, data)).then(returnData);\n    }\n  };\n  return a2APIServiceClass;\n}).factory('a2APIService', function ($location, $q, a2APIServiceClass) {\n  var nrm = /\\/?(project|citizen-scientist|visualizer)\\/([\\w\\_\\-]+)/.exec($location.absUrl());\n  var projectName = nrm ? nrm[2] : '';\n  var apiURLPrefix = '/legacy-api/project/' + projectName;\n\n  function returnData(response) {\n    return response.data;\n  }\n\n  var a2APIService = new a2APIServiceClass(apiURLPrefix);\n  a2APIService.api = new a2APIServiceClass('/legacy-api');\n  a2APIService.project = new a2APIServiceClass('/project/' + projectName);\n\n  a2APIService.getProjectName = function () {\n    return projectName;\n  };\n\n  return a2APIService;\n});","angular.module('a2.service.audio-event-detection', ['a2.srv.api']).factory('AudioEventDetectionService', function (a2APIService) {\n  var AudioEventDetectionService = {\n    getList: function () {\n      return a2APIService.get('/audio-event-detections/');\n    },\n    getAlgorithmsList: function () {\n      return a2APIService.get('/audio-event-detections/algorithms');\n    },\n    getStatisticsList: function () {\n      return a2APIService.get('/audio-event-detections/statistics');\n    },\n    getDataStatisticsList: function () {\n      return a2APIService.get('/audio-event-detections/data/statistics');\n    },\n    getDataAggregatesList: function () {\n      return a2APIService.get('/audio-event-detections/data/aggregates');\n    },\n    getDataFor: function (aed, x, y, z) {\n      var args = [];\n      return a2APIService.get('/audio-event-detections/data/' + [aed, x.statistic, y.statistic, z.statistic].map(encodeURIComponent).join('/') + '?' + args.join('&'));\n    },\n    savePlotFor: function (aed, x, y, z) {\n      var params = {\n        x: x.statistic,\n        y: y.statistic,\n        z: z.statistic\n      };\n      return a2APIService.post('/audio-event-detections/default-plot/' + [aed].map(encodeURIComponent).join('/'), params);\n    },\n    new: function (aed) {\n      aed = aed || {};\n      var params = {\n        name: aed.name || aed.defaultName,\n        algorithm: aed.algorithm.id,\n        parameters: aed.parameters,\n        statistics: aed.statistics.map(function (statistic) {\n          return statistic.id;\n        }),\n        playlist: aed.playlist.id\n      };\n      return a2APIService.post('/audio-event-detections/new', params);\n    }\n  };\n  return AudioEventDetectionService;\n});","angular.module('a2.srv.audio-event-detections-clustering', ['a2.srv.project', 'humane']).factory('a2AudioEventDetectionsClustering', function ($http, Project, notify) {\n  return {\n    list: function (opts, callback) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/audio-event-detections-clustering', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    count: function () {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/audio-event-detections-clustering/total-recordings').then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/audio-event-detections-clustering/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    validate: function (opts) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/audio-event-detections-clustering/validate', opts).then(function (response) {\n        return response.data;\n      });\n    },\n    unvalidate: function (opts) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/audio-event-detections-clustering/unvalidate', opts).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (jobId) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/audio-event-detections-clustering/' + jobId + '/remove').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist-admin', ['a2.srv.api']).factory('a2CitizenScientistAdminService', function (a2APIService, Project, notify) {\n  return {\n    getClassificationStats: function (speciesId) {\n      return a2APIService.get('/citizen-scientist/stats/classification' + (speciesId ? '/' + speciesId : '')).catch(notify.serverError);\n    },\n    getUserStats: function (userId) {\n      return a2APIService.get('/citizen-scientist/stats/user' + (userId ? '/' + userId : '')).catch(notify.serverError);\n    },\n    getUserStatsExportUrl: function () {\n      return '/legacy-api/project/' + Project.getUrl() + '/citizen-scientist/stats/export/user-stats.csv';\n    },\n    getCSExportUrl: function (pattern_matching_id, per_user) {\n      var filename = per_user ? 'export-per-user.csv' : 'export.csv';\n      return '/legacy-api/project/' + Project.getUrl() + '/citizen-scientist/pattern-matchings/' + pattern_matching_id + '/' + filename;\n    },\n    getSettings: function () {\n      return a2APIService.get('/citizen-scientist/settings').catch(notify.serverError);\n    },\n    setSettings: function (settings) {\n      return a2APIService.post('/citizen-scientist/settings', settings).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist-expert', ['a2.srv.api']).factory('a2CitizenScientistExpertService', function (a2APIService, Project, notify) {\n  return {\n    getPatternMatchings: function () {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/expert').catch(notify.serverError);\n    },\n    getPatternMatchingDetailsFor: function (patternMatchingId) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert/details').catch(notify.serverError);\n    },\n    getPatternMatchingRoisFor: function (patternMatchingId, limit, offset, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert-rois/' + (offset || 0) + '_' + (limit || 0) + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    validatePatternMatchingRois: function (patternMatchingId, rois, validation) {\n      return a2APIService.post('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/expert-validate', {\n        rois: rois,\n        validation: validation\n      }).catch(notify.serverError);\n    },\n    getCSExportUrl: function (options) {\n      options = options || {};\n      return '/legacy-api/project/' + Project.getUrl() + '/citizen-scientist/pattern-matchings/' + (options.patternMatching | 0) + '/export.csv';\n    }\n  };\n});","angular.module('a2.srv.citizen-scientist', ['a2.srv.api']).factory('a2CitizenScientistService', function (a2APIService, notify) {\n  return {\n    getMyStats: function (userId) {\n      return a2APIService.get('/citizen-scientist/stats/mine').catch(notify.serverError);\n    },\n    getPatternMatchings: function () {\n      return a2APIService.get('/citizen-scientist/pattern-matchings').catch(notify.serverError);\n    },\n    getPatternMatchingDetailsFor: function (patternMatchingId) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/details').catch(notify.serverError);\n    },\n    getPatternMatchingRoisFor: function (patternMatchingId, limit, offset) {\n      return a2APIService.get('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/rois/' + (offset || 0) + '_' + (limit || 0)).catch(notify.serverError);\n    },\n    validatePatternMatchingRois: function (patternMatchingId, rois, validation) {\n      return a2APIService.post('/citizen-scientist/pattern-matchings/' + patternMatchingId + '/validate', {\n        rois: rois,\n        validation: validation\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.classi', ['a2.srv.project', 'humane']).factory('a2Classi', function ($http, Project, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/classifications').then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetails: function (classificationId, callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/classifications/' + classificationId).success(callback).error(notify.serverError);\n    },\n    getResultDetails: function (classificationId, first, limit, callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/more/' + first + '/' + limit).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getRecVector: function (classificationId, recId) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/vector/' + recId);\n    },\n    create: function (classificationData, callback) {\n      $http.post('/legacy-api/project/' + Project.getUrl() + '/classifications/new', classificationData).success(callback).error(notify.serverError);\n    },\n    delete: function (classificationId, callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/classifications/' + classificationId + '/delete').success(callback).error(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.clustering-jobs', ['a2.srv.project', 'humane']).factory('a2ClusteringJobs', function ($http, Project, notify, $httpParamSerializer) {\n  return {\n    list: function (opts) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getJobDetails: function (clusteringJobId) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/' + clusteringJobId + '/job-details').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getClusteringDetails: function (opts) {\n      var config = {\n        params: opts\n      };\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.job_id + '/clustering-details', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getRoisDetails: function (opts) {\n      var params = {};\n\n      if (opts.aed) {\n        params.aed = opts.aed;\n      }\n\n      if (opts.rec_id) {\n        params.rec_id = opts.rec_id;\n      }\n\n      if (opts.search && opts.search == 'per_site') {\n        params.perSite = true;\n      } else if (opts.search && opts.search == 'per_date') {\n        params.perDate = true;\n      } else params.all = true;\n\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.jobId + '/rois-details', params).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    exportClusteringROIs: function (opts) {\n      const config = {\n        params: opts\n      };\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/' + opts.jobId + '/rois-export', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getAudioUrlFor: function (recId, aedId) {\n      return '/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/' + recId + '/audio/' + aedId;\n    },\n    audioEventDetections: function (opts) {\n      var config = {\n        params: {}\n      };\n\n      if (opts.completed) {\n        config.params.completed = opts.completed;\n      }\n\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/audio-event-detections', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    create: function (data) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/new', data).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    delete: function (clusteringJobId) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/clustering-jobs/' + clusteringJobId + '/remove').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    }\n  };\n});","angular.module('a2.srv.cnn', ['a2.srv.project', 'humane']).factory('a2CNN', function ($q, $http, Project, notify) {\n  var saveData = null;\n  return {\n    listROIs: function (job_id, limit, offset, species_id, site_id, search, callback) {\n      if (!limit) {\n        var limit = 100;\n      }\n\n      if (!offset) {\n        var offset = 0;\n      }\n\n      if (!species_id) {\n        species_id = 0;\n      }\n\n      if (!site_id) {\n        site_id = 0;\n      }\n\n      if (!search) {\n        search = \"all\";\n      }\n\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/rois/' + job_id + \"/\" + species_id + \"/\" + site_id + \"/\" + search + \"/\" + offset + \"_\" + limit).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listROIsBySpecies: function (job_id, species_id, callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/roisBySpecies/' + job_id + '/' + species_id).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listResults: function (job_id, callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/results/' + job_id).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    listModels: function (callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/models').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn').then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetailsFor: function (cnnId) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/details').then(function (response) {\n        return response.data;\n      });\n    },\n    getRoisFor: function (cnnId, limit, offset) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/rois/' + (offset || 0) + '_' + (limit || 0)).then(function (response) {\n        return response.data;\n      });\n    },\n    countROIsBySpecies: function (cnnId) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySpecies');\n    },\n    countROIsBySites: function (cnnId) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySites');\n    },\n    countROIsBySpeciesSites: function (cnnId, options) {\n      var search = \"all\";\n\n      if (options.search) {\n        search = options.search;\n      }\n\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/countROIsBySpeciesSites/' + search);\n    },\n    getExportUrl: function (params) {\n      return '/legacy-api/project/' + Project.getUrl() + '/cnn/' + params.cnnId + '/rois.csv';\n    },\n    getAudioUrlFor: function (roi) {\n      return '/legacy-api/project/' + Project.getUrl() + '/cnn/' + roi.job_id + '/audio/' + roi.cnn_result_roi_id;\n    },\n    validateRois: function (cnnId, rois, validation) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/validate', {\n        rois: rois,\n        validation: validation\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/cnn/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (cnnId) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/cnn/' + cnnId + '/remove').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.service.download-resource', []).service('$downloadResource', function ($window) {\n  return function $downloadResource(resource_url) {\n    var a = angular.element('<a></a>').attr('target', '_blank').attr('href', resource_url).appendTo('body');\n    $window.setTimeout(function () {\n      a[0].click();\n      a.remove();\n    }, 0);\n  };\n});","angular.module('a2.services', ['a2.srv.classi', 'a2.srv.models', 'a2.srv.playlists', 'a2.srv.project', 'a2.srv.sites', 'a2.srv.soundscapes', 'a2.srv.species', 'a2.srv.users', 'a2.srv.training-sets', 'a2.srv.templates', 'a2.srv.audio-event-detections-clustering', 'a2.srv.clustering-jobs']);","angular.module('a2.srv.local-storage', []).service('$localStorage', function ($window) {\n  return {\n    getItem: function (item) {\n      if ($window.localStorage) {\n        return $window.localStorage.getItem(item);\n      }\n    },\n    setItem: function (item, value) {\n      if ($window.localStorage) {\n        $window.localStorage.setItem(item, value);\n      }\n    }\n  };\n});","angular.module('a2.srv.models', ['a2.srv.project', 'humane']).factory('a2Models', function ($http, Project, notify) {\n  var saveData = null;\n  var openedModel = false;\n  return {\n    modelState: function (s) {\n      openedModel = s;\n    },\n    isModelOpen: function () {\n      return openedModel;\n    },\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/models').success(callback).error(notify.serverError);\n    },\n    getFormInfo: function (callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/models/forminfo').success(callback).error(notify.serverError);\n    },\n    findById: function (modelId) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/models/' + modelId);\n    },\n    create: function (modelData) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/models/new', modelData);\n    },\n    delete: function (modelId, callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/models/' + modelId + \"/delete\").success(callback).error(notify.serverError);\n    },\n    getValidationResults: function (modelId, callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/models/' + modelId + '/validation-list/').success(callback).error(notify.serverError);\n    },\n    getRecVector: function (modelId, recId, callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/models/' + modelId + '/training-vector/' + recId);\n    },\n    setThreshold: function (modelId, thresholdValue) {\n      var data = {\n        m: modelId,\n        t: thresholdValue\n      };\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/models/savethreshold', data);\n    }\n  };\n});","angular.module('a2.srv.news', ['a2.srv.api']).service('a2NewsService', function ($q, a2APIService) {\n  return {\n    loadPage: function (index) {\n      return a2APIService.api.get('/user/feed/' + (index | 0));\n    },\n    loadFormats: function () {\n      return a2APIService.api.get('/user/feed/formats');\n    }\n  };\n});","angular.module('a2.srv.open-modal', ['ui.bootstrap.modal']).provider('$openModal', function () {\n  var $openModalProvider = {\n    defs: {},\n    define: function (modalName, modalDef) {\n      $openModalProvider.defs[modalName] = angular.extend({}, modalDef);\n    },\n    $get: function ($modal) {\n      return function $openModal(modalName, overrides) {\n        var options = angular.extend({}, $openModalProvider.defs[modalName]);\n\n        if (overrides) {\n          if (overrides.resolve) {\n            console.log(\"overrides.resolve\", overrides.resolve);\n            options.resolve = angular.extend(options.resolve, overrides.resolve);\n            console.log(\"options.resolve\", options.resolve);\n            delete overrides.resolve;\n          }\n\n          options = angular.extend(options, overrides);\n        }\n\n        return $modal.open(options);\n      };\n    }\n  };\n  return $openModalProvider;\n});","angular.module('a2.srv.patternmatching', ['a2.srv.project', 'humane']).factory('a2PatternMatching', function ($q, $http, a2APIService, Project, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    list: function (opts, callback) {\n      const config = {\n        params: opts\n      };\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/pattern-matchings', config).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getDetailsFor: function (patternMatchingId) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/details').then(function (response) {\n        return response.data;\n      });\n    },\n    getPatternMatchingsTotal: function (callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/count').success(function (data) {\n        callback(data);\n      });\n    },\n    getRoisFor: function (patternMatchingId, limit, offset, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/pattern-matchings/' + patternMatchingId + '/rois/' + (offset || 0) + '_' + (limit || 0) + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    getSitesListFor: function (patternMatchingId, options) {\n      var query = Object.keys(options || {}).map(function (option) {\n        return option + '=' + encodeURIComponent(options[option]);\n      }).join('&');\n      return a2APIService.get('/pattern-matchings/' + patternMatchingId + '/site-index' + (query ? '?' + query : '')).catch(notify.serverError);\n    },\n    getExportUrl: function (params) {\n      return '/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/' + params.patternMatching + '/' + params.fileName + '.csv';\n    },\n    getAudioUrlFor: function (roi) {\n      const ext = '.mp3';\n      return '/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/' + roi.pattern_matching_id + '/audio/' + roi.id + ext;\n    },\n    validateRois: function (patternMatchingId, rois, validation, cls) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/validate', {\n        rois: rois,\n        validation: validation,\n        cls: cls\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (data) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/new', data).then(function (response) {\n        return response.data;\n      });\n    },\n    update: function (patternMatchingId, data) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/update', data).then(function (response) {\n        return response.data;\n      });\n    },\n    delete: function (patternMatchingId) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/pattern-matchings/' + patternMatchingId + '/remove').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.srv.playlists', ['a2.srv.project']).factory('a2Playlists', function (Project, a2APIService, $rootScope, $http) {\n  var projectName = Project.getUrl();\n  return {\n    getList: function (options) {\n      if (options) {\n        options = {\n          params: options\n        };\n      }\n\n      if (options && options.filterPlaylistLimit) {\n        options.params.filterPlaylistLimit = options.filterPlaylistLimit;\n      }\n\n      return $http.get('/legacy-api/project/' + projectName + '/playlists', options).then(function (response) {\n        return response.data;\n      });\n    },\n    create: function (playlistParams, callback) {\n      $http.post('/legacy-api/project/' + projectName + '/playlists/create', playlistParams).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    combine: function (expression) {\n      return a2APIService.post('/playlists/combine', expression).then(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        return data;\n      });\n    },\n    getRecordingPosition: function (playlist, recording, callback) {\n      var r = $http.get('/legacy-api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/position');\n\n      if (callback) {\n        r.success(callback);\n      }\n\n      return r;\n    },\n    // addData: function(playlist, tset_data, callback) {\n    //     var projectName = Project.getUrl();\n    //     $http.post('/legacy-api/project/'+projectName+'/playlists/add-data/'+playlist, tset_data).success(function(data) {\n    //         callback(data);\n    //     });\n    // },\n    getPreviousRecording: function (playlist, recording, callback) {\n      return $http.get('/legacy-api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/previous').success(function (data) {\n        callback(data);\n      });\n    },\n    getNextRecording: function (playlist, recording, callback) {\n      return $http.get('/legacy-api/project/' + projectName + '/playlists/' + playlist + '/' + recording + '/next').success(function (data) {\n        callback(data);\n      });\n    },\n    rename: function (playlist, callback) {\n      $http.post('/legacy-api/project/' + projectName + '/playlists/rename', playlist).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    remove: function (playlistIds, callback) {\n      $http.post('/legacy-api/project/' + projectName + '/playlists/delete', {\n        playlists: playlistIds\n      }).success(function (data) {\n        $rootScope.$emit('a2Playlists-invalidate-list');\n        callback(data);\n      });\n    },\n    getInfo: function (playlist, callback) {\n      $http({\n        method: 'GET',\n        url: '/legacy-api/project/' + projectName + '/playlists/info/' + playlist\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getData: function (playlist, params, callback) {\n      $http.post('/legacy-api/project/' + projectName + '/playlists/' + playlist, params).success(function (data) {\n        callback(data);\n      });\n    },\n    $on: function (event, handler) {\n      return $rootScope.$on('a2Playlists-' + event, handler);\n    },\n    attachAedToPlaylist: function (opts, callback) {\n      $http.post('/legacy-api/project/' + projectName + '/playlists/' + opts.playlist_id + '/aed', {\n        aed: opts.aed\n      }).success(function (data) {\n        callback(data);\n      });\n    }\n  };\n});","angular.module('a2.srv.project', ['a2.srv.api']).factory('Project', function ($location, $http, $q, $httpParamSerializer, a2APIService, notify) {\n  var nameRe = /\\/?(project|citizen-scientist|visualizer)\\/([\\w\\_\\-]+)/;\n  var nrm = nameRe.exec($location.absUrl());\n  var url = nrm ? nrm[2] : '';\n  return {\n    getUrl: function () {\n      return url;\n    },\n    getInfo: function (callback) {\n      $http.get('/legacy-api/project/' + url + '/info').success(function (data) {\n        callback(data);\n      });\n    },\n    getProjectById: function (projectId, callback) {\n      var config = {\n        params: {}\n      };\n\n      if (projectId) {\n        config.params.project_id = projectId;\n      }\n\n      $http.get('/legacy-api/project/' + url + '/info/source-project', config).success(function (data) {\n        callback(data);\n      });\n    },\n    updateInfo: function (info, callback) {\n      $http.post('/legacy-api/project/' + url + '/info/update', info).success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getUsage: function () {\n      return $http.get('/legacy-api/project/' + url + '/usage');\n    },\n    getSites: function (options, callback) {\n      if (typeof options == 'function') {\n        callback = options;\n        options = {};\n      }\n\n      return $q.when($http.get('/legacy-api/project/' + url + '/sites', {\n        params: options\n      })).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    },\n    getClasses: function (options, callback) {\n      if (typeof options == 'function') {\n        callback = options;\n        options = {};\n      }\n\n      return $q.when($http.get('/legacy-api/project/' + url + '/classes', {\n        params: options\n      })).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    },\n    getRecs: function (query, callback) {\n      if (typeof query === \"function\") {\n        callback = query;\n        query = {};\n      }\n\n      if (query && query.tags) {\n        query['tags[]'] = query.tags.flat();\n        delete query.tags;\n      }\n\n      $http.get('/legacy-api/project/' + url + '/recordings/search', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecCounts: function (query) {\n      if (query && query.project_url) {\n        delete query.project_url;\n      }\n\n      return a2APIService.get('/recordings/search-count', {\n        params: query || {}\n      });\n    },\n    getRecordingData: function (filters, projection) {\n      if (filters.tags) {\n        filters.tags = filters.tags.flat();\n      }\n\n      if (filters.range) {\n        filters.range.from = moment(filters.range.from).format('YYYY-MM-DD') + 'T00:00:00.000Z';\n        filters.range.to = moment(filters.range.to).format('YYYY-MM-DD') + 'T23:59:59.999Z';\n      }\n\n      var params = {\n        filters: filters,\n        show: projection\n      };\n      const getUrl = '/legacy-api/project/' + url + '/recordings/' + (projection && projection.species ? 'occupancy-models-export' : projection && projection.grouped ? 'grouped-detections-export' : 'recordings-export');\n      return $http.post(getUrl, params).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n      ;\n    },\n    getSitesExportUrl: function () {\n      return '/legacy-api/project/' + url + '/sites-export.csv';\n    },\n    getRecTotalQty: function (callback) {\n      return a2APIService.get('/recordings/count').then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getProjectTotalSpecies: function (projectId, callback) {\n      $http.get('/legacy-api/project/' + url + '/species-count', {\n        project_id: projectId\n      }).success(function (count) {\n        callback(count);\n      });\n    },\n    getProjectTimeBounds: function (callback) {\n      return a2APIService.get('/recordings/time-bounds').then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getRecordings: function (key, options, callback) {\n      if (options instanceof Function) {\n        callback = options;\n        options = {};\n      }\n\n      $http.get('/legacy-api/project/' + url + '/recordings/' + key, {\n        params: options\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingAvailability: function (key, callback) {\n      return a2APIService.get('/recordings/available/' + key).then(function (data) {\n        if (callback) {\n          callback(data);\n        }\n\n        return data;\n      });\n    },\n    getOneRecording: function (rec_id, callback) {\n      $http.get('/legacy-api/project/' + url + '/recordings/find/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingInfo: function (rec_id, callback) {\n      $http.get('/legacy-api/project/' + url + '/recordings/info/' + rec_id).success(function (data) {\n        callback(data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getNextRecording: function (rec_id, callback) {\n      $http.get('/legacy-api/project/' + url + '/recordings/next/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    getPreviousRecording: function (rec_id, callback) {\n      $http.get('/legacy-api/project/' + url + '/recordings/previous/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    validateRecording: function (rec_id, validation, callback) {\n      $http.post('/legacy-api/project/' + url + '/recordings/validate/' + rec_id, validation).success(function (data) {\n        callback(data);\n      });\n    },\n    recExists: function (site_id, filename, callback) {\n      $http.get('/legacy-api/project/' + url + '/recordings/exists/site/' + site_id + '/file/' + filename).success(function (data) {\n        callback(data.exists);\n      });\n    },\n    downloadRecording: function (rec_id, callback) {\n      $http.get('/legacy-api/project/' + url + '/recordings/download/' + rec_id).success(function (data) {\n        callback(data);\n      });\n    },\n    addClass: function (projectClass, callback) {\n      return $http.post('/legacy-api/project/' + url + '/class/add', projectClass);\n    },\n    removeClasses: function (projectClasses, callback) {\n      return $http.post('/legacy-api/project/' + url + '/class/del', projectClasses);\n    },\n    getUsers: function (callback) {\n      $http.get('/legacy-api/project/' + url + '/users').success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getRoles: function (callback) {\n      $http.get('/legacy-api/project/' + url + '/roles').success(function (data) {\n        callback(null, data);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    addUser: function (data, callback) {\n      $http.post('/legacy-api/project/' + url + '/user/add', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    removeUser: function (data, callback) {\n      $http.post('/legacy-api/project/' + url + '/user/del', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    changeUserRole: function (data, callback) {\n      $http.post('/legacy-api/project/' + url + '/user/role', data).success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getModels: function (callback) {\n      $http.get('/legacy-api/project/' + url + '/models').success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    getClassi: function (callback) {\n      $http.get('/legacy-api/project/' + url + '/classifications').success(function (response) {\n        callback(null, response);\n      }).error(function (err) {\n        callback(err);\n      });\n    },\n    validationsCount: function (callback) {\n      $http.get('/legacy-api/project/' + url + '/validations/count').success(function (response) {\n        callback(response.count);\n      });\n    },\n    validationBySpeciesSong: function (speciesId, songtypeId, callback) {\n      $http.get('/legacy-api/project/' + url + '/validations', {\n        params: {\n          species_id: speciesId,\n          sound_id: songtypeId\n        }\n      }).success(callback);\n    },\n    getProjectsList: function (ownershipType, callback) {\n      var config = {\n        params: {}\n      };\n\n      if (ownershipType) {\n        config.params.type = ownershipType;\n      }\n\n      $http.get('/legacy-api/user/projectlist', config).success(function (response) {\n        callback(response);\n      });\n    },\n    removeProject: function (data) {\n      return $http.post('/legacy-api/project/' + url + '/remove', data);\n    }\n  };\n});","angular.module('a2.srv.resolve', []).factory('$promisedResolve', function ($q, $injector) {\n  return function $resolve(resolveMap, context) {\n    context = context || {};\n    return $q.all(Object.keys(resolveMap).map(function (key) {\n      return $q.resolve().then(function () {\n        return $injector.invoke(resolveMap[key]);\n      }).then(function (value) {\n        context[key] = value;\n      });\n    })).then(function () {\n      return context;\n    });\n  };\n});","angular.module('a2.service.serialize-promised-fn', [])\n/** serializePromisedFn function decorator.\n * Decorates a promise-returning function so that\n * concurrent calls occur in a serialized manner, \n * that is, each call takes turn in a queue and gets\n * processed one at a time, in call order.\n */\n.service('serializePromisedFn', function ($q) {\n  return function serializePromisedFn(fn) {\n    var series = $q.resolve();\n    return function serializedPromisedFn() {\n      var context = this;\n      var args = Array.prototype.slice.call(arguments);\n      series = series.then(function () {\n        return fn.apply(context, args);\n      });\n      return series;\n    };\n  };\n});","angular.module('a2.srv.sites', ['a2.srv.project', 'humane']).factory('a2Sites', function ($http, $q, Project, notify) {\n  return {\n    listPublished: function (callback) {\n      $http.get('/legacy-api/sites/published').success(function (data) {\n        callback(data);\n      });\n    },\n    import: function (site, callback) {\n      $http.post('/legacy-api/project/' + Project.getUrl() + '/sites/import', {\n        site: site\n      }).success(callback);\n    },\n    update: function (site, callback) {\n      $http.post('/legacy-api/project/' + Project.getUrl() + '/sites/update', {\n        site: site\n      }).success(callback).error(notify.serverError);\n    },\n    create: function (site, callback) {\n      $http.post('/legacy-api/project/' + Project.getUrl() + '/sites/create', {\n        site: site\n      }).success(callback).error(notify.serverError);\n    },\n    delete: function (sites, callback) {\n      $http.post('/legacy-api/project/' + Project.getUrl() + '/sites/delete', {\n        sites: sites\n      }).success(callback).error(notify.serverError);\n    },\n    // Uses Promises :-)\n    getLogFiles: function (site, callback) {\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/sites/' + site + '/logs');\n    },\n    getSiteLogDataDates: function (site, series) {\n      var d = $q.defer();\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/sites/' + site + '/log/data.txt?get=dates').success(d.resolve.bind(d)).error(d.reject.bind(d));\n      return d.promise;\n    },\n    getSiteLogDataUrl: function (site, series, from, to, period) {\n      var args = 'q=' + period + '&from=' + from.getTime() + '&to=' + to.getTime();\n\n      if (/uploads/.test(series)) {\n        return $q.resolve('/legacy-api/project/' + Project.getUrl() + '/sites/' + site + '/uploads.txt?' + args);\n      } else if (/recordings/.test(series)) {\n        return $q.resolve('/legacy-api/project/' + Project.getUrl() + '/sites/' + site + '/data.txt?' + args);\n      } else {\n        return $q.resolve('/legacy-api/project/' + Project.getUrl() + '/sites/' + site + '/log/data.txt?stat=' + series + '&' + args);\n      }\n    },\n    getSiteLogData: function (site, series, from, to, period) {\n      return this.getSiteLogDataUrl(site, series, from, to, period).then(function (url) {\n        return $q.when($http.get(url));\n      }).then(function (response) {\n        var data = {};\n\n        if (response.data) {\n          data.rows = response.data.trim().split('\\n').map(function (line) {\n            return line.split(',');\n          });\n        }\n\n        return data;\n      });\n    },\n    // Get list of assets to a site\n    getListOfAssets: function (site_id) {\n      var d = $q.defer();\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/streams/' + site_id + '/assets').success(d.resolve.bind(d)).error(d.reject.bind(d));\n      return d.promise;\n    },\n    // Uses Promises\n    generateToken: function (site) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/sites/generate-token', {\n        site: site.id\n      });\n    },\n    revokeToken: function (site) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/sites/revoke-token', {\n        site: site.id\n      });\n    }\n  };\n});","angular.module('a2.srv.soundscape-composition', ['a2.srv.api']).factory('a2SoundscapeCompositionService', function ($q, a2APIService) {\n  return {\n    getClassList: function (options) {\n      options = options || {};\n      var params = {};\n\n      if (options.tally) {\n        params.tally = 1;\n      }\n\n      if (options.isSystemClass) {\n        params.isSystemClass = 1;\n      }\n\n      return a2APIService.get('/soundscape-composition/classes', {\n        params: params\n      }).then(function (classList) {\n        if (options.groupByType) {\n          return classList.reduce(function (_, item) {\n            if (!_.index[item.typeId]) {\n              _.list.push(_.index[item.typeId] = {\n                type: item.type,\n                typeId: item.typeId,\n                list: []\n              });\n            }\n\n            _.index[item.typeId].list.push(item);\n\n            return _;\n          }, {\n            list: [],\n            index: {}\n          }).list;\n        } else {\n          return classList;\n        }\n      });\n    },\n    addClass: function (name, typeId) {\n      return a2APIService.post('/soundscape-composition/add-class', {\n        name: name,\n        type: typeId\n      });\n    },\n    removeClass: function (scClassid) {\n      return a2APIService.post('/soundscape-composition/remove-class', {\n        id: scClassid\n      });\n    },\n    getAnnotationsFor: function (visobject) {\n      if (visobject && /^recording$/.test(visobject.type)) {\n        return a2APIService.get('/soundscape-composition/annotations/' + (visobject.id | 0));\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    annotate: function (visobject, annotation) {\n      if (visobject && /^recording$/.test(visobject.type)) {\n        return a2APIService.post('/soundscape-composition/annotate/' + (visobject.id | 0), annotation);\n      } else {\n        return $q.reject(new Error(\"Cannot add soundscape composition annotation\" + (visobject ? \" to \" + visobject.type : \"\") + \".\"));\n      }\n    }\n  };\n});","angular.module('a2.srv.soundscapes', ['a2.srv.project', 'humane']).factory('a2Soundscapes', function (Project, $http, $q, notify) {\n  var saveData = null;\n  return {\n    saveState: function (data) {\n      saveData = data;\n    },\n    getState: function () {\n      return saveData;\n    },\n    getAmplitudeReferences: function () {\n      return $q.resolve([{\n        value: 'absolute',\n        caption: \"Absolute\",\n        description: \"The threshold is taken as an absolute value of the amplitude of each peak.\"\n      }, {\n        value: 'relative-to-peak-maximum',\n        caption: \"Relative to maximum\",\n        description: \"The threshold is taken as a relative proportion of the maximum amplitude of the peaks in the soundscape.\"\n      }]);\n    },\n    get: function (soundscapeId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId).success(function (data) {\n        callback(data);\n      });\n    },\n    getSCIdx: function (soundscapeId, params, callback) {\n      if (params instanceof Function) {\n        callback = params;\n        params = undefined;\n      }\n\n      if (!params) {\n        params = {};\n      }\n\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/scidx', {\n        params: params\n      }).success(function (data) {\n        if (callback) callback(data);\n        d.resolve(data);\n      });\n      return d.promise;\n    },\n    getNormVector: function (soundscapeId, callback) {\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/norm-vector').success(function (data) {\n        if (callback) callback(data);\n        d.resolve(data);\n      });\n      return d.promise;\n    },\n    // TODO fusion getList and getList2 routes to return needed data\n    getList: function (query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = {};\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getList2: function (callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/soundscapes/details').success(callback).error(notify.serverError);\n    },\n    setVisualizationOptions: function (soundscapeId, params, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/scale', params).success(function (data) {\n        callback(data);\n      });\n    },\n    addRegion: function (soundscapeId, bbox, params, callback) {\n      var projectName = Project.getUrl();\n      params.bbox = bbox;\n      $http.post('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/add', params).success(function (data) {\n        callback(data);\n      });\n    },\n    sampleRegion: function (soundscapeId, region, params, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/sample', params).success(function (data) {\n        callback(data);\n      });\n    },\n    getExportUrl: function (options) {\n      var soundscapeId = options.soundscape.soundscape_id;\n      var d = $q.defer();\n      var projectName = Project.getUrl();\n      var args = [];\n\n      if (options.raw) {\n        args.push('raw=1');\n      }\n\n      d.resolve('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/export-list' + (args.length ? '?' + args.join('&') : ''));\n      return d.promise;\n    },\n    getRegion: function (soundscapeId, region, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordingTags: function (soundscapeId, region, recording, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording).success(function (data) {\n        callback(data);\n      });\n    },\n    addRecordingTag: function (soundscapeId, region, recording, tag, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording + '/add', {\n        tag: tag\n      }).success(callback);\n    },\n    removeRecordingTag: function (soundscapeId, region, recording, tag, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions/' + region + '/tags/' + recording + '/remove', {\n        tag: tag\n      }).success(callback);\n    },\n    getRegions: function (soundscapeId, query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = undefined;\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/regions', {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    getRecordings: function (soundscapeId, bbox, query, callback) {\n      if (query instanceof Function) {\n        callback = query;\n        query = {};\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/soundscapes/' + soundscapeId + '/recordings/' + bbox, {\n        params: query\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    // TODO change method to receive id\n    findIndices: function (soundscapeId, callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/soundscapes/' + soundscapeId + '/indices').success(callback);\n    },\n    delete: function (soundscapeId, callback) {\n      $http.get('/legacy-api/project/' + Project.getUrl() + '/soundscapes/' + soundscapeId + \"/delete\").success(callback).error(notify.serverError);\n    },\n    create: function (soundscapeData) {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/soundscape/new', soundscapeData);\n    }\n  };\n});","angular.module('a2.srv.species', []).factory('Species', function ($http) {\n  var species;\n  return {\n    get: function (callback) {\n      if (species) return callback(species);\n      $http.get('/legacy-api/species/list/100').success(function (data) {\n        species = data;\n        callback(species);\n      });\n    },\n    search: function (query, callback) {\n      $http.get('/legacy-api/species/search', {\n        params: {\n          q: query\n        }\n      }).success(function (data) {\n        callback(data);\n      });\n    },\n    findById: function (species_id, callback) {\n      return $http.get('/legacy-api/species/' + species_id).then(function (response) {\n        if (callback) {\n          callback(response.data);\n        }\n\n        return response.data;\n      });\n    }\n  };\n}).factory('Songtypes', function ($http) {\n  var songs;\n\n  var searchId = function (id, callback) {\n    var s = songs.filter(function (song) {\n      return song.id === id;\n    });\n    if (s !== null) callback(s[0]);\n  };\n\n  return {\n    get: function (callback) {\n      if (songs) return callback(songs);\n      $http.get('/legacy-api/songtypes/all').success(function (data) {\n        songs = data;\n        callback(songs);\n      });\n    },\n    findById: function (songtype_id, callback) {\n      if (songs) {\n        searchId(songtype_id, callback);\n        return;\n      }\n\n      $http.get('/legacy-api/songtypes/all').success(function (data) {\n        songs = data;\n        searchId(songtype_id, callback);\n      });\n    }\n  };\n}).factory('SpeciesTaxons', function ($http) {\n  var speciesTaxons;\n  return {\n    getList: function (callback) {\n      if (speciesTaxons) return callback(speciesTaxons);\n      $http.get('/legacy-api/species_taxons/all').success(function (data) {\n        speciesTaxons = data;\n        callback(speciesTaxons);\n      });\n    }\n  };\n});","angular.module('a2.srv.tags', ['a2.srv.api']).factory('a2Tags', function ($q, a2APIService, notify) {\n  function isTaggableType(type) {\n    return /^recording$/.test('' + type);\n  }\n\n  function isTaggableResource(obj) {\n    return obj && isTaggableType(obj.type) && obj.id;\n  }\n\n  return {\n    getFor: function (visobject) {\n      if (isTaggableResource(visobject)) {\n        return a2APIService.get('/tags/' + visobject.type + '/' + (visobject.id | 0));\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    getForType: function (resourceType) {\n      if (isTaggableType(resourceType)) {\n        return a2APIService.get('/tags/' + resourceType);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    deleteFor: function (visobject, tagId) {\n      if (isTaggableResource(visobject)) {\n        return a2APIService.delete('/tags/' + visobject.type + '/' + (visobject.id | 0) + '/' + tagId);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    addFor: function (visobject, tag) {\n      if (isTaggableResource(visobject)) {\n        var data = {};\n\n        if (tag.tag_id) {\n          data.id = tag.tag_id;\n        } else {\n          data.text = tag.tag;\n        }\n\n        if (tag.t0 !== undefined) {\n          data.t0 = tag.t0;\n          data.f0 = tag.f0;\n          data.t1 = tag.t1;\n          data.f1 = tag.f1;\n        }\n\n        return a2APIService.put('/tags/' + visobject.type + '/' + (visobject.id | 0), data).catch(notify.serverError);\n      } else {\n        return $q.resolve([]);\n      }\n    },\n    search: function (text) {\n      return a2APIService.get('/tags/?q=' + text);\n    }\n  };\n});","angular.module('a2.srv.templates', ['a2.srv.project']).factory('a2Templates', function (Project, $http, notify) {\n  return {\n    getList: function (opts) {\n      var projectName = Project.getUrl();\n      var config = {\n        params: {}\n      };\n\n      if (opts && opts.showRecordingUri) {\n        config.params.showRecordingUri = opts.showRecordingUri;\n      }\n\n      if (opts && opts.projectTemplates) {\n        config.params.projectTemplates = opts.projectTemplates;\n      }\n\n      if (opts && opts.publicTemplates) {\n        config.params.publicTemplates = opts.publicTemplates;\n      }\n\n      if (opts && opts.q) {\n        config.params.q = opts.q;\n      }\n\n      if (opts && opts.taxon) {\n        config.params.taxon = opts.taxon;\n      }\n\n      if (opts && opts.limit) {\n        config.params.limit = opts.limit;\n      }\n\n      if (opts && opts.offset !== undefined) {\n        config.params.offset = opts.offset;\n      }\n\n      return $http.get('/legacy-api/project/' + projectName + '/templates', config).then(function (response) {\n        return response.data;\n      });\n    },\n    count: function (opts) {\n      var config = {\n        params: {}\n      };\n\n      if (opts && opts.publicTemplates) {\n        config.params.publicTemplates = opts.publicTemplates;\n      }\n\n      return $http.get('/legacy-api/project/' + Project.getUrl() + '/templates/count', config).then(function (response) {\n        return response.data;\n      });\n    },\n    add: function (template_data) {\n      var projectName = Project.getUrl();\n      return $http.post('/legacy-api/project/' + projectName + '/templates/add', template_data).then(function (response) {\n        return response.data;\n      }).catch(notify.serverError);\n    },\n    getAudioUrlFor: function (template) {\n      const ext = '.mp3';\n      return '/legacy-api/project/' + Project.getUrl() + '/templates/audio/' + template.id + ext;\n    },\n    delete: function (templateId) {\n      var projectName = Project.getUrl();\n      return $http.post('/legacy-api/project/' + projectName + '/templates/' + templateId + '/remove');\n    },\n    getImage: function (templateId) {\n      var projectName = Project.getUrl();\n      return $http.get('/legacy-api/project/' + projectName + '/templates/data/' + templateId + '/image').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.srv.training-sets', ['a2.srv.project']).factory('a2TrainingSets', function (Project, $http) {\n  return {\n    getList: function (callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/training-sets').success(function (data) {\n        callback(data);\n      });\n    },\n    add: function (tset_data, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/legacy-api/project/' + projectName + '/training-sets/add', tset_data).success(function (data) {\n        callback(data);\n      });\n    },\n    edit: function (trainingSetId, tset_data) {\n      var projectName = Project.getUrl();\n      return $http.post('/legacy-api/project/' + projectName + '/training-sets/edit/' + trainingSetId, tset_data);\n    },\n    delete: function (trainingSetId) {\n      var projectName = Project.getUrl();\n      return $http.post('/legacy-api/project/' + projectName + '/training-sets/remove/' + trainingSetId);\n    },\n    addData: function (trainingSetId, tset_data, callback) {\n      var projectName = Project.getUrl();\n      $http.post('/legacy-api/project/' + projectName + '/training-sets/add-data/' + trainingSetId, tset_data).success(function (data) {\n        callback(data);\n      });\n    },\n    getData: function (trainingSetId, recording_uri, callback) {\n      if (recording_uri instanceof Function) {\n        callback = recording_uri;\n        recording_uri = \"\";\n      }\n\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/training-sets/list/' + trainingSetId + '/' + recording_uri).success(function (data) {\n        callback(data);\n      });\n    },\n    getDataImage: function (trainingSetId, dataId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/training-sets/data/' + trainingSetId + '/get-image/' + dataId).success(function (data) {\n        callback(data);\n      });\n    },\n    getTypes: function (callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/training-sets/types').success(function (data) {\n        callback(data);\n      });\n    },\n    getRois: function (trainingSetId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/training-sets/rois/' + trainingSetId).success(function (data) {\n        callback(data);\n      });\n    },\n    getExportUrl: function (trainingSetId) {\n      var projectName = Project.getUrl();\n      return '/legacy-api/project/' + projectName + '/training-sets/rois/' + trainingSetId + '?export=1';\n    },\n    getSpecies: function (trainingSetId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/training-sets/species/' + trainingSetId).success(function (data) {\n        callback(data);\n      });\n    },\n    removeRoi: function (trainingSetId, roiId, callback) {\n      var projectName = Project.getUrl();\n      $http.get('/legacy-api/project/' + projectName + '/training-sets/' + trainingSetId + '/remove-roi/' + roiId).success(function (data) {\n        callback(data);\n      });\n    }\n  };\n});","angular.module('a2.srv.uploads', ['a2.srv.api']).factory('a2UploadsService', function (a2APIService) {\n  return {\n    getProcessingList: function (opts) {\n      const config = {\n        params: opts\n      };\n      return a2APIService.get('/uploads/processing', config).then(function (data) {\n        return data;\n      });\n    },\n    checkStatus: function (opts) {\n      const config = {\n        params: opts\n      };\n      return a2APIService.get('/uploads/check', config).then(function (data) {\n        return data.items;\n      });\n    }\n  };\n});","angular.module('a2.srv.users', []).factory('Users', function ($http) {\n  var users;\n  return {\n    getInfoForId: function (user_id) {\n      return $http.get('/legacy-api/user/info/' + user_id).then(function (response) {\n        return response.data.user;\n      });\n    }\n  };\n});","angular.module('a2.filters', ['a2.filter.as-csv', 'a2.filter.caps', 'a2.filter.a2-page-number-to-title', 'a2.filter.a2-page-title-to-number', 'a2.filter.project-url', 'a2.filter.range', 'a2.filter.round', 'a2.filter.time-from-now']);","angular.module('a2.filter.as-csv', []).filter('asCSV', function () {\n  return function (value, delimiter, filter) {\n    if (!(value instanceof Array)) {\n      if (typeof value == 'object') {\n        value = Object.keys(value).map(function (key) {\n          return key + \"=\" + (value[key] === undefined ? '' : value[key]);\n        });\n      } else {\n        value = [value];\n      }\n    }\n\n    if (filter) {\n      value = value.filter(function (v) {\n        return !!v;\n      });\n    }\n\n    return value.join(delimiter || ', ');\n  };\n});","angular.module('a2.filter.caps', []).filter('caps', function () {\n  return function (input, type) {\n    if (!input) {\n      return undefined;\n    }\n\n    switch (type || 'title') {\n      case 'title-case':\n        return input.replace(/\\b\\w/g, function (_) {\n          return _.toUpperCase();\n        });\n\n      default:\n        return input;\n    }\n  };\n});","angular.module('a2.filter.a2-page-number-to-title', []).filter('a2PageNumberToTitle', function () {\n  return function a2PageNumberToTitle(page_number) {\n    return page_number + 1;\n  };\n});","angular.module('a2.filter.a2-page-title-to-number', []).filter('a2PageTitleToNumber', function () {\n  return function a2PageTitleToNumber(page_title) {\n    var page_number;\n\n    if (!isFinite(page_title) || page_title === '') {\n      page_number = '';\n    } else if (page_title == '0') {\n      page_number = 9;\n    } else {\n      page_number = page_title - 1;\n    }\n\n    return page_number;\n  };\n});","angular.module('a2.filter.project-url', []).filter('projectUrl', function (a2APIService) {\n  return function (url) {\n    return a2APIService.project.getUrl(url);\n  };\n});","angular.module('a2.filter.range', []).filter('a2Range', function () {\n  return function (from, to, step) {\n    if (!to) {\n      to = from;\n      from = 0;\n    }\n\n    if (!step) {\n      step = Math.sign(to - from);\n    }\n\n    var stepSign = Math.sign(step);\n    var list = [];\n\n    if (step != 0) {\n      for (var i = from; (i - to) * stepSign < 0; i += step) {\n        list.push(i);\n      }\n    }\n\n    return list;\n  };\n});","angular.module('a2.filter.round', []).filter('round', function () {\n  return function (val, precision) {\n    precision = precision || 1;\n    return (val / precision | 0) * precision || 0;\n  };\n});","angular.module('a2.filter.time-from-now', []).filter('timeFromNow', function () {\n  return function (input, fmt) {\n    if (!input) return undefined;\n    return moment(input).fromNow();\n  };\n});","angular.module('a2.orders.change-project-plan', ['a2.orders.order-utils', 'a2.orders.orders', 'ui.bootstrap', 'humane', 'a2.directives', 'a2.services']).controller('ChangeProjectPlanCtrl', function ($scope, orderData, Project, $window, a2order, $modalInstance, notify, a2orderUtils) {\n  $scope.today = new Date();\n  console.log(orderData);\n  $scope.recorderQty = orderData.recorderQty;\n  a2orderUtils.getOrdersContact().then(function (response) {\n    $scope.ordersContact = response.data;\n  });\n  a2orderUtils.paymentsStatus().then(function (response) {\n    $scope.autoPaymentsEnabled = response.data.payments_enable;\n  });\n  Project.getInfo(function (info) {\n    $scope.project = info;\n    $scope.currentPlan = {\n      storage: info.storage_limit,\n      processing: info.processing_limit,\n      duration: info.plan_period,\n      tier: info.tier,\n      activation: info.plan_activated,\n      creation: info.plan_created\n    };\n\n    if ($scope.currentPlan.activation && $scope.currentPlan.duration) {\n      var due = new Date($scope.currentPlan.activation);\n      due.setFullYear(due.getFullYear() + $scope.currentPlan.duration);\n      $scope.currentPlan.due = due;\n    }\n\n    if ($scope.currentPlan.due && $scope.currentPlan.due < $scope.today) {\n      $scope.mode = 'renew';\n    } else if ($scope.currentPlan.duration) {\n      $scope.mode = 'upgrade';\n    } else {\n      $scope.mode = 'new';\n    }\n\n    $scope.project.plan = orderData.project && orderData.project.plan || {};\n    Project.getUsage().success(function (usage) {\n      $scope.minUsage = usage.min_usage;\n    });\n  });\n\n  $scope.upgrade = function () {\n    if (!$scope.autoPaymentsEnabled) {\n      return notify.log('Payments are unavailable');\n    }\n\n    if ($scope.mode == 'renew') {\n      if ($scope.project.plan.storage < $scope.minUsage) {\n        notify.error('Please select a plan with more capacity or delete recordings from the project');\n        return;\n      }\n    } else {\n      if ($scope.currentPlan.storage && $scope.project.plan.storage - $scope.currentPlan.storage <= 0) {\n        notify.error('To upgrade select a plan with more capacity than the current');\n        return;\n      }\n    }\n\n    orderData = {\n      action: 'update-project',\n      project: $scope.project,\n      recorderQty: $scope.recorderQty,\n      mode: $scope.mode\n    };\n\n    if ($scope.recorderQty > 0 && $scope.project.plan.tier == 'paid') {\n      a2order.enterShippingAddress(orderData);\n    } else {\n      a2order.reviewOrder(orderData);\n    }\n\n    $modalInstance.dismiss();\n  };\n});","angular.module('a2.orders.create-project', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.plan-selection', 'a2.orders.project-order-service', 'ui.bootstrap', 'humane']).controller('CreateProjectCtrl', function ($scope, $http, $modalInstance, $modal, notify, a2order, orderData, a2orderUtils, ProjectOrderService) {\n  $scope.project = orderData.project;\n  $scope.recorderQty = orderData.recorderQty;\n  a2orderUtils.getOrdersContact().then(function (response) {\n    $scope.ordersContact = response.data;\n  });\n  a2orderUtils.paymentsStatus().then(function (response) {\n    $scope.autoPaymentsEnabled = response.data.payments_enable;\n  });\n\n  $scope.create = function () {\n    console.log($scope.isValid);\n\n    if (!$scope.isValid) {\n      return;\n    }\n\n    return ProjectOrderService.makeOrder('create-project', $scope.project, $scope.recorderQty, {\n      autoPaymentsEnabled: $scope.autoPaymentsEnabled\n    }).then(function (order) {\n      console.log(order); // if user added recorders to paid order show shipping address form\n\n      if (order.hasCoupon || !order.isPaidProject) {\n        return ProjectOrderService.placeOrder(order.data).then(function () {\n          return $modalInstance.close();\n        });\n      } else if (order.isPaidProject && order.data.recorderQty > 0) {\n        a2order.enterShippingAddress(order.data);\n        $modalInstance.dismiss();\n      } else {\n        a2order.reviewOrder(order.data);\n        $modalInstance.dismiss();\n      }\n    });\n  };\n});","angular.module('a2.orders.order-summary', ['a2.orders.orders', 'a2.orders.order-utils', 'a2.orders.project-order-service', 'ui.bootstrap', 'humane']).controller('OrderSummaryCtrl', function ($scope, $http, $modalInstance, orderData, notify, $window, a2order, a2orderUtils, ProjectOrderService) {\n  if (orderData.address) {\n    $scope.address = orderData.address;\n  }\n\n  $scope.type = orderData.mode == 'upgrade' ? 'upgrade' : 'new';\n  $scope.info = a2orderUtils.info;\n  $scope.shipping = orderData.shipping || 0;\n  $scope.project = orderData.project;\n  $scope.plan = orderData.project.plan;\n  $scope.recorderQty = orderData.recorderQty || 0;\n\n  $scope.changeItems = function () {\n    if (orderData.action == 'create-project') {\n      a2order.createProject(orderData);\n    } else {\n      a2order.changePlan(orderData);\n    }\n\n    $modalInstance.dismiss();\n  };\n\n  $scope.editAddress = function () {\n    a2order.enterShippingAddress(orderData);\n    $modalInstance.dismiss();\n  };\n\n  $scope.submit = function () {\n    $scope.waiting = true;\n    console.log(orderData);\n    return ProjectOrderService.placeOrder(orderData).then(function (data) {\n      console.log(data);\n\n      if (data.message) {\n        // if free project notify project was created\n        $modalInstance.close();\n      } else if (data.approvalUrl) {\n        // else redirect to paypal\n        $window.location.assign(data.approvalUrl);\n      }\n\n      $scope.waiting = false;\n    }).catch(function (err) {\n      $scope.waiting = false;\n    });\n  };\n});","angular.module('a2.orders.order-utils', []).service('a2orderUtils', function ($http) {\n  return {\n    /**\n        receives a plan activation date and duration period, and calculates \n        how many month are left until the plan is due\n        @param [Date] acticationDate\n        @param [Number] period\n    */\n    monthsUntilDue: function (acticationDate, period) {\n      var d = new Date(acticationDate);\n      var totalMonths = period * 12;\n      var today = new Date();\n      var currentMonth;\n\n      for (var i = 0; i <= totalMonths; i++) {\n        var month = new Date(d.getFullYear(), d.getMonth() + i, d.getDate());\n\n        if (today <= month) {\n          currentMonth = i - 1;\n          break;\n        }\n      }\n\n      return totalMonths - currentMonth;\n    },\n    paymentsStatus: function () {\n      return $http.get('/legacy-api/orders/payments-status', {\n        cache: true\n      });\n    },\n    checkCouponCode: function (code, project) {\n      return $http.post('/legacy-api/orders/check-coupon', {\n        hash: code,\n        project: project\n      }).then(function (response) {\n        return response.data;\n      });\n    },\n    getOrdersContact: function () {\n      return $http.get('/legacy-api/orders/contact', {\n        cache: true\n      });\n    },\n    info: {\n      recorder: {\n        name: 'Arbimon Recorder',\n        description: \"includes an Android device preset for acoustic monitoring, \" + \"waterproof case(IP67), microphone, 6500mAh lithium-ion battery \" + \"and USB charger\",\n        priceWithPlan: 125,\n        priceNoPlan: 300\n      },\n      plan: {\n        new: {\n          name: \"Project data plan\",\n          description: function (plan) {\n            return \"includes storage for \" + plan.storage + \" minutes of audio \" + \"and capacity to process \" + plan.processing + \" minutes of audio \" + \"per year, for a term of \" + plan.duration + \" year(s)\";\n          }\n        },\n        upgrade: {\n          name: \"Project data plan upgrade\",\n          description: function (plan) {\n            return \"upgrade your plan storage to \" + plan.storage + \" minutes of audio \" + \"and capacity to process \" + plan.processing + \" minutes of audio \" + \"per year, until this plan due\";\n          }\n        }\n      }\n    }\n  };\n});","angular.module('a2.orders.orders', ['a2.orders.create-project', 'a2.orders.change-project-plan', 'a2.orders.shipping-form', 'a2.orders.order-summary', 'ui.bootstrap']).service('a2order', function ($modal) {\n  var formOpener = function (orderData, view) {\n    var modalOptions = {\n      resolve: {\n        orderData: function () {\n          return orderData;\n        }\n      },\n      backdrop: 'static',\n      templateUrl: view.templateUrl,\n      controller: view.controller\n    };\n    return $modal.open(modalOptions);\n  };\n\n  return {\n    createProject: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/create-project.html',\n        controller: 'CreateProjectCtrl'\n      });\n      return modalInstance;\n    },\n    changePlan: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/change-plan.html',\n        controller: 'ChangeProjectPlanCtrl'\n      });\n      return modalInstance;\n    },\n    enterShippingAddress: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/shipping-address.html',\n        controller: 'ShippingFormCtrl'\n      });\n      return modalInstance;\n    },\n    reviewOrder: function (orderData) {\n      var modalInstance = formOpener(orderData, {\n        templateUrl: '/orders/order-summary.html',\n        controller: 'OrderSummaryCtrl'\n      });\n      return modalInstance;\n    }\n  };\n});","angular.module('a2.orders.directives.plan-capacity', ['a2.orders.plan-selection', 'countries-list', 'ui.bootstrap', 'humane', 'a2.directives', 'a2.services']).directive('planCapacity', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'disabled': '=',\n      'minutes': '='\n    },\n    templateUrl: '/orders/plan-capacity.html',\n    link: function (scope, element, attrs) {\n      if (!attrs.enabled) {\n        scope.enabled = true;\n      }\n    }\n  };\n});","angular.module('a2.orders.plan-selection', ['countries-list', 'ui.bootstrap', 'humane', 'a2.orders.directives.plan-capacity', 'a2.orders.directives.tier-select', 'a2.directives', 'a2.services']).controller('PlanSelectionCtrl', function ($scope, a2orderUtils) {\n  const freePlan = {\n    // Changes must be matched in app/model/projects.js\n    tier: 'free',\n    cost: 0,\n    storage: 100000,\n    processing: 10000000\n  };\n  this.coupon = {\n    code: '',\n    validation: null\n  };\n\n  this.checkCouponCode = function () {\n    if (this.coupon.code) {\n      this.coupon.validation = {\n        class: 'fa fa-spinner fa-spin'\n      };\n      delete this.coupon.payload;\n      delete $scope.plan.coupon;\n      return a2orderUtils.checkCouponCode(this.coupon.code, this.project).then(function (code) {\n        if (code.valid) {\n          $scope.plan.coupon = code;\n          this.coupon.payload = code.payload;\n          this.coupon.validation = {\n            valid: true,\n            class: 'fa fa-check text-success'\n          };\n        } else {\n          this.coupon.validation = {\n            valid: false,\n            class: 'fa fa-times text-danger'\n          };\n        }\n      }.bind(this), function () {\n        this.coupon.validation = {\n          valid: false,\n          class: 'fa fa-times text-danger'\n        };\n      }.bind(this));\n    } else {\n      delete this.coupon.validation;\n    }\n  };\n\n  $scope.plan = freePlan;\n  $scope.recorderOptions = 0;\n  $scope.planMinutes = $scope.planMinutes || freePlan.storage;\n  $scope.planYears = $scope.planYears || 1;\n  $scope.upgradeOnly = false;\n  $scope.recorderQty = $scope.recorderQty || 0;\n  console.log($scope.plan);\n  this.hasCouponCode = false;\n  this.planData = {\n    yearOptions: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n  };\n  $scope.$watch('currentPlan', function () {\n    if (!$scope.currentPlan) return;\n    var due = new Date($scope.currentPlan.activation);\n    due.setFullYear(due.getFullYear() + $scope.currentPlan.duration);\n    $scope.planYears = $scope.currentPlan.duration || 1;\n    $scope.planMinutes = $scope.currentPlan.storage >= freePlan.storage ? $scope.currentPlan.storage : freePlan.storage;\n\n    if ($scope.currentPlan.tier == 'paid' && (!$scope.currentPlan.activation || new Date() < due)) {\n      $scope.upgradeOnly = true;\n      $scope.plan.tier = 'paid';\n    }\n  });\n  $scope.$watch('plan', function (value) {\n    if ($scope.plan) {\n      if ($scope.plan.storage) $scope.planMinutes = $scope.plan.storage;\n      if ($scope.plan.duration) $scope.planYears = $scope.plan.duration;\n    }\n  });\n  $scope.$watch('plan.tier', function (value) {\n    if (!$scope.plan) return;\n\n    if ($scope.plan.tier == 'paid') {\n      $scope.plan.cost = $scope.planMinutes * 0.03 * $scope.planYears;\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n      console.log($scope.plan);\n    } else if ($scope.plan.tier == 'free') {\n      $scope.plan.cost = freePlan.cost;\n      $scope.plan.storage = freePlan.storage;\n      $scope.plan.processing = freePlan.processing;\n      $scope.plan.duration = undefined;\n    }\n  });\n\n  var updatePlan = function () {\n    $scope.plan = $scope.plan || {};\n\n    if ($scope.upgradeOnly) {\n      if ($scope.currentPlan.storage > $scope.planMinutes) {\n        $scope.planMinutes = $scope.currentPlan.storage;\n      }\n\n      var planStarts = $scope.currentPlan.activation || $scope.currentPlan.creation;\n      var monthsLeft = a2orderUtils.monthsUntilDue(planStarts, $scope.currentPlan.duration);\n      console.log('planStarts', planStarts);\n      console.log('monthsLeft', monthsLeft);\n      $scope.plan.cost = ($scope.planMinutes - $scope.currentPlan.storage) * monthsLeft * (0.03 / 12);\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n    } else {\n      if ($scope.usage && $scope.usage > $scope.planMinutes) {\n        $scope.planMinutes = Math.ceil($scope.usage / 5000) * 5000;\n      }\n\n      $scope.plan.cost = $scope.planMinutes * $scope.planYears * 0.03;\n      $scope.plan.storage = +$scope.planMinutes;\n      $scope.plan.processing = $scope.planMinutes * 100;\n      $scope.plan.duration = $scope.planYears;\n      var recorderCap = Math.floor($scope.planMinutes / 10000) * $scope.planYears;\n      $scope.recorderQty = $scope.recorderQty || 0;\n\n      if ($scope.recorderQty > recorderCap) {\n        $scope.recorderQty = recorderCap;\n      }\n\n      $scope.recorderOptions = new Array(recorderCap + 1);\n    }\n  };\n\n  this.updatePlan = updatePlan;\n  $scope.$watch('planMinutes', updatePlan);\n  $scope.$watch('planYears', updatePlan);\n}).directive('planSelect', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'project': '=',\n      'plan': '=',\n      'recorderQty': '=',\n      'availablePlans': '=',\n      'ordersContact': '=',\n      'autoPaymentsEnabled': '=',\n      'currentPlan': '=?',\n      'usage': '=?'\n    },\n    templateUrl: '/orders/select-plan.html',\n    controller: 'PlanSelectionCtrl as controller',\n    link: function (scope, element, attrs, controller) {\n      scope.$watch('project', function (project) {\n        controller.project = project;\n      });\n    }\n  };\n});","angular.module('a2.orders.process-order', []).controller('ProcessOrderCtrl', function ($scope, $http, $window, $location) {\n  var reOrderId = /\\/process-order\\/([\\w\\-\\d]+)/;\n  var result = reOrderId.exec($window.location.pathname);\n  var orderId = result !== null ? result[1] : '';\n  console.log('orderId:', orderId);\n  $scope.processing = true;\n  $http.post('/legacy-api/orders/process/' + orderId + $window.location.search).success(function (data) {\n    console.log('data', data);\n    $scope.invoice = {\n      items: data.invoice.item_list.items,\n      amount: data.invoice.amount,\n      number: data.orderNumber,\n      user: data.user\n    };\n\n    if (data.invoice.item_list.shipping_address) {\n      $scope.invoice.address = data.invoice.item_list.shipping_address;\n    }\n\n    $scope.action = data.action;\n    $scope.processing = false;\n    $scope.success = true;\n  }).error(function (data, status) {\n    if (status == 404) {\n      $scope.notFound = true;\n    } else if (status == 400 && data.error == 'APPROVAL_NEEDED') {\n      $scope.needApproval = true;\n      $scope.approvalLink = data.approvalLink;\n    } else if (status == 400 && data.error == 'ALREADY_PROCESSED') {\n      $scope.alreadyProcessed = true;\n    } else {\n      $scope.errorOcurred = true;\n    }\n\n    $scope.processing = false;\n  });\n});","angular.module('a2.orders.project-order-service', ['humane']).factory(\"ProjectOrderService\", function ($q, $filter, $http, notify) {\n  var currencyFilter = $filter('currency');\n  var ProjectOrderService = {\n    placeOrder: function (orderData) {\n      if (!/(create|update)-project/.test(orderData.action)) {\n        return $q.reject(\"Invalid action \" + orderData.action);\n      }\n\n      var data = angular.merge({}, orderData);\n      delete data.action;\n      return $http.post('/legacy-api/orders/' + orderData.action, orderData).then(function (response) {\n        var data = response.data; // notify any succesfull messages\n\n        if (data.message) {\n          notify.log(data.message);\n        }\n\n        return data;\n      }).catch(function (response) {\n        var err = response.data;\n        console.log(\"err\", err);\n        console.log(\"err resp\", response);\n\n        if (err) {\n          if (err.freeProjectLimit) {\n            notify.error('You already have own a free project, ' + 'the limit is one per user.');\n          } else if (err.nameExists) {\n            notify.error('Name <b>' + orderData.project.name + '</b> not available.');\n          } else if (err.urlExists) {\n            notify.error('URL <b>' + orderData.project.url + '</b> is taken, choose another one.');\n          } else {\n            notify.serverError();\n          }\n        }\n\n        throw err;\n      });\n    },\n    makeOrder: function (action, project, recorderQty, settings) {\n      console.log(\"makeOrder\", action, project, recorderQty, settings);\n\n      if (!project || !project.plan) {\n        return $q.reject(new Error('You need to select a plan'));\n      }\n\n      var isPaidProject = project.plan.tier == 'paid';\n      var coupon = project.plan.coupon && project.plan.coupon.valid ? project.plan.coupon : undefined;\n      settings.recorderCost = settings.recorderCost || 125;\n      settings.projectCostLimit = settings.projectCostLimit || 10000;\n\n      if (coupon) {\n        project = angular.merge({}, project);\n        delete project.plan;\n      } else if (isPaidProject) {\n        if (!settings.autoPaymentsEnabled) {\n          return $q.reject(new Error('Payments are unavailable'));\n        } // don't process orders over $10,000\n\n\n        if (project.plan.cost + recorderQty * settings.recorderCost > settings.projectCostLimit) {\n          return $q.reject(new Error('Cannot process order greater than ' + currencyFilter(settings.projectCostLimit)));\n        }\n      }\n\n      return $q.resolve({\n        hasCoupon: !!coupon,\n        isPaidProject: isPaidProject,\n        data: {\n          action: action,\n          coupon: coupon ? coupon.hash : undefined,\n          project: project,\n          recorderQty: recorderQty\n        }\n      });\n    }\n  };\n  return ProjectOrderService;\n});","angular.module('a2.orders.shipping-form', ['a2.orders.orders', 'countries-list', 'ui.bootstrap']).controller('ShippingFormCtrl', function ($scope, $http, $modalInstance, $modal, orderData, countries, a2order) {\n  if (!orderData.address) {\n    $http.get('/legacy-api/user/address').success(function (data) {\n      $scope.address = data.address || {};\n    });\n  } else {\n    $scope.address = orderData.address;\n  }\n\n  countries.get(function (data) {\n    $scope.countries = data;\n  });\n\n  $scope.verify = function () {\n    // TODO this method should validate form and call server to get shipping cost\n    $http.post('/legacy-api/orders/calculate-shipping', {\n      address: $scope.address,\n      recorderQty: orderData.recorderQty\n    }).success(function (data) {\n      orderData.shipping = data.shipping_cost;\n      orderData.address = data.address;\n      a2order.reviewOrder(orderData);\n      $modalInstance.dismiss();\n    });\n  };\n});","angular.module('a2.orders.directives.tier-select', []).directive('tierSelect', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'tier': '=',\n      'disableFree': '='\n    },\n    templateUrl: '/orders/tier-select.html'\n  };\n});","angular.module('a2.directive.a2-auto-close-on-outside-click', []).directive('a2AutoCloseOnOutsideClick', function ($document, $rootScope) {\n  function getElementPath(element) {\n    var ancestors = [];\n    element = element;\n\n    while (element) {\n      ancestors.push(element);\n      element = element.parentElement;\n    }\n\n    return ancestors;\n  }\n\n  return {\n    restrict: 'A',\n    require: '?dropdown',\n    link: function (scope, element, $attrs, dropdownController) {\n      $attrs.$set('autoClose', \"disabled\");\n\n      function closeDropdown(evt) {\n        if (!evt || !dropdownController.isOpen()) {\n          return;\n        }\n\n        var ancestors = getElementPath(evt.target);\n        var htmlIdx = ancestors.indexOf($document[0].documentElement);\n        var toggleElementIdx = ancestors.indexOf(dropdownController.toggleElement[0]);\n        var elementIdx = ancestors.indexOf(dropdownController.dropdownMenu[0]); // console.log(htmlIdx, toggleElementIdx, elementIdx);\n\n        if (toggleElementIdx != -1 || elementIdx != -1 || htmlIdx == -1) {\n          return;\n        }\n\n        dropdownController.toggle(false);\n\n        if (!$rootScope.$$phase) {\n          scope.$apply();\n        }\n      }\n\n      $document.bind('click', closeDropdown);\n      scope.$on('$destroy', function () {\n        $document.unbind('click', closeDropdown);\n      });\n    }\n  };\n});","angular.module('arbimon2.directive.a2-dropdown', []).directive('a2Dropdown', function ($compile) {\n  var masterTemplate = angular.element('<div dropdown dropdown-append-to-body>' + '<button class=\"btn btn-sm btn-default dropdown-toggle\" dropdown-toggle>' + '<span></span> <i class=\"fa fa-caret-down\"></i>' + '</button>' + '<ul class=\"dropdown-menu dropup\" role=\"menu\">' + '<li ng-repeat=\"$item in list\" ng-class=\"{active: $item == $selectedItem}\">' + '<a ng-click=\"select($item)\"><span></span></a>' + '</li>' + '</ul>' + '</div>');\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    scope: true,\n    compile: function (element, attrs) {\n      var tpl = angular.element(masterTemplate[0].cloneNode(true));\n      var itemTpl = tpl.children('ul').children('li').children('a').children('span');\n      var selectedItemTpl = tpl.children('button').children('span');\n      var elementHtml = element.html();\n      itemTpl.append(elementHtml);\n      selectedItemTpl.append(elementHtml.replace(/\\$item\\b/g, '$selectedItem'));\n      element.empty();\n      var compiledTpl = $compile(tpl.clone());\n      return function (scope, linkElement, attrs, ngModelCtrl) {\n        linkElement.append(compiledTpl(scope));\n        scope.$watch(attrs.list, function (list) {\n          scope.list = list || [];\n        });\n\n        scope.select = function (item) {\n          scope.$selectedItem = item;\n          ngModelCtrl.$setViewValue(item, true);\n        };\n\n        ngModelCtrl.$render = function () {\n          scope.$selectedItem = ngModelCtrl.$viewValue;\n        };\n      };\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-on-resize\n * @description\n * Directive for detecting size changes in an element.\n */\nangular.module('a2.directive.on-resize', []).service('a2OnResizeService', function ($window, $rootScope) {\n  var watchers = [],\n      animationFramePending = false;\n\n  function Watcher(element, handler) {\n    this.element = element;\n    this.handler = handler;\n    this.value = null;\n    watchers.push(this);\n    watch.scheduleAnimationFrame();\n  }\n\n  Watcher.prototype.destroy = function () {\n    var index = watchers.indexOf(this);\n\n    if (index >= 0) {\n      watchers.splice(index, 1);\n    }\n  };\n\n  function watch() {\n    animationFramePending = false;\n    var triggered = [];\n    watchers.forEach(function (watcher) {\n      var width = watcher.element[0].clientWidth;\n      var height = watcher.element[0].clientHeight;\n\n      if (!watcher.value || watcher.value.width != width || watcher.value.height != height) {\n        watcher.value = {\n          width: width,\n          height: height\n        };\n        triggered.push(watcher);\n      }\n    });\n\n    if (triggered.length) {\n      $rootScope.$apply(function () {\n        triggered.forEach(function (watcher) {\n          try {\n            watcher.handler(watcher.value);\n          } catch (e) {\n            console.error(e);\n          }\n        });\n      });\n    }\n\n    watch.scheduleAnimationFrame();\n  }\n\n  watch.scheduleAnimationFrame = function () {\n    if (watchers.length && !animationFramePending) {\n      animationFramePending = true;\n      $window.requestAnimationFrame(watch);\n    }\n  };\n\n  return {\n    newWatcher: function (element, handler) {\n      return new Watcher(element, handler);\n    }\n  };\n}).directive('a2OnResize', function ($parse, a2OnResizeService) {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var onResize = $parse(attr.a2OnResize);\n      var watcher = a2OnResizeService.newWatcher(element, function (newSize) {\n        onResize(newSize, scope);\n      });\n      scope.$on('$destroy', function () {\n        watcher.destroy();\n      });\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-palette-drawer\n * @description\n * Directive for drawing a color palette.\n */\nangular.module('a2.directive.a2-palette-drawer', []).directive('a2PaletteDrawer', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    template: '<canvas class=\"palette\"></canvas>',\n    replace: true,\n    scope: {\n      palette: '&'\n    },\n    link: function ($scope, $element, $attrs) {\n      var draw = function () {\n        var pal = $scope.palette() || [];\n        var e = pal.length | 0;\n        $element.attr('width', e);\n        $element.attr('height', 1);\n        var ctx = $element[0].getContext('2d');\n\n        for (var i = 0; i < e; ++i) {\n          ctx.fillStyle = pal[i];\n          ctx.fillRect(i, 0, 1, 1);\n        }\n      };\n\n      $scope.$watch('palette()', draw);\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.percentage-bars', ['a2.utils']).directive('a2PercentageBars', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/a2-percentage-bars.html',\n    scope: {\n      data: \"=\",\n      total: \"=\",\n      colors: \"=\"\n    },\n    controller: 'a2PercentageBarsCtrl as bars'\n  };\n}).controller('a2PercentageBarsCtrl', function ($scope, $filter) {\n  var DEFAULT_COLORS = ['0', '1', '2'];\n  var numberFilter = $filter('number');\n\n  $scope.getColorClass = function (index) {\n    var colors = $scope.colors || DEFAULT_COLORS;\n    return 'bar-' + colors[index % colors.length];\n  };\n\n  $scope.getTotal = function () {\n    return $scope.total || $scope.data.reduce(function (a, b) {\n      return a + b;\n    });\n  };\n\n  $scope.asPercent = function (value, rounding) {\n    return numberFilter(value * 100 / $scope.getTotal(), rounding) + '%';\n  };\n});","angular.module('a2.directive.require-non-empty', []).directive('requireNonEmpty', function () {\n  return {\n    restrict: 'A',\n    require: '?ngModel',\n    link: function (scope, elm, attr, ctrl) {\n      if (!ctrl) {\n        return;\n      }\n\n      attr.required = true; // force truthy in case we are on non input element\n\n      ctrl.$validators.required = function (modelValue, viewValue) {\n        return !attr.required || !(ctrl.$isEmpty(viewValue) || viewValue instanceof Array && !viewValue.length);\n      };\n\n      attr.$observe('required', function () {\n        ctrl.$validate();\n      });\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.sidenav-bar', ['a2.utils']).directive('a2SidenavBar', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    compile: function (element, attr) {\n      element.addClass(\"sidenav\");\n      var name = attr.name;\n      var template = element.clone();\n      return function (scope, element, attr) {\n        a2SidenavBarService.enableSidenavBar(name, template, scope);\n\n        if (attr.enabled) {\n          scope.$watch(attr.enabled, function (enabled) {\n            if (enabled) {\n              a2SidenavBarService.enableSidenavBar(name, template, scope);\n            } else {\n              a2SidenavBarService.disableSidenavBar(name);\n            }\n          });\n        }\n\n        scope.$on('$destroy', function () {\n          a2SidenavBarService.disableSidenavBar(name);\n        });\n      };\n    }\n  };\n}).service('a2SidenavBarService', function ($q, $log, a2EventEmitter) {\n  var cache = {};\n\n  function SidenavBar() {\n    this.enabled = false;\n    this.events = new a2EventEmitter();\n  }\n\n  SidenavBar.prototype = {\n    enable: function (template, scope) {\n      if (!this.enabled) {\n        this.enabled = true;\n        this.template = template;\n        this.scope = scope;\n        return this.events.emit('enabled', this);\n      }\n\n      return $q.resolve();\n    },\n    disable: function () {\n      if (this.enabled) {\n        this.enabled = false;\n        delete this.template;\n        delete this.scope;\n        return this.events.emit('disabled', this);\n      }\n\n      return $q.resolve();\n    },\n    on: function (event, listener) {\n      this.events.on(event, listener);\n    },\n    off: function (event, listener) {\n      this.events.off(event, listener);\n    }\n  };\n\n  function getSidenavBar(name) {\n    return cache[name] || (cache[name] = new SidenavBar());\n  }\n\n  a2SidenavBarService = {\n    enableSidenavBar: function (name, template, scope) {\n      return getSidenavBar(name).enable(template, scope);\n    },\n    disableSidenavBar: function (name) {\n      return getSidenavBar(name).disable();\n    },\n    registerAnchor: function (name, onEnabled, onDisabled) {\n      var bar = getSidenavBar(name);\n      bar.on('enabled', onEnabled);\n      bar.on('disabled', onDisabled);\n\n      if (bar.enabled) {\n        $q.resolve().then(onEnabled);\n      }\n\n      return function unregisterAnchor() {\n        bar.off('enabled', onEnabled);\n        bar.off('disabled', onDisabled);\n      };\n    }\n  };\n  return a2SidenavBarService;\n}).directive('a2SidenavBarAnchor', function (a2SidenavBarService, $compile) {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var name;\n      var isUl = element[0].nodeName.toLowerCase() == 'ul';\n      var unregisterAnchor;\n\n      function onEnabled(sidebar) {\n        var template = sidebar.template.clone();\n        element.empty().append($compile(template.children())(sidebar.scope));\n      }\n\n      function onDisabled(sidebar) {\n        element.empty();\n      }\n\n      attr.$observe('a2SidenavBarAnchor', function (_name) {\n        name = _name;\n\n        if (unregisterAnchor) {\n          unregisterAnchor();\n          unregisterAnchor = null;\n        }\n\n        unregisterAnchor = a2SidenavBarService.registerAnchor(name, onEnabled, onDisabled);\n      });\n      scope.$on('$destroy', function () {\n        if (unregisterAnchor) {\n          unregisterAnchor();\n          unregisterAnchor = null;\n        }\n      });\n    }\n  };\n});","angular.module('a2.directive.a2-table', []).directive('a2Table', function ($window, $filter, $templateCache, $compile) {\n  var $ = $window.$;\n\n  function compileFields(element) {\n    return element.children('field').toArray().map(function (field) {\n      field = angular.element(field);\n      var clone = field.clone();\n      field.detach();\n      return {\n        title: clone.attr('title'),\n        key: clone.attr('key'),\n        tdclass: clone.attr('tdclass'),\n        width: clone.attr('width'),\n        filter: clone.attr('filter') !== undefined ? clone.attr('filter') || clone.attr('key') : undefined,\n        content: clone.html(),\n        show: clone.attr('show'),\n        tooltip: clone.attr('tooltip')\n      };\n    });\n  }\n\n  function compileSelectExpand(element, options) {\n    var selectExpand = element.children('expand-select');\n\n    if (!selectExpand.length) {\n      return;\n    }\n\n    var clone = selectExpand.clone(true);\n    selectExpand.detach();\n    selectExpand = angular.element('<tr ng-show=\"selected\"><td colspan=\"' + options.fieldCount + '\"></td></tr>');\n    selectExpand.find('td').append(clone);\n    return selectExpand;\n  }\n\n  return {\n    restrict: 'E',\n    scope: {\n      rows: '=',\n      selected: '=?',\n      // able to work with $scope.selected rows\n      onSelect: '&',\n      onCheck: '&',\n      checked: '=?',\n      // able to work with $scope.checked rows\n      search: '=?',\n      // noCheckbox: '@',    // disable row checkboxes\n      // noSelect: '@',      // disable row selection\n      dateFormat: '@',\n      // moment date format, default: 'lll'\n      numberDecimals: '@' // decimal spaces\n\n    },\n    controller: 'a2TableCtrl as a2TableController',\n    compile: function (element, attrs) {\n      var template = angular.element($templateCache.get('/directives/a2-table.html'));\n      var tplHead = template.find(\"thead tr.headers\");\n      var tplFilters = template.find(\"thead tr.filters\");\n      var tplBody = template.find(\"tbody tr\");\n      var options = {};\n      var filterable = [];\n      var hasFilters = false;\n      options.fields = compileFields(element);\n      options.hasCheckbox = attrs.noCheckbox === undefined;\n      options.hasSelection = attrs.noSelect === undefined;\n      options.fieldCount = options.fields.length + (options.hasCheckbox ? 1 : 0);\n      options.selectExpand = compileSelectExpand(element, options);\n      options.fields.forEach(function (field, index) {\n        tplHead.append(angular.element('<th ng-click=\"a2TableController.sortBy(' + index + ')\" class=\"cs-pointer\"' + (field && field.tooltip !== undefined ? ' title=\"' + field.tooltip + '\"' : '') + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '></th>').addClass(field.tdclass).text(field.title).append(field.key ? '    <i ng-if=\"sortKey == ' + index + '\" class=\"fa\" ng-class=\"reverse ? \\'fa-chevron-up\\': \\'fa-chevron-down\\'\"></i>\\n' : ''));\n        hasFilters |= field.filter !== undefined;\n        tplFilters.append(angular.element('<th' + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '></th>').append(field.filter !== undefined ? '   <input type=\"text\" class=\"a2-table-filter form-control\" ng-model=\"a2TableController.filter[' + index + ']\" ng-change=\"a2TableController.onFilterChanged(' + index + ')\">\\n' : ''));\n        tplBody.append(angular.element('<td ' + (['Project', 'Species'].includes(field.title) ? 'title=\"' + field.content + '\"' : '') + (field.width ? 'width=\"' + field.width + '\"' : '') + (field && field.show !== undefined ? ' ng-if=\"' + field.show + '\"' : '') + '>').addClass(field.tdclass).html(field.content));\n      });\n      return function (scope, element, attrs, a2TableCtrl) {\n        var tableScope = scope.$parent.$new(false, scope);\n        options.scope = scope;\n        options.tableScope = tableScope;\n\n        options.onSelect = scope.onSelect && function (row) {\n          return scope.onSelect({\n            row: row\n          });\n        };\n\n        options.onCheck = scope.onCheck && function (row) {\n          return scope.onCheck({\n            row: row\n          });\n        };\n\n        a2TableCtrl.initialize(options);\n        tableScope.a2TableController = a2TableCtrl;\n        a2TableCtrl.fields = options.fields;\n\n        if (options.selectExpand) {\n          a2TableCtrl.selectExpand = $compile(options.selectExpand)(tableScope);\n        }\n\n        a2TableCtrl.noCheck = !options.hasCheckbox;\n        a2TableCtrl.noSelect = !options.hasSelection;\n        tableScope.sortKey = attrs.defaultSort || tableScope.sortKey;\n\n        if (attrs.search) {\n          scope.$watch('search', function (value) {\n            tableScope.query = scope.search;\n            a2TableCtrl.updateChecked();\n          });\n        }\n\n        a2TableCtrl.setRows(scope.rows);\n        scope.$watch('rows', function (rows) {\n          a2TableCtrl.setRows(rows);\n        }, true);\n        var cmpel = $compile(template.clone())(tableScope);\n        element.append(cmpel);\n        scope.$on('$destroy', function () {\n          tableScope.$destroy();\n        });\n      };\n    }\n  };\n}).controller('a2TableCtrl', function ($filter) {\n  var scope, tableScope;\n\n  this.initialize = function (options) {\n    scope = options.scope;\n    tableScope = options.tableScope;\n    this.options = options;\n    this.__onSelect = options.onSelect;\n    this.__onCheck = options.onCheck;\n    this.hasFilters = options.fields.reduce(function (_, field) {\n      return _ || field.filter !== undefined;\n    }, false);\n    this.filter = {};\n  };\n\n  this.setRows = function (rows) {\n    this.rows = rows;\n    this.updateChecked();\n  };\n\n  this.onFilterChanged = function (index) {\n    var query = tableScope.query || (tableScope.query = {});\n    var key = this.options.fields[index].filter.split('.');\n    var value = this.filter[index];\n\n    if (value == \"\") {\n      while (key.length > 1) {\n        query = (query || {})[key.shift()];\n      }\n\n      delete query[key.shift()];\n    } else {\n      while (key.length > 1) {\n        var keycomp = key.shift();\n        query = query[keycomp] || (query[keycomp] = {});\n      }\n\n      query[key.shift()] = value;\n    }\n  };\n\n  this.updateChecked = function () {\n    if (this.rows) {\n      var visible = $filter('filter')(this.rows, tableScope.query);\n      scope.checked = visible.filter(function (row) {\n        return row.checked | false;\n      });\n    }\n  };\n\n  this.toggleAll = function () {\n    var allFalse = this.rows.reduce(function (_, row) {\n      return _ && !row.checked;\n    }, true);\n    this.rows.forEach(function (row) {\n      row.checked = allFalse;\n    });\n    tableScope.checkall = allFalse;\n  };\n\n  this.check = function ($event, $index) {\n    if (this.lastChecked && $event.shiftKey) {\n      if (this.lastChecked) {\n        var rows;\n\n        if (this.lastChecked > $index) {\n          rows = this.rows.slice($index, this.lastChecked);\n        } else {\n          rows = this.rows.slice(this.lastChecked, $index);\n        }\n\n        rows.forEach(function (row) {\n          row.checked = true;\n        });\n      }\n    }\n\n    this.lastChecked = $index;\n  };\n\n  this.keyboardSel = function (row, $index, $event) {\n    if ($event.key === \" \" || $event.key === \"Enter\") {\n      this.sel(row, $index);\n    }\n  };\n\n  this.sel = function (row, $index, $event) {\n    if (this.noSelect) {\n      return;\n    }\n\n    if (tableScope.selected === row) {\n      row = undefined;\n    }\n\n    tableScope.selected = row;\n    scope.selected = row;\n\n    if (this.selectExpand) {\n      angular.element($event.currentTarget).after(this.selectExpand);\n    }\n\n    if (this.__onSelect) {\n      this.__onSelect(row);\n    }\n  };\n\n  this.onCheck = function (row, $index, $event) {\n    if (this.__onCheck) {\n      this.__onCheck(row);\n    }\n  };\n\n  this.sortBy = function (fieldIndex) {\n    var field = this.fields[fieldIndex];\n\n    if (tableScope.sortKey !== fieldIndex) {\n      tableScope.sortKey = fieldIndex;\n      tableScope.sort = field.key;\n      tableScope.reverse = false;\n    } else {\n      tableScope.reverse = !tableScope.reverse;\n    }\n  };\n});","(function () {\n  var a2TagsModule = angular.module('a2.directive.a2-tags', ['templates-arbimon2']);\n  var a2TagTypes = ['classi', 'classes', 'model', 'playlist', {\n    tag: 'project',\n    linkTo: function (tagId) {\n      return \"/project/?id=\" + tagId;\n    }\n  }, 'site', 'species', 'song', 'soundscape', 'training_set'];\n  a2TagTypes.forEach(function (tagType) {\n    if ('string' == typeof tagType) {\n      tagType = {\n        tag: tagType\n      };\n    }\n\n    tagType.tcTag = tagType.tag.replace(/(^|\\b|-)(\\w)/, function (_0, _1, _2) {\n      return _2.toUpperCase();\n    });\n    a2TagsModule.directive('a2Tag' + tagType.tcTag, function ($injector) {\n      return {\n        restrict: 'EAC',\n        scope: {\n          tag: '=a2Tag' + tagType.tcTag\n        },\n        link: function (scope, element, attrs) {\n          var tagName, tagId, tagLink;\n          var aElement = element.find('a');\n          element.addClass('a2-tag a2-tag-' + tagType.tag);\n          scope.$watch('tag', function (tag) {\n            if (tag instanceof Array) {\n              tagId = tag[0];\n              tagName = tag[1];\n\n              if (tagId && tagType.linkTo) {\n                tagLink = $injector.invoke(tagType.linkTo, null, {\n                  tagId: tagId\n                });\n              }\n            } else {\n              tagId = null;\n              tagName = tag;\n            }\n\n            var tagElement = angular.element(tagLink ? '<a></a>' : '<span></span>').appendTo(element.empty());\n            tagElement.text(tagName);\n\n            if (tagLink) {\n              tagElement.attr('href', tagLink);\n            }\n          });\n        }\n      };\n    });\n  });\n})();","angular.module('a2.directives', ['a2.services', 'a2.directive.a2-table', 'arbimon.directive.a2-switch', 'a2.directive.percentage-bars', 'templates-arbimon2']).run(function ($window) {\n  var $ = $window.$;\n  $(document).click(function (e) {\n    if ($(e.target).closest('.calendar.popup:visible').length) return;\n    $('.calendar.popup:visible').hide();\n  }); // extend jQuery\n  // add parent tag selector\n\n  $.expr.filter.UP_PARENT_SPECIAL = function (_1) {\n    var times = _1 && _1.length || 1;\n    return $.expr.createPseudo(function (seed, matches, _3, _4) {\n      var dups = [];\n      seed.forEach(function (e, i) {\n        var p = e;\n\n        for (var t = times; t > 0; --t) {\n          p = p && (p.nodeType == 9 || p.parentNode.nodeType == 9 ? p : p.parentNode);\n        }\n\n        if (p) {\n          for (var di = 0, de = dups.length; di < de; ++di) {\n            if (dups[di] === p) {\n              p = null;\n              break;\n            }\n          }\n\n          if (p) {\n            dups.push(p);\n          }\n        }\n\n        matches[i] = p;\n        seed[i] = !p;\n      });\n      return true;\n    });\n  };\n\n  $.expr.match.needsContext = new RegExp($.expr.match.needsContext.source + '|^(\\\\^)');\n  $.expr.match.UP_PARENT_SPECIAL = /^(\\^+)/;\n}).directive('a2GlobalKeyup', function ($window, $timeout) {\n  var $ = $window.$;\n  return {\n    restrict: 'A',\n    scope: {\n      onkeyup: '&a2GlobalKeyup'\n    },\n    link: function ($scope, $element, $attrs) {\n      var handler = function (evt) {\n        $timeout(function () {\n          $scope.onkeyup({\n            $event: evt\n          });\n        });\n      };\n\n      $(document).on('keyup', handler);\n      $element.on('$destroy', function () {\n        $(document).off('keyup', handler);\n      });\n    }\n  };\n}).directive('a2Scroll', function ($parse, $window) {\n  var mkFunction = function (scope, attr) {\n    var fn = $parse(attr);\n    return function (locals) {\n      locals.console = console;\n      return fn(scope, locals);\n    };\n  };\n\n  return {\n    scope: {\n      'a2InfiniteScrollDistance': '=?',\n      'a2InfiniteScrollDisabled': '=?',\n      'a2InfiniteScrollImmediateCheck': '=?'\n    },\n    link: function ($scope, element, attrs, controller) {\n      var pscope = $scope.$parent;\n      var fnBind = 'on';\n      var fnUnbind = 'off';\n\n      if (attrs.a2Scroll) {\n        controller.a2Scroll = mkFunction(pscope, attrs.a2Scroll);\n      }\n\n      controller.element = element;\n\n      if (attrs.a2ScrollOn) {\n        if (attrs.a2ScrollOn == 'window') {\n          controller.scrollElement = $window;\n          fnBind = 'addEventListener';\n          fnUnbind = 'removeEventListener';\n        } else {\n          controller.scrollElement = $(attrs.a2ScrollOn);\n        }\n      } else {\n        controller.scrollElement = element;\n      }\n\n      if (attrs.a2InfiniteScroll) {\n        $scope.a2InfiniteScroll = mkFunction(pscope, attrs.a2InfiniteScroll);\n      }\n\n      if (!$scope.a2InfiniteScrollDistance) {\n        $scope.a2InfiniteScrollDistance = 1;\n      }\n\n      if (!$scope.a2InfiniteScrollRefraction) {\n        $scope.a2InfiniteScrollRefraction = 1000;\n      }\n\n      controller.scrollHandler = controller.scrollHandler.bind(controller);\n      controller.scrollElement[fnBind](\"scroll\", controller.scrollHandler);\n      controller.element.bind(\"$destroy\", function () {\n        controller.scrollElement[fnUnbind]('scroll', controller.scrollHandler);\n        controller.dispose();\n      });\n    },\n    controller: 'a2ScrollController'\n  };\n}).controller('a2ScrollController', function ($scope) {\n  Object.assign(this, {\n    anchors: {},\n    addAnchor: function (name, anchorElement) {\n      this.anchors[name] = anchorElement;\n    },\n    removeAnchor: function (name) {\n      delete this.anchors[name];\n    },\n    scrollHandler: function (event) {\n      try {\n        if (this.a2Scroll) {\n          this.a2Scroll({\n            $event: event,\n            $controller: this\n          });\n        }\n\n        if ($scope.a2InfiniteScroll && !$scope.a2InfiniteScrollDisabled) {\n          var remaining = (element[0].scrollHeight - element[0].scrollTop | 0) / element.height();\n\n          if (remaining < $scope.a2InfiniteScrollDistance) {\n            var time = new Date().getTime();\n\n            if (!$scope.refraction || $scope.refraction < time) {\n              $scope.refraction = time + $scope.a2InfiniteScrollRefraction;\n              $scope.a2InfiniteScroll({\n                $event: e\n              });\n            }\n          }\n        }\n      } finally {\n        $scope.$apply();\n      }\n    },\n    dispose: function () {\n      this.element = null;\n      this.scrollElement = null;\n      this.anchors = {};\n    }\n  });\n}).directive('a2ScrollAnchor', function () {\n  return {\n    require: '^a2Scroll',\n    link: function ($scope, element, attrs, a2ScrollController) {\n      var name = attrs.name;\n      a2ScrollController.addAnchor(name, element);\n      element.bind(\"$destroy\", function () {\n        a2ScrollController.removeAnchor(name);\n      });\n    }\n  };\n}).directive('a2Persistent', function ($rootScope, $compile, $timeout) {\n  var counter = 0;\n  var poc = $('<div></div>');\n  return {\n    restrict: 'E',\n    scope: {},\n    compile: function (tElement, tAttrs) {\n      var children = tElement.children().detach();\n      var tag = tAttrs.name || 'persistent-' + counter++;\n      return function (_1, $element, _3) {\n        if (!$rootScope._$persistence_) {\n          $rootScope._$persistence_ = {};\n        }\n\n        var p = $rootScope._$persistence_;\n        var ptag = p[tag];\n        var persisted = true;\n\n        if (!ptag) {\n          // console.log('new persistent scope \"%s\" created in ', tag, $rootScope);\n          p[tag] = ptag = {};\n          ptag.scope = $rootScope.$new(true);\n          ptag.scope._$persistence_tag_ = tag;\n          ptag.view = $compile(children)(ptag.scope);\n          persisted = false;\n        }\n\n        $element.append(ptag.view);\n        $element.on('$destroy', function (e) {\n          e.stopPropagation();\n          poc.append(ptag.view);\n        });\n\n        if (persisted) {\n          $timeout(function () {\n            ptag.scope.$broadcast('a2-persisted');\n          });\n        }\n      };\n    }\n  };\n}).directive('autoHeight', function ($window) {\n  var $ = $window.$;\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      var updateHeight = function () {\n        // console.log('window h:', $(window).height());\n        // console.log('ele pos:',  element.offset());\n        // console.log('ele h:', element.height());\n        var h = $($window).height() - element.offset().top;\n        if (h < 500) return;\n        $window.requestAnimationFrame(function () {\n          element.height(h);\n        });\n      };\n\n      updateHeight();\n      $($window).resize(function () {\n        updateHeight();\n      });\n    }\n  };\n}).directive('stopClick', function () {\n  return {\n    restrict: 'A',\n    link: function (scope, element, attr) {\n      element.bind('click', function (e) {\n        e.stopPropagation();\n      });\n    }\n  };\n}).directive('loader', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      hideText: '@',\n      text: '@'\n    },\n    templateUrl: '/directives/loader.html'\n  };\n})\n/**   yearpick - complete year date picker\n\n  example usage:\n  <div class=\"dropdown\">\n    <button ng-model=\"dia\" yearpick disable-empty=\"true\" year=\"year\" date-count=\"dateData\">\n        <span ng-hide=\"dia\"> Select Date </span>\n        {{ dia | date: short }}\n    </button>\n  </div>\n  or, if you just want to show the component :\n  <yearpick ng-model=\"dia\" yearpick disable-empty=\"true\" year=\"year\" date-count=\"dateData\"></yearpick>\n */\n.directive('yearpick', function ($timeout, $window) {\n  var d3 = $window.d3;\n  var $ = $window.$;\n  return {\n    restrict: 'AE',\n    scope: {\n      ngModel: '=',\n      maxDate: '=?',\n      minDate: '=?',\n      year: '=?',\n      dateCount: '=?',\n      mode: '@',\n      onYearChanged: '&?',\n      onDateChanged: '&?',\n      disableEmpty: '&'\n    },\n    link: function (scope, element, attrs) {\n      var is_a_popup = !/yearpick/i.test(element[0].tagName);\n      var popup;\n\n      if (is_a_popup) {\n        popup = $('<div></div>').insertAfter(element).addClass('calendar popup');\n        element.click(function (e) {\n          e.stopPropagation(); // verify if hidden\n\n          var visible = popup.css('display') === 'none'; // always hide any other open yearpick\n\n          $('.calendar.popup:visible').hide();\n\n          if (visible) {\n            popup.css('display', 'block');\n          }\n        });\n      } else {\n        popup = element.addClass('calendar');\n      }\n\n      var weekOfMonth = function (d) {\n        var firstDay = new Date(d.toString());\n        firstDay.setDate(1);\n        var monthOffset = firstDay.getDay() - 1;\n        return Math.floor((d.getDate() + monthOffset + 7) / 7) - 1;\n      };\n\n      var monthName = d3.time.format('%B');\n      var dateFormat = d3.time.format(\"%Y-%m-%d\");\n\n      var format2Date = function (txt) {\n        var m = /^(\\d+)-(\\d+)-(\\d+)$/.exec(txt);\n        return m && new Date(m[1] | 0, m[2] | 0, m[3] | 0);\n      };\n\n      var canHaveDateCounts = function () {\n        return scope.mode === \"density\" && attrs.dateCount;\n      };\n\n      var computeMax = !attrs.maxDate;\n      var computeMin = !attrs.minDate;\n\n      function setYear(year) {\n        var old_year = scope.year;\n        scope.year = year;\n\n        if (scope.onYearChanged && old_year != year) {\n          $timeout(function () {\n            scope.onYearChanged({\n              year: year\n            });\n          });\n        }\n      }\n\n      function setDate(date) {\n        var old_date = scope.ngModel;\n        scope.ngModel = date;\n\n        if (scope.onDateChanged && old_date != date) {\n          $timeout(function () {\n            scope.onDateChanged({\n              date: date\n            });\n          });\n        }\n      }\n\n      if (!scope.year) {\n        setYear(new Date().getFullYear());\n      }\n\n      var cubesize = 19;\n      var width = 600;\n      var height = 510;\n      var headerHeight = 40;\n      var days;\n      var svg = d3.select(popup[0]).append('svg').attr('width', width).attr('height', height);\n      var cal = svg.append('g');\n      var legend = svg.append('g');\n      var prev = svg.append('g').attr('class', 'btn');\n      var next = svg.append('g').attr('class', 'btn'); // draws previous year button\n\n      prev.append('text').attr('text-anchor', 'start').attr('font-family', 'FontAwesome').attr('font-size', 24).attr('x', 5).attr('y', 24).text('\\uf060');\n      prev.on('click', function (e) {\n        $timeout(function () {\n          setYear(scope.year - 1);\n        });\n      }); // draws next year button\n\n      next.append('text').attr('text-anchor', 'end').attr('font-family', 'FontAwesome').attr('font-size', 24).attr('x', width - 5).attr('y', 24).text('\\uf061');\n      next.on('click', function (e) {\n        $timeout(function () {\n          setYear(scope.year + 1);\n        });\n      }); // draw legend\n\n      if (scope.mode === \"density\") {\n        var scale = {\n          scale: [1, 50, 100],\n          labels: ['0', '1', '50', '100']\n        };\n        var color = d3.scale.threshold().domain(scale.scale).range(scale);\n        var icon = legend.selectAll('g').data(['1', '50', '100']).enter().append('g').attr('transform', function (d, i) {\n          switch (d) {\n            case '50':\n              return 'translate(18,0)';\n\n            default:\n              return 'translate(20,0)';\n          }\n        });\n        icon.append('rect').attr('width', cubesize * 0.63).attr('height', cubesize * 0.63).attr('y', height + 7 - cubesize).attr('x', function (d, i) {\n          return i * 45 + 22;\n        }).attr('class', function (d) {\n          return 'cal-level-' + d;\n        });\n        icon.append('text').attr('text-anchor', 'middle').attr('font-size', 10).attr('y', height - 2).attr('x', function (d, i) {\n          switch (d) {\n            case '1':\n              return i * 45 + 11;\n\n            case '50':\n              return i * 45 + 9;\n\n            case '100':\n              return i * 45 + 6;\n          }\n        }).text(function (d, i) {\n          return '+' + d;\n        });\n      }\n\n      var drawCounts = function () {\n        if (scope.mode === \"density\" && !scope.dateCount) return;\n\n        if (scope.disableEmpty()) {\n          days.classed('day-disabled', function (d) {\n            return $(this).hasClass('cal-oor') || !scope.dateCount[dateFormat(d)];\n          });\n        }\n\n        var squares = days.select('rect');\n        squares.attr('class', function (d) {\n          var color = d3.scale.threshold().domain([1, 50, 100]).range(['0', '1', '50', '100']);\n          var count = scope.dateCount[dateFormat(d)] || 0;\n          return 'cal-level-' + color(count);\n        });\n      };\n\n      var draw = function () {\n        // set calendar year\n        calendar = cal.selectAll('g').data([scope.year]); // append new year\n\n        var title = calendar.enter().append('g'); // set text position\n\n        title.append('text').attr('text-anchor', 'middle').attr('font-size', 30).attr('x', width / 2).attr('y', 30); // set line position\n\n        title.append('line').attr('x1', 5).attr('y1', headerHeight).attr('x2', width - 5).attr('y2', headerHeight).attr('stroke', 'rgba(0,0,0,0.5)').attr('stroke-width', 1); // remove old year\n\n        calendar.exit().remove(); // write year text\n\n        calendar.select('text').text(function (d) {\n          return d;\n        });\n        prev.classed('disabled', scope.minDate && scope.minDate.getFullYear() >= scope.year);\n        next.classed('disabled', scope.maxDate && scope.year >= scope.maxDate.getFullYear()); // setup the months containers and set the years' month date range\n\n        var mon = calendar.append('g').attr('transform', 'translate(0,' + headerHeight + ')').selectAll('g').data(function (d) {\n          return d3.time.months(new Date(d, 0, 1), new Date(d + 1, 0, 1));\n        }); // on enter in months, append new months\n\n        mon.enter().append('g'); // in months, transform each month to their place in the yearpick\n\n        mon.attr('transform', function (d, i) {\n          return 'translate(' + (d.getMonth() % 4 * 150 + 5) + ',' + (Math.floor(d.getMonth() / 4) * 150 + 5) + ')';\n        }); // in months, transform each month to their place in the yearpick\n\n        mon.append('text').attr('text-anchor', 'middle').attr('x', cubesize * 7 / 2).attr('y', 15).text(function (d) {\n          return monthName(d);\n        }); // remove old months\n\n        mon.exit().remove(); // setup day containers for each months\n\n        days = mon.selectAll('g').data(function (d) {\n          return d3.time.days(new Date(d.getFullYear(), d.getMonth(), 1), new Date(d.getFullYear(), d.getMonth() + 1, 1));\n        }); //  in days, on enter, append a g of class btn\n\n        days.enter().append('g').attr('class', 'day'); //  for each day, move the text, add class hover and onclick event handler\n\n        days.attr('transform', function () {\n          return 'translate(0,24)';\n        }).classed('hover', true).classed('day-disabled cal-oor', function (d) {\n          return (scope.minDate ? d < scope.minDate : false) || (scope.maxDate ? scope.maxDate < d : false);\n        }).classed('selected', function (d) {\n          return scope.ngModel && dateFormat(d) == dateFormat(scope.ngModel);\n        }).on('click', function (d) {\n          scope.$apply(function () {\n            d3.event.preventDefault();\n            setDate(d);\n            if (is_a_popup) popup.css('display', 'none');\n          });\n        }); // .. also, add a rect on the background\n\n        days.append('rect').attr('width', cubesize).attr('height', cubesize).attr('y', function (d, i) {\n          return weekOfMonth(d) * (cubesize + 1);\n        }).attr('x', function (d, i) {\n          return d.getDay() * (cubesize + 1);\n        }).attr('fill', 'white'); // .. and append a text on the foreground\n\n        days.append('text').attr('text-anchor', 'middle').attr('font-size', 10).attr('y', function (d, i) {\n          return weekOfMonth(d) * (cubesize + 1) + 13;\n        }).attr('x', function (d, i) {\n          return (d.getDay() + 1) * (cubesize + 1) - 10;\n        }).text(function (d, i) {\n          return d.getDate();\n        }); // if we have date counts, then draw them\n\n        if (attrs.dateCount) {\n          drawCounts();\n        } // remove old days\n\n\n        days.exit().remove();\n      };\n\n      scope.$watch('maxDate', function () {\n        if (scope.maxDate && scope.year > scope.maxDate.getFullYear()) {\n          setYear(scope.maxDate.getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('minDate', function () {\n        if (scope.minDate && scope.year < scope.minDate.getFullYear()) {\n          setYear(scope.minDate.getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('year', function () {\n        if (!scope.year) {\n          setYear(new Date().getFullYear());\n        }\n\n        draw();\n      });\n      scope.$watch('ngModel', function () {\n        if (scope.ngModel) {\n          setYear(scope.ngModel.getFullYear());\n          days.classed('selected', function (d) {\n            return scope.ngModel && dateFormat(d) == dateFormat(scope.ngModel);\n          });\n        }\n      });\n\n      var computeMaxMinDateFromCounts = function (dateCounts, computeMax, computeMin) {\n        var stats = null;\n\n        if (!dateCounts || !computeMax && !computeMin) {\n          return;\n        }\n\n        for (var dateFmt in dateCounts) {\n          var date = format2Date(dateFmt);\n\n          if (stats) {\n            stats.min = Math.min(date, stats.min);\n            stats.max = Math.max(date, stats.max);\n          } else {\n            stats = {\n              min: date,\n              max: date\n            };\n          }\n        }\n\n        if (computeMin) {\n          scope.minDate = new Date(stats.min);\n        }\n\n        if (computeMax) {\n          scope.maxDate = new Date(stats.max);\n        }\n      };\n\n      if (canHaveDateCounts()) {\n        scope.$watch('dateCount', function (value) {\n          computeMaxMinDateFromCounts(value, computeMax, computeMin);\n          drawCounts();\n        });\n      }\n    }\n  };\n}).directive('a2Img', function ($compile, $window) {\n  var $ = $window.$;\n  return {\n    restrict: 'E',\n    scope: {},\n    link: function ($scope, $element, $attr) {\n      $element.addClass('a2-img');\n      var loader = $compile('<loader hide-text=\"yes\"></loader>')($scope).appendTo($element);\n      var img = $('<img>').on('load', function () {\n        $element.removeClass('loading');\n      }).appendTo($element);\n      $attr.$observe('a2Src', function (new_src) {\n        if (!new_src) {\n          img.hide();\n          img.attr('src', '');\n          return;\n        }\n\n        img.show();\n        $element.addClass('loading');\n        var image = new Image();\n\n        image.onload = function () {\n          img.attr('src', this.src);\n        };\n\n        image.src = new_src;\n      });\n    }\n  };\n}).directive('a2TrainingSetDataImage', function ($compile, a2TrainingSets) {\n  return {\n    restrict: 'E',\n    scope: {\n      'trainingSet': '=',\n      'datum': '='\n    },\n    template: '<a2-img a2-src=\"{{datum.uri}}\" ng-class=\"resolving ? \\'resolving-uri\\' : \\'\\'\" style=\"width:100%;height:100%;\"></a2-img>',\n    link: function ($scope, $element, $attr) {\n      $element.addClass('a2-training-set-data-image a2-block-inline');\n\n      var resolve_null_uri = function () {\n        if ($scope.datum && $scope.trainingSet && !$scope.datum.url) {\n          var urikey = [$scope.trainingSet.id, $scope.datum.id].join('-');\n\n          if ($scope.resolving != urikey) {\n            $scope.resolving = urikey;\n            a2TrainingSets.getDataImage($scope.trainingSet.id, $scope.datum.id, function (datum2) {\n              $scope.resolving = false;\n\n              if ($scope.datum.id == datum2.id) {\n                $scope.datum.uri = datum2.uri;\n              }\n            });\n          }\n        }\n      };\n\n      $scope.$watch('datum', resolve_null_uri);\n      $scope.$watch('trainingSet', resolve_null_uri);\n    }\n  };\n}).directive('a2InsertIn', function ($window) {\n  var $ = $window.$;\n  var count = 1;\n  return {\n    restrict: 'A',\n    link: function ($scope, $element, $attr) {\n      var anchor = $('<div class=\"a2-insert-in-anchor\"></div>').attr('id', 'a2InsertInAnchor' + count++);\n\n      var is_truthy = function (v) {\n        return v && !/no|false|0/.test('' + v);\n      };\n\n      var keep_position = is_truthy($attr.a2KeepPosition);\n      var target = $($attr.a2InsertIn);\n      $element[0].parentNode.replaceChild(anchor[0], $element[0]);\n      $element.appendTo(target);\n      var reposition_element = null;\n\n      if (keep_position) {\n        var comp_pos = function (el) {\n          return $(el).offset();\n        };\n\n        reposition_element = function () {\n          $('.a2-insert-in-anchor');\n          var po = comp_pos($element.offsetParent());\n          var ao = comp_pos(anchor);\n          ao.position = 'absolute';\n          ao.top -= po.top;\n          ao.left -= po.left;\n          $element.css(ao);\n        };\n\n        $('.a2-insert-in-anchor').parents().each(function (i, e) {\n          var $e = $(e);\n\n          if (!/visible|hidden/.test($e.css('overflow'))) {\n            $e.scroll(reposition_element);\n          }\n        });\n        $scope.$watch(function () {\n          return anchor.offset();\n        }, reposition_element, true);\n        reposition_element();\n      }\n\n      $scope.$watch(function () {\n        return anchor.is(':visible');\n      }, function (visibility) {\n        $element.css('display', visibility ? 'block' : 'none');\n      });\n      anchor.on('$destroy', function () {\n        $element.remove();\n      });\n    }\n  };\n}).directive('a2LineChart', function ($window) {\n  var d3 = $window.d3;\n\n  var drawChart = function (data, options) {\n    var padding = {\n      left: 30,\n      right: 10,\n      top: 10,\n      bottom: 20\n    };\n\n    var getY = function (value) {\n      return value.y;\n    };\n\n    var getX = function (value) {\n      return value.x;\n    };\n\n    var yMin = d3.min(data, getY);\n    var yMax = d3.max(data, getY);\n    var tMin = d3.min(data, getX);\n    var tMax = d3.max(data, getX);\n    var element = options.element;\n    var lineColor = options.lineColor || \"red\";\n    var width = options.width,\n        height = options.height;\n    var xScale = d3.scale.linear().domain([tMin, tMax]).range([padding.left, width - padding.right]);\n    var yScale = d3.scale.linear().domain([yMin, yMax]).range([height - padding.bottom, padding.top]);\n    var line = d3.svg.line().x(function (d) {\n      return xScale(d.x);\n    }).y(function (d) {\n      return yScale(d.y);\n    }).interpolate(\"linear\");\n    var symbol = d3.svg.symbol().type('circle');\n    var xAxis = d3.svg.axis().scale(xScale).ticks(tMax - tMin);\n    var yAxis = d3.svg.axis().scale(yScale).orient('left').ticks(3);\n    var svg = element.append('svg').attr('class', \"graph\").attr('height', height).attr('width', width);\n    svg.append(\"g\").attr(\"class\", \"x axis\").attr(\"transform\", \"translate(0,\" + (height - padding.bottom) + \")\").call(xAxis);\n    svg.append(\"g\").attr(\"class\", \"y axis\").attr(\"transform\", \"translate(\" + padding.left + \",0)\").call(yAxis);\n    var dataG = svg.append('g').datum(data);\n    var path = dataG.append('path').attr('stroke', lineColor).attr('stroke-width', \"2\").attr('fill', \"none\").attr('d', line);\n    var totalLength = path.node().getTotalLength();\n    path.attr(\"stroke-dasharray\", totalLength).attr(\"stroke-dashoffset\", totalLength).transition().delay(200).duration(1000).ease(\"linear\").attr(\"stroke-dashoffset\", 0).each(\"end\", function () {\n      path.attr(\"stroke-dasharray\", null).attr(\"stroke-dashoffset\", null);\n    });\n    dataG.append(\"g\").selectAll('path').data(function (d) {\n      return d;\n    }).enter().append('path').attr('fill', \"transparent\").attr(\"transform\", function (d) {\n      return \"translate(\" + xScale(d.x) + \",\" + yScale(d.y) + \")scale(0.7,0.7)\";\n    }).attr(\"d\", symbol).attr('fill', lineColor).on('mouseenter', function (d) {\n      var body = d3.select('body');\n      var coords = d3.mouse(body.node());\n      var tooltip = body.append('div').datum(d).attr('class', \"graph-tooltip\").style('top', coords[1] - 10 + 'px').style('left', coords[0] - 10 + 'px').on('mouseleave', function () {\n        body.selectAll('.graph-tooltip').remove();\n      }).append('p').text(Math.round(d.y * 1000) / 1000);\n    });\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      values: '=',\n      height: '@',\n      width: '@',\n      color: '@?'\n    },\n    link: function (scope, element, attrs) {\n      scope.$watch('values', function () {\n        if (!scope.values) return;\n        drawChart(scope.values, {\n          lineColor: scope.color,\n          element: d3.select(element[0]),\n          width: Number(scope.width),\n          height: Number(scope.height)\n        });\n      });\n    }\n  };\n}).directive('c3ChartDisplay', function ($window) {\n  var c3 = $window.c3;\n\n  function normalize(data) {\n    if (typeof data != 'object') {\n      return {\n        columns: data\n      };\n    }\n\n    return data;\n  }\n\n  var makeChart = function (element, data, axes) {\n    var celem = element.find('div');\n\n    if (!data || !axes) {\n      celem.remove();\n      return;\n    }\n\n    if (!celem.length) {\n      celem = angular.element('<div></div>').appendTo(element);\n    }\n\n    var args = {\n      bindto: celem[0],\n      data: normalize(data)\n    };\n\n    if (axes) {\n      args.axis = axes;\n    }\n\n    return c3.generate(args);\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      data: '=',\n      axes: '='\n    },\n    template: '<span></span>',\n    link: function (scope, element, attrs) {\n      var chart;\n      scope.$watch('axes', function (o, n) {\n        if (!chart || o != n) chart = makeChart(element, scope.data, scope.axes, chart);\n      });\n      scope.$watch('data', function (o, n) {\n        if (!chart || o != n) {\n          chart = makeChart(element, scope.data, scope.axes, chart);\n        } else if (chart) {\n          // chart.unload();\n          chart.load(normalize(scope.data));\n        }\n      });\n    }\n  };\n}).directive('a2Info', function () {\n  return {\n    replace: true,\n    restrict: 'E',\n    template: '<i class=\"text-info fa fa-info-circle\"></i>'\n  };\n}).directive('a2BsNgModelOnDirtySaveButton', function ($parse) {\n  return {\n    restrict: 'A',\n    require: 'ngModel',\n    link: function (scope, element, attrs, ngModel) {\n      var saveBtn;\n      var onDirtySaveFN = $parse(attrs.a2BsNgModelOnDirtySaveButton);\n\n      function addSaveBtn() {\n        element.wrap('<div class=\"input-group\"></div>');\n        var parentEl = element.parent();\n        saveBtn = angular.element('<div class=\"input-group-btn\">' + '    <button class=\"btn btn-primary\"><i class=\"fa fa-save\"></i></button>' + '</div>');\n        saveBtn.find('button.btn').on('click', function () {\n          onDirtySaveFN(scope, {\n            $name: ngModel.$name,\n            $modelValue: ngModel.$modelValue,\n            $setPristine: function () {\n              ngModel.$setPristine();\n              removeSaveBtn();\n            }\n          });\n        });\n        saveBtn.appendTo(parentEl);\n      }\n\n      function removeSaveBtn() {\n        if (saveBtn) {\n          saveBtn.remove();\n        }\n\n        element.unwrap();\n        saveBtn = undefined;\n      }\n\n      ngModel.$viewChangeListeners.push(function () {\n        if (ngModel.$dirty && !saveBtn) {\n          addSaveBtn();\n        } else if (saveBtn) {\n          removeSaveBtn();\n        }\n      });\n    }\n  };\n}).factory('canvasObjectURL', function ($window, $q) {\n  var createObjectURL = $window.URL.createObjectURL;\n  var revokeObjectURL = $window.URL.revokeObjectURL;\n\n  if (!createObjectURL && $window.webkitURL.createObjectURL) {\n    createObjectURL = $window.webkitURL.createObjectURL;\n    revokeObjectURL = $window.webkitURL.revokeObjectURL;\n  }\n\n  if (!createObjectURL) {\n    revokeObjectURL = function () {};\n  }\n\n  function dataURIToBinaryBuffer(dataURI) {\n    var BASE64_MARKER = ';base64,';\n    var base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;\n    var base64 = dataURI.substring(base64Index);\n    var raw = $window.atob(base64);\n    var rawLength = raw.length;\n    var array = new $window.Uint8Array(new $window.ArrayBuffer(rawLength));\n\n    for (i = 0; i < rawLength; i++) {\n      array[i] = raw.charCodeAt(i);\n    }\n\n    return array.buffer;\n  }\n\n  function getCanvasBlob(canvas) {\n    if (canvas.toBlob) {\n      return $q(function (resolve) {\n        canvas.toBlob(resolve);\n      });\n    } else {\n      var data = dataURIToBinaryBuffer(canvas.toDataURL(\"image/png\"));\n      var blob;\n      var BlobBuilder = $window.BlobBuilder || $window.WebKitBlobBuilder;\n\n      if (BlobBuilder) {\n        var bb = new WebKitBlobBuilder();\n        bb.append(data);\n        blob = bb.getBlob(\"image/png\");\n      } else {\n        blob = new $window.Blob([data], {\n          type: 'image/png'\n        });\n      }\n\n      return $q.resolve(blob);\n    }\n  }\n\n  return {\n    create: function (canvas) {\n      if (!createObjectURL) {\n        return $q.resolve(canvas.toDataURL(\"image/png\"));\n      }\n\n      return getCanvasBlob(canvas).then(function (blob) {\n        return createObjectURL(blob);\n      });\n    },\n    revoke: revokeObjectURL\n  };\n}).directive('axis', function (canvasObjectURL, $q, $debounce) {\n  var promiseCache = {};\n  var canvas = angular.element('<canvas></canvas>')[0];\n\n  function computeHash(w, h, type, data) {\n    return JSON.stringify([w, h, type, data]);\n  }\n\n  function createAxisData(canvas, w, h, type, data) {\n    if (!w || !h) {\n      return $q.reject(\"Empty canvas size\");\n    }\n\n    canvas.width = w;\n    canvas.height = h;\n    var i;\n    var prec = data.prec || 1;\n    var min = (data.range[0] / prec | 0) * prec;\n    var max = (data.range[1] / prec | 0) * prec;\n    var scale;\n    var unit = data.unit;\n    var count = data.count || 1;\n    var dTick = (((max - min) / prec | 0) / count | 0) * prec;\n    var ctx = canvas.getContext('2d');\n    var w1 = w - 1,\n        h1 = h - 1; // var compStyle = getComputedStyle(canvas);\n\n    ctx.font = data.font;\n    ctx.strokeStyle = data.color;\n    ctx.lineWidth = 0.5;\n    ctx.clearRect(0, 0, w, h);\n    var val,\n        x,\n        y,\n        pad = 3;\n    var lblSize = {\n      w: 0,\n      h: 10\n    };\n    var loopCt = data.loopCt || 250;\n\n    for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n      var tW = ctx.measureText(val + unit).width;\n\n      if (lblSize.w < tW) {\n        lblSize.w = tW;\n      }\n    }\n\n    if (type == 'h') {\n      ctx.textAlign = 'left';\n      ctx.textBaseline = 'top';\n      scale = w / (max - min);\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(w1, 0);\n      ctx.stroke();\n      loopCt = data.loopCt || 250;\n\n      for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n        x = scale * (val - min);\n\n        if (val >= max - dTick) {\n          ctx.textAlign = 'right';\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(x, pad);\n        ctx.lineTo(x, 0);\n        ctx.stroke();\n        ctx.strokeText(val + unit, x, pad);\n      }\n    } else if (type == 'v') {\n      ctx.textAlign = 'right';\n      ctx.textBaseline = 'alphabet';\n      scale = h / (max - min);\n      ctx.beginPath();\n      ctx.moveTo(w1, 0);\n      ctx.lineTo(w1, h1);\n      ctx.stroke();\n      loopCt = data.loopCt || 250;\n\n      for (val = min; loopCt > 0 && val < max; val += dTick, --loopCt) {\n        y = h - scale * (val - min);\n\n        if (val >= max - dTick) {\n          ctx.textBaseline = 'top';\n        }\n\n        ctx.beginPath();\n        ctx.moveTo(w1 - pad, y);\n        ctx.lineTo(w1, y);\n        ctx.stroke();\n        ctx.strokeText(val + unit, lblSize.w, y, w1 - pad - 1);\n      }\n    } // {\n    //     range:[0, recording.sample_rate/2000],\n    //     count:10,\n    //     unit:'kHz'\n    // }\n    // console.log(\"drawAxis(\",canvas, w, h, type, data,\")\");\n\n\n    return canvasObjectURL.create(canvas); // return canvas.toDataURL();\n  }\n\n  function drawAxisOnImg(img, w, h, type, data) {\n    var hash = computeHash(w, h, type, data);\n    var axisDataPromise = promiseCache[hash];\n\n    if (!axisDataPromise) {\n      axisDataPromise = promiseCache[hash] = createAxisData(canvas, w, h, type, data);\n    }\n\n    return axisDataPromise.then(function (axisData) {\n      img.src = axisData;\n    });\n  }\n\n  return {\n    restrict: 'E',\n    template: '<img />',\n    scope: {\n      type: \"@\",\n      data: \"=\"\n    },\n    link: function (scope, element, attrs) {\n      var img = element.find('img')[0];\n      var tout;\n      var redrawAxis = $debounce(function () {\n        drawAxisOnImg(img, element.width(), element.height(), scope.type, scope.data);\n      }, 500);\n\n      function elementSize() {\n        return element.width() * element.height();\n      }\n\n      scope.$watch(elementSize, redrawAxis);\n      scope.$watch('type', redrawAxis);\n      scope.$watch('data', redrawAxis);\n    }\n  };\n}).filter('consoleLog', function () {\n  return function (x, type) {\n    console[type || 'log'](x);\n    return x;\n  };\n}).filter('mouseEventContainerPercent', function () {\n  return function ($event, selector) {\n    var target = angular.element($event.currentTarget);\n\n    if (selector) {\n      target = target.closest(selector);\n    }\n\n    var targetpos = target.offset();\n    var px = ($event.pageX - targetpos.left) / target.width();\n    var py = ($event.pageY - targetpos.top) / target.height();\n    return {\n      x: px,\n      y: py\n    };\n  };\n}).directive('onErrorSrc', function () {\n  return {\n    link: function (scope, element, attrs) {\n      element.bind('error', function () {\n        if (attrs.src != attrs.onErrorSrc) {\n          attrs.$set('src', attrs.onErrorSrc);\n        }\n      });\n    }\n  };\n});","angular.module('a2.forms', ['templates-arbimon2']).run(function ($window) {\n  // load zxcvbn \n  var loadZXCVBN = function () {\n    var a, b;\n    b = $window.document.createElement(\"script\");\n    b.src = \"/includes/zxcvbn/zxcvbn.js\";\n    b.type = \"text/javascript\";\n    b.async = !0;\n    a = $window.document.getElementsByTagName(\"script\")[0];\n    return a.parentNode.insertBefore(b, a);\n  };\n\n  if ($window.attachEvent) $window.attachEvent(\"onload\", loadZXCVBN);else $window.addEventListener(\"load\", loadZXCVBN, !1);\n}).directive('passwordInput', function ($window) {\n  return {\n    restrict: 'E',\n    scope: {\n      password: '=ngModel',\n      // password\n      validation: '=',\n      // validation object\n      userInputs: '=?' // array of strings to test password (username, name, lastname, etc)\n\n    },\n    templateUrl: '/directives/password-input.html',\n    controller: function ($scope) {\n      $scope.requiredScore = 2;\n      $scope.minLength = 6;\n      $scope.maxLength = 32;\n      $scope.validation = getValidation();\n\n      function getValidation() {\n        return $scope.validation || ($scope.validation = {\n          confirm: null,\n          result: {},\n          valid: false,\n          msg: ''\n        });\n      }\n\n      if (!$scope.userInputs) {\n        $scope.userInputs = [];\n      }\n\n      $scope.testConfirm = function () {\n        var validation = getValidation();\n        validation.result.confirm = null;\n\n        if (!validation.result.pass || !$scope.password) {\n          return;\n        } else if (validation.result.pass.score < $scope.requiredScore) {\n          $scope.validation.msg = 'password need to be stronger';\n          return;\n        }\n\n        if ($scope.password === validation.confirm) {\n          validation.result.confirm = {\n            ok: true\n          };\n          validation.valid = true;\n          validation.msg = '';\n        } else {\n          validation.result.confirm = {\n            err: \"Passwords do not match\"\n          };\n          validation.msg = validation.result.confirm.err;\n        }\n      };\n\n      $scope.testPass = function () {\n        var validation = getValidation(); // wait for zxcvbn library to be available\n\n        if (typeof $window.zxcvbn === 'undefined') {\n          if ($scope.waitForZxcvbn) return;\n          $scope.waitForZxcvbn = $interval(function () {\n            if (typeof $window.zxcvbn !== 'undefined') {\n              $interval.cancel($scope.waitForZxcvbn);\n              $scope.testPass();\n            }\n          }, 500);\n          return;\n        }\n\n        if ($scope.waitForZxcvbn) {\n          $interval.cancel($scope.waitForZxcvbn);\n        }\n\n        validation.result.pass = null;\n        var colors = ['#da3939', '#da3939', '#84b522', '#62b522', '#31b523'];\n        var mesgs = ['Very Weak', 'Weak', 'Average', 'Strong', 'Very strong'];\n\n        if (!$scope.password) {\n          return;\n        } else if ($scope.password.length < 6 || $scope.password.length > 32) {\n          var size = $scope.password.length < 6 ? 'short' : 'long';\n          validation.result.pass = {\n            shields: [],\n            color: colors[0],\n            msg: 'Password is too ' + size + ', 6-32 characters'\n          };\n          $scope.validation.msg = validation.result.pass.msg;\n        } else {\n          var test = $window.zxcvbn($scope.password, $scope.userInputs);\n          validation.result.pass = {\n            score: test.score,\n            shields: new Array(test.score + 1),\n            color: colors[test.score],\n            msg: mesgs[test.score]\n          };\n          $scope.testConfirm();\n        }\n      };\n    }\n  };\n}).directive('projectForm', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      project: '=ngModel',\n      // password\n      valid: '=' // validation object\n\n    },\n    templateUrl: '/directives/project-form.html',\n    controllerAs: 'controller',\n    controller: function ($scope) {\n      var urlPattern = /^[a-z0-9]+([-_][a-z0-9]+)*$/i;\n      this.deriveUrlFromName = true;\n\n      this.nameChanged = function () {\n        if (this.deriveUrlFromName) {\n          $scope.project.url = ($scope.project.name || '').replace(/[^a-z0-9A-Z-]/g, '-').replace(/-+/g, '-').replace(/(^-)|(-$)/g, '').replace(/[A-Z]/g, function (_1) {\n            return _1.toLowerCase();\n          });\n        }\n\n        $scope.verify();\n      };\n\n      this.urlChanged = function () {\n        this.deriveUrlFromName = false;\n        $scope.verify();\n      };\n\n      $scope.verify = function () {\n        var good = true;\n        $scope.errorName = '';\n        $scope.errorUrl = ''; // check name\n\n        if (!$scope.project.name) {\n          good = false;\n        } else if ($scope.project.name.length < 6 && $scope.project.name.length > 0) {\n          $scope.errorName = 'Name too short, 6 or more characters required';\n          good = false;\n        } else if ($scope.project.name.length > 50) {\n          $scope.errorName = 'Name too long, 50 characters max';\n          good = false;\n        } //check URL\n\n\n        if (!$scope.project.url) {\n          good = false;\n        } else if (!urlPattern.test($scope.project.url)) {\n          $scope.errorUrl = 'Invalid project URL alphanumeric characters ' + 'separated by dash(-) or underscore(_)';\n          good = false;\n        } else if ($scope.project.url.length < 6) {\n          $scope.errorUrl = 'URL too short, 6 or more alphanumeric characters ' + 'separated by dash(-) or underscore(_)';\n          good = false;\n        } else if ($scope.project.url.length > 50) {\n          $scope.errorUrl = 'URL too long, 50 characters max';\n          good = false;\n        }\n\n        $scope.valid = good;\n        return good;\n      };\n\n      if ($scope.project) {\n        $scope.verify();\n      } else {\n        $scope.project = {\n          is_private: 1\n        };\n        $scope.valid = false;\n      }\n\n      $scope.$watch('project', function () {\n        $scope.verify();\n      });\n    }\n  };\n});","angular.module('a2.qr-js', []).directive('a2QrCode', function ($window) {\n  var qr = $window.qr;\n  var $ = $window.$;\n  return {\n    restrict: 'E',\n    scope: {\n      data: '@'\n    },\n    link: function ($scope, $element, $attr) {\n      var canvas = $('<canvas></canvas>').appendTo($element);\n      $attr.$observe('data', function (data) {\n        qr.canvas({\n          canvas: canvas[0],\n          size: 10,\n          level: 'Q',\n          value: data\n        });\n      });\n    }\n  };\n});","angular.module('c3-charts', []).directive('c3Chart', function ($window) {\n  return {\n    restrict: 'E',\n    scope: {\n      columns: '='\n    },\n    link: function (scope, element, attrs) {\n      console.log('corri');\n      $window.chart = scope.chart = $window.c3.generate({\n        bindto: element[0],\n        size: {\n          width: attrs.width,\n          height: attrs.height\n        },\n        tooltip: {\n          show: false\n        },\n        data: {\n          columns: scope.columns || [],\n          type: attrs.type\n        }\n      });\n      scope.$watch('columns', function () {\n        if (scope.columns) {\n          scope.chart.load({\n            columns: scope.columns || []\n          });\n        }\n      });\n    }\n  };\n});","angular.module('a2.directive.error-message', []).directive('errorMessage', function ($http, $window) {\n  var message = '';\n  return {\n    templateUrl: '/directives/error-message.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      message: \"=\"\n    },\n    link: function ($scope) {\n      message = $scope.message;\n    }\n  };\n});","angular.module('a2.directive.frequency_filter_range_control', []).directive('a2VisualizerFrequencyFilterRangeControl', function () {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/frequency_filter_range_control.html',\n    scope: {\n      imgSrc: \"=\",\n      filterMin: \"=\",\n      filterMax: \"=\",\n      maxFreq: \"=\"\n    },\n    link: function (scope, element, attrs) {\n      'use strict';\n\n      var pressed;\n      var container = element.find('.a2-audio-freq-filter-component');\n\n      function detectMouseUp(event) {\n        pressed = undefined;\n        angular.element(document).off('mousemove', detectMouseMove);\n      }\n\n      function detectMouseDown(event) {\n        var btn = event.buttons === undefined ? event.which : event.buttons;\n\n        if (btn == 1) {\n          pressed = event.target;\n          angular.element(document).on('mousemove', detectMouseMove);\n        }\n      }\n\n      function detectMouseMove(event) {\n        if (pressed) {\n          var m = /bottom|top/.exec(pressed.className);\n\n          if (m) {\n            var eloff = container.offset();\n            var y = event.pageY - eloff.top;\n            var ammount = scope.maxFreq * Math.max(0, Math.min(1 - y / pressed.parentNode.clientHeight, 1));\n            ammount = (ammount / 100 | 0) * 100; // cast to int and quantize\n\n            var attr = m[0] == 'top' ? 'filterMax' : 'filterMin';\n            scope[attr] = ammount;\n\n            if (scope.filterMin > scope.filterMax) {\n              scope.filterMax = ammount;\n              scope.filterMin = ammount;\n            }\n\n            scope.$apply();\n          }\n        }\n      }\n\n      container.find('button').on('mousedown', detectMouseDown);\n      container.on('mousemove', function (event) {});\n      angular.element(document).on('mouseup', detectMouseUp);\n      element.on('$destroy', function () {\n        angular.element(document).off('mouseup', detectMouseUp);\n        angular.element(document).off('mousemove', detectMouseMove);\n      });\n    }\n  };\n});","angular.module('g-recaptcha', []).directive('gRecaptcha', function ($interval, $timeout, $window) {\n  return {\n    restrict: \"A\",\n    scope: {\n      sitekey: '@',\n      theme: '@?',\n      type: '@?',\n      response: '=',\n      // readonly captchaResponse \n      resetWidget: '=?' // readonly method to reset the widget\n\n    },\n    link: function (scope, element, attr) {\n      var waitForRecaptcha = $interval(function () {\n        if (typeof $window.grecaptcha !== 'undefined') {\n          $interval.cancel(waitForRecaptcha);\n          var grecaptcha = $window.grecaptcha;\n          scope.widgetId = grecaptcha.render(element[0], {\n            sitekey: scope.sitekey,\n            theme: scope.theme,\n            type: scope.type,\n            callback: function (response) {\n              scope.response = response;\n              scope.$apply();\n              scope.resetTimeout = $timeout(function () {\n                grecaptcha.reset(scope.widgetId);\n              }, 30000);\n            }\n          });\n\n          scope.resetWidget = function () {\n            if (scope.resetTimeout) {\n              $timeout.cancel(scope.resetTimeout);\n            }\n\n            grecaptcha.reset(scope.widgetId);\n          };\n        }\n      }, 500);\n    }\n  };\n});","angular.module('a2.directive.news-feed-item', ['a2.srv.news', 'templates-arbimon2', 'a2.directive.a2-tags', 'a2.filter.time-from-now']).directive('newsFeedItem', function (a2NewsService, $compile) {\n  function parseFormat(format) {\n    var RE_INTERP = /%\\((\\w+)\\)s/g;\n    var interpolate = [],\n        m;\n    var lastidx,\n        matchidx,\n        startidx = 0; // jshint -W084\n\n    while (m = RE_INTERP.exec(format)) {\n      lastidx = startidx;\n      matchidx = RE_INTERP.lastIndex - m[0].length;\n\n      if (lastidx < matchidx) {\n        interpolate.push(format.substr(lastidx, matchidx - lastidx));\n      }\n\n      interpolate.push(\"<span a2-tag-\" + m[1] + \"=\\\"news.data.\" + m[1] + \"\\\" ></span>\");\n      startidx = RE_INTERP.lastIndex;\n    }\n\n    if (startidx < format.length) {\n      interpolate.push(format.substr(startidx));\n    }\n\n    return '<span>' + interpolate.join('') + '</span>';\n  }\n\n  var parsedFormatsPromise = a2NewsService.loadFormats().then(function (formats) {\n    return Object.keys(formats).reduce(function (_, i) {\n      _[i] = parseFormat(formats[i]);\n      return _;\n    }, {});\n  });\n  return {\n    restrict: 'EAC',\n    scope: {\n      news: '=newsFeedItem'\n    },\n    templateUrl: '/directives/news-feed-item.html',\n    link: function (scope, element, attrs) {\n      var message = element.find('.message');\n      scope.$watch('news', function (news) {\n        parsedFormatsPromise.then(function (parsedFormats) {\n          message.empty().append($compile(parsedFormats[news.type])(scope));\n        });\n      });\n    }\n  };\n});","angular.module('a2.directive.plotly-plotter', ['a2.directive.on-resize', 'a2.service.plotly-defaults', 'a2.service.plotly-plot-maker']).directive('plotlyPlotter', function ($window, a2OnResizeService, PlotlyDefaults, plotlyPlotMaker) {\n  return {\n    restrict: 'E',\n    scope: {\n      layout: '=?',\n      data: '=?'\n    },\n    link: function (scope, element, attrs) {\n      function mergeData(data) {\n        return plotlyPlotMaker.mergeData(data, PlotlyDefaults);\n      }\n\n      function mergeLayout(layout) {\n        return plotlyPlotMaker.mergeLayout(layout, PlotlyDefaults);\n      }\n\n      Plotly.newPlot(element[0], mergeData(scope.data), mergeLayout(scope.layout), PlotlyDefaults.config);\n      var resizeWatcher = a2OnResizeService.newWatcher(element, function (newSize) {\n        Plotly.relayout(element[0], newSize);\n      });\n\n      if (attrs.layout) {\n        scope.$watch('layout', function (layout, old) {\n          if (layout && layout != old) {\n            Plotly.relayout(element[0], mergeLayout(layout));\n          }\n        });\n      }\n\n      if (attrs.data) {\n        scope.$watch('data', function (data, old) {\n          if (data && data != old) {\n            // Plotly.purge(element[0]);\n            console.log(\"Plotly plot data ::\", data, scope.layout);\n            Plotly.newPlot(element[0], mergeData(scope.data), mergeLayout(scope.layout), PlotlyDefaults.config);\n          }\n        });\n      }\n\n      scope.$on('$destroy', function () {\n        resizeWatcher.destroy();\n      });\n    }\n  };\n});","angular.module('a2.directive.search-bar', []).directive('searchBar', function ($http, $window) {\n  var q = '';\n  var projectsLoading;\n  var projects = [];\n  return {\n    templateUrl: '/directives/search-bar.html',\n    restrict: 'E',\n    scope: {\n      projectsLoading: \"=?\",\n      q: \"=?\",\n      isUnsafe: \"@\"\n    },\n    link: function ($scope) {\n      $scope.q = q;\n      $scope.projectsLoading = projectsLoading;\n      $scope.projects = projects;\n\n      $scope.findProject = function () {\n        var config = {\n          params: {\n            publicTemplates: true\n          }\n        };\n\n        if ($scope.q !== '') {\n          config.params.q = $scope.q;\n        }\n\n        $scope.projectsLoading = true;\n        return $http.get('/legacy-api/user/projectlist', config).then(function (result) {\n          $scope.projectsLoading = false;\n          $scope.projects = result.data;\n          return result.data;\n        });\n      };\n\n      $scope.selectProject = function () {\n        if (!$scope.q || $scope.q && !$scope.q.is_enabled) {\n          return;\n        }\n\n        $window.location.assign('/project/' + $scope.q.url + '/');\n      };\n    }\n  };\n});","angular.module('arbimon2.directive.validation-dropdown', []).directive('validationDropdown', function () {\n  var empty_option = {\n    label: undefined,\n    val: undefined\n  };\n  var val_options = [{\n    label: \"Clear\",\n    val: 2\n  }, {\n    label: \"Present\",\n    val: 1\n  }, {\n    label: \"Absent\",\n    val: 0\n  }];\n  var by_val = val_options.reduce(function (_, option) {\n    _[option.val] = option;\n    return _;\n  }, {});\n  return {\n    templateUrl: '/directives/validation-dropdown.html',\n    require: 'ngModel',\n    scope: {},\n    link: function (scope, element, attrs, ngModelCtrl) {\n      scope.options = val_options;\n\n      function updateLabel(val) {\n        var option = val < 2 && by_val[val] ? by_val[val] : empty_option;\n        scope.val = option.val;\n        scope.label = option.label;\n      }\n\n      scope.select = function (val) {\n        updateLabel(val);\n        ngModelCtrl.$$lastCommittedViewValue = undefined;\n        ngModelCtrl.$modelValue = undefined;\n        ngModelCtrl.$setViewValue(val, true);\n      };\n\n      ngModelCtrl.$render = function () {\n        updateLabel(ngModelCtrl.$viewValue);\n      };\n    }\n  };\n});","angular.module('a2.directive.warning-banner', []).directive('warningBanner', function ($http, $window) {\n  var message = 0;\n  return {\n    templateUrl: '/directives/warning-banner.html',\n    restrict: 'E',\n    replace: true,\n    scope: {\n      message: \"=\"\n    },\n    link: function ($scope) {\n      message = $scope.message;\n    }\n  };\n});","angular.module('a2.googlemaps', []).provider(\"a2GoogleMapsLoader\", function () {\n  var defer;\n  var apiKey;\n\n  function loadScript($window, $q) {\n    if (!defer) {\n      return;\n    }\n\n    var cb_name = 'gmcb';\n\n    while ($window[cb_name]) {\n      cb_name += '_';\n    }\n\n    $window[cb_name] = function () {\n      defer.resolve($window.google);\n    };\n\n    var script = $window.document.createElement('script');\n    var params = ['callback=' + cb_name];\n\n    if (apiKey) {\n      params.push('key=' + apiKey);\n    }\n\n    script.src = $window.document.location.protocol + '//maps.googleapis.com/maps/legacy-api/js?' + params.join('&');\n    $window.document.body.appendChild(script);\n  }\n\n  return {\n    setAPIKey: function (key) {\n      apiKey = key;\n    },\n    $get: function ($window, $q) {\n      if (!defer) {\n        defer = $q.defer();\n        loadScript($window, $q);\n      }\n\n      return defer.promise;\n    }\n  };\n});","angular.module('a2.heremaps', []).constant('a2HereMarkerTextIconTemplate', '<div class=\"map-marker\">' + '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"28px\" height=\"36px\">' + '<path d=\"M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z\" fill=\"#000\" fill-opacity=\".2\"/>' + '<path d=\"M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z\" fill=\"#fff\"/>' + '<path d=\"M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z\" fill=\"#18d\"/>' + '</svg>' + '<span>${text}</span>' + '</div>').provider(\"a2HereMapsLoader\", function (a2HereMarkerTextIconTemplate) {\n  var loadPromise;\n  var appId;\n  var appCode;\n\n  function loadScript($window, $q) {\n    function loadOneScript(src) {\n      return $q(function (resolve, reject) {\n        var script = $window.document.createElement('script');\n        script.src = $window.document.location.protocol + src;\n        script.addEventListener('load', resolve);\n        script.addEventListener('error', reject);\n        $window.document.body.appendChild(script);\n      });\n    }\n\n    return loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-core.js\").then(function () {\n      return $q.all([loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-service.js\"), loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-ui.js\"), loadOneScript(\"//js.api.here.com/v3/3.0/mapsjs-mapevents.js\")]);\n    }).then(function () {\n      var api = $window.H;\n      return {\n        api: api,\n        makeTextIcon: function (text) {\n          return new H.map.DomIcon(a2HereMarkerTextIconTemplate.replace('${text}', text));\n        },\n        platform: new api.service.Platform({\n          app_id: appId,\n          app_code: appCode,\n          useHTTPS: /https/.test($window.document.location.protocol)\n        })\n      };\n    });\n  }\n\n  return {\n    setAPIIdAndCode: function (id, code) {\n      appId = id;\n      appCode = code;\n    },\n    $get: function ($window, $q) {\n      if (!loadPromise) {\n        loadPromise = loadScript($window, $q);\n      }\n\n      return loadPromise;\n    }\n  };\n});","angular.module('a2.permissions', ['a2.services', 'ng-permissions']).run(function ($rootScope, a2UserPermit) {\n  $rootScope.userPermit = a2UserPermit;\n}).service('a2UserPermit', function ($http, Project, $q, permits) {\n  var permit = permits;\n  return {\n    all: permit.permissions,\n    isSuper: function () {\n      return permit.super;\n    },\n    isRfcx: function () {\n      return permit.rfcxUser;\n    },\n    isAuthorized: function () {\n      return permit.isAuthorized;\n    },\n    isProjectMember: function () {\n      return permit.isAuthorized && (permit.permissions && permit.permissions.length > 0 || permit.super || permit.rfcxUser);\n    },\n    getUserEmail: function () {\n      return permit.userEmail;\n    },\n    has: function (feature) {\n      return permit.features && permit.features[feature];\n    },\n    can: function (perm) {\n      var allowed;\n\n      if (permit.permissions) {\n        allowed = (Array.isArray(perm) ? perm : [perm]).reduce(function (_, perm) {\n          return _ && permit.permissions.indexOf(perm) !== -1;\n        }, true);\n      }\n\n      return allowed || permit.super;\n    }\n  };\n});","angular.module('a2.utils-browser-metrics', []).service('a2BrowserMetrics', function () {\n  var metrics = {};\n  var css = {\n    \"border\": \"none\",\n    \"height\": \"200px\",\n    \"margin\": \"0\",\n    \"padding\": \"0\",\n    \"width\": \"200px\"\n  };\n  var inner = $(\"<div>\").css($.extend({}, css));\n  var outer = $(\"<div>\").css($.extend({\n    \"left\": \"-1000px\",\n    \"overflow\": \"scroll\",\n    \"position\": \"absolute\",\n    \"top\": \"-1000px\"\n  }, css)).append(inner).appendTo(\"body\").scrollLeft(1000).scrollTop(1000);\n  metrics.scrollSize = {\n    height: outer.offset().top - inner.offset().top | 0,\n    width: outer.offset().left - inner.offset().left | 0\n  };\n  outer.remove();\n  return metrics;\n});","angular.module('a2.utils', ['a2.utils-browser-metrics']).factory('$templateFetch', function ($http, $templateCache) {\n  return function $templateFetch(templateUrl, linker) {\n    var template = $templateCache.get(templateUrl);\n\n    if (template) {\n      if (template.promise) {\n        template.linkers.push(linker);\n      } else {\n        linker(template);\n      }\n    } else {\n      var tmp_promise = {\n        linkers: [linker],\n        promise: $http.get(templateUrl).success(function (template) {\n          $templateCache.put(templateUrl, template);\n\n          for (var i = 0, l = tmp_promise.linkers, e = l.length; i < e; ++i) {\n            l[i](template);\n          }\n        })\n      };\n      $templateCache.put(templateUrl, tmp_promise);\n    }\n  };\n}).factory('a2EventEmitter', function ($q) {\n  function a2EventEmitter() {\n    this.list = {};\n  }\n\n  a2EventEmitter.prototype = {\n    on: function (event, callback) {\n      var list = this.list[event] || (this.list[event] = []);\n      list.push(callback);\n      return callback;\n    },\n    off: function (event, callback) {\n      var list = this.list[event];\n\n      if (list) {\n        var idx = list.indexOf(callback);\n\n        if (idx) {\n          list.splice(idx, 1);\n        }\n      }\n    },\n    emit: function (event) {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var list = this.list[event];\n\n      if (list) {\n        for (var i = 0, e = list.length; i < e; ++i) {\n          list[i].apply(null, args);\n        }\n      }\n\n      return $q.resolve();\n    }\n  };\n  return a2EventEmitter;\n}).factory('itemSelection', function () {\n  return {\n    make: function make_itemSelection_obj(item_name) {\n      var sel = {};\n\n      if (typeof item_name == 'undefined') {\n        item_name = 'value';\n      }\n\n      sel[item_name] = null;\n\n      sel.select = function (newValue) {\n        sel[item_name] = newValue;\n      };\n\n      return sel;\n    }\n  };\n}) // display localtime formated by momentjs\n.filter('moment', function () {\n  return function (input, fmt) {\n    if (!input) return undefined;\n    return moment(input).format(fmt);\n  };\n}) // display UTC formated by momentjs\n.filter('momentUtc', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return moment(x).utc().format(fmt);\n  };\n}) // display site localtime formated by momentjs\n.filter('momentTz', function () {\n  return function (x, fmt, timezone) {\n    if (!x) {\n      return undefined;\n    }\n\n    return moment.tz(x, timezone).format(fmt);\n  };\n}) // divides array of into pages of limitPerPage size\n.filter('paginate', function () {\n  return function (arr, currentPage, limitPerPage) {\n    if (!arr) return undefined;\n    return arr.slice((currentPage - 1) * limitPerPage, currentPage * limitPerPage);\n  };\n})\n/** Pluralizes singular words accoring to some heuristics that (hopefully)\n *  look like english grammar.\n */\n.filter('plural', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return x + 's';\n  };\n}) // replace underscores or dashes for spaces\n.filter('worded', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return ('' + x).replace(/[_-]/g, ' ');\n  };\n}) // capitalize words\n.filter('wordCaps', function () {\n  return function (x, fmt) {\n    if (!x) return undefined;\n    return ('' + x).replace(/\\b(\\w)/g, function (_1) {\n      return _1.toUpperCase();\n    });\n  };\n})\n/**\n * @ngdoc factory\n * @name a2.utils.factory:$debounce\n * @description asynchronous debouncing function decorator\n * Decorates an asynchronous function with a debouncing function. A debouncing\n * function withholds the function call by a set ammount of time and wait for\n * any othe function calls, resetting the wait for time every call. After its wait\n * time, the function gets called with the last given arguments and context.\n * @param {Function} fn - the function to debounce\n * @param {Function} rate - the timeout\n * @return {Promise} resolved with the function's return value.\n */\n.factory('$debounce', function ($timeout, $q, $log) {\n  return function $debounce(fn, rate) {\n    var timeoutPromise, qDefer, debouncePromise;\n    rate = rate || 100;\n    return function () {\n      var self = this;\n      var args = Array.prototype.slice.call(arguments);\n\n      if (timeoutPromise) {\n        $timeout.cancel(timeoutPromise);\n      }\n\n      if (!qDefer) {\n        qDefer = $q.defer();\n        debouncePromise = qDefer.promise.then(function () {\n          // qDefer got resolved. forget it's reference in case of recursivity.\n          qDefer = null;\n          return fn.apply(self, args);\n        });\n      }\n\n      timeoutPromise = $timeout(function () {\n        qDefer.resolve();\n      }, rate);\n      return debouncePromise;\n    };\n  };\n}).factory('a2LookaheadHelper', function ($q) {\n  var a2LookaheadHelper = function (options) {\n    this.options = options || {};\n\n    if (!options.searchCompare) {\n      options.searchCompare = function (a, b) {\n        return a == b;\n      };\n    }\n  };\n\n  a2LookaheadHelper.prototype = {\n    search: function (text) {\n      var options = this.options;\n\n      if (options.minLength && text.length < options.minLength) {\n        return $q.resolve([]);\n      }\n\n      var promise = options.fn(text);\n\n      if (options.includeSearch) {\n        promise = promise.then(function (items) {\n          var textItem = items.filter(function (item) {\n            return options.searchCompare(text, item);\n          }).pop();\n\n          if (!textItem) {\n            items.unshift(options.searchPromote ? options.searchPromote(text) : text);\n          }\n\n          return items;\n        });\n      }\n\n      return promise;\n    }\n  };\n  return a2LookaheadHelper;\n}).service('EventlistManager', function () {\n  var EventlistManager = function () {\n    this.events = {};\n  };\n\n  EventlistManager.prototype.get_event_def = function (event) {\n    if (!this.events[event]) {\n      this.events[event] = {};\n    }\n\n    return this.events[event];\n  };\n\n  EventlistManager.prototype.send = function ()\n  /* ...args */\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var event = args.shift();\n\n    if (typeof event == 'string') {\n      event = {\n        event: event\n      };\n    }\n\n    var eventdef = this.get_event_def(event.event);\n\n    if (event.oneTime) {\n      eventdef.oneTime = true;\n    }\n\n    var context = event.context;\n    var listeners = eventdef.listeners;\n    eventdef.fired = true;\n\n    if (listeners) {\n      listeners.forEach(function (l) {\n        l.apply(context, args);\n      });\n    }\n  };\n\n  EventlistManager.prototype.on = function (event, fn) {\n    var eventdef = this.get_event_def(event);\n\n    if (eventdef.fired && eventdef.oneTime) {\n      fn.apply();\n    } else {\n      if (!eventdef.listeners) {\n        eventdef.listeners = [];\n      }\n\n      eventdef.listeners.push(fn);\n    }\n  };\n\n  return EventlistManager;\n}); // TODO break to multiple files\n\nangular.module('a2.infotags', ['a2.services']).directive('a2Species', function (Species, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      species: '='\n    },\n    template: '{{data.scientific_name}}',\n    link: function ($scope, $element, $attrs) {\n      $scope.$watch('species', function (newVal, oldVal) {\n        $scope.data = null;\n\n        if (newVal) {\n          Species.findById(newVal, function (data) {\n            $timeout(function () {\n              $scope.data = data;\n            });\n          });\n        }\n      });\n    }\n  };\n}).directive('a2.songtype', function (Songtypes, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      songtype: '='\n    },\n    template: '{{data.name}}',\n    link: function ($scope, $element, $attrs) {\n      $scope.$watch('songtype', function (newVal, oldVal) {\n        $scope.data = null;\n\n        if (newVal) {\n          Songtypes.findById(newVal, function (data) {\n            $timeout(function () {\n              $scope.data = data;\n            });\n          });\n        }\n      });\n    }\n  };\n}); // TODO break to multiple files\n\nangular.module('a2.classy', []).factory('makeClass', function ($inheritFrom) {\n  var slice = Array.prototype.slice;\n  return function makeClass(classdef) {\n    if (!classdef.constructor) {\n      classdef.constructor = classdef.super && classdef.super.constructor ? function super_constructor() {\n        this.super.constructor.apply(this, slice.call(arguments));\n      } : function empty_constructor() {};\n    }\n\n    if (classdef.static) {\n      angular.extend(classdef.constructor, classdef.static);\n      delete classdef.static;\n    }\n\n    if (classdef.super) {\n      classdef = $inheritFrom(classdef.super, classdef);\n    }\n\n    classdef.constructor.prototype = classdef;\n    (window.qc || (window.qc = [])).push(classdef);\n    return classdef.constructor;\n  };\n}).value('$inheritFrom', function $inheritFrom(object) {\n  var fn = function () {};\n\n  fn.prototype = object;\n\n  if (arguments.length > 1) {\n    var args = Array.prototype.slice.call(arguments);\n    args[0] = new fn();\n    return angular.extend.apply(angular, args);\n  } else {\n    return new fn();\n  }\n});","angular.module(\"a2.srv.app-listings\", ['a2.srv.api']).service(\"AppListingsService\", function (a2APIService) {\n  return {\n    getFor: function (app) {\n      return a2APIService.api.get('/app-listings/' + app);\n    }\n  };\n});","angular.module('a2.service.colorscale-gradients', []).service('ColorscaleGradients', function () {\n  var g = [];\n\n  for (var i = 0; i < 256; ++i) {\n    var j = 255 - i;\n    g.push('rgb(' + j + ',' + j + ',' + j + ')');\n  }\n\n  var ColorscaleGradients = {\n    gradients: [['#4400e5', '#4000e5', '#3c00e5', '#3700e5', '#3300e5', '#2f00e5', '#2a00e5', '#2600e5', '#2200e5', '#1d00e5', '#1900e5', '#1500e5', '#1100e5', '#0c00e5', '#0800e5', '#0400e5', '#0000e5', '#0004e5', '#0008e5', '#000de5', '#0011e5', '#0015e5', '#001ae5', '#001ee5', '#0022e5', '#0027e5', '#002be5', '#002fe5', '#0034e5', '#0038e5', '#003ce5', '#0041e5', '#0045e5', '#0049e5', '#004ee5', '#0052e5', '#0056e5', '#005ae5', '#005fe5', '#0063e5', '#0067e5', '#006ce5', '#0070e5', '#0074e5', '#0079e5', '#007de5', '#0081e5', '#0086e5', '#008ae5', '#008ee5', '#0093e5', '#0097e5', '#009be5', '#00a0e5', '#00a4e5', '#00a8e5', '#00ade5', '#00b1e5', '#00b5e5', '#00bae5', '#00bee5', '#00c2e5', '#00c6e5', '#00cbe5', '#00e543', '#00e53f', '#00e53b', '#00e536', '#00e532', '#00e52e', '#00e529', '#00e525', '#00e521', '#00e51c', '#00e518', '#00e514', '#00e50f', '#00e50b', '#00e507', '#00e502', '#01e500', '#05e500', '#09e500', '#0ee500', '#12e500', '#16e500', '#1be500', '#1fe500', '#23e500', '#28e500', '#2ce500', '#30e500', '#35e500', '#39e500', '#3de500', '#42e500', '#46e500', '#4ae500', '#4fe500', '#53e500', '#57e500', '#5ce500', '#60e500', '#64e500', '#69e500', '#6de500', '#71e500', '#75e500', '#7ae500', '#7ee500', '#82e500', '#87e500', '#8be500', '#8fe500', '#94e500', '#98e500', '#9ce500', '#a1e500', '#a5e500', '#a9e500', '#aee500', '#b2e500', '#b6e500', '#bbe500', '#bfe500', '#c3e500', '#c8e500', '#cce500', '#e5e401', '#e5e303', '#e5e106', '#e5e008', '#e5df0b', '#e5de0d', '#e5dc10', '#e5db12', '#e5da15', '#e5d917', '#e5d81a', '#e5d71c', '#e5d51f', '#e5d422', '#e5d324', '#e5d227', '#e5d229', '#e5d12c', '#e5d02e', '#e5cf31', '#e5ce33', '#e5cd36', '#e5cd38', '#e5cc3b', '#e5cb3d', '#e5cb40', '#e5ca42', '#e5c945', '#e5c947', '#e5c84a', '#e5c84c', '#e5c74f', '#e5c751', '#e5c754', '#e5c656', '#e5c659', '#e5c65b', '#e5c55e', '#e5c561', '#e5c563', '#e5c566', '#e5c468', '#e5c46b', '#e5c46d', '#e5c470', '#e5c472', '#e5c475', '#e5c477', '#e5c47a', '#e5c47c', '#e5c57f', '#e5c581', '#e5c584', '#e5c586', '#e5c589', '#e5c68b', '#e5c68e', '#e5c690', '#e5c793', '#e5c795', '#e5c898', '#e5c89a', '#e5c99d', '#e5c9a0', '#916225', '#926328', '#93652a', '#95672c', '#96682f', '#986a31', '#996c33', '#9a6d36', '#9c6f38', '#9d713a', '#9f723d', '#a0743f', '#a27641', '#a37744', '#a47946', '#a67a48', '#a77c4b', '#a97e4d', '#aa7f4f', '#ab8152', '#ad8354', '#ae8456', '#b08659', '#b1885b', '#b2895d', '#b48b60', '#b58d62', '#b78e64', '#b89067', '#ba9269', '#bb936b', '#bc956e', '#be9670', '#bf9872', '#c19a75', '#c29b77', '#c39d79', '#c59f7c', '#c6a07e', '#c8a280', '#c9a483', '#caa585', '#cca787', '#cda98a', '#cfaa8c', '#d0ac8e', '#d2ad91', '#d3af93', '#d4b195', '#d6b298', '#d7b49a', '#d9b69c', '#dab79f', '#dbb9a1', '#ddbba3', '#debca6', '#e0bea8', '#e1c0aa', '#e2c1ad', '#e4c3af', '#e5c5b1', '#e7c6b4', '#e8c8b6', '#eacab9'], ['#ffffff', '#fefefe', '#fdfdfd', '#fcfcfc', '#fbfbfb', '#fafafa', '#f9f9f9', '#f8f8f8', '#f7f7f7', '#f6f6f6', '#f5f5f5', '#f4f4f4', '#f3f3f3', '#f2f2f2', '#f1f1f1', '#f0f0f0', '#efefef', '#eeeeee', '#ededed', '#ececec', '#ebebeb', '#eaeaea', '#e9e9e9', '#e8e8e8', '#e7e7e7', '#e6e6e6', '#e5e5e5', '#e4e4e4', '#e3e3e3', '#e2e2e2', '#e1e1e1', '#e0e0e0', '#dfdfdf', '#dedede', '#dddddd', '#dcdcdc', '#dbdbdb', '#dadada', '#d9d9d9', '#d8d8d8', '#d7d7d7', '#d6d6d6', '#d5d5d5', '#d4d4d4', '#d3d3d3', '#d2d2d2', '#d1d1d1', '#d0d0d0', '#cfcfcf', '#cecece', '#cdcdcd', '#cccccc', '#cbcbcb', '#cacaca', '#c9c9c9', '#c8c8c8', '#c7c7c7', '#c6c6c6', '#c5c5c5', '#c4c4c4', '#c3c3c3', '#c2c2c2', '#c1c1c1', '#c0c0c0', '#bfbfbf', '#bebebe', '#bdbdbd', '#bcbcbc', '#bbbbbb', '#bababa', '#b9b9b9', '#b8b8b8', '#b7b7b7', '#b6b6b6', '#b5b5b5', '#b4b4b4', '#b3b3b3', '#b2b2b2', '#b1b1b1', '#b0b0b0', '#afafaf', '#aeaeae', '#adadad', '#acacac', '#ababab', '#aaaaaa', '#a9a9a9', '#a8a8a8', '#a7a7a7', '#a6a6a6', '#a5a5a5', '#a4a4a4', '#a3a3a3', '#a2a2a2', '#a1a1a1', '#a0a0a0', '#9f9f9f', '#9e9e9e', '#9d9d9d', '#9c9c9c', '#9b9b9b', '#9a9a9a', '#999999', '#989898', '#979797', '#969696', '#959595', '#949494', '#939393', '#929292', '#919191', '#909090', '#8f8f8f', '#8e8e8e', '#8d8d8d', '#8c8c8c', '#8b8b8b', '#8a8a8a', '#898989', '#888888', '#878787', '#868686', '#858585', '#848484', '#838383', '#828282', '#818181', '#808080', '#7f7f7f', '#7e7e7e', '#7d7d7d', '#7c7c7c', '#7b7b7b', '#7a7a7a', '#797979', '#787878', '#777777', '#767676', '#757575', '#747474', '#737373', '#727272', '#717171', '#707070', '#6f6f6f', '#6e6e6e', '#6d6d6d', '#6c6c6c', '#6b6b6b', '#6a6a6a', '#696969', '#686868', '#676767', '#666666', '#656565', '#646464', '#636363', '#626262', '#616161', '#606060', '#5f5f5f', '#5e5e5e', '#5d5d5d', '#5c5c5c', '#5b5b5b', '#5a5a5a', '#595959', '#585858', '#575757', '#565656', '#555555', '#545454', '#535353', '#525252', '#515151', '#505050', '#4f4f4f', '#4e4e4e', '#4d4d4d', '#4c4c4c', '#4b4b4b', '#4a4a4a', '#494949', '#484848', '#474747', '#464646', '#454545', '#444444', '#434343', '#424242', '#414141', '#404040', '#3f3f3f', '#3e3e3e', '#3d3d3d', '#3c3c3c', '#3b3b3b', '#3a3a3a', '#393939', '#383838', '#373737', '#363636', '#353535', '#343434', '#333333', '#323232', '#313131', '#303030', '#2f2f2f', '#2e2e2e', '#2d2d2d', '#2c2c2c', '#2b2b2b', '#2a2a2a', '#292929', '#282828', '#272727', '#262626', '#252525', '#242424', '#232323', '#222222', '#212121', '#202020', '#1f1f1f', '#1e1e1e', '#1d1d1d', '#1c1c1c', '#1b1b1b', '#1a1a1a', '#191919', '#181818', '#171717', '#161616', '#151515', '#141414', '#131313', '#121212', '#111111', '#101010', '#0f0f0f', '#0e0e0e', '#0d0d0d', '#0c0c0c', '#0b0b0b', '#0a0a0a', '#090909', '#080808', '#070707', '#060606', '#050505', '#040404', '#030303', '#020202', '#010101', '#000000'], ['#0a0000', '#0d0000', '#0f0000', '#120000', '#150000', '#170000', '#1a0000', '#1c0000', '#1f0000', '#220000', '#240000', '#270000', '#2a0000', '#2c0000', '#2f0000', '#310000', '#340000', '#370000', '#390000', '#3c0000', '#3f0000', '#410000', '#440000', '#460000', '#490000', '#4c0000', '#4e0000', '#510000', '#540000', '#560000', '#590000', '#5b0000', '#5e0000', '#610000', '#630000', '#660000', '#690000', '#6b0000', '#6e0000', '#700000', '#730000', '#760000', '#780000', '#7b0000', '#7e0000', '#800000', '#830000', '#850000', '#880000', '#8b0000', '#8d0000', '#900000', '#930000', '#950000', '#980000', '#9a0000', '#9d0000', '#a00000', '#a20000', '#a50000', '#a80000', '#aa0000', '#ad0000', '#af0000', '#b20000', '#b50000', '#b70000', '#ba0000', '#bd0000', '#bf0000', '#c20000', '#c40000', '#c70000', '#ca0000', '#cc0000', '#cf0000', '#d20000', '#d40000', '#d70000', '#d90000', '#dc0000', '#df0000', '#e10000', '#e40000', '#e70000', '#e90000', '#ec0000', '#ee0000', '#f10000', '#f40000', '#f60000', '#f90000', '#fc0000', '#fe0000', '#ff0200', '#ff0500', '#ff0700', '#ff0a00', '#ff0c00', '#ff0f00', '#ff1200', '#ff1400', '#ff1700', '#ff1a00', '#ff1c00', '#ff1f00', '#ff2100', '#ff2400', '#ff2700', '#ff2900', '#ff2c00', '#ff2f00', '#ff3100', '#ff3400', '#ff3600', '#ff3900', '#ff3c00', '#ff3e00', '#ff4100', '#ff4400', '#ff4600', '#ff4900', '#ff4b00', '#ff4e00', '#ff5100', '#ff5300', '#ff5600', '#ff5900', '#ff5b00', '#ff5e00', '#ff6000', '#ff6300', '#ff6600', '#ff6800', '#ff6b00', '#ff6e00', '#ff7000', '#ff7300', '#ff7500', '#ff7800', '#ff7b00', '#ff7d00', '#ff8000', '#ff8300', '#ff8500', '#ff8800', '#ff8a00', '#ff8d00', '#ff9000', '#ff9200', '#ff9500', '#ff9700', '#ff9a00', '#ff9d00', '#ff9f00', '#ffa200', '#ffa500', '#ffa700', '#ffaa00', '#ffac00', '#ffaf00', '#ffb200', '#ffb400', '#ffb700', '#ffba00', '#ffbc00', '#ffbf00', '#ffc100', '#ffc400', '#ffc700', '#ffc900', '#ffcc00', '#ffcf00', '#ffd100', '#ffd400', '#ffd600', '#ffd900', '#ffdc00', '#ffde00', '#ffe100', '#ffe400', '#ffe600', '#ffe900', '#ffeb00', '#ffee00', '#fff100', '#fff300', '#fff600', '#fff900', '#fffb00', '#fffe00', '#ffff02', '#ffff06', '#ffff0a', '#ffff0e', '#ffff12', '#ffff16', '#ffff1a', '#ffff1e', '#ffff22', '#ffff26', '#ffff2a', '#ffff2e', '#ffff32', '#ffff36', '#ffff3a', '#ffff3e', '#ffff41', '#ffff45', '#ffff49', '#ffff4d', '#ffff51', '#ffff55', '#ffff59', '#ffff5d', '#ffff61', '#ffff65', '#ffff69', '#ffff6d', '#ffff71', '#ffff75', '#ffff79', '#ffff7d', '#ffff80', '#ffff84', '#ffff88', '#ffff8c', '#ffff90', '#ffff94', '#ffff98', '#ffff9c', '#ffffa0', '#ffffa4', '#ffffa8', '#ffffac', '#ffffb0', '#ffffb4', '#ffffb8', '#ffffbc', '#ffffbf', '#ffffc3', '#ffffc7', '#ffffcb', '#ffffcf', '#ffffd3', '#ffffd7', '#ffffdb', '#ffffdf', '#ffffe3', '#ffffe7', '#ffffeb', '#ffffef', '#fffff3', '#fffff7', '#fffffb', '#ffffff'], ['#000000', '#120102', '#240204', '#360306', '#490408', '#5b050a', '#6d060c', '#7f070e', '#920810', '#a40912', '#b60a14', '#c90b16', '#db0c18', '#ed0d1a', '#fe0e1c', '#f90f1e', '#f41020', '#ef1122', '#ea1224', '#e51326', '#e01428', '#db152a', '#d6162c', '#d1172e', '#cc1830', '#c71932', '#c21a34', '#bd1b36', '#b81c38', '#b41d3a', '#af1e3c', '#aa1f3e', '#a52040', '#a02041', '#9b2244', '#962346', '#912448', '#8c2449', '#87264c', '#82274e', '#7d2850', '#782851', '#732a54', '#6e2b56', '#692c58', '#642c59', '#5f2e5c', '#5a2f5e', '#553060', '#503061', '#4b3264', '#463366', '#413468', '#3c3469', '#37366c', '#32376e', '#2d3870', '#283871', '#233a74', '#1e3b76', '#193c78', '#143c79', '#0f3e7c', '#0a3f7e', '#404080', '#414182', '#414183', '#434386', '#444488', '#45458a', '#46468c', '#47478e', '#484890', '#494992', '#494993', '#4b4b96', '#4c4c98', '#4d4d9a', '#4e4e9c', '#4f4f9e', '#5050a0', '#5151a2', '#5151a3', '#5353a6', '#5454a8', '#5555aa', '#5656ac', '#5757ae', '#5858b0', '#5959b2', '#5959b3', '#5b5bb6', '#5c5cb8', '#5d5dba', '#5e5ebc', '#5f5fbe', '#6060c0', '#6161c2', '#6161c3', '#6363c6', '#6464c8', '#6565ca', '#6666cc', '#6767ce', '#6868d0', '#6969d2', '#6969d3', '#6b6bd6', '#6c6cd8', '#6d6dda', '#6e6edc', '#6f6fde', '#7070e0', '#7171e2', '#7171e3', '#7373e6', '#7474e8', '#7575ea', '#7676ec', '#7777ee', '#7878f0', '#7979f2', '#7979f3', '#7b7bf6', '#7c7cf8', '#7d7dfa', '#7e7efc', '#7f7ffe', '#8080fc', '#8181f8', '#8282f4', '#8383f0', '#8383eb', '#8485e7', '#8686e3', '#8787df', '#8888da', '#8989d6', '#8a8ad2', '#8b8bce', '#8c8cc9', '#8d8dc5', '#8e8ec1', '#8f8fbd', '#9090b8', '#9191b4', '#9292b0', '#9393ac', '#9393a7', '#9595a3', '#96969f', '#97979a', '#989896', '#999992', '#9a9a8e', '#9b9b89', '#9c9c85', '#9d9d81', '#9e9e7d', '#9f9f78', '#a0a074', '#a1a170', '#a2a26c', '#a3a367', '#a3a363', '#a5a55f', '#a6a65b', '#a7a756', '#a8a852', '#a9a94e', '#aaaa4a', '#abab45', '#acac41', '#adad3d', '#aeae39', '#afaf34', '#b0b030', '#b1b12c', '#b2b228', '#b3b323', '#b3b31f', '#b5b51b', '#b6b617', '#b7b712', '#b8b80e', '#b9b90a', '#baba06', '#bbbb01', '#bcbc02', '#bdbd05', '#bebe09', '#bfbf0d', '#c0c011', '#c1c115', '#c2c218', '#c3c31c', '#c3c320', '#c4c524', '#c5c627', '#c7c72b', '#c8c82f', '#c9c933', '#caca37', '#cbcb3a', '#cbcc3e', '#cdcd42', '#cece46', '#cfcf49', '#d0d04d', '#d1d151', '#d2d255', '#d3d358', '#d3d35c', '#d5d560', '#d6d664', '#d7d768', '#d8d86b', '#d9d96f', '#dada73', '#dbdb77', '#dcdc7a', '#dddd7e', '#dede82', '#dfdf86', '#e0e08a', '#e1e18d', '#e2e291', '#e3e395', '#e3e399', '#e5e59c', '#e6e6a0', '#e7e7a4', '#e8e8a8', '#e9e9ab', '#eaeaaf', '#ebebb3', '#ececb7', '#ededbb', '#eeeebe', '#efefc2', '#f0f0c6', '#f1f1ca', '#f2f2cd', '#f3f3d1', '#f3f3d5', '#f4f5d9', '#f5f6dd', '#f7f7e0', '#f8f8e4', '#f9f9e8', '#fafaec', '#fbfbef', '#fbfcf3', '#fdfdf7', '#fefefb', '#ffffff'], ['#000080', '#000776', '#000e6d', '#001563', '#001d5a', '#002450', '#002b47', '#00333e', '#003a34', '#00412b', '#004821', '#005018', '#00570f', '#005e05', '#005816', '#005126', '#004a37', '#004348', '#003d58', '#003669', '#002f79', '#00288a', '#00219b', '#001bab', '#0014bc', '#000dcd', '#0006dd', '#0000ee', '#000eff', '#001cff', '#002aff', '#0038ff', '#0046ff', '#0054ff', '#0062ff', '#0070ff', '#007fff', '#008dff', '#009bff', '#00a9ff', '#00b7ff', '#00c0ff', '#00c5ff', '#00caff', '#00ceff', '#00d2ff', '#00d7ff', '#00dbff', '#00e0ff', '#00e4ff', '#00e8ff', '#00edff', '#00f1fe', '#00f6f8', '#00faf1', '#00feeb', '#00fee4', '#00fede', '#00fdd7', '#00fdd1', '#00fcca', '#00fcc3', '#00fbbd', '#00fbb6', '#00fab0', '#00faa9', '#00faa3', '#00fa9c', '#00fa92', '#00fa87', '#00fa7d', '#00fa72', '#00fb68', '#00fb5d', '#00fc53', '#00fc49', '#00fc3e', '#00fd34', '#00fd29', '#00fe1f', '#06fe14', '#0cfe0a', '#13fb00', '#19f700', '#1ff300', '#26ef00', '#2cec00', '#32e800', '#39e400', '#3fe000', '#46dd00', '#4cd900', '#52d500', '#59d100', '#5fce00', '#65d100', '#67d400', '#69d700', '#6bdb00', '#6dde00', '#6fe100', '#71e400', '#73e800', '#75eb00', '#77ee00', '#79f100', '#7bf500', '#7df803', '#7ffb07', '#84fe0b', '#88ff0f', '#8dff13', '#91ff17', '#96ff1b', '#9aff1f', '#9fff23', '#a4ff27', '#a8ff2b', '#adff2f', '#b1ff33', '#b6ff37', '#baff3b', '#bfff37', '#c3ff33', '#c8ff2f', '#ccff2b', '#d1ff27', '#d6ff23', '#daff1f', '#dfff1b', '#e3ff17', '#e8ff13', '#ecff0f', '#f1ff0b', '#f5fc07', '#fafa03', '#fff700', '#fff500', '#fff200', '#fff000', '#ffed00', '#ffeb00', '#ffe800', '#ffe600', '#ffe300', '#ffe100', '#ffde00', '#ffdc00', '#ffda00', '#ffd701', '#ffd502', '#ffd203', '#ffd004', '#ffcd05', '#ffcb06', '#ffc807', '#ffc608', '#ffc309', '#ffc10a', '#ffbe0b', '#ffbc0c', '#ffb90d', '#ffb10d', '#ffa90c', '#ffa10b', '#ff990a', '#ff9109', '#ff8808', '#ff8007', '#ff7806', '#ff7005', '#ff6804', '#ff5f03', '#ff5702', '#ff4f01', '#ff4700', '#ff4200', '#ff3d00', '#ff3900', '#ff3400', '#ff2f00', '#ff2a00', '#ff2600', '#ff2100', '#ff1c00', '#ff1700', '#ff1300', '#ff0e00', '#ff0900', '#ff0411', '#ff0023', '#ff0035', '#ff0046', '#ff0058', '#ff006a', '#ff007b', '#ff008d', '#ff009f', '#ff00b1', '#ff00c2', '#ff00d4', '#ff00e6', '#ff00f8', '#f803fb', '#f106ff', '#ea0aff', '#e30dff', '#dc11ff', '#d514ff', '#ce18ff', '#c71bff', '#c11eff', '#ba22ff', '#b325ff', '#ac29ff', '#a52cfe', '#9e32fd', '#a438fc', '#aa3efb', '#b044fa', '#b64af8', '#bc50f7', '#c256f6', '#c75cf5', '#cd61f4', '#d367f2', '#d96df1', '#df73f0', '#e579ef', '#eb7fee', '#ec84ee', '#ec88ef', '#ed8df0', '#ee92f0', '#ef96f1', '#ef9bf1', '#f09ff2', '#f1a4f3', '#f1a9f3', '#f2adf4', '#f3b2f4', '#f4b7f5', '#f4bbf6', '#f5c0f6', '#f6c5f7', '#f6c9f7', '#f7cef8', '#f8d2f9', '#f9d7f9', '#f9dcfa', '#fae0fa', '#fbe5fb', '#fbeafc', '#fceefc', '#fdf3fd', '#fef7fe'] // ['#ffffff', '#fefefe', '#fdfdfd', '#fcfcfc', '#fbfbfb', '#fafafa', '#f9f9f9', '#f8f8f8', '#f7f7f7', '#f6f6f6', '#f5f5f5', '#f4f4f4', '#f3f3f3', '#f2f2f2', '#f1f1f1', '#f0f0f0', '#efefef', '#eeeeee', '#ededed', '#ececec', '#ebebeb', '#eaeaea', '#e9e9e9', '#e8e8e8', '#e7e7e7', '#e6e6e6', '#e5e5e5', '#e4e4e4', '#e3e3e3', '#e2e2e2', '#e1e1e1', '#e0e0e0', '#dfdfdf', '#dedede', '#dddddd', '#dcdcdc', '#dbdbdb', '#dadada', '#d9d9d9', '#d8d8d8', '#d7d7d7', '#d6d6d6', '#d5d5d5', '#d3d3d3', '#d3d3d3', '#d2d2d2', '#d1d1d1', '#d0d0d0', '#cfcfcf', '#cecece', '#cdcdcd', '#cccccc', '#cbcbcb', '#cacaca', '#c9c9c9', '#c8c8c8', '#c7c7c7', '#c6c6c6', '#c5c5c5', '#c3c3c3', '#c3c3c3', '#c2c2c2', '#c1c1c1', '#c0c0c0', '#bfbfbf', '#bebebe', '#bdbdbd', '#bcbcbc', '#bbbbbb', '#bababa', '#b9b9b9', '#b8b8b8', '#b7b7b7', '#b6b6b6', '#b5b5b5', '#b3b3b3', '#b3b3b3', '#b2b2b2', '#b1b1b1', '#b0b0b0', '#afafaf', '#aeaeae', '#adadad', '#acacac', '#ababab', '#aaaaaa', '#a9a9a9', '#a8a8a8', '#a7a7a7', '#a6a6a6', '#a5a5a5', '#a3a3a3', '#a3a3a3', '#a2a2a2', '#a1a1a1', '#a0a0a0', '#9f9f9f', '#9e9e9e', '#9d9d9d', '#9c9c9c', '#9b9b9b', '#9a9a9a', '#999999', '#989898', '#979797', '#969696', '#959595', '#939393', '#939393', '#929292', '#919191', '#909090', '#8f8f8f', '#8e8e8e', '#8d8d8d', '#8c8c8c', '#8b8b8b', '#8a8a8a', '#898989', '#888888', '#878787', '#868686', '#858585', '#838383', '#838383', '#828282', '#818181', '#808080', '#7f7f7f', '#7e7e7e', '#7d7d7d', '#7c7c7c', '#7b7b7b', '#797979', '#797979', '#787878', '#777777', '#767676', '#757575', '#747474', '#727272', '#717171', '#717171', '#707070', '#6f6f6f', '#6e6e6e', '#6d6d6d', '#6c6c6c', '#6b6b6b', '#696969', '#696969', '#686868', '#676767', '#666666', '#656565', '#646464', '#626262', '#616161', '#616161', '#606060', '#5f5f5f', '#5e5e5e', '#5d5d5d', '#5c5c5c', '#5b5b5b', '#595959', '#595959', '#585858', '#575757', '#565656', '#555555', '#545454', '#525252', '#515151', '#515151', '#505050', '#4f4f4f', '#4e4e4e', '#4d4d4d', '#4c4c4c', '#4b4b4b', '#494949', '#494949', '#484848', '#474747', '#464646', '#454545', '#444444', '#424242', '#414141', '#414141', '#404040', '#3f3f3f', '#3e3e3e', '#3d3d3d', '#3c3c3c', '#3b3b3b', '#393939', '#383838', '#383838', '#373737', '#363636', '#353535', '#343434', '#323232', '#313131', '#303030', '#303030', '#2f2f2f', '#2e2e2e', '#2d2d2d', '#2c2c2c', '#2b2b2b', '#292929', '#282828', '#282828', '#272727', '#262626', '#252525', '#242424', '#222222', '#212121', '#202020', '#202020', '#1f1f1f', '#1e1e1e', '#1d1d1d', '#1c1c1c', '#1b1b1b', '#191919', '#181818', '#181818', '#171717', '#161616', '#151515', '#141414', '#121212', '#111111', '#101010', '#101010', '#0f0f0f', '#0e0e0e', '#0d0d0d', '#0c0c0c', '#0b0b0b', '#090909', '#080808', '#080808', '#070707', '#060606', '#050505', '#040404', '#020202', '#010101', '#000000', '#000000'],\n    // ['#000000', '#010000', '#030000', '#040000', '#060000', '#070000', '#090000', '#0a0000', '#0c0000', '#0d0000', '#0f0000', '#100000', '#120000', '#130000', '#150000', '#160000', '#180000', '#190000', '#1b0000', '#1c0000', '#1e0000', '#1f0000', '#200000', '#220000', '#240000', '#250000', '#270000', '#280000', '#2a0000', '#2b0000', '#2c0000', '#2e0000', '#300000', '#310000', '#330000', '#340000', '#360000', '#370000', '#380000', '#3a0000', '#3c0000', '#3d0000', '#3f0000', '#400000', '#410000', '#430000', '#450000', '#460000', '#480000', '#490000', '#4b0000', '#4c0000', '#4e0000', '#4f0000', '#510000', '#520000', '#540000', '#550000', '#570000', '#580000', '#590000', '#5b0000', '#5d0000', '#5e0000', '#600000', '#610000', '#620000', '#640000', '#660000', '#670000', '#690000', '#6a0000', '#6c0000', '#6d0000', '#6e0000', '#700000', '#710000', '#730000', '#750000', '#760000', '#780000', '#790000', '#7a0000', '#7c0000', '#7e0000', '#7f0000', '#810000', '#820000', '#830000', '#850000', '#860000', '#880000', '#8a0000', '#8b0000', '#8d0000', '#8e0000', '#900000', '#910000', '#930000', '#940000', '#960000', '#970000', '#990000', '#9a0000', '#9c0000', '#9d0000', '#9f0000', '#a00000', '#a20000', '#a30000', '#a50000', '#a60000', '#a80000', '#a90000', '#ab0000', '#ac0000', '#ae0000', '#af0000', '#b10000', '#b20000', '#b30000', '#b50000', '#b60000', '#b80000', '#ba0000', '#bb0000', '#bd0000', '#be0000', '#c00000', '#c10200', '#c30400', '#c40600', '#c50800', '#c70b00', '#c90d00', '#ca0f00', '#cc1000', '#cd1200', '#cf1400', '#d01600', '#d21900', '#d31b00', '#d51d00', '#d61f00', '#d82000', '#d92200', '#db2400', '#dc2600', '#dd2800', '#df2b00', '#e12d00', '#e22f00', '#e33000', '#e53200', '#e63400', '#e83600', '#ea3900', '#eb3b00', '#ed3d00', '#ee3f00', '#f04100', '#f14200', '#f34400', '#f44600', '#f54800', '#f74b00', '#f94d00', '#fa4f00', '#fc5100', '#fd5200', '#ff5400', '#ff5600', '#ff5900', '#ff5b00', '#ff5d00', '#ff5f00', '#ff6100', '#ff6200', '#ff6400', '#ff6600', '#ff6800', '#ff6b00', '#ff6d00', '#ff6f00', '#ff7100', '#ff7200', '#ff7400', '#ff7600', '#ff7900', '#ff7b00', '#ff7d00', '#ff7f00', '#ff8102', '#ff8306', '#ff840a', '#ff860e', '#ff8812', '#ff8b17', '#ff8d1b', '#ff8f1f', '#ff9122', '#ff9326', '#ff942a', '#ff962e', '#ff9933', '#ff9b37', '#ff9d3b', '#ff9f3f', '#ffa142', '#ffa346', '#ffa44a', '#ffa64e', '#ffa852', '#ffab57', '#ffad5b', '#ffaf5f', '#ffb162', '#ffb366', '#ffb46a', '#ffb66e', '#ffb973', '#ffbb77', '#ffbd7b', '#ffbf7f', '#ffc183', '#ffc386', '#ffc48a', '#ffc68e', '#ffc892', '#ffcb97', '#ffcd9b', '#ffcf9f', '#ffd1a3', '#ffd3a6', '#ffd4aa', '#ffd6ae', '#ffd9b3', '#ffdbb7', '#ffddbb', '#ffdfbf', '#ffe1c3', '#ffe3c6', '#ffe4ca', '#ffe6ce', '#ffe8d2', '#ffebd7', '#ffeddb', '#ffefdf', '#fff1e3', '#fff3e6', '#fff4ea', '#fff6ee', '#fff9f3', '#fffbf7', '#fffdfb', '#ffffff'],\n    // ['#00007f', '#000084', '#000088', '#00008d', '#000091', '#000096', '#00009a', '#00009f', '#0000a3', '#0000a8', '#0000ac', '#0000b1', '#0000b6', '#0000ba', '#0000bf', '#0000c3', '#0000c8', '#0000cc', '#0000d1', '#0000d5', '#0000da', '#0000de', '#0000e3', '#0000e8', '#0000ec', '#0000f1', '#0000f5', '#0000fa', '#0000fe', '#0000ff', '#0000ff', '#0000ff', '#0000ff', '#0004ff', '#0008ff', '#000cff', '#0010ff', '#0014ff', '#0018ff', '#001cff', '#0020ff', '#0024ff', '#0028ff', '#002cff', '#0030ff', '#0034ff', '#0038ff', '#003cff', '#0040ff', '#0044ff', '#0048ff', '#004cff', '#0050ff', '#0054ff', '#0058ff', '#005cff', '#0060ff', '#0064ff', '#0068ff', '#006cff', '#0070ff', '#0074ff', '#0078ff', '#007cff', '#0080ff', '#0084ff', '#0088ff', '#008cff', '#0090ff', '#0094ff', '#0098ff', '#009cff', '#00a0ff', '#00a4ff', '#00a8ff', '#00acff', '#00b0ff', '#00b4ff', '#00b8ff', '#00bcff', '#00c0ff', '#00c4ff', '#00c8ff', '#00ccff', '#00d0ff', '#00d4ff', '#00d8ff', '#00dcfe', '#00e0fa', '#00e4f7', '#02e8f4', '#05ecf1', '#08f0ed', '#0cf4ea', '#0ff8e7', '#12fce4', '#15ffe1', '#18ffdd', '#1cffda', '#1fffd7', '#22ffd4', '#25ffd0', '#29ffcd', '#2cffca', '#2fffc7', '#32ffc3', '#36ffc0', '#39ffbd', '#3cffba', '#3fffb7', '#42ffb3', '#46ffb0', '#49ffad', '#4cffaa', '#4fffa6', '#53ffa3', '#56ffa0', '#59ff9d', '#5cff9a', '#5fff96', '#63ff93', '#66ff90', '#69ff8d', '#6cff89', '#70ff86', '#73ff83', '#76ff80', '#79ff7d', '#7cff79', '#80ff76', '#83ff73', '#86ff70', '#89ff6c', '#8dff69', '#90ff66', '#93ff63', '#96ff5f', '#9aff5c', '#9dff59', '#a0ff56', '#a3ff53', '#a6ff4f', '#aaff4c', '#adff49', '#b0ff46', '#b3ff42', '#b7ff3f', '#baff3c', '#bdff39', '#c0ff36', '#c3ff32', '#c7ff2f', '#caff2c', '#cdff29', '#d0ff25', '#d4ff22', '#d7ff1f', '#daff1c', '#ddff18', '#e0ff15', '#e4ff12', '#e7ff0f', '#eaff0c', '#edff08', '#f1fc05', '#f4f802', '#f7f400', '#faf000', '#feed00', '#ffe900', '#ffe500', '#ffe200', '#ffde00', '#ffda00', '#ffd700', '#ffd300', '#ffcf00', '#ffcb00', '#ffc800', '#ffc400', '#ffc000', '#ffbd00', '#ffb900', '#ffb500', '#ffb100', '#ffae00', '#ffaa00', '#ffa600', '#ffa300', '#ff9f00', '#ff9b00', '#ff9800', '#ff9400', '#ff9000', '#ff8c00', '#ff8900', '#ff8500', '#ff8100', '#ff7e00', '#ff7a00', '#ff7600', '#ff7300', '#ff6f00', '#ff6b00', '#ff6700', '#ff6400', '#ff6000', '#ff5c00', '#ff5900', '#ff5500', '#ff5100', '#ff4d00', '#ff4a00', '#ff4600', '#ff4200', '#ff3f00', '#ff3b00', '#ff3700', '#ff3400', '#ff3000', '#ff2c00', '#ff2800', '#ff2500', '#ff2100', '#ff1d00', '#ff1a00', '#ff1600', '#fe1200', '#fa0f00', '#f50b00', '#f10700', '#ec0300', '#e80000', '#e30000', '#de0000', '#da0000', '#d50000', '#d10000', '#cc0000', '#c80000', '#c30000', '#bf0000', '#ba0000', '#b60000', '#b10000', '#ac0000', '#a80000', '#a30000', '#9f0000', '#9a0000', '#960000', '#910000', '#8d0000', '#880000', '#840000', '#7f0000'],\n    // ['#000000', '#00002b', '#010038', '#010043', '#02004e', '#030058', '#030063', '#04006e', '#050273', '#050474', '#060674', '#070974', '#070b74', '#080d74', '#091075', '#091275', '#0a1475', '#0b1675', '#0b1975', '#0c1b75', '#0d1d76', '#0d2076', '#0e2276', '#0f2476', '#0f2776', '#102977', '#112b77', '#112d77', '#123077', '#133277', '#133477', '#143678', '#153878', '#153a78', '#163c78', '#173e78', '#174079', '#184279', '#194579', '#194779', '#1a4979', '#1b4b79', '#1b4d7a', '#1c4f7a', '#1d517a', '#1d537a', '#1e547a', '#1f567b', '#1f587b', '#205a7b', '#215c7b', '#215e7b', '#22607b', '#23617c', '#23637c', '#24657c', '#25667c', '#25687c', '#26697d', '#276b7d', '#276d7d', '#286e7d', '#29707d', '#29717d', '#2a737e', '#2b747e', '#2b767e', '#2c787e', '#2d797e', '#2d7b7f', '#2e7c7f', '#2f7e7f', '#2f7f7f', '#30807e', '#30817d', '#31817b', '#31827a', '#328279', '#328378', '#338477', '#338475', '#348574', '#348573', '#358672', '#358670', '#36876f', '#36886e', '#37886d', '#37896c', '#38896a', '#388a69', '#388a68', '#398b67', '#398c65', '#3a8c64', '#3a8d63', '#3b8d62', '#3b8e61', '#3c8e5f', '#3c8f5e', '#3d905d', '#3d905c', '#3e915a', '#3e9159', '#3f9258', '#3f9357', '#409355', '#409454', '#409453', '#419552', '#419551', '#42964f', '#42974e', '#43974d', '#43984c', '#44984a', '#449949', '#459948', '#479a47', '#499b46', '#4b9b46', '#4e9c47', '#509c47', '#529d48', '#549d48', '#579e49', '#599f4a', '#5b9f4a', '#5da04b', '#5fa04b', '#62a14c', '#64a14d', '#66a24d', '#68a34e', '#6ba34e', '#6da34f', '#6fa44f', '#71a450', '#73a551', '#76a551', '#78a652', '#79a652', '#7ba752', '#7da752', '#7ea753', '#80a853', '#82a853', '#83a954', '#85a954', '#87aa54', '#88aa55', '#8aab55', '#8cab55', '#8dab56', '#8fac56', '#91ac56', '#92ad57', '#94ad57', '#96ae57', '#97ae58', '#99ae58', '#9aaf58', '#9caf58', '#9eb059', '#9fb059', '#a1b159', '#a3b15a', '#a4b25a', '#a6b25a', '#a8b25b', '#a9b35b', '#abb35b', '#adb45c', '#aeb45c', '#b0b55c', '#b2b55d', '#b3b55d', '#b5b65d', '#b6b65e', '#b7b55e', '#b7b55e', '#b8b45f', '#b8b35f', '#b9b25f', '#b9b15f', '#b9b060', '#baaf60', '#baaf60', '#bbae61', '#bbad61', '#bcac61', '#bcab62', '#bcaa62', '#bda962', '#bda963', '#bea863', '#bea763', '#bea664', '#bfa564', '#bfa464', '#c0a365', '#c0a367', '#c1a369', '#c2a36c', '#c3a46e', '#c5a471', '#c6a573', '#c7a676', '#c8a678', '#c9a77b', '#caa87d', '#cba97f', '#ccaa82', '#ceab84', '#cfac87', '#d0ad89', '#d1ad8c', '#d2ae8e', '#d3af91', '#d4b093', '#d5b196', '#d6b298', '#d8b39a', '#d9b59d', '#dab69f', '#dbb7a2', '#dcb9a4', '#ddbaa7', '#debca9', '#dfbdac', '#e1bfaf', '#e2c1b2', '#e3c3b5', '#e4c5b8', '#e5c7bb', '#e6c9be', '#e7cbc1', '#e8cdc4', '#e9cfc7', '#ebd1ca', '#ecd3cd', '#edd5d0', '#eed7d3', '#efd9d6', '#f0dcd9', '#f1dedc', '#f2e0df', '#f4e3e2', '#f5e6e5', '#f6e9e8', '#f7eceb', '#f8efee', '#f9f2f1', '#faf5f4', '#fbf8f7', '#fdfafa'],\n    // ['#000000', '#010101', '#020202', '#030303', '#040404', '#050505', '#060606', '#070707', '#080808', '#090909', '#0a0a0a', '#0b0b0b', '#0c0c0c', '#0d0d0d', '#0e0e0e', '#0f0f0f', '#101010', '#111111', '#121212', '#131313', '#141414', '#151515', '#161616', '#171717', '#181818', '#191919', '#1a1a1a', '#1b1b1b', '#1c1c1c', '#1d1d1d', '#1e1e1e', '#1f1f1f', '#202020', '#202020', '#222222', '#232323', '#242424', '#242424', '#262626', '#272727', '#282828', '#282828', '#2a2a2a', '#2b2b2b', '#2c2c2c', '#2c2c2c', '#2e2e2e', '#2f2f2f', '#303030', '#303030', '#323232', '#333333', '#343434', '#343434', '#363636', '#373737', '#383838', '#383838', '#3a3a3a', '#3b3b3b', '#3c3c3c', '#3c3c3c', '#3e3e3e', '#3f3f3f', '#404040', '#414141', '#414141', '#434343', '#444444', '#454545', '#464646', '#474747', '#484848', '#494949', '#494949', '#4b4b4b', '#4c4c4c', '#4d4d4d', '#4e4e4e', '#4f4f4f', '#505050', '#515151', '#515151', '#535353', '#545454', '#555555', '#565656', '#575757', '#585858', '#595959', '#595959', '#5b5b5b', '#5c5c5c', '#5d5d5d', '#5e5e5e', '#5f5f5f', '#606060', '#616161', '#616161', '#636363', '#646464', '#656565', '#666666', '#676767', '#686868', '#696969', '#696969', '#6b6b6b', '#6c6c6c', '#6d6d6d', '#6e6e6e', '#6f6f6f', '#707070', '#717171', '#717171', '#737373', '#747474', '#757575', '#767676', '#777777', '#787878', '#797979', '#797979', '#7b7b7b', '#7c7c7c', '#7d7d7d', '#7e7e7e', '#7f7f7f', '#808080', '#818181', '#828282', '#838383', '#838383', '#858585', '#868686', '#878787', '#888888', '#898989', '#8a8a8a', '#8b8b8b', '#8c8c8c', '#8d8d8d', '#8e8e8e', '#8f8f8f', '#909090', '#919191', '#929292', '#939393', '#939393', '#959595', '#969696', '#979797', '#989898', '#999999', '#9a9a9a', '#9b9b9b', '#9c9c9c', '#9d9d9d', '#9e9e9e', '#9f9f9f', '#a0a0a0', '#a1a1a1', '#a2a2a2', '#a3a3a3', '#a3a3a3', '#a5a5a5', '#a6a6a6', '#a7a7a7', '#a8a8a8', '#a9a9a9', '#aaaaaa', '#ababab', '#acacac', '#adadad', '#aeaeae', '#afafaf', '#b0b0b0', '#b1b1b1', '#b2b2b2', '#b3b3b3', '#b3b3b3', '#b5b5b5', '#b6b6b6', '#b7b7b7', '#b8b8b8', '#b9b9b9', '#bababa', '#bbbbbb', '#bcbcbc', '#bdbdbd', '#bebebe', '#bfbfbf', '#c0c0c0', '#c1c1c1', '#c2c2c2', '#c3c3c3', '#c3c3c3', '#c5c5c5', '#c6c6c6', '#c7c7c7', '#c8c8c8', '#c9c9c9', '#cacaca', '#cbcbcb', '#cccccc', '#cdcdcd', '#cecece', '#cfcfcf', '#d0d0d0', '#d1d1d1', '#d2d2d2', '#d3d3d3', '#d3d3d3', '#d5d5d5', '#d6d6d6', '#d7d7d7', '#d8d8d8', '#d9d9d9', '#dadada', '#dbdbdb', '#dcdcdc', '#dddddd', '#dedede', '#dfdfdf', '#e0e0e0', '#e1e1e1', '#e2e2e2', '#e3e3e3', '#e3e3e3', '#e5e5e5', '#e6e6e6', '#e7e7e7', '#e8e8e8', '#e9e9e9', '#eaeaea', '#ebebeb', '#ececec', '#ededed', '#eeeeee', '#efefef', '#f0f0f0', '#f1f1f1', '#f2f2f2', '#f3f3f3', '#f3f3f3', '#f5f5f5', '#f6f6f6', '#f7f7f7', '#f8f8f8', '#f9f9f9', '#fafafa', '#fbfbfb', '#fcfcfc', '#fdfdfd', '#fefefe', '#ffffff']\n    ],\n    normalize: function (idx) {\n      var grad = ColorscaleGradients.gradients[idx];\n      var len = grad.length - 1;\n      return grad.map(function (_, i) {\n        return [i / len, _];\n      });\n    }\n  };\n  return ColorscaleGradients;\n});","angular.module('countries-list', []).service('countries', function ($http) {\n  var countries;\n  return {\n    get: function (callback) {\n      if (countries) return callback(countries);\n      $http.get('/legacy-api/orders/countries').success(function (data) {\n        countries = data;\n        callback(countries);\n      });\n    }\n  };\n});","angular.module('humane', []).factory('notify', function ($window) {\n  var humane = $window.humane;\n  humane.timeout = 6000;\n  humane.baseCls = \"humane-original\";\n  humane.error = humane.spawn({\n    addnCls: humane.baseCls + '-error'\n  });\n  humane.info = humane.spawn({\n    addnCls: humane.baseCls + '-info'\n  });\n  humane.success = humane.spawn({\n    addnCls: humane.baseCls + '-success'\n  });\n\n  humane.serverError = function () {\n    humane.error(\"Error communicating with server\");\n  };\n\n  return humane;\n});","angular.module('a2.service.plotly-plot-maker', []).service('plotlyPlotMaker', function () {\n  var plotlyPlotMaker = {\n    range: function range(start, count, step) {\n      var _ = [];\n\n      for (var i = 0, x = start; i < count; ++i, x += step) {\n        _.push(x);\n      }\n\n      return _;\n    },\n    mergeData: function mergeData(data, defaults) {\n      return (data || []).map(function (datum) {\n        return angular.merge(angular.copy(defaults[datum.type] || {}), datum);\n      });\n    },\n    mergeLayout: function mergeLayout(layout, defaults) {\n      return angular.merge(angular.copy(defaults.layout), layout);\n    },\n    makeHeatmapPlot: function (x, y, z, data, title) {\n      var plot = {\n        data: {\n          type: 'heatmap',\n          hoverinfo: 'x+y+z',\n          colorbar: {\n            title: z.title\n          } // connectgaps:true,\n\n        },\n        layout: {\n          title: title,\n          xaxis: {\n            boundsmode: 'auto',\n            title: x.title,\n            ticksuffix: x.units || ''\n          },\n          yaxis: {\n            boundsmode: 'auto',\n            title: y.title,\n            ticksuffix: y.units || ''\n          }\n        }\n      };\n\n      if (data.rows) {\n        plot.data.x = data.rows.map(function (_) {\n          return data.x.min + data.x.step * _.x;\n        });\n        plot.data.y = data.rows.map(function (_) {\n          return data.y.min + data.y.step * _.y;\n        });\n        plot.data.z = data.rows.map(function (_) {\n          return _.z;\n        });\n      } else if (data.matrix) {\n        plot.data.x = plotlyPlotMaker.range(data.x.min, data.x.bins, data.x.step);\n        plot.data.y = plotlyPlotMaker.range(data.y.min, data.y.bins, data.y.step);\n        plot.data.z = data.matrix;\n      }\n\n      return plot;\n    },\n    makeBarPlot: function (x, y, data, title) {\n      var plot = {\n        data: {\n          orientation: 'v',\n          type: 'bar'\n        },\n        layout: {\n          title: title,\n          xaxis: {\n            boundsmode: 'auto',\n            title: x.title,\n            ticksuffix: x.units || ''\n          },\n          yaxis: {\n            boundsmode: 'auto',\n            title: y.title\n          }\n        }\n      };\n\n      if (data.rows) {\n        plot.data.x = data.rows.map(function (_) {\n          return data.x.min + data.x.step * _.x;\n        });\n        plot.data.y = data.rows.map(function (_) {\n          return _.z;\n        });\n      } else if (data.matrix) {\n        plot.data.x = plotlyPlotMaker.range(data.x.min, data.x.bins, data.x.step);\n        plot.data.y = data.matrix[0];\n      }\n\n      return plot;\n    }\n  };\n  return plotlyPlotMaker;\n});","angular.module('a2-plot-specs', ['a2.utils-browser-metrics']).factory('PlotSpecs', function (a2BrowserMetrics) {\n  return {\n    gutter: a2BrowserMetrics.scrollSize.height,\n    axis_sizew: 60,\n    axis_sizeh: 60,\n    legend_axis_w: 45,\n    legend_width: 60,\n    legend_gutter: 30,\n    axis_lead: 15\n  };\n});","angular.module('a2.service.plotly-defaults', ['a2-plot-specs', 'a2.service.colorscale-gradients']).provider('PlotlyDefaults', function () {\n  var PlotlyDefaults = {\n    defaults: {},\n    set: function (newDefaults, extend) {\n      if (extend) {\n        PlotlyDefaults.defaults = angular.merge(defaults, newDefaults);\n      } else {\n        PlotlyDefaults.defaults = newDefaults;\n      }\n    },\n    $get: function (PlotlyDefaultDefaults) {\n      return angular.merge(PlotlyDefaultDefaults, PlotlyDefaults.defaults);\n    }\n  };\n  return PlotlyDefaults;\n}).service('PlotlyDefaultDefaults', function (PlotSpecs, ColorscaleGradients) {\n  var defaults = {\n    titlefont: {\n      family: '\"Helvetica Neue\", Helvetica, Arial, sans-serif',\n      size: '14px'\n    },\n    tickfont: {\n      family: 'sans-serif',\n      size: '11px',\n      color: '#fff'\n    }\n  };\n  defaults.config = {\n    showLink: false,\n    sendData: false,\n    displaylogo: false,\n    displayModeBar: true,\n    scrollZoom: true,\n    modeBarButtonsToRemove: ['sendDataToCloud', 'autoScale2d']\n  };\n  defaults.layout = {\n    xaxis: {\n      titlefont: defaults.titlefont,\n      tickfont: defaults.tickfont,\n      color: '#fff'\n    },\n    yaxis: {\n      titlefont: defaults.titlefont,\n      tickfont: defaults.tickfont,\n      color: '#fff'\n    },\n    // margin:{l:70 + 25,r:0,b:25,t:50, pad:0},\n    plot_bgcolor: '#131525',\n    paper_bgcolor: '#131525',\n    dragmode: 'pan'\n  };\n  defaults.colorbar = {\n    tickfont: defaults.tickfont,\n    thickness: PlotSpecs.legend_width - PlotSpecs.legend_axis_w\n  };\n  defaults.heatmap = {\n    colorscale: ColorscaleGradients.normalize(0),\n    colorbar: defaults.colorbar\n  };\n  return defaults;\n});","angular.module('a2.url-update-service', []).factory('a2UrlUpdate', function () {\n  return {\n    cache: {},\n    prefix: '_t_',\n    clear: function () {\n      this.cache = {};\n    },\n    update: function (url) {\n      url = this.get(url);\n      var qidx = url.indexOf('?');\n      var url2;\n\n      var _t_ = new Date().getTime();\n\n      if (qidx >= 0) {\n        var re = new RegExp('(^|&)' + this.prefix + '=(\\\\d+)');\n        var query = url.substr(qidx + 1);\n        var m = re.exec(query);\n\n        if (m) {\n          url2 = url.substr(0, qidx) + '?' + query.replace(re, this.prefix + '=' + _t_);\n        } else {\n          url2 = url + '&' + this.prefix + '=' + _t_;\n        }\n      } else {\n        url2 = url + '?' + this.prefix + '=' + _t_;\n      }\n\n      this.cache[url] = url2;\n      $('[src=\"' + url + '\"]').attr('src', '').attr('src', url2);\n    },\n    get: function (url) {\n      var url2;\n\n      while (url2 = this.cache[url]) {\n        url = url2;\n      }\n\n      return url;\n    }\n  };\n}).filter('a2UpdatedUrl', function (a2UrlUpdate) {\n  return function (url) {\n    return a2UrlUpdate.get(url);\n  };\n});","angular.module('a2.utils.external-api-loader', ['a2.utils.global-anonymous-function']).provider('externalApiLoader', function () {\n  var externalApiLoaderProvider = {\n    apis: {},\n    defaults: {\n      getCachedModule: [\"$window\", function ($window) {\n        return $window[this.def.namespace];\n      }],\n      loader: [\"$window\", \"$q\", \"globalAnonymousFunction\", function ($window, $q, globalAnonymousFunction) {\n        var api = this;\n        return $q(function (resolve, reject) {\n          var url = api.def.url;\n          var script = $window.document.createElement('script');\n          angular.element($window.document.head).append(script);\n\n          if (api.def.jsonpCallback) {\n            url += (/\\?/.test(url) ? '&' : '?') + api.def.jsonpCallback + '=' + globalAnonymousFunction(resolve, {\n              oneTime: true\n            }).id;\n          } else {\n            script.onload = resolve;\n          }\n\n          script.onerror = function () {\n            reject();\n          };\n\n          script.src = url;\n        });\n      }]\n    },\n    addApi: function (apiName, def) {\n      externalApiLoaderProvider.apis[apiName] = {\n        name: apiName,\n        def: angular.extend({}, externalApiLoaderProvider.defaults, def)\n      };\n    },\n    $get: function ($q, $injector) {\n      var externalApiLoader = {\n        load: function (apiName) {\n          var api = externalApiLoaderProvider.apis[apiName];\n\n          if (!api) {\n            return $q.reject(\"Cannot load unconfigured external api \" + apiName);\n          }\n\n          if (!api.module) {\n            api.module = $injector.invoke(api.def.getCachedModule, api);\n          }\n\n          if (!api.promise) {\n            if (api.module) {\n              api.promise = $q.resolve(api.module);\n            } else {\n              api.promise = $q.resolve();\n\n              if (api.def.parent) {\n                api.promise = api.promise.then(function () {\n                  return externalApiLoader.load(api.def.parent);\n                }).then(function () {\n                  api.parent = externalApiLoaderProvider.apis[api.def.parent];\n                });\n              }\n\n              api.promise = api.promise.then(function () {\n                return $injector.invoke(api.def.loader, api);\n              }).then(function () {\n                api.module = $injector.invoke(api.def.getCachedModule, api);\n              }).then(function () {\n                if (api.def.onload) {\n                  return $injector.invoke(api.def.onload, api);\n                }\n              }).then(function () {\n                return api.module;\n              });\n            }\n          }\n\n          return api.promise;\n        }\n      };\n      return externalApiLoader;\n    }\n  };\n  return externalApiLoaderProvider;\n});","angular.module('a2.utils.global-anonymous-function', []).factory('globalAnonymousFunction', function ($window) {\n  var ct = 0;\n  return function (fn, options) {\n    // console.log(\"return function(fn, options)\", fn, options);\n    var wrapperFn = function () {\n      if (options && options.oneTime) {\n        wrapperFn.remove();\n      }\n\n      fn.apply(this, Array.prototype.slice.call(arguments));\n    };\n\n    wrapperFn.id = '__g_a_f_' + ct++;\n    $window[wrapperFn.id] = wrapperFn;\n\n    wrapperFn.remove = function () {\n      if ($window[wrapperFn.id] == wrapperFn) {\n        delete $window[wrapperFn.id];\n      }\n    };\n\n    return wrapperFn;\n  };\n});","angular.module('a2.utils.q-promisify', []).factory('$qPromisify', function ($q) {\n  function $qPromisify()\n  /*fn, ...args*/\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var fn = args.shift();\n    return $q(function (resolve, reject) {\n      args.push(function (err, value) {\n        if (err) {\n          reject();\n        } else {\n          resolve(value);\n        }\n      });\n      fn.apply(null, args);\n    });\n  }\n\n  $qPromisify.invoke = function ()\n  /*object, method, ...args*/\n  {\n    var args = Array.prototype.slice.call(arguments);\n    var object = args.shift();\n    var method = args.shift();\n    return $qPromisify(function (cb) {\n      args.push(cb);\n      object[method].apply(object, args);\n    });\n  };\n\n  return $qPromisify;\n});","angular.module('a2.admin.jobs', ['ui.router', 'templates-arbimon2']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('jobs', {\n    url: '/jobs',\n    controller: 'AdminJobsCtrl',\n    templateUrl: '/admin/jobs/index.html'\n  });\n}).controller('AdminJobsCtrl', function ($scope, $http, $interval, Project) {\n  var getJobQueueInfo = function (argument) {\n    $http.get('/admin/job-queue').success(function (data) {\n      $scope.jobsStatus = data;\n    });\n  };\n\n  $scope.findJobs = function () {\n    var query = {};\n    var getTags = /(\\w+):[\"'](.+)[\"']|(\\w+):([\\w\\-]+)/g;\n\n    if ($scope.params.search) {\n      // iterate over getTags results\n      $scope.params.search.replace(getTags, function (match, key1, value1, key2, value2) {\n        // key1 matches (\\w+):[\"'](.+)[\"']\n        // key2 matches (\\w+):([\\w\\-]+)\n        var key = key1 ? key1 : key2;\n        var value = value1 ? value1 : value2;\n        if (!query[key]) query[key] = [];\n        query[key].push(value);\n      });\n    }\n\n    if ($scope.params.states) {\n      query.states = $scope.params.states.map(function (s) {\n        return s.name;\n      });\n    }\n\n    if ($scope.params.types) {\n      query.types = $scope.params.types.map(function (t) {\n        return t.id;\n      });\n    }\n\n    $http.get('/admin/jobs', {\n      params: query\n    }).success(function (data) {\n      $scope.activeJobs = data; // console.log(query);\n    });\n  };\n\n  $scope.initParams = function () {\n    $scope.params = {\n      search: \"is:visible \"\n    };\n  };\n\n  $scope.job_types = [];\n  $scope.states = [{\n    name: 'waiting',\n    color: 'black',\n    show: true\n  }, {\n    name: 'initializing',\n    color: 'blue',\n    show: true\n  }, {\n    name: 'ready',\n    color: '#007777',\n    show: true\n  }, {\n    name: 'processing',\n    color: 'olive',\n    show: true\n  }, {\n    name: 'completed',\n    color: 'green',\n    show: false\n  }, {\n    name: 'error',\n    color: 'red',\n    show: true\n  }, {\n    name: 'canceled',\n    color: 'gray',\n    show: false\n  }, {\n    name: 'stalled',\n    color: 'gray',\n    show: false\n  }];\n  $scope.initParams();\n  getJobQueueInfo();\n  $http.get('/legacy-api/jobs/types').success(function (jobTypes) {\n    var colors = ['#1482f8', '#df3627', '#40af3b', '#9f51bf', '#d37528'];\n    $scope.colors = {};\n\n    for (var i = 0; i < jobTypes.length; i++) {\n      var t = jobTypes[i];\n      $scope.colors[t.name] = colors[i % colors.length];\n    }\n\n    $scope.job_types = jobTypes;\n  });\n  $scope.findJobs();\n});","angular.module('a2.admin.dashboard.data-service', []).service('AdminDashboardDataService', function ($q) {\n  return {\n    getPlotData: function (series, from, to, period) {\n      return $q.when('/admin/plot-data/data.txt?stat=' + series + '&q=' + period + '&from=' + from.getTime() + '&to=' + to.getTime());\n    }\n  };\n});","angular.module('a2.admin.dashboard', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'a2.directives', 'templates-arbimon2', 'humane', 'ui.select', 'a2.admin.dashboard.data-service', 'a2.admin.dashboard.plotter-controller']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('dashboard', {\n    url: '/dashboard',\n    controller: 'AdminDashboardCtrl as controller',\n    templateUrl: '/admin/dashboard/index.html'\n  });\n}).controller('AdminDashboardCtrl', function ($scope, $http, $q, $controller) {\n  $scope.plots = $controller('AdminDashboardPlotterController', {\n    '$scope': $scope\n  });\n\n  $scope.UserStatsExport = function () {\n    $http.get('/admin/all-users').success(function (data) {\n      download(data);\n    });\n  };\n\n  $http.get('/admin/dashboard-stats').success(function (data) {\n    $scope.newUsers = data.newUsers;\n    $scope.newProjects = data.newProjects;\n    $scope.Jobs = data.jobsStatus;\n    $scope.allUsers = data.allUsers;\n    $scope.allSites = data.allSites;\n    $scope.allProjects = data.allProjects;\n    $scope.newSites = data.newSites;\n  });\n\n  $scope.getSystemSettings = function () {\n    $http.get('/admin/system-settings').success(function (data) {\n      $scope.settings = data;\n    });\n  };\n\n  $scope.getSystemSettings();\n\n  $scope.setSetting = function (setting, value) {\n    var d = $q.defer();\n\n    if (!setting) {\n      d.resolve();\n    } else {\n      $http.put('/admin/system-settings', {\n        setting: setting,\n        value: value\n      }).success(function (data) {\n        $scope.getSystemSettings();\n        d.resolve(data[setting]);\n      }).error(function (data) {\n        console.error(data);\n        $scope.getSystemSettings();\n        d.reject(data);\n      });\n    }\n\n    return d.promise;\n  };\n\n  $scope.toggleSetting = function (setting) {\n    var value = $scope.settings[setting] == 'on' ? 'off' : 'on';\n    return this.setSetting(setting, value);\n  };\n\n  function convertToCSV(objArray) {\n    var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;\n    var str = '';\n\n    for (var i = 0; i < array.length; i++) {\n      var line = '';\n\n      for (var index in array[i]) {\n        if (line != '') line += ',';\n        line += array[i][index];\n      }\n\n      str += line + '\\r\\n';\n    }\n\n    return str;\n  }\n\n  function exportCSVFile(headers, items, fileTitle) {\n    if (headers) {\n      items.unshift(headers);\n    } // Convert Object to JSON\n\n\n    var jsonObject = JSON.stringify(items);\n    var csv = convertToCSV(jsonObject);\n    var exportedFilenmae = fileTitle + '.csv' || 'export.csv';\n    var blob = new Blob([csv], {\n      type: 'text/csv;charset=utf-8;'\n    });\n\n    if (navigator.msSaveBlob) {\n      // IE 10+\n      navigator.msSaveBlob(blob, exportedFilenmae);\n    } else {\n      var link = document.createElement(\"a\");\n\n      if (link.download !== undefined) {\n        var url = URL.createObjectURL(blob);\n        link.setAttribute(\"href\", url);\n        link.setAttribute(\"download\", exportedFilenmae);\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    }\n  }\n\n  function download(data) {\n    var headers = {\n      name: 'Name',\n      email: \"Email\"\n    };\n    var itemsFormatted = []; // format the data\n\n    data.forEach(function (item) {\n      itemsFormatted.push({\n        name: item.firstname + \" \" + item.lastname,\n        email: item.email\n      });\n    });\n    exportCSVFile(headers, itemsFormatted, 'users');\n  }\n});","angular.module('a2.admin.dashboard.plotter-controller', ['templates-arbimon2', 'a2.admin.dashboard.data-service', 'a2.directive.plotly-plotter']).controller('AdminDashboardPlotterController', function ($scope, $window, $q, AdminDashboardDataService) {\n  function mk_time_range_fn(from, delta) {\n    return function () {\n      var fromdt = from == 'now' ? new Date() : new Date(from);\n      var todt = new Date(fromdt.getTime() + delta);\n\n      if (delta < 0) {\n        var t = fromdt;\n        fromdt = todt;\n        todt = t;\n      }\n\n      return [fromdt, todt];\n    };\n  }\n\n  function get_by_tag(arr, tag) {\n    return arr.filter(function (x) {\n      return x.tag == tag;\n    }).shift();\n  }\n\n  function make_setter(options) {\n    var attr = options.data;\n    var selattr = options.sel || attr;\n    var def = options.def;\n    return function set(value) {\n      if (typeof value == 'string') {\n        value = get_by_tag(this.data[attr], value);\n      }\n\n      if (!value) {\n        value = get_by_tag(this.data[attr], def);\n      }\n\n      this.selected[selattr] = value;\n\n      if (value.apply) {\n        value.apply(this);\n      }\n\n      return this.refresh_logs();\n    };\n  }\n\n  this.data = {\n    series: [{\n      tag: 'activity',\n      name: 'Activity',\n      icon: 'fa fa-fw fa-ra'\n    } // {tag:'voltage', name:'Voltage', icon:'fa fa-fw fa-bolt'},\n    // {tag:'power', name:'Power', icon:'fa fa-fw fa-battery-half'}\n    ],\n    time_ranges: [{\n      tag: '1-hour',\n      text: 'Last Hour',\n      range: mk_time_range_fn('now', -3600 * 1000)\n    }, {\n      tag: '3-hour',\n      text: 'Last 3 Hours',\n      range: mk_time_range_fn('now', -3 * 3600 * 1000)\n    }, {\n      tag: '6-hour',\n      text: 'Last 6 Hours',\n      range: mk_time_range_fn('now', -6 * 3600 * 1000)\n    }, {\n      tag: '12-hour',\n      text: 'Last 12 Hours',\n      range: mk_time_range_fn('now', -12 * 3600 * 1000)\n    }, {\n      tag: '24-hour',\n      text: 'Last 24 Hours',\n      range: mk_time_range_fn('now', -24 * 3600 * 1000)\n    }, {\n      tag: '3-days',\n      text: 'Last 3 Days',\n      range: mk_time_range_fn('now', -3 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-week',\n      text: 'Last Week',\n      range: mk_time_range_fn('now', -7 * 24 * 3600 * 1000)\n    }, {\n      tag: '2-weeks',\n      text: 'Last 2 Weeks',\n      range: mk_time_range_fn('now', -14 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-month',\n      text: 'Last Month',\n      range: mk_time_range_fn('now', -31 * 24 * 3600 * 1000)\n    }],\n    periods: [{\n      tag: '1-minute',\n      text: '1 Minute',\n      sampling: '1 min',\n      granularity: 1 * 60 * 1000\n    }, {\n      tag: '5-minutes',\n      text: '5 Minutes',\n      sampling: '5 mins',\n      granularity: 5 * 60 * 1000\n    }, {\n      tag: '10-minutes',\n      text: '10 Minutes',\n      sampling: '10 mins',\n      granularity: 10 * 60 * 1000\n    }, {\n      tag: '30-minutes',\n      text: '30 Minutes',\n      sampling: '30 mins',\n      granularity: 30 * 60 * 1000\n    }, {\n      tag: '1-hour',\n      text: '1 Hour',\n      sampling: '1 hour',\n      granularity: 1 * 60 * 60 * 1000\n    }, {\n      tag: '3-hours',\n      text: '3 Hours',\n      sampling: '3 hours',\n      granularity: 3 * 60 * 60 * 1000\n    }, {\n      tag: '6-hours',\n      text: '6 Hours',\n      sampling: '6 hours',\n      granularity: 6 * 60 * 60 * 1000\n    }, {\n      tag: '1-day',\n      text: '1 Day',\n      sampling: '1 day',\n      granularity: 24 * 60 * 60 * 1000\n    }] // min_date: 0,\n    // max_date: 10000,\n\n  };\n  this.loading = {};\n  this.selected = {\n    series: get_by_tag(this.data.series, 'activity'),\n    time_range: get_by_tag(this.data.time_ranges, '1-week'),\n    period: get_by_tag(this.data.periods, '1-day')\n  };\n  this.set_series = make_setter({\n    data: 'series',\n    sel: 'series',\n    def: 'activity'\n  });\n  this.set_time_range = make_setter({\n    data: 'time_ranges',\n    sel: 'time_range',\n    def: '1-week'\n  });\n  this.set_period = make_setter({\n    data: 'periods',\n    sel: 'period',\n    def: '1-day'\n  });\n\n  this.load_data = function (series, range, period) {\n    var loading = this.loading;\n    loading.data = true;\n    return AdminDashboardDataService.getPlotData(series.tag, range[0], range[1], period.sampling).then(function (data) {\n      loading.data = false;\n      return {\n        x: 'datetime',\n        url: data\n      };\n    });\n  };\n\n  this.make_chart_struct = function (data) {\n    return $q(function (resolve, reject) {\n      $window.Plotly.d3.csv(data.url, function (err, data) {\n        if (err) {\n          reject(err);\n        } else if (data) {\n          resolve(data);\n        }\n      });\n    }).then(function (data) {\n      this.chart = {\n        data: [{\n          type: 'scatter',\n          mode: 'lines',\n          marker: {\n            color: '#31984f'\n          },\n          x: data.map(function (_) {\n            return new Date(+_.datetime).toString();\n          }),\n          y: data.map(function (_) {\n            return +_.activity;\n          })\n        }],\n        layout: {\n          xaxis: {\n            boundsmode: 'auto'\n          },\n          yaxis: {\n            boundsmode: 'auto'\n          }\n        } // axes : {\n        //     x : {\n        //         tick: {\n        //             format: function (x) {\n        //                 return moment(new Date(x)).utc().format('MM-DD-YYYY HH:mm');\n        //             }\n        //         }\n        //     }\n        // }\n\n      };\n      console.log(this.chart);\n    }.bind(this));\n  };\n\n  this.refresh_logs = function () {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var series = this.selected.series;\n    var time_range = this.selected.time_range;\n    var period = this.selected.period;\n\n    if (series && time_range && period) {\n      var range = time_range.range();\n      var granularity = period.granularity;\n      promise = d.promise.then(function () {\n        if (series.data) {\n          if (series.data.period != period || !(series.data.range[0] - granularity >= range[0] && range[1] <= series.data.range[1] + granularity)) {\n            series.data = null;\n          }\n        }\n\n        if (!series.data) {\n          return this.load_data(series, range, period).then(function (data) {\n            series.data = {\n              data: data,\n              range: range,\n              period: period\n            };\n            return series.data.data;\n          });\n        } else {\n          return series.data.data;\n        }\n      }.bind(this)).then(function (chart_data) {\n        console.log(\"chart_data : \", chart_data);\n\n        if (chart_data) {\n          this.make_chart_struct(chart_data);\n        }\n      }.bind(this));\n    }\n\n    return promise;\n  };\n\n  $q.when().then(this.refresh_logs.bind(this));\n});","angular.module('a2.admin.projects.codes', ['ui.router', 'a2.directives', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'humane', 'ui.select', 'a2.admin.projects.list', 'a2.admin.users.list']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('projects.codes', {\n    url: '/codes',\n    controller: 'AdminProjectsCodesCtrl as controller',\n    templateUrl: '/admin/projects/codes.html'\n  });\n}).controller('AdminProjectsCodesCtrl', function ($modal, notify, LoaderFactory, AdminProjectsCodesService) {\n  var loader = LoaderFactory.newInstance();\n  this.loader = loader;\n\n  this.createNewCode = function () {\n    return $modal.open({\n      templateUrl: '/admin/projects/new-code-modal.html',\n      resolve: {\n        projectsList: function (AdminProjectsListService) {\n          return AdminProjectsListService.getList();\n        },\n        usersList: function (AdminUsersListService) {\n          return AdminUsersListService.getList();\n        }\n      },\n      controller: function (projectsList, usersList) {\n        this.projectsList = projectsList;\n        this.usersList = usersList;\n        this.data = {\n          lockToUser: undefined,\n          lockProject: undefined,\n          duration: 1,\n          recordings: 10000,\n          processing: 1000000,\n          tieProcessingWithRecordings: true\n        };\n\n        this.computeProcessingAmount = function () {\n          if (this.data.tieProcessingWithRecordings) {\n            this.data.processing = this.data.recordings * 100;\n          }\n        };\n\n        this.processingCountChanged = function () {\n          this.data.tieProcessingWithRecordings = false;\n        };\n      },\n      controllerAs: 'popup'\n    }).result.then(AdminProjectsCodesService.createNewCode).then(function () {\n      loader.load(this, 'codes', AdminProjectsCodesService.loadCodes());\n    }.bind(this));\n  };\n\n  this.showHash = function (code) {\n    return $modal.open({\n      templateUrl: '/admin/projects/view-hash.html',\n      resolve: {\n        code: function () {\n          return code;\n        }\n      },\n      controller: function (code) {\n        this.code = code;\n      },\n      controllerAs: 'popup'\n    });\n  }; // editSelectedCode\n  // deleteSelectedCode\n\n\n  loader.load(this, 'codes', AdminProjectsCodesService.loadCodes());\n}).service('AdminProjectsCodesService', function ($http) {\n  return {\n    loadCodes: function () {\n      return $http.get('/admin/projects/codes').then(function (response) {\n        return response.data;\n      });\n    },\n    createNewCode: function (data) {\n      console.log(\"createNewCode\", data);\n      return $http.post('/admin/projects/codes', {\n        user: data.lockToUser && data.lockToUser.id,\n        project: data.lockProject && data.lockProject.id,\n        recordings: data.recordings,\n        duration: data.duration,\n        processing: data.processing\n      }).then(function (data) {\n        return data.response;\n      });\n    }\n  };\n}).factory('LoaderFactory', function ($q) {\n  function Loader() {\n    this.loading = {};\n  }\n\n  Loader.prototype = {\n    load: function (valueStore, key, promise) {\n      this.loading[key] = true;\n      return promise.then(function (value) {\n        this.loading[key] = false;\n\n        if (valueStore) {\n          valueStore[key] = value;\n        }\n\n        return value;\n      }.bind(this), function (err) {\n        this.loading[key] = false;\n        throw err;\n      }.bind(this));\n    }\n  };\n  return {\n    newInstance: function () {\n      return new Loader();\n    }\n  };\n});","angular.module('a2.admin.projects', ['ui.router', 'templates-arbimon2', 'a2.admin.projects.list', 'a2.admin.projects.codes']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/dashboard\");\n  $stateProvider.state('projects', {\n    url: '/projects',\n    abstract: true,\n    templateUrl: '/admin/projects/index.html'\n  });\n});","angular.module('a2.admin.projects.list', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'a2.orders.directives.tier-select', 'humane', 'ui.select']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('projects.list', {\n    url: '',\n    controller: 'AdminProjectsListCtrl as controller',\n    templateUrl: '/admin/projects/list.html'\n  }).state('projects.list.detail', {\n    url: '/:url',\n    views: {\n      'detail': {\n        templateUrl: '/admin/projects/list-detail.html',\n        controller: 'AdminProjectsListDetailCtrl as controller'\n      }\n    }\n  });\n}).controller('AdminProjectsListCtrl', function ($scope, $state, AdminProjectsListService) {\n  this.initialize = function () {\n    AdminProjectsListService.getList().then(function (data) {\n      this.projects = data;\n\n      if ($state.params.url) {\n        var url = $state.params.url;\n        this.selected = this.projects.reduce(function (_, project) {\n          return project.url == url ? project : _;\n        }, null);\n      }\n    }.bind(this));\n  };\n\n  this.select = function (project) {\n    return $state.go('projects.list.detail', {\n      url: project.url\n    });\n  };\n\n  this.notifyProjectUpdated = function (project) {\n    var projectObject = this.projects.reduce(function (_, p, $index) {\n      return p.project_id == project.project_id ? project : _;\n    }, null);\n    angular.merge(projectObject, project);\n  };\n\n  this.initialize();\n}).controller('AdminProjectsListDetailCtrl', function ($scope, $state, $q, notify, AdminProjectsListService) {\n  this.initialize = function () {\n    console.log(\"$state\", $state);\n    this.setProject({\n      url: $state.params.url\n    });\n  };\n\n  this.setProject = function (projectData) {\n    return $q.all([AdminProjectsListService.getProjectInfo(projectData), AdminProjectsListService.getProjectSites(projectData), AdminProjectsListService.getProjectRecordingCount(projectData)]).then(function (all) {\n      this.project = all[0];\n      this.project.is_enabled = this.project.is_enabled | 0;\n      this.sites = all[1];\n      this.recCount = all[2];\n    }.bind(this));\n  };\n\n  this.close = function () {\n    $state.go('projects.list');\n  };\n\n  this.save = function () {\n    return AdminProjectsListService.updateProject(this.project).then(function (project) {\n      this.project = project;\n      notify.log(\"Project \" + project.name + \" info updated.\");\n    }.bind(this)).catch(function (err) {\n      notify.error(err);\n    });\n  };\n\n  this.handleAedToggle = function () {\n    this.project.clustering_enabled = this.project.aed_enabled;\n  };\n\n  this.initialize();\n}).service('AdminProjectsListService', function ($http) {\n  return {\n    getList: function () {\n      return $http.get('/admin/projects').then(function (response) {\n        return response.data;\n      });\n    },\n    getProjectInfo: function (project) {\n      return $http.get('/legacy-api/project/' + project.url + '/info').then(function (response) {\n        var data = response.data;\n        data.is_enabled = !!data.is_enabled;\n        return data;\n      });\n    },\n    getProjectSites: function (project) {\n      return $http.get('/legacy-api/project/' + project.url + '/sites').then(function (response) {\n        return response.data;\n      });\n    },\n    getProjectRecordingCount: function (project) {\n      return $http.get('/legacy-api/project/' + project.url + '/recordings/count').then(function (response) {\n        return response.data.count;\n      });\n    },\n    updateProject: function (project) {\n      var projectData = {\n        project_id: project.project_id,\n        name: project.name,\n        url: project.url,\n        description: project.description,\n        project_type_id: project.project_type_id,\n        is_private: project.is_private,\n        is_enabled: project.is_enabled,\n        current_plan: project.current_plan,\n        storage_usage: project.storage_usage,\n        processing_usage: project.processing_usage,\n        citizen_scientist_enabled: !!project.citizen_scientist_enabled,\n        cnn_enabled: !!project.cnn_enabled,\n        pattern_matching_enabled: !!project.pattern_matching_enabled,\n        aed_enabled: !!project.aed_enabled,\n        clustering_enabled: !!project.clustering_enabled,\n        reports_enabled: !!project.reports_enabled,\n        plan: {\n          tier: project.tier,\n          storage: project.storage_limit,\n          processing: project.processing_limit,\n          activation: project.plan_activated,\n          duration_period: project.plan_period\n        }\n      };\n      return $http.put('/admin/projects/' + project.project_id, {\n        project: projectData\n      }).then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.admin.users.list', ['ui.router', 'ui.bootstrap', 'a2.utils', 'a2.services', 'templates-arbimon2', 'humane', 'ui.select']) // .config(function($stateProvider, $urlRouterProvider) {\n//     $stateProvider\n//         .state('users.list', {\n//             url: '',\n//             controller:'AdminUsersListCtrl',\n//             templateUrl: '/admin/users/list.html'\n//         });\n// \n// })\n// .controller('AdminUsersCtrl', function($scope, $http) {\n//     $http.get('/admin/users')\n//         .success(function(data) {\n//             $scope.users = data;\n//         });\n// })\n.service('AdminUsersListService', function ($http) {\n  return {\n    getList: function () {\n      return $http.get('/admin/users').then(function (response) {\n        return response.data;\n      });\n    }\n  };\n});","angular.module('a2.analysis', ['a2.analysis.patternmatching', 'a2.directive.audio-bar', 'a2.analysis.random-forest-models', 'a2.analysis.cnn', 'a2.analysis.soundscapes', 'a2.analysis.audio-event-detection', 'a2.analysis.audio-event-detections-clustering', 'a2.analysis.clustering-jobs', 'ui.router', 'ct.ui.router.extras', 'a2.srv.api']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/analysis\", \"/analysis/patternmatching\", \"/analysis/clustering-jobs\");\n  $stateProvider.state('analysis', {\n    url: '/analysis',\n    views: {\n      'analysis': {\n        controller: 'AnalysisIndexCtrl as controller',\n        templateUrl: '/app/analysis/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  });\n}).controller('AnalysisIndexCtrl', function ($scope, Project, a2UserPermit) {\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n});","angular.module('a2.audiodata', ['ui.router', 'ct.ui.router.extras', 'a2.directive.sidenav-bar', 'a2.directive.audio-bar', 'a2.audiodata.sites', 'a2.audiodata.species', 'a2.audiodata.uploads', 'a2.audiodata.recordings', 'a2.audiodata.training-sets', 'a2.audiodata.playlists', 'a2.audiodata.templates', 'a2.audiodata.soundscape-composition-classes']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/audiodata\", \"/audiodata/sites\");\n  $stateProvider.state('audiodata', {\n    url: '/audiodata',\n    views: {\n      'audiodata': {\n        controller: 'AudiodataIndexCtrl as controller',\n        templateUrl: '/app/audiodata/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  }).state('audiodata.sites', {\n    url: '/sites?site&show',\n    controller: 'SitesCtrl',\n    templateUrl: '/app/audiodata/sites.html'\n  }).state('audiodata.species', {\n    url: '/species',\n    controller: 'SpeciesCtrl',\n    templateUrl: '/app/audiodata/species.html'\n  }).state('audiodata.trainingSets', {\n    url: '/training-sets?set&show',\n    controller: 'TrainingSetsCtrl as controller',\n    templateUrl: '/app/audiodata/training-sets.html'\n  });\n}).controller('AudiodataIndexCtrl', function ($scope, Project, a2UserPermit) {\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n});","angular.module('a2.audiodata.sites', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane', 'a2.qr-js', 'a2.googlemaps', 'a2.srv.project']).directive('fileChange', ['$parse', function ($parse) {\n  return {\n    require: 'ngModel',\n    restrict: 'A',\n    link: function ($scope, element, attrs) {\n      var attrHandler = $parse(attrs['fileChange']);\n\n      var handler = function (e) {\n        $scope.$apply(function () {\n          attrHandler($scope, {\n            $event: e,\n            files: e.target.files\n          });\n        });\n      };\n\n      element[0].addEventListener('change', handler, false);\n    }\n  };\n}]).controller('SitesCtrl', function ($scope, $state, $anchorScroll, Project, $modal, notify, a2Sites, $window, $controller, $q, a2UserPermit, a2GoogleMapsLoader, $downloadResource) {\n  $scope.loading = true;\n  $scope.markers = [];\n  $scope.search = '';\n  $scope.editing = false;\n  $scope.creating = false;\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  var p = {\n    site: $state.params.site,\n    show: $state.params.show\n  };\n\n  if (p.show) {\n    p.show_path = p.show.split(':');\n    p.show = p.show_path.shift();\n  }\n\n  Project.getSites({\n    count: true,\n    logs: true,\n    deployment: true\n  }, function (sites) {\n    $scope.sortByLastUpdated(sites);\n    $scope.loading = false;\n\n    if (p.site) {\n      var site = sites.filter(function (s) {\n        return s.id == p.site;\n      }).shift();\n\n      if (site && site.id) {\n        $scope.sel(site).then(function () {\n          if (p.show) {\n            $scope.set_show(p.show, p.show_path);\n          }\n        });\n      }\n    }\n\n    a2GoogleMapsLoader.then(function (google) {\n      $scope.map = new google.maps.Map($window.document.getElementById('mapSite'), {\n        center: {\n          lat: 0,\n          lng: 0\n        },\n        mapTypeId: google.maps.MapTypeId.SATELLITE,\n        zoom: 8,\n        minZoom: 2\n      });\n      $scope.fitBounds();\n    });\n    $scope.mapHeader = $window.document.getElementById('mapHeader');\n    $scope.mapHeaderPosition = mapHeader.getBoundingClientRect();\n  });\n\n  $scope.fitBounds = function () {\n    const bounds = new google.maps.LatLngBounds();\n    angular.forEach($scope.sites, function (site) {\n      if (site.lat > 85 || site.lat < -85 || site.lon > 180 || site.lon < -180) {\n        return;\n      }\n\n      var marker;\n      const position = new google.maps.LatLng(site.lat, site.lon); // set custop pin to selected site\n\n      if ($scope.selected && $scope.selected.id === site.id) {\n        marker = new google.maps.Marker({\n          position: position,\n          title: site.name,\n          icon: {\n            url: 'http://icons.iconarchive.com/icons/paomedia/small-n-flat/48/map-marker-icon.png'\n          }\n        });\n      } else {\n        marker = new google.maps.Marker({\n          position: position,\n          title: site.name\n        });\n      } // add draggable layer for an editig site\n\n\n      if (($scope.editing || $scope.creating) && $scope.temp && $scope.temp.id === site.id) {\n        marker.setDraggable(true);\n        $scope.map.panTo(position);\n        $scope.map.setZoom(8);\n        google.maps.event.addListener(marker, 'dragend', function (position) {\n          $scope.$apply(function () {\n            $scope.temp.lat = position.latLng.lat();\n            $scope.temp.lon = position.latLng.lng();\n          });\n        });\n      }\n\n      marker.addListener(\"click\", function () {\n        $scope.sel(site);\n        $scope.scrollTo(site.id);\n      });\n      $scope.markers.push(marker);\n      bounds.extend(position);\n    });\n    $scope.map.fitBounds(bounds);\n\n    if ($scope.markers.length) {\n      $scope.setMapOnAll($scope.map);\n    }\n\n    ;\n  };\n\n  $scope.scrollTo = function (id) {\n    const bookmark = 'site-' + id;\n    $anchorScroll.yOffset = 60;\n    console.log(bookmark);\n    $anchorScroll(bookmark);\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    this.scrollPos = $controller.scrollElement.scrollY;\n    $scope.scrollPos = this.scrollPos;\n    $scope.scrolledPastHeader = this.scrollPos < 600;\n  };\n\n  $scope.getMapHeaderTop = function () {\n    // calculate top offset for the map\n    const defaultOffset = '122px';\n\n    if ($scope.mapHeaderPosition) {\n      const topOffset = $scope.mapHeaderPosition.top + $scope.mapHeader.offsetHeigh;\n      return topOffset < 1 ? defaultOffset : topOffset;\n    } else return defaultOffset;\n  };\n\n  $scope.scrollMap = function ($event, $controller) {\n    return $scope.show.map && $scope.editing === false && $scope.creating === false && $scope.sites && $scope.sites.length > 15 && $scope.scrollPos;\n  }, $scope.onFilterChanged = function () {\n    $scope.sites = $scope.sortByKeywordArray($scope.originalSites, $scope.search);\n  };\n\n  $scope.sortByKeywordArray = function (array, keyword) {\n    if (array && !array.length) return [];\n    return array.filter(function (item) {\n      // Filter results by doing case insensitive match on name\n      return item.name.toLowerCase().includes(keyword.toLowerCase());\n    }).sort(function (a, b) {\n      // Sort results by matching name with keyword position in name\n      if (a.name.toLowerCase().indexOf(keyword.toLowerCase()) > b.name.toLowerCase().indexOf(keyword.toLowerCase())) {\n        return 1;\n      } else if (a.name.toLowerCase().indexOf(keyword.toLowerCase()) < b.name.toLowerCase().indexOf(keyword.toLowerCase())) {\n        return -1;\n      } else {\n        if (a.name > b.name) return 1;else return -1;\n      }\n    });\n  };\n\n  $scope.sortByLastUpdated = function (sites) {\n    $scope.sites = sites.sort(function (a, b) {\n      return a.updated_at < b.updated_at ? 1 : -1;\n    });\n    $scope.originalSites = $scope.sites;\n  }; // Sets the map on all markers in the array\n\n\n  $scope.setMapOnAll = function (map) {\n    for (var i = 0; i < $scope.markers.length; i++) {\n      $scope.markers[i].setMap(map);\n    }\n  }; // Removes the markers from the map, but keeps them in the array\n\n\n  $scope.clearMarkers = function () {\n    $scope.setMapOnAll(null);\n  }; // Shows any markers currently in the array\n\n\n  $scope.showMarkers = function (map) {\n    $scope.setMapOnAll(map);\n  }; // Deletes all markers in the array by removing references to them\n\n\n  $scope.deleteMarkers = function () {\n    $scope.clearMarkers();\n    $scope.markers = [];\n  };\n\n  $scope.editing = false;\n\n  $scope.importSite = function () {\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to add sites\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: \"/app/audiodata/import.html\",\n      controller: \"ImportSiteInstanceCtrl\"\n    });\n    modalInstance.result.then(function (response) {\n      // Check the file is valid\n      const sites = parseSitesFromCsv(response);\n\n      if (!sites) {\n        notify.error(\"Wrong format of csv file\");\n        return;\n      } // Save the sites\n\n\n      createSites(sites).then(function () {\n        notify.log(\"Sites created\"); // Refresh data\n\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites);\n        });\n      }).catch(function (error) {\n        notify.error(\"Error: \" + error);\n      });\n    });\n  };\n\n  function parseSitesFromCsv(allText) {\n    var allTextLines = allText.split(/\\r\\n|\\n/);\n    var headers = allTextLines[0].split(',');\n\n    if (!headers.includes(\"name\") || !headers.includes(\"lat\") || !headers.includes(\"lon\") || !headers.includes(\"alt\")) {\n      return false;\n    }\n\n    var sites = [];\n\n    for (var i = 1; i < allTextLines.length; i++) {\n      var data = allTextLines[i].split(',');\n\n      if (data.length == headers.length) {\n        var site = {};\n\n        for (var j = 0; j < headers.length; j++) {\n          if (headers[j] === \"lat\" && (data[j] > 85 || data[j] < -85)) {\n            return notify.log('Please enter latitude number between -85 to 85');\n          }\n\n          if (headers[j] === \"lon\" && (data[j] > 180 || data[j] < -180)) {\n            return notify.log('Please enter longitude number between -180 to 180');\n          }\n\n          site[headers[j]] = data[j];\n        }\n\n        sites.push(site);\n      }\n    }\n\n    return sites;\n  }\n\n  function createSites(sites) {\n    return Promise.all(sites.map(function (site) {\n      return new Promise(function (resolve, reject) {\n        a2Sites.create(site, function (data) {\n          if (data.error) {\n            reject(data.error);\n          } else {\n            resolve();\n          }\n        });\n      });\n    }));\n  }\n\n  ;\n\n  $scope.close = function () {\n    $scope.creating = false;\n    $scope.editing = false;\n\n    if ($scope.marker) {\n      a2GoogleMapsLoader.then(function (google) {\n        var position = new google.maps.LatLng($scope.selected && $scope.selected.lat, $scope.selected && $scope.selected.lon);\n        $scope.marker.setDraggable(false);\n        $scope.marker.setPosition(position);\n        $scope.marker.setTitle($scope.selected && $scope.selected.name);\n      });\n    }\n  };\n\n  $scope.exportSites = function () {\n    if (a2UserPermit.isSuper()) return $downloadResource(Project.getSitesExportUrl());\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export sites');\n    } else $downloadResource(Project.getSitesExportUrl());\n  };\n\n  $scope.status_controller = $controller('SiteStatusPlotterController', {\n    '$scope': $scope\n  });\n  var onLogsRefreshed = $scope.status_controller.on('logs-refreshed', function (logParams) {\n    if ($scope.show.status) {\n      var new_show = [$state.params.show.split(':').slice(0, 1)].concat(logParams).join(':');\n      console.log(\"logParams\", logParams, new_show);\n      $state.transitionTo($state.current.name, {\n        site: $state.params.site,\n        show: new_show\n      }, {\n        notify: false\n      });\n    }\n  });\n  $scope.$on('$destroy', function () {\n    $scope.status_controller.off('logs-refreshed', onLogsRefreshed);\n  });\n\n  $scope.save = function () {\n    var action = $scope.editing ? 'update' : 'create';\n\n    if ($scope.temp.lat > 85 || $scope.temp.lat < -85) {\n      notify.log('Please enter latitude number between -85 to 85');\n      return;\n    }\n\n    if ($scope.temp.lon > 180 || $scope.temp.lon < -180) {\n      notify.log('Please enter longitude number between -180 to 180');\n      return;\n    }\n\n    if ($scope.siteForm.$invalid) return;\n    var tempObj = Object.assign({}, $scope.temp); // Do not include equal location metadata / updated at data to the update endpoint.\n\n    if (action === 'update') {\n      const attrArray = ['alt', 'updated_at'];\n\n      for (var i = 0; i < attrArray.length; i++) {\n        var key = attrArray[i];\n\n        if ($scope.temp[key] === $scope.selected[key]) {\n          delete tempObj[key];\n        }\n      }\n\n      const locationArray = ['lat', 'lon'];\n\n      if ($scope.temp[locationArray[0]] === $scope.selected[locationArray[0]] && $scope.temp[locationArray[1]] === $scope.selected[locationArray[1]]) {\n        delete tempObj[locationArray[0]];\n        delete tempObj[locationArray[1]];\n      }\n    }\n\n    a2Sites[action](action === 'create' ? $scope.temp : tempObj, function (data) {\n      if (data.error) return notify.error(data.error);\n\n      if (action === 'create') {\n        $scope.creating = false;\n      } else {\n        $scope.editing = false;\n      }\n\n      Project.getSites({\n        count: true,\n        logs: true,\n        deployment: true\n      }, function (sites) {\n        $scope.sortByLastUpdated(sites);\n        $scope.sel(action === 'create' ? $scope.temp : tempObj).then(function () {\n          if (p.show) {\n            $scope.set_show(p.show, p.show_path);\n          }\n        }); // rebuild map pins\n\n        $scope.deleteMarkers();\n        $scope.fitBounds();\n      });\n      var message = action == \"update\" ? \"Site updated\" : \"Site created\";\n      notify.log(message);\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.selected) {\n      notify.log('Please select site to remove');\n      return;\n    }\n\n    if (!a2UserPermit.can('delete site')) {\n      notify.error(\"You do not have permission to remove sites\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"Are you sure you would like to remove the following site?\", $scope.selected.name];\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2Sites.delete([$scope.selected.id], function (data) {\n        if (data.error) return notify.error(data.error);\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites); // rebuild map pins\n\n          $scope.deleteMarkers();\n          $scope.fitBounds();\n        });\n        notify.log('Site removed');\n      });\n    });\n  };\n\n  $scope.delAllEmptySites = function () {\n    if (!a2UserPermit.can('manage project settings')) {\n      notify.error(\"You do not have permission to remove sites\");\n      return;\n    }\n\n    var list = [],\n        siteIds = [];\n    $scope.sites.forEach(function (site, index) {\n      if (site.rec_count === 0 && !list.includes(site.name)) {\n        list.push(site.name);\n        siteIds.push(site.id);\n      }\n    });\n\n    if (!list.length) {\n      notify.log(\"There is no empty site in your project\");\n      return;\n    }\n\n    if (list.length > 3) {\n      const msg = '& ' + (list.length - 3) + ' other sites';\n      list = list.slice(0, 3);\n      list.push(msg);\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"Are you sure you would like to remove the following sites?\"];\n        this.list = list;\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2Sites.delete(siteIds, function (data) {\n        if (data.error) return notify.error(data.error);\n        Project.getSites({\n          count: true,\n          logs: true,\n          deployment: true\n        }, function (sites) {\n          $scope.sortByLastUpdated(sites); // rebuild map pins\n\n          $scope.deleteMarkers();\n          $scope.fitBounds();\n        });\n        notify.log('Empty sites removed');\n      });\n    });\n  };\n\n  $scope.show = {\n    map: false,\n    status: false\n  };\n  $scope.show[p.show || 'map'] = true;\n\n  $scope.set_show = function (new_show, show_path) {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var show_state_param = new_show;\n\n    if (new_show == 'status' && $scope.selected && $scope.selected.has_logs) {\n      show_state_param = [new_show].concat(show_path).join(':');\n      promise = promise.then(function () {\n        return $scope.status_controller.activate($scope.selected, show_path);\n      });\n    } else {\n      promise = promise.then(function () {\n        new_show = 'map';\n      });\n    }\n\n    return promise.then(function () {\n      for (var i in $scope.show) {\n        $scope.show[i] = false;\n      }\n\n      $scope.show[new_show] = true;\n      return $state.transitionTo($state.current.name, {\n        site: $state.params.site,\n        show: show_state_param\n      }, {\n        notify: false\n      });\n    });\n  };\n\n  $scope.create = function () {\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to add sites\");\n      return;\n    }\n\n    $scope.temp = {};\n    $scope.set_show('map');\n    $scope.creating = true; // rebuild map pins\n\n    $scope.deleteMarkers();\n    $scope.fitBounds();\n  };\n\n  $scope.edit = function () {\n    if (!$scope.selected) return;\n\n    if (!a2UserPermit.can('manage project sites')) {\n      notify.error(\"You do not have permission to edit sites\");\n      return;\n    }\n\n    $scope.set_show('map');\n    $scope.temp = angular.copy($scope.selected);\n    $scope.temp.published = $scope.temp.published === 1;\n    Project.getProjectsList('my', function (data) {\n      $scope.projects = data.map(function (project) {\n        return {\n          project_id: project.project_id,\n          name: project.name,\n          url: project.url\n        };\n      });\n    });\n    Project.getInfo(function (data) {\n      $scope.temp.project = data;\n    });\n    $scope.editing = true; // rebuild map pins\n\n    $scope.deleteMarkers();\n    $scope.fitBounds();\n  };\n\n  $scope.onSelect = function ($item) {\n    $scope.temp.project = $item;\n  };\n\n  $scope.showAssetsCarousel = false;\n\n  $scope.showCarousel = function (id) {\n    $scope.images.forEach(function (image) {\n      image.active = image.id === id;\n    });\n    $scope.showAssetsCarousel = true;\n  };\n\n  $scope.capitalizeFirstLetter = function (string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n  };\n\n  $scope.sel = function (site) {\n    return $state.transitionTo($state.current.name, {\n      site: site && site.id,\n      show: $state.params.show\n    }, {\n      notify: false\n    }).then(function () {\n      $scope.images = [];\n      $scope.close();\n      $scope.selected = site;\n\n      if ($scope.selected && $scope.selected.external_id) {\n        a2Sites.getListOfAssets($scope.selected.external_id).then(function (data) {\n          $scope.assets = data;\n\n          if ($scope.assets && $scope.selected.external_id) {\n            $scope.assets = $scope.assets.filter(function (asset) {\n              return asset.meta !== null;\n            });\n\n            for (var i = 0; i < $scope.assets.length; i++) {\n              var src = '/legacy-api/project/' + $scope.project.url + '/streams/' + $scope.selected.external_id + '/assets/' + $scope.assets[i].id;\n              $scope.images.push({\n                id: i,\n                src: src,\n                active: i === 0,\n                label: $scope.assets[i] && $scope.assets[i].meta && $scope.assets[i].meta.label ? $scope.capitalizeFirstLetter($scope.assets[i].meta.label) : 'No label image'\n              });\n            }\n          }\n\n          ;\n        }).catch(function (err) {\n          console.log('\\nerr', err);\n        });\n      } // rebuild map pins\n\n\n      $scope.deleteMarkers();\n      $scope.fitBounds(); // zoom in to the selected pin\n\n      if ($scope.selected) {\n        a2GoogleMapsLoader.then(function (google) {\n          var position = new google.maps.LatLng($scope.selected.lat, $scope.selected.lon);\n          $scope.map.panTo(position);\n          $scope.map.setZoom(12);\n        });\n      }\n    });\n  };\n}).controller('ImportSiteInstanceCtrl', function ($scope, $modalInstance) {\n  $scope.files = [];\n\n  $scope.handler = function (e, files) {\n    var reader = new FileReader();\n\n    reader.onload = function (e) {\n      $modalInstance.close(reader.result);\n    };\n\n    reader.readAsText(files[0]);\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss();\n  };\n}).controller('SitesTokenGenaratorCtrl', function ($scope, a2Sites, $modal, notify) {\n  $scope.site = $scope.selected;\n  $scope.loading = {};\n\n  var confirmRevoke = function (title, btnOk) {\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.title = title;\n        this.messages = [\"This action will revoke the current token for the site <b>\" + $scope.site.name + \"</b>. \" + \"Are you sure you want to do this?\"];\n        this.btnOk = btnOk;\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    });\n    return modalInstance;\n  };\n\n  var genToken = function () {\n    a2Sites.generateToken($scope.site).success(function (data) {\n      $scope.loading.generate = false;\n      if (data.error) return notify.error(data.error);\n      $scope.site.token_created_on = new Date(data.created * 1000);\n      $scope.base64 = data.base64token;\n      $scope.token = {\n        type: data.type,\n        name: data.name,\n        created: data.created,\n        expires: data.expires,\n        token: data.token\n      };\n      notify.log(\"New site token generated.\");\n    }).error(function (data) {\n      $scope.loading.generate = false;\n      notify.serverError();\n    });\n  };\n\n  $scope.generateToken = function () {\n    $scope.loading.generate = true;\n\n    if ($scope.site.token_created_on) {\n      var modalInstance = confirmRevoke(\"<h4>Confirm revoke and generate token</h4>\", \"Yes, revoke and generate a new token\");\n      modalInstance.result.then(function ok() {\n        genToken();\n      }, function cancel() {\n        $scope.loading.generate = false;\n      });\n    } else {\n      genToken();\n    }\n  };\n\n  $scope.revokeToken = function () {\n    var modalInstance = confirmRevoke(\"<h4>Confirm revoke token</h4>\", \"Yes, revoke token\");\n    modalInstance.result.then(function () {\n      $scope.loading.revoke = true;\n      a2Sites.revokeToken($scope.site).success(function (data) {\n        $scope.loading.revoke = false;\n        $scope.site.token_created_on = null;\n        $scope.token = null;\n        notify.log(\"site token revoked.\");\n      }).error(function (data) {\n        $scope.loading.generate = false;\n        notify.serverError();\n      });\n    });\n  };\n}).controller('SiteStatusPlotterController', function ($scope, $q, a2Sites, $debounce, a2EventEmitter) {\n  function mk_time_range_fn(from, delta) {\n    return function () {\n      var fromdt = from == 'now' ? new Date() : new Date(from);\n      var todt = new Date(fromdt.getTime() + delta);\n\n      if (delta < 0) {\n        var t = fromdt;\n        fromdt = todt;\n        todt = t;\n      }\n\n      return [fromdt, todt];\n    };\n  }\n\n  function get_by_tag(arr, tag) {\n    return arr.filter(function (x) {\n      return x.tag == tag;\n    }).shift();\n  }\n\n  function make_setter(options) {\n    var attr = options.data;\n    var selattr = options.sel || attr;\n    var def = options.def;\n    return function set(value, dontRefreshLogs) {\n      if (typeof value == 'string') {\n        value = get_by_tag(this.data[attr], value);\n      }\n\n      if (!value) {\n        value = get_by_tag(this.data[attr], def);\n      }\n\n      this.selected[selattr] = value;\n\n      if (value.apply) {\n        value.apply(this);\n      }\n\n      return dontRefreshLogs ? $q.resolve() : this.refresh_logs();\n    };\n  }\n\n  var events = new a2EventEmitter();\n  this.on = events.on.bind(events);\n  this.off = events.off.bind(events);\n\n  this.itemGroup = function (item) {\n    return item.group;\n  };\n\n  this.data = {\n    series: [{\n      tag: 'status',\n      group: 'Site',\n      name: 'Battery Status',\n      icon: 'fa fa-fw fa-plug',\n      axis: {\n        y: {\n          tick: {\n            values: [0, 1, 2, 3],\n            format: function (x) {\n              return ['unknown', 'charging', 'not charging', 'full'][x | 0];\n            }\n          }\n        }\n      }\n    }, {\n      tag: 'voltage',\n      group: 'Site',\n      name: 'Voltage',\n      icon: 'fa fa-fw fa-bolt'\n    }, {\n      tag: 'power',\n      group: 'Site',\n      name: 'Power',\n      icon: 'fa fa-fw fa-battery-half'\n    }, {\n      tag: 'uploads',\n      group: 'Data',\n      name: 'Uploads',\n      icon: 'fa fa-fw fa-upload'\n    }, {\n      tag: 'recordings',\n      group: 'Data',\n      name: 'Recordings',\n      icon: 'fa fa-fw fa-volume-up'\n    }],\n    time_ranges: [{\n      tag: '1-hour',\n      text: 'Last Hour',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -3600 * 1000)\n    }, {\n      tag: '3-hour',\n      text: 'Last 3 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -3 * 3600 * 1000)\n    }, {\n      tag: '6-hour',\n      text: 'Last 6 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -6 * 3600 * 1000)\n    }, {\n      tag: '12-hour',\n      text: 'Last 12 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -12 * 3600 * 1000)\n    }, {\n      tag: '24-hour',\n      text: 'Last 24 Hours',\n      group: 'Hours',\n      range: mk_time_range_fn('now', -24 * 3600 * 1000)\n    }, {\n      tag: '3-days',\n      text: 'Last 3 Days',\n      group: 'Days',\n      range: mk_time_range_fn('now', -3 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-week',\n      text: 'Last Week',\n      group: 'Weeks',\n      range: mk_time_range_fn('now', -7 * 24 * 3600 * 1000)\n    }, {\n      tag: '2-weeks',\n      text: 'Last 2 Weeks',\n      group: 'Weeks',\n      range: mk_time_range_fn('now', -14 * 24 * 3600 * 1000)\n    }, {\n      tag: '1-month',\n      text: 'Last Month',\n      group: 'Month',\n      range: mk_time_range_fn('now', -31 * 24 * 3600 * 1000)\n    }],\n    periods: [{\n      tag: '1-minute',\n      text: '1 Minute',\n      group: 'Minutes',\n      sampling: '1 min',\n      granularity: 1 * 60 * 1000\n    }, {\n      tag: '5-minutes',\n      text: '5 Minutes',\n      group: 'Minutes',\n      sampling: '5 mins',\n      granularity: 5 * 60 * 1000\n    }, {\n      tag: '10-minutes',\n      text: '10 Minutes',\n      group: 'Minutes',\n      sampling: '10 mins',\n      granularity: 10 * 60 * 1000\n    }, {\n      tag: '30-minutes',\n      text: '30 Minutes',\n      group: 'Minutes',\n      sampling: '30 mins',\n      granularity: 30 * 60 * 1000\n    }, {\n      tag: '1-hour',\n      text: '1 Hour',\n      group: 'Hours',\n      sampling: '1 hour',\n      granularity: 1 * 60 * 60 * 1000\n    }, {\n      tag: '3-hours',\n      text: '3 Hours',\n      group: 'Hours',\n      sampling: '3 hours',\n      granularity: 3 * 60 * 60 * 1000\n    }, {\n      tag: '6-hours',\n      text: '6 Hours',\n      group: 'Hours',\n      sampling: '6 hours',\n      granularity: 6 * 60 * 60 * 1000\n    }, {\n      tag: '1-day',\n      text: '1 Day',\n      group: 'Days',\n      sampling: '1 day',\n      granularity: 24 * 60 * 60 * 1000\n    }] // min_date: 0,\n    // max_date: 10000,\n\n  };\n  this.loading = {};\n  this.selected = {\n    series: get_by_tag(this.data.series, 'power'),\n    time_range: get_by_tag(this.data.time_ranges, '1-week'),\n    period: get_by_tag(this.data.periods, '1-hour')\n  };\n  this.set_series = make_setter({\n    data: 'series',\n    sel: 'series',\n    def: 'power'\n  });\n  this.set_time_range = make_setter({\n    data: 'time_ranges',\n    sel: 'time_range',\n    def: '1-week'\n  });\n  this.set_period = make_setter({\n    data: 'periods',\n    sel: 'period',\n    def: '7-days'\n  });\n\n  this.activate = function (selected_site, plot_uri) {\n    this.selected.site = selected_site;\n\n    if (plot_uri) {\n      if (plot_uri.length) {\n        this.set_series(plot_uri.shift());\n      }\n\n      if (plot_uri.length) {\n        this.set_time_range(plot_uri.shift());\n      }\n\n      if (plot_uri.length) {\n        this.set_period(plot_uri.shift());\n      }\n    }\n\n    return this.refresh_logs();\n  };\n\n  this.load_data = function (site, series, range, period) {\n    var loading = this.loading;\n    loading.data = true;\n    return a2Sites.getSiteLogData(site.id, series.tag, range[0], range[1], period.sampling).then(function (data) {\n      loading.data = false;\n      data.x = 'datetime';\n      data.axis = series.axis;\n      data.empty = {\n        label: {\n          text: \"No data to show.\"\n        }\n      };\n      return data;\n    });\n  };\n\n  this.make_chart_struct = function (data) {\n    var axes = {\n      x: {\n        tick: {\n          format: function (x) {\n            return moment(new Date(x)).utc().format('MM-DD-YYYY HH:mm');\n          }\n        }\n      }\n    };\n\n    if (data.axis) {\n      angular.merge(axes, data.axis);\n      delete data.axis;\n    }\n\n    this.chart = {\n      data: data,\n      axes: axes\n    };\n  };\n\n  this.refresh_logs = $debounce(function () {\n    var d = $q.defer(),\n        promise = d.promise;\n    d.resolve();\n    var site = this.selected.site;\n    var series = this.selected.series;\n    var time_range = this.selected.time_range;\n    var period = this.selected.period;\n\n    if (site && series && time_range && period) {\n      var range = time_range.range();\n      var granularity = period.granularity;\n      promise = d.promise.then(function () {\n        if (series.data) {\n          if (series.data.site != site || series.data.period != period || !(series.data.range[0] - granularity >= range[0] && range[1] <= series.data.range[1] + granularity)) {\n            series.data = null;\n          }\n        }\n\n        if (!series.data) {\n          return this.load_data(site, series, range, period).then(function (data) {\n            series.data = {\n              data: data,\n              site: site,\n              range: range,\n              period: period\n            };\n            return series.data.data;\n          });\n        } else {\n          return series.data.data;\n        }\n      }.bind(this)).then(function (chart_data) {\n        console.log(\"chart_data : \", chart_data);\n\n        if (chart_data) {\n          this.make_chart_struct(chart_data);\n        }\n      }.bind(this)).then(function () {\n        events.emit('logs-refreshed', [series.tag, time_range.tag, period.tag]);\n      });\n    }\n\n    return promise;\n  }, 10);\n});","angular.module('a2.audiodata.soundscape-composition-classes', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.scAnnotationClasses', {\n    url: '/soundscape-annotation-classes',\n    controller: 'SoundscapeCompositionClassesScreenCtrl as controller',\n    templateUrl: '/app/audiodata/soundscape-composition-classes.html'\n  });\n}).controller('SoundscapeCompositionClassesScreenCtrl', function ($modal, notify, Project, a2SoundscapeCompositionService, a2UserPermit) {\n  this.initialize = function () {\n    this.loading = true;\n    this.newClass = {};\n    this.canManageClasses = a2UserPermit.can(\"manage project species\");\n    a2SoundscapeCompositionService.getClassList({\n      tally: 1,\n      groupByType: true,\n      isSystemClass: 1\n    }).then(function (classes) {\n      this.classes = classes;\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.addNewClass = function (groupType) {\n    var className = this.newClass[groupType.typeId];\n    delete this.newClass[groupType.typeId];\n\n    if (className) {\n      if (!a2UserPermit.can(\"manage project species\")) {\n        notify.error(\"You do not have permission to add soundscape composition classes\");\n        return;\n      }\n\n      a2SoundscapeCompositionService.addClass(className, groupType.typeId).then(function (newClass) {\n        groupType.list.push(newClass);\n      }.bind(this)).catch(function (err) {\n        notify.error(err.data || err.message);\n      });\n    }\n  };\n\n  this.removeClass = function (scClass) {\n    if (scClass.isSystemClass) {\n      return;\n    }\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove soundscape composition classes\");\n      return;\n    }\n\n    a2SoundscapeCompositionService.removeClass(scClass.id).then(function () {\n      this.classes.forEach(function (classGroup) {\n        var index = classGroup.list.indexOf(scClass);\n\n        if (index >= 0) {\n          classGroup.list.splice(index, 1);\n        }\n      });\n    }.bind(this)).catch(function (err) {\n      notify.error(err.data || err.message);\n    });\n  };\n\n  this.add = function () {\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to add species\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/select-species.html',\n      controller: 'SelectSoundscapeCompositionClassesScreenCtrl',\n      size: 'lg'\n    });\n    modalInstance.result.then(function (selected) {\n      var cls = {\n        species: selected.species.scientific_name,\n        songtype: selected.song.name\n      };\n      Project.addClass(cls).success(function (result) {\n        notify.log(selected.species.scientific_name + ' ' + selected.song.name + \" added to project\");\n        Project.getClasses(function (classes) {\n          this.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  this.del = function () {\n    if (!this.checked || !this.checked.length) return;\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove species\");\n      return;\n    }\n\n    var speciesClasses = this.checked.map(function (row) {\n      return '\"' + row.species_name + ' | ' + row.songtype_name + '\"';\n    });\n    var message = [\"You are about to delete the following project species: \"];\n    var message2 = [\"Are you sure?\"];\n    this.popup = {\n      messages: message.concat(speciesClasses, message2),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: this\n    });\n    modalInstance.result.then(function () {\n      var classesIds = this.checked.map(function (row) {\n        return row.id;\n      });\n      var params = {\n        project_classes: classesIds\n      };\n      Project.removeClasses(params).success(function (result) {\n        Project.getClasses(function (classes) {\n          this.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  this.initialize();\n});","angular.module('a2.audiodata.species', ['a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).controller('SpeciesCtrl', function ($scope, Project, $modal, notify, a2UserPermit) {\n  $scope.loading = true;\n  $scope.selected = {};\n  Project.getClasses(function (classes) {\n    $scope.classes = classes;\n    $scope.loading = false;\n  });\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n\n  $scope.add = function () {\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to add species\");\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/select-species.html',\n      controller: 'SelectSpeciesCtrl',\n      size: 'lg'\n    });\n    modalInstance.result.then(function (selected) {\n      var cls = {\n        species: selected.species.scientific_name,\n        songtype: selected.song.name\n      };\n      Project.addClass(cls).success(function (result) {\n        notify.log(selected.species.scientific_name + ' ' + selected.song.name + \" added to project\");\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.checked || !$scope.checked.length) return;\n\n    if (!a2UserPermit.can(\"manage project species\")) {\n      notify.error(\"You do not have permission to remove species\");\n      return;\n    }\n\n    var speciesClasses = $scope.checked.map(function (row) {\n      return '\"' + row.species_name + ' | ' + row.songtype_name + '\"';\n    });\n    var message = [\"Are you sure you would like to remove the following species call from this project?\"];\n    var message2 = [\"Note: validations for this species call will also be removed from this project.\"];\n    $scope.popup = {\n      messages: message.concat(message2, speciesClasses),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      var classesIds = $scope.checked.map(function (row) {\n        return row.id;\n      });\n      var params = {\n        project_classes: classesIds\n      };\n      Project.removeClasses(params).success(function (result) {\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n        });\n      }).error(function (data, status) {\n        if (status < 500) notify.error(data.error);else notify.serverError();\n      });\n    });\n  };\n}).controller('SelectSpeciesCtrl', function ($scope, Species, Songtypes) {\n  var timeout;\n  Songtypes.get(function (songs) {\n    $scope.songtypes = songs;\n  });\n\n  $scope.searchSpecies = function () {\n    if ($scope.search === \"\") {\n      $scope.species = [];\n      return;\n    }\n\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      Species.search($scope.search, function (results) {\n        $scope.species = results;\n      });\n    }, 500);\n  };\n});","angular.module('a2.audiodata.training-sets', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.visualizer.layers.training-sets', 'humane']).factory('a2TrainingSetHistory', function () {\n  var lastSet, lastPage, lastRoi, lastRoiSet, viewState, lastSpecie, lastSongtype;\n  return {\n    getLastSet: function (callback) {\n      callback({\n        ls: lastSet,\n        lp: lastPage,\n        lr: lastRoi,\n        lrs: lastRoiSet,\n        vs: viewState,\n        sp: lastSpecie,\n        sg: lastSongtype\n      });\n    },\n    setLastSet: function (val) {\n      lastSet = val;\n    },\n    setLastPage: function (val) {\n      lastPage = val;\n    },\n    setLastRoi: function (val) {\n      lastRoi = val;\n    },\n    setLastRoiSet: function (val) {\n      lastRoiSet = val;\n    },\n    setViewState: function (val) {\n      viewState = val;\n    },\n    setLastSpecies: function (valsp, valsg) {\n      lastSpecie = valsp;\n      lastSongtype = valsg;\n    }\n  };\n}).controller('TrainingSetsCtrl', function ($state, a2TrainingSets, Project, $q, $modal, a2TrainingSetHistory, a2UserPermit, notify) {\n  var p = {\n    set: $state.params.set,\n    show: $state.params.show\n  };\n  this.selected = {\n    roi_index: 0,\n    roi: null,\n    page: 0\n  };\n  this.total = {\n    rois: 0,\n    pages: 0\n  };\n  this.loading = {\n    list: false,\n    details: false\n  };\n  this.rois = [];\n  this.species = '';\n  this.songtype = '';\n  this.detailedView = p.show != \"gallery\";\n  this.currentrois = [];\n  this.roisPerpage = 100;\n  this.detailedView = false;\n  this.loaderDisplay = false;\n\n  this.getROIVisualizerUrl = function (roi) {\n    return roi ? \"/project/\" + this.projecturl + \"/#/visualizer/rec/\" + roi.recording : '';\n  };\n\n  this.setROI = function (roi_index) {\n    if (this.total.rois <= 0) {\n      this.selected.roi_index = 0;\n      this.selected.roi = null;\n    } else {\n      this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n      this.selected.roi = this.rois[this.selected.roi_index];\n    }\n\n    a2TrainingSetHistory.setLastRoi(this.selected.roi);\n    return this.selected.roi;\n  };\n\n  this.setPage = function (page) {\n    if (this.total.rois <= 0) {\n      this.selected.page = 0;\n      this.selected.currentrois = [];\n    } else {\n      this.selected.page = Math.max(0, Math.min(page, this.total.rois / this.roisPerpage | 0));\n      this.currentrois = this.rois.slice(this.selected.page * this.roisPerpage, (this.selected.page + 1) * this.roisPerpage);\n    }\n\n    a2TrainingSetHistory.setLastPage(this.selected.page);\n    return this.currentrois;\n  };\n\n  this.setROISet = function (rois) {\n    this.rois = rois;\n    a2TrainingSetHistory.setLastRoiSet(this.rois);\n  };\n\n  this.nextROI = function (step) {\n    return this.setROI(this.selected.roi_index + (step || 1));\n  };\n\n  this.prevROI = function (step) {\n    return this.setROI(this.selected.roi_index - (step || 1));\n  };\n\n  this.nextPage = function (step) {\n    return this.setPage(this.selected.page + (step || 1));\n  };\n\n  this.prevPage = function (step) {\n    return this.setPage(this.selected.page - (step || 1));\n  };\n\n  this.next = function (step) {\n    if (!step) {\n      step = 1;\n    }\n\n    if (this.detailedView) {\n      this.nextROI(step);\n    } else {\n      this.nextPage(step);\n    }\n  };\n\n  this.prev = function (step) {\n    if (!step) {\n      step = 1;\n    }\n\n    return this.next(-step);\n  };\n\n  this.removeRoi = function (roiId) {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"You are about to delete a ROI. Are you sure?\"];\n        this.btnOk = \"Yes, do it!\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    });\n    modalInstance.result.then(function () {\n      a2TrainingSets.removeRoi(this.selected.trainingSet.id, roiId, function (data) {\n        if (data.affectedRows) {\n          for (var i = 0; i < this.rois.length; i++) {\n            if (this.rois[i].id == roiId) {\n              this.rois.splice(i, 1);\n              break;\n            }\n          }\n\n          this.total.rois = this.rois.length;\n          this.setROI(this.selected.roi_index);\n          this.setPage(this.selected.page);\n        }\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.closeSetDetails = function () {\n    this.showSetDetails = false;\n  };\n\n  this.getTrainingSetList = function () {\n    this.loading.list = true;\n    return a2TrainingSets.getList(function (data) {\n      this.trainingSets = data.map(function (d) {\n        d.date_created = new Date(d.date_created);\n        return d;\n      });\n\n      if (p.set) {\n        var selected = this.trainingSets.filter(function (tset) {\n          return tset.id == p.set;\n        }).pop();\n\n        if (selected) {\n          this.selectTrainingSet(selected);\n        }\n      }\n\n      this.loading.list = false;\n    }.bind(this));\n  };\n\n  this.addNewTrainingSet = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to create training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/training-data/add_tset_modal.html',\n      controller: 'a2VisualizerAddTrainingSetModalController'\n    }).result.then(this.getTrainingSetList.bind(this));\n  };\n\n  this.selectTrainingSet = function (selected) {\n    $state.transitionTo($state.current.name, {\n      set: selected.id,\n      show: $state.params.show\n    }, {\n      notify: false\n    });\n    this.detailedView = $state.params.show != \"gallery\";\n    this.loaderDisplay = true;\n    a2TrainingSetHistory.setLastSet(selected);\n\n    if (this.selected.trainingSet) {\n      if (this.selected.trainingSet.edit) {\n        delete this.selected.trainingSet.edit;\n      }\n    }\n\n    this.selected.trainingSet = selected;\n    Project.validationBySpeciesSong(selected.species, selected.songtype, function (data) {\n      this.selected.trainingSet.validations = data;\n    }.bind(this));\n    a2TrainingSets.getSpecies(selected.id, function (speciesData) {\n      this.species = speciesData.species;\n      this.songtype = speciesData.songtype;\n      a2TrainingSetHistory.setLastSpecies(this.species, this.songtype);\n      a2TrainingSets.getRois(selected.id, function (data) {\n        this.loaderDisplay = false;\n        this.detailedView = false;\n        this.total.rois = data.length;\n        this.total.pages = Math.ceil(this.total.rois / this.roisPerpage);\n        this.setROISet(data);\n        this.setROI(0);\n        this.setPage(0);\n        this.selected.page = 0;\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.setupExportUrl = function () {\n    this.selected.trainingSet.export_url = a2TrainingSets.getExportUrl(this.selected.trainingSet.id);\n  };\n\n  this.exportTSReport = function ($event) {\n    $event.stopPropagation();\n    if (a2UserPermit.isSuper()) return this.setupExportUrl();\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export Training Set data');\n    } else return this.setupExportUrl();\n  };\n\n  this.setDetailedView = function (detailedView) {\n    $state.transitionTo($state.current.name, {\n      set: $state.params.set,\n      show: detailedView ? \"detail\" : \"gallery\"\n    }, {\n      notify: false\n    });\n    this.detailedView = detailedView;\n    a2TrainingSetHistory.setViewState(this.detailedView);\n  };\n\n  this.editSelectedTrainingSet = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    if (this.selected.trainingSet) {\n      var trainingSet = this.selected.trainingSet;\n      var speciesClass = {\n        species: trainingSet.species,\n        songtype: trainingSet.songtype\n      };\n      speciesClass.species_name = this.species;\n      speciesClass.songtype_name = this.songtype;\n      Project.getClasses().then(function (classes) {\n        var d = $q.defer();\n        var current = classes.filter(function (cls) {\n          return speciesClass.species == cls.species && speciesClass.songtype == cls.songtype;\n        }).pop() || speciesClass;\n        trainingSet.edit = {\n          name: trainingSet.name,\n          class: current,\n          projectClasses: classes\n        };\n        trainingSet.edit.cancel = d.reject.bind(d);\n\n        trainingSet.edit.save = function () {\n          return a2TrainingSets.edit(trainingSet.id, {\n            name: trainingSet.edit.name,\n            class: trainingSet.edit.class.id\n          }).then(function (response) {\n            d.resolve(response.data);\n          }, function (response) {\n            notify.log(response.data);\n          });\n        };\n\n        return d.promise;\n      }).then(function (editedTrainingSet) {\n        for (var i in editedTrainingSet) {\n          trainingSet[i] = editedTrainingSet[i];\n        }\n\n        this.selectTrainingSet(trainingSet);\n      }.bind(this)).finally(function () {\n        delete trainingSet.edit;\n      });\n    }\n  };\n\n  this.deleteSelectedTrainingSet = function () {\n    var trainingSet = this.selected.trainingSet;\n\n    if (!trainingSet) {\n      return;\n    }\n\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to edit training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = [\"You are about to delete a the training set \\\"\" + trainingSet.name + \"\\\". Are you sure?\"];\n        this.btnOk = \"Yes, do it!\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      a2TrainingSets.delete(trainingSet.id, function (data) {\n        this.trainingSets.splice(this.trainingSets.indexOf(trainingSet), 1);\n        delete this.selected.trainingSet;\n      }.bind(this));\n    }.bind(this));\n  };\n\n  this.getTrainingSetList();\n  this.projecturl = Project.getUrl();\n  a2TrainingSetHistory.getLastSet(function (data) {\n    if (data.ls) {\n      this.showSetDetails = true;\n      this.selected.trainingSet = data.ls;\n      this.species = data.sp;\n      this.songtype = data.sg;\n      this.detailedView = data.vs;\n      this.total.rois = data.lrs.length;\n      this.total.pages = Math.ceil(this.total.rois / this.roisPerpage);\n      this.selected.page = data.lp;\n      this.setROISet(data.lrs);\n      this.setPage(data.lp);\n      this.setROI(data.lr || 0);\n    }\n  }.bind(this));\n});","angular.module('a2.citizen-scientist', ['a2.citizen-scientist.my-stats', 'a2.directive.audio-bar', 'a2.citizen-scientist.patternmatching', 'a2.citizen-scientist.expert', 'a2.citizen-scientist.admin', 'ui.router', 'ct.ui.router.extras']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/citizen-scientist\", \"/citizen-scientist/patternmatching/\");\n  $stateProvider.state('citizen-scientist', {\n    url: '/citizen-scientist',\n    views: {\n      'citizen-scientist': {\n        templateUrl: '/app/citizen-scientist/index.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  });\n});","angular.module('a2.app.dashboard', ['a2.services', 'a2.directives', 'ui.bootstrap', 'ui.router', 'ct.ui.router.extras', 'a2.forms', 'humane', 'a2.googlemaps', 'a2.directive.warning-banner']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('dashboard', {\n    url: '/dashboard',\n    controller: 'SummaryCtrl',\n    templateUrl: '/app/dashboard/index.html'\n  });\n}).controller('SummaryCtrl', function ($scope, Project, a2Templates, a2GoogleMapsLoader, $timeout, $window, $compile, $templateFetch, a2PatternMatching) {\n  $scope.loading = 5;\n\n  var done = function () {\n    if ($scope.loading > 0) --$scope.loading;\n  };\n\n  Project.getInfo(function (info) {\n    $scope.project = info;\n    $scope.isSpeciesLoading = true;\n    Project.getProjectTotalSpecies(info.project_id, function (data) {\n      $scope.speciesQty = data || 0;\n      $scope.isSpeciesLoading = false;\n    });\n    done();\n  });\n  Project.getSites(function (sites) {\n    $scope.sites = sites;\n    done();\n    $timeout(function () {\n      a2GoogleMapsLoader.then(function (google) {\n        $scope.map = new google.maps.Map($window.document.getElementById('summary-map'), {\n          center: {\n            lat: 0,\n            lng: 0\n          },\n          mapTypeId: google.maps.MapTypeId.SATELLITE,\n          zoom: 8,\n          minZoom: 2\n        });\n        var bounds = new google.maps.LatLngBounds();\n        angular.forEach($scope.sites, function (site) {\n          if (site.lat > 85 || site.lat < -85 || site.lon > 180 || site.lon < -180) {\n            return;\n          }\n\n          var position = new google.maps.LatLng(site.lat, site.lon);\n          var marker = new google.maps.Marker({\n            position: position,\n            title: site.name\n          });\n          bounds.extend(position);\n          marker.setMap($scope.map);\n          $scope.map.fitBounds(bounds);\n        });\n      });\n    }, 100);\n  });\n  Project.getRecTotalQty(function (data) {\n    $scope.recsQty = data;\n    done();\n  });\n  a2Templates.getList().then(function (data) {\n    $scope.templateQty = data.length;\n    done();\n  });\n  a2PatternMatching.getPatternMatchingsTotal(function (data) {\n    $scope.pmQty = data;\n    done();\n  });\n});","angular.module('a2.jobs', ['a2.services', 'a2.permissions']).config(function ($stateProvider) {\n  $stateProvider.state('jobs', {\n    url: '/jobs',\n    controller: 'StatusBarNavController',\n    templateUrl: '/app/jobs/index.html'\n  });\n}).controller('StatusBarNavController', function ($scope, $http, $modal, $window, Project, JobsData, notify, a2UserPermit) {\n  $scope.show = {};\n  $scope.showClassifications = true;\n  $scope.showTrainings = true;\n  $scope.showSoundscapes = true;\n  $scope.url = '';\n  $scope.successInfo = \"\";\n  $scope.showSuccesss = false;\n  $scope.errorInfo = \"\";\n  $scope.showErrors = false;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = {\n    jobs: false\n  };\n  $scope.loading.jobs = true;\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n  };\n\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n\n  var hideJob = function (jobId, action) {\n    $http.get('/legacy-api/project/' + Project.getUrl() + '/jobs/hide/' + jobId).success(function (data) {\n      JobsData.updateJobs();\n      const message = 'Job ' + action + ' successfully.';\n      notify.log(message);\n    }).error(function (data) {\n      if (data.error) {\n        notify.error(error);\n      } else {\n        notify.serverError();\n      }\n    });\n  };\n\n  JobsData.getJobTypes().success(function (data) {\n    var colors = ['#1482f8', '#df3627', '#40af3b', '#9f51bf', '#d37528', '#ffff00', '#5bc0de'];\n    var job_types_id = [1, 2, 4, 6, 7, 8, 9];\n    var job_types = data.filter(function (type) {\n      return job_types_id.includes(type.id);\n    });\n    $scope.job_types = {};\n    $scope.job_types.types = job_types;\n    $scope.job_types.show = {};\n    $scope.job_types.for = {};\n    $scope.job_types.types.forEach(function (c, i) {\n      $scope.show[c.id] = true;\n      $scope.job_types.for[c.id] = c;\n      c.color = colors[i % colors.length];\n    });\n  });\n  $scope.$watch(function () {\n    return JobsData.getJobs();\n  }, function (new_jobs) {\n    $scope.jobs = new_jobs;\n    $scope.loading.jobs = false;\n    JobsData.startTimer();\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n  }, true);\n  $scope.$on('$destroy', function () {\n    JobsData.cancelTimer();\n  });\n\n  $scope.showActiveJobs = function () {\n    return !$scope.loading.jobs && $scope.jobs !== undefined && $scope.jobs.length;\n  };\n\n  $scope.showEmptyList = function () {\n    return !$scope.loading.jobs && $scope.jobs !== undefined && !$scope.jobs.length;\n  };\n\n  $scope.showLoader = function () {\n    return $scope.jobs === undefined;\n  };\n\n  var confirm = function (titlen, action, cb, vl, message) {\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.title = titlen + ' running job';\n        this.messages = [\"This job has not finished yet. Are you sure?\"];\n        this.btnOk = \"Yes, \" + action + \" it\";\n        this.btnCancel = \"No\";\n      },\n      controllerAs: \"popup\"\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n    });\n    modalInstance.result.then(function (ok) {\n      cb(vl, message);\n    });\n  };\n\n  $scope.hide = function (job) {\n    if (!a2UserPermit.can('manage project jobs')) {\n      notify.error('You do not have permission to hide or cancel jobs');\n      return;\n    }\n\n    const jobId = job.job_id;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n\n    if (job.percentage < 100) {\n      confirm('Cancel', 'cancel', hideJob, jobId, 'canceled');\n    } else {\n      hideJob(jobId, 'hidden');\n    }\n  };\n\n  $scope.isCompleted = function (row) {\n    return row.state === 'completed';\n  };\n\n  $scope.isProcessing = function (row) {\n    return row.state === 'processing';\n  };\n\n  $scope.isWaiting = function (row) {\n    return row.state === 'waiting';\n  };\n\n  $scope.openJob = function (row) {\n    $window.location.href = '/project/' + Project.getUrl() + '/analysis/' + row.url;\n  };\n}).service('JobsData', function ($http, $interval, Project, $q) {\n  var jobs;\n  var url = Project.getUrl();\n  var intervalPromise;\n  var isProcessing = false;\n\n  updateJobs = function () {\n    if (isProcessing) return;\n    isProcessing = true;\n    $http.get('/legacy-api/project/' + url + '/jobs/progress', {\n      params: {\n        last3Months: true\n      }\n    }).success(function (data) {\n      data.forEach(function (item) {\n        if (item.job_type_id === 1 && item.completed === 0 && item.state === 'error') {\n          item.state = 'error: insufficient validations';\n        }\n\n        if (item.job_type_id === 2 && item.completed === 0 && item.state === 'completed') {\n          item.state = 'processing';\n        }\n      });\n      jobs = data;\n      isProcessing = false;\n    });\n  };\n\n  updateJobs();\n  return {\n    geturl: function () {\n      return url;\n    },\n    getJobs: function () {\n      return jobs;\n    },\n    getJobTypes: function () {\n      return $http.get('/legacy-api/jobs/types');\n    },\n    updateJobs: function () {\n      return updateJobs();\n    },\n    startTimer: function () {\n      $interval.cancel(intervalPromise);\n\n      if (typeof jobs != 'undefined' && jobs.length > 0) {\n        intervalPromise = $interval(function () {\n          var cancelInterval = true;\n\n          for (var i = 0; i < jobs.length; i++) {\n            if (jobs[i].percentage < 100) {\n              cancelInterval = false;\n              break;\n            }\n          }\n\n          if (cancelInterval) {\n            $interval.cancel(intervalPromise);\n          } else if (jobs.length < 1) {\n            $interval.cancel(intervalPromise);\n          } else {\n            updateJobs();\n          }\n        }, 10000);\n      }\n    },\n    cancelTimer: function () {\n      $interval.cancel(intervalPromise);\n    }\n  };\n});","angular.module('a2.settings', ['a2.services', 'a2.directives', 'a2.forms', 'a2.orders', 'a2.permissions', 'a2.directive.sidenav-bar', 'ui.bootstrap', 'ui.router', 'ct.ui.router.extras', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.when(\"/settings\", \"/settings/details\");\n\n  var accessCheck = function (a2UserPermit) {\n    return a2UserPermit.can(\"manage project settings\");\n  };\n\n  $stateProvider.state('settings', {\n    url: '/settings',\n    templateUrl: '/app/settings/index.html',\n    allowAccess: accessCheck\n  }).state('settings.details', {\n    url: '/details',\n    controller: 'SettingsDetailsCtrl',\n    templateUrl: '/app/settings/details.html',\n    allowAccess: accessCheck\n  }).state('settings.users', {\n    url: '/users',\n    controller: 'SettingsUsersCtrl',\n    templateUrl: '/app/settings/users.html',\n    allowAccess: accessCheck\n  });\n}).controller('SettingsDetailsCtrl', function ($scope, Project, notify, $window, $timeout, a2order, a2UserPermit, $modal) {\n  $scope.today = new Date();\n  Project.getInfo(function (info) {\n    if (info.plan_activated && info.plan_period) {\n      info.plan_due = new Date(info.plan_activated);\n      info.plan_due.setFullYear(info.plan_due.getFullYear() + info.plan_period);\n    }\n\n    $scope.project = info;\n  });\n  Project.getUsage().success(function (usage) {\n    $scope.minUsage = usage.min_usage;\n  });\n\n  $scope.save = function () {\n    console.log($scope);\n    if (!$scope.isValid) return;\n\n    if (!$scope.project.description) {\n      $scope.project.description = '';\n    }\n\n    Project.updateInfo({\n      project: $scope.project\n    }, function (err, result) {\n      if (err) {\n        return notify.serverError();\n      }\n\n      if (result.error) {\n        return notify.error(result.error);\n      }\n\n      notify.log('Project info updated');\n\n      if (result.url) {\n        $timeout(function () {\n          $window.location.assign('/project/' + result.url + '/#/settings');\n        }, 1000);\n      }\n    });\n  };\n\n  $scope.deleteProject = function () {\n    if (!a2UserPermit.can('delete project')) {\n      notify.error('You do not have permission to delete this project');\n      return;\n    }\n\n    $scope.popup = {\n      title: 'Delete project',\n      messages: ['Are you sure you want to delete this project?'],\n      btnOk: 'Yes',\n      btnCancel: 'No'\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      return Project.removeProject({\n        external_id: $scope.project.external_id\n      }).then(function () {\n        notify.log('Project deleted');\n        $window.location.href = '/projects';\n      });\n    });\n  };\n\n  $scope.changePlan = function () {\n    var modalInstance = a2order.changePlan({});\n  };\n}).controller('SettingsUsersCtrl', function ($scope, $http, Project, $modal, notify) {\n  $scope.userToAdd = '';\n  $scope.curQuery = '';\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  Project.getUsers(function (err, users) {\n    $scope.users = users;\n  });\n  Project.getRoles(function (err, roles) {\n    $scope.roles = roles;\n  });\n\n  $scope.findUser = function (query) {\n    $scope.curQuery = query;\n    return $http.get('/legacy-api/user/search/' + query).then(function (response) {\n      return response.data;\n    });\n  };\n\n  $scope.inviteUser = function (data) {\n    return $http.post('/legacy-api/user/invite', data).then(function (response) {\n      return response.data;\n    });\n  };\n\n  $scope.add = function () {\n    if (!$scope.userToAdd) {\n      return;\n    }\n\n    Project.addUser({\n      project_id: $scope.project.project_id,\n      user_id: $scope.userToAdd.id,\n      user_email: $scope.userToAdd.email\n    }, function (err) {\n      if (err) {\n        notify.error(err);\n      } else {\n        $scope.curQuery = '';\n        notify.log('User added to project');\n      }\n\n      Project.getUsers(function (err, users) {\n        $scope.users = users;\n      });\n    });\n  };\n\n  $scope.invite = function () {\n    $scope.showInvitationPopup($scope.curQuery);\n  };\n\n  $scope.showInvitationPopup = function (email) {\n    var modalInstance = $modal.open({\n      templateUrl: '/app/settings/invitation.html',\n      controller: 'UserInvitationCtrl as controller',\n      resolve: {\n        email: function () {\n          return email;\n        },\n        inviteUser: function () {\n          return $scope.inviteUser;\n        }\n      }\n    });\n    modalInstance.result.then(function (user) {\n      $scope.noResults = false;\n      $scope.userToAdd = user;\n      $scope.userToAdd.id = user.user_id;\n      $scope.add();\n    });\n  };\n\n  $scope.changeRole = function ($index) {\n    var role = $scope.roles.filter(function (value) {\n      return $scope.users[$index].rolename === value.name;\n    })[0];\n    Project.changeUserRole({\n      project_id: $scope.project.project_id,\n      user_id: $scope.users[$index].id,\n      user_email: $scope.users[$index].email,\n      role_id: role.id\n    }, function (err) {\n      if (err) {\n        notify.error(err);\n      } else {\n        notify.log('User role updated');\n      }\n\n      Project.getUsers(function (err, users) {\n        $scope.users = users;\n      });\n    });\n  };\n\n  const message = ['Are you sure you would like to remove the following user from this project?'];\n\n  $scope.del = function ($index) {\n    const user = $scope.users[$index];\n    $scope.popup = {\n      messages: message.concat(user.firstname + ' ' + user.lastname + ' ' + '(' + user.email + ')'),\n      btnOk: \"Yes, do it!\",\n      btnCancel: \"No\"\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      Project.removeUser({\n        project_id: $scope.project.project_id,\n        user_id: $scope.users[$index].id,\n        user_email: $scope.users[$index].email\n      }, function (err) {\n        if (err) {\n          notify.error(err);\n        } else {\n          notify.log('User deleted from project');\n        }\n\n        Project.getUsers(function (err, users) {\n          $scope.users = users;\n        });\n      });\n    });\n  };\n}).controller('UserInvitationCtrl', function ($modalInstance, notify, email, inviteUser) {\n  Object.assign(this, {\n    initialize: function () {\n      this.isLoading = false;\n      this.data = {\n        email: email,\n        firstname: '',\n        lastname: ''\n      };\n    },\n    submit: function () {\n      var _this = this;\n\n      try {\n        this.isLoading = true;\n        return inviteUser(this.data).then(function (user) {\n          $modalInstance.close(user);\n        }).catch(notify.serverError).finally(function () {\n          _this.isLoading = false;\n        });\n      } catch (error) {\n        console.error('UserInvitationCtrl.submit error: ', error);\n      }\n    },\n    cancel: function () {\n      $modalInstance.close(null);\n    },\n    isDataValid: function () {\n      return this.data.email.trim().length > 0 && this.data.firstname.trim().length > 0 && this.data.lastname.trim().length > 0;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.visualizer.audio-player', []).service('a2AudioPlayer', function (A2AudioObject, $q, notify, a2Playlists, Project, $localStorage, a2UserPermit) {\n  'use strict';\n\n  var a2AudioPlayer = function (scope, options) {\n    this.scope = scope;\n    this.gain = 1;\n    this.gain_levels = [1, 2, 5, 10, 15, 20, 25, 30, 50];\n    this.freq_filter = undefined;\n    this.is_playing = false;\n    this.is_muted = false;\n    this.has_recording = false;\n    this.has_next_recording = false;\n    this.has_prev_recording = false;\n    this.resource = null;\n    this.resource_params = {};\n    this.isPopupOpened = false;\n    this.isSavingPlaylist = false;\n    this.playlistData = {};\n    this.clustersData = null;\n\n    if (options) {\n      if (options.gain) {\n        this.gain = Math.min(Math.max(1, (options && options.gain) | 0), this.gain_levels[this.gain_levels.length - 1]);\n        this.resource_params.gain = this.gain;\n      }\n\n      if (options.filter) {\n        var f = options.filter.split('-');\n        var f0 = f.shift() | 0,\n            f1 = f.shift() | 0;\n        var fmin = Math.min(f0, f1),\n            fmax = Math.max(f0, f1);\n\n        if (fmax) {\n          this.freq_filter = {\n            min: fmin,\n            max: fmax\n          };\n          this.resource_params.maxFreq = fmax;\n          this.resource_params.minFreq = fmin;\n        }\n      }\n    }\n\n    scope.$on('$destroy', this.discard.bind(this));\n  };\n\n  a2AudioPlayer.prototype = {\n    setFrequencyFilter: function (freq_filter) {\n      if (freq_filter) {\n        this.resource_params.maxFreq = freq_filter.max;\n        this.resource_params.minFreq = freq_filter.min;\n      } else {\n        delete this.resource_params.maxFreq;\n        delete this.resource_params.minFreq;\n      }\n\n      return this.load(this.resource_url).then(function () {\n        this.freq_filter = freq_filter;\n      }.bind(this)); // this.resource.setFrequencyFilter(filter).then((function(){\n      //     this.freq_filter = filter;\n      // }).bind(this));\n    },\n    setGain: function (gain) {\n      gain = Math.max(1, gain | 0);\n\n      if (gain != 1) {\n        this.resource_params.gain = gain;\n      } else {\n        delete this.resource_params.gain;\n      }\n\n      return (this.resource_url ? this.load(this.resource_url) : $q.resolve()).then(function () {\n        this.gain = gain;\n      }.bind(this)); // this.resource.setGain(gain).then((function(){\n      //     this.gain = gain;\n      // }).bind(this));\n    },\n    getVolume: function () {\n      return this.resource && this.resource.audio.volume;\n    },\n    setCurrentTime: function (time) {\n      if (this.resource) {\n        this.resource.setCurrentTime(time);\n      }\n    },\n    getCurrentTime: function () {\n      return this.resource && this.resource.audio && this.resource.audio.currentTime;\n    },\n    togglePopup: function () {\n      this.isPopupOpened = !this.isPopupOpened;\n    },\n    isPlaylistDataValid: function () {\n      return this.playlistData.playlistName && this.playlistData.playlistName.trim().length > 0;\n    },\n    closePopup: function () {\n      this.isPopupOpened = false;\n    },\n    savePlaylist: function () {\n      this.isSavingPlaylist = true; // create playlist\n\n      if (this.clustersData && this.clustersData.playlist) {\n        var self = this;\n        a2Playlists.create({\n          playlist_name: this.playlistData.playlistName,\n          params: this.clustersData.playlist.recordings,\n          aedIdsIncluded: true\n        }, function (data) {\n          self.isSavingPlaylist = false;\n          self.closePopup(); // attach aed to playlist\n\n          if (data && data.playlist_id) {\n            a2Playlists.attachAedToPlaylist({\n              playlist_id: data.playlist_id,\n              aed: self.clustersData.aed\n            }, function (data) {\n              self.playlistData = {};\n              notify.log('Audio event detections are saved in the playlist.');\n            });\n          }\n        });\n      }\n    },\n    _load_resource: function (url, params) {\n      this.loading = true;\n\n      if (params) {\n        var pk = Object.keys(params);\n\n        if (pk.length) {\n          var ch = /\\?/.test(url) ? '&' : '?';\n          url += ch + pk.map(function (k) {\n            return k + '=' + params[k];\n          }).join('&');\n        }\n      }\n\n      var resource = new A2AudioObject(url);\n      resource.onCompleteListeners.push(function () {\n        this.is_playing = false;\n      }.bind(this));\n      return resource.load_promise.then(function () {\n        this.loading = false;\n      }.bind(this)).then(function () {\n        return resource;\n      });\n    },\n    load: function (url) {\n      this.discard();\n      this.resource = undefined;\n      return this._load_resource(url, this.resource_params).then(function (resource) {\n        this.resource = resource;\n        this.duration = resource.duration;\n        this.resource_url = url;\n        this.has_recording = true;\n        this.clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n        console.log('clustersData', this.clustersData);\n      }.bind(this));\n    },\n    discard: function () {\n      this.stop();\n\n      if (this.resource) {\n        this.resource.discard();\n      }\n\n      this.has_recording = false;\n      this.resource = undefined;\n      this.resource_url = undefined;\n    },\n    mute: function (muted) {\n      if (this.resource) {\n        this.resource[muted ? 'mute' : 'unmute']();\n      }\n\n      this.is_muted = muted;\n    },\n    play: function () {\n      if (this.resource) {\n        this.resource.play();\n        this.is_playing = true;\n      }\n    },\n    pause: function () {\n      if (this.resource) {\n        this.resource.pause();\n      }\n\n      this.is_playing = false;\n    },\n    stop: function () {\n      if (this.resource) {\n        this.resource.stop();\n      }\n\n      this.is_playing = false;\n    },\n    prev_recording: function () {\n      this.scope.$broadcast('prev-visobject');\n    },\n    next_recording: function () {\n      this.scope.$broadcast('next-visobject');\n    },\n    download: function (visobject) {\n      if (a2UserPermit.isSuper()) return this.getExportUrl(visobject);\n\n      if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n        return notify.error('You do not have permission to download recording');\n      }\n\n      return this.getExportUrl(visobject);\n    },\n    getExportUrl: function (visobject) {\n      const form = document.createElement('form');\n      form.style.display = 'none';\n      form.method = 'GET';\n      const url = '/legacy-api/project/' + Project.getUrl() + '/recordings/download/' + visobject.id;\n      form.action = url;\n      document.body.appendChild(form);\n      form.submit();\n      document.body.removeChild(form);\n    }\n  };\n  return a2AudioPlayer;\n}).factory('A2AudioObject', ['$window', '$interval', '$q', function ($window, $interval, $q) {\n  var poll_loop_interval = 50; // 25;\n  // var AudioContext = $window.AudioContext || $window.webkitAudioContext;\n\n  function loadAudio(url) {\n    var deferred = $q.defer();\n    var audio = new $window.Audio();\n    url = url.replace('|', '/');\n    audio.addEventListener('error', function (err) {\n      console.log('err', err);\n      deferred.reject();\n    });\n    audio.addEventListener('loadstart', function () {\n      deferred.resolve(audio);\n    }); // bugfix for chrome...\n\n    $window.setTimeout(function () {\n      audio.src = url;\n    }, 1);\n    return deferred.promise;\n  }\n\n  var A2AudioObject = function (url) {\n    var d = $q.defer();\n    this.url = url;\n    this.onCompleteListeners = [];\n    this.interval = $interval(this._check_current_time.bind(this), poll_loop_interval);\n    this.load_promise = loadAudio(url).then(function (nativeAudio) {\n      this.audio = nativeAudio;\n      this.audio.addEventListener('canplay', function () {\n        this.duration = this.audio.duration;\n        this.paused = this.audio.paused;\n        this.src = this.audio.src;\n        this.canPlay = true;\n      }.bind(this));\n      this.audio.addEventListener('error', function (err) {\n        this.canPlay = false;\n        console.log(err);\n      }.bind(this));\n    }.bind(this), function (error) {\n      this.error = true;\n      console.log('Unable to listen to your recordings due to corrupted data');\n    }.bind(this));\n  };\n\n  A2AudioObject.prototype = {\n    // disconnect_ctx: function(){\n    //     return this.context.suspend().then((function(){\n    //         if(this.ctx_filter){\n    //             this.ctx_filter.max.disconnect();\n    //             this.ctx_filter.min.disconnect();\n    //         }\n    //         if(this.ctx_gain){\n    //             this.ctx_gain.disconnect();\n    //         }\n    //         this.ctx_source.disconnect();\n    //         return this.context.resume();\n    //     }).bind(this));\n    // },\n    // setup_ctx_connections: function(){\n    //     return this.context.suspend().then((function(){\n    //         var output = this.context.destination;\n    //         if(this.ctx_gain){\n    //             this.ctx_gain.connect(output);\n    //             output = this.ctx_gain;\n    //         }\n    //         if(this.ctx_filter){\n    //             this.ctx_filter.min.connect(output);\n    //             this.ctx_filter.max.connect(this.ctx_filter.min);\n    //             output = this.ctx_filter.max;\n    //         }\n    //         this.ctx_source.connect(output);\n    //         return this.context.resume();\n    //     }).bind(this));\n    // },\n    // setGain: function(gain){\n    //     var d = $q.defer();\n    //     this.gain = gain;\n    //     var created=false;\n    //     if(!this.ctx_gain){\n    //         this.ctx_gain = this.context.createGain();\n    //         created=true;\n    //     }\n    //     this.ctx_gain.gain.value = gain;\n    //     if(created){\n    //         this.setup_ctx_connections().then(d.resolve.bind(d), d.reject.bind(d));\n    //     } else {\n    //         d.resolve();\n    //     }\n    //     return d.promise;\n    // },\n    // setFrequencyFilter: function(filter){\n    //     var d = $q.defer();\n    //     d.resolve();\n    //     var promise = d.promise;\n    //     this.filter = filter;\n    //     var need_to_connect=false;\n    //     if(filter){\n    //         var f0 = Math.sqrt(filter.max * (filter.min||1)), bw = filter.max - filter.min;\n    //         var Q  = f0 / bw;\n    //         if(!this.ctx_filter){\n    //             this.ctx_filter = {\n    //                 min:this.context.createBiquadFilter(),\n    //                 max:this.context.createBiquadFilter()\n    //             };\n    //             this.ctx_filter.min.type.value = 'highpass';\n    //             this.ctx_filter.max.type.value = 'lopass';\n    //             this.ctx_filter.min.Q.value = 0.5;\n    //             this.ctx_filter.max.Q.value = 0.5;\n    //             need_to_connect = true;\n    //         }\n    //         this.ctx_filter.max.frequency.value = filter.max;\n    //         this.ctx_filter.min.frequency.value = filter.min;\n    //     } else if(!filter){\n    //         if(this.ctx_filter){\n    //             promise = this.disconnect_ctx().then((function(){\n    //                 this.ctx_filter = undefined;\n    //             }).bind(this));\n    //             need_to_connect = true;\n    //         }\n    //     }\n    //\n    //     if(need_to_connect){\n    //         promise = promise.then((function(){\n    //             return this.setup_ctx_connections();\n    //         }).bind(this));\n    //     }\n    //\n    //     return promise;\n    // },\n    play: function () {\n      // this.context.resume();\n      this.audio.play();\n      return this;\n    },\n    complete: function (callback) {\n      this.onCompleteListeners.push(callback);\n    },\n    pause: function () {\n      this.audio.pause(); // this.context.suspend();\n    },\n    restart: function () {\n      this.audio.pause(); // this.context.suspend();\n\n      this.audio.currentTime = 0;\n    },\n    stop: function () {\n      this.restart();\n    },\n    discard: function () {\n      if (!this.discarded) {\n        this.discarded = true;\n      }\n\n      if (this.context) {\n        this.context.close();\n        this.context = undefined;\n      }\n\n      if (this.interval) {\n        $interval.cancel(this.interval);\n        this.interval = undefined;\n      }\n    },\n    setVolume: function (volume) {\n      this.unmutedVolume = volume;\n      this.muted = false;\n      this.audio.volume = volume;\n    },\n    setPlaybackRate: function (rate) {\n      this.audio.playbackRate = rate;\n    },\n    setMuting: function (muting) {\n      this.muted = muting;\n      this.audio.volume = +this.muted * this.unmutedVolume;\n    },\n    setProgress: function (progress) {\n      if (this.audio && this.audio.duration && isFinite(progress)) {\n        this.audio.currentTime = this.audio.duration * progress;\n      }\n    },\n    setCurrentTime: function (currentTime) {\n      if (this.audio && this.audio.duration) {\n        this.audio.currentTime = currentTime;\n      }\n    },\n    _check_current_time: function () {\n      if (this.audio) {\n        this.currentTime = this.audio.currentTime;\n\n        if (this.currentTime >= this.duration) {\n          this.onCompleteListeners.forEach(function (listener) {\n            listener(this);\n          });\n        }\n      }\n    }\n  };\n  return A2AudioObject;\n}]);","angular.module('visualizer-layers', ['visualizer-services', 'a2.utils']).directive('a2VisualizerLayerItem', function (layer_types, $compile, $templateFetch) {\n  return {\n    restrict: 'E',\n    replace: true,\n    templateUrl: '/app/visualizer/layer-item/default.html',\n    link: function (scope, element, attrs) {\n      var layer_type = layer_types[scope.layer.type] ? scope.layer.type : false;\n      var layer_key = layer_types[layer_type] ? layer_types[layer_type].type : null;\n\n      if (layer_key && layer_key != 'default') {\n        var layer_url = '/app/visualizer/layer-item/' + layer_key + '.html';\n        var layer_tmp = $templateFetch(layer_url, function (layer_tmp) {\n          var layer_el = $compile(layer_tmp)(scope);\n          element.append(layer_el.children().unwrap());\n        });\n      }\n    }\n  };\n});","angular.module('visualizer-services', ['a2.services']).provider('layer_types', function () {\n  var type_array = [];\n  return {\n    addLayerType: function (layerType) {\n      type_array.push(layerType);\n      return this;\n    },\n    $get: function () {\n      var layer_types = {};\n      type_array.forEach(function (lt) {\n        layer_types[lt.type] = lt;\n      });\n      return layer_types;\n    }\n  };\n}).service('a2VisualizerLayers', function (layer_types, $controller) {\n  var layers = function ($scope, VisualizerCtrl) {\n    this.$scope = $scope;\n    this.VisualizerCtrl = VisualizerCtrl;\n    this.list = [];\n  };\n\n  layers.prototype = {\n    types: layer_types,\n    __new_layer__: function (layer_type) {\n      var layer_def = this.types[layer_type];\n\n      if (layer_def) {\n        var layer_maker = function () {};\n\n        layer_maker.prototype = layer_def;\n        var layer = new layer_maker();\n\n        if (layer.controller && typeof layer.controller == 'string') {\n          var cname = /^(.*?)( as (.*?))$/.exec(layer.controller);\n\n          if (cname) {\n            layer[cname[2] ? cname[3] : 'controller'] = $controller(cname[1], {\n              $scope: this.$scope,\n              VisualizerCtrl: this.VisualizerCtrl\n            });\n          }\n        }\n\n        return layer;\n      } else {\n        return null;\n      }\n    },\n    add: function () {\n      for (var a = arguments, i = 0, e = a.length; i < e; ++i) {\n        var layer_type = a[i];\n\n        if (layer_types[layer_type]) {\n          this.list.push(this.__new_layer__(layer_type));\n        } else {\n          console.warn(\"Unknown layer of type \" + layer_type + \".\");\n        }\n      }\n    },\n    __check_type: function (reqtype, curtype) {\n      if (reqtype instanceof Array) {\n        var idx = reqtype.indexOf(curtype);\n\n        if (idx == -1) {\n          return false;\n        }\n      } else if (curtype != reqtype) {\n        return false;\n      }\n\n      return true;\n    },\n    check_requirements: function (req) {\n      var browsetype = this.$scope.visobject_type;\n      var votype = this.$scope.visobject ? this.$scope.visobject.type : browsetype;\n\n      if (!req) {\n        return true;\n      } else if (req.selection && !this.$scope.visobject) {\n        return false;\n      } else if (req.type && !this.__check_type(req.type, votype)) {\n        return false;\n      } else if (req.browsetype && !this.__check_type(req.browsetype, browsetype)) {\n        return false;\n      } else if (req.that && !req.that(this.$scope)) {\n        return false;\n      }\n\n      return true;\n    },\n    sidebar_visible: function (l) {\n      if (l.sidebar_visible && !l.sidebar_visible($scope)) {\n        return false;\n      } else if (!this.check_requirements(l.require)) {\n        return false;\n      }\n\n      return true;\n    },\n    spectrogram_visible: function (l) {\n      return this.check_requirements(l.require) && l.visible;\n    },\n    display_sidebar: function (l) {\n      return !l.display || l.display.sidebar !== false;\n    },\n    display_spectrogram: function (l) {\n      return !l.display || l && l.display && l.display.spectrogram !== false;\n    }\n  };\n  return layers;\n}).provider('training_set_types', function () {\n  var training_set_types = [];\n  return {\n    add: function (type) {\n      training_set_types.push(type);\n      return this;\n    },\n    $get: function () {\n      return training_set_types.reduce(function (_, tst) {\n        _[tst.type] = tst;\n        return _;\n      }, {});\n    }\n  };\n}).controller('a2ProjectClasses', function (Project) {\n  var self = this;\n  Project.getClasses(function (list) {\n    self.list = list;\n  });\n}).service('a22PointBBoxEditor', function ($timeout, a2TrainingSets, training_set_types) {\n  var editor = function () {\n    this.min_eps = 0.001;\n    this.scalex = 1.0;\n    this.scaley = 0.001;\n    this.reset();\n  };\n\n  editor.prototype = {\n    reset: function () {\n      this.bbox = null;\n      this.points = null;\n      this.tracer = null;\n      this.valid = false;\n      return this;\n    },\n    make_new_bbox: function () {\n      this.bbox = {};\n      this.points = [];\n      this.valid = false;\n    },\n    add_tracer_point: function (x, y) {\n      if (this.bbox && !this.valid) {\n        var tracer = [x, y];\n        this.tracer = tracer;\n        this.validate([tracer]);\n      }\n    },\n    add_point: function (x, y, min_eps) {\n      min_eps = min_eps || this.min_eps;\n      var similars = this.points && this.points.filter(function (pt) {\n        var dx = (pt[0] - x) * this.scalex,\n            dy = (pt[1] - y) * this.scaley,\n            dd = dx * dx + dy * dy;\n        return dd <= min_eps;\n      });\n\n      if (similars && similars.length > 0) {\n        return;\n      }\n\n      if (!this.bbox) {\n        this.make_new_bbox();\n      }\n\n      if (this.points.length < 2) {\n        this.points.push([x, y]);\n      }\n\n      this.validate();\n    },\n    validate: function (tmp_points) {\n      var pts_x = this.points.map(function (x) {\n        return x[0];\n      });\n      var pts_y = this.points.map(function (x) {\n        return x[1];\n      });\n\n      if (tmp_points) {\n        pts_x.push.apply(pts_x, tmp_points.map(function (x) {\n          return x[0];\n        }));\n        pts_y.push.apply(pts_y, tmp_points.map(function (x) {\n          return x[1];\n        }));\n      }\n\n      this.bbox.x1 = Math.min.apply(null, pts_x);\n      this.bbox.y1 = Math.min.apply(null, pts_y);\n      this.bbox.x2 = Math.max.apply(null, pts_x);\n      this.bbox.y2 = Math.max.apply(null, pts_y);\n      this.valid = this.points.length >= 2;\n    }\n  };\n  editor.prototype.super = editor.prototype;\n  return editor;\n});","angular.module('a2.soundscapeRegionTags', ['a2.infotags']).directive('a2SoundscapeRegionTag', function ($injector) {\n  var clsprefix = 'label-';\n\n  var resolve_tag = function (scope, element, tag) {\n    var txt = element.children('.txt');\n    var label_classes = ['default', 'primary', 'success', 'info', 'warning', 'danger'];\n    var default_colors_by_type = {\n      species_sound: 'blue'\n    };\n\n    if (!tag) {\n      element.hide();\n    } else {\n      element.show();\n    }\n\n    scope.class = \"\";\n    scope.style = {};\n\n    if (typeof tag == 'string') {\n      txt.text(tag);\n      scope.class = clsprefix + \"default\";\n    } else {\n      var type = tag.type;\n      var text = tag.text || tag.tag;\n      var color = tag.color || 'default';\n      scope.count = tag.count === undefined ? '' : tag.count | 0;\n\n      if (type == 'species_sound') {\n        $injector.invoke(resolve_species_tag, this, {\n          element: txt,\n          text: text,\n          $scope: scope\n        });\n      } else {\n        type = 'normal';\n        txt.text(text);\n      }\n\n      if (color == 'default' && default_colors_by_type[type]) {\n        color = default_colors_by_type[type];\n      }\n\n      if (label_classes.indexOf(color) >= 0) {\n        scope.class = clsprefix + color;\n      } else {\n        scope.style['background-color'] = color;\n      }\n    }\n  };\n\n  var resolve_species_tag = function (element, text, $compile, $scope) {\n    element.empty().append($compile('<a2-species species=\"' + (text | 0) + '\"></a2-species species>')($scope));\n  };\n\n  return {\n    restrict: 'E',\n    scope: {\n      tag: '=',\n      closeable: '=?',\n      showCount: '=?',\n      onClose: '&'\n    },\n    replace: true,\n    templateUrl: '/app/visualizer/soundscape-region-tag.html',\n    link: function (scope, element, $attrs) {\n      scope.$watch('tag', function (tag) {\n        resolve_tag(scope, element, tag);\n      });\n    }\n  };\n});","angular.module('visualizer-spectrogram', ['visualizer-services', 'a2.filter.round', 'a2.utils']).service('a2AffixCompute', function () {\n  return function ($viewport, $el, layout) {\n    var v;\n    var affix_c = $el.attr('data-affix-container');\n\n    if (affix_c) {\n      v = layout[affix_c];\n    }\n\n    if (!v) {\n      v = {\n        left: 0,\n        top: 0,\n        width: $viewport.width(),\n        height: $viewport.height()\n      };\n    }\n\n    var e = {\n      width: $el.width(),\n      height: $el.height()\n    };\n    var affix_left = $el.attr('data-affix-left') | 0;\n    var affix_right = $el.attr('data-affix-right');\n    var affix_align_h = $el.attr('data-affix-align-h');\n\n    if (affix_right !== undefined) {\n      affix_left = v.left + v.width - $el.width() - (affix_right | 0);\n    } else if (affix_align_h !== undefined) {\n      affix_left = v.left + (v.width - $el.width()) * affix_align_h;\n    } else {\n      affix_left += v.left;\n    }\n\n    var affix_top = $el.attr('data-affix-top') | 0;\n    var affix_bottom = $el.attr('data-affix-bottom');\n    var affix_align_v = $el.attr('data-affix-align-v');\n\n    if (affix_bottom !== undefined) {\n      affix_top = v.top + v.height - $el.height() - (affix_bottom | 0);\n    } else if (affix_align_v !== undefined) {\n      affix_top = v.top + (v.height - $el.height()) * affix_align_v;\n    } else {\n      affix_top += v.top;\n    }\n\n    $el.css({\n      position: 'absolute',\n      left: Math.round(affix_left + $viewport.scrollLeft()),\n      top: Math.round(affix_top + $viewport.scrollTop())\n    });\n  };\n}).directive('a2VisualizerSpectrogram', function (a2BrowserMetrics, a2AffixCompute) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/visualizer/visualizer-spectrogram.html',\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var layout_tmp = $scope.layout.tmp;\n      var views = {\n        viewport: $element.children('.spectrogram-container')\n      };\n\n      $scope.onPlaying = function (e) {\n        $scope.layout.y_axis.left = $element.scrollLeft();\n        $element.children('.axis-y').css({\n          left: $scope.layout.y_axis.left + 'px'\n        });\n        $scope.layout.x_axis.top = Math.min($scope.layout.spectrogram.top + $scope.layout.spectrogram.height, $element.scrollTop() + $element.height() - layout_tmp.axis_sizeh);\n        $element.children('.axis-x').css({\n          top: $scope.layout.x_axis.top + 'px'\n        });\n      };\n\n      $scope.onScrolling = function (e) {\n        var layout = $scope.layout;\n        var max_s_h = layout.spectrogram.height - layout.viewport.height;\n        var max_s_w = layout.spectrogram.width - layout.viewport.width;\n\n        if ($element.scrollTop() > max_s_h) {\n          $element.scrollTop(max_s_h);\n        }\n\n        if ($element.scrollLeft() > max_s_w) {\n          $element.scrollLeft(max_s_w);\n        }\n\n        layout.bbox = {\n          s1: ($element.scrollLeft() - layout.spectrogram.left) / layout.scale.sec2px,\n          s2: ($element.scrollLeft() - layout.spectrogram.left + $element.width()) / layout.scale.sec2px,\n          hz1: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop() - $element.height()) / layout.scale.hz2px,\n          hz2: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop()) / layout.scale.hz2px\n        };\n        layout.center = {\n          s: ($element.scrollLeft() - layout.spectrogram.left + $element.width() / 2.0) / layout.scale.sec2px,\n          hz: (layout.spectrogram.top + layout.spectrogram.height - $element.scrollTop() - $element.height() / 2.0) / layout.scale.hz2px\n        };\n        layout.y_axis.left = $element.scrollLeft();\n        $element.children('.axis-y').css({\n          left: layout.y_axis.left + 'px'\n        });\n        layout.x_axis.top = $element.scrollTop() + $element.height() - layout_tmp.axis_sizeh - layout_tmp.gutter;\n        $element.children('.axis-x').css({\n          top: layout.x_axis.top - 1 + 'px'\n        });\n\n        if (layout.legend) {\n          layout.legend.left = $element.scrollLeft() + $element.width() - a2BrowserMetrics.scrollSize.width - layout_tmp.legend_width - layout_tmp.legend_gutter;\n          $element.children('.legend').css({\n            left: layout.legend.left + 'px'\n          });\n        }\n\n        $element.find('.a2-visualizer-spectrogram-affixed').each(function (i, el) {\n          a2AffixCompute($element, $(el), layout);\n        });\n      };\n\n      $scope.onMouseMove = function (e) {\n        var elOff = $element.offset();\n        var x = e.pageX - elOff.left + $element.scrollLeft() - $scope.layout.spectrogram.left;\n        var y = e.pageY - elOff.top + $element.scrollTop() - $scope.layout.spectrogram.top;\n        x = Math.min(Math.max(x, 0), $scope.layout.spectrogram.width);\n        y = Math.min(Math.max(y, 0), $scope.layout.spectrogram.height);\n        $scope.pointer.x = x;\n        $scope.pointer.y = y;\n        $scope.pointer.sec = $scope.layout.x2sec(x);\n        $scope.pointer.hz = $scope.layout.y2hz(y);\n      };\n\n      var make_axis = function (domain, scale, orientation) {\n        var axis = d3.svg.axis();\n\n        if (domain.ticks) {\n          axis.ticks(domain.ticks);\n        }\n\n        if (domain.tick_format) {\n          axis.tickFormat(domain.tick_format);\n        } else if (domain.unit_format) {\n          axis.tickFormat(domain.unit_format);\n        }\n\n        axis.scale(scale).orient(orientation);\n        return axis;\n      };\n\n      $scope.layout.listeners.push(function (layout, container, $scope, width, height, fix_scroll_center) {\n        doLayout(layout, container, $scope, width, height, fix_scroll_center);\n      });\n\n      function doLayout(layout, container, $scope, width, height, fix_scroll_center) {\n        var domain = layout.l.domain || {};\n        var components = {\n          visualizer_root: container,\n          spectrogram: container.children('.spectrogram-container'),\n          y_axis: domain.y && container.children('.axis-y'),\n          x_axis: domain.x && container.children('.axis-x'),\n          legend: domain.legend && container.children('.legend')\n        };\n        Object.keys(components).forEach(function (i) {\n          var component = components[i];\n\n          if (component) {\n            var $li = component;\n            var li = layout.l[i];\n\n            if (li.css) {\n              $li.css(li.css);\n            }\n\n            if (li.attr) {\n              $li.attr(li.attr);\n            }\n          }\n        });\n\n        if (domain.x) {\n          doXAxisLayout(layout);\n        }\n\n        if (domain.y) {\n          doYAxisLayout(layout);\n        }\n\n        if (domain.legend) {\n          doLegendLayout(layout);\n        }\n\n        if (fix_scroll_center) {\n          $element.scrollTop(Math.min(layout.l.scroll_center.top, layout.l.spectrogram.css.height - layout.viewport.height));\n          $element.scrollLeft(Math.min(layout.l.scroll_center.left, layout.l.spectrogram.css.width - layout.viewport.width));\n        }\n\n        $scope.onScrolling();\n      }\n\n      function doXAxisLayout(layout) {\n        var d3_x_axis = d3.select($element.children('.axis-x').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        var scalex = layout.l.scale.x;\n        d3_x_axis.style('height', 100);\n        d3_x_axis.style('scale', 'none');\n        d3_x_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 1,\n          width: layout.l.x_axis.attr.width,\n          height: spec_h + layout_tmp.axis_lead\n        });\n        d3_x_axis.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.axis_lead + ', 1)').call(make_axis(domain.x, scalex, \"bottom\"));\n      }\n\n      function doYAxisLayout(layout) {\n        var d3_y_axis = d3.select($element.children('.axis-y').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        var scaley = layout.l.scale.y;\n        d3_y_axis.style('width', 61);\n        d3_y_axis.style('scale', 'none');\n        d3_y_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 0,\n          width: layout.l.y_axis.attr.width + 1,\n          height: spec_h + layout_tmp.axis_lead + 1\n        });\n        d3_y_axis.append(\"rect\").attr({\n          class: 'bg',\n          x: 0,\n          y: 0,\n          width: layout.l.y_axis.attr.width - layout_tmp.axis_lead,\n          height: spec_h + layout_tmp.axis_lead + layout_tmp.axis_sizeh\n        });\n        d3_y_axis.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.axis_sizew + ', ' + layout_tmp.axis_lead + ')').call(make_axis(domain.y, scaley, \"left\"));\n      }\n\n      function doLegendLayout(layout) {\n        var d3_legend = d3.select($element.children('.legend').empty()[0]);\n        var spec_h = layout.spectrogram.height;\n        var domain = layout.l.domain;\n        d3_legend.append(\"rect\").attr({\n          class: 'bg',\n          x: layout_tmp.axis_lead,\n          y: 0,\n          width: layout.l.legend.attr.width,\n          height: layout.l.legend.attr.height\n        });\n        d3_legend.append(\"image\").attr({\n          class: 'legend-image',\n          x: layout_tmp.legend_axis_w,\n          y: layout_tmp.axis_lead,\n          width: layout_tmp.legend_width - layout_tmp.legend_axis_w,\n          height: spec_h,\n          preserveAspectRatio: 'none',\n          'xlink:href': domain.legend.src\n        });\n        d3_legend.append(\"rect\").attr({\n          class: 'border',\n          x: layout_tmp.legend_axis_w,\n          y: layout_tmp.axis_lead,\n          width: layout_tmp.legend_width - layout_tmp.legend_axis_w,\n          height: spec_h\n        });\n        d3_legend.append(\"g\").attr('class', 'axis').attr('transform', 'translate(' + layout_tmp.legend_axis_w + ', ' + (layout_tmp.axis_lead + 1) + ')').call(make_axis(domain.legend, layout.l.scale.legend, \"left\"));\n      }\n\n      $scope.getRecordingPlaybackTime = function () {\n        return $scope.audio_player.getCurrentTime();\n      };\n\n      $scope.$watch(function () {\n        return {\n          'h': $element.height(),\n          'w': $element.width()\n        };\n      }, function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, newValue.w, newValue.h, true);\n      }, true);\n      $scope.$watch(function () {\n        return $scope.layout.scale.sec2px * $scope.getRecordingPlaybackTime() | 0;\n      }, function (newValue, oldValue) {\n        if ($scope.audio_player.is_playing) {\n          var pbh = layout_tmp.axis_sizew + newValue;\n          var sl = $element.scrollLeft(),\n              slw = sl + $element.width() / 2;\n          var dx = pbh - slw;\n\n          if (dx > 0) {\n            $element.scrollLeft(sl + dx);\n          }\n        }\n      }, true);\n      $scope.$watch('visobject', function (newValue, oldValue) {\n        $element.scrollLeft(0);\n        $element.scrollTop(999999);\n        $scope.layout.apply($element, $scope, $element.width(), $element.height());\n      }, true);\n      $element.bind('resize', function () {\n        $scope.$apply();\n      });\n      $scope.$watch('layout.scale.zoom.x', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.$watch('layout.scale.zoom.y', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.$watch('layout.scale.originalScale', function (newValue, oldValue) {\n        $scope.layout.apply($element, $scope, $element.width(), $element.height(), true);\n      });\n      $scope.layout.apply($element, $scope, $element.width(), $element.height());\n      $scope.onScrolling();\n    }\n  };\n}).directive('a2VisualizerSpectrogramLayer', function (layer_types, $compile, $templateFetch) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/visualizer/spectrogram-layer/default.html',\n    replace: true,\n    link: function (scope, element, attrs) {\n      //console.log(\"link     : function(scope, element, attrs){\", scope, element, attrs);\n      var layer_type = layer_types[scope.layer.type] ? scope.layer.type : false;\n      var layer_key = layer_types[layer_type] ? layer_types[layer_type].type : null;\n      element.addClass(layer_type);\n\n      if (layer_key && layer_key != 'default') {\n        var layer_url = '/app/visualizer/spectrogram-layer/' + layer_key + '.html';\n        var layer_tmp = $templateFetch(layer_url, function (layer_tmp) {\n          var layer_el = $compile(layer_tmp)(scope);\n          element.append(layer_el);\n        });\n      }\n    }\n  };\n}).directive('a2VisualizerSpectrogramAffixed', function (a2AffixCompute, $debounce) {\n  return {\n    restrict: 'A',\n    link: function ($scope, $element, $attrs) {\n      $element.addClass('a2-visualizer-spectrogram-affixed');\n      var $root = $element.closest('.visualizer-root');\n      var $eloff = $element.offset(),\n          $roff = $root.offset();\n\n      if ($roff) {\n        if ($element.attr('data-affix-left') === undefined) {\n          $element.attr('data-affix-left', $eloff.left - $roff.left);\n        }\n\n        if ($element.attr('data-affix-top') === undefined) {\n          $element.attr('data-affix-top', $eloff.top - $roff.top);\n        }\n      }\n\n      if ($attrs.a2VisualizerSpectrogramAffixed) {\n        $scope.$watch($attrs.a2VisualizerSpectrogramAffixed, function (newval, oldval) {\n          var i;\n\n          if (oldval) {\n            for (i in oldval) {\n              $element.attr('data-affix-' + i, null);\n            }\n          }\n\n          if (newval) {\n            for (i in newval) {\n              $element.attr('data-affix-' + i, newval[i]);\n            }\n          }\n        });\n        a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      }\n\n      a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      $scope.$watch(function () {\n        return $element.width() * $element.height();\n      }, $debounce(function () {\n        a2AffixCompute($element.offsetParent(), $element, $scope.layout);\n      }));\n    }\n  };\n});","angular.module('a2.speciesValidator', ['a2.utils', 'a2.infotags']).directive('a2SpeciesValidator', function (Project, a2UserPermit, notify, $filter) {\n  var project = Project;\n  return {\n    restrict: 'E',\n    scope: {\n      recording: '=recording'\n    },\n    templateUrl: '/app/visualizer/validator-main.html',\n    link: function ($scope, $element, $attrs) {\n      var class2key = function (project_class) {\n        var cls;\n\n        if (/number|string/.test(typeof project_class)) {\n          cls = $scope.classes.filter(function (pc) {\n            return pc.id == project_class;\n          }).shift();\n        } else {\n          cls = project_class;\n        }\n\n        return cls && [cls.species, cls.songtype].join('-');\n      };\n\n      var add_validation = function (validation) {\n        var key = [validation.species, validation.songtype].join('-');\n        var present = Object.values({\n          present: validation.present,\n          presentReview: validation.presentReview,\n          presentAed: validation.presentAed\n        });\n        $scope.validations[key] = present;\n      };\n\n      var load_project_classes = function () {\n        Project.getClasses(function (classes) {\n          $scope.classes = classes;\n          var taxons = {};\n\n          for (var i = 0; i < classes.length; i++) {\n            var c = classes[i];\n            if (!taxons[c.taxon]) taxons[c.taxon] = [];\n            taxons[c.taxon].push(c);\n          }\n\n          for (var t in taxons) {\n            taxons[t] = $filter('orderBy')(taxons[t], ['species_name', 'songtype_name']);\n          }\n\n          $scope.byTaxon = taxons;\n          $scope.taxons = Object.keys($scope.byTaxon).sort();\n        });\n      };\n\n      $scope.$on('a2-persisted', load_project_classes);\n      $scope.classes = [];\n      $scope.is_selected = {};\n\n      $scope.select = function (taxon, project_class, $event) {\n        if ($($event.target).is('a')) {\n          return;\n        }\n\n        if ($event.shiftKey) {\n          $scope.is_selected[project_class.id] = true;\n          var sel_range = {\n            from: Infinity,\n            to: -Infinity\n          };\n          var taxonSpecies = $scope.byTaxon[taxon];\n          taxonSpecies.forEach(function (pc, idx) {\n            if ($scope.is_selected[pc.id]) {\n              sel_range.from = Math.min(sel_range.from, idx);\n              sel_range.to = Math.max(sel_range.to, idx);\n            }\n          });\n\n          for (var si = sel_range.from, se = sel_range.to + 1; si < se; ++si) {\n            $scope.is_selected[taxonSpecies[si].id] = true;\n          }\n        } else if ($event.ctrlKey) {\n          $scope.is_selected[project_class.id] = !$scope.is_selected[project_class.id];\n        } else {\n          $scope.is_selected = {};\n          $scope.is_selected[project_class.id] = true;\n        }\n      };\n\n      $scope.validations = {};\n\n      $scope.validate = function (val) {\n        if (!a2UserPermit.can('validate species')) {\n          notify.error('You do not have permission to validate species');\n          return;\n        }\n\n        var keys = [],\n            key_idx = {};\n        var k; // var k = class2key(project_class);\n        // if (k && !key_idx[k]) {\n        //     key_idx[k] = true;\n        //     keys.push(k);\n        // }\n        // sel_pc_id -> selected project class id\n\n        for (var sel_pc_id in $scope.is_selected) {\n          if ($scope.is_selected[sel_pc_id]) {\n            k = class2key(sel_pc_id);\n\n            if (k && !key_idx[k]) {\n              key_idx[k] = true;\n              keys.push(k);\n            }\n          }\n        }\n\n        if (keys.length > 0) {\n          Project.validateRecording($scope.recording.id, {\n            'class': keys.join(','),\n            val: val,\n            determinedFrom: 'visualizer'\n          }, function (validations) {\n            validations.forEach(function (validation) {\n              var key = class2key(validation);\n\n              if (validation.val == 2) {\n                delete $scope.validations[key];\n              } else {\n                $scope.validations[key] = Object.values({\n                  present: validation.val,\n                  presentReview: 0\n                });\n              }\n            });\n          });\n        }\n      };\n\n      $scope.val_options = [{\n        label: \"Clear\",\n        val: 2\n      }, {\n        label: \"Present\",\n        val: 1\n      }, {\n        label: \"Absent\",\n        val: 0\n      }];\n\n      $scope.val_state = function (project_class, val_options) {\n        if (!val_options) {\n          val_options = $scope.val_options;\n        }\n\n        var key = class2key(project_class),\n            val = $scope.validations[key];\n\n        if (typeof val === 'undefined') {\n          return;\n        } else {\n          if (val[0] == 1 || val[1] > 0 || val[2] > 0) {\n            val_options[1].showDropdown = val[1] > 0 || val[2] > 0;\n            return val_options[1];\n          }\n\n          if (val[0] == null && val[1] == 0 && val[2] == 0) {\n            return;\n          } else {\n            return val_options[2];\n          }\n        }\n      };\n\n      $scope.$watch('recording', function (recording) {\n        $scope.validations = {};\n\n        if (recording && recording.validations) {\n          recording.validations.forEach(add_validation);\n        }\n      });\n      load_project_classes();\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name visualizer-sidebar\n * @description\n * Sidebar directive for the visualizer module.\n */\nangular.module('a2.visualizer.directive.sidebar', []).directive('visualizerSidebar', function () {\n  return {\n    restrict: 'E',\n    transclude: true,\n    templateUrl: '/app/visualizer/visualizer-sidebar.html',\n    scope: {\n      closed: '=?'\n    },\n    link: function (scope, element, attrs) {\n      element.addClass(\"sidebar show\");\n      checkClosed();\n\n      scope.toggleSidebar = function () {\n        scope.closed = !scope.closed;\n        checkClosed();\n      };\n\n      function checkClosed() {// element[scope.closed ? 'addClass' : 'removeClass'](\"collapsed\");\n      }\n    }\n  };\n});","// $(document)\n//   .on('click.bs.dropdown.data-api', '.dropdown .dropdown-form', function (e) { e.stopPropagation(); });\n\n/**\n * @ngdoc overview\n * @name visualizer\n * @description\n * This is the main visualizer module.\n */\nangular.module('a2.visualizer', ['ui.router', 'ct.ui.router.extras', 'a2.services', 'a2.utils', 'a2.visobjects', 'a2.visualizer.dialog', 'a2.visobjectsbrowser', 'a2.speciesValidator', 'visualizer-layers', 'a2.visualizer.directive.sidebar', 'a2.visualizer.layers.base-image-layer', 'a2.visualizer.layers.annotation-layer', 'a2.visualizer.layers.zoom-input-layer', 'a2.visualizer.layers.data-plot-layer', 'a2.visualizer.layers.recordings', 'a2.visualizer.layers.recording-soundscape-region-tags', 'a2.visualizer.layers.recording-tags', 'a2.visualizer.layers.species-presence', 'a2.visualizer.layers.soundscapes', 'a2.visualizer.layers.soundscape-composition-tool', 'a2.visualizer.layers.training-sets', 'a2.visualizer.layers.templates', 'a2.visualizer.layers.audio-events-layer', 'visualizer-spectrogram', 'visualizer-services', 'a2.visualizer.audio-player', 'a2-visualizer-spectrogram-Layout', 'a2-visualizer-spectrogram-click2zoom', 'a2.url-update-service', 'ui.bootstrap'])\n/**\n * @ngdoc service\n * @name a2-visualizer-spectrogram-Layout.factory:VisualizerLayout\n * @description\n * The layout manager for the spectrogram.\n */\n.config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('visualizer', {\n    url: '/visualizer',\n    views: {\n      'visualizer': {\n        controller: 'VisualizerCtrl',\n        templateUrl: '/app/visualizer/main.html'\n      }\n    },\n    deepStateRedirect: true,\n    sticky: true\n  }).state('visualizer.view', {\n    url: '/:type/:idA/:idB/:idC?gain&filter&a&clusters',\n    params: {\n      type: '',\n      a: null,\n      clusters: null,\n      gain: null,\n      filter: null,\n      idA: {\n        value: '',\n        squash: true\n      },\n      idB: {\n        value: null,\n        squash: true\n      },\n      idC: {\n        value: null,\n        squash: true\n      }\n    },\n    controller: function ($state, $scope) {\n      var p = $state.params;\n      var lc = [p.type];\n\n      if (p.idA) {\n        lc.push(p.idA);\n\n        if (p.idB) {\n          lc.push(p.idB);\n\n          if (p.idC) {\n            lc.push(p.idC);\n          }\n        }\n      }\n\n      var l = lc.join('/');\n      $scope.location.whenBrowserIsAvailable(function () {\n        $scope.$parent.$broadcast('set-browser-location', l, p.a); // Catch the navigation URL query\n\n        if (p.type === 'rec') {\n          $scope.$parent.$broadcast('set-browser-annotations', p.idA ? Number(p.idA) : null, p.a ? p.a : null);\n        }\n      });\n\n      if ($scope.parseAnnotations) {\n        $scope.parseAnnotations(p.a);\n      }\n    }\n  });\n}).directive('a2Visualizer', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {},\n    controller: 'VisualizerCtrl',\n    templateUrl: '/app/visualizer/main.html'\n  };\n}).service('a2VisualizerLocationManager', function ($location) {\n  var locman = function (scope, prefix, state) {\n    this.scope = scope;\n    this.state = state;\n    this.prefix = prefix;\n    this.current = '';\n    this.__expected = '';\n  };\n\n  locman.prototype = {\n    sync: function () {\n      if (this.current == this.__expected) {\n        return;\n      }\n\n      this.__expected = this.current;\n      this.scope.$broadcast('set-browser-location', this.current);\n    },\n    update_path: function () {\n      this.set(this.current);\n    },\n    updateParams: function (params) {\n      var all_params = angular.extend({}, this.state.params);\n\n      for (var pk in params) {\n        var pv = params[pk];\n\n        if (pv === undefined) {\n          delete all_params[pk];\n        } else {\n          all_params[pk] = pv;\n        }\n      }\n\n      console.log(all_params, this.state.current.name);\n      this.state.transitionTo(this.state.current.name, all_params, {\n        notify: false\n      });\n    },\n    set: function (location, dont_sync) {\n      if (dont_sync) {\n        this.__expected = location;\n      }\n\n      if ($location.path() != this.prefix + location) {\n        console.log('a2VisualizerLocationManager::set_location', this.prefix + location, dont_sync);\n        var search = $location.search();\n        delete search.a;\n        $location.path(this.prefix + location);\n        $location.search(search);\n      }\n    },\n    path_changed: function (path) {\n      if (path === undefined) {\n        path = $location.path();\n      }\n\n      path = '' + path;\n\n      if (path.indexOf(this.prefix) === 0) {\n        this.current = path.substr(this.prefix.length);\n      }\n    },\n    whenBrowserIsAvailable: function (callback) {\n      if (this.browserAvailable) {\n        callback();\n      } else {\n        (this.__onBrowserAvailable__ || (this.__onBrowserAvailable__ = [])).push(callback);\n      }\n    },\n    notifyBrowserAvailable: function () {\n      this.browserAvailable = true;\n\n      if (this.__onBrowserAvailable__) {\n        this.__onBrowserAvailable__.forEach(function (callback) {\n          callback();\n        });\n\n        delete this.__onBrowserAvailable__;\n      }\n    }\n  };\n  return locman;\n}).controller('VisualizerCtrl', function (a2VisualizerLayers, $q, $location, $state, $scope, $localStorage, $timeout, itemSelection, Project, $controller, a2UserPermit, a2SpectrogramClick2Zoom, $rootScope, VisualizerObjectTypes, VisualizerLayout, a2AudioPlayer, a2VisualizerLocationManager, a2EventEmitter) {\n  var events = new a2EventEmitter();\n  this.on = events.on.bind(events);\n  this.off = events.off.bind(events);\n  var layers = new a2VisualizerLayers($scope, this);\n  var layer_types = layers.types;\n  var initial_state_params = {\n    gain: $state.params.gain,\n    filter: $state.params.filter\n  };\n\n  $scope.parseAnnotations = function (annotationsString) {\n    $scope.annotations = annotationsString ? (Array.isArray(annotationsString) ? annotationsString : annotationsString.split('|')).map(function (item) {\n      var comps = item.split(',');\n      var parsed = {\n        type: comps.shift(),\n        value: []\n      };\n      comps.forEach(function (comp) {\n        var pair = comp.split(':');\n\n        if (pair.length > 1) {\n          var key = pair.shift();\n          parsed[key] = pair[1].join(':');\n        } else {\n          parsed.value.push(comp);\n        }\n      });\n      return parsed;\n    }) : [];\n  }; // check selected clusters in query\n\n\n  if ($state.params.clusters) {\n    $localStorage.setItem('analysis.clusters.playlist', $state.params.idA);\n  }\n\n  $scope.parseAnnotations($state.params.a);\n  $scope.layers = layers.list; // current layers in the visualizer\n\n  $scope.addLayer = layers.add.bind(layers);\n  $scope.fullfillsRequirements = layers.check_requirements.bind(layers);\n  $scope.isSidebarVisible = layers.sidebar_visible.bind(layers);\n  $scope.isSpectrogramVisible = layers.spectrogram_visible.bind(layers);\n  $scope.canDisplayInSidebar = layers.display_sidebar.bind(layers);\n  $scope.canDisplayInSpectrogram = layers.display_spectrogram.bind(layers);\n\n  if (a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper()) {\n    layers.add('base-image-layer', 'recording-layer', 'templates', 'zoom-input-layer');\n  } else {\n    layers.add('base-image-layer', 'annotation-layer', 'data-plot-layer', 'recording-layer', 'recording-tags-layer', 'soundscape-info-layer', 'soundscape-regions-layer', 'recording-soundscape-region-tags', 'species-presence', 'training-data', 'templates', 'soundscape-composition-tool', 'zoom-input-layer', 'audio-events-layer');\n  }\n\n  $scope.visobject = null;\n  var location = new a2VisualizerLocationManager($scope, '/visualizer' + '/', $state);\n  $scope.location = location;\n  $scope.annotation = {};\n  $scope.set_location = location.set.bind(location);\n  $scope.layout = new VisualizerLayout();\n  $scope.click2zoom = new a2SpectrogramClick2Zoom($scope.layout);\n  $scope.Math = Math;\n  $scope.pointer = {\n    x: 0,\n    y: 0,\n    sec: 0,\n    hz: 0\n  };\n  $scope.selection = itemSelection.make('layer');\n\n  $scope.getLayers = function () {\n    return $scope.layers;\n  };\n\n  $scope.setVisObject = function (visobject, type, location) {\n    if ($scope.isUploading) return;\n    $scope.isUploading = true;\n    return $q.resolve().then(function () {\n      if (visobject) {\n        $scope.visobject_location = location;\n        $scope.location.set(location, true);\n        var visobject_loader = VisualizerObjectTypes.getLoader(type);\n        $scope.loading_visobject = visobject_loader.getCaptionFor(visobject);\n        return visobject_loader.load(visobject, $scope).then(function (visobject) {\n          console.log('VisObject loaded : ', visobject);\n          $scope.$parent.$broadcast('clear-recording-data', true); // check clusters playlist in local storage else clear local storage\n\n          if ($localStorage.getItem('analysis.clusters.playlist') === $state.params.idA) {\n            var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n            console.log('clustersData', this.clustersData);\n\n            if (clustersData && clustersData.boxes && $state.params.idB) {\n              this.parseAnnotations(clustersData.boxes[$state.params.idB]);\n            }\n          } else {\n            $scope.removeFromLocalStorage();\n            this.parseAnnotations($location.search().a);\n          }\n\n          $scope.loading_visobject = false;\n          $scope.visobject = visobject;\n          $scope.visobject_type = visobject.type;\n          $scope.setYScaleOptions();\n        }.bind(this));\n      } else {\n        $scope.visobject = null;\n      }\n    }.bind(this)).then(function () {\n      events.emit('visobject', $scope.visobject);\n      $scope.isUploading = false;\n    });\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  }; // Resize Y scale.\n\n\n  $scope.getSelectedFrequencyCache = function () {\n    try {\n      return JSON.parse($localStorage.getItem('visuilizer.frequencies.cache')) || {\n        originalScale: true\n      };\n    } catch (e) {\n      return {\n        originalScale: true\n      };\n    }\n  };\n\n  $scope.deselectFrequencyOptions = function () {\n    $scope.yAxisOptions.forEach(function (item) {\n      return item.active = false;\n    });\n  };\n\n  $scope.setYScaleOptions = function () {\n    // Get selected frequency.\n    $scope.scaleCache = $scope.getSelectedFrequencyCache(); // Get recording frequency.\n\n    $scope.convertedScale = $scope.visobject && $scope.visobject.max_freq ? +$scope.visobject.max_freq / 1000 : 'X'; // Set frequency options with default y-scale value.\n\n    $scope.yAxisOptions = [{\n      title: '24 kHz scale',\n      value: '24_scale',\n      active: false\n    }, {\n      title: 'Original scale (' + $scope.convertedScale + ' kHz)',\n      value: 'original_scale',\n      active: true\n    }]; // Set frequency options with saved frequency.\n\n    if ($scope.scaleCache && !$scope.scaleCache.originalScale && $scope.convertedScale < 24) {\n      $scope.deselectFrequencyOptions();\n      $scope.yAxisOptions[0].active = true;\n    } // Display original frequency for recording whith 24kHz or more.\n\n\n    if ($scope.convertedScale >= 24) {\n      $scope.deselectFrequencyOptions();\n      $scope.yAxisOptions[1].active = true;\n    }\n  };\n\n  $scope.resizeYScale = function (item) {\n    $scope.deselectFrequencyOptions();\n    item.active = true;\n    var originalScale = item.value === 'original_scale';\n    $localStorage.setItem('visuilizer.frequencies.cache', JSON.stringify({\n      originalScale: originalScale\n    }));\n    $scope.layout.scale.originalScale = originalScale;\n    var span = originalScale ? $scope.visobject.sampling_rate / 2 : 24000;\n    $scope.visobject.domain.y.to = span;\n    $scope.visobject.domain.y.span = span;\n  };\n\n  $scope.audio_player = new a2AudioPlayer($scope, initial_state_params);\n  $scope.$on('browser-vobject-type', function (evt, type) {\n    $scope.visobject_type = type;\n  });\n  $scope.$on('browser-available', function () {\n    $scope.location.notifyBrowserAvailable();\n  });\n  $rootScope.$on('notify-visobj-updated', function () {\n    var args = Array.prototype.slice.call(arguments, 1);\n    args.unshift('visobj-updated');\n    $scope.$broadcast.apply($scope, args);\n  });\n  $scope.$on('visobj-updated', function (visobject) {\n    $scope.setVisObject($scope.visobject, $scope.visobject_type, $scope.visobject_location);\n  });\n}).filter('filterPresentCount', function () {\n  return function (validations) {\n    if (!validations) return 0;\n    var count = 0;\n    validations.forEach(function (validation) {\n      if (validation.presentReview > 0 || validation.presentAed > 0 || validation.present == 1) {\n        count++;\n      }\n    });\n    return count;\n  };\n}).filter('filterAbsentCount', function () {\n  return function (validations) {\n    if (!validations) return 0;\n    var count = 0;\n    validations.forEach(function (validation) {\n      if (validation.presentReview == 0 && validation.presentAed == 0 && validation.present == 0) {\n        count++;\n      }\n    });\n    return count;\n  };\n});\n/**\n * @ngdoc overview\n * @name a2-visualizer-spectrogram-Layout\n * @description\n * This module stores the layout manager for the spectrogram.\n */\n\nangular.module('a2-visualizer-spectrogram-Layout', ['a2.classy', 'a2-plot-specs']).factory('VisualizerLayoutSpecs', function (PlotSpecs) {\n  return PlotSpecs;\n})\n/**\n * @ngdoc service\n * @name a2-visualizer-spectrogram-Layout.factory:VisualizerLayout\n * @description\n * The layout manager for the spectrogram.\n */\n.factory('VisualizerLayout', function (a2BrowserMetrics, makeClass, VisualizerLayoutSpecs, $localStorage) {\n  var align_to_interval = function (unit, domain, align) {\n    if (align === undefined || !domain || !domain.unit_interval) {\n      return unit;\n    } else {\n      var f = domain.from || 0,\n          u = domain.unit_interval;\n      unit = Math.floor((unit - f) / u) * u + f;\n      return unit + align * u;\n    }\n  };\n\n  var get_domain = function (visobject) {\n    return visobject && visobject.domain || {\n      x: {\n        from: 0,\n        to: 60,\n        span: 60,\n        ticks: 60,\n        unit: 'Time ( s )'\n      },\n      y: {\n        from: 0,\n        to: 22050,\n        span: 22050,\n        unit: 'Frequency ( kHz )',\n        tick_format: function (v) {\n          return v / 1000 | 0;\n        }\n      }\n    };\n  };\n\n  var make_scale = function (domain, range) {\n    var s;\n\n    if (domain.ordinal) {\n      var dd = domain.to - domain.from;\n      var dr = range[1] - range[0];\n      var scale = dr / dd;\n      s = d3.scale.linear().domain([domain.from, domain.to]).range([scale / 2 + range[0], range[1] - scale / 2]);\n    } else {\n      s = d3.scale.linear().domain([domain.from, domain.to]).range(range);\n    }\n\n    return s;\n  };\n\n  var linear_interpolate = function (x, levels) {\n    var l = x * (levels.length - 1);\n    var f = Math.floor(l),\n        c = Math.ceil(l),\n        m = l - f;\n    return levels[f] * (1 - m) + levels[c] * m;\n  };\n\n  var interpolate = linear_interpolate;\n  return makeClass({\n    constructor: function () {\n      this.scale = {\n        def_sec2px: 100 / 1.0,\n        def_hz2px: 100 / 5000.0,\n        max_sec2px: 100 / (1.0 / 8),\n        max_hz2px: 100 / (5000.0 / 8),\n        zoom: {\n          x: 0,\n          y: 0\n        },\n        sec2px: 100 / 1.0,\n        hz2px: 100 / 5000.0,\n        originalScale: null\n      };\n      this.offset = {\n        sec: 0,\n        hz: 0\n      };\n      this.tmp = VisualizerLayoutSpecs;\n      this.domain = {};\n      this.listeners = [];\n    },\n    x2sec: function (x, interval_align) {\n      var seconds = x / this.scale.sec2px;\n      seconds += this.offset.sec;\n      return align_to_interval(+seconds, this.domain.x, interval_align);\n    },\n    y2hz: function (y, interval_align) {\n      var h = (this.spectrogram && this.spectrogram.height) | 0;\n      var hertz = (h - y) / this.scale.hz2px;\n      hertz += this.offset.hz;\n      return align_to_interval(+hertz, this.domain.y, interval_align);\n    },\n    sec2x: function (seconds, round, interval_align) {\n      seconds = align_to_interval(seconds - this.offset.sec, this.domain.x, interval_align);\n      var x = seconds * this.scale.sec2px;\n      return round ? x | 0 : +x;\n    },\n    hz2y: function (hertz, round, interval_align) {\n      hertz = align_to_interval(hertz - this.offset.hz, this.domain.y, interval_align);\n      var h = (this.spectrogram && this.spectrogram.height) | 0;\n      var y = h - hertz * this.scale.hz2px;\n      return round ? y | 0 : +y;\n    },\n    dsec2width: function (seconds1, seconds2, round, inclusive) {\n      if (inclusive) {\n        seconds1 = align_to_interval(seconds1, this.domain.x, 1);\n      }\n\n      var w = (seconds1 - seconds2) * this.scale.sec2px;\n      return round ? w | 0 : +w;\n    },\n    dhz2height: function (hz1, hz2, round, inclusive) {\n      if (inclusive) {\n        hz1 = align_to_interval(hz1, this.domain.y, 1);\n      }\n\n      var h = (hz1 - hz2) * this.scale.hz2px;\n      return round ? h | 0 : +h;\n    },\n    apply: function (container, $scope, width, height, fix_scroll_center) {\n      var layout = $scope.visobject && $scope.visobject.layout;\n      this.type = layout || 'spectrogram';\n      this['apply_' + this.type](container, $scope, width, height, fix_scroll_center);\n\n      for (var eh = this.listeners, ehi = 0, ehe = eh.length; ehi < ehe; ++ehi) {\n        eh[ehi](this, container, $scope, width, height, fix_scroll_center);\n      }\n    },\n    apply_spectrogram: function (container, $scope, width, height, fix_scroll_center) {\n      var layout_tmp = this.tmp;\n      var visobject = $scope.visobject;\n      var domain = this.domain = get_domain(visobject);\n      var avail_w = width - layout_tmp.axis_sizew - layout_tmp.axis_lead;\n\n      if (domain.legend) {\n        avail_w -= layout_tmp.legend_width + layout_tmp.legend_gutter;\n      }\n\n      var avail_h = height - layout_tmp.axis_sizeh - layout_tmp.axis_lead - layout_tmp.gutter;\n      var cheight = container[0].clientHeight;\n      var zoom_levels_x = this.scale.zoom.levelx = [avail_w / domain.x.span, this.scale.max_sec2px];\n      var zoom_levels_y = this.scale.zoom.levely = [avail_h / domain.y.span, this.scale.max_hz2px];\n      var zoom_sec2px = interpolate(this.scale.zoom.x, zoom_levels_x);\n      var zoom_hz2px = interpolate(this.scale.zoom.y, zoom_levels_y);\n      var spec_w = Math.max(avail_w, Math.ceil(domain.x.span * zoom_sec2px));\n      var spec_h = Math.max(avail_h, Math.ceil(domain.y.span * zoom_hz2px));\n      var scalex = make_scale(domain.x, [0, spec_w]);\n      var scaley = make_scale(domain.y, [spec_h, 0]);\n      var scalelegend;\n      var l = this.l = {\n        visualizer_root: {\n          css: {\n            'overflow': ''\n          }\n        }\n      };\n      l.spectrogram = {\n        css: {\n          top: layout_tmp.axis_lead,\n          left: layout_tmp.axis_sizew,\n          width: spec_w,\n          height: spec_h\n        }\n      };\n      l.y_axis = {\n        scale: scaley,\n        css: {\n          top: 0,\n          left: container.scrollLeft()\n        },\n        attr: {\n          width: layout_tmp.axis_sizew,\n          height: spec_h + layout_tmp.axis_lead + layout_tmp.axis_sizeh\n        }\n      };\n      l.x_axis = {\n        scale: scalex,\n        css: {\n          left: layout_tmp.axis_sizew - layout_tmp.axis_lead,\n          // left : layout_tmp.axis_sizew -  layout_tmp.axis_lead,\n          top: container.scrollTop() + height - layout_tmp.axis_sizeh - layout_tmp.gutter\n        },\n        attr: {\n          height: layout_tmp.axis_sizeh,\n          width: spec_w + 2 * layout_tmp.axis_lead\n        }\n      };\n      this.has_legend = $scope.has_legend = !!domain.legend;\n\n      if (domain.legend) {\n        l.legend = {\n          scale: scalelegend,\n          css: {\n            top: 0,\n            left: container.scrollLeft() + width - a2BrowserMetrics.scrollSize.width - layout_tmp.legend_width - layout_tmp.legend_gutter\n          },\n          attr: {\n            width: layout_tmp.legend_width,\n            height: spec_h + 2 * layout_tmp.axis_lead\n          }\n        };\n        scalelegend = d3.scale.linear().domain([domain.legend.from, domain.legend.to]).range([spec_h - 2, 0]);\n      } else {\n        l.legend = {};\n      } //l.x_axis.attr.height = cheight - l.x_axis.css.top - 1;\n\n\n      ['spectrogram', 'y_axis', 'x_axis', 'legend'].forEach(function (i) {\n        var li = l[i];\n        this[i] = li.css;\n\n        if (li.attr) {\n          $.extend(this[i], li.attr);\n        }\n\n        if (li.scale) {\n          this[i].scale = li.scale;\n        }\n      }.bind(this));\n      this.offset.sec = domain.x.from;\n      this.offset.hz = domain.y.from;\n      this.scale.sec2px = spec_w / domain.x.span;\n      this.scale.hz2px = spec_h / domain.y.span;\n      this.viewport = {\n        left: l.spectrogram.css.left,\n        top: l.spectrogram.css.top,\n        width: avail_w,\n        height: avail_h\n      };\n      var sh = l.spectrogram.css.height;\n      var sw = l.spectrogram.css.width;\n      this.root = {\n        left: 0,\n        top: 0,\n        //width  : width,\n        //height : height,\n        width: width - (avail_h < sh ? a2BrowserMetrics.scrollSize.width : 0),\n        height: height - (avail_w < sw ? a2BrowserMetrics.scrollSize.height : 0)\n      };\n      var scroll_center;\n\n      if (this.center) {\n        scroll_center = {\n          left: this.scale.sec2px * this.center.s + l.spectrogram.css.left - width / 2.0,\n          top: -this.scale.hz2px * this.center.hz - height / 2.0 + l.spectrogram.css.top + l.spectrogram.css.height\n        };\n      }\n\n      l.domain = domain;\n      l.scroll_center = scroll_center;\n      l.scale = {\n        x: scalex,\n        y: scaley,\n        legend: scalelegend\n      };\n    },\n    apply_plotted: function (container, $scope, width, height, fix_scroll_center) {\n      var layout_tmp = this.tmp;\n      var visobject = $scope.visobject;\n      var avail_w = width;\n      var avail_h = height;\n      var cheight = container[0].clientHeight;\n      this.has_legend = $scope.has_legend = false;\n      var l = this.l = {\n        visualizer_root: {\n          css: {\n            'overflow': 'hidden'\n          }\n        }\n      };\n      l.spectrogram = {\n        css: {\n          top: 0,\n          left: 0,\n          width: avail_w,\n          height: avail_h\n        }\n      };\n      l.scroll_center = {\n        left: 0,\n        top: 0\n      };\n      this.spectrogram = l.spectrogram.css;\n      this.viewport = angular.extend(l.spectrogram.css);\n      this.root = {\n        left: 0,\n        top: 0,\n        width: width,\n        height: height\n      };\n    }\n  });\n});","angular.module('a2-visualizer-spectrogram-click2zoom', ['a2.classy']).service('a2SpectrogramClick2Zoom', function (makeClass, a22PointBBoxEditor) {\n  return makeClass({\n    super: a22PointBBoxEditor.prototype,\n    toggle_active: function () {\n      this.active = !this.active;\n\n      if (this.active) {\n        this.reset();\n      }\n    },\n    constructor: function (layout) {\n      this.super.constructor.call(this);\n      this.layout = layout;\n      this.active = false;\n    },\n    add_point: function (x, y, zoom) {\n      this.super.add_point.call(this, x, y);\n\n      if (zoom) {\n        this.zoom();\n      }\n    },\n    zoom_out: function () {\n      var layout = this.layout;\n      this.active = false;\n      layout.scale.zoom.x = Math.max(0, layout.scale.zoom.x - 0.1);\n      layout.scale.zoom.y = Math.max(0, layout.scale.zoom.y - 0.1);\n    },\n    zoom_reset: function () {\n      var layout = this.layout;\n      this.active = false;\n      layout.scale.zoom.x = 0;\n      layout.scale.zoom.y = 0;\n    },\n    zoom: function () {\n      var layout = this.layout;\n      var bbox = this.bbox;\n      var dx = bbox.x2 - bbox.x1,\n          dy = bbox.y2 - bbox.y1;\n      var cp = [(bbox.x2 + bbox.x1) / 2, (bbox.y2 + bbox.y1) / 2];\n      var avail_h = layout.viewport.height;\n      var avail_w = layout.viewport.width;\n      var lzoom = layout.scale.zoom;\n      var zoom_x = avail_w / dx,\n          zoom_y = avail_h / dy;\n      var zoom_level_x = Math.max(0, Math.min((zoom_x - lzoom.levelx[0]) / (lzoom.levelx[1] - lzoom.levelx[0]), 1));\n      var zoom_level_y = Math.max(0, Math.min((zoom_y - lzoom.levely[0]) / (lzoom.levely[1] - lzoom.levely[0]), 1));\n      this.active = false;\n      layout.center = {\n        s: cp[0],\n        hz: cp[1]\n      };\n      layout.scale.zoom.x = zoom_level_x;\n      layout.scale.zoom.y = zoom_level_y;\n      console.log(\"zoom :: \", [dx, dy], cp, [zoom_level_x, zoom_level_y]);\n    }\n  });\n}).directive('a2ZoomControl', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      'level': '='\n    },\n    templateUrl: '/directives/zoom-ctrl.html',\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var delta = +$attrs.delta || 0.1;\n      var horizontal = !!($attrs.horizontal | 0 || /on|yes|true/.test($attrs.horizontal + ''));\n      $scope.horizontal = horizontal;\n      $scope.switched = horizontal;\n\n      $scope.step = function (step) {\n        $scope.level = Math.min(1, Math.max($scope.level + step * delta, 0));\n      };\n\n      $scope.set_by_mouse = function ($event) {\n        var track = $element.find('.zoom-track'),\n            trackpos = track.offset();\n        var px = (track.width() - ($event.pageX - trackpos.left)) / track.width();\n        var py = (track.height() - ($event.pageY - trackpos.top)) / track.height(); // console.log('$scope.set_by_mouse', [px,py]);\n\n        var level = $scope.horizontal ? px : py;\n        $scope.level = $scope.switched ? 1 - level : level;\n      };\n    }\n  };\n});","/**\n * @ngdoc overview\n * @name a2-sidenav\n * @description\n * Directive for specifying a sidenav bar.\n * this bar specifies a list of links that can be added\n * whenever a corresponding sidenavbar anchor resides\n */\nangular.module('a2.directive.audio-bar', ['a2.utils', 'a2.srv.local-storage', 'a2.visualizer.audio-player']).directive('a2AudioBar', function (a2SidenavBarService, $parse) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/a2-audio-bar/a2-audio-bar.html',\n    scope: {},\n    replace: true,\n    controller: 'a2AudioBarCtrl as controller'\n  };\n}).factory('a2AudioBarService', function ($rootScope) {\n  return {\n    loadUrl: function (url, play) {\n      $rootScope.$broadcast('a2-audio-load-url', {\n        url: url,\n        play: play\n      });\n    }\n  };\n}).controller('a2AudioBarCtrl', function ($scope, $filter, a2AudioPlayer, $timeout, $q, $localStorage) {\n  Object.assign(this, {\n    initialize: function () {\n      this.audio_player = new a2AudioPlayer($scope);\n      this.expanded = false;\n      this.collapseTimeoutInterval = 6000;\n      this.loading = false;\n      this.audio_player.setGain($localStorage.getItem('a2-audio-param-gain') || 1);\n      this.deregHandlers = [];\n      this.deregHandlers.push($scope.$on('a2-audio-load-url', this.onLoadUrl.bind(this)));\n      this.deregHandlers.push($scope.$on('$destroy', this.onDestroy.bind(this)));\n    },\n    onLoadUrl: function (event, options) {\n      this.loadUrl(options);\n    },\n    onDestroy: function () {\n      (this.deregHandlers || []).forEach(function (fn) {\n        fn();\n      });\n    },\n    setCollapseTimer: function () {\n      if (this.collapseTimer) {\n        $timeout.cancel(this.collapseTimer);\n      }\n\n      if (this.collapseTimeoutInterval) {\n        this.collapseTimer = $timeout(function () {\n          this.expanded = false;\n        }.bind(this), this.collapseTimeoutInterval);\n      }\n    },\n    seekPercent: function (percent) {\n      return this.audio_player.setCurrentTime(percent * this.audio_player.resource.duration);\n    },\n    setGain: function (gain) {\n      this.setCollapseTimer();\n      $localStorage.setItem('a2-audio-param-gain', gain);\n      return this.audio_player.setGain(gain);\n    },\n    play: function () {\n      this.setCollapseTimer();\n      return this.audio_player.play();\n    },\n    pause: function () {\n      this.setCollapseTimer();\n      return this.audio_player.pause();\n    },\n    stop: function () {\n      this.setCollapseTimer();\n      return this.audio_player.stop();\n    },\n    toggleExpanded: function () {\n      this.expanded = !this.expanded;\n\n      if (this.expanded) {\n        this.setCollapseTimer();\n      }\n    },\n    loadUrl: function (options) {\n      options = options || {};\n      const url = options.url;\n      const play = options.play || options.play === undefined;\n\n      if (!url) {\n        return $q.resolve();\n      }\n\n      this.loading = true;\n      this.expanded = true;\n      return this.audio_player.load(url).then(function () {\n        this.loading = false;\n\n        if (play) {\n          return this.play();\n        }\n      }.bind(this)).catch(function (e) {\n        this.loading = false;\n        this.error = e;\n        console.error(e);\n      }.bind(this));\n    }\n  });\n  this.initialize(this);\n});","angular.module('arbimon.directive.a2-switch', []).directive('a2Switch', function () {\n  return {\n    restict: 'E',\n    templateUrl: '/directives/a2-switch/template.html',\n    require: 'ngModel',\n    scope: {\n      onText: '@',\n      offText: '@',\n      disabled: '='\n    },\n    link: function (scope, element, attrs, ngModelCtrl) {\n      scope.toggle = function (event) {\n        scope.value = !scope.value;\n        ngModelCtrl.$setViewValue(scope.value, event && event.type);\n      };\n\n      ngModelCtrl.$render = function () {\n        scope.value = !!ngModelCtrl.$viewValue;\n      };\n    }\n  };\n});","angular.module('a2.utils.facebook-login-button', ['a2.utils', 'a2.utils.global-anonymous-function', 'a2.utils.external-api-loader', 'a2.injected.data']).config(function (externalApiLoaderProvider) {\n  externalApiLoaderProvider.addApi('facebook', {\n    url: \"//connect.facebook.net/en_US/sdk.js\",\n    namespace: 'FB',\n    onload: [\"a2InjectedData\", function (a2InjectedData) {\n      this.module.init(a2InjectedData.facebook_api);\n    }]\n  });\n}).directive('a2FacebookLoginButton', function ($window, $q, $timeout, a2InjectedData, externalApiLoader) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/external/facebook-login-button.html',\n    scope: {\n      onSignedIn: '&?',\n      onError: '&?'\n    },\n    link: function (scope, element, attrs) {\n      element.children('.btn-facebook-login').addClass(element[0].className);\n      element[0].className = '';\n\n      scope.signIn = function () {\n        externalApiLoader.load('facebook').then(function (FB) {\n          FB.login(function (response) {\n            if (response.status === 'connected') {\n              console.log(response);\n              scope.onSignedIn({\n                user: response\n              });\n            } else if (response.status === 'not_authorized') {} else {}\n          }, {\n            scope: 'public_profile,email'\n          });\n        });\n      };\n    }\n  };\n});","angular.module('a2.utils.google-login-button', ['a2.utils', 'a2.utils.q-promisify', 'a2.utils.global-anonymous-function', 'a2.utils.external-api-loader', 'a2.injected.data']).config(function (externalApiLoaderProvider) {\n  externalApiLoaderProvider.addApi('google-api', {\n    url: \"https://apis.google.com/js/client.js\",\n    namespace: 'gapi',\n    jsonpCallback: 'onload'\n  });\n  externalApiLoaderProvider.addApi('google-api/auth2', {\n    parent: 'google-api',\n    loader: [\"$qPromisify\", function ($qPromisify) {\n      return $qPromisify.invoke(this.parent.module, 'load', 'auth2');\n    }],\n    onload: [\"a2InjectedData\", function (a2InjectedData) {\n      var auth2 = this.module.init({\n        client_id: a2InjectedData.google_oauth_client,\n        cookiepolicy: 'single_host_origin'\n      });\n      return auth2.then(function () {\n        this.module.auth2 = auth2;\n      }.bind(this));\n    }],\n    getCachedModule: function () {\n      return this.parent && this.parent.module && this.parent.module.auth2;\n    }\n  });\n}).directive('a2GoogleLoginButton', function ($window, $q, $timeout, globalAnonymousFunction, a2InjectedData, externalApiLoader) {\n  return {\n    restrict: 'E',\n    templateUrl: '/directives/external/google-login-button.html',\n    scope: {\n      onSignedIn: '&?',\n      onError: '&?'\n    },\n    link: function (scope, element, attrs) {\n      element.children('.btn-google-login').addClass(element[0].className);\n      element[0].className = '';\n\n      scope.signIn = function () {\n        externalApiLoader.load('google-api/auth2').then(function (auth2) {\n          auth2.auth2.signIn().then(function (user) {\n            scope.onSignedIn({\n              user: user\n            });\n          }, function (error) {\n            scope.onError({\n              error: error\n            });\n          });\n        });\n      };\n    }\n  };\n});","angular.module('a2.analysis.audio-event-detection', ['a2.filter.as-csv', 'a2.filter.time-from-now', 'a2.srv.resolve', 'a2.srv.open-modal', 'a2.service.audio-event-detection', 'a2.analysis.audio-event-detection.new-modal']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.audio-event-detection', {\n    url: '/audio-event-detection',\n    controller: 'AudioEventDetectionAnalysisStateCtrl as controller',\n    templateUrl: '/app/analysis/audio-event-detection/index.html'\n  });\n}).controller('AudioEventDetectionAnalysisStateCtrl', function ($q, $promisedResolve, $openModal, a2UserPermit) {\n  this.initialize = function () {\n    return this.reload();\n  };\n\n  this.reload = function () {\n    this.loading = true;\n    return $promisedResolve({\n      audioEventDetectionsList: [\"AudioEventDetectionService\", function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getList();\n      }]\n    }, this).then(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.new = function () {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to create audio event detections.');\n      return;\n    }\n\n    return $openModal('audio-event-detection.new-modal', {\n      resolve: {\n        onSubmit: [\"AudioEventDetectionService\", function (AudioEventDetectionService) {\n          return AudioEventDetectionService.new;\n        }]\n      }\n    });\n  };\n\n  this.initialize();\n});","angular.module('a2.analysis.audio-event-detection.new-modal', ['a2.srv.open-modal', 'a2.srv.resolve', 'a2.srv.playlists', 'humane', 'a2.directive.require-non-empty', 'a2.service.audio-event-detection']).config(function ($openModalProvider) {\n  $openModalProvider.define('audio-event-detection.new-modal', {\n    templateUrl: '/app/analysis/audio-event-detection/new-modal.html',\n    controllerAs: 'controller',\n    controller: 'NewAudioEventDetectionModalCtrl',\n    resolve: {\n      onSubmit: function () {\n        return null;\n      }\n    }\n  });\n}).constant('AudioEventDetectionParametersEditTemplateUrls', {\n  fltr: '/app/analysis/audio-event-detection/algorithm-fltr-edit-parameters.html'\n}).controller('NewAudioEventDetectionModalCtrl', function ($q, $modalInstance, $promisedResolve, $parse, notify, AudioEventDetectionParametersEditTemplateUrls, onSubmit) {\n  this.playlists = [];\n  this.algorithmsList = [];\n  this.statisticsList = [];\n  var getDefaultName = $parse(\"[\" + \"(playlist.name || '[Playlist]'), \" + \"(algorithm.name || '[Algorithm]'), \" + \"(parameters ? '(' + (parameters  | asCSV) + ')' : ''), \" + \"(date | moment:'ll')\" + \"] | asCSV:' / '\");\n\n  this.initialize = function () {\n    return this.reload().then(function () {\n      this.aed = {\n        algorithm: this.algorithmsList[0],\n        statistics: this.statisticsList.slice(),\n        playlist: null,\n        date: new Date()\n      };\n      this.notifyAedAlgorithmChanged();\n    }.bind(this));\n  };\n\n  this.reload = function () {\n    this.loading = true;\n    return $promisedResolve({\n      playlists: [\"a2Playlists\", function (a2Playlists) {\n        return a2Playlists.getList();\n      }],\n      algorithmsList: function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getAlgorithmsList();\n      },\n      statisticsList: function (AudioEventDetectionService) {\n        return AudioEventDetectionService.getStatisticsList();\n      }\n    }, this).then(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.notifyAedAlgorithmChanged = function () {\n    var algorithm = this.aed.algorithm || {};\n    this.aed.parameters = algorithm.defaults || {};\n    this.algorithmParametersTemplate = AudioEventDetectionParametersEditTemplateUrls[algorithm.name];\n    this.recomputeDefaultName();\n  };\n\n  this.recomputeDefaultName = function () {\n    this.aed.defaultName = getDefaultName(this.aed);\n  };\n\n  this.ok = function () {\n    return $q.resolve().then(function () {\n      return onSubmit && onSubmit(this.aed);\n    }.bind(this)).then(function () {\n      return $modalInstance.close(this.aed);\n    }.bind(this)).catch(function (error) {\n      notify.error(error);\n    });\n  };\n\n  this.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n\n  this.initialize();\n});","angular.module('a2.analysis.audio-event-detections-clustering', ['ui.bootstrap', 'a2.srv.audio-event-detections-clustering', 'a2.services', 'a2.permissions', 'humane', 'a2.directive.error-message']).config(function ($stateProvider) {\n  $stateProvider.state('analysis.audio-event-detections-clustering', {\n    url: '/audio-event-detections-clustering?newJob',\n    controller: 'AudioEventDetectionsClusteringModelCtrl',\n    templateUrl: '/app/analysis/audio-event-detections-clustering/list.html'\n  });\n}).controller('AudioEventDetectionsClusteringModelCtrl', function ($scope, $modal, $location, JobsData, notify, a2AudioEventDetectionsClustering, Project, $localStorage, $window, a2UserPermit, $state) {\n  var p = $state.params;\n  var isNewJob = p && p.newJob !== undefined;\n\n  $scope.loadAudioEventDetections = function () {\n    $scope.loading = true;\n    $scope.showRefreshBtn = false;\n    $scope.projectUrl = Project.getUrl();\n    return a2AudioEventDetectionsClustering.list({\n      user: true,\n      dataExtended: true,\n      completed: true,\n      aedCount: true\n    }).then(function (data) {\n      $scope.audioEventDetectionsOriginal = data;\n      $scope.audioEventDetectionsData = data;\n      $scope.loading = false;\n\n      if (data && data.length) {\n        $scope.showRefreshBtn = true;\n      }\n    });\n  };\n\n  $scope.loadAudioEventDetections();\n\n  $scope.onSelectedJob = function (playlist_id, job_id, first_playlist_recording) {\n    $localStorage.setItem('analysis.audioEventJob', job_id);\n    $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/' + playlist_id + '/' + first_playlist_recording;\n  };\n\n  $scope.createNewClusteringModel = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to create <br> Audio Event Detection job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/audio-event-detections-clustering/new-audio-event-detection-clustering.html',\n      controller: 'CreateNewAudioEventDetectionClusteringCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.create) {\n        JobsData.updateJobs();\n        $scope.showRefreshBtn = true;\n        notify.log(\"Your new Audio Event Detection Clustering model is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  if (isNewJob) {\n    $scope.createNewClusteringModel();\n  }\n\n  $scope.deleteAedJob = function (aedJob, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to delete <br> Audio Event Detection job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/audio-event-detections-clustering/delete-audio-event-detection-clustering-job.html',\n      controller: 'DeleteAedJobCtrl as controller',\n      resolve: {\n        aedJob: function () {\n          return aedJob;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error('Error: ' + ret.err);\n      } else {\n        const modArr = angular.copy($scope.audioEventDetectionsOriginal);\n        const indx = modArr.findIndex(function (item) {\n          return item.job_id === aedJob.job_id;\n        });\n\n        if (indx > -1) {\n          $scope.audioEventDetectionsOriginal.splice(indx, 1);\n          notify.log('Audio Event Detection Job deleted successfully');\n        }\n      }\n    });\n  };\n}).controller('DeleteAedJobCtrl', function ($scope, $modalInstance, a2AudioEventDetectionsClustering, aedJob) {\n  this.aedJob = aedJob;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2AudioEventDetectionsClustering.delete(aedJob.job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewAudioEventDetectionClusteringCtrl', function ($modalInstance, a2AudioEventDetectionsClustering, a2Playlists, a2UserPermit, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false\n      };\n      this.details = {\n        show: false\n      };\n      var list = this.list = {};\n      this.data = {\n        name: null,\n        playlist: null,\n        params: {\n          areaThreshold: 1,\n          amplitudeThreshold: 1,\n          durationThreshold: 0.2,\n          bandwidthThreshold: 0.5,\n          filterSize: 10,\n          minFrequency: 0,\n          maxFrequency: 24\n        }\n      };\n      this.isRfcxUser = a2UserPermit.isRfcx();\n      this.isSuper = a2UserPermit.isSuper();\n      this.errorJobLimit = false;\n      this.loading.playlists = true;\n      a2Playlists.getList().then(function (playlists) {\n        this.loading.playlists = false;\n        list.playlists = playlists;\n      }.bind(this));\n    },\n    isRfcx: function () {\n      return this.isRfcxUser || this.isSuper;\n    },\n    checkLimit: function (count) {\n      return count > 10000 && !this.isRfcx();\n    },\n    toggleDetails: function () {\n      this.details.show = !this.details.show;\n    },\n    newJob: function () {\n      try {\n        return a2AudioEventDetectionsClustering.create({\n          playlist_id: this.data.playlist.id,\n          name: this.data.name,\n          params: this.data.params\n        }).then(function (clusteringModel) {\n          $modalInstance.close({\n            create: true,\n            clusteringModel: clusteringModel\n          });\n        }).catch(notify.serverError);\n      } catch (error) {\n        console.error('a2AudioEventDetectionsClustering.create error: ' + error);\n      }\n    },\n    create: function () {\n      var _this = this;\n\n      this.errorJobLimit = false;\n      if (this.isRfcx()) return this.newJob();\n      return a2AudioEventDetectionsClustering.count().then(function (data) {\n        if (_this.checkLimit(data.totalRecordings)) {\n          _this.errorJobLimit = true;\n          return;\n        } else _this.newJob();\n      });\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isJobValid: function () {\n      return this.data && this.data.name && this.data.name.length > 3 && this.data.playlist && !this.isNotDefined(this.data.params.maxFrequency) && !this.isNotDefined(this.data.params.minFrequency);\n    },\n    showNameWarning: function () {\n      return this.data && this.data.name && this.data.name.length > 1 && this.data.name.length < 4;\n    },\n    showPlaylistLimitWarning: function () {\n      if (!this.data && !this.data.playlist) return;\n      return this.data && this.data.playlist && this.data.playlist.count > 2000 && !this.isRfcx();\n    },\n    showFrequencyWarning: function () {\n      return this.data.params.maxFrequency <= this.data.params.minFrequency;\n    },\n    isNotDefined: function (item) {\n      return item === undefined || item === null;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.analysis.clustering-jobs', ['ui.bootstrap', 'a2.srv.clustering-jobs', 'a2.srv.playlists', 'a2.services', 'a2.permissions', 'a2.directive.audio-bar', 'humane', 'a2.filter.round', 'a2.directive.frequency_filter_range_control']).config(function ($stateProvider) {\n  $stateProvider.state('analysis.clustering-jobs', {\n    url: '/clustering-jobs',\n    controller: 'ClusteringJobsModelCtrl',\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  }).state('analysis.clustering-jobs-details', {\n    url: '/clustering-jobs/:clusteringJobId?freqMin&freqMax',\n    controller: 'ClusteringJobsModelCtrl',\n    params: {\n      freqMin: null,\n      freqMax: null\n    },\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  }).state('analysis.grid-view', {\n    url: '/clustering-jobs/:clusteringJobId/grid-view',\n    controller: 'ClusteringJobsModelCtrl',\n    params: {\n      gridContext: null\n    },\n    templateUrl: '/app/analysis/clustering-jobs/list.html'\n  });\n}) //------------------- Clustering List page ---------------\n.controller('ClusteringJobsModelCtrl', function ($scope, $state, $stateParams, a2ClusteringJobs, JobsData, notify, $location, $modal, a2UserPermit, $localStorage, Project) {\n  $scope.selectedClusteringJobId = $stateParams.clusteringJobId;\n  $scope.showViewGridPage = false;\n  $scope.getProjectData = function () {\n    Project.getInfo(function (info) {\n      $scope.isProjectDisabled = info.disabled === 1;\n    });\n  }, $scope.getProjectData();\n\n  $scope.loadClusteringJobs = function () {\n    $scope.loading = true;\n    $scope.showRefreshBtn = false;\n    return a2ClusteringJobs.list({\n      completed: true\n    }).then(function (data) {\n      $scope.clusteringJobsOriginal = data;\n      $scope.clusteringJobsData = data;\n      $scope.loading = false;\n\n      if (data && data.length) {\n        $scope.showRefreshBtn = true;\n      }\n    });\n  };\n\n  if (!$scope.selectedClusteringJobId) {\n    $scope.loadClusteringJobs();\n  } // Parse grid view data if it exists\n\n\n  const gridContext = JSON.parse($localStorage.getItem('analysis.gridContext'));\n\n  if ($stateParams.gridContext || gridContext && $state.current.name === 'analysis.grid-view') {\n    $scope.showViewGridPage = true;\n    $scope.gridContext = $stateParams.gridContext ? $stateParams.gridContext : gridContext;\n  } else {\n    $localStorage.setItem('analysis.gridContext', null);\n  }\n\n  $scope.selectItem = function (clusteringJob) {\n    if (!clusteringJob) {\n      $state.go('analysis.clustering-jobs', {});\n    } else {\n      $state.go('analysis.clustering-jobs-details', {\n        clusteringJobId: clusteringJob.clustering_job_id\n      });\n    }\n  };\n\n  $scope.createNewClusteringJob = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to create Clustering job');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/new-clustering-job.html',\n      controller: 'CreateNewClusteringJobCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.create) {\n        JobsData.updateJobs();\n        $scope.showRefreshBtn = true;\n        notify.log(\"Your new clustering job is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteClusteringJob = function (clusteringJob, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.log('You do not have permission to delete Clustering job');\n      return;\n    }\n\n    const modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/delete-clustering-job.html',\n      controller: 'DeleteClusteringJobCtrl as controller',\n      resolve: {\n        clusteringJob: function () {\n          return clusteringJob;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error('Error: ' + ret.err);\n      } else {\n        const modArr = angular.copy($scope.clusteringJobsOriginal);\n        const indx = modArr.findIndex(function (item) {\n          return item.clustering_job_id === clusteringJob.clustering_job_id;\n        });\n\n        if (indx > -1) {\n          $scope.clusteringJobsOriginal.splice(indx, 1);\n          notify.log('Clustering Job deleted successfully');\n        }\n      }\n    });\n  };\n}).controller('DeleteClusteringJobCtrl', function ($scope, $modalInstance, a2ClusteringJobs, clusteringJob) {\n  this.clusteringJob = clusteringJob;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2ClusteringJobs.delete(clusteringJob.clustering_job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}) //------------------- Clustering Details page ---------------\n.directive('a2ClusteringDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      clusteringJobId: '=',\n      detailedView: '=',\n      onSetDetailedView: '&',\n      onGoBack: '&'\n    },\n    controller: 'ClusteringDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/clustering-jobs/details.html'\n  };\n}).controller('ClusteringDetailsCtrl', function ($scope, $state, $location, a2ClusteringJobs, $window, Project, a2Playlists, $localStorage, $modal, a2UserPermit) {\n  var d3 = $window.d3;\n  $scope.loading = true;\n  $scope.toggleMenu = false;\n  $scope.selectedCluster = null;\n  var timeout;\n  $scope.frequencyFilter = {\n    min: null,\n    max: null,\n    currentMin: null,\n    currentMax: null\n  };\n\n  $scope.decrementClusters = function () {\n    if ($scope.selectedCluster === 1) return;\n    $scope.selectedCluster -= 1;\n    $scope.selectCluster();\n  };\n\n  $scope.incrementClusters = function () {\n    if ($scope.selectedCluster === $scope.layout.shapes.length) return;\n    $scope.selectedCluster += 1;\n    $scope.selectCluster();\n  }; // Select one cluster\n\n\n  $scope.selectCluster = function () {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      if ($scope.selectedCluster !== null) {\n        $(\"#plotly .select-outline\").remove();\n        $scope.layout.shapes.forEach(function (shape) {\n          shape.line.color = shape.fillcolor;\n          shape.line['stroke-width'] = 1;\n        });\n        var selection = $scope.layout.shapes[$scope.selectedCluster - 1];\n        selection.line.color = '#ffffff';\n        Plotly.relayout(document.getElementById('plotly'), {\n          'selection.line.color': '#ff0000',\n          'selection.line.opacity': 1,\n          'selection.line.stroke-width': 4\n        }); // Example: 3:[0, 1, 2, 3, 4] , where 3 - index of a cluster, array with the index of detections\n\n        $scope.points = [];\n        $scope.points[$scope.selectedCluster - 1] = [];\n        $scope.points[$scope.selectedCluster - 1] = $scope.getShapePoints();\n        $scope.toggleMenu = true;\n        $scope.$apply();\n      }\n    }, 2000);\n  };\n\n  $scope.getShapePoints = function () {\n    var arr = [];\n    var clusters = $scope.isFilteredClusters() ? $scope.sortFilteredData({\n      min: $location.search().freqMin,\n      max: $location.search().freqMax\n    }) : $scope.clusters;\n    var selectedAedList = Object.values(clusters)[$scope.selectedCluster - 1].aed;\n\n    if (selectedAedList && selectedAedList.length) {\n      selectedAedList.forEach(function (item, ind) {\n        arr.push(ind);\n      });\n    }\n\n    return arr;\n  };\n\n  var getClusteringDetails = function () {\n    $scope.infopanedata = '';\n    a2ClusteringJobs.getJobDetails($scope.clusteringJobId).then(function (data) {\n      if (data) $scope.job_details = data;\n    }).catch(function (err) {\n      console.log(err);\n    }); // Get json file which is included aed_id, clusters names, x, y points.\n\n    a2ClusteringJobs.getClusteringDetails({\n      job_id: $scope.clusteringJobId\n    }).then(function (res) {\n      $scope.loading = false;\n\n      if (res && res.aed_id) {\n        $scope.countAudioEventDetected = res.aed_id.length; // Collect clusters data.\n\n        $scope.clusters = {};\n        res.cluster.forEach(function (item, i) {\n          if (!$scope.clusters[item]) {\n            $scope.clusters[item] = {\n              x: [res.x_coord[i]],\n              y: [res.y_coord[i]],\n              aed: [res.aed_id[i]],\n              freq_low: [],\n              freq_high: []\n            };\n          } else {\n            $scope.clusters[item].x.push(res.x_coord[i]);\n            $scope.clusters[item].y.push(res.y_coord[i]);\n            $scope.clusters[item].aed.push(res.aed_id[i]);\n          }\n        }); // Get json file which is included aed_id, recordings, frequency data for the frequency filter.\n\n        a2ClusteringJobs.getClusteringDetails({\n          job_id: $scope.clusteringJobId,\n          aed_info: true\n        }).then(function (data) {\n          if (data !== undefined) {\n            $scope.aedDataInfo = data; // Create frequency object to collect min and max values for the frequency filter.\n\n            $scope.frequency = {\n              freq_low: [],\n              freq_high: []\n            }; // Add frequency min, max values to the clusters array.\n\n            for (var c in $scope.clusters) {\n              if ($scope.clusters[c] && $scope.clusters[c].aed && $scope.clusters[c].aed.length) {\n                $scope.clusters[c].aed.forEach(function (aed) {\n                  const indx = data.aed_id.findIndex(function (item) {\n                    return item === aed;\n                  });\n\n                  if (indx !== -1) {\n                    // Collect frequency min and max values for the frequency filter.\n                    $scope.frequency.freq_low.push(data.freq_low[indx]);\n                    $scope.frequency.freq_high.push(data.freq_high[indx]);\n                    $scope.clusters[c].freq_low.push(data.freq_low[indx]);\n                    $scope.clusters[c].freq_high.push(data.freq_high[indx]);\n                  }\n                });\n              }\n            } // Find frequency min and max values for frequency filter.\n\n\n            $scope.frequencyFilter.min = Math.min.apply(null, $scope.frequency.freq_low);\n            $scope.frequencyFilter.max = Math.max.apply(null, $scope.frequency.freq_high);\n\n            if ($scope.isFilteredClusters()) {\n              $scope.useFrequencyFilterData({\n                min: parseInt($location.search().freqMin),\n                max: parseInt($location.search().freqMax)\n              });\n            }\n          }\n        }).catch(function (err) {\n          console.log(err);\n        });\n        $scope.countClustersDetected = Object.keys($scope.clusters).length;\n\n        if (!$scope.isFilteredClusters()) {\n          drawClusteringPoints($scope.clusters);\n        }\n      }\n    }).catch(function (err) {\n      console.log(err);\n      $scope.loading = false;\n      $scope.infopanedata = 'No data for clustering job found.';\n    });\n  };\n\n  $scope.isFilteredClusters = function () {\n    return $location.search().freqMin && $location.search().freqMax;\n  };\n\n  $scope.isEmpty = function () {\n    return $scope.countAudioEventDetected !== undefined && $scope.countAudioEventDetected === 0 && !$scope.loading;\n  };\n\n  $scope.aedsDetected = function () {\n    if ($scope.countAudioEventDetected === undefined && $scope.loading) return '';\n    if ($scope.countAudioEventDetected === undefined && !$scope.loading) return 'no data';\n    return $scope.countAudioEventDetected;\n  };\n\n  $scope.clustersDetected = function () {\n    if ($scope.countClustersDetected === undefined && $scope.loading) return '';\n    if ($scope.countClustersDetected === undefined && !$scope.loading) return 'no data';\n    return $scope.countClustersDetected;\n  };\n\n  var drawClusteringPoints = function (clusters) {\n    var el = document.getElementById('plotly');\n    var data = [];\n    var shapes = [];\n    $scope.originalData = [];\n\n    for (var c in clusters) {\n      // Collect data for points.\n      data.push({\n        x: clusters[c].x,\n        y: clusters[c].y,\n        type: 'scatter',\n        mode: 'markers',\n        hoverinfo: 'none',\n        name: c,\n        marker: {\n          size: 6\n        }\n      }); // Collect data for shapes.\n\n      shapes.push({\n        type: 'circle',\n        xref: 'x',\n        yref: 'y',\n        x0: d3.min(clusters[c].x),\n        y0: d3.min(clusters[c].y),\n        x1: d3.max(clusters[c].x),\n        y1: d3.max(clusters[c].y),\n        opacity: 0.2\n      }); // Collect data for grid view page.\n\n      $scope.originalData.push({\n        x: clusters[c].x,\n        y: clusters[c].y,\n        cluster: c,\n        aed: clusters[c].aed\n      });\n    } // Shapes layout.\n\n\n    $scope.layout = {\n      shapes: shapes,\n      height: el ? el.offsetWidth - el.offsetWidth / 3 : 800,\n      width: el ? el.offsetWidth : 1390,\n      showlegend: true,\n      dragmode: 'lasso',\n      legend: {\n        title: {\n          text: 'Clusters names',\n          side: 'top',\n          font: {\n            size: 12\n          }\n        },\n        x: 1,\n        xanchor: 'right',\n        y: 1,\n        itemclick: 'toggleothers',\n        font: {\n          color: 'white'\n        }\n      },\n      paper_bgcolor: '#232436',\n      plot_bgcolor: '#232436',\n      xaxis: {\n        color: 'white',\n        title: 'Component 2',\n        side: 'top'\n      },\n      yaxis: {\n        color: 'white',\n        title: 'Component 1'\n      }\n    }; // Function to get color.\n\n    function getColor(n) {\n      const rgb = [0, 0, 0];\n\n      for (var i = 0; i < 24; i++) {\n        rgb[i % 3] <<= 1;\n        rgb[i % 3] |= n & 0x01;\n        n >>= 1;\n      }\n\n      return '#' + rgb.reduce(function (a, c) {\n        return (c > 0x0f ? c.toString(16) : '0' + c.toString(16)) + a;\n      }, '');\n    } // Make random color for shapes and points.\n\n\n    $scope.layout.shapes.forEach(function (shape, i) {\n      var color = getColor(i + 1);\n      data[i].marker = {\n        color: color\n      };\n      shape.fillcolor = color;\n      shape.line = {\n        color: color,\n        'stroke-width': 1\n      };\n    });\n\n    $scope.resetSelect = function () {\n      $scope.toggleMenu = false;\n      $scope.$apply();\n      $scope.layout.shapes.forEach(function (shape) {\n        shape.line.color = shape.fillcolor;\n        shape.line['stroke-width'] = 1;\n      });\n      Plotly.redraw(el);\n      $scope.$apply();\n    };\n\n    if (el) {\n      var config = {\n        scrollZoom: true,\n        displayModeBar: true,\n        displaylogo: false,\n        hoverdistance: 5\n      }; // To draw points\n\n      Plotly.newPlot(el, data, $scope.layout, config);\n      dragLayer = document.getElementsByClassName('nsewdrag')[0];\n      $scope.xAxisRangeStart = $scope.layout.xaxis.range[0]; // Hover on plotly\n\n      el.on('plotly_hover', function (data) {\n        if ($scope.layout.dragmode === 'lasso') {\n          dragLayer.classList.add('lasso-cursor');\n        }\n      }); // Zoom on plotly\n\n      el.on('plotly_unhover', function (data) {\n        dragLayer.classList.remove('lasso-cursor');\n      });\n      el.on('plotly_relayouting', function (data) {\n        if (data['xaxis.range[0]'] > $scope.xAxisRangeStart) {\n          dragLayer.classList.remove('zoom-out-cursor');\n          dragLayer.classList.add('zoom-in-cursor');\n          $scope.xAxisRangeStart = data['xaxis.range[0]'];\n        }\n\n        if (data['xaxis.range[0]'] < $scope.xAxisRangeStart) {\n          dragLayer.classList.remove('zoom-in-cursor');\n          dragLayer.classList.add('zoom-out-cursor');\n          $scope.xAxisRangeStart = data['xaxis.range[0]'];\n        }\n      });\n      el.on('plotly_relayout', function (data) {\n        dragLayer.classList.remove('zoom-out-cursor');\n        dragLayer.classList.remove('zoom-in-cursor');\n      }); // Click on a point\n\n      el.on('plotly_click', function (data) {\n        console.log('plotly_click', data);\n        $(\"#plotly .select-outline\").remove();\n        $scope.resetSelect();\n        $scope.points = {\n          x: data.points[0].x,\n          y: data.points[0].y,\n          name: data.points[0].fullData.name\n        };\n        $scope.layout.shapes.forEach(function (shape, i) {\n          if ($scope.points.x >= shape.x0 && $scope.points.x <= shape.x1 && $scope.points.y >= shape.y0 && $scope.points.y <= shape.y1) {\n            $scope.layout.shapes[i].line.color = '#ffffff';\n            Plotly.relayout(el, {\n              '$scope.layout.shapes[i].line.color': '#ff0000',\n              '$scope.layout.shapes[i].line.stroke-width': 4\n            });\n            $scope.toggleMenu = true;\n            $scope.$apply();\n          }\n        });\n      }); // Select a group of points.\n\n      el.on('plotly_selected', function (data) {\n        if (!data) {\n          $(\"#plotly .select-outline\").remove();\n        }\n\n        ;\n        console.log('plotly_selected', data);\n        $scope.points = []; // Collect selected points indexes in the points array.\n\n        if (data && data.points && data.points.length) {\n          data.points.forEach(function (point) {\n            var cluster = point.curveNumber;\n\n            if (!$scope.points[cluster]) {\n              $scope.points[cluster] = [];\n            }\n\n            ; // Example: 3:[0, 1, 2, 3, 4] , where 3 - index of a cluster, array with the index of detections\n\n            $scope.points[cluster].push(point.pointNumber);\n          });\n          $scope.toggleMenu = true;\n          $scope.$apply();\n        }\n      });\n    }\n  }; // Navigates to the Grid View page.\n\n\n  $scope.onGridViewSelected = function () {\n    $scope.toggleMenu = false;\n    $scope.selectedCluster = null;\n    $scope.showViewGridPage = true; // View all clusters\n\n    if (!$scope.points) {\n      $scope.gridContext = $scope.originalData;\n    } // Get points in different clusters, when the user selects dots by lasso or with the cluster selector\n    else if ($scope.points.length) {\n        $scope.gridContext = {};\n        $scope.points.forEach(function (row, i) {\n          $scope.gridContext[i] = {\n            aed: $scope.originalData[i].aed.filter(function (a, i) {\n              return row.includes(i);\n            }),\n            name: $scope.originalData[i].cluster\n          };\n        });\n      } // Get selected cluster with all points in the shape\n      else {\n          $scope.gridContext = $scope.originalData.find(function (shape) {\n            return shape.x.includes($scope.points.x) && shape.y.includes($scope.points.y);\n          });\n        }\n\n    $state.go('analysis.grid-view', {\n      clusteringJobId: $scope.clusteringJobId,\n      gridContext: $scope.gridContext\n    });\n  }; // Navigates to the Visualizer page.\n\n\n  $scope.showClustersInVisualizer = function () {\n    if ($scope.points.length) {\n      $scope.selectedClusters = {\n        aed: []\n      };\n\n      for (var r in $scope.points) {\n        $scope.originalData[r].aed.forEach(function (a, i) {\n          if ($scope.points[r].includes(i)) {\n            $scope.selectedClusters.aed.push(a);\n          }\n\n          ;\n        });\n      }\n    } else {\n      // User selects any point in one shape. It have to process all points in a shape\n      $scope.selectedClusters = $scope.originalData.find(function (shape) {\n        return shape.x.includes($scope.points.x) && shape.y.includes($scope.points.y);\n      });\n    } // Save temporary palylist with selected clusters to the local storage.\n\n\n    if ($scope.selectedClusters && $scope.selectedClusters.aed && $scope.selectedClusters.aed.length) {\n      if ($scope.aedDataInfo !== undefined) {\n        $scope.selectedClusters.boxes = {};\n        var recIds = [];\n        $scope.selectedClusters.aed.forEach(function (id) {\n          const indx = $scope.aedDataInfo.aed_id.findIndex(function (item) {\n            return item === id;\n          });\n          recIds.push($scope.aedDataInfo.recording_id[indx]);\n          var box = ['box', $scope.aedDataInfo.time_min[indx], $scope.aedDataInfo.freq_low[indx], $scope.aedDataInfo.time_max[indx], $scope.aedDataInfo.freq_high[indx]].join(',');\n\n          if (!$scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]]) {\n            $scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]] = [box];\n          } else {\n            $scope.selectedClusters.boxes[$scope.aedDataInfo.recording_id[indx]].push(box);\n          }\n        });\n        $scope.removeFromLocalStorage();\n        tempPlaylistData = {};\n        tempPlaylistData.aed = $scope.selectedClusters.aed;\n        tempPlaylistData.boxes = $scope.selectedClusters.boxes;\n        tempPlaylistData.playlist = {\n          id: 0,\n          name: 'cluster_' + recIds.join(\"_\"),\n          recordings: recIds.filter(function (id, i, a) {\n            return a.indexOf(id) === i;\n          }),\n          count: recIds.filter(function (id, i, a) {\n            return a.indexOf(id) === i;\n          }).length\n        };\n        $localStorage.setItem('analysis.clusters', JSON.stringify(tempPlaylistData));\n        $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/0?clusters';\n      }\n    }\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  };\n\n  $scope.savePlaylist = function (opts) {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to manage AED and Clustering job');\n      return;\n    }\n\n    a2Playlists.create(opts, function (data) {\n      if (data && data.playlist_id) {\n        $window.location.href = '/project/' + Project.getUrl() + '/visualizer/playlist/' + data.playlist_id + '?clusters';\n      }\n    });\n  };\n\n  $scope.showDetailsPage = function () {\n    return !$scope.loading && !$scope.infopanedata && !$scope.gridViewSelected;\n  };\n\n  $scope.openFreqFilterModal = function () {\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/clustering-jobs/frequency-filter.html',\n      controller: 'a2ClusterFrequencyFilterModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            frequency: $scope.frequencyFilter\n          };\n        }\n      }\n    });\n    modalInstance.result.then(function (result) {\n      if (!result) {\n        return;\n      }\n\n      $scope.useFrequencyFilterData(result);\n    });\n  };\n\n  $scope.sortFilteredData = function (result) {\n    var clusters = {};\n\n    for (var c in $scope.clusters) {\n      if ($scope.clusters[c].aed.length) {\n        clusters[c] = {};\n        clusters[c].y = [];\n        clusters[c].x = [];\n        clusters[c].aed = []; // Find filtered points in each cluster from the user selection.\n\n        $scope.clusters[c].freq_high.forEach(function (freq_high, i) {\n          if ($scope.clusters[c].freq_low[i] >= result.min && freq_high <= result.max) {\n            clusters[c].y.push($scope.clusters[c].y[i]);\n            clusters[c].x.push($scope.clusters[c].x[i]);\n            clusters[c].aed.push($scope.clusters[c].aed[i]);\n          }\n        });\n\n        if (!clusters[c].aed.length) {\n          delete clusters[c];\n        }\n      }\n    }\n\n    return clusters;\n  };\n\n  $scope.useFrequencyFilterData = function (result) {\n    $scope.frequencyFilter.currentMin = result.min;\n    $scope.frequencyFilter.currentMax = result.max;\n    $state.params.freqMin = $scope.frequencyFilter.currentMin;\n    $state.params.freqMax = $scope.frequencyFilter.currentMax;\n    $location.search('freqMin', $scope.frequencyFilter.currentMin);\n    $location.search('freqMax', $scope.frequencyFilter.currentMax);\n    var clusters = $scope.sortFilteredData(result);\n    $scope.countClustersDetected = Object.keys(clusters).length;\n    $scope.countAudioEventDetected = Object.values(clusters).map(function (cluster) {\n      return cluster.aed.length;\n    }).reduce(function (sum, current) {\n      return sum + current;\n    }, 0); // Display filtered points from after selection in the frequency filter.\n\n    drawClusteringPoints(clusters);\n  };\n\n  getClusteringDetails();\n}).controller('a2ClusterFrequencyFilterModalController', function ($scope, $modalInstance, data, Project) {\n  $scope.filterData = {};\n  $scope.filterData.max_freq = data.frequency.max;\n  $scope.filterData.src = \"/legacy-api/project/\" + Project.getUrl() + \"/recordings/tiles/3298382/0/0\";\n  $scope.has_previous_filter = true;\n  $scope.frequency = data.frequency && data.frequency.currentMax ? {\n    min: angular.copy(data.frequency.currentMin),\n    max: data.frequency.currentMax\n  } : {\n    min: 0,\n    max: $scope.filterData.max_freq\n  };\n\n  $scope.remove_filter = function () {\n    $modalInstance.close({\n      min: data.frequency.min,\n      max: data.frequency.max\n    });\n  };\n\n  $scope.apply_filter = function () {\n    $modalInstance.close($scope.frequency);\n  };\n}).controller('CreateNewClusteringJobCtrl', function ($modalInstance, a2ClusteringJobs, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        jobs: false,\n        saving: false\n      };\n      var list = this.list = {};\n      this.data = {\n        name: null,\n        aed_job: {},\n        params: {\n          minPoints: 3,\n          distanceThreshold: 0.1,\n          maxClusterSize: 100\n        }\n      };\n      this.timeout;\n      this.loading.jobs = true;\n      a2ClusteringJobs.audioEventDetections({\n        completed: true\n      }).then(function (jobs) {\n        this.loading.jobs = false;\n        list.jobs = jobs.map(function (job) {\n          return {\n            name: job.name,\n            jobId: job.job_id\n          };\n        });\n      }.bind(this));\n    },\n    create: function () {\n      var _this = this;\n\n      this.loading.saving = true;\n\n      try {\n        return a2ClusteringJobs.create({\n          name: this.data.name,\n          aed_job: this.data.aed_job,\n          params: this.data.params\n        }).then(function (clusteringModel) {\n          $modalInstance.close({\n            create: true,\n            clusteringModel: clusteringModel\n          });\n        }.bind(this));\n      } catch (error) {\n        this.loading.saving = false;\n        console.error(error);\n      }\n\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        _this.loading.saving = false;\n      }, 2000);\n    },\n    cancel: function (url) {\n      this.loading.jobs = false;\n      this.loading.saving = false;\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isJobValid: function () {\n      return this.data && this.data.name && this.data.name.length > 3 && this.data.aed_job;\n    }\n  });\n  this.initialize();\n}) //------------------- Gid View page ---------------\n.directive('a2GridView', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      clusteringJobId: '=',\n      gridContext: '=',\n      onGoBack: '&'\n    },\n    controller: 'GridViewCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/clustering-jobs/grid-view.html'\n  };\n}).controller('ExportReportModalCtrl', function ($scope, $modalInstance, a2ClusteringJobs, data) {\n  $scope.userEmail = data.userEmail;\n\n  $scope.accessExportReport = function (email) {\n    data.userEmail = email;\n    $scope.isExporting = true;\n    $scope.errMess = '';\n    a2ClusteringJobs.exportClusteringROIs(data).then(function (data) {\n      $scope.isExporting = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        $modalInstance.close();\n      }\n    });\n  };\n\n  $scope.changedUserEmail = function () {\n    $scope.errMess = null;\n  };\n}).controller('GridViewCtrl', function ($scope, $http, a2UserPermit, a2ClusteringJobs, a2AudioBarService, a2AudioEventDetectionsClustering, Project, Songtypes, a2Playlists, notify, $modal, $localStorage) {\n  $scope.loading = true;\n  $scope.isSquareSize = false;\n  $scope.infopanedata = '';\n  $scope.projectUrl = Project.getUrl();\n  $scope.allRois = [];\n  $scope.selectedRois = [];\n  $scope.paginationSettings = {\n    page: 1,\n    limit: 100,\n    offset: 0,\n    totalItems: 0,\n    totalPages: 0\n  };\n  $scope.lists = {\n    search: [{\n      value: 'all',\n      text: 'All',\n      description: 'Show all matched rois.'\n    }, {\n      value: 'per_cluster',\n      text: 'Sort per Cluster',\n      description: 'Show all rois ranked per Cluster.'\n    }, {\n      value: 'per_site',\n      text: 'Sort per Site',\n      description: 'Show all rois ranked per Site.'\n    }, {\n      value: 'per_date',\n      text: 'Sort per Date',\n      description: 'Show all rois sorted per Date.'\n    }, {\n      value: 'per_species',\n      text: 'Sort per Species',\n      description: 'Show all rois sorted per Species.'\n    }],\n    validation: [{\n      class: \"fa val-1\",\n      text: 'Present',\n      value: 1\n    }, {\n      class: \"fa val-0\",\n      text: 'Not Present',\n      value: 0\n    }, {\n      class: \"fa val-null\",\n      text: 'Clear',\n      value: -1\n    }]\n  };\n  $scope.validation = {\n    status: $scope.lists.validation[2]\n  };\n  $scope.selectedFilterData = $scope.lists.search[1];\n  $scope.playlistData = {};\n  $scope.aedData = {\n    count: 0,\n    id: []\n  };\n  $scope.speciesLoading = false;\n  $scope.selected = {\n    species: null,\n    songtype: null\n  };\n  var timeout;\n  var isShiftKeyHolding = false;\n\n  if ($scope.gridContext && $scope.gridContext.aed) {\n    $scope.gridData = [];\n    $scope.gridData.push($scope.gridContext);\n    $scope.aedData.count = 1;\n    $scope.gridContext.aed.forEach(function (i) {\n      return $scope.aedData.id.push(i);\n    });\n  } else {\n    $scope.gridData = Object.values($scope.gridContext);\n    $scope.aedData.count = $scope.gridData.length;\n    $scope.gridData.forEach(function (data) {\n      data.aed.forEach(function (i) {\n        return $scope.aedData.id.push(i);\n      });\n    });\n  }\n\n  $localStorage.setItem('analysis.gridContext', JSON.stringify($scope.gridContext));\n  a2ClusteringJobs.getJobDetails($scope.clusteringJobId).then(function (data) {\n    if (data) $scope.job_details = data;\n  }).catch(function (err) {\n    console.log(err);\n  });\n\n  $scope.onSearchChanged = function (item) {\n    $scope.selectedFilterData = item;\n    $scope.getRoisDetails(true).then(function () {\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        $scope.markBoxesAsSelected();\n        $scope.updateInputState();\n      }, 100);\n    });\n  };\n\n  $scope.setCurrentPage = function () {\n    this.paginationSettings.offset = $scope.paginationSettings.page - 1;\n    $scope.getRoisDetails();\n  };\n\n  $scope.showPagination = function () {\n    // if ($scope.selectedFilterData.value === 'per_cluster') {\n    //     return $scope.paginationSettings.totalItems && ($scope.gridData.length && $scope.gridData.length > 1)\n    // } else {\n    return $scope.paginationSettings.totalItems && $scope.paginationSettings.totalItems > $scope.paginationSettings.limit; // }\n  };\n\n  $scope.getRoisDetails = function (isFilterChanged) {\n    if (!$scope.aedData.id.length) {\n      return $scope.getStatusForEmptyData();\n    }\n\n    $scope.rows = [];\n    var aedData;\n    $scope.isRoisLoading = true;\n\n    if (isFilterChanged) {\n      $scope.paginationSettings.page = 1;\n      $scope.paginationSettings.offset = 0;\n    } // if ($scope.selectedFilterData.value === 'per_cluster') {\n    //     aedData = $scope.gridData[$scope.paginationSettings.page-1].aed;\n    //     $scope.paginationSettings.totalItems = $scope.gridData.length;\n    //     $scope.paginationSettings.limit = 1;\n    // } else {\n\n\n    $scope.paginationSettings.limit = 100;\n    $scope.paginationSettings.totalItems = $scope.aedData.id.length;\n    aedData = $scope.aedData.id.filter(function (id, i, a) {\n      return i >= $scope.paginationSettings.offset * $scope.paginationSettings.limit && i < $scope.paginationSettings.page * $scope.paginationSettings.limit;\n    }); // }\n\n    return a2ClusteringJobs.getRoisDetails({\n      jobId: $scope.clusteringJobId,\n      aed: aedData,\n      search: $scope.selectedFilterData.value\n    }).then(function (data) {\n      const groupedData = [];\n      Object.values($scope.gridData).forEach(function (cluster) {\n        Object.entries(cluster).forEach(function (entry) {\n          if (entry[0] == \"aed\") {\n            entry[1].forEach(function (id) {\n              const matched = data.find(function (aed) {\n                return aed.aed_id === id;\n              });\n\n              if (matched) {\n                matched.cluster = cluster.name;\n                groupedData.push(matched);\n              }\n            });\n          }\n        });\n      }); // if ($scope.selectedFilterData.value === 'per_cluster') {\n      //     $scope.paginationSettings.totalPages = $scope.gridData.length;\n      //     $scope.paginationSettings.limit = 1;\n      // } else {\n\n      $scope.paginationSettings.totalPages = Math.ceil($scope.paginationSettings.totalItems / $scope.paginationSettings.limit);\n      $scope.paginationSettings.limit = 100; // }\n\n      $scope.loading = false;\n      $scope.allRois = groupedData;\n      $scope.isRoisLoading = false;\n      $scope.getRoisDetailsSegment();\n      $scope.combineRoisPerCluster();\n    }).catch(function (err) {\n      console.log(err);\n      $scope.getStatusForEmptyData();\n    });\n  };\n\n  $scope.getRoisDetails();\n\n  $scope.combineRoisPerCluster = function () {\n    $scope.roisPerCluster = {};\n    $scope.gridData.forEach(function (cluster) {\n      $scope.roisPerCluster[cluster.name] = cluster.aed;\n    });\n  };\n\n  $scope.exportReport = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to download Clustering details');\n      return;\n    }\n\n    var params = {\n      jobId: $scope.clusteringJobId,\n      aed: $scope.aedData.id,\n      cluster: $scope.roisPerCluster,\n      search: $scope.selectedFilterData.value,\n      userEmail: a2UserPermit.getUserEmail() || ''\n    };\n\n    if ($scope.selectedFilterData.value == 'per_site') {\n      params.perSite = true;\n    } else if ($scope.selectedFilterData.value == 'per_date') {\n      params.perDate = true;\n    } else params.all = true;\n\n    $scope.openExportPopup(params);\n  };\n\n  $scope.openExportPopup = function (listParams) {\n    const modalInstance = $modal.open({\n      controller: 'ExportReportModalCtrl',\n      templateUrl: '/app/analysis/clustering-jobs/export-report.html',\n      resolve: {\n        data: function () {\n          return listParams;\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function () {\n      notify.log('Your report export request is processing <br> and will be sent by email.');\n    });\n  };\n\n  $scope.getStatusForEmptyData = function () {\n    $scope.loading = false;\n    $scope.isRoisLoading = false;\n    $scope.infopanedata = 'No data for clustering job found.';\n  };\n\n  $scope.getRoisDetailsSegment = function () {\n    const data = $scope.allRois;\n\n    if (data && $scope.selectedFilterData.value === 'per_site') {\n      var sites = {};\n      data.forEach(function (item) {\n        if (!sites[item.site_id]) {\n          sites[item.site_id] = {\n            id: item.site_id,\n            site: item.site,\n            species: [item]\n          };\n        } else {\n          sites[item.site_id].species.push(item);\n        }\n      });\n      const rows = Object.values(sites).map(function (site) {\n        return {\n          id: site.id,\n          site: site.site,\n          species: $scope.groupRoisBySpecies(site.species)\n        };\n      });\n      $scope.rows = rows;\n    } else if (data && $scope.selectedFilterData.value === 'per_cluster') {\n      $scope.ids = {};\n\n      if ($scope.aedData.count > 1) {\n        var grids = [];\n        $scope.gridData.forEach(function (row) {\n          grids.push([row]);\n        });\n        grids.forEach(function (row, index) {\n          $scope.ids[index] = {\n            id: row[0].cluster || row[0].name,\n            cluster: row[0].cluster || row[0].name,\n            species: $scope.groupRoisBySpecies(data, row[0].aed)\n          };\n        });\n      } else {\n        $scope.ids[0] = {\n          id: $scope.gridData[0].cluster || $scope.gridData[0].name,\n          cluster: $scope.gridData[0].cluster || $scope.gridData[0].name,\n          species: $scope.groupRoisBySpecies(data)\n        };\n      }\n\n      $scope.rows = Object.values($scope.ids);\n    } else if (data && $scope.selectedFilterData.value === 'per_species') {\n      var speciesObj = {};\n      data.forEach(function (roi) {\n        if (!speciesObj[roi.species_id]) {\n          speciesObj[roi.species_id] = {\n            id: roi.species_id,\n            speciesName: roi.scientific_name,\n            species: [roi]\n          };\n        } else {\n          speciesObj[roi.species_id].species.push(roi);\n        }\n      });\n      const rows = Object.values(speciesObj).map(function (row) {\n        return {\n          id: row.id,\n          speciesName: row.speciesName || 'Unvalidated ROIs',\n          species: $scope.groupRoisBySpecies(row.species)\n        };\n      });\n      $scope.rows = rows;\n    } else {\n      if ($scope.selectedFilterData.value === 'per_date') {\n        data.sort(function (a, b) {\n          return a.date_created < b.date_created ? 1 : -1;\n        });\n      }\n\n      $scope.rows = [];\n      $scope.rows.push({\n        species: [{\n          rois: data\n        }]\n      });\n    }\n  };\n\n  $scope.groupRoisBySpecies = function (data, aeds) {\n    const rois = aeds ? data.filter(function (a, i) {\n      return aeds.includes(a.aed_id);\n    }) : data;\n    var species = {};\n    rois.forEach(function (item) {\n      const key = item.scientific_name ? item.scientific_name + '-' + item.songtype : 'Unvalidated ROIs';\n\n      if (!species[key]) {\n        species[key] = {\n          key: key,\n          rois: [item]\n        };\n      } else {\n        species[key].rois.push(item);\n      }\n    });\n    return Object.values(species);\n  };\n\n  $scope.playRoiAudio = function (recId, aedId, $event) {\n    if ($event) {\n      $event.preventDefault();\n      $event.stopPropagation();\n    }\n\n    a2AudioBarService.loadUrl(a2ClusteringJobs.getAudioUrlFor(recId, aedId), true);\n  };\n\n  $scope.getRoiVisualizerUrl = function (roi) {\n    var projecturl = Project.getUrl();\n    var box = ['box', roi.time_min, roi.frequency_min, roi.time_max, roi.frequency_max].join(',');\n    return roi ? '/project/' + projecturl + '/#/visualizer/rec/' + roi.recording_id + '?a=' + box : '';\n  };\n\n  $scope.togglePopup = function () {\n    $scope.isPopupOpened = !$scope.isPopupOpened;\n  };\n\n  $scope.toggleBoxSize = function () {\n    $scope.isSquareSize = !$scope.isSquareSize;\n  };\n\n  $scope.isPlaylistDataValid = function () {\n    return $scope.selectedRois && $scope.selectedRois.length && $scope.playlistData.playlistName && $scope.playlistData.playlistName.trim().length > 0;\n  };\n\n  $scope.closePopup = function () {\n    $scope.isPopupOpened = false;\n  };\n\n  $scope.savePlaylist = function () {\n    if ($scope.selectedRois.length) {\n      $scope.isSavingPlaylist = true; // Create a new playlist with aed boxes.\n\n      a2Playlists.create({\n        playlist_name: $scope.playlistData.playlistName,\n        params: $scope.selectedRois,\n        recIdsIncluded: true\n      }, function (data) {\n        $scope.isSavingPlaylist = false;\n        $scope.closePopup(); // Attach aed to the new playlist.\n\n        if (data && data.playlist_id) {\n          a2Playlists.attachAedToPlaylist({\n            playlist_id: data.playlist_id,\n            aed: $scope.selectedRois\n          }, function (data) {\n            $scope.playlistData = {};\n            notify.log('Audio event detections are saved in the playlist. <br> Navigates to the Visualizer page to see Audio Event boxes on the spectrogram');\n          });\n        }\n      });\n    }\n  };\n\n  $scope.isValidationAccessible = function () {\n    return a2UserPermit.can('manage AED and Clustering job');\n  };\n\n  $scope.setValidation = function () {\n    if (!a2UserPermit.can('manage AED and Clustering job')) {\n      notify.error('You do not have permission to manage AED and Clustering job');\n      return;\n    }\n\n    if ($scope.validation.status.value === 1 && (!$scope.selected.species || !$scope.selected.songtype)) {\n      notify.error('Please select Species and Song type <br> to validate ROIs with the Present validation');\n      return;\n    }\n\n    if ($scope.validation.status.value === 0 && (!$scope.selected.species || !$scope.selected.songtype)) {\n      notify.error('Please select Species and Song type <br> to validate ROIs with the Absent validation');\n      return;\n    }\n\n    $scope.speciesLoading = true;\n    var opts = {\n      aed: $scope.selectedRois,\n      validated: $scope.validation.status.value\n    };\n    const isClearValidation = $scope.validation.status.value === -1;\n    opts.species_name = isClearValidation ? null : $scope.selected.species.scientific_name;\n    opts.songtype_name = isClearValidation ? null : $scope.selected.songtype.name;\n    opts.species_id = isClearValidation ? null : $scope.selected.species.id;\n    opts.songtype_id = isClearValidation ? null : $scope.selected.songtype.id;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      a2AudioEventDetectionsClustering.validate(opts).then(function (data) {\n        console.info('Validation result', data); // Unselect and mark boxes with current validation without reloading the page\n\n        $scope.markBoxesWithCurrentValidation();\n        $scope.unselectBoxes();\n        $scope.selectedRois = [];\n\n        if ($scope.validation.status.value === 1) {\n          notify.log('Audio event detections are validated as ' + $scope.selected.species.scientific_name + ' ' + $scope.selected.songtype.name);\n        }\n\n        $scope.selected = {\n          species: null,\n          songtype: null\n        };\n        $scope.updateInputState();\n        $scope.getRoisDetails();\n      }).finally(function () {\n        $scope.speciesLoading = false;\n      });\n    }, 500);\n  };\n\n  $scope.markBoxesWithCurrentValidation = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if ($scope.selectedRois.includes(roi.aed_id)) {\n            roi.validated = $scope.validation.status.value;\n          }\n        });\n      });\n    });\n  };\n\n  $scope.unselectBoxes = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if (roi.selected) {\n            roi.selected = false;\n          }\n        });\n      });\n    });\n  };\n\n  $scope.markBoxesAsSelected = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if ($scope.selectedRois.includes(roi.aed_id)) {\n            roi.selected = true;\n          }\n        });\n      });\n    });\n  };\n\n  Songtypes.get(function (songs) {\n    $scope.songtypes = songs;\n  });\n\n  $scope.searchSpecies = function (search) {\n    $scope.selected.songtype = null;\n    $scope.speciesLoading = true;\n    return $http.get('/legacy-api/species/search', {\n      params: {\n        q: search\n      }\n    }).then(function (result) {\n      $scope.speciesLoading = false;\n      return result.data;\n    });\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    var scrollPos = $controller.scrollElement.scrollY;\n    var headerTop = $controller.anchors.header.offset().top;\n    this.headerTop = headerTop | 0;\n    this.scrolledPastHeader = scrollPos > headerTop;\n  };\n\n  var getSelectedDetectionIds = function () {\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        cluster.rois.forEach(function (roi) {\n          if (roi.selected === true && !$scope.selectedRois.includes(roi.aed_id)) {\n            $scope.selectedRois.push(roi.aed_id);\n          }\n\n          if (roi.selected === false && $scope.selectedRois.includes(roi.aed_id)) {\n            const index = $scope.selectedRois.findIndex(function (item) {\n              return item === roi.aed_id;\n            });\n            $scope.selectedRois.splice(index, 1);\n          }\n        });\n      });\n    });\n    return $scope.selectedRois;\n  };\n\n  $scope.selectCluster = function (cluster) {\n    const isSelected = cluster.selected;\n    cluster.rois = cluster.rois.map(function (roi) {\n      roi.selected = isSelected === true ? true : false;\n      return roi;\n    });\n    $scope.selectedRois = getSelectedDetectionIds();\n    $scope.updateInputState();\n  };\n\n  var getCombinedDetections = function () {\n    var combinedDetections = [];\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        combinedDetections = combinedDetections.concat(cluster.rois);\n      });\n    });\n    return combinedDetections;\n  }; // Selection with a shift key\n\n\n  $scope.toggleDetection = function (event) {\n    isShiftKeyHolding = event.shiftKey;\n\n    if (isShiftKeyHolding) {\n      const combinedDetections = getCombinedDetections();\n      const selectedDetectionIds = getSelectedDetectionIds();\n      const firstInx = combinedDetections.findIndex(function (d) {\n        return d.aed_id === selectedDetectionIds[0];\n      });\n      const secondInx = combinedDetections.findIndex(function (det) {\n        return det.aed_id === selectedDetectionIds[selectedDetectionIds.length - 1];\n      });\n      const arrayOfIndx = [firstInx, secondInx].sort(function (a, b) {\n        return a - b;\n      });\n      const filteredDetections = combinedDetections.filter(function (_det, index) {\n        return index >= arrayOfIndx[0] && index <= arrayOfIndx[1];\n      });\n      const ids = filteredDetections.map(function (det) {\n        return det.aed_id;\n      });\n      $scope.rows.forEach(function (row) {\n        row.species.forEach(function (cluster) {\n          cluster.rois.forEach(function (roi) {\n            if (ids.includes(roi.aed_id)) {\n              roi.selected = true;\n            }\n          });\n        });\n      });\n    }\n\n    $scope.selectedRois = getSelectedDetectionIds();\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      $scope.updateInputState();\n    }, 100);\n  }; // Set cluster's input state\n\n\n  $scope.updateInputState = function () {\n    const inputs = document.querySelectorAll(\"[id^='inputCluster_']\");\n    if (!inputs.length) return;\n    var index = 0;\n    $scope.rows.forEach(function (row) {\n      row.species.forEach(function (cluster) {\n        const selectedRois = cluster.rois.filter(function (roi) {\n          return roi.selected;\n        });\n\n        if (!selectedRois.length) {\n          inputs[index].checked = false;\n          inputs[index].indeterminate = false;\n        } else if (selectedRois.length === cluster.rois.length) {\n          inputs[index].indeterminate = false;\n          inputs[index].checked = true;\n        } else {\n          inputs[index].checked = false;\n          inputs[index].indeterminate = true;\n        }\n\n        index++;\n      });\n    });\n  };\n});","angular.module('a2.analysis.cnn', ['ui.bootstrap', 'a2.directive.audio-bar', 'a2.srv.cnn', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.disabled-cnn', {\n    url: '/disabled/cnn',\n    templateUrl: '/app/analysis/cnn/disabled.html'\n  }).state('analysis.cnn', {\n    url: '/cnn/',\n    controller: 'CNNCtrl',\n    templateUrl: '/app/analysis/cnn/list.html'\n  }).state('analysis.cnn-details', {\n    url: '/cnn/:cnnId',\n    ///:detailType/',\n    controller: 'CNNCtrl',\n    templateUrl: '/app/analysis/cnn/list.html'\n  });\n}).controller('CNNCtrl', function ($scope, $modal, $filter, $location, Project, ngTableParams, JobsData, a2CNN, a2Playlists, notify, $q, a2UserPermit, $state, $stateParams) {\n  // this debug line for sanity between servers... Will remove TODO\n  console.log(\"CNN Version 1.0\");\n  $scope.selectedCNNId = $stateParams.cnnId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.cnnOriginal, params.filter()) : $scope.cnnOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.cnnOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No cnn searches found.\";\n        }\n\n        $scope.cnnsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.loadCNNs = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CNN.list().then(function (data) {\n      $scope.cnnOriginal = data;\n      $scope.cnnsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"-timestamp\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No cnns found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedCNNId) {\n    $scope.loadCNNs();\n  }\n\n  $scope.createNewCNN = function () {\n    // TODO: add in real cnn permissions\n    if (!a2UserPermit.can('manage cnns')) {\n      notify.error('You do not have permission to create cnn jobs.');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/cnn/createnewcnn.html',\n      controller: 'CreateNewCNNInstanceCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new cnn is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteCNN = function (cnn, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage cnns')) {\n      notify.error('You do not have permission to delete cnns.');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/cnn/deletecnn.html',\n      controller: 'DeleteCNNInstanceCtrl as controller',\n      resolve: {\n        cnn: function () {\n          return cnn;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        notify.log(\"CNN: (\" + cnn.name + \") deleted successfully\");\n        $scope.loadCNNs();\n        /*\n        var index = -1;\n        var modArr = angular.copy($scope.cnnOriginal);\n        for (var i = 0; i < modArr.length; i++) {\n            if (modArr[i].job_id === cnn.job_id) {\n                index = i;\n                break;\n            }\n        }\n        if (index > -1) {\n            $scope.cnnOriginal.splice(index, 1);\n            notify.log(\"CNN deleted successfully\");\n        }\n        */\n      }\n    });\n  };\n\n  $scope.selectItem = function (cnnId) {\n    if (!cnnId) {\n      $state.go('analysis.cnn', {});\n    } else {\n      $state.go('analysis.cnn-details', {\n        cnnId: cnnId //detailType: 'all'\n\n      });\n    }\n  };\n\n  $scope.setDetailedView = function (detailedView) {\n    $scope.detailedView = detailedView;\n    $state.transitionTo($state.current.name, {\n      patternMatchingId: $scope.selectedPatternMatchingId,\n      show: detailedView ? \"detail\" : \"gallery\"\n    }, {\n      notify: false\n    });\n  };\n}).controller('DeleteCNNInstanceCtrl', function ($scope, $modalInstance, a2CNN, cnn, Project) {\n  this.cnn = cnn;\n  $scope.project_name = Project.getUrl();\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2CNN.delete(cnn.job_id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewCNNInstanceCtrl', function ($scope, $modalInstance, a2PatternMatching, a2Templates, a2Playlists, a2CNN, notify) {\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false,\n        models: false\n      };\n      var list = this.list = {};\n      list.lambdas = [{\n        'name': 'call_id_testing:1 - create fake data',\n        'key': \"new_cnn_job_test1\"\n      }, {\n        'name': 'function_id_driver - test real function',\n        'key': \"new_cnn_job_v1\"\n      }];\n      this.data = {\n        name: null,\n        playlist: null,\n        model: null,\n        lambda: list.lambdas[0],\n        params: {}\n      };\n      this.loading.models = true;\n      a2CNN.listModels().then(function (models) {\n        this.loading.models = false;\n        list.models = models;\n      }.bind(this));\n      this.loading.playlists = true;\n      a2Playlists.getList().then(function (playlists) {\n        this.loading.playlists = false;\n        list.playlists = playlists;\n      }.bind(this));\n    },\n    ok: function () {\n      try {\n        return a2CNN.create({\n          playlist_id: this.data.playlist.id,\n          cnn_id: this.data.model.id,\n          name: this.data.name,\n          lambda: this.data.lambda.key,\n          params: this.data.params\n        }).then(function (cnn) {\n          $modalInstance.close({\n            ok: true,\n            cnn: cnn\n          });\n        }).catch(notify.serverError);\n      } catch (error) {\n        console.error(\"a2CNN.create error: \" + error);\n      }\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    }\n  });\n  this.initialize();\n}).directive('a2CnnDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      cnnId: '=',\n      detailedView: '=',\n      onSetDetailedView: '&',\n      onGoBack: '&'\n    },\n    controller: 'CNNDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/cnn/details.html'\n  };\n}).controller('CNNDetailsCtrl', function ($scope, $state, ngTableParams, a2AudioPlayer, $filter, a2CNN, a2UserPermit, Project, a2AudioBarService, notify) {\n  var projecturl = Project.getUrl();\n  $scope.lists = {\n    thumbnails: [{\n      class: 'fa fa-th-large',\n      value: ''\n    }, {\n      class: 'fa fa-th',\n      value: 'is-small'\n    }],\n    search: [{\n      value: 'all',\n      text: 'All',\n      description: 'Show all matched rois.'\n    }, {\n      value: 'present',\n      text: 'Present',\n      description: 'Show all rois marked as present.'\n    }, {\n      value: 'not_present',\n      text: 'Not Present',\n      description: 'Show all rois marked as not present.'\n    }, {\n      value: 'unvalidated',\n      text: 'Unvalidated',\n      description: 'Show all rois without validation.'\n    }, {\n      value: 'by_score',\n      text: 'Score per Species',\n      description: 'Show rois ranked by score per species.'\n    }, {\n      value: 'by_score_per_site',\n      text: 'Score per Site',\n      description: 'Show rois ranked by score per site.'\n    }],\n    selection: [{\n      value: 'all',\n      text: 'All'\n    }, {\n      value: 'none',\n      text: 'None'\n    }, {\n      value: 'not-validated',\n      text: 'Not Validated'\n    }],\n    validation: [{\n      class: \"fa val-1\",\n      text: \"Present\",\n      value: 1\n    }, {\n      class: \"fa val-0\",\n      text: \"Not Present\",\n      value: 0\n    }, {\n      class: \"fa val-null\",\n      text: \"Clear\",\n      value: null\n    }],\n    current: {\n      thumbnailClass: 'is-small'\n    }\n  };\n  $scope.total = {\n    rois: 0,\n    pages: 0\n  };\n  $scope.selected = {\n    roi_index: 0,\n    roi: null,\n    page: 0,\n    search: $scope.lists.search[4]\n  };\n  $scope.validation = {\n    current: $scope.lists.validation[2]\n  };\n  $scope.offset = 0;\n  $scope.limit = 100; //$scope.viewType = \"species\";\n\n  var setupExportUrl = function () {\n    $scope.CNNExportUrl = a2CNN.getExportUrl({\n      cnnId: $scope.cnnId\n    });\n  };\n\n  $scope.exportCnnReport = function ($event) {\n    $event.stopPropagation();\n    if (a2UserPermit.isSuper()) return setupExportUrl();\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export CNN data');\n    } else return setupExportUrl();\n  };\n\n  var audio_player = new a2AudioPlayer($scope);\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.cnnOriginal, params.filter()) : $scope.cnnOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.cnnOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No cnn searches found.\";\n        }\n\n        cnnsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n\n        if ($scope.viewType == \"species\") {\n          $scope.species = cnnsData;\n        } else if ($scope.viewType == \"recordings\") {\n          $scope.recordings = cnnsData;\n        } else {\n          $scope.mainResults = cnnsData;\n        }\n      }\n    });\n  }; //$scope.viewType = \"all\";\n\n\n  $scope.counts = {\n    recordings: null\n  };\n\n  $scope.onSelect = function (item) {\n    $scope.select(item.value);\n  };\n\n  $scope.select = function (option) {\n    var selectFn = null;\n\n    if (option === \"all\") {\n      selectFn = function (roi) {\n        roi.selected = true;\n      };\n    } else if (option === \"none\") {\n      selectFn = function (roi) {\n        roi.selected = false;\n      };\n    } else if (option === \"not-validated\") {\n      selectFn = function (roi) {\n        roi.selected = roi.validated === null;\n      };\n    } else {\n      selectFn = function (roi) {\n        roi.selected = roi.id === option;\n      };\n    }\n\n    ($scope.resultsROIs || []).forEach(selectFn);\n  };\n\n  var refreshDetails = function () {\n    a2CNN.getDetailsFor($scope.cnnId).then(function (data) {\n      $scope.job_details = data;\n    });\n  };\n\n  refreshDetails();\n\n  var bySpecies = function (dataIn) {\n    var dataOut = {};\n    dataIn.forEach(function (element) {\n      var s = element.species_id;\n\n      if (!(s in dataOut)) {\n        dataOut[s] = {\n          count: 0,\n          species_id: s,\n          scientific_name: element.scientific_name\n        };\n      }\n\n      if (element.present == 1) {\n        dataOut[s].count++;\n      }\n    });\n    return dataOut;\n  };\n\n  var byROIs = function (dataIn, thresh) {\n    if (!thresh) {\n      thresh = 0.9;\n    }\n\n    var dataOut = [];\n    dataIn.forEach(function (element) {\n      element.over_thresh = element.score >= thresh;\n      element.present = element.over_thresh;\n      dataOut.push(element);\n    });\n    dataOut.sort(function (a, b) {\n      return a.score < b.score ? 1 : -1;\n    });\n    return dataOut;\n  };\n\n  var byROIsbySpecies = function (dataIn, bySite) {\n    dataOut = {};\n    dataIn.forEach(function (element) {\n      var s = bySite ? element.site : element.species_id + '_' + element.songtype_id;\n\n      if (!(s in dataOut)) {\n        dataOut[s] = {\n          count: 0,\n          species_id: element.species_id,\n          songtype_id: element.songtype_id,\n          scientific_name: element.scientific_name,\n          songtype: element.songtype,\n          rois: []\n        };\n        if (bySite) dataOut[s].site = element.site;\n      }\n\n      dataOut[s].rois.push(element);\n      dataOut[s].count++;\n    });\n    return dataOut;\n  };\n\n  var byRecordings = function (dataIn) {\n    var dataOut = {\n      total: 0\n    };\n    dataIn.forEach(function (element) {\n      var r = element.recording_id;\n      var s = element.species_id;\n\n      if (!(r in dataOut)) {\n        dataOut[r] = {\n          recording_id: r,\n          thumbnail: element.thumbnail,\n          species: {},\n          total: 0,\n          species_list: ''\n        };\n      }\n\n      if (!(s in dataOut[r].species)) {\n        dataOut[r].species[s] = {\n          species_id: s,\n          scientific_name: element.scientific_name,\n          count: 0\n        };\n      }\n\n      if (element.present == 1) {\n        if (dataOut[r].species[s].count == 0) {\n          dataOut[r].species_list = dataOut[r].species_list + ' ' + element.scientific_name;\n        }\n\n        dataOut[r].species[s].count++;\n        dataOut[r].total++;\n      }\n    });\n    return dataOut;\n  };\n\n  var bySpeciesHist = function (dataIn, species_id) {\n    speciesTimes = [];\n    count = 0;\n    speciesName = 'All'; //fix this... ugh\n\n    dataIn.forEach(function (element) {\n      if (species_id == 'all' | element.species_id == species_id) {\n        if (species_id == 'all') {\n          speciesName = 'All';\n        } else {\n          speciesName = element.scientific_name;\n        }\n\n        if (element.present == 1) {\n          var d = new Date(element.datetime);\n          var minutes = d.getHours() * 60 + d.getMinutes();\n          speciesTimes.push(new Date(3000, 0, 1, d.getHours(), d.getMinutes()));\n          count++;\n        }\n      }\n    });\n    return {\n      times: speciesTimes,\n      count: count,\n      name: speciesName\n    };\n  };\n\n  var plotShown = false;\n\n  $scope.showHist = function (species_id) {\n    $scope.speciesInfo = bySpeciesHist($scope.results, species_id);\n    var trace = {\n      x: $scope.speciesInfo.times,\n      type: 'histogram',\n      //xbins: {size: new Date(3000, 0, 2, 2).getTime() - new Date(3000, 0, 2, 0).getTime()}\n      //magic numbers for full day/2 hour bins\n      xbins: {\n        start: 32503698000000,\n        end: 32503791600000,\n        size: 7200000\n      }\n    };\n    var layout = {\n      title: $scope.speciesInfo.name + ' by time of day.',\n      xaxis: {\n        tickformat: '%X',\n        // For more time formatting types, see: https://github.com/d3/d3-time-format/blob/master/README.md\n        range: [new Date(3000, 0, 1).getTime(), new Date(3000, 0, 2).getTime()]\n      }\n    };\n    var data = [trace];\n\n    if (!plotShown) {\n      Plotly.newPlot('speciesHist', data, layout);\n      plotShown = true;\n    } else {\n      Plotly.newPlot('speciesHist', data, layout);\n    }\n  };\n\n  $scope.getRecordingVisualizerUrl = function (recording_id) {\n    return \"/project/\" + Project.getUrl() + \"/visualizer/rec/\" + recording_id;\n  };\n\n  $scope.getRoiVisualizerUrl = function (roi) {\n    var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n    return roi ? \"/project/\" + projecturl + \"/#/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + projecturl + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  };\n\n  $scope.playRoiAudio = function (roi, $event) {\n    if ($event) {\n      $event.preventDefault();\n      $event.stopPropagation();\n    }\n\n    a2AudioBarService.loadUrl(a2CNN.getAudioUrlFor(roi), true);\n  };\n\n  $scope.setPage = function (page, force) {\n    page = Math.max(0, Math.min(page, $scope.total.rois / $scope.limit | 0));\n\n    if (page != $scope.selected.page || force) {\n      $scope.selected.page = page;\n      $scope.offset = page * $scope.limit;\n      loadROIPage();\n    }\n  };\n\n  $scope.moveROIPage = function (n) {\n    var nextPage = $scope.selected.page + n;\n\n    if (nextPage > $scope.total.pages - 1) {\n      $scope.setPage(0);\n    } else if (nextPage < 0) {\n      $scope.setPage($scope.total.pages - 1);\n    } else {\n      $scope.setPage(nextPage);\n    }\n  };\n\n  $scope.setSpecies = function (species) {\n    $scope.selected.species = species;\n    $scope.selected.page = 0;\n    $scope.offset = 0;\n    var site_name = \"site_\" + $scope.selected.site.site_id + \"_\" + $scope.selected.site.name;\n\n    if ($scope.selected.site.site_id == 0) {\n      site_name = 0;\n    }\n\n    $scope.counts.roi_species_counts = getSpeciesCounts(site_name, $scope.roi_species_sites_counts);\n    $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species.species_id, $scope.roi_species_sites_counts);\n    var count_all_species = $scope.counts.roi_species_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    all_species = {\n      species_id: 0,\n      N: count_all_species,\n      scientific_name: \"All Species\"\n    };\n    $scope.counts.roi_species_counts.unshift(all_species);\n    var count_all_sites = $scope.counts.roi_sites_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    var all_site = {\n      site_id: 0,\n      N: count_all_sites,\n      name: \"All Sites\"\n    };\n    $scope.counts.roi_sites_counts.unshift(all_site);\n    $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n      return element.site_id == $scope.selected.site.site_id;\n    });\n    $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n      return element.species_id == $scope.selected.species.species_id;\n    }); //$scope.counts.roi_sites_counts.unshift($scope.selected.site);\n    //$scope.selected.site = all_site;\n\n    $scope.total = {\n      rois: species.N,\n      pages: Math.ceil(species.N / $scope.limit)\n    };\n    loadROIPage();\n  };\n\n  $scope.counts = {};\n\n  $scope.setSite = function (site) {\n    $scope.selected.site = site;\n    $scope.selected.page = 0;\n    $scope.offset = 0;\n    var site_name = \"site_\" + $scope.selected.site.site_id + \"_\" + $scope.selected.site.name;\n\n    if ($scope.selected.site.site_id == 0) {\n      site_name = 0;\n    }\n\n    $scope.counts.roi_species_counts = getSpeciesCounts(site_name, $scope.roi_species_sites_counts);\n    $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species.species_id, $scope.roi_species_sites_counts);\n    var count_all_species = $scope.counts.roi_species_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    all_species = {\n      species_id: 0,\n      N: count_all_species,\n      scientific_name: \"All Species\"\n    };\n    $scope.counts.roi_species_counts.unshift(all_species); //$scope.counts.roi_species_counts.unshift($scope.selected.species);\n\n    var count_all_sites = $scope.counts.roi_sites_counts.reduce(function (count, current) {\n      return count = count + current.N;\n    }, 0);\n    var all_site = {\n      site_id: 0,\n      N: count_all_sites,\n      name: \"All Sites\"\n    };\n    $scope.counts.roi_sites_counts.unshift(all_site);\n    $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n      return element.species_id == $scope.selected.species.species_id;\n    });\n    $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n      return element.site_id == $scope.selected.site.site_id;\n    });\n    $scope.total = {\n      rois: site.N,\n      pages: Math.ceil(site.N / $scope.limit)\n    };\n    loadROIPage();\n  };\n\n  var loadROIPage = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    a2CNN.listROIs($scope.cnnId, $scope.limit, $scope.offset, $scope.selected.species.species_id, $scope.selected.site.site_id, $scope.selected.search.value).then(function (data) {\n      $scope.resultsROIs = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n      $scope.rois = byROIs($scope.resultsROIs);\n      $scope.rois_species = byROIsbySpecies($scope.rois, $scope.selected.search.value === 'by_score_per_site');\n    });\n  };\n\n  $scope.validate = function () {\n    if (!a2UserPermit.can('validate cnn rois')) {\n      notify.log('You do not have permission to validate the cnn rois.');\n      return;\n    }\n\n    var validation = ($scope.validation.current || {\n      value: null\n    }).value;\n    var rois = [];\n\n    for (var species in $scope.rois_species) {\n      $scope.rois_species[species].rois.forEach(function (roi) {\n        if (roi.selected) {\n          rois.push(roi);\n        }\n      });\n    }\n\n    var roiIds = rois.map(function (roi) {\n      return roi.cnn_result_roi_id;\n    });\n\n    try {\n      a2CNN.validateRois($scope.cnnId, roiIds, validation).then(function (response) {\n        rois.forEach(function (roi) {\n          roi.validated = validation;\n          roi.selected = false;\n        }); //loadROIPage();\n      });\n    } catch (error) {\n      console.error(\"TCL: $scope.validate -> error\", error);\n    }\n\n    refreshDetails();\n  }; //$scope.calcWidth = function(roi) {\n  //};\n\n\n  $scope.onScroll = function ($event, $controller) {\n    this.scrollElement = $controller.scrollElement;\n    var scrollPos = $controller.scrollElement.scrollY;\n    var headerTop = $controller.anchors.header.offset().top;\n    this.headerTop = headerTop | 0;\n    this.scrolledPastHeader = scrollPos >= headerTop;\n  };\n\n  var getSpeciesCounts = function (site, species_sites_matrix) {\n    if (site == 0) {\n      site = 'total';\n    }\n\n    var roi_species_counts = [];\n    species_sites_matrix.forEach(function (species) {\n      roi_species_counts.push({\n        species_id: species.species_id,\n        N: species[site],\n        scientific_name: species.scientific_name\n      });\n    });\n    return roi_species_counts;\n  };\n\n  var getSitesCounts = function (species, species_sites_matrix) {\n    if (species == 0) {\n      species = 'total';\n    }\n\n    var roi_site_counts = [];\n    species_sites_matrix.forEach(function (s) {\n      if (species == 'total' | s.species_id == species) {\n        for (key in s) {\n          split = key.split(\"_\");\n          site_id = split[1];\n          name = split.slice(2).join(\"_\");\n\n          if (split[0] == \"site\") {\n            row = {};\n            row.site_id = site_id;\n            row.N = s[key];\n            row.name = name;\n            roi_site_counts.push(row);\n          }\n        }\n      }\n    });\n\n    if (species == 'total') {\n      roi_site_counts_dict = roi_site_counts.reduce(function (sitesAcc, site) {\n        if (!(site.site_id in sitesAcc)) {\n          sitesAcc[site.site_id] = {\n            site_id: site.site_id,\n            N: 0,\n            name: site.name\n          };\n        }\n\n        sitesAcc[site.site_id].N += site.N;\n        return sitesAcc;\n      }, {});\n      roi_site_counts = Object.values(roi_site_counts_dict);\n    }\n\n    return roi_site_counts;\n  };\n\n  $scope.onSearchChanged = function () {\n    $scope.switchView(\"rois\");\n  };\n\n  $scope.switchView = function (viewType, specie) {\n    if (specie) {\n      window.scrollTo(0, 0);\n    }\n\n    var sortBy = \"-cnn_presence_id\";\n\n    var loadSwitch = function () {\n      if (viewType == \"species\") {\n        $scope.species = bySpecies($scope.results);\n        $scope.viewType = \"species\";\n        sortBy = \"-scientific_name\";\n        $scope.showHist(specie ? specie : \"all\");\n        $scope.cnnOriginal = Object.values($scope.species);\n      } else if (viewType == \"recordings\") {\n        $scope.recordings = byRecordings($scope.results);\n        $scope.counts.recordings = Object.keys($scope.recordings).length;\n        $scope.viewType = \"recordings\";\n        sortBy = \"-recording_id\";\n        $scope.cnnOriginal = Object.values($scope.recordings);\n      } else {\n        $scope.viewType = \"all\";\n        $scope.mainResults = $scope.results;\n        $scope.cnnOriginal = Object.values($scope.results);\n      }\n\n      if ($scope.cnnOriginal.length > 0) {\n        initTable(1, 10, sortBy, {}, $scope.cnnOriginal.length);\n      } else {\n        $scope.infopanedata = \"No cnn results found.\";\n      }\n    };\n\n    if (viewType == \"rois\") {\n      a2CNN.countROIsBySpeciesSites($scope.cnnId, {\n        search: $scope.selected.search.value\n      }).then(function (response) {\n        var data = response.data;\n        $scope.roi_species_sites_counts = data;\n        $scope.counts.roi_species_counts = getSpeciesCounts($scope.selected.site ? $scope.selected.site.site_id : 0, $scope.roi_species_sites_counts);\n        $scope.counts.roi_sites_counts = getSitesCounts($scope.selected.species ? $scope.selected.species.species_id : 0, $scope.roi_species_sites_counts);\n        var count_all = $scope.counts.roi_species_counts.reduce(function (count, current) {\n          return count = count + current.N;\n        }, 0);\n        var all_species = {\n          species_id: 0,\n          N: count_all,\n          scientific_name: \"All Species\"\n        };\n        $scope.counts.roi_species_counts.unshift(all_species);\n\n        if (!$scope.selected.species) {\n          $scope.selected.species = all_species;\n        } else {\n          $scope.selected.species = $scope.counts.roi_species_counts.find(function (element) {\n            return element.species_id == $scope.selected.species.species_id;\n          }) || all_species;\n        }\n\n        var all_sites = {\n          site_id: 0,\n          N: count_all,\n          name: \"All Sites\"\n        };\n        $scope.counts.roi_sites_counts.unshift(all_sites);\n\n        if (!$scope.selected.site) {\n          $scope.selected.site = all_sites;\n        } else {\n          $scope.selected.site = $scope.counts.roi_sites_counts.find(function (element) {\n            return element.site_id == $scope.selected.site.site_id;\n          }) || all_sites;\n        }\n\n        $scope.total = {\n          rois: count_all,\n          pages: Math.ceil(count_all / $scope.limit)\n        };\n        $scope.viewType = \"rois\";\n        loadROIPage();\n      }); //$scope.viewType = \"rois\";\n      //if (!$scope.resultsROIs) {\n      //    loadROIPage();\n      //} else {\n      //    $scope.rois = byROIs($scope.resultsROIs);\n      //    $scope.rois_species = byROIsbySpecies($scope.rois);\n      //}\n    } else if (!$scope.results) {\n      $scope.loading = true;\n      $scope.infoInfo = \"Loading...\";\n      $scope.showInfo = true;\n      a2CNN.listResults($scope.cnnId).then(function (data) {\n        $scope.results = data;\n        $scope.infoInfo = \"\";\n        $scope.showInfo = false;\n        $scope.loading = false;\n        $scope.infopanedata = \"\";\n        $scope.switchView('rois'); //loadSwitch();\n      });\n    } else {\n      loadSwitch();\n    }\n  };\n\n  $scope.switchView($state.params.detailType ? $state.params.detailType : 'all');\n});","angular.module('a2.analysis.patternmatching', ['ui.bootstrap', 'a2.directive.audio-bar', 'a2.srv.patternmatching', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.disabled-patternmatching', {\n    url: '/disabled/patternmatching',\n    templateUrl: '/app/analysis/patternmatching/disabled.html'\n  });\n  $stateProvider.state('analysis.patternmatching', {\n    url: '/patternmatching?newJob',\n    controller: 'PatternMatchingCtrl',\n    templateUrl: '/app/analysis/patternmatching/list.html'\n  });\n  $stateProvider.state('analysis.patternmatching-details', {\n    url: '/patternmatching/:patternMatchingId',\n    controller: 'PatternMatchingCtrl',\n    templateUrl: '/app/analysis/patternmatching/list.html'\n  });\n}).controller('PatternMatchingCtrl', function ($scope, $modal, JobsData, $location, notify, a2PatternMatching, a2UserPermit, $state, $stateParams) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n  $scope.loading = {\n    rows: false,\n    showRefreshBtn: false\n  };\n  $scope.paginationSettings = {\n    page: 1,\n    limit: 10,\n    offset: 0,\n    totalJobs: 0,\n    totalPages: 0\n  };\n  $scope.search = {\n    q: ''\n  };\n  var timeout;\n  var p = $state.params;\n  var isNewJob = p && p.newJob !== undefined;\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box;\n\n    if (template && template.x1) {\n      box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    }\n\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $scope.selectedPatternMatchingId = patternmatchingId;\n\n    if (!patternmatchingId) {\n      $state.go('analysis.patternmatching', {});\n    } else {\n      $state.go('analysis.patternmatching-details', {\n        patternMatchingId: patternmatchingId\n      });\n    }\n  };\n\n  $scope.setCurrentPage = function () {\n    this.paginationSettings.offset = $scope.paginationSettings.page - 1;\n    $scope.loadPatternMatchings();\n  };\n\n  $scope.update = function (patternMatching, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to edit pattern matchings');\n      return;\n    }\n\n    $scope.pmName = patternMatching.name;\n    const modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/edit-patternmatching.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function (name) {\n      a2PatternMatching.update(patternMatching.id, {\n        name: name\n      }).then(function () {\n        $scope.loadPatternMatchings();\n      });\n    });\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading.rows = true;\n    $scope.showInfo = true;\n    $scope.splitAllSites = false;\n    return a2PatternMatching.list({\n      completed: true,\n      q: $scope.search.q,\n      limit: $scope.paginationSettings.limit,\n      offset: $scope.paginationSettings.offset * $scope.paginationSettings.limit\n    }).then(function (data) {\n      $scope.patternmatchingsOriginal = data.list;\n      $scope.patternmatchingsData = data.list;\n      $scope.paginationSettings.totalJobs = data.count;\n      $scope.paginationSettings.totalPages = Math.ceil($scope.paginationSettings.totalJobs / $scope.paginationSettings.limit);\n      $scope.showInfo = false;\n      $scope.loading.rows = false;\n\n      if (data && data.list.length) {\n        $scope.loading.showRefreshBtn = true;\n      }\n    });\n  };\n\n  $scope.onFilterChanged = function () {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      if ($scope.search.q.trim().length > 0 && $scope.search.q.trim().length < 4) return;\n      $scope.resetPagination();\n      $scope.loadPatternMatchings();\n    }, 1000);\n  };\n\n  $scope.isShowSearch = function () {\n    return $scope.patternmatchingsData && $scope.patternmatchingsData.length || $scope.search.q.trim().length > 0;\n  };\n\n  $scope.resetPagination = function () {\n    $scope.paginationSettings.page = 1;\n    $scope.paginationSettings.offset = 0;\n    $scope.paginationSettings.totalJobs = 0;\n    $scope.paginationSettings.totalPages = 0;\n  };\n\n  $scope.createNewPatternMatching = function () {\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to create pattern matchings');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/createnewpatternmatching.html',\n      controller: 'CreateNewPatternMatchingInstanceCtrl as controller'\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        $scope.loading.showRefreshBtn = true;\n        notify.log(\"Your new pattern matching is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      } else if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      } else if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  if (isNewJob) {\n    $scope.createNewPatternMatching();\n  }\n\n  $scope.deletePatternMatching = function (patternMatching, $event) {\n    $event.stopPropagation();\n\n    if (!a2UserPermit.can('manage pattern matchings')) {\n      notify.error('You do not have permission to delete pattern matchings');\n      return;\n    }\n\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/patternmatching/deletepatternmatching.html',\n      controller: 'DeletePatternMatchingInstanceCtrl as controller',\n      resolve: {\n        patternMatching: function () {\n          return patternMatching;\n        }\n      }\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.patternmatchingsOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].id === patternMatching.id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.patternmatchingsOriginal.splice(index, 1);\n          notify.log(\"PatternMatching deleted successfully\");\n        }\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2PatternMatchingDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'PatternMatchingDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/analysis/patternmatching/details.html'\n  };\n}).controller('PatternMatchingDetailsCtrl', function ($scope, $q, a2PatternMatching, a2Templates, a2UserPermit, Project, a2AudioBarService, notify, $anchorScroll, $modal) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 1\n      };\n      this.sitesList = [];\n      this.sitesListBatchSize = 20;\n      this.sitesBatches = [];\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.paginationTotal = 0;\n      this.loading = {\n        details: false,\n        rois: true\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.search = this.lists.search[6];\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        return this.loadSitesList();\n      }.bind(this)).then(function () {\n        return this.loadData(1);\n      }.bind(this));\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      search: [{\n        value: 'all',\n        text: 'All',\n        description: 'Show all matched Region of Interest.'\n      }, {\n        value: 'present',\n        text: 'Present',\n        description: 'Show all Region of Interest marked as present.'\n      }, {\n        value: 'not_present',\n        text: 'Not Present',\n        description: 'Show all Region of Interest marked as not present.'\n      }, {\n        value: 'unvalidated',\n        text: 'Unvalidated',\n        description: 'Show all Region of Interest without validation.'\n      }, {\n        value: 'best_per_site',\n        text: 'Best per Site',\n        description: 'Show the best scored roi per site.'\n      }, {\n        value: 'best_per_site_day',\n        text: 'Best per Site, Day',\n        description: 'Show the best scored roi per site and day.'\n      }, {\n        value: 'by_score',\n        text: 'Score',\n        description: 'Show all Region of Interest ranked by score.'\n      }, {\n        value: 'by_score_per_site',\n        text: 'Score per Site',\n        description: 'Show all Region of Interest ranked by score per site.'\n      }, {\n        value: 'top_200_per_site',\n        text: '200 Top Scores per Site',\n        description: 'Show Top 200 Region of Interest ranked by score per each site.'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      }, {\n        value: 'not-validated',\n        text: 'Not Validated'\n      }],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2PatternMatching.getDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.patternMatching.templateParameters = {\n          'Threshold': this.patternMatching.parameters.threshold,\n          'Matches/Recording': this.patternMatching.parameters.N,\n          'Matches/Site': this.patternMatching.parameters.persite || 'no limit'\n        };\n        this.total = {\n          rois: patternMatching.matches,\n          pages: Math.ceil(patternMatching.matches / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    onSearchChanged: function () {\n      this.selected.page = 1;\n      this.recalculateSiteListBatch();\n      this.loadData(1);\n    },\n    update: function (patternMatching, $event) {\n      const self = this;\n      $event.stopPropagation();\n\n      if (!a2UserPermit.can('manage pattern matchings')) {\n        notify.error('You do not have permission to edit pattern matchings');\n        return;\n      }\n\n      $scope.pmName = patternMatching.name;\n      const modalInstance = $modal.open({\n        templateUrl: '/app/analysis/patternmatching/edit-patternmatching.html',\n        scope: $scope\n      });\n      modalInstance.result.then(function (name) {\n        a2PatternMatching.update(patternMatching.id, {\n          name: name\n        }).then(function () {\n          patternMatching.name = name;\n        });\n      });\n    },\n    setupExportUrl: function () {\n      const speciesName = this.patternMatching.species_name.replace(/\\s+/g, '_').toLowerCase();\n      const songtypeName = this.patternMatching.songtype_name.replace(/\\s+/g, '_').toLowerCase();\n      const fileName = 'pm-' + this.patternMatching.species_id + '-' + speciesName + '-' + songtypeName;\n      this.patternMatchingExportUrl = a2PatternMatching.getExportUrl({\n        patternMatching: this.patternMatching.id,\n        fileName: encodeURIComponent(fileName)\n      });\n    },\n    exportPmReport: function ($event) {\n      $event.stopPropagation();\n      if (a2UserPermit.isSuper()) return this.setupExportUrl();\n\n      if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n        return notify.error('You do not have permission to export Pattern Matching data');\n      } else return this.setupExportUrl();\n    },\n    onScroll: function ($event, $controller) {\n      if (this.search.value === 'by_score_per_site') {\n        return false;\n      }\n\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadSitesList: function () {\n      return a2PatternMatching.getSitesListFor(this.id).then(function (list) {\n        this.sitesList = list;\n        this.sitesTotal = this.sitesBatches.length;\n        this.splitSitesListIntoBatches();\n      }.bind(this));\n    },\n    splitSitesListIntoBatches: function () {\n      var batches = [];\n\n      for (var i = 0; i < this.sitesList.length; i += this.sitesListBatchSize) {\n        batches.push(this.sitesList.slice(i, i + this.sitesListBatchSize));\n      }\n\n      this.sitesBatches = batches;\n    },\n    getCountPerSite: function () {\n      return this.rois && this.rois[0] && this.rois[0].list[0].countPerSite;\n    },\n    recalculateTotalItems: function () {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n\n      switch (search) {\n        case 'present':\n          this.paginationTotal = this.patternMatching.present;\n          break;\n\n        case 'not_present':\n          this.paginationTotal = this.patternMatching.absent;\n          break;\n\n        case 'by_score':\n          this.paginationTotal = this.patternMatching.matches;\n          break;\n\n        case 'by_score_per_site':\n          this.paginationTotal = this.getCountPerSite();\n          break;\n\n        default:\n          this.paginationTotal = 0;\n      }\n    },\n    recalculateSiteListBatch: function () {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      var shouldRecalculate = false;\n\n      if (['all', 'unvalidated', 'top_200_per_site', 'by_score_per_site'].includes(search)) {\n        if (this.sitesListBatchSize !== 1) {\n          shouldRecalculate = true;\n        }\n\n        this.sitesListBatchSize = 1;\n      } else if (['best_per_site', 'best_per_site_day'].includes(search)) {\n        if (this.sitesListBatchSize !== 10) {\n          shouldRecalculate = true;\n        }\n\n        this.sitesListBatchSize = 10;\n      }\n\n      if (shouldRecalculate) {\n        this.splitSitesListIntoBatches();\n      }\n    },\n    setSiteBookmark: function (site) {\n      const scorePerSite = this.search.value === 'by_score_per_site';\n\n      if (this.shouldGetPerSite() || scorePerSite) {\n        this.selected.page = scorePerSite ? 1 : this.getSiteBatchIndexBySiteId(site.site_id) + 1;\n        return this.loadData();\n      }\n\n      var bookmark = 'site-' + site.site_id;\n      $anchorScroll.yOffset = $('.a2-page-header').height() + 60;\n      $anchorScroll(bookmark);\n    },\n    shouldGetPerSite: function () {\n      return this.search && ['all', 'unvalidated', 'top_200_per_site', 'best_per_site', 'best_per_site_day'].includes(this.search.value);\n    },\n    getSiteBatchIndexBySiteId: function (siteId) {\n      if (!this.sitesBatches || !this.sitesBatches.length) {\n        return undefined;\n      }\n\n      return this.sitesBatches.findIndex(function (batch) {\n        return !!batch.find(function (site) {\n          return site.site_id === siteId;\n        });\n      });\n    },\n    getSiteBatchBySiteId: function (siteId) {\n      const batchIndex = this.getSiteBatchIndexBySiteId(siteId);\n\n      if (batchIndex === undefined) {\n        return undefined;\n      }\n\n      return this.sitesBatches[batchIndex];\n    },\n    getSiteBatchByPageNumber: function (page) {\n      if (!this.sitesBatches || !this.sitesBatches.length) {\n        return undefined;\n      }\n\n      return this.sitesBatches[page - 1];\n    },\n    combOpts: function (data) {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      var opts = {\n        search: search\n      };\n\n      if (data.site) {\n        opts.site = data.site;\n      }\n\n      if (data.sites) {\n        opts.sites = data.sites;\n      }\n\n      var limit, offset;\n      const doubleLimit = 200;\n      const offsetCalc = offset = (data.pageNumber - 1) * this.limit;\n\n      switch (search) {\n        case 'top_200_per_site':\n          limit = doubleLimit;\n          offset = 0;\n          break;\n\n        case 'best_per_site':\n          limit = 1;\n          offset = 0;\n          break;\n\n        case 'all':\n        case 'unvalidated':\n          limit = 100000000;\n          offset = 0;\n          break;\n\n        default:\n          limit = this.limit;\n          offset = offsetCalc;\n      }\n\n      return {\n        limit: limit,\n        offset: offset,\n        opts: opts\n      };\n    },\n    parseRoisResult: function (rois) {\n      var search = this.search && this.search.value ? this.search.value : undefined;\n      this.splitAllSites = search === 'by_score';\n\n      if (this.splitAllSites) {\n        return [{\n          list: rois\n        }];\n      } else {\n        return rois.reduce(function (_, roi) {\n          var site_id = roi.site_id;\n          var sitename = roi.site;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename,\n              id: site_id\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n      }\n    },\n    loadData: function (page) {\n      var params;\n\n      if (this.search.value === 'by_score_per_site') {\n        const site = this.selected.siteBookmark ? this.selected.siteBookmark.site_id : this.sitesBatches[0][0].site_id;\n        params = this.combOpts({\n          sites: site,\n          pageNumber: this.selected.page\n        });\n      } else if (this.shouldGetPerSite()) {\n        page = page || this.selected.page;\n        var siteBatch = this.getSiteBatchByPageNumber(page);\n        var siteIds = siteBatch.map(function (s) {\n          return s.site_id;\n        });\n        params = this.combOpts({\n          sites: siteIds\n        });\n      } else {\n        params = this.combOpts({\n          pageNumber: this.selected.page\n        });\n      }\n\n      this.rois = [];\n      this.loading.rois = true;\n      return a2PatternMatching.getRoisFor(this.id, params.limit, params.offset, params.opts).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = this.parseRoisResult(rois);\n        this.selected.roi = Math.min();\n        this.recalculateTotalItems();\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      console.info('play');\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 1;\n        this.rois = [];\n        return $q.resolve(this.rois);\n      } else {\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadData(page);\n        }\n      }\n\n      return $q.resolve();\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('validate pattern matchings')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        0: 0,\n        1: 0,\n        null: 0\n      };\n      var cls = {\n        species: this.patternMatching.species_name,\n        songtype: this.patternMatching.songtype_name\n      };\n      return a2PatternMatching.validateRois(this.id, roiIds, validation, cls).then(function () {\n        rois.forEach(function (roi) {\n          val_delta[roi.validated] -= 1;\n          val_delta[validation] += 1;\n          roi.validated = validation;\n          roi.selected = false;\n        });\n        this.patternMatching.absent += val_delta[0];\n        this.patternMatching.present += val_delta[1];\n      }.bind(this));\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n}).controller('DeletePatternMatchingInstanceCtrl', function ($scope, $modalInstance, a2PatternMatching, patternMatching) {\n  this.patternMatching = patternMatching;\n  $scope.deletingloader = false;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2PatternMatching.delete(patternMatching.id).then(function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewPatternMatchingInstanceCtrl', function ($modalInstance, a2PatternMatching, a2Templates, a2Playlists, notify) {\n  var self = this;\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = {\n        playlists: false,\n        templates: false,\n        createPatternMatching: false\n      };\n      this.data = {\n        name: null,\n        playlist: null,\n        template: null,\n        params: {\n          N: 1,\n          threshold: 0.3\n        }\n      };\n      this.list = {};\n      this.loading = {\n        templates: true,\n        playlists: true\n      };\n      this.isSaving = false;\n      this.warningMessage = 'Warning: Large playlist (500,000+ recordings). Save resources by reducing playlist size.';\n      this.getTemplates();\n      this.getPlaylists();\n    },\n    getTemplates: function () {\n      self.loading.templates = true;\n      return a2Templates.getList().then(function (templates) {\n        self.loading = false;\n        self.list.templates = templates.filter(function (t) {\n          return !t.disabled;\n        });\n      }.bind(this)).catch(function (err) {\n        self.loading = false;\n        self.list.templates = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    getPlaylists: function () {\n      self.loading.playlists = true;\n      return a2Playlists.getList().then(function (playlists) {\n        self.playlists = false;\n        self.list.playlists = playlists;\n      }.bind(this)).catch(function (err) {\n        self.playlists = false;\n        self.list.playlists = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    ok: function () {\n      if (self.data.playlist.count === 0) {\n        return notify.error('Note: The playlist should not be empty.');\n      }\n\n      self.isSaving = true;\n      return a2PatternMatching.create({\n        name: self.data.name,\n        playlist: self.data.playlist.id,\n        template: self.data.template.id,\n        params: self.data.params\n      }).then(function (patternMatching) {\n        self.isSaving = false;\n        $modalInstance.close({\n          ok: true,\n          patternMatching: patternMatching\n        });\n      }).catch(function (err) {\n        console.log('err', err);\n        self.isSaving = false;\n        notify.error(err);\n      });\n    },\n    isJobValid: function () {\n      return self.data && self.data.name && self.data.name.length > 3 && self.data.playlist && self.data.template;\n    },\n    cancel: function (url) {\n      $modalInstance.close({\n        cancel: true,\n        url: url\n      });\n    },\n    isWarningMessage: function () {\n      return this.data.playlist && this.data.playlist.count > 500000;\n    }\n  });\n  this.initialize();\n});","angular.module('a2.analysis.random-forest-models', ['ui.router', 'a2.analysis.random-forest-models.models', 'a2.analysis.random-forest-models.classification']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models', {\n    url: '/random-forest-models',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.analysis.soundscapes', ['a2.services', 'a2.permissions', 'ui.bootstrap', 'ui-rangeSlider', 'ngCsv']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.soundscapes', {\n    url: '/soundscapes?newJob',\n    controller: 'SoundscapesCtrl as controller',\n    templateUrl: '/app/analysis/soundscapes/list.html'\n  });\n}).controller('SoundscapesCtrl', function ($window, $scope, $modal, $filter, Project, JobsData, ngTableParams, a2Playlists, $location, a2Soundscapes, notify, a2UserPermit, $state) {\n  var $ = $window.$;\n  $scope.successInfo = \"\";\n  $scope.showSuccess = false;\n  $scope.errorInfo = \"\";\n  $scope.showError = false;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = true;\n  var p = $state.params;\n  var isNewJob = p && p.newJob !== undefined;\n  $scope.infopanedata = '';\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n    $scope.pid = data.project_id;\n    $scope.url = data.url;\n    $scope.isProjectDisabled = data.disabled === 1;\n  });\n  a2Playlists.getList().then(function (data) {\n    $scope.playlists = data;\n  });\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    $scope.tableParams = new ngTableParams({\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    }, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.soundscapesOriginal, params.filter()) : $scope.soundscapesOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.soundscapesOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No classifications found.\";\n        }\n\n        $scope.soundscapesData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Soundscapes.saveState({\n          'data': $scope.soundscapesOriginal,\n          'filtered': $scope.soundscapesData,\n          'f': params.filter(),\n          'o': params.orderBy(),\n          'p': params.page(),\n          'c': params.count(),\n          't': orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.loadSoundscapes = function () {\n    a2Soundscapes.getList2(function (data) {\n      $scope.soundscapesOriginal = data;\n      $scope.soundscapesData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+name\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No soundscapes found.\";\n      }\n    });\n  };\n\n  var stateData = a2Soundscapes.getState();\n\n  if (stateData === null) {\n    $scope.loadSoundscapes();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.soundscapesData = stateData.filtered;\n      $scope.soundscapesOriginal = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n\n  $scope.deleteSoundscape = function (id, name) {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to delete soundscapes');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/soundscapes/deletesoundscape.html',\n      controller: 'DeleteSoundscapeInstanceCtrl',\n      resolve: {\n        name: function () {\n          return name;\n        },\n        id: function () {\n          return id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.error) {\n        notify.error(\"Error: \" + ret.error);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.soundscapesOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].soundscape_id === id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.soundscapesOriginal.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Soundscape deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.createNewSoundscape = function () {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to create soundscapes');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/soundscapes/createnewsoundscape.html',\n      controller: 'CreateNewSoundscapeInstanceCtrl',\n      resolve: {\n        amplitudeReferences: function (a2Soundscapes) {\n          return a2Soundscapes.getAmplitudeReferences();\n        },\n        playlists: function () {\n          return $scope.playlists;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new soundscape is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      }\n\n      if (data.err) {\n        notify.error(data.err);\n      }\n\n      if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  if (isNewJob) {\n    $scope.createNewSoundscape();\n  }\n\n  $scope.showDetails = function (soundscapeId) {\n    a2Soundscapes.get(soundscapeId, function (soundscape) {\n      a2Playlists.getInfo(soundscape.playlist_id, function (plist) {\n        var modalInstance = $modal.open({\n          controller: 'SoundscapesDetailsCtrl as controller',\n          templateUrl: '/app/analysis/soundscapes/details.html',\n          resolve: {\n            soundscape: function () {\n              return soundscape;\n            },\n            playlist: function () {\n              return plist;\n            }\n          }\n        });\n      });\n    });\n  };\n\n  this.exportSoundscape = function (options) {\n    if (a2UserPermit.isSuper()) return this.getExportUrl(options);\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export soundscape data');\n    }\n\n    this.getExportUrl(options);\n  };\n\n  this.getExportUrl = function (options) {\n    a2Soundscapes.getExportUrl(options).then(function (export_url) {\n      var a = $('<a></a>').attr('target', '_blank').attr('href', export_url).appendTo('body');\n      $window.setTimeout(function () {\n        a[0].click();\n        a.remove();\n      }, 0);\n    });\n  };\n}).controller('DeleteSoundscapeInstanceCtrl', function ($scope, $modalInstance, a2Soundscapes, name, id, projectData) {\n  $scope.name = name;\n  $scope.id = id;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    a2Soundscapes.delete(id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('CreateNewSoundscapeInstanceCtrl', function ($scope, $modalInstance, a2Soundscapes, $timeout, projectData, playlists) {\n  $scope.projectData = projectData;\n  $scope.playlists = playlists;\n  $scope.buttonEnableFlag = true;\n  $scope.datasubmit = {\n    name: '',\n    playlist: '',\n    aggregation: '',\n    threshold: 0,\n    thresholdReference: 'absolute',\n    bin: 86,\n    bandwidth: 0,\n    normalize: false\n  };\n  $scope.nameMsg = '';\n\n  $scope.aggregationValue = function (val) {\n    $scope.$apply(function () {\n      $scope.datasubmit.aggregation = val;\n    });\n  };\n\n  $scope.ok = function () {\n    var url = $scope.projectData.url;\n    $scope.nameMsg = '';\n    a2Soundscapes.create({\n      n: $scope.datasubmit.name,\n      p: $scope.datasubmit.playlist,\n      a: $scope.datasubmit.aggregation,\n      t: $scope.datasubmit.threshold,\n      tr: $scope.datasubmit.thresholdReference,\n      m: 22050,\n      b: $scope.datasubmit.bin,\n      f: $scope.datasubmit.bandwidth,\n      nv: $scope.datasubmit.normalize\n    }).success(function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    }).error(function (data) {\n      if (data.err) {\n        $modalInstance.close({\n          err: \"Error: \" + data.err\n        });\n      } else {\n        $modalInstance.close({\n          err: \"Error: Cannot create soundscape job\"\n        });\n      }\n    });\n  };\n\n  $scope.buttonEnable = function () {\n    return $scope.datasubmit.bin === 0 || typeof $scope.datasubmit.bin.length == 'string' || $scope.datasubmit.aggregation.length === 0 || typeof $scope.datasubmit.threshold.length == 'string' || typeof $scope.datasubmit.bandwidth.length == 'string' || $scope.datasubmit.name.length === 0 || typeof $scope.datasubmit.playlist == 'string';\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n}).directive('a2Aggregationtypeselector', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      \"selected\": \"=\"\n    },\n    templateUrl: '/app/analysis/soundscapes/aggregationtypetelector.html',\n    controller: function ($scope) {\n      $scope.aggregations = [{\n        name: 'Hour in Day',\n        scale: ['00:00', '01:00', '......', '22:00', '23:00'],\n        id: 'time_of_day'\n      }, {\n        name: 'Day in Week',\n        scale: ['Sun', 'Mon', '......', 'Fri', 'Sat'],\n        id: 'day_of_week'\n      }, {\n        name: 'Day in Month',\n        scale: ['1', '2', '......', '30', '31'],\n        id: 'day_of_month'\n      }, {\n        name: 'Month in Year',\n        scale: ['Jan', 'Feb', '......', 'Nov', 'Dec'],\n        id: 'month_in_year'\n      }, {\n        name: 'Day in Year',\n        scale: ['1', '2', '......', '365', '366'],\n        id: 'day_of_year'\n      }, {\n        name: 'Year',\n        scale: ['2010', '2011', '......', '2016', '2017'],\n        id: 'year'\n      }];\n      $scope.width = 200;\n      $scope.padding = 18;\n      $scope.height = 20;\n\n      $scope.select = function (aggr) {\n        $scope.selected = aggr.id;\n      };\n    }\n  };\n}).directive('a2DrawAggregation', function ($window) {\n  var d3 = $window.d3;\n  return {\n    restrict: 'E',\n    scope: {\n      \"aggregation\": \"=\"\n    },\n    link: function (scope, element, attrs) {\n      // console.log(scope.aggregation);\n      var draw = function (aggre) {\n        var width = 200;\n        var height = 20;\n        var padding = 18;\n        var svgContainer = d3.select(element[0]).append(\"svg\").attr(\"width\", width).attr(\"height\", height);\n        var axisScale = d3.scale.linear().domain([0, 4]).range([padding, width - padding]);\n        var xAxis = d3.svg.axis().scale(axisScale).orient(\"bottom\").ticks(5).tickValues([0, 1, 2, 3, 4]).tickFormat(function (d) {\n          return aggre.scale[d];\n        });\n        var xAxisGroup = svgContainer.append(\"g\").attr(\"transform\", \"translate(0,1)\").attr(\"class\", \"aggregationaxis\").call(xAxis);\n      };\n\n      scope.$watch('aggregation', function (value) {\n        if (value) draw(value);\n      });\n    }\n  };\n}).directive('a2ThresholdSelector', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    scope: {\n      \"threshold\": \"=\",\n      \"thresholdReference\": \"=\",\n      \"bandwidth\": \"=\"\n    },\n    templateUrl: '/app/analysis/soundscapes/thresholdselector.html',\n    link: function ($scope) {\n      $scope.amplitudeReferences = [];\n      var afterGetAmplitudeReferences = a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n        $scope.amplitudeReferences = amplitudeReferences;\n      });\n\n      $scope.setAmplitudeReference = function (amplitudeReference) {\n        console.log(\"amplitudeReference\", amplitudeReference);\n        $scope.thresholdReference = amplitudeReference.value;\n      };\n\n      $scope.$watch('thresholdReference', function (thresholdReference) {\n        afterGetAmplitudeReferences.then(function () {\n          console.log(\"thresholdReference\", thresholdReference, $scope.amplitudeReferences);\n          $scope.amplitudeReference = $scope.amplitudeReferences.reduce(function (_, item) {\n            return _ || (item.value == thresholdReference ? item : null);\n          });\n        });\n      });\n      $scope.$watch('threshold', function (n, o) {\n        console.log('threshold', n, o);\n        $scope.thresholdInvPercent = (1 - $scope.threshold) * 100;\n      });\n      $scope.$watch('thresholdInvPercent', function (n, o) {\n        console.log('thresholdInvPercent', n, o);\n        var precision = 0.1;\n        $scope.threshold = Math.round((100 - $scope.thresholdInvPercent) / precision) / (100 / precision);\n      });\n    }\n  };\n}).directive('a2DrawPeakThreshold', function ($window) {\n  var d3 = $window.d3;\n  return {\n    restrict: 'E',\n    scope: {\n      \"threshold\": \"=\",\n      \"bandwidth\": \"=\"\n    },\n    link: function ($scope, element, attrs) {\n      var data = [0.7, 1.0, 0.1, 0.55, 0.1, 0.6, 0.9, 0.01, 0.15, 0.1, 0.4, 0.1];\n      var data_scale = 0.5;\n      var lineData = [];\n\n      for (var i = 0; i < data.length; i++) {\n        lineData.push({\n          x: i + 1,\n          y: data[i] * data_scale\n        });\n      }\n\n      var peaks = [{\n        x: 2.6,\n        y: 1.0 * data_scale,\n        d: 999999\n      }, {\n        x: 4.4,\n        y: 0.55 * data_scale,\n        d: 210\n      }, {\n        x: 7,\n        y: 0.9 * data_scale,\n        d: 520\n      }, {\n        x: 9,\n        y: 0.15 * data_scale,\n        d: 750\n      }, {\n        x: 11,\n        y: 0.4 * data_scale,\n        d: 950\n      }];\n      var WIDTH = 250,\n          HEIGHT = 70,\n          MARGINS = {\n        top: 10,\n        right: 10,\n        bottom: 10,\n        left: 24\n      };\n      var vis = d3.select(element[0]).append('svg').attr('width', WIDTH).attr('height', HEIGHT);\n      var xRange = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([d3.min(lineData, function (d) {\n        return d.x;\n      }), d3.max(lineData, function (d) {\n        return d.x;\n      })]);\n      var yRange = d3.scale.linear().domain([0, 1]).range([HEIGHT - MARGINS.top, MARGINS.bottom]);\n      var xAxis = d3.svg.axis().scale(xRange).ticks(0);\n      var yAxis = d3.svg.axis().scale(yRange).ticks(3).tickSize(3).orient('left').tickSubdivide(true);\n\n      var drawAmpThreshold = function (ampThresh) {\n        yval = 50 * (1 - ampThresh) + 10;\n        vis.selectAll(\"line.movingline\").remove();\n        $scope.line = vis.append('svg:line').attr(\"x1\", MARGINS.left).attr(\"y1\", yval).attr(\"x2\", WIDTH - MARGINS.right).attr(\"y2\", yval).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none').attr('class', 'movingline');\n        vis.selectAll(\"text.peakText\").remove();\n        var peaki = 1;\n\n        for (var i = 0; i < peaks.length; i++) {\n          if (peaks[i].y >= ampThresh && peaks[i].d >= $scope.bandwidth) {\n            $scope.peakText = vis.append(\"text\").attr(\"x\", WIDTH * (peaks[i].x / lineData.length)).attr(\"y\", 50 * (1 - peaks[i].y) + 10).attr('font-size', '11px').style(\"text-anchor\", \"middle\").attr('class', 'peakText').text(\"P\" + peaki);\n            peaki = peaki + 1;\n          }\n        }\n      };\n\n      $scope.$watch('threshold', function () {\n        if (!$scope.threshold) return;\n        drawAmpThreshold($scope.threshold);\n      });\n      $scope.$watch('bandwidth', function () {\n        // $scope.banwidthPerc = ($scope.bandwidth)/100;\n        // $scope.banwidthValue = Math.round(1000*$scope.banwidthPerc);\n        $scope.banwidthValue = $scope.bandwidth;\n        xval = Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11 + 190 * ($scope.bandwidth / 1000);\n        vis.selectAll(\"line.movingline1\").remove();\n        $scope.line = vis.append('svg:line').attr(\"x1\", xval).attr(\"y1\", 12).attr(\"x2\", xval).attr(\"y2\", 60).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none').attr('class', 'movingline1');\n        vis.selectAll(\"text.peakText\").remove();\n        var peaki = 1;\n\n        for (var i = 0; i < peaks.length; i++) {\n          if (peaks[i].y >= $scope.threshold && peaks[i].d > $scope.banwidthValue) {\n            $scope.peakText = vis.append(\"text\").attr(\"x\", WIDTH * (peaks[i].x / lineData.length)).attr(\"y\", 50 * (1 - peaks[i].y) + 10).attr('font-size', '11px').style(\"text-anchor\", \"middle\").attr('class', 'peakText').text(\"P\" + peaki);\n            peaki = peaki + 1;\n          }\n        } // $scope.onBandwidth($scope.banwidthValue);\n        // console.log($scope.banwidthValue);\n\n      });\n      vis.append('svg:g').attr('class', 'thresholdaxis').attr('transform', 'translate(0,' + (HEIGHT - MARGINS.bottom) + ')').call(xAxis);\n      vis.append('svg:g').attr('class', 'thresholdaxis').attr('transform', 'translate(' + MARGINS.left + ',0)').call(yAxis);\n      var lineFunc = d3.svg.line().x(function (d) {\n        return xRange(d.x);\n      }).y(function (d) {\n        return yRange(d.y);\n      }).interpolate('linear');\n      vis.append('svg:path').attr('d', lineFunc(lineData)).attr('stroke', 'blue').attr('stroke-width', 2).attr('fill', 'none');\n      $scope.line = vis.append('svg:line').attr(\"x1\", Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11).attr(\"y1\", 12).attr(\"x2\", Math.floor(WIDTH * (peaks[0].x / lineData.length)) - 11).attr(\"y2\", 60).attr('stroke', 'red').attr('stroke-width', 2).attr('fill', 'none');\n      vis.append(\"text\").attr(\"x\", WIDTH / 2).attr(\"y\", 68).attr('font-size', '9px').style(\"text-anchor\", \"middle\").text(\"Hz\");\n    }\n  };\n}).controller('SoundscapesDetailsCtrl', function ($scope, soundscape, playlist, a2Soundscapes, a2UserPermit) {\n  $scope.showDownload = a2UserPermit.can('manage soundscapes');\n\n  var data2xy = function (offset) {\n    offset = offset || 0;\n    return function (d, i) {\n      return {\n        x: i + offset,\n        y: d\n      };\n    };\n  };\n\n  $scope.soundscape = soundscape;\n  $scope.playlist = playlist;\n  $scope.chartOptions = {\n    lineColor: '#c42',\n    width: 400,\n    height: 400\n  };\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, _1) {\n      _[_1.value] = _1;\n      return _;\n    }, {});\n  }.bind(this));\n  a2Soundscapes.findIndices(soundscape.id, function (result) {\n    if (!result) return;\n    $scope.index = {\n      H: [],\n      ACI: [],\n      NP: []\n    };\n    $scope.indices = [];\n    $scope.indices.push({\n      time: \"TIME\",\n      ACI: \"ACI\",\n      NP: \"NP\"\n    });\n\n    for (var i = 0; i < result.H.length; i++) {\n      var t = i + soundscape.min_t;\n      $scope.indices.push({\n        time: t,\n        ACI: result.ACI[i],\n        NP: result.NP[i]\n      });\n      $scope.index.H.push({\n        x: t,\n        y: result.H[i]\n      });\n      $scope.index.ACI.push({\n        x: t,\n        y: result.ACI[i]\n      });\n      $scope.index.NP.push({\n        x: t,\n        y: result.NP[i]\n      });\n    }\n  });\n});","angular.module('a2.audiodata.playlists.playlist-arithmetic', []).directive('playlistArithmetic', function (a2Playlists) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/playlists/playlist-arithmetic.html',\n    scope: {\n      onExpressionSelected: '&'\n    },\n    controller: 'playlistArithmeticController as controller',\n    requires: '^PlaylistCtrl',\n    link: function (scope, element, attrs) {\n      var controller = scope.controller;\n      controller.initialize({\n        onSelected: function (expression) {\n          scope.onExpressionSelected({\n            expression: expression\n          });\n        }\n      });\n      scope.$on('$destroy', function () {\n        controller.$destroy();\n      });\n    }\n  };\n}).controller('playlistArithmeticController', function (a2Playlists, $interpolate) {\n  this.selected = {};\n  this.operations = [{\n    type: 'union',\n    text: 'Join playlist 1 and 2',\n    icon: 'a2-union',\n    nameTemplate: '{{playlist1}} joined with {{playlist2}}'\n  }, {\n    type: 'intersection',\n    text: 'Intersect playlist 1 and 2',\n    icon: 'a2-intersect',\n    nameTemplate: '{{playlist1}} intersected with {{playlist2}}'\n  }, {\n    type: 'subtraction',\n    text: 'Remove playlist 2 from playlist 1',\n    icon: 'a2-difference',\n    nameTemplate: '{{playlist1}} minus {{playlist2}}'\n  }];\n  var removeOnInvalidateHandler;\n\n  this.initialize = function (options) {\n    this.options = options || {};\n    removeOnInvalidateHandler = a2Playlists.$on('invalidate-list', function () {\n      this.reset();\n    }.bind(this));\n    this.reset();\n    this.updateNamePlaceholder();\n  };\n\n  this.reset = function () {\n    return a2Playlists.getList().then(function (playlists) {\n      this.playlists = playlists;\n    }.bind(this));\n  };\n\n  this.$destroy = function () {\n    removeOnInvalidateHandler();\n  };\n\n  this.updateNamePlaceholder = function () {\n    var nameTemplate = (this.selected.operation || {}).nameTemplate || 'Playlist 3';\n    var term1 = this.selected.term1 || {};\n    var term2 = this.selected.term2 || {};\n    this.namePlaceholder = $interpolate(nameTemplate)({\n      playlist1: term1.name || '(playlist 1)',\n      playlist2: term2.name || '(playlist 2)'\n    });\n  };\n\n  this.submit = function () {\n    var operation = this.selected.operation;\n    var term1 = this.selected.term1;\n    var term2 = this.selected.term2;\n    var name = this.selected.name || this.namePlaceholder;\n\n    if (operation && term1 && term2 && name) {\n      if (this.options.onSelected) {\n        this.options.onSelected({\n          operation: operation.type,\n          term1: term1.id,\n          term2: term2.id,\n          name: name\n        });\n      }\n    }\n  };\n});","angular.module('a2.audiodata.playlists', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.audiodata.playlists.playlist-arithmetic', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.playlists', {\n    url: '/playlists',\n    controller: 'PlaylistCtrl as controller',\n    templateUrl: '/app/audiodata/playlists/playlists.html'\n  });\n}).controller('PlaylistCtrl', function ($scope, a2Playlists, $modal, notify, a2UserPermit, $location) {\n  this.initialize = function () {\n    removeOnInvalidateHandler = a2Playlists.$on('invalidate-list', function () {\n      this.reset();\n    }.bind(this));\n    this.reset();\n  };\n\n  this.reset = function () {\n    $scope.loading = true;\n    a2Playlists.getList({\n      info: true\n    }).then(function (data) {\n      $scope.playlists = data;\n      $scope.loading = false;\n    });\n  };\n\n  this.operate = function (expression) {\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to combine playlists');\n      return;\n    }\n\n    return a2Playlists.combine(expression).then(function () {\n      notify.log('Playlist created');\n    }).catch(function (err) {\n      err = err || {};\n      notify.error(err.message || err.data || 'Server error');\n    });\n  };\n\n  this.edit = function () {\n    if (!$scope.checked.length || $scope.checked.length > 1) {\n      notify.log('Please select one playlist to edit');\n      return;\n    }\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to edit playlists');\n      return;\n    }\n\n    $scope.pname = $scope.checked[0].name;\n    const playlist_id = $scope.checked[0].id;\n    const modalInstance = $modal.open({\n      templateUrl: '/app/audiodata/edit-playlist.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function (playlistName) {\n      a2Playlists.rename({\n        id: playlist_id,\n        name: playlistName\n      }, function (data) {\n        if (data.error) return console.log(data.error);\n      });\n    });\n  };\n\n  $scope.del = function () {\n    if (!$scope.checked || !$scope.checked.length) return;\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to delete playlists');\n      return;\n    }\n\n    const playlists = $scope.checked.map(function (row) {\n      return '\"' + row.name + '\"';\n    });\n    const message = [\"You are about to delete the following playlists: \"];\n    const message2 = [\"Are you sure?\"];\n    $scope.popup = {\n      messages: message.concat(playlists, message2),\n      btnOk: \"Yes\",\n      btnCancel: \"No\"\n    };\n    const modalInstance = $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      scope: $scope\n    });\n    modalInstance.result.then(function () {\n      const playlistIds = $scope.checked.map(function (pl) {\n        return pl.id;\n      });\n      $scope.loading = true;\n      a2Playlists.remove(playlistIds, function (data) {\n        if (data.error) return notify.error(data.error);\n        a2Playlists.getList().then(function (data) {\n          $scope.playlists = data;\n          $scope.loading = false;\n          notify.log((playlistIds.length > 1 ? 'Playlists ' : 'Playlist ') + 'deleted');\n        });\n      });\n    });\n  };\n\n  $scope.create = function (url) {\n    $location.path(url);\n  };\n\n  this.initialize();\n});","angular.module('a2.audiodata.recordings.data-export-parameters', ['a2.directive.a2-auto-close-on-outside-click', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane', 'a2.directive.error-message']).directive('recordingDataExportParameters', function ($document, $rootScope) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/recordings/export-parameters.html',\n    scope: {\n      onExport: '&'\n    },\n    controller: 'recordingDataExportParametersController as controller',\n    requires: '^RecsCtrl',\n    link: function (scope, element, attrs, controller) {\n      controller.initialize({\n        onExport: function (parameters) {\n          scope.onExport({\n            parameters: parameters\n          });\n        }\n      });\n    }\n  };\n}).service('recordingDataFieldTypes', function () {\n  return [{\n    title: 'Recording fields',\n    identifier: 'recording',\n    placeholder: 'filename, site, ...',\n    list: [{\n      value: 'filename',\n      caption: 'Filename',\n      tooltip: 'The recording filename'\n    }, {\n      value: 'site',\n      caption: 'Site',\n      tooltip: 'The recording site'\n    }, {\n      value: 'day',\n      caption: 'Day',\n      tooltip: 'The recording day'\n    }, {\n      value: 'hour',\n      caption: 'Hour',\n      tooltip: 'The recording hour'\n    }, {\n      value: 'url',\n      caption: 'Url',\n      tooltip: 'The recording URl'\n    }],\n    preselected: ['filename', 'site', 'day']\n  }, {\n    title: 'Validations by species/song type',\n    identifier: 'validation',\n    placeholder: 'Species - Sound...',\n    getList: function (Project) {\n      return Project.getClasses({\n        validations: true\n      }).then(function (classes) {\n        return classes.map(function (cls) {\n          return {\n            value: cls.id,\n            caption: cls.species_name + ' - ' + cls.songtype_name,\n            badges: [{\n              icon: 'val-1',\n              value: cls.vals_present\n            }, {\n              icon: 'val-0',\n              value: cls.vals_absent\n            }]\n          };\n        });\n      });\n    }\n  }, {\n    title: 'Soundscape Composition',\n    identifier: 'soundscapeComposition',\n    placeholder: 'Wind, Birds, ...',\n    getList: function (a2SoundscapeCompositionService) {\n      return a2SoundscapeCompositionService.getClassList({\n        isSystemClass: 1\n      }).then(function (classes) {\n        return classes.map(function (cls) {\n          return {\n            value: cls.id,\n            caption: cls.name,\n            group: cls.type\n          };\n        });\n      });\n    }\n  }, {\n    title: 'Tags',\n    identifier: 'tag',\n    placeholder: 'Tags...',\n    getList: function (a2Tags) {\n      return a2Tags.getForType('recording').then(function (tags) {\n        return tags.map(function (tag) {\n          return {\n            value: tag.tag_id,\n            caption: tag.tag,\n            icon: 'fa-tag',\n            badges: [{\n              value: tag.count\n            }]\n          };\n        });\n      }.bind(this));\n    }\n  }, {\n    title: 'Grouping of Detections',\n    identifier: 'grouped',\n    placeholder: 'Detections grouped by...',\n    list: [{\n      value: 'site',\n      caption: 'Site',\n      tooltip: 'Detections grouped by Site'\n    }, {\n      value: 'hour',\n      caption: 'Hour',\n      tooltip: 'Detections grouped by Hour'\n    }, {\n      value: 'date',\n      caption: 'Date',\n      tooltip: 'Detections grouped by Date'\n    }]\n  }, {\n    title: 'Occupancy Model Format',\n    identifier: 'species',\n    placeholder: 'Select species...',\n    getList: function (Project) {\n      return Project.getClasses().then(function (classes) {\n        // Exclude classes with repeating species names\n        var cl = {};\n        classes.forEach(function (cls) {\n          const id = cls.species_name.split(' ').join('_');\n\n          if (!cl[id]) {\n            cl[id] = {\n              value: cls.species,\n              caption: cls.species_name,\n              name: id\n            };\n          }\n        });\n        return Object.values(cl);\n      });\n    }\n  }];\n}).controller('recordingDataExportParametersController', function ($q, $injector, notify, recordingDataFieldTypes, a2UserPermit) {\n  this.initialize = function (options) {\n    options = options || {};\n\n    if (options.onExport) {\n      this.onExport = options.onExport;\n    }\n\n    this.parameter_set_list = recordingDataFieldTypes;\n    this.selected = [];\n    this.lists = this.parameter_set_list.map(function () {\n      return [];\n    });\n\n    function getList(parameter_set) {\n      return $q.resolve(parameter_set.getList ? $injector.invoke(parameter_set.getList) : parameter_set.list || []);\n    }\n\n    $q.all(this.parameter_set_list.map(getList)).then(function (allLists) {\n      this.lists = allLists;\n\n      if (this.isRfcx() && this.lists[1] && this.lists[1].length) {\n        this.lists[1].splice(0, 0, {\n          value: -1,\n          caption: 'Select all species'\n        });\n      }\n\n      if (this.isRfcx() && this.lists[5] && this.lists[5].length) {\n        this.lists[5].splice(0, 0, {\n          value: 0,\n          caption: 'Select all species',\n          name: 0\n        });\n      }\n\n      this.selected = this.parameter_set_list.map(function (parameter_set, idx) {\n        if (parameter_set.preselected) {\n          var listByValue = allLists[idx].reduce(function (_, item) {\n            _[item.value] = item;\n            return _;\n          }, {});\n          return (parameter_set.preselected || []).map(function (value) {\n            return listByValue[value];\n          }).filter(function (_) {\n            return !!_;\n          });\n        } else {\n          return [];\n        }\n      });\n    }.bind(this));\n  };\n\n  this.isSuper = a2UserPermit.isSuper();\n  this.isRfcxUser = a2UserPermit.isRfcx();\n  this.isRfcx = function () {\n    return this.isRfcxUser || this.isSuper;\n  }, this.checkSelectedValue = function (selected) {\n    return selected && selected.find(function (row) {\n      return row.value === -1;\n    });\n  };\n\n  this.onSelected = function (selectedItem) {\n    if (selectedItem && selectedItem.value === -1 && selectedItem.caption === 'Select all species') {\n      this.selected[1] = [selectedItem];\n    }\n\n    if (selectedItem && selectedItem.value === 0 && selectedItem.caption === 'Select all species') {\n      this.selected[5] = [selectedItem];\n    }\n  };\n\n  this.resetFilters = function () {\n    this.selected = [];\n  };\n\n  this.isDisabled = function () {\n    return this.selected && this.selected[1] && this.selected[1].length && this.selected[1].length > 20;\n  };\n\n  this.isRecordingEmpty = function () {\n    return this.selected && this.selected[0] && this.selected[0].length === 0;\n  };\n\n  this.exportData = function () {\n    if (this.isRecordingEmpty()) {\n      notify.log('At least 1 recording field is required');\n      return;\n    }\n\n    var selected = this.selected;\n\n    if (this.isRfcx() && selected[1] && selected[1].find(function (row) {\n      return row.value === -1;\n    })) {\n      selected[1] = this.lists[1].filter(function (item) {\n        if (item.value !== -1) {\n          return item;\n        }\n      });\n    }\n\n    if (this.isRfcx() && selected[5] && selected[5].find(function (row) {\n      return row.value === 0;\n    })) {\n      selected[5] = this.lists[5].filter(function (item) {\n        if (item.value !== 0) {\n          return item;\n        }\n      });\n    }\n\n    this.onExport(this.parameter_set_list.reduce(function (_, parameter_set, index) {\n      if (selected[index] && selected[index].length && parameter_set.identifier !== 'species') {\n        _[parameter_set.identifier] = selected[index].map(function (item) {\n          return item.value;\n        });\n      }\n\n      if (selected[index] && parameter_set.identifier === 'grouped' && selected[index].value) {\n        _[parameter_set.identifier] = selected[index].value;\n        _['grouped'] = selected[index].value;\n      }\n\n      if (selected[index] && parameter_set.identifier === 'species' && selected[index].length) {\n        _[parameter_set.identifier] = selected[index].map(function (item) {\n          return item.value;\n        });\n        _['species_name'] = selected[index].map(function (item) {\n          return item.name;\n        });\n      }\n\n      return _;\n    }, {}));\n  };\n\n  this.onExport = function (parameters) {\n    console.log(\"export parameters : \", parameters);\n  };\n});","angular.module('a2.audiodata.recordings.filter-parameters', ['a2.directive.a2-auto-close-on-outside-click', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).directive('recordingFilterParameters', function ($document, $rootScope) {\n  return {\n    restrict: 'E',\n    templateUrl: '/app/audiodata/recordings/filter-parameters.html',\n    scope: {\n      isOpen: '=',\n      maxDate: '=',\n      minDate: '=',\n      recTotal: '=',\n      isLoading: '=',\n      onApplyFilters: '&'\n    },\n    controller: 'recordingFilterParametersController as controller',\n    requires: '^RecsCtrl',\n    link: function (scope, element, attrs) {\n      var controller = scope.controller;\n\n      scope.applyFilters = function () {\n        scope.onApplyFilters({\n          filters: controller.getFilters()\n        });\n      };\n\n      scope.resetFilters = function () {\n        controller.params = {};\n        scope.onApplyFilters({\n          filters: controller.getFilters()\n        });\n      };\n\n      controller.fetchOptions();\n    }\n  };\n}).controller('recordingFilterParametersController', function ($scope, Project, a2Classi, a2SoundscapeCompositionService, a2Playlists, $q, a2Tags, $window) {\n  var staticMonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map(function (mon, ind) {\n    return {\n      value: ind,\n      string: mon,\n      count: null\n    };\n  });\n  var staticDays = [];\n\n  for (var day = 1; day <= 31; day++) {\n    staticDays.push({\n      value: day,\n      count: null\n    });\n  }\n\n  var staticHours = [];\n\n  for (var hour = 0; hour < 24; hour++) {\n    staticHours.push({\n      value: hour,\n      string: (hour < 10 ? '0' : '') + hour + ':00',\n      count: null\n    });\n  }\n\n  function _1_get(attribute) {\n    return function (_1) {\n      return _1[attribute];\n    };\n  }\n\n  function _1_mapper(mapFn) {\n    return function (_1) {\n      return _1.length !== undefined && _1.map(mapFn);\n    };\n  }\n\n  var _1_get_value_mapper = _1_mapper(_1_get(\"value\"));\n\n  var _1_get_id_mapper = _1_mapper(_1_get(\"id\"));\n\n  var _1_get_tag_id_mapper = _1_mapper(_1_get(\"tag_id\"));\n\n  var _1_get_flags_mapper = _1_mapper(_1_get(\"flags\"));\n\n  var findObjectWith = function (arr, key, value) {\n    var result = arr.filter(function (obj) {\n      return obj[key] === value;\n    });\n    return result.length > 0 ? result[0] : null;\n  };\n\n  var classification_results = {\n    model_only: [{\n      caption: '<i class=\"fa a2-present\"></i> Present',\n      tooltip: 'Present',\n      flags: {\n        model: 1\n      },\n      equiv: {\n        model_th: [1, 3]\n      }\n    }, {\n      caption: '<i class=\"fa a2-absent\"></i> Absent',\n      tooltip: 'Absent',\n      flags: {\n        model: 0\n      },\n      equiv: {\n        model_th: [0, 2]\n      }\n    }],\n    model_th: [{\n      caption: 'Model: <i class=\"fa a2-present\"></i>, Th: <i class=\"fa a2-present\"></i>',\n      tooltip: 'Model: present, Theshold: present',\n      flags: {\n        model: 1,\n        th: 1\n      },\n      equiv: {\n        model_only: [1]\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-present\"></i>, Th: <i class=\"fa a2-absent\"></i>',\n      tooltip: 'Model: present, Theshold: absent',\n      flags: {\n        model: 1,\n        th: 0\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-absent\"></i>, Th: <i class=\"fa a2-present\"></i>',\n      tooltip: 'Model: absent, Theshold: present',\n      flags: {\n        model: 0,\n        th: 1\n      }\n    }, {\n      caption: 'Model: <i class=\"fa a2-absent\"></i>, Th: <i class=\"fa a2-absent\"></i>',\n      tooltip: 'Model: absent, Theshold: absent',\n      flags: {\n        model: 0,\n        th: 0\n      },\n      equiv: {\n        model_only: [0]\n      }\n    }]\n  };\n  this.options = {\n    classes: [],\n    presence: ['present', 'absent'],\n    sites: [],\n    sites_ids: [],\n    playlists: [],\n    years: [],\n    months: [],\n    days: [],\n    hours: [],\n    tags: [],\n    classifications: [],\n    classification_results: classification_results.model_only,\n    soundscape_composition: [],\n    soundscape_composition_annotation: ['present', 'absent']\n  };\n  this.params = {};\n  this.loading = {\n    sites: false\n  };\n  var filterDefs = [{\n    name: \"range\",\n    map: function set_range_bounds(range) {\n      return range;\n    }\n  }, {\n    name: \"sites\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"sites_ids\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"hours\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"months\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"years\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"days\",\n    map: _1_get_value_mapper\n  }, {\n    name: \"playlists\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"validations\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"tags\",\n    map: _1_get_tag_id_mapper\n  }, {\n    name: \"presence\"\n  }, {\n    name: \"classifications\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"classification_results\",\n    map: _1_get_flags_mapper\n  }, {\n    name: \"soundscape_composition\",\n    map: _1_get_id_mapper\n  }, {\n    name: \"soundscape_composition_annotation\"\n  }];\n\n  this.getFilters = function () {\n    var filters = {};\n    var params = this.params;\n    filterDefs.forEach(function (filterDef) {\n      var param = params[filterDef.name];\n      var value = param && filterDef.map ? filterDef.map(param) : param;\n\n      if (value instanceof Array ? value.length : value) {\n        filters[filterDef.name] = value;\n      }\n\n      if (value && filterDef.name === 'sites') {\n        const vals = filterDefs[2].map(param);\n        filters['sites_ids'] = vals;\n      }\n    });\n    return filters;\n  };\n\n  this.getRecordingsStatsPerSite = function (sites, filters, options) {\n    var proms = sites.map(function (site) {\n      return Project.getRecordingAvailability('!q:' + site.id + '---[1:31]');\n    });\n    return $q.all(proms).then(function (data) {\n      return data.reduce(function (_, recAv) {\n        return angular.merge(_, recAv);\n      }, {});\n    }).then(function (data) {\n      // loading.sites = false\n      var lists = {\n        sites: [],\n        // sitesList\n        years: [],\n        // yearsList\n        months: [],\n        // monthsList\n        days: [],\n        // daysList\n        hours: [] // hoursList\n\n      };\n      var levelIds = Object.keys(lists);\n\n      var getFilterOptions = function (filters, obj, level) {\n        var count = 0;\n        const currentLevel = levelIds[level];\n\n        for (var child in obj) {\n          if (Object.keys(filters).length && filters[currentLevel] && filters[currentLevel].indexOf(child) === -1) {\n            // skip if filter is define and the value is not in it\n            continue;\n          }\n\n          var item = findObjectWith(lists[currentLevel], 'value', child);\n\n          if (!item) {\n            const siteObj = currentLevel == 'sites' ? sites.find(function (site) {\n              return site.name === child;\n            }) : {};\n            item = {\n              value: child,\n              count: 0\n            };\n\n            if (currentLevel == 'sites') {\n              item.id = siteObj.id;\n            }\n\n            lists[currentLevel].push(item);\n          }\n\n          var itemCount;\n\n          if (typeof obj[child] == 'number') {\n            itemCount = obj[child];\n          } else {\n            if (level === 0) count = 0;\n            itemCount = getFilterOptions(filters, obj[child], level + 1);\n          }\n\n          item.count += itemCount;\n          count += itemCount;\n        }\n\n        return count;\n      };\n\n      getFilterOptions(filters, data, 0);\n      options.sites = lists.sites;\n      options.years = lists.years;\n      options.months = lists.months.map(function (month) {\n        month.value = parseInt(month.value);\n        month.value--;\n        return {\n          value: month.value,\n          string: $window.moment().month(month.value).format('MMM'),\n          count: month.count\n        };\n      });\n      options.days = lists.days.map(function (day) {\n        day.value = parseInt(day.value);\n        return day;\n      });\n      options.hours = lists.hours.map(function (hour) {\n        hour.value = parseInt(hour.value);\n        return {\n          value: hour.value,\n          string: $window.moment().hour(hour.value).minute(0).format('HH:mm'),\n          count: hour.count\n        };\n      });\n\n      var sort = function (a, b) {\n        return a.value > b.value ? 1 : -1;\n      };\n\n      options.sites.sort(sort);\n      options.years.sort(sort);\n      options.months.sort(sort);\n      options.days.sort(sort);\n      options.hours.sort(sort);\n    });\n  };\n\n  this.setRecStatsStatic = function (sites, bounds, options) {\n    options.sites = sites.map(function (site) {\n      return {\n        value: site.name,\n        count: null,\n        id: site.id\n      };\n    });\n    var years = [];\n    var maxYear = (bounds.max ? new Date(bounds.max) : new Date()).getFullYear();\n    var minYear = bounds.min ? new Date(bounds.min).getFullYear() : '1990';\n\n    for (var year = maxYear; year >= minYear; year--) {\n      years.push({\n        value: year,\n        count: null\n      });\n    }\n\n    options.years = years;\n    options.months = staticMonths;\n    options.days = staticDays;\n    options.hours = staticHours;\n  };\n\n  this.fetchOptions = function (filters) {\n    var self = this;\n\n    if (filters === undefined) {\n      filters = {};\n    }\n\n    var options = this.options;\n    var loading = this.loading;\n    var sites;\n\n    if ($scope.recTotal === undefined || $scope.minDate === undefined || $scope.maxDate === undefined) {\n      // wait until all inputs are populated to make proper decision in a condition below\n      setTimeout(function () {\n        this.fetchOptions(filters);\n      }.bind(this), 1000);\n      return;\n    }\n\n    loading.sites = true;\n    Project.getSites().then(function (data) {\n      sites = data;\n\n      if (sites.length < 50 && $scope.recTotal < 100000) {\n        return self.getRecordingsStatsPerSite(sites, filters, options);\n      } else {\n        return self.setRecStatsStatic(sites, {\n          min: $scope.minDate.toISOString(),\n          max: $scope.maxDate.toISOString()\n        }, options);\n      }\n    }).finally(function () {\n      loading.sites = false;\n    });\n    Project.getClasses({\n      validations: true\n    }, function (classes) {\n      options.classes = classes;\n    });\n    a2Playlists.getList().then(function (playlists) {\n      options.playlists = playlists;\n    });\n    a2Tags.getForType('recording').then(function (tags) {\n      var tagsObj = {};\n      tags.forEach(function (t) {\n        var key = t.tag;\n\n        if (!tagsObj[key]) {\n          tagsObj[key] = {\n            tag: key,\n            tag_id: [t.tag_id],\n            count: t.count\n          };\n        } else {\n          tagsObj[key].tag_id.push(t.tag_id);\n          tagsObj[key].count++;\n        }\n      });\n      options.tags = Object.values(tagsObj);\n    }.bind(this));\n    a2Classi.list(function (classifications) {\n      options.classifications = classifications.map(function (c) {\n        c.name = c.cname;\n        c.id = c.job_id;\n        delete c.cname;\n        return c;\n      });\n    }.bind(this));\n    a2SoundscapeCompositionService.getClassList({\n      isSystemClass: 1\n    }).then(function (classes) {\n      options.soundscape_composition = classes;\n    }.bind(this));\n  };\n\n  this.computeClassificationResultsOptions = function (classifications) {\n    console.log(\"this.computeClassificationResults = function(classifications){\", classifications);\n    var haveThreshold = classifications && classifications.reduce(function (a, b) {\n      return a || !!b.threshold;\n    }, false);\n    var old_crs = this.options.classification_results;\n    var crs_key = haveThreshold ? 'model_th' : 'model_only';\n    var new_crs = classification_results[crs_key];\n    this.options.classification_results = new_crs;\n\n    if (old_crs != new_crs) {\n      this.params.classification_results = this.params.classification_results.reduce(function (r, cr) {\n        var equiv = cr.equiv && cr.equiv[crs_key];\n\n        if (equiv) {\n          equiv.forEach(function (i) {\n            var new_cr = new_crs[i];\n\n            if (!r.index[new_cr]) {\n              r.index[i] = 1;\n              r.list.push(new_cr);\n            }\n          });\n        }\n\n        return r;\n      }, {\n        list: [],\n        index: {}\n      }).list;\n    }\n  };\n});","angular.module('a2.audiodata.recordings', ['a2.directive.a2-auto-close-on-outside-click', 'a2.service.download-resource', 'a2.audiodata.recordings.data-export-parameters', 'a2.audiodata.recordings.filter-parameters', 'a2.services', 'a2.directives', 'ui.bootstrap', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.recordings', {\n    url: '/recordings',\n    controller: 'RecsCtrl as controller',\n    templateUrl: '/app/audiodata/recordings/recordings.html'\n  });\n}).controller('RecsCtrl', function ($scope, Project, a2Classi, $http, $modal, notify, a2UserPermit, $downloadResource) {\n  $scope.selectedRecId = [];\n  $scope.checkedRec = [];\n\n  this.getSearchParameters = function (output) {\n    var params = angular.merge({}, $scope.params);\n    output = output || ['list'];\n    params.output = output;\n    params.limit = $scope.limitPerPage;\n    params.offset = output.indexOf('list') >= 0 ? ($scope.currentPage - 1) * $scope.limitPerPage : 0;\n    params.sortBy = 'r.site_id DESC, r.datetime DESC';\n\n    if (params.range) {\n      params.range.from = moment(params.range.from).format('YYYY-MM-DD') + 'T00:00:00.000Z';\n      params.range.to = moment(params.range.to).format('YYYY-MM-DD') + 'T23:59:59.999Z';\n    }\n\n    return params;\n  };\n\n  this.searchRecs = function (output) {\n    $scope.loading = true;\n    output = output || ['list'];\n    var params = this.getSearchParameters(output);\n    var expect = output.reduce(function (obj, a) {\n      obj[a] = true;\n      return obj;\n    }, {});\n\n    if (expect.list) {\n      $scope.recs = [];\n    }\n\n    if (expect.count) {\n      $scope.totalRecs = undefined;\n    }\n\n    Project.getRecs(params, function (data) {\n      if (output.length == 1) {\n        data = output.reduce(function (obj, a) {\n          obj[a] = data;\n          return obj;\n        }, {});\n      }\n\n      if (expect.list) {\n        $scope.recs = data.list; // Show selected recordings across pagination\n\n        $scope.recs.forEach(function (rec) {\n          if ($scope.selectedRecId.includes(rec.id)) {\n            rec.checked = true;\n          }\n        });\n        $scope.loading = false;\n      }\n\n      if (expect.count) {\n        $scope.totalRecs = data.count;\n      }\n\n      if (expect.date_range && data.date_range.min_date && data.date_range.max_date) {\n        $scope.minDate = new Date(new Date(data.date_range.min_date.substr(0, 10) + \"T00:00:00.000Z\").getTime() - 24 * 60 * 60 * 1000);\n        $scope.maxDate = new Date(new Date(data.date_range.max_date.substr(0, 10) + \"T23:59:59.999Z\").getTime() + 24 * 60 * 60 * 1000);\n      }\n    });\n  };\n\n  this.sortRecs = function (sortKey, reverse) {\n    $scope.sortKey = sortKey;\n    $scope.reverse = reverse;\n    this.searchRecs();\n  };\n\n  this.applyFilters = function (filters) {\n    $scope.currentPage = 1;\n    $scope.params = filters;\n    this.searchRecs(['count', 'list']);\n  };\n\n  this.reloadList = function () {\n    this.searchRecs(['count', 'list']);\n  };\n\n  this.exportPermit = function () {\n    return a2UserPermit.can('manage project recordings');\n  };\n\n  this.createPlaylist = function () {\n    var listParams = angular.merge({}, $scope.params);\n\n    if (!Object.keys(listParams).length) {\n      notify.log('Filter recordings and create a playlist');\n      return;\n    }\n\n    if ($scope.totalRecs == 0) {\n      notify.error('You can\\'t create playlist with 0 recording');\n      return;\n    }\n\n    if (!a2UserPermit.can('manage playlists')) {\n      notify.error('You do not have permission to create playlists');\n      return;\n    }\n\n    if (listParams.tags && listParams.tags.length) {\n      listParams.tags = listParams.tags.flat();\n    }\n\n    if (listParams.presence && listParams.presence.length) {\n      listParams.presence = listParams.presence[0];\n    }\n\n    if (listParams.range) {\n      listParams.range.from = moment(listParams.range.from).format('YYYY-MM-DD') + 'T00:00:00.000Z';\n      listParams.range.to = moment(listParams.range.to).format('YYYY-MM-DD') + 'T23:59:59.999Z';\n    }\n\n    if ($scope.selectedRecId && $scope.selectedRecId.length) {\n      listParams.recIds = $scope.selectedRecId;\n    }\n\n    var modalInstance = $modal.open({\n      controller: 'SavePlaylistModalInstanceCtrl',\n      templateUrl: '/app/audiodata/create-playlist.html',\n      resolve: {\n        listParams: function () {\n          return listParams;\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function (data) {\n      if (data.message === 'Playlist created') {\n        notify.log(data.message);\n      }\n    });\n  };\n\n  this.isDisableDeleteRecs = function () {\n    return !$scope.checkedRec.length && !$scope.checked;\n  };\n\n  this.deleteRecordings = function () {\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error('You do not have permission to delete recordings');\n      return;\n    }\n\n    const recs = $scope.checkedRec.filter(function (rec) {\n      return !rec.imported;\n    });\n\n    if (!recs || !recs.length) {\n      return notify.log('There are not any recordings to delete');\n    }\n\n    const recCount = recs.reduce(function (_, rec) {\n      _[rec.site] = _[rec.site] + 1 || 1;\n      return _;\n    }, {});\n    const messages = [],\n          list = [];\n    messages.push('Are you sure you want to delete the following?');\n    Object.keys(recCount).forEach(function (site, index) {\n      const s = recCount[site] > 1 ? 's' : '';\n\n      if (index < 3) {\n        list.push(recCount[site] + ' recording' + s + ' from \"' + site + '\"');\n      }\n    });\n\n    if (Object.keys(recCount).length > 3) {\n      var count = 0;\n      Object.keys(recCount).forEach(function (site, index) {\n        if (index >= 3) {\n          count = count + recCount[site];\n        }\n      });\n      const msg = '& ' + count + ' recordings from ' + (Object.keys(recCount).length - 3) + ' other sites';\n      list.push(msg);\n    }\n\n    return $modal.open({\n      templateUrl: '/common/templates/pop-up.html',\n      controller: function () {\n        this.messages = messages;\n        this.list = list;\n        this.note = 'Note: analysis results on these recordings will also be deleted';\n        this.btnOk = \"Delete\";\n        this.btnCancel = \"Cancel\";\n      },\n      controllerAs: 'popup'\n    }).result.then(function () {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/recordings/delete', {\n        recs: recs\n      });\n    }).then(function (response) {\n      if (response.data.error) {\n        return notify.error(response.data.error);\n      }\n\n      this.searchRecs(['count', 'list']);\n      notify.log(response.data.msg);\n    }.bind(this));\n  };\n\n  this.deleteAllRecordings = function () {\n    var filters = $scope.params;\n\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error('You do not have permission to delete recordings');\n      return;\n    }\n\n    if (!$scope.recs.length) {\n      notify.error('Recordings not found');\n      return;\n    }\n\n    return Project.getRecCounts(filters).then(function (recCount) {\n      var messages = [],\n          importedCount = 0,\n          importedSites = [],\n          list = [];\n      messages.push('Are you sure you want to delete the following?');\n      recCount.forEach(function (entry, index) {\n        var s = entry.count > 1 ? 's' : '';\n\n        if (!entry.imported && index < 3) {\n          list.push(entry.count + ' recording' + s + ' from \"' + entry.site + '\"');\n        } else if (entry.imported) {\n          importedCount += entry.count;\n          importedSites.push('\"' + entry.site + '\"');\n        }\n      });\n\n      if (recCount.length > 3) {\n        var count = 0;\n        recCount.forEach(function (entry, index) {\n          if (index >= 3) {\n            count = count + entry.count;\n          }\n        });\n        const msg = '& ' + count + ' recordings from ' + (recCount.length - 3) + ' other sites';\n        list.push(msg);\n      }\n\n      if (importedCount) {\n        messages.push(\"(The filters matched \" + importedCount + \" recordings wich come from \" + importedSites.join(\", \") + \". You cannot delete these from your project, they can only be removed from their original project.)\");\n      }\n\n      return $modal.open({\n        templateUrl: '/common/templates/pop-up.html',\n        controller: function () {\n          this.messages = messages;\n          this.list = list;\n          this.note = 'Note: analysis results on these recordings will also be deleted';\n          this.btnOk = \"Delete\";\n          this.btnCancel = \"Cancel\";\n        },\n        controllerAs: 'popup'\n      }).result;\n    }).then(function () {\n      return $http.post('/legacy-api/project/' + Project.getUrl() + '/recordings/delete-matching', filters).error(function (error) {\n        return notify.error(error);\n      });\n    }).then(function (response) {\n      if (response.data.error) {\n        return notify.error(response.data.error);\n      }\n\n      this.searchRecs(['count', 'list']);\n      notify.log(response.data.msg);\n    }.bind(this));\n  };\n\n  $scope.params = {};\n  $scope.loading = true;\n  $scope.currentPage = 1;\n  $scope.limitPerPage = 10;\n  this.searchRecs(['count', 'date_range', 'list']);\n  $scope.$watch('checked', function () {\n    $scope.combineCheckedRecordings();\n  });\n\n  $scope.combineCheckedRecordings = function () {\n    $scope.recs.forEach(function (rec) {\n      if (rec.checked && !$scope.selectedRecId.includes(rec.id)) {\n        $scope.selectedRecId.push(rec.id);\n        $scope.checkedRec.push(rec);\n      }\n    });\n  };\n\n  $scope.selectRec = function (rec) {\n    if (!rec.checked) {\n      const index = $scope.selectedRecId.findIndex(function (id) {\n        return id === rec.id;\n      });\n      $scope.selectedRecId.splice(index, 1);\n      $scope.checkedRec.splice(index, 1);\n      return;\n    }\n\n    if ($scope.selectedRecId.includes(rec.id)) return;\n    $scope.selectedRecId.push(rec.id);\n    $scope.checkedRec.push(rec);\n  };\n\n  this.setCurrentPage = function (currentPage) {\n    $scope.currentPage = currentPage;\n    this.searchRecs();\n  };\n\n  this.setLimitPerPage = function (limitPerPage) {\n    $scope.limitPerPage = limitPerPage;\n    this.searchRecs();\n  };\n\n  this.exportRecordings = function (listParams) {\n    if (a2UserPermit.isSuper()) {\n      return this.openExportPopup(listParams);\n    }\n\n    if (a2UserPermit.all && !a2UserPermit.all.length || !a2UserPermit.can('export report')) {\n      return notify.error('You do not have permission to export data');\n    }\n\n    this.openExportPopup(listParams);\n  };\n\n  this.openExportPopup = function (listParams) {\n    $scope.params.userEmail = a2UserPermit.getUserEmail() || '';\n    const modalInstance = $modal.open({\n      controller: 'ExportRecordingstModalInstanceCtrl',\n      templateUrl: '/app/audiodata/export-report.html',\n      resolve: {\n        data: function () {\n          return {\n            params: $scope.params,\n            listParams: listParams\n          };\n        }\n      },\n      backdrop: false\n    });\n    modalInstance.result.then(function () {\n      notify.log('Your report export request is processing <br> and will be sent by email.');\n    });\n  };\n}).controller('SavePlaylistModalInstanceCtrl', function ($scope, $modalInstance, a2Playlists, listParams, notify) {\n  var result;\n\n  $scope.savePlaylist = function (name) {\n    $scope.isSavingPlaylist = true;\n    a2Playlists.create({\n      playlist_name: name,\n      params: listParams\n    }, function (data) {\n      $scope.isSavingPlaylist = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        result = data;\n        $modalInstance.close({\n          message: 'Playlist created'\n        });\n      }\n    });\n    var timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      $scope.isSavingPlaylist = false;\n      $modalInstance.close({\n        message: 'Playlist creating'\n      });\n\n      if (!$scope.errMess && !result) {\n        notify.log('Your playlist is being created. <br> Check it in the project playlists');\n      }\n    }, 60000);\n  };\n\n  $scope.changePlaylistName = function () {\n    $scope.errMess = null;\n  };\n}).controller('ExportRecordingstModalInstanceCtrl', function ($scope, $modalInstance, Project, data) {\n  $scope.userEmail = data.params.userEmail;\n\n  $scope.exportRecordings = function (email) {\n    data.params.userEmail = email;\n    $scope.isExportingRecs = true;\n    $scope.errMess = '';\n    Project.getRecordingData(data.params, data.listParams).then(function (data) {\n      $scope.isExportingRecs = false;\n\n      if (data.error) {\n        $scope.errMess = data.error;\n      } else {\n        $modalInstance.close();\n      }\n    });\n  };\n\n  $scope.changeUserEmail = function () {\n    $scope.errMess = null;\n  };\n}).directive(\"customSrc\", function () {\n  return {\n    link: function (scope, element, attrs) {\n      var img, loadImage;\n      img = null;\n\n      loadImage = function () {\n        element[0].src = '';\n        img = new Image();\n        img.src = attrs.customSrc;\n\n        img.onload = function () {\n          element[0].src = attrs.customSrc;\n        };\n\n        img.onerror = function () {\n          element[0].src = 'https://rfcx-web-static.s3.eu-west-1.amazonaws.com/arbimon/unavaliable.png';\n        };\n      };\n\n      scope.$watch(function () {\n        return attrs.customSrc;\n      }, function (newVal, oldVal) {\n        if (oldVal !== newVal) {\n          loadImage();\n        }\n      });\n    }\n  };\n});","angular.module('a2.audiodata.templates', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.templates', 'a2.directive.audio-bar', 'a2.visualizer.audio-player', 'humane']).config(function ($stateProvider) {\n  $stateProvider.state('audiodata.templates', {\n    url: '/templates',\n    controller: 'TemplatesCtrl as controller',\n    templateUrl: '/app/audiodata/templates/templates.html'\n  });\n}).controller('TemplatesCtrl', function ($scope, a2Templates, Project, SpeciesTaxons, $localStorage, a2UserPermit, notify, $modal, $window, a2AudioBarService) {\n  var self = this;\n  Object.assign(this, {\n    initialize: function () {\n      this.loading = false;\n      this.isAdding = false;\n      this.templates = [];\n      this.currentTab = 'projectTemplates';\n      this.pagination = {\n        page: 1,\n        limit: 100,\n        offset: 0,\n        totalItems: 0,\n        totalPages: 0\n      };\n      this.projecturl = Project.getUrl();\n      this.search = {\n        q: '',\n        taxon: ''\n      };\n      this.getTaxons();\n      this.getList();\n      this.timeout;\n      this.taxons = [{\n        id: 0,\n        taxon: 'All taxons'\n      }];\n      this.search.taxon = this.taxons[0];\n    },\n    goToSourceProject: function (projectId) {\n      if (!projectId) return;\n      Project.getProjectById(projectId, function (data) {\n        if (data) {\n          $window.location.pathname = \"/project/\" + data.url + \"/audiodata/templates\";\n        }\n      });\n    },\n    setCurrentPage: function () {\n      self.pagination.offset = self.pagination.page - 1;\n      this.getList();\n    },\n    getTaxons: function () {\n      SpeciesTaxons.getList(function (data) {\n        if (data && data.length) {\n          data.forEach(function (taxon) {\n            self.taxons.push(taxon);\n          });\n        }\n      });\n    },\n    getList: function () {\n      self.loading = true;\n      const opts = {\n        showRecordingUri: true,\n        q: self.search.q,\n        taxon: self.search.taxon && self.search.taxon.id ? self.search.taxon.id : null,\n        limit: self.pagination.limit,\n        offset: self.pagination.offset * self.pagination.limit\n      };\n      opts[self.currentTab] = true;\n      return a2Templates.getList(opts).then(function (data) {\n        self.loading = false;\n        self.templates = data.list;\n        self.pagination.totalItems = data.count;\n        self.pagination.totalPages = Math.ceil(self.pagination.totalItems / self.pagination.limit);\n      }.bind(this)).catch(function (err) {\n        self.loading = false;\n        self.templates = [];\n        notify.serverError(err);\n      }.bind(this));\n    },\n    onSearchChanged: function () {\n      var _this = this;\n\n      self.loading = true;\n      clearTimeout(self.timeout);\n      self.timeout = setTimeout(function () {\n        if (self.search.q.trim().length > 0 && self.search.q.trim().length < 3) return;\n\n        _this.reloadPage();\n      }, 1000);\n    },\n    reloadPage: function () {\n      this.resetPagination();\n      this.getList();\n    },\n    getTemplateVisualizerUrl: function (template) {\n      const box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.project_url + \"/#/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    deleteTemplate: function (templateId) {\n      if (!a2UserPermit.can('manage templates')) {\n        notify.error('You do not have permission to delete templates');\n        return;\n      }\n\n      $scope.popup = {\n        title: 'Delete template',\n        messages: ['Are you sure you want to delete this template?'],\n        btnOk: 'Yes',\n        btnCancel: 'No'\n      };\n      var modalInstance = $modal.open({\n        templateUrl: '/common/templates/pop-up.html',\n        scope: $scope\n      });\n      modalInstance.result.then(function (confirmed) {\n        if (confirmed) {\n          return a2Templates.delete(templateId).then(function () {\n            self.getList();\n          });\n        }\n      });\n    },\n    toggleTab: function (access) {\n      self.currentTab = access;\n      this.reloadPage();\n    },\n    resetPagination: function () {\n      self.pagination = {\n        page: 1,\n        limit: 100,\n        offset: 0,\n        totalItems: 0,\n        totalPages: 0\n      };\n    },\n    addTemplate: function (template) {\n      self.isAdding = true;\n      a2Templates.add({\n        name: template.name,\n        recording: template.recording,\n        species: template.species,\n        songtype: template.songtype,\n        roi: {\n          x1: template.x1,\n          y1: template.y1,\n          x2: template.x2,\n          y2: template.y2\n        },\n        source_project_id: template.project\n      }).then(function (template) {\n        console.log('new template', template);\n        self.isAdding = false;\n        if (template.id === 0) notify.error('The template already exists in the project templates.');else if (template.error) notify.error('You do not have permission to manage templates');else notify.log('The template is added to the project.');\n      }).catch(function (err) {\n        console.log('err', err);\n        self.isAdding = false;\n        notify.error(err);\n      });\n    },\n    playTemplateAudio: function (template, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      ;\n      $localStorage.setItem('a2-audio-param-gain', JSON.stringify(2));\n      console.info('play');\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(template), true);\n    }\n  });\n  this.initialize();\n});","angular.module('a2.audiodata.uploads', ['ui.router', 'a2.audiodata.uploads.upload', 'a2.audiodata.uploads.processing']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads', {\n    url: '/uploads',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.audiodata.uploads.processing', ['a2.services', 'a2.srv.uploads', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads.processing', {\n    url: '/processing',\n    controller: 'A2AudioDataUploadsProcessingCtrl as controller',\n    templateUrl: '/app/audiodata/uploads/processing.html'\n  });\n}).controller('A2AudioDataUploadsProcessingCtrl', function ($scope, a2UploadsService) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2UploadsService.getProcessingList().then(function (data) {\n      this.loading = false;\n      this.list = data.list;\n      this.count = data.count;\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.audiodata.uploads.upload', ['a2.services', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'a2.srv.app-listings', 'a2.filter.caps', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('audiodata.uploads.upload', {\n    url: '/',\n    controller: 'A2AudioDataUploadsUploadCtrl as controller',\n    templateUrl: '/app/audiodata/uploads/upload.html'\n  });\n}).filter('prettyBytes', function () {\n  return function (bytes) {\n    var labels = ['B', 'kB', 'MB', 'GB'];\n    var newBytes;\n    var p;\n\n    for (p = 1; bytes / Math.pow(1024, p) > 1; p++) {\n      newBytes = bytes / Math.pow(1024, p);\n    }\n\n    newBytes = Math.round(newBytes * 100) / 100;\n    return String(newBytes) + ' ' + labels[p - 1];\n  };\n}).controller('A2AudioDataUploadsUploadCtrl', function ($scope, uploads, Project, AppListingsService, a2UserPermit, notify, $interval, a2UploadsService) {\n  $scope.verifyAndUpload = function () {\n    if (!a2UserPermit.can('manage project recordings')) {\n      notify.error(\"You do not have permission to upload recordings\");\n      return;\n    }\n\n    var index = 0;\n    $scope.uploading = true;\n\n    var _verifyAndUpload = function () {\n      var item = $scope.uploader.queue[index];\n\n      if (item && item.file && !item.file.size) {\n        item.isError = true;\n        item.errorMsg = \"Error of the file size\";\n        return;\n      }\n\n      var next = function () {\n        index++;\n\n        _verifyAndUpload();\n      };\n\n      if (!item || !$scope.uploading) {\n        $scope.uploading = false;\n        return;\n      }\n\n      if (item.isSuccess) // file uploaded on current batch\n        return next();\n      Project.recExists($scope.info.site.id, item.file.name, function (exists) {\n        if (exists) {\n          console.log('duplicated');\n          item.isDuplicate = true;\n          return next();\n        }\n\n        item.url = '/uploads/audio?project=' + $scope.project.project_id + '&site=' + $scope.info.site.id + '&nameformat=' + $scope.info.format.name + '&timezone=' + $scope.info.timezone.format;\n        item.upload();\n        item.onSuccess = next;\n        item.onError = next;\n      });\n    };\n\n    _verifyAndUpload();\n  };\n\n  $scope.isCheckingStatus = false;\n\n  $scope.queueJobToCheckStatus = function () {\n    if ($scope.isCheckingStatus) return;\n    $scope.isCheckingStatus = true;\n    a2UploadsService.getProcessingList({\n      site: $scope.info.site.id\n    }).then(function (files) {\n      const uploadingFiles = $scope.getUploadingFiles();\n\n      if (!uploadingFiles.length) {\n        $scope.cancelTimer();\n        $scope.isCheckingStatus = false;\n        return;\n      }\n\n      const userFiles = uploadingFiles.map(function (fileObj) {\n        return fileObj.file.name;\n      });\n\n      if (files && files.length) {\n        const filesToCheck = files.filter(function (file) {\n          return userFiles.includes(file.name);\n        });\n        const items = filesToCheck.slice(0, 5).map(function (item) {\n          return {\n            uploadUrl: item.uploadUrl,\n            uploadId: item.id,\n            filename: item.name\n          };\n        });\n        a2UploadsService.checkStatus({\n          items: items\n        }).then(function (data) {\n          if (data) {\n            data.forEach(function (item) {\n              const userFile = uploadingFiles.find(function (fileObj) {\n                return fileObj.file.name === item.filename;\n              });\n\n              if (userFile && item.status === 'uploaded') {\n                $scope.makeSuccessItem(userFile);\n              }\n            });\n            $scope.isCheckingStatus = false;\n          }\n        });\n      }\n    });\n  };\n\n  $scope.getUploadingFiles = function () {\n    const uploadingFiles = $scope.uploader.queue.filter(function (file) {\n      return file.isSuccess === true && file.isUploaded === false;\n    });\n    return uploadingFiles && uploadingFiles.length ? uploadingFiles : [];\n  };\n\n  $scope.checkUploadingFiles = function () {\n    if ($scope.getUploadingFiles().length) {\n      $scope.startTimer();\n    }\n  };\n\n  $scope.startTimer = function () {\n    $scope.cancelTimer();\n    $scope.checkStatusInterval = $interval(function () {\n      $scope.queueJobToCheckStatus();\n    }, 10000);\n  };\n\n  $scope.cancelTimer = function () {\n    if ($scope.checkStatusInterval) {\n      $interval.cancel($scope.checkStatusInterval);\n    }\n  };\n\n  $scope.$on('$destroy', function () {\n    $scope.cancelTimer();\n  });\n  AppListingsService.getFor('arbimon2-desktop-uploader').then(function (uploaderAppListing) {\n    this.uploaderAppListing = uploaderAppListing;\n  }.bind(this));\n\n  $scope.stopQueue = function () {\n    $scope.uploading = false;\n    angular.forEach($scope.uploader.queue, function (item) {\n      item.cancel();\n    });\n  };\n\n  $scope.uploader = uploads.getUploader();\n  $scope.info = {};\n  $scope.formats = [{\n    name: \"Arbimon\",\n    format: \"(*-YYYY-MM-DD_HH-MM)\"\n  }, {\n    name: \"AudioMoth\",\n    format: \"(*YYYYMMDD_HHMMSS)\"\n  }, {\n    name: \"AudioMoth legacy\",\n    format: \"(Unix Time code in Hex)\"\n  }, {\n    name: \"Cornell\",\n    format: \"(*_YYYYMMDD_HHMMSSZ)\"\n  }, {\n    name: \"Song Meter\",\n    format: \"(*_YYYYMMDD_HHMMSS)\"\n  }, {\n    name: \"Wildlife\",\n    format: \"(YYYYMMDD_HHMMSS)\"\n  }];\n  $scope.fileTimezone = [{\n    name: \"UTC\",\n    format: \"utc\"\n  }, {\n    name: \"Site timezone\",\n    format: \"local\"\n  }];\n  Project.getSites({\n    utcDiff: true\n  }, function (sites) {\n    $scope.sites = sites.sort(function (a, b) {\n      return new Date(b.updated_at) - new Date(a.updated_at);\n    });\n  });\n\n  $scope.selectSite = function () {\n    const local = $scope.info && $scope.info.site && $scope.info.site.utcOffset ? $scope.info.site.utcOffset + ' (local)' : 'Site timezone';\n    $scope.fileTimezone[1].name = local;\n    $scope.info.timezone = $scope.fileTimezone[1];\n  };\n\n  $scope.isStartUploadDisabled = function () {\n    return !$scope.uploader.queue.length || $scope.isLimitExceeded() || !$scope.info.site || !$scope.info.format || $scope.uploading;\n  };\n\n  $scope.isLimitExceeded = function () {\n    return $scope.uploader.queue.length > 1000;\n  };\n\n  const randomString = Math.round(Math.random() * 100000000);\n  this.uploaderApps = {\n    mac: 'https://rf.cx/ingest-app-latest-mac?r=' + randomString,\n    windows: 'https://rf.cx/ingest-app-latest-win?r=' + randomString\n  };\n  Project.getInfo(function (info) {\n    $scope.project = info;\n  });\n  $scope.uploader.filters.push({\n    name: 'supportedFormats',\n    fn: function (item) {\n      var name = item.name.split('.');\n      var extension = name[name.length - 1].toLowerCase();\n      var validFormats = /mp3|flac|wav|opus/i;\n      if (!validFormats.exec(extension)) return false;\n      return true;\n    }\n  });\n  $scope.uploader.filters.push({\n    name: 'notDuplicate',\n    fn: function (item) {\n      var duplicate = $scope.uploader.queue.filter(function (qItem) {\n        return qItem.file.name === item.name;\n      });\n      return !duplicate.length;\n    }\n  });\n\n  $scope.uploader.onErrorItem = function (item, response, status, headers) {\n    if (response.error) {\n      item.errorMsg = response.error;\n    } else if (status >= 500) {\n      item.errorMsg = \"Server error\";\n      return;\n    } else {\n      item.errorMsg = \"An error ocurred\";\n    }\n  };\n\n  $scope.uploader.onSuccessItem = function (item, response, status, headers) {\n    item.isUploaded = false;\n    console.info('count of uploading files', $scope.getUploadingFiles().length);\n    $scope.checkUploadingFiles();\n  };\n\n  $scope.makeSuccessItem = function (item) {\n    item.status = 'uploaded';\n    item.isUploading = false;\n    item.isSuccess = false;\n    item.isUploaded = true;\n    item.progress = 100;\n  };\n\n  $scope.getProgress = function (item) {\n    if (item.isUploading && item.progress === 100) return 90;else if (item.isSuccess && !item.isUploaded) return 90;else return item.progress;\n  };\n\n  $scope.removeCompleted = function () {\n    if (!$scope.uploader.queue.length) return;\n    $scope.uploader.queue = $scope.uploader.queue.filter(function (file) {\n      return !file.isSuccess;\n    });\n  };\n\n  $scope.getCountOfUploaded = function () {\n    if (!$scope.uploader || !$scope.uploader.queue || !$scope.uploader.queue.length) return 0;\n    $scope.uploaded = $scope.uploader.queue.filter(function (file) {\n      return !!file.isUploaded && !file.isError;\n    }).length;\n    return $scope.uploaded;\n  };\n\n  $scope.clearQueue = function () {\n    $scope.uploader.progress = 0;\n    $scope.uploaded = 0;\n  };\n\n  $scope.uploaded = 0;\n\n  $scope.uploader.onProgressAll = function () {};\n}).factory('uploads', function (FileUploader) {\n  var u = new FileUploader();\n  window.addEventListener(\"beforeunload\", function (e) {\n    if (u.isUploading) {\n      var confirmationMessage = \"Upload is in progress, Are you sure to exit?\";\n      (e || window.event).returnValue = confirmationMessage; //Gecko + IE\n\n      return confirmationMessage; //Webkit, Safari, Chrome etc.\n    }\n  });\n  return {\n    getUploader: function () {\n      return u;\n    }\n  };\n});","angular.module('a2.citizen-scientist.admin', ['ui.router', 'a2.citizen-scientist.admin.classification-stats', 'a2.citizen-scientist.admin.user-stats', 'a2.citizen-scientist.admin.settings']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin', {\n    url: '/admin',\n    template: '<ui-view />',\n    abstract: true\n  });\n});","angular.module('a2.citizen-scientist.expert', ['ui.bootstrap', 'a2.srv.patternmatching', 'a2.srv.citizen-scientist', 'a2.srv.citizen-scientist-expert', 'a2.visualizer.audio-player', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.expert', {\n    url: '/expert/:patternMatchingId?',\n    controller: 'CitizenScientistExpertCtrl',\n    templateUrl: '/app/citizen-scientist/expert/list.html'\n  });\n}).controller('CitizenScientistExpertCtrl', function ($scope, $filter, Project, ngTableParams, a2Playlists, notify, $q, a2CitizenScientistService, a2CitizenScientistExpertService, a2PatternMatching, a2UserPermit, $state, $stateParams) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.patternmatchingsOriginal, params.filter()) : $scope.patternmatchingsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.patternmatchingsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No Pattern matchings searches found.\";\n        }\n\n        $scope.patternmatchingsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $state.go('citizen-scientist.expert', {\n      patternMatchingId: patternmatchingId ? patternmatchingId : undefined\n    });\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CitizenScientistExpertService.getPatternMatchings().then(function (data) {\n      $scope.patternmatchingsOriginal = data;\n      $scope.patternmatchingsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No pattern matchings found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2CitizenScientistExpertDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'CitizenScientistExpertDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/citizen-scientist/expert/details.html'\n  };\n}).filter('pmValidation', function () {\n  return function (validation, cp, cnp) {\n    if (validation == 1) {\n      return 'present';\n    } else if (validation == 0) {\n      return 'not present';\n    } else if (validation === null || validation === undefined) {\n      if (cp > 0 && cnp > 0) {\n        return 'conflicted';\n      } else {\n        return '---';\n      }\n    }\n  };\n}).controller('CitizenScientistExpertDetailsCtrl', function ($scope, a2PatternMatching, a2Templates, a2CitizenScientistExpertService, a2UserPermit, Project, a2AudioBarService, notify) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 0\n      };\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.loading = {\n        details: false,\n        rois: false\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.expertSearch = this.lists.search[0];\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    compositeValidation: function (roi) {\n      var expert_val = roi.expert_validated;\n      var consensus_val = roi.consensus_validated;\n      var cp = roi.cs_val_present;\n      var cnp = roi.cs_val_not_present;\n      return [expert_val, consensus_val, cp > 0 && cnp > 0 ? -1 : null].reduce(function (_, arg) {\n        return _ === null ? arg : _;\n      }, null);\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      search: [{\n        value: 'all',\n        text: 'All',\n        description: 'Show all matched rois.'\n      }, {\n        value: 'consensus',\n        text: 'Consensus',\n        description: 'Show only rois where there is a consensus.'\n      }, {\n        value: 'pending',\n        text: 'Pending',\n        description: 'Show only rois that have not reached a consensus yet.'\n      }, {\n        value: 'conflicted',\n        text: 'Conflicted',\n        description: 'Show only rois where there is a conflict.'\n      }, {\n        value: 'expert',\n        text: 'Expert',\n        description: 'Show only rois that have been decided by an expert.'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      }, {\n        value: 'not-validated',\n        text: 'Not Validated'\n      }],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2CitizenScientistExpertService.getPatternMatchingDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.setupExportUrl();\n        this.total = {\n          rois: patternMatching.matches,\n          pages: Math.ceil(patternMatching.matches / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    onExpertSearchChanged: function () {\n      this.selected.page = 0;\n      this.loadPage(0);\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2CitizenScientistExpertService.getCSExportUrl({\n        patternMatching: this.patternMatching.id\n      });\n    },\n    onScroll: function ($event, $controller) {\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadPage: function (pageNumber) {\n      this.loading.rois = true;\n      return a2CitizenScientistExpertService.getPatternMatchingRoisFor(this.id, this.limit, pageNumber * this.limit, {\n        search: this.expertSearch && this.expertSearch.value\n      }).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = rois.reduce(function (_, roi) {\n          var sitename = roi.site;\n          var recname = roi.recording;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n        this.selected.roi = Math.min();\n\n        if (this.scrollElement) {\n          this.scrollElement.scrollTo(0, 0);\n        }\n\n        return rois;\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 0;\n        this.rois = [];\n        return this.rois;\n      } else {\n        page = Math.max(0, Math.min(page, this.total.rois / this.limit | 0));\n\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadPage(page);\n        }\n      }\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.cs_validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('validate pattern matchings')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        conflict_unresolved: 0,\n        conflict_resolved: 0,\n        null: 0,\n        0: 0,\n        1: 0\n      };\n      return a2CitizenScientistExpertService.validatePatternMatchingRois(this.id, roiIds, validation).then(function () {\n        rois.forEach(function (roi) {\n          var oldtag, newtag;\n\n          if (roi.cs_val_present > 0 && roi.cs_val_not_present > 0) {\n            oldtag = roi.expert_validated !== null ? 'conflict_resolved' : 'conflict_unresolved';\n            newtag = validation !== null ? 'conflict_resolved' : 'conflict_unresolved';\n          }\n\n          val_delta[oldtag] -= 1;\n          val_delta[newtag] += 1;\n          val_delta[roi.expert_validated] -= 1;\n          val_delta[validation] += 1;\n          roi.expert_validated = validation;\n          roi.selected = false;\n        });\n        this.patternMatching.cs_conflict_resolved += val_delta.conflict_resolved;\n        this.patternMatching.cs_conflict_unresolved += val_delta.conflict_unresolved;\n        this.patternMatching.expert_consensus_absent += val_delta[0];\n        this.patternMatching.expert_consensus_present += val_delta[1];\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    nextMatch: function (step) {\n      return this.setRoi(this.selected.roi_index + (step || 1));\n    },\n    prevMatch: function (step) {\n      return this.setRoi(this.selected.roi_index - (step || 1));\n    },\n    nextPage: function (step) {\n      return this.setPage(this.selected.page + (step || 1));\n    },\n    prevPage: function (step) {\n      return this.setPage(this.selected.page - (step || 1));\n    },\n    next: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      this.nextPage(step);\n    },\n    prev: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      return this.next(-step);\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n});","angular.module('a2.citizen-scientist.my-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.my-stats', {\n    url: '/my-stats',\n    controller: 'A2CitizenScientistMyStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/my-stats/index.html'\n  });\n}).controller('A2CitizenScientistMyStatsCtrl', function ($scope, a2CitizenScientistService, $stateParams, $state, Users) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistService.getMyStats().then(function (data) {\n      this.loading = false;\n      var vars = ['validated', 'consensus', 'non_consensus', 'pending', 'reached_th'];\n      this.stats = data.stats.map(function (item, index) {\n        vars.forEach(function (_var) {\n          item['group_' + _var] = data.groupStats[index][_var];\n        });\n        return item;\n      });\n      this.overall = data.stats.reduce(function (_, item) {\n        vars.forEach(function (_var) {\n          _[_var] += item[_var];\n          _['group_' + _var] += item['group_' + _var];\n        });\n        return _;\n      }, vars.reduce(function (__, _var) {\n        __[_var] = 0;\n        __['group_' + _var] = 0;\n        return __;\n      }, {})); // compute overalls\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.citizen-scientist.patternmatching', ['ui.bootstrap', 'a2.srv.patternmatching', 'a2.srv.citizen-scientist', 'a2.visualizer.audio-player', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.patternmatching', {\n    url: '/patternmatching',\n    controller: 'CitizenScientistPatternMatchingCtrl',\n    templateUrl: '/app/citizen-scientist/patternmatching/list.html'\n  });\n  $stateProvider.state('citizen-scientist.patternmatching-details', {\n    url: '/patternmatching/:patternMatchingId?',\n    controller: 'CitizenScientistPatternMatchingCtrl',\n    templateUrl: '/app/citizen-scientist/patternmatching/list.html'\n  });\n}).controller('CitizenScientistPatternMatchingCtrl', function ($scope, $filter, Project, ngTableParams, a2Playlists, notify, $q, a2CitizenScientistService, a2PatternMatching, a2UserPermit, $state, $stateParams) {\n  $scope.selectedPatternMatchingId = $stateParams.patternMatchingId;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.patternmatchingsOriginal, params.filter()) : $scope.patternmatchingsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.patternmatchingsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No Pattern matchings searches found.\";\n        }\n\n        $scope.patternmatchingsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n      }\n    });\n  };\n\n  $scope.getTemplateVisualizerUrl = function (template) {\n    var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n    return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n  }, $scope.selectItem = function (patternmatchingId) {\n    $scope.selectedPatternMatchingId = patternmatchingId;\n\n    if (!patternmatchingId) {\n      $state.go('citizen-scientist.patternmatching', {});\n    } else {\n      $state.go('citizen-scientist.patternmatching-details', {\n        patternMatchingId: patternmatchingId\n      });\n    }\n  };\n\n  $scope.loadPatternMatchings = function () {\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    return a2CitizenScientistService.getPatternMatchings().then(function (data) {\n      $scope.patternmatchingsOriginal = data;\n      $scope.patternmatchingsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No pattern matchings found.\";\n      }\n    });\n  };\n\n  if (!$scope.selectedPatternMatchingId) {\n    $scope.loadPatternMatchings();\n  }\n}).directive('a2CitizenScientistPatternMatchingDetails', function () {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      patternMatchingId: '=',\n      onGoBack: '&'\n    },\n    controller: 'CitizenScientistPatternMatchingDetailsCtrl',\n    controllerAs: 'controller',\n    templateUrl: '/app/citizen-scientist/patternmatching/details.html'\n  };\n}).controller('CitizenScientistPatternMatchingDetailsCtrl', function ($scope, a2PatternMatching, a2Templates, a2CitizenScientistService, a2UserPermit, Project, a2AudioBarService, notify) {\n  Object.assign(this, {\n    id: null,\n    initialize: function (patternMatchingId) {\n      this.id = patternMatchingId;\n      this.offset = 0;\n      this.limit = 100;\n      this.selected = {\n        roi_index: 0,\n        roi: null,\n        page: 0\n      };\n      this.total = {\n        rois: 0,\n        pages: 0\n      };\n      this.loading = {\n        details: false,\n        rois: false\n      };\n      this.validation = this.lists.validation[2];\n      this.thumbnailClass = this.lists.thumbnails[0].value;\n      this.projecturl = Project.getUrl();\n      this.fetchDetails().then(function () {\n        this.loadPage(this.selected.page);\n      }.bind(this));\n    },\n    lists: {\n      thumbnails: [{\n        class: 'fa fa-th-large',\n        value: ''\n      }, {\n        class: 'fa fa-th',\n        value: 'is-small'\n      }],\n      selection: [{\n        value: 'all',\n        text: 'All'\n      }, {\n        value: 'none',\n        text: 'None'\n      } // {value:'not-validated', text:'Not Validated'},\n      ],\n      validation: [{\n        class: \"fa val-1\",\n        text: \"Present\",\n        value: 1\n      }, {\n        class: \"fa val-0\",\n        text: \"Not Present\",\n        value: 0\n      }, {\n        class: \"fa val-null\",\n        text: \"Clear\",\n        value: null\n      }]\n    },\n    fetchDetails: function () {\n      this.loading.details = true;\n      return a2CitizenScientistService.getPatternMatchingDetailsFor(this.id).then(function (patternMatching) {\n        this.loading.details = false;\n        this.patternMatching = patternMatching;\n        this.setupExportUrl();\n        this.total = {\n          rois: patternMatching.cs_total,\n          pages: Math.ceil(patternMatching.cs_total / this.limit)\n        };\n      }.bind(this)).catch(function (err) {\n        this.loading.details = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    setupExportUrl: function () {\n      this.patternMatchingExportUrl = a2PatternMatching.getExportUrl({\n        patternMatching: this.patternMatching.id\n      });\n    },\n    onScroll: function ($event, $controller) {\n      this.scrollElement = $controller.scrollElement;\n      var scrollPos = $controller.scrollElement.scrollY;\n      var headerTop = $controller.anchors.header.offset().top;\n      this.headerTop = headerTop | 0;\n      this.scrolledPastHeader = scrollPos >= headerTop;\n    },\n    onSelect: function ($item) {\n      this.select($item.value);\n    },\n    loadPage: function (pageNumber) {\n      this.loading.rois = true;\n      return a2CitizenScientistService.getPatternMatchingRoisFor(this.id, this.limit, pageNumber * this.limit).then(function (rois) {\n        this.loading.rois = false;\n        this.rois = rois.reduce(function (_, roi) {\n          var sitename = roi.site;\n          var recname = roi.recording;\n\n          if (!_.idx[sitename]) {\n            _.idx[sitename] = {\n              list: [],\n              idx: {},\n              name: sitename\n            };\n\n            _.list.push(_.idx[sitename]);\n          }\n\n          var site = _.idx[sitename];\n          site.list.push(roi);\n          return _;\n        }, {\n          list: [],\n          idx: {}\n        }).list;\n        this.selected.roi = Math.min();\n\n        if (this.scrollElement) {\n          this.scrollElement.scrollTo(0, 0);\n        }\n\n        return rois;\n      }.bind(this)).catch(function (err) {\n        this.loading.rois = false;\n        return notify.serverError(err);\n      }.bind(this));\n    },\n    playRoiAudio: function (roi, $event) {\n      if ($event) {\n        $event.preventDefault();\n        $event.stopPropagation();\n      }\n\n      a2AudioBarService.loadUrl(a2PatternMatching.getAudioUrlFor(roi), true);\n    },\n    playTemplateAudio: function () {\n      a2AudioBarService.loadUrl(a2Templates.getAudioUrlFor(this.patternMatching.template), true);\n    },\n    getRoiVisualizerUrl: function (roi) {\n      var box = ['box', roi.x1, roi.y1, roi.x2, roi.y2].join(',');\n      return roi ? \"/project/\" + this.projecturl + \"/visualizer/rec/\" + roi.recording_id + \"?a=\" + box : '';\n    },\n    getTemplateVisualizerUrl: function (template) {\n      var box = ['box', template.x1, template.y1, template.x2, template.y2].join(',');\n      return template ? \"/project/\" + template.source_project_uri + \"/visualizer/rec/\" + template.recording + \"?a=\" + box : '';\n    },\n    setRoi: function (roi_index) {\n      if (this.total.rois <= 0) {\n        this.selected.roi_index = 0;\n        this.selected.roi = null;\n      } else {\n        this.selected.roi_index = Math.max(0, Math.min(roi_index | 0, this.total.rois - 1));\n        this.selected.roi = this.rois[this.selected.roi_index];\n      }\n\n      return this.selected.roi;\n    },\n    setPage: function (page, force) {\n      if (this.total.rois <= 0) {\n        this.selected.page = 0;\n        this.rois = [];\n        return this.rois;\n      } else {\n        page = Math.max(0, Math.min(page, this.total.rois / this.limit | 0));\n\n        if (page != this.selected.page || force) {\n          this.selected.page = page;\n          return this.loadPage(page);\n        }\n      }\n    },\n    select: function (option) {\n      var selectFn = null;\n\n      if (option === \"all\") {\n        selectFn = function (roi) {\n          roi.selected = true;\n        };\n      } else if (option === \"none\") {\n        selectFn = function (roi) {\n          roi.selected = false;\n        };\n      } else if (option === \"not-validated\") {\n        selectFn = function (roi) {\n          roi.selected = roi.cs_validated === null;\n        };\n      } else {\n        selectFn = function (roi) {\n          roi.selected = roi.id === option;\n        };\n      }\n\n      this.forEachRoi(selectFn);\n    },\n    forEachRoi: function (fn) {\n      (this.rois || []).forEach(function (site) {\n        site.list.forEach(fn);\n      });\n    },\n    validate: function (validation, rois) {\n      if (!a2UserPermit.can('use citizen scientist interface')) {\n        notify.error('You do not have permission to validate the matched rois.');\n        return;\n      }\n\n      if (validation === undefined) {\n        validation = (this.validation || {\n          value: null\n        }).value;\n      }\n\n      if (rois === undefined) {\n        rois = [];\n        this.forEachRoi(function (roi) {\n          if (roi.selected) {\n            rois.push(roi);\n          }\n        });\n      }\n\n      var roiIds = rois.map(function (roi) {\n        return roi.id;\n      });\n      var val_delta = {\n        0: 0,\n        1: 0,\n        null: 0\n      };\n      rois.forEach(function (roi) {\n        val_delta[roi.cs_validated] -= 1;\n        val_delta[validation] += 1;\n        roi.cs_validated = validation;\n        roi.selected = false;\n      });\n      this.patternMatching.cs_absent += val_delta[0];\n      this.patternMatching.cs_present += val_delta[1];\n      return a2CitizenScientistService.validatePatternMatchingRois(this.id, roiIds, validation);\n    },\n    nextMatch: function (step) {\n      return this.setRoi(this.selected.roi_index + (step || 1));\n    },\n    prevMatch: function (step) {\n      return this.setRoi(this.selected.roi_index - (step || 1));\n    },\n    nextPage: function (step) {\n      return this.setPage(this.selected.page + (step || 1));\n    },\n    prevPage: function (step) {\n      return this.setPage(this.selected.page - (step || 1));\n    },\n    next: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      this.nextPage(step);\n    },\n    prev: function (step) {\n      if (!step) {\n        step = 1;\n      }\n\n      return this.next(-step);\n    }\n  });\n  this.initialize($scope.patternMatchingId);\n});","angular.module('a2.visobjectsbrowser', ['a2.utils', 'a2.browser_common', 'a2.browser_recordings', 'a2.browser_soundscapes', 'a2.service.serialize-promised-fn'])\n/**\n * @ngdoc directive\n * @name a2visobjectsbrowser.directive:a2VisObjectBrowser\n * @description\n * vis object browser component.\n *\n * @event browser-available Emmited when the browser controller gets initialized\n * @event browser-vobject-type Emmited when the selected visualizer object type changes\n *\n */\n.directive('a2VisObjectBrowser', function ($window, $timeout) {\n  return {\n    restrict: 'E',\n    scope: {\n      location: '=?',\n      onVisObject: '&'\n    },\n    templateUrl: '/app/visualizer/browser/main.html',\n    // require: 'ngModel',\n    controller: 'a2VisObjectBrowserController as browser',\n    link: function (scope, element, attrs, browser) {\n      browser.waitForInitialized.then(function () {\n        scope.$emit('browser-available');\n      });\n      browser.events.on('location-changed', function () {\n        scope.location = this.location;\n      });\n      browser.events.on('browser-vobject-type', function (vobject_type) {\n        scope.$emit('browser-vobject-type', vobject_type);\n      });\n      browser.events.on('on-vis-object', function (location, visobject, type) {\n        scope.onVisObject({\n          location: location,\n          visobject: visobject,\n          type: type\n        });\n        $timeout(function () {\n          var $e = element.find('.visobj-list-item.active');\n\n          if ($e.length) {\n            var $p = $e.parent();\n            var $eo = $e.offset(),\n                $po = $p.offset(),\n                $dt = $eo.top - $po.top;\n            $p.animate({\n              scrollTop: $p.scrollTop() + $dt\n            });\n          }\n        });\n      });\n      scope.selectVisObject = browser.selectVisObject.bind(browser); // scope.$on('a2-persisted', browser.activate.bind(browser));\n\n      scope.$on('prev-visobject', browser.selectPreviousVisObject.bind(browser));\n      scope.$on('next-visobject', browser.selectNextVisObject.bind(browser));\n      scope.$on('set-browser-location', browser.setBrowserLocation.bind(browser)); // Catch the navigation URL query from visualizer view\n\n      scope.$on('set-browser-annotations', browser.setBrowserAnnotations.bind(browser));\n      scope.$on('clear-recording-data', browser.clearRecordingData.bind(browser));\n      scope.$on('visobj-updated', browser.notifyVisobjUpdated.bind(browser));\n      browser.activate(scope.location).catch(console.error.bind(console));\n    }\n  };\n})\n/**\n * @ngdoc controller\n * @name a2visobjectsbrowser.controller:a2VisObjectBrowserController\n * @description\n * Controller for vis object browser.\n *\n * @event browser-available Emmited when the browser controller gets initialized\n * @event browser-vobject-type Emmited when the selected visualizer object type changes\n *\n */\n.controller('a2VisObjectBrowserController', function ($scope, $state, $controller, $q, serializePromisedFn, BrowserLOVOs, BrowserVisObjects, itemSelection, Project, EventlistManager) {\n  var self = this;\n  var project = Project; // Set of available lovo types\n\n  this.types = BrowserLOVOs.$grouping;\n  this.visobjectTypes = BrowserVisObjects; // currently selected lovo type\n  // container for loading flags\n\n  this.loading = {\n    sites: false,\n    dates: false,\n    times: false\n  }; // container for auto-selecting values from the browser controllers\n\n  this.auto = {}; // currently selected visualizer object\n\n  this.visobj = null; // currently selected lovo\n\n  this.lovo = null; // associated EventlistManager\n\n  this.events = new EventlistManager(); // initialized flag\n\n  var initialized = false;\n  var waitForInitializedDefer = $q.defer();\n  this.waitForInitialized = waitForInitializedDefer.promise;\n  this.waitForInitialized.then(function () {\n    if (!this.type) {\n      this.setBrowserType(BrowserLOVOs.$list.filter(function (lovo) {\n        return lovo.default;\n      }).shift());\n    }\n  }.bind(this));\n  /** (Re)-Activates the browser controller.\n   * Sets the browser controller into an active state. On the first time,\n   * the browse gets initialized and sends a 'browser-available' event\n   * asynchronously. This activation cascades into the currently selected\n   * type.\n   *\n   * @event browser-available Emmited when the browser controller gets initialized\n   *\n   */\n\n  this.activate = function (location) {\n    var $type = this.$type;\n    return ($type && $type.activate ? $type.activate().then(function () {\n      if ($scope.browser.currentRecording && $scope.browser.annotations) {\n        return this.setLOVO();\n      }\n\n      if ($type.lovo) return this.setLOVO($type.lovo);\n    }.bind(this)) : $q.resolve()).then(function () {\n      if (!initialized) {\n        initialized = true;\n        waitForInitializedDefer.resolve();\n      }\n    }.bind(this));\n  };\n\n  this.setLOVO = function (lovo, location) {\n    var defer = $q.defer();\n    var old_lovo = self.lovo;\n    self.lovo = lovo;\n    if (self.lovo) self.lovo.loading = true;\n    return $q.resolve().then(function () {\n      if (lovo) {\n        self.lovo.loading = false;\n\n        if (lovo.recordingsBySite) {\n          lovo.updateRecording($scope.browser.currentRecording ? $scope.browser.currentRecording : undefined);\n        }\n\n        lovo.initialize().then(function () {\n          if (location) {\n            self.set_location(location);\n          }\n        }).then(function () {\n          // to set selected recording from the list of recordings\n          if (lovo.recordingsBySite && lovo.list && lovo.recording_id) {\n            self.auto.visobject = lovo.list.find(function (item) {\n              return item.id === self.auto.visobject.id;\n            });\n          }\n\n          if (self.auto.visobject) {\n            return lovo.find(self.auto.visobject).then(function (visobject) {\n              return self.setVisObj(visobject);\n            });\n          }\n        }).then(function () {\n          return $q.resolve(lovo);\n        });\n      }\n    });\n  };\n\n  this.set_location = function (location) {\n    this.location = location;\n    this.events.send({\n      event: 'location-changed',\n      context: this\n    }, location);\n  };\n\n  this.setBrowserType = serializePromisedFn(function (type) {\n    var new_$type,\n        old_$type = self.$type;\n\n    if (type && type.controller) {\n      if (!type.$controller) {\n        type.$controller = $controller(type.controller, {\n          $scope: $scope,\n          a2Browser: self\n        });\n      }\n\n      new_$type = type.$controller;\n    }\n\n    var differ = new_$type !== old_$type;\n    return (differ ? $q.resolve().then(function () {\n      if (differ && old_$type && old_$type.deactivate) {\n        return old_$type.deactivate();\n      }\n    }).then(function () {\n      if (differ && new_$type && new_$type.activate) {\n        self.type = type;\n        self.$type = new_$type;\n        return self.activate();\n      }\n    }) : $q.resolve()).then(function () {\n      self.events.send({\n        'event': 'browser-vobject-type',\n        context: self\n      }, type.vobject_type);\n    });\n  });\n\n  this.setVisObj = function (newValue) {\n    this.visobj = newValue;\n    var location = newValue && self.$type.get_location(newValue);\n    this.cachedLocation = location;\n    this.events.send({\n      event: 'on-vis-object',\n      context: this\n    }, location, newValue, self.lovo ? self.lovo.object_type : null);\n  };\n\n  this.selectVisObject = function (visobject) {\n    console.log(\"this.selectVisObject :: \", visobject);\n    return visobject ? $q.resolve().then(function () {\n      return self.lovo && self.lovo.find(visobject);\n    }).then(function (vobj) {\n      return vobj || visobject;\n    }).then(function (vobj) {\n      self.auto = {\n        visobject: vobj\n      };\n\n      if (self.$type.auto_select) {\n        return self.$type.auto_select(visobject);\n      } else {\n        return self.setVisObj(visobject);\n      }\n    }) : $q.resolve();\n  };\n\n  this.selectPreviousVisObject = function () {\n    // console.log(\"this.selectPreviousVisObject = function(){\");\n    if (self.visobj && self.lovo) {\n      self.lovo.previous(self.visobj.id).then(this.selectVisObject.bind(this));\n    }\n  };\n\n  this.selectNextVisObject = function () {\n    console.log(\"this.selectNextVisObject = function(){\");\n\n    if (self.visobj && self.lovo) {\n      self.lovo.next(self.visobj.id).then(this.selectVisObject.bind(this));\n    }\n  }; // Parse the navigation URL query\n\n\n  this.setBrowserAnnotations = function (evt, recording, query) {\n    this.annotations = query;\n    this.currentRecording = recording;\n  };\n\n  this.clearRecordingData = function (evt, data) {\n    this.currentRecording = null;\n  };\n\n  this.setBrowserLocation = function (evt, location) {\n    var m = /([\\w-+]+)(\\/(.+))?/.exec(location);\n\n    if (this.cachedLocation == location) {\n      return $q.resolve();\n    }\n\n    this.cachedLocation = location;\n\n    if (m && BrowserLOVOs[m[1]]) {\n      var loc = m[3];\n      var lovos_def = BrowserLOVOs[m[1]];\n      this.setBrowserType(lovos_def).then(function () {\n        return lovos_def.$controller.resolve_location(loc);\n      }).then(function (visobject) {\n        if (visobject) {\n          return self.selectVisObject(visobject);\n        }\n      });\n    }\n  };\n\n  this.notifyVisobjUpdated = function (evt, visobject) {\n    if (self.lovo && self.lovo.update) {\n      self.lovo.update(visobject);\n    }\n  };\n});","angular.module('a2.browser_common', []).provider('BrowserVisObjects', function () {\n  var visobjects = {};\n  return {\n    add: function (visobject) {\n      visobjects[visobject.type] = angular.extend(visobjects[visobject.type] || {}, visobject);\n    },\n    $get: function () {\n      return visobjects;\n    }\n  };\n}).provider('BrowserLOVOs', function () {\n  var lovos = {\n    $grouping: [],\n    $list: []\n  };\n  return {\n    add: function (lovo) {\n      lovos.$list.push(lovo);\n    },\n    $get: function () {\n      lovos.$grouping = lovos.$list.reduce(function (_, lovodef) {\n        var group = lovodef.group || '';\n\n        if (!_.$index[group]) {\n          _.groups.push(_.$index[group] = []);\n        }\n\n        _.$index[group].push(lovos[lovodef.name] = lovodef);\n\n        return _;\n      }, {\n        groups: [],\n        $index: {}\n      }).groups;\n      return lovos;\n    }\n  };\n}).service('a2ArrayLOVO', function ($q) {\n  var lovo = function (list, object_type) {\n    this.offset = 0;\n    this.setArray(list, object_type);\n  };\n\n  lovo.prototype = {\n    initialize: function () {\n      var d = $q.defer();\n      d.resolve(true);\n      return d.promise;\n    },\n    setArray: function (list, object_type) {\n      this.list = list || [];\n      this.count = this.list.length;\n      this.object_type = object_type;\n    },\n    find: function (soundscape) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      d.resolve(this.list.filter(function (r) {\n        return r.id == id;\n      }).shift());\n      return d.promise;\n    },\n    previous: function (soundscape) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      var index = 0;\n\n      for (var l = this.list, i = 0, e = l.length; i < e; ++i) {\n        if (s.id == id) {\n          index = Math.min(Math.max(0, i - 1, this.list.length - 1));\n          break;\n        }\n      }\n\n      d.resolve(this.list[index]);\n      return d.promise;\n    },\n    next: function (recording) {\n      var d = $q.defer(),\n          id = soundscape && soundscape.id || soundscape | 0;\n      var index = 0;\n\n      for (var l = this.list, i = 0, e = l.length; i < e; ++i) {\n        if (s.id == id) {\n          index = Math.min(Math.max(0, i + 1, this.list.length - 1));\n          break;\n        }\n      }\n\n      d.resolve(this.list[index]);\n      return d.promise;\n    }\n  };\n  return lovo;\n});","/**\n * @ngdoc overview\n * @name dialog\n * @description\n * Visualizer dialog window module.\n */\nangular.module('a2.visualizer.dialog', []).directive('a2VisualizerDialog', function () {\n  return {\n    restrict: 'E',\n    transclude: true,\n    templateUrl: '/app/visualizer/dialog/dialog.html',\n    scope: {\n      show: '=',\n      x1: '=',\n      y1: '=',\n      x2: '=',\n      y2: '='\n    },\n    controller: 'a2VisualizerDialogCtrl'\n  };\n}).controller('a2VisualizerDialogCtrl', function ($scope) {\n  $scope.layout = $scope.$parent.layout;\n\n  $scope.getXSide = function (x1, x2) {\n    var px = Math.max(0, Math.min($scope.layout.sec2x(x2, 1) / $scope.layout.spectrogram.width, 1));\n    return px > .5 ? 'left' : 'right';\n  };\n\n  $scope.getXCoord = function (x1, x2) {\n    return $scope.getXSide(x1, x2) == 'left' ? x1 : x2;\n  };\n\n  $scope.getTransform = function (x1, x2, y1, y2) {\n    var tx = $scope.getXSide(x1, x2) == 'left' ? '-100%' : '0';\n    var ty = $scope.getYTranslation((y1 + y2) / 2, true);\n    return 'translate(' + tx + ', ' + ty + ')';\n  };\n\n  $scope.getYTranslation = function (y, asrelativeoffset) {\n    var py = Math.max(0.1, Math.min($scope.layout.hz2y(y, 1) / $scope.layout.spectrogram.height, .9));\n\n    if (asrelativeoffset) {\n      py = -py;\n    }\n\n    return (100 * py | 0) + '%';\n  };\n});","angular.module('a2.visualizer.layers.recording-tags', ['a2.srv.tags']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.recording-tags.object:recording-tags-layer\n   * @description Recording tags layer.\n   * adds the recording-tags-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-tags-layer\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingTagsLayerController as controller',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n})\n/**\n * @ngdoc controller\n * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController\n * @description Controller for recording tags layer in visualizer.\n * Gets injected an instance of VisualizerCtrl representing the visualizer control.\n * Responds to VisualizerCtrl.event::visobject by loading the visobject tags, if it is a\n * recording.\n */\n.controller('a2VisualizerRecordingTagsLayerController', function (VisualizerCtrl, a2Tags, a2LookaheadHelper, a22PointBBoxEditor, $q, $debounce) {\n  function makeTagsIndex(tags) {\n    return tags.reduce(function (idx, tag) {\n      if (tag.id) {\n        idx[tag.id] = true;\n      }\n\n      return idx;\n    }, {});\n  }\n\n  function groupByBbox(tags) {\n    var bboxes = [];\n    tags.reduce(function (bboxIdx, tag) {\n      if (tag.f0) {\n        var bbox = [tag.t0, tag.f0, tag.t1, tag.f1];\n        var bbox_key = bbox.join(',');\n\n        if (!bboxIdx[bbox_key]) {\n          bboxes.push(bboxIdx[bbox_key] = {\n            bbox: tag,\n            tags: []\n          });\n        }\n\n        bboxIdx[bbox_key].tags.push(tag);\n      }\n\n      return bboxIdx;\n    }, {});\n    return bboxes;\n  }\n\n  var lookaheadHelper = new a2LookaheadHelper({\n    fn: a2Tags.search,\n    minLength: 3,\n    includeSearch: true,\n    searchPromote: function (text) {\n      return {\n        tag: text\n      };\n    },\n    searchCompare: function (text, tag) {\n      return tag.tag == text;\n    }\n  });\n  this.tags = [];\n  this.spectrogramTags = [];\n  this.tagsIndex = {};\n  this.bboxTags = [];\n  this.bboxTagsIndex = {};\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#setVisobject\n   * @description Sets the visobject that will be the focus of this controller.\n   * Causes tags associated to it to be loaded.\n   * @param {visobject} visobject - visobject to set on the controller.\n   * @return Promise resolved with tags of given visobject. If the visobject is\n   * not a recording, then the promise resolves to an empty array.\n   */\n\n  this.setVisobject = function (visobject) {\n    this.visobject = visobject;\n    return this.loadTags();\n  };\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#loadTags\n   * @description Loads the tags for a given visobject and returns them in a promise.\n   * @param {visobject} visobject - visobject for wich to load the tags. Must be a recording visobject.\n   * @return Promise resolved with tags of given visobject. If the visobject is\n   * not a recording, then the promise resolves to an empty array.\n   */\n\n\n  this.loadTags = function () {\n    var visobject = this.visobject;\n\n    if (!visobject || !/^recording$/.test(visobject.type)) {\n      this.tags = [];\n      return $q.resolve(this.tags);\n    }\n\n    this.loading = true;\n    this.visobject = visobject;\n    return a2Tags.getFor(visobject).then(function (tags) {\n      this.tagsIndex = makeTagsIndex(tags);\n      this.spectrogramTags = groupByBbox(tags);\n      this.tags = tags;\n      return tags;\n    }.bind(this)).finally(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#searchedTags\n   * @description Array of tags returned by the last tag search.\n   */\n\n\n  this.searchedTags = [];\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#searchTags\n   * @description Searched for tags using the given text.\n   * @param {String} text - text to match in the tags search.\n   * @return Promise resolved with the searched tags. Also, searched tags are set in searchedTags.\n   */\n\n  this.searchTags = function (text) {\n    if (text === '' || !text) {\n      this.getProjectTags();\n    }\n\n    return lookaheadHelper.search(text).then(function (tags) {\n      this.searchedTags = tags;\n    }.bind(this));\n  };\n  /**\n   * @ngdoc method\n   * @name a2.visualizer.layer.recording-tags.controller:a2VisualizerRecordingTagsLayerController#onTagListChanged\n   * @description Called whenever the list of tags needs to be checked for changes.\n   * @return Promise resolved whenever the list of tags has been checked entirely.\n   */\n\n\n  this.onTagListChanged = $debounce(function () {\n    var tagUpdate = this.determineTagUpdate(this.tags, this.tagsIndex);\n    return this.updateTags(tagUpdate);\n  }, 100);\n  this.onBBoxTagListChanged = $debounce(function () {\n    var tagUpdate = this.determineTagUpdate(this.bboxTags);\n    this.bboxTags = [];\n    var bbox = this.bbox.bbox;\n    tagUpdate.add.forEach(function (tag) {\n      tag.t0 = bbox.x1;\n      tag.f0 = bbox.y1;\n      tag.t1 = bbox.x2;\n      tag.f1 = bbox.y2;\n    });\n    return this.updateTags(tagUpdate).then;\n  });\n\n  this.getProjectTags = function () {\n    return a2Tags.getForType('recording').then(function (tags) {\n      this.searchedTags = tags;\n    }.bind(this));\n  };\n\n  this.getProjectTags();\n\n  this.determineTagUpdate = function (tags, oldTagsIndex) {\n    var tagsIndex = makeTagsIndex(tags);\n    var toDelete = Object.keys(oldTagsIndex || {}).filter(function (tagId) {\n      return !tagsIndex[tagId];\n    });\n    var toAdd = tags.filter(function (tag) {\n      return !tag.id;\n    });\n    return {\n      add: toAdd,\n      delete: toDelete\n    };\n  };\n\n  this.updateTags = function (tagUpdate) {\n    var visobject = this.visobject;\n    console.log(\"visobject : \", visobject);\n    console.log(\"tag update : \", tagUpdate);\n    return $q.all([$q.all(tagUpdate.delete.map(function (tagId) {\n      return a2Tags.deleteFor(visobject, tagId);\n    })), $q.all(tagUpdate.add.map(function (tag) {\n      return a2Tags.addFor(visobject, tag);\n    }))]).then(function (updateResponse) {\n      return this.loadTags();\n    }.bind(this)).catch(function () {\n      // TODO:: notify user of failure... maybe should be done through a notification service...\n      return this.loadTags();\n    }.bind(this));\n  };\n\n  this.bbox = angular.extend(new a22PointBBoxEditor(), {\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    resetBboxTags: function () {\n      console.log(\"resetBboxTags\", this.bboxTags);\n      this.bboxTags = [];\n    }.bind(this),\n    reset: function () {\n      this.resetBboxTags();\n      this.super.reset.call(this);\n    }\n  });\n  VisualizerCtrl.on('visobject', this.setVisobject.bind(this));\n}).directive('a2Tag', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      tag: '='\n    },\n    template: '<span class=\"fa fa-tag no-text-wrap\">' + '{{tag.tag}}' + '</span>'\n  };\n});","angular.module('a2.visualizer.layers.soundscape-composition-tool', ['a2.srv.soundscape-composition', 'arbimon2.directive.validation-dropdown']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layer.soundscape-composition-tool.object:soundscape-composition-tool\n   * @description Recording tags layer.\n   * adds the soundscape-composition-tool layer_type to layer_types. This layer uses\n   * a2.visualizer.layer.soundscape-composition-tool.controller:a2VisualizerSoundscapeCompositionToolController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-composition-tool\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeCompositionToolController as controller',\n    display: {\n      spectrogram: false\n    },\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n})\n/**\n * @ngdoc controller\n * @name a2.visualizer.layer.soundscape-composition-tool.controller:a2VisualizerSoundscapeCompositionToolController\n * @description Controller for recording tags layer in visualizer.\n * Gets injected an instance of VisualizerCtrl representing the visualizer control.\n * Responds to VisualizerCtrl.event::visobject by loading the visobject tags, if it is a\n * recording.\n */\n.controller('a2VisualizerSoundscapeCompositionToolController', function ($q, VisualizerCtrl, a2UserPermit, notify, a2SoundscapeCompositionService) {\n  this.initialize = function () {\n    VisualizerCtrl.on('visobject', this.setVisobject.bind(this));\n    a2SoundscapeCompositionService.getClassList({\n      groupByType: true,\n      isSystemClass: 1\n    }).then(function (classesByType) {\n      this.classTypes = classesByType;\n      this.classesByType = classesByType.reduce(function (_, type) {\n        _[type.type] = type;\n        return _;\n      }, {});\n    }.bind(this));\n    this.annotations = {};\n    this.annotationToolbar = [[{\n      value: 1,\n      caption: \"Annotate as Present\"\n    }, {\n      value: 0,\n      caption: \"Annotate as Absent\"\n    }], [{\n      value: 2,\n      caption: \"Clear Annotation\"\n    }]];\n  };\n\n  this.annotate = function (val, classId) {\n    if (!a2UserPermit.can('validate species')) {\n      notify.error('You do not have permission to add soundscape composition annotations.');\n      return;\n    }\n\n    var keys = [classId];\n\n    if (keys.length > 0) {\n      a2SoundscapeCompositionService.annotate(this.visobject, {\n        'class': keys.join(','),\n        val: val\n      }).then(function (annotations) {\n        this.is_selected = {};\n        annotations.forEach(function (annotation) {\n          if (annotation.present == 2) {\n            delete this.annotations[annotation.scclassId];\n          } else {\n            this.annotations[annotation.scclassId] = annotation.present;\n          }\n        }.bind(this));\n      }.bind(this));\n    }\n  };\n\n  this.setVisobject = function (visobject) {\n    this.visobject = visobject;\n    return this.loadAnnotations();\n  };\n\n  this.loadAnnotations = function () {\n    var visobject = this.visobject;\n\n    if (!visobject || !/^recording$/.test(visobject.type)) {\n      this.annotations = {};\n      return $q.resolve(this.annotations);\n    }\n\n    this.loading = true;\n    this.visobject = visobject;\n    return a2SoundscapeCompositionService.getAnnotationsFor(visobject).then(function (annotations) {\n      this.annotations = annotations;\n      return annotations;\n    }.bind(this)).finally(function () {\n      this.loading = false;\n    }.bind(this));\n  };\n\n  this.initialize();\n});","angular.module('a2.visualizer.layers.templates', ['visualizer-services', 'a2.utils']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.templates.object:templates\n   * @description Templates layer.\n   * adds the templates layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.templates.controller:a2VisualizerTemplateLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"templates\",\n    title: \"\",\n    controller: 'a2VisualizerTemplateLayerController as templates',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerTemplateLayerController', function ($scope, $modal, $controller, $state, $timeout, a2Templates, a2UserPermit, a22PointBBoxEditor, Project, notify) {\n  var self = this;\n  self.selected = null;\n  self.templates = [];\n  self.recordingTemplates = [];\n  self.citizenScientistUser = a2UserPermit.all && a2UserPermit.all.length === 1 && a2UserPermit.all.includes('use citizen scientist interface') && !a2UserPermit.can('delete project') && !a2UserPermit.isSuper();\n  Project.getClasses(function (project_classes) {\n    self.project_classes = project_classes;\n  });\n  var getTemplatesPromise = a2Templates.getList({\n    projectTemplates: true\n  }).then(function (templates) {\n    self.templates = templates;\n    return templates;\n  });\n\n  self.updateState = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n    getTemplatesPromise.then(function () {\n      self.recordingTemplates = self.templates.filter(function (template) {\n        return template.recording == rec;\n      });\n    });\n    self.editor.reset();\n    self.editor.recording = rec;\n  };\n\n  self.goToSpeciesPage = function () {\n    $state.go('audiodata.species', {});\n  };\n\n  self.editor = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.roi = null;\n    },\n    make_new_bbox: function () {\n      this.super.make_new_bbox.call(this);\n      this.roi = this.bbox;\n    },\n    make_new_roi: function () {\n      this.make_new_bbox();\n    },\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      console.log('add_point : function(', point, ', ', min_eps, '){');\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    get_placeholder_name: function () {\n      return this.project_class ? this.project_class.species_name + ' ' + this.project_class.songtype_name : 'Template Name';\n    },\n    submit: function () {\n      if (!a2UserPermit.can('manage templates')) {\n        notify.error('You do not have permission to add a template');\n        return;\n      }\n\n      if (!this.project_class.songtype_name && !this.project_class.species_name) {\n        return;\n      }\n\n      this.submitting = true;\n      a2Templates.add({\n        name: this.template_name || this.project_class.species_name + \" \" + this.project_class.songtype_name,\n        recording: this.recording,\n        species: this.project_class.species,\n        songtype: this.project_class.songtype,\n        roi: this.roi\n      }).then(function (new_template) {\n        console.log('new_template', new_template);\n        this.submitting = false;\n        if (new_template.id === 0) return notify.error('The template with that name already exists for this record.');\n        $timeout(function () {\n          this.reset();\n          self.templates.push(new_template);\n          self.updateState();\n        }.bind(this));\n      }.bind(this));\n    }\n  });\n  $scope.$watch('visobject', self.updateState);\n}) // .controller('a2VisualizerAddTemplateModalController', function($scope, $modalInstance, Project, a2Templates){\n//     $scope.data = {\n//         name : '',\n//         type : null\n//     };\n//\n//     $scope.loadingClasses = true;\n//\n//     Project.getClasses(function(project_classes){\n//         $scope.project_classes = project_classes;\n//         $scope.loadingClasses = false;\n//     });\n//\n//     $scope.loadingTypes = true;\n//\n//     a2Templates.getTypes(function(template_types){\n//         $scope.template_types = template_types;\n//         if(template_types && template_types.length == 1) {\n//             $scope.data.type = template_types[0];\n//             $scope.loadingTypes = false;\n//         }\n//     });\n//\n//     $scope.ok = function(){\n//         $scope.creating = true;\n//         $scope.validation = {\n//             count:0\n//         };\n//\n//         var template_data = {};\n//\n//         if($scope.data.name){\n//             template_data.name = $scope.data.name;\n//         }\n//         else {\n//             $scope.validation.name = \"Training set name is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         if($scope.data.type && $scope.data.type.id){\n//             template_data.type = $scope.data.type.identifier;\n//         }\n//         else {\n//             $scope.validation.type = \"Training set type is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         if($scope.data.class) {\n//             template_data.class = $scope.data.class.id;\n//         }\n//         else {\n//             $scope.validation.class = \"Species sound is required.\";\n//             $scope.validation.count++;\n//         }\n//\n//         // $scope.form_data=template_data;\n//\n//         if($scope.validation.count ===  0) {\n//             a2Templates.add(template_data, function(new_template) {\n//                 if(new_template.error) {\n//\n//                     var field = new_template.field || 'error';\n//\n//                     $scope.validation[field] = new_template.error;\n//\n//                     return;\n//                 }\n//                 $modalInstance.close(new_template);\n//             });\n//         }\n//         else {\n//             $scope.creating = false;\n//         }\n//     };\n// })\n;","angular.module('a2.visobjects.audio-event-detection', ['a2.services', 'a2.visobjects.common', 'a2.service.plotly-plot-maker']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'audio-event-detection',\n    $loader: ['VisualizerObjectAudioEventDetectionTypeLoader', function (VisualizerObjectAudioEventDetectionTypeLoader) {\n      return VisualizerObjectAudioEventDetectionTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectAudioEventDetectionTypeLoader', function ($q, AudioEventDetectionService, plotlyPlotMaker, a2UrlUpdate) {\n  var aggregates;\n  var statisticsInfo;\n  var getParameters = $q.resolve().then(function () {\n    return $q.all([AudioEventDetectionService.getDataAggregatesList().then(function (_aggregates) {\n      aggregates = _aggregates;\n    }), AudioEventDetectionService.getDataStatisticsList().then(function (_statistics) {\n      statisticsInfo = _statistics.reduce(function (_, $) {\n        return _[$.statistic] = $, _;\n      }, {});\n    })]);\n  });\n\n  var AudioEventDetection = function (data) {\n    this.update(data).then(function () {\n      return getParameters;\n    }.bind(this)).then(function () {\n      return this.selectData({\n        x: statisticsInfo.tod,\n        y: statisticsInfo.y_max,\n        z: aggregates.reduce(function (_, $) {\n          return $.statistic == 'count' ? $ : _;\n        }, null)\n      });\n    }.bind(this));\n  };\n\n  AudioEventDetection.fetch = function (visobject) {\n    var d = $q.defer();\n    visobject = new AudioEventDetection(visobject);\n    d.resolve(visobject);\n    return d.promise;\n  };\n\n  AudioEventDetection.load = function (visobject, $scope) {\n    return AudioEventDetection.fetch(visobject);\n  };\n\n  AudioEventDetection.getCaptionFor = function (visobject) {\n    return visobject.name;\n  };\n\n  AudioEventDetection.prototype = {\n    type: \"audio-event-detection\",\n    layout: 'plotted',\n    zoomable: false,\n    update: function (data) {\n      console.log(\"AED data : \", data);\n\n      for (var i in data) {\n        this[i] = data[i];\n      }\n\n      this.plot = {\n        layout: {\n          title: data.name\n        },\n        data: []\n      };\n\n      if (data.statistics.indexOf('todsec') == -1) {\n        data.statistics.push('todsec', 'todsecspan', 'freqspan');\n      }\n\n      return getParameters.then(function () {\n        var statistics = data.statistics.reduce(function (_, $) {\n          return statisticsInfo[$] && _.push(statisticsInfo[$]), _;\n        }, []);\n        this.data_selection = {\n          x: statistics,\n          y: statistics,\n          z: aggregates,\n          current: {\n            x: statisticsInfo.tod,\n            y: statisticsInfo.y_max,\n            z: aggregates.reduce(function (_, $) {\n              return $.statistic == 'count' ? $ : _;\n            }, null)\n          }\n        };\n      }.bind(this));\n    },\n    selectData: function (selection) {\n      this.data_selection.current = angular.extend({}, this.data_selection.current, selection);\n      var x = this.data_selection.current.x,\n          y = this.data_selection.current.y,\n          z = this.data_selection.current.z;\n      console.log(\"this.data_selection.current\", this.data_selection.current);\n      return AudioEventDetectionService.getDataFor(this.id, x, y, z).then(function (data) {\n        var plot = x == y ? plotlyPlotMaker.makeBarPlot(x, z, data, this.name) : plotlyPlotMaker.makeHeatmapPlot(x, y, z, data, this.name);\n        this.plot.data = [plot.data];\n        this.plot.layout = plot.layout;\n      }.bind(this));\n    },\n    savePlot: function () {\n      var x = this.data_selection.current.x,\n          y = this.data_selection.current.y,\n          z = this.data_selection.current.z;\n      return AudioEventDetectionService.savePlotFor(this.id, x, y, z).then(function (data) {\n        a2UrlUpdate.update(data.url);\n      });\n    },\n    getCaption: function () {\n      return AudioEventDetection.getCaptionFor(this);\n    }\n  };\n  return AudioEventDetection;\n});","angular.module('a2.visobjects.common', []).provider('VisualizerObjectTypes', function () {\n  var types = {};\n  var defers = {};\n  return {\n    add: function (typeDef) {\n      types[typeDef.type] = angular.extend(types[typeDef.type] || {}, typeDef);\n    },\n    $get: function ($injector) {\n      return {\n        types: types,\n        getLoader: function (type) {\n          if (!types[type]) {\n            throw new Error(\"Visualizer Object Type '\" + type + \"' not found\");\n          }\n\n          return $injector.invoke(types[type].$loader);\n        }\n      };\n    }\n  };\n});","angular.module('a2.visobjects.recording', ['a2.services', 'a2.visobjects.common']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'recording',\n    $loader: ['VisualizerObjectRecordingTypeLoader', function (VisualizerObjectRecordingTypeLoader) {\n      return VisualizerObjectRecordingTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectRecordingTypeLoader', function ($q, Project, $localStorage) {\n  var khz_format = function (v) {\n    return v / 1000 | 0;\n  };\n\n  var getSelectedFrequencyCache = function () {\n    try {\n      return JSON.parse($localStorage.getItem('visuilizer.frequencies.cache')) || {\n        originalScale: true\n      };\n    } catch (e) {\n      return {\n        originalScale: true\n      };\n    }\n  };\n\n  var scaleCache = getSelectedFrequencyCache();\n\n  var recording = function (data, extra) {\n    for (var i in data) {\n      this[i] = data[i];\n    }\n\n    this.sampling_rate = this.sample_rate;\n    this.extra = extra;\n    this.max_freq = this.sampling_rate / 2;\n    this.span = scaleCache && scaleCache.originalScale ? this.max_freq : this.max_freq > 24000 ? this.max_freq : 24000;\n\n    if (!data) {\n      this.span = 44100 / 2;\n      this.duration = 60;\n    }\n\n    this.domain = {\n      x: {\n        from: 0,\n        to: this.duration,\n        span: this.duration,\n        unit: 'Time ( s )',\n        ticks: 60\n      },\n      y: {\n        from: 0,\n        to: this.span,\n        span: this.span,\n        unit: 'Frequency ( kHz )',\n        tick_format: khz_format\n      }\n    };\n\n    if (!this.tiles) {\n      this.isDisabled = true;\n      return;\n    } // set it to the scope\n\n\n    this.tiles.set.forEach(function (tile) {\n      if (!!data.legacy) {\n        tile.src = \"/legacy-api/project/\" + Project.getUrl() + \"/recordings/tiles/\" + this.id + \"/\" + tile.i + \"/\" + tile.j;\n      } else {\n        var streamId = data.uri.split('/')[3];\n        const datetime = data.datetime_utc ? data.datetime_utc : data.datetime;\n        var start = new Date(new Date(datetime).valueOf() + Math.round(tile.s * 1000)).toISOString();\n        var end = new Date(new Date(datetime).valueOf() + Math.round((tile.s + tile.ds) * 1000)).toISOString();\n        tile.src = '/legacy-api/ingest/recordings/' + streamId + '_t' + start.replace(/-|:|\\./g, '') + '.' + end.replace(/-|:|\\./g, '') + '_z95_wdolph_g1_fspec_mtrue_d1023.255.png';\n      }\n    }.bind(this));\n  };\n\n  recording.layers = [];\n\n  recording.fetch = function (visobject) {\n    var d = $q.defer();\n    Project.getRecordingInfo(visobject.id, function (data) {\n      if (data === 'Server error') {\n        visobject.isDisabled = true;\n        data = {};\n      }\n\n      visobject = new recording(data, visobject.extra);\n      d.resolve(visobject);\n    });\n    return d.promise;\n  };\n\n  recording.load = function (visobject, $scope) {\n    return recording.fetch(visobject).then(function (visobject) {\n      if (visobject.audioUrl) {\n        $scope.audio_player.load(visobject.audioUrl);\n      }\n\n      return visobject;\n    });\n  };\n\n  recording.getCaptionFor = function (visobject) {\n    return visobject.file;\n  };\n\n  recording.prototype = {\n    type: \"recording\",\n    zoomable: true,\n    getCaption: function () {\n      return recording.getCaptionFor(this);\n    }\n  };\n  return recording;\n});","angular.module('a2.visobjects.soundscape', ['a2.services', 'a2.visobjects.common']).config(function (VisualizerObjectTypesProvider) {\n  VisualizerObjectTypesProvider.add({\n    type: 'soundscape',\n    $loader: ['VisualizerObjectSoundscapeTypeLoader', function (VisualizerObjectSoundscapeTypeLoader) {\n      return VisualizerObjectSoundscapeTypeLoader;\n    }]\n  });\n}).service('VisualizerObjectSoundscapeTypeLoader', function ($q, Project) {\n  var khz_format = function (v) {\n    return v / 1000 | 0;\n  };\n\n  var khz_unit_fmt = function (v) {\n    return Math.floor(v / 10.0) / 100.0 + \" kHz\";\n  };\n\n  var aggregations = {\n    'time_of_day': {\n      time_unit: 'Time (Hour in Day)',\n      unit_fmt: function (v) {\n        return (v | 0) + \":00\";\n      }\n    },\n    'day_of_month': {\n      time_unit: 'Time (Day in Month)',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'day_of_year': {\n      time_unit: 'Time (Day in Year )',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'month_in_year': {\n      time_unit: 'Time (Month in Year)',\n      unit_fmt: function (v) {\n        return moment().localeData()._months[(v | 0) - 1];\n      }\n    },\n    'day_of_week': {\n      time_unit: 'Time (Weekday) ',\n      unit_fmt: function (v) {\n        return moment().localeData()._weekdays[(v | 0) - 1];\n      }\n    },\n    'year': {\n      time_unit: 'Time (Year) ',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    },\n    'unknown': {\n      time_unit: 'Time',\n      unit_fmt: function (v) {\n        return v | 0;\n      }\n    }\n  };\n\n  var soundscape = function (data) {\n    this.update(data);\n  };\n\n  soundscape.fetch = function (visobject) {\n    var d = $q.defer();\n    visobject = new soundscape(visobject);\n    d.resolve(visobject);\n    return d.promise;\n  };\n\n  soundscape.load = function (visobject, $scope) {\n    return soundscape.fetch(visobject);\n  };\n\n  soundscape.getCaptionFor = function (visobject) {\n    var agg = {\n      'time_of_day': 'Time of day',\n      'day_of_month': 'Day of Month',\n      'day_of_year': 'Day of Year',\n      'month_in_year': 'Month in year',\n      'day_of_week': 'Day of week',\n      'year': 'Year '\n    };\n    return visobject.name + \" (\" + agg[visobject.aggregation] + \")\";\n  };\n\n  soundscape.prototype = {\n    type: \"soundscape\",\n    zoomable: true,\n    update: function (data) {\n      for (var i in data) {\n        this[i] = data[i];\n      }\n\n      var t0 = this.min_t,\n          t1 = this.max_t;\n      var f0 = this.min_f,\n          f1 = this.max_f;\n      var v0 = this.min_value,\n          v1 = this.visual_max_value || this.max_value;\n\n      if (this.normalized) {\n        v0 = 0;\n        v1 = 100;\n      }\n\n      var dt = t1 - t0 + 1,\n          df = f1 - f0,\n          dv = v1 - v0;\n      var aggregation = aggregations[this.aggregation] || aggregations.unknown;\n      var time_unit = aggregation.time_unit; // setup the domains\n\n      this.domain = {\n        x: {\n          // from : t0, to : t1 + 1, span : dt + 1, ticks : dt + 1,\n          from: t0,\n          to: t1,\n          span: dt,\n          ticks: dt,\n          ordinal: true,\n          unit_interval: 1,\n          unit_format: aggregation.unit_fmt,\n          unit: time_unit || 'Time ( s )'\n        },\n        y: {\n          from: f0,\n          to: f1,\n          span: df,\n          unit: 'Frequency ( kHz )',\n          unit_interval: this.bin_size,\n          unit_format: khz_unit_fmt,\n          tick_format: khz_format\n        },\n        legend: {\n          from: v0,\n          to: v1,\n          span: dv,\n          ticks: Math.max(2, Math.min(dv | 0, 10)),\n          unit: 'Count',\n          src: '/images/palettes/' + this.visual_palette + '.png'\n        }\n      };\n\n      if (this.normalized) {\n        this.domain.legend.tick_format = function (v) {\n          return v + '%';\n        };\n      } // set it to the scope\n\n\n      this.tiles = {\n        x: 1,\n        y: 1,\n        set: [{\n          i: 0,\n          j: 0,\n          s: 0,\n          hz: f1,\n          ds: dt,\n          dhz: df,\n          src: this.thumbnail,\n          crisp: true\n        }]\n      };\n      this.legend = {\n        min: 0,\n        max: 255\n      };\n    },\n    getCaption: function () {\n      return soundscape.getCaptionFor(this);\n    }\n  };\n  return soundscape;\n});","angular.module('a2.visobjects', ['a2.visobjects.common', 'a2.visobjects.recording', 'a2.visobjects.soundscape', 'a2.visobjects.audio-event-detection']);","angular.module('a2.analysis.random-forest-models.classification', ['ui.bootstrap', 'a2.services', 'a2.permissions', 'humane', 'c3-charts']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models.classification', {\n    url: '/classification',\n    controller: 'ClassificationCtrl',\n    templateUrl: '/app/analysis/random-forest-models/classification/list.html'\n  });\n}).controller('ClassificationCtrl', function ($scope, $modal, $filter, Project, ngTableParams, JobsData, a2Playlists, notify, $location, a2Classi, a2UserPermit) {\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    var tableConfig = {\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    };\n    $scope.tableParams = new ngTableParams(tableConfig, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.classificationsOriginal, params.filter()) : $scope.classificationsOriginal;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : $scope.classificationsOriginal;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No classifications found.\";\n        }\n\n        $scope.classificationsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Classi.saveState({\n          'data': $scope.classificationsOriginal,\n          'filtered': $scope.classificationsData,\n          'f': params.filter(),\n          'o': params.orderBy(),\n          'p': params.page(),\n          'c': params.count(),\n          't': orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  };\n\n  $scope.capitalize = function (row) {\n    return row.length ? row[0].toUpperCase() + row.slice(1) : row;\n  };\n\n  $scope.loadClassifications = function () {\n    a2Classi.list(function (data) {\n      $scope.classificationsOriginal = data;\n      data.forEach(function (row) {\n        row.muser = $scope.capitalize(row.firstname) + \" \" + $scope.capitalize(row.lastname);\n      });\n      $scope.classificationsData = data;\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n      $scope.infopanedata = \"\";\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+cname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No classifications found.\";\n      }\n    });\n  };\n\n  $scope.showClassificationDetails = function (classi) {\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var data = {\n      id: classi.job_id,\n      name: classi.cname,\n      modelId: classi.model_id,\n      playlist: {\n        name: classi.playlist_name,\n        id: classi.playlist_id\n      }\n    };\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/classinfo.html',\n      controller: 'ClassiDetailsInstanceCtrl',\n      windowClass: 'details-modal-window',\n      backdrop: 'static',\n      resolve: {\n        ClassiInfo: function () {\n          return {\n            data: data,\n            project: $scope.projectData\n          };\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n  };\n\n  $scope.createNewClassification = function () {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to create classifications');\n      return;\n    }\n\n    $scope.loading = true;\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/createnewclassification.html',\n      controller: 'CreateNewClassificationInstanceCtrl',\n      resolve: {\n        data: function ($q) {\n          var d = $q.defer();\n          Project.getModels(function (err, data) {\n            if (err) {\n              console.error(err);\n            }\n\n            d.resolve(data || []);\n          });\n          return d.promise;\n        },\n        playlists: function ($q) {\n          var d = $q.defer();\n          a2Playlists.getList().then(function (data) {\n            d.resolve(data || []);\n          });\n          return d.promise;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (result) {\n      data = result;\n\n      if (data.ok) {\n        JobsData.updateJobs();\n        notify.log(\"Your new classification is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n      }\n\n      if (data.error) {\n        notify.error(\"Error: \" + data.error);\n      }\n\n      if (data.url) {\n        $location.path(data.url);\n      }\n    });\n  };\n\n  $scope.deleteClassification = function (id, name) {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to delete classifications');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/classification/deleteclassification.html',\n      controller: 'DeleteClassificationInstanceCtrl',\n      resolve: {\n        name: function () {\n          return name;\n        },\n        id: function () {\n          return id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.err) {\n        notify.error(\"Error: \" + ret.err);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.classificationsOriginal);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].job_id === id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.classificationsOriginal.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Classification deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.loading = true;\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n  });\n  var stateData = a2Classi.getState();\n\n  if (stateData === null) {\n    $scope.loadClassifications();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.classificationsData = stateData.filtered;\n      $scope.classificationsOriginal = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n}).controller('DeleteClassificationInstanceCtrl', function ($scope, $modalInstance, a2Classi, name, id, projectData) {\n  $scope.name = name;\n  $scope.id = id;\n  $scope.deletingloader = false;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    $scope.deletingloader = true;\n    a2Classi.delete(id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('ClassiDetailsInstanceCtrl', function ($scope, $modalInstance, a2Classi, a2Models, notify, a2UserPermit, ClassiInfo) {\n  var loadClassifiedRec = function () {\n    a2Classi.getResultDetails($scope.classiData.id, $scope.currentPage * $scope.maxPerPage, $scope.maxPerPage, function (dataRec) {\n      a2Classi.getRecVector($scope.classiData.id, dataRec[0].recording_id).success(function (data) {\n        var maxVal = Math.max.apply(null, data.vector);\n\n        if (typeof $scope.th === 'number') {\n          $scope.htresDeci = maxVal < $scope.th ? 'no' : 'yes';\n        }\n\n        $scope.recVect = data.vector;\n        $scope.recs = dataRec;\n        $scope.minv = dataRec[0].stats.minv;\n        $scope.maxv = dataRec[0].stats.maxv;\n        $scope.maxvRounded = Math.round($scope.maxv * 1000) / 1000;\n      });\n    });\n  };\n\n  $scope.ok = function () {\n    $modalInstance.close();\n  };\n\n  $scope.next = function () {\n    $scope.currentPage = $scope.currentPage + 1;\n\n    if ($scope.currentPage * $scope.maxPerPage >= $scope.classiData.total) {\n      $scope.currentPage = $scope.currentPage - 1;\n    } else {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.prev = function () {\n    $scope.currentPage = $scope.currentPage - 1;\n\n    if ($scope.currentPage < 0) {\n      $scope.currentPage = 0;\n    } else {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.gotoc = function (where) {\n    if (where == 'first') {\n      $scope.currentPage = 0;\n    }\n\n    if (where == 'last') {\n      $scope.currentPage = Math.ceil($scope.classiData.total / $scope.maxPerPage) - 1;\n    }\n\n    loadClassifiedRec();\n  };\n\n  $scope.toggleRecDetails = function () {\n    $scope.showMore = !$scope.showMore;\n\n    if ($scope.showMore && !$scope.recs) {\n      loadClassifiedRec();\n    }\n  };\n\n  $scope.loading = true;\n  $scope.htresDeci = '-';\n  $scope.classiData = ClassiInfo.data;\n  $scope.project = ClassiInfo.project;\n  $scope.showMore = false;\n  $scope.currentPage = 0;\n  $scope.maxPerPage = 1;\n  $scope.csvUrl = \"/legacy-api/project/\" + $scope.project.url + \"/classifications/csv/\" + $scope.classiData.id;\n  $scope.showDownload = a2UserPermit.can('manage models and classification');\n  console.table($scope.classiData);\n  a2Classi.getDetails($scope.classiData.id, function (data) {\n    if (!data) {\n      $modalInstance.close();\n      notify.log(\"No details available for this classification\");\n      return;\n    }\n\n    angular.extend($scope.classiData, data);\n    $scope.totalRecs = Math.ceil($scope.classiData.total / $scope.maxPerPage);\n    console.log($scope.classiData);\n    $scope.results = [['absent', $scope.classiData.total - $scope.classiData.present], ['present', $scope.classiData.present], ['skipped', $scope.classiData.errCount]];\n    a2Models.findById($scope.classiData.modelId).success(function (modelInfo) {\n      console.log(modelInfo);\n      $scope.model = modelInfo;\n      $scope.loading = false;\n    }).error(function (err) {\n      $scope.loading = false;\n    });\n  });\n}).controller('CreateNewClassificationInstanceCtrl', function ($scope, $modalInstance, a2Classi, data, projectData, playlists) {\n  $scope.data = data;\n  $scope.projectData = projectData;\n  $scope.recselected = '';\n  $scope.showselection = false;\n  $scope.playlists = playlists;\n  $scope.nameMsg = '';\n  $scope.datas = {\n    name: '',\n    classifier: '',\n    playlist: ''\n  };\n  $scope.$watch('recselected', function () {\n    if ($scope.recselected === 'selected') {\n      $scope.showselection = true;\n    } else {\n      $scope.showselection = false;\n    }\n  });\n\n  $scope.ok = function () {\n    $scope.nameMsg = '';\n    var url = $scope.projectData.url;\n    $scope.all = 0;\n    $scope.selectedSites = []; // NOTE temporary block disabled model types\n\n    if (!$scope.datas.classifier.enabled) return;\n    var classiData = {\n      n: $scope.datas.name,\n      c: $scope.datas.classifier.model_id,\n      a: $scope.all,\n      s: $scope.selectedSites.join(),\n      p: $scope.datas.playlist\n    };\n    a2Classi.create(classiData, function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    });\n  };\n\n  $scope.buttonEnable = function () {\n    /*\n        var flag = false;\n        if ($scope.recselected === 'all')\n            flag = true;\n        else\n        {\n            var numberOfChecked = $('input:checkbox:checked').length;\n            if (numberOfChecked>0)\n            {\n                flag = true;\n            }\n         }\n    */\n    return !(typeof $scope.datas.playlist !== 'string' && $scope.datas.name.length && typeof $scope.datas.classifier !== 'string');\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n}).directive('a2Vectorchart', function () {\n  return {\n    restrict: 'E',\n    scope: {\n      vectorData: '=',\n      minvect: '=',\n      maxvect: '='\n    },\n    templateUrl: '/app/analysis/random-forest-models/classification/vectorchart.html',\n    controller: function ($scope) {\n      $scope.loadingflag = true;\n\n      $scope.drawVector = function () {\n        if (!$scope.vectorData) return;\n        $scope.loadingflag = true;\n        var canvas = $scope.canvas;\n        var vector = $scope.vectorData;\n        var height = 50;\n        var width = $scope.width;\n        var xStep;\n\n        if (width >= vector.length) {\n          canvas.width = width;\n          xStep = width / vector.length;\n        } else {\n          canvas.width = vector.length;\n          xStep = 1;\n        }\n\n        canvas.height = height;\n        ctx = canvas.getContext('2d');\n        ctx.beginPath();\n        var i = 0;\n        ctx.moveTo(i * xStep, height * (1 - (vector[i] - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n\n        while (i < vector.length) {\n          i++;\n          ctx.lineTo(i * xStep, height * (1 - (vector[i] - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n        }\n\n        ctx.strokeStyle = '#000';\n        ctx.stroke();\n\n        if ($scope.minvect < -0.09) {\n          //code\n          ctx.beginPath();\n          i = 0;\n          ctx.moveTo(i * xStep, height * (1 - (0 - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n\n          while (i < vector.length) {\n            i++;\n            ctx.lineTo(i * xStep, height * (1 - (0 - $scope.minvect) / ($scope.maxvect - $scope.minvect)));\n          }\n\n          ctx.strokeStyle = '#aa0000';\n          ctx.stroke();\n        }\n\n        $scope.loadingflag = false;\n      };\n\n      $scope.$watch('vectorData', function () {\n        $scope.drawVector();\n      });\n    },\n    link: function (scope, element) {\n      scope.canvas = element.children()[0];\n      scope.width = parseInt(element.css('width'));\n    }\n  };\n});","angular.module('a2.analysis.random-forest-models.models', ['a2.services', 'a2.permissions', 'a2.utils', 'ui.bootstrap', 'ui.select', 'ngSanitize', 'ngTable', 'ngCsv', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('analysis.random-forest-models.models', {\n    url: '/models?newJob',\n    controller: 'ModelsCtrl',\n    templateUrl: '/app/analysis/random-forest-models/models/list.html'\n  }).state('analysis.modeldetails', {\n    url: '/model/:modelId',\n    controller: 'ModelDetailsCtrl',\n    templateUrl: '/app/analysis/random-forest-models/models/modelinfo.html'\n  });\n}).controller('ModelsCtrl', function ($scope, $modal, $filter, ngTableParams, Project, a2Models, JobsData, $location, notify, a2UserPermit, $state) {\n  $scope.infoInfo = \"Loading...\";\n  $scope.showInfo = true;\n  $scope.loading = true;\n\n  $scope.updateFlags = function () {\n    $scope.successInfo = \"\";\n    $scope.showSuccess = false;\n    $scope.errorInfo = \"\";\n    $scope.showError = false;\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  };\n\n  Project.getInfo(function (data) {\n    $scope.projectData = data;\n  });\n  var p = $state.params;\n  var isNewJob = p && p.newJob !== undefined;\n\n  var initTable = function (p, c, s, f, t) {\n    var sortBy = {};\n    var acsDesc = 'desc';\n\n    if (s[0] == '+') {\n      acsDesc = 'asc';\n    }\n\n    sortBy[s.substring(1)] = acsDesc;\n    $scope.tableParams = new ngTableParams({\n      page: p,\n      count: c,\n      sorting: sortBy,\n      filter: f\n    }, {\n      total: t,\n      getData: function ($defer, params) {\n        $scope.infopanedata = \"\";\n        var filteredData = params.filter() ? $filter('filter')($scope.modelsDataOrig, params.filter()) : $scope.modelsDataOrig;\n        var orderedData = params.sorting() ? $filter('orderBy')(filteredData, params.orderBy()) : filteredData;\n        params.total(orderedData.length);\n        $defer.resolve(orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count()));\n\n        if (orderedData.length < 1) {\n          $scope.infopanedata = \"No models found.\";\n        }\n\n        $scope.modelsData = orderedData.slice((params.page() - 1) * params.count(), params.page() * params.count());\n        a2Models.saveState({\n          data: $scope.modelsDataOrig,\n          filtered: $scope.modelsData,\n          f: params.filter(),\n          o: params.orderBy(),\n          p: params.page(),\n          c: params.count(),\n          t: orderedData.length\n        });\n      }\n    });\n  };\n\n  $scope.loadModels = function () {\n    a2Models.list(function (data) {\n      $scope.modelsData = data;\n      $scope.modelsDataOrig = data;\n      $scope.showInfo = false;\n      $scope.loading = false;\n\n      if (data.length > 0) {\n        if (!$scope.tableParams) {\n          initTable(1, 10, \"+mname\", {}, data.length);\n        } else {\n          $scope.tableParams.reload();\n        }\n      } else {\n        $scope.infopanedata = \"No models found.\";\n      }\n    });\n  };\n\n  var stateData = a2Models.getState();\n\n  if (stateData === null) {\n    $scope.loadModels();\n  } else {\n    if (stateData.data.length > 0) {\n      $scope.modelsData = stateData.filtered;\n      $scope.modelsDataOrig = stateData.data;\n      initTable(stateData.p, stateData.c, stateData.o[0], stateData.f, stateData.filtered.length);\n    } else {\n      $scope.infopanedata = \"No models found.\";\n    }\n\n    $scope.infoInfo = \"\";\n    $scope.showInfo = false;\n    $scope.loading = false;\n  }\n\n  $scope.deleteModel = function (model_id, model_name) {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to delete models');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true;\n    var modalInstance = $modal.open({\n      templateUrl: '/app/analysis/random-forest-models/models/deletemodel.html',\n      controller: 'DeleteModelInstanceCtrl',\n      resolve: {\n        model_name: function () {\n          return model_name;\n        },\n        model_id: function () {\n          return model_id;\n        },\n        projectData: function () {\n          return $scope.projectData;\n        }\n      }\n    });\n    modalInstance.opened.then(function () {\n      $scope.infoInfo = \"\";\n      $scope.showInfo = false;\n      $scope.loading = false;\n    });\n    modalInstance.result.then(function (ret) {\n      if (ret.error) {\n        notify.error(\"Error: \" + ret.error);\n      } else {\n        var index = -1;\n        var modArr = angular.copy($scope.modelsDataOrig);\n\n        for (var i = 0; i < modArr.length; i++) {\n          if (modArr[i].model_id === model_id) {\n            index = i;\n            break;\n          }\n        }\n\n        if (index > -1) {\n          $scope.modelsDataOrig.splice(index, 1);\n          $scope.tableParams.reload();\n          notify.log(\"Model deleted successfully\");\n        }\n      }\n    });\n  };\n\n  $scope.model_id = null;\n  $scope.validationdata = null;\n\n  $scope.newModel = function () {\n    if (!a2UserPermit.can('manage models and classification')) {\n      notify.error('You do not have permission to create models');\n      return;\n    }\n\n    $scope.infoInfo = \"Loading...\";\n    $scope.showInfo = true;\n    $scope.loading = true; // var url = $scope.projectData.url;\n\n    a2Models.getFormInfo(function (data) {\n      var modalInstance = $modal.open({\n        templateUrl: '/app/analysis/random-forest-models/models/newmodel.html',\n        controller: 'NewModelInstanceCtrl',\n        resolve: {\n          projectData: function () {\n            return $scope.projectData;\n          },\n          types: function () {\n            var typesEnable = data.types.filter(function (type) {\n              return type.enabled;\n            });\n            return typesEnable;\n          },\n          trainings: function () {\n            return data.trainings;\n          }\n        }\n      });\n      modalInstance.opened.then(function () {\n        $scope.infoInfo = \"\";\n        $scope.showInfo = false;\n        $scope.loading = false;\n      });\n      modalInstance.result.then(function (result) {\n        if (result.ok) {\n          JobsData.updateJobs();\n          notify.log(\"Your new model training is waiting to start processing.<br> Check its status on <b>Jobs</b>.\");\n        }\n\n        if (result.error) {\n          notify.error(\"Error \" + result.error);\n        }\n\n        if (result.url) {\n          $location.path(result.url);\n        }\n      });\n    });\n  };\n\n  if (isNewJob) {\n    $scope.newModel();\n  }\n}).controller('NewModelInstanceCtrl', function ($scope, $modalInstance, a2Models, Project, projectData, types, trainings, notify, $http) {\n  $scope.types = types;\n  $scope.projectData = projectData;\n  $scope.trainings = trainings;\n  $scope.nameMsg = '';\n  $scope.data = {\n    training: '',\n    classifier: '',\n    name: '',\n    totalValidations: 'Retrieving...',\n    presentValidations: '-',\n    absentsValidations: '-',\n    usePresentTraining: '',\n    useNotPresentTraining: '',\n    usePresentValidation: -1,\n    useNotPresentValidation: -1\n  };\n  $http.get('/legacy-api/jobs/types').success(function (jobTypes) {\n    var training = jobTypes.filter(function (type) {\n      return type.name === \"Model training\";\n    });\n    if (!training.length) return console.error('training job info not found');\n    $scope.jobDisabled = !training[0].enabled;\n  });\n  $scope.totalPresentValidation = 0;\n  $scope.$watch('data.usePresentTraining', function () {\n    var val = $scope.data.presentValidations - $scope.data.usePresentTraining;\n\n    if (val > -1) {\n      $scope.data.usePresentValidation = val;\n    } else {\n      $scope.data.usePresentValidation = 0;\n    }\n\n    if ($scope.data.usePresentTraining > $scope.data.presentValidations) {\n      $scope.data.usePresentTraining = $scope.data.presentValidations;\n    }\n\n    $scope.totalPresentValidation = $scope.data.usePresentValidation;\n  });\n  $scope.totalNotPresentValidation = 0;\n  $scope.$watch('data.useNotPresentTraining', function () {\n    var val = $scope.data.absentsValidations - $scope.data.useNotPresentTraining;\n\n    if (val > -1) {\n      $scope.data.useNotPresentValidation = val;\n    } else $scope.data.useNotPresentValidation = 0;\n\n    if ($scope.data.useNotPresentTraining > $scope.data.absentsValidations) $scope.data.useNotPresentTraining = $scope.data.absentsValidations;\n    $scope.totalNotPresentValidation = $scope.data.useNotPresentValidation;\n  });\n  $scope.$watch('data.usePresentValidation', function () {\n    if ($scope.data.usePresentValidation > $scope.totalPresentValidation) {\n      $scope.data.usePresentValidation = $scope.totalPresentValidation;\n    }\n  });\n  $scope.$watch('data.useNotPresentValidation', function () {\n    if ($scope.data.useNotPresentValidation > $scope.totalNotPresentValidation) {\n      $scope.data.useNotPresentValidation = $scope.totalNotPresentValidation;\n    }\n  });\n  $scope.$watch('data.training', function () {\n    if ($scope.data.training !== '') {\n      Project.validationBySpeciesSong($scope.data.training.species_id, $scope.data.training.songtype_id, function (data) {\n        $scope.data.totalValidations = data.total;\n        $scope.data.presentValidations = data.present;\n        $scope.data.absentsValidations = data.absent;\n      });\n    }\n  });\n\n  $scope.disableCreateButton = function () {\n    return !($scope.trainings.length && $scope.data.name.length && $scope.totalNotPresentValidation > 0 && $scope.totalPresentValidation > 0 && $scope.data.usePresentTraining > 0 && $scope.data.useNotPresentTraining > 0 && $scope.data.usePresentValidation > 0 && $scope.data.useNotPresentValidation > 0 && typeof $scope.data.training !== 'string' && typeof $scope.data.classifier !== 'string' && !$scope.jobDisabled);\n  };\n\n  $scope.cancel = function (url) {\n    $modalInstance.close({\n      url: url\n    });\n  };\n\n  $scope.ok = function () {\n    $scope.nameMsg = '';\n    a2Models.create({\n      n: $scope.data.name,\n      t: $scope.data.training.training_set_id,\n      c: $scope.data.classifier.model_type_id,\n      tp: parseInt($scope.data.usePresentTraining),\n      tn: parseInt($scope.data.useNotPresentTraining),\n      vp: parseInt($scope.data.usePresentValidation),\n      vn: parseInt($scope.data.useNotPresentValidation)\n    }).success(function (data) {\n      if (data.name) {\n        $scope.nameMsg = 'Name exists';\n      } else {\n        $modalInstance.close(data);\n      }\n    }).error(function () {\n      $modalInstance.close({\n        err: \"Could not create job\"\n      });\n    });\n  };\n}).controller('DeleteModelInstanceCtrl', function ($scope, $modalInstance, a2Models, model_name, model_id, projectData, notify) {\n  $scope.model_name = model_name;\n  $scope.model_id = model_id;\n  $scope.projectData = projectData;\n  var url = $scope.projectData.url;\n\n  $scope.ok = function () {\n    a2Models.delete(model_id, function (data) {\n      $modalInstance.close(data);\n    });\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('NewClassificationInstanceCtrl', function ($scope, $modalInstance, model_name, model_id) {\n  $scope.model_name = model_name;\n  $scope.model_id = model_id;\n\n  $scope.ok = function () {\n    $modalInstance.close();\n  };\n\n  $scope.cancel = function () {\n    $modalInstance.dismiss('cancel');\n  };\n}).controller('ModelDetailsCtrl', function ($scope, a2Models, $stateParams, $location, Project, a2Classi, notify, $window, a2UserPermit) {\n  var scopeExited = false;\n  $scope.$on('$destroy', function (argument) {\n    scopeExited = true;\n    a2Models.modelState(false);\n  });\n  /*\n      method recursively get validations vectors and then call waitinFunction()\n   */\n\n  var getVectors = function (index) {\n    if (scopeExited) return;\n    if (index >= $scope.validations.length) return $scope.waitinFunction();\n    var currRec = $scope.validations[index];\n    currRec.date = $window.moment(currRec.date, 'MM-DD-YYYY HH:mm');\n    a2Models.getRecVector($scope.model.id, currRec.id).success(function (data) {\n      if (!(data.err && data.err == \"vector-not-found\")) {\n        var vector = data.vector;\n        var vmax = Math.max.apply(null, vector);\n        var vmin = Math.min.apply(null, vector);\n        currRec.vmax = vmax;\n        currRec.vector = vector;\n        $scope.allMax.push(vmax);\n        $scope.allMin.push(vmin);\n\n        if (currRec.presence == 'no') {\n          if ($scope.vectorNoMax < vmax) {\n            $scope.vectorNoMax = vmax;\n          }\n        } else if (currRec.presence == 'yes') {\n          $scope.allYesMax.push(vmax);\n        }\n      }\n\n      getVectors(++index);\n    });\n  };\n\n  var loadingMsgs = ['', 'Loading validations', 'Loading vectors'];\n  $scope.loading = true;\n  $scope.showValidationsTable = true;\n  $scope.allYesMax = [];\n  $scope.allMax = [];\n  $scope.allMin = [];\n  $scope.vectorNoMax = -1;\n  $scope.loadingValidations = true;\n  $scope.showModelValidations = true;\n  $scope.messageSaved = '';\n  a2Models.modelState(true);\n  Project.getInfo(function (data) {\n    $scope.project_id = data.project_id;\n  });\n  a2Models.findById($stateParams.modelId).success(function (model) {\n    $scope.model = model;\n    $scope.loading = null;\n  }).error(function (data, status) {\n    if (status == 404) {\n      $scope.notFound = true;\n    } else {\n      notify.serverError();\n    }\n  });\n  a2Models.getValidationResults($stateParams.modelId, function (data) {\n    if (data.err || !data.validations.length) {\n      $scope.showModelValidations = false;\n      $scope.loadingValidations = false;\n      return;\n    }\n\n    $scope.validations = data.validations;\n    getVectors(0);\n  });\n\n  $scope.waitinFunction = function () {\n    $scope.loading = null;\n\n    if (!$scope.allYesMax.length) {\n      $scope.showModelValidations = false;\n      $scope.loadingValidations = false;\n    }\n\n    $scope.allYesMax = $scope.allYesMax.sort();\n    var index = 0;\n\n    for (var j = 0; j < $scope.allYesMax.length; j++) {\n      if ($scope.allYesMax[j] >= $scope.vectorNoMax) {\n        index = j;\n      }\n    } // NOTE this value is received from the server and overwritten here, maybe this value can be saved\n\n\n    $scope.model.maxv = Math.max.apply(null, $scope.allMax);\n    $scope.model.minv = Math.min.apply(null, $scope.allMin);\n    $scope.suggestedThreshold = Math.round($scope.allYesMax[index] * 1000000) / 1000000;\n\n    if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold)) {\n      $scope.suggestedThreshold = Math.round($scope.allYesMax[0] * 1000000) / 1000000;\n    }\n\n    if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold)) {\n      $scope.showModelValidations = false;\n    } else {\n      // TODO optimize this section\n      var searchTh = $scope.suggestedThreshold;\n      var thresholdObject = [];\n      var precisionObject = [];\n      var accuracyObject = [];\n      var sensitivityObject = [];\n      var specificityObject = [];\n      var sumObject = [];\n      var tries = 0;\n      var i, ii, jj;\n\n      while (searchTh > 0.01 && tries < 15) {\n        for (jj = 0; jj < $scope.validations.length; jj++) {\n          $scope.validations[jj].threshold = $scope.validations[jj].vmax > searchTh ? 'yes' : 'no';\n        }\n\n        $scope.computeStats();\n        thresholdObject.push(searchTh);\n        precisionObject.push($scope.thres.precision);\n        accuracyObject.push($scope.thres.accuracy);\n        sensitivityObject.push($scope.thres.sensitivity);\n        specificityObject.push($scope.thres.specificity);\n        sumObject.push($scope.thres.specificity + $scope.thres.sensitivity + $scope.thres.accuracy + $scope.thres.precision);\n        searchTh = searchTh - 0.001;\n        tries = tries + 1;\n      }\n\n      var max = sumObject[0];\n      var mindex = 0;\n\n      for (ii = 1; ii < sumObject.length; ii++) {\n        if (sumObject[ii] > max) {\n          max = sumObject[ii];\n          mindex = ii;\n        }\n      }\n\n      max = precisionObject[0];\n\n      for (ii = 0; ii < precisionObject.length; ii++) {\n        if (precisionObject[ii] >= max) {\n          max = precisionObject[ii];\n        }\n      }\n\n      var precisionMaxIndices = [];\n\n      for (ii = 0; ii < precisionObject.length; ii++) {\n        if (precisionObject[ii] == max) {\n          precisionMaxIndices.push(ii);\n        }\n      }\n\n      max = sensitivityObject[precisionMaxIndices[0]];\n\n      for (i = 0; i < precisionMaxIndices.length; i++) {\n        if (sensitivityObject[precisionMaxIndices[i]] >= max) {\n          max = sensitivityObject[precisionMaxIndices[i]];\n        }\n      }\n\n      var sensitivityMaxIndices = [];\n\n      for (i = 0; i < precisionMaxIndices.length; i++) {\n        if (sensitivityObject[precisionMaxIndices[i]] == max) {\n          sensitivityMaxIndices.push(precisionMaxIndices[i]);\n        }\n      }\n\n      max = accuracyObject[sensitivityMaxIndices[0]];\n\n      for (i = 0; i < sensitivityMaxIndices.length; i++) {\n        if (accuracyObject[sensitivityMaxIndices[i]] >= max) {\n          max = accuracyObject[sensitivityMaxIndices[i]];\n        }\n      }\n\n      var accuracyMaxIndices = [];\n\n      for (i = 0; i < sensitivityMaxIndices.length; i++) {\n        if (accuracyObject[sensitivityMaxIndices[i]] == max) {\n          accuracyMaxIndices.push(sensitivityMaxIndices[i]);\n        }\n      }\n\n      max = specificityObject[accuracyMaxIndices[0]];\n\n      for (i = 0; i < accuracyMaxIndices.length; i++) {\n        if (specificityObject[accuracyMaxIndices[i]] >= max) {\n          max = specificityObject[accuracyMaxIndices[i]];\n        }\n      }\n\n      var specificityMaxIndices = [];\n\n      for (i = 0; i < accuracyMaxIndices.length; i++) {\n        if (specificityObject[accuracyMaxIndices[i]] == max) {\n          specificityMaxIndices.push(accuracyMaxIndices[i]);\n        }\n      }\n\n      var accum = 0.0;\n\n      for (i = 0; i < specificityMaxIndices.length; i++) {\n        accum = accum + thresholdObject[specificityMaxIndices[i]];\n      }\n\n      accum = accum / specificityMaxIndices.length;\n      $scope.currentThreshold = $scope.model.threshold != '-' ? $scope.model.threshold : accum;\n      $scope.suggestedThreshold = Math.round(accum * 1000000) / 1000000;\n\n      if (typeof $scope.suggestedThreshold === undefined || isNaN($scope.suggestedThreshold) || !$scope.suggestedThreshold) {\n        $scope.currentThreshold = $scope.model.threshold != '-' ? $scope.model.threshold : $scope.allYesMax[0];\n        $scope.suggestedThreshold = Math.round($scope.allYesMax[0] * 1000000) / 1000000;\n      }\n\n      for (jj = 0; jj < $scope.validations.length; jj++) {\n        $scope.validations[jj].threshold = $scope.validations[jj].vmax > $scope.currentThreshold ? 'yes' : 'no';\n      }\n\n      $scope.computeStats();\n      $scope.loadingValidations = false;\n    }\n  };\n\n  $scope.computeStats = function () {\n    $scope.thres = {\n      tpos: '-',\n      fpos: '-',\n      tneg: '-',\n      fneg: '-',\n      accuracy: '-',\n      precision: '-',\n      sensitivity: '-',\n      specificity: '-'\n    };\n    var trupositive = 0;\n    var falsepositives = 0;\n    var truenegatives = 0;\n    var falsenegative = 0;\n\n    for (var jj = 0; jj < $scope.validations.length; jj++) {\n      if ($scope.validations[jj].presence == 'yes') {\n        if ($scope.validations[jj].threshold == 'yes') {\n          trupositive = trupositive + 1;\n        } else {\n          falsenegative = falsenegative + 1;\n        }\n      } else {\n        if ($scope.validations[jj].threshold == 'yes') {\n          falsepositives = falsepositives + 1;\n        } else {\n          truenegatives = truenegatives + 1;\n        }\n      }\n    }\n\n    $scope.thres.tpos = trupositive;\n    $scope.thres.fpos = falsepositives;\n    $scope.thres.tneg = truenegatives;\n    $scope.thres.fneg = falsenegative;\n    $scope.thres.accuracy = Math.round((trupositive + truenegatives) / (trupositive + falsepositives + truenegatives + falsenegative) * 100) / 100;\n\n    if (trupositive + falsepositives > 0) {\n      $scope.thres.precision = Math.round(trupositive / (trupositive + falsepositives) * 100) / 100;\n    }\n\n    if (trupositive + falsenegative > 0) {\n      $scope.thres.sensitivity = Math.round(trupositive / (trupositive + falsenegative) * 100) / 100;\n    }\n\n    if (truenegatives + falsepositives > 0) {\n      $scope.thres.specificity = Math.round(truenegatives / (truenegatives + falsepositives) * 100) / 100;\n    }\n  };\n\n  $scope.saveThreshold = function () {\n    $scope.messageSaved = '';\n    $scope.recalculate();\n    a2Models.setThreshold($stateParams.modelId, $scope.currentThreshold).success(function () {\n      $scope.messageSaved = 'Threshold saved';\n      $scope.model.threshold = $scope.currentThreshold;\n    }).error(function () {\n      $scope.messageSaved = 'Error saving threshold';\n    });\n  };\n\n  $scope.recalculate = function () {\n    $scope.messageSaved = '';\n    var newval = parseFloat($scope.newthres);\n\n    if (!isNaN(newval) && newval <= 1.0 && newval >= 0.0) {\n      $scope.currentThreshold = newval;\n\n      for (var jj = 0; jj < $scope.validations.length; jj++) {\n        $scope.validations[jj].threshold = $scope.validations[jj].vmax > $scope.currentThreshold ? 'yes' : 'no';\n      }\n\n      $scope.computeStats();\n    } else {\n      $scope.messageSaved = 'Value should be between 0 and 1.';\n    }\n  }; // TODO use ng-style\n\n\n  $scope.zoomout = function () {\n    $(\"#patternDivMain\").css(\"min-width\", 210);\n    $(\"#patternDivMain\").css(\"height\", 100);\n  };\n\n  $scope.zoomin = function () {\n    $(\"#patternDivMain\").css(\"min-width\", 420);\n    $(\"#patternDivMain\").css(\"height\", 150);\n  };\n\n  $scope.isExport = function () {\n    return a2UserPermit.can('export report') || a2UserPermit.isSuper();\n  };\n\n  $scope.getValidations = function () {\n    var vals = [];\n\n    for (var i = 0; i < $scope.validations.length; i++) {\n      vals.push({\n        site: $scope.validations[i].site,\n        date: $scope.validations[i].date,\n        user: $scope.validations[i].presence,\n        model: $scope.validations[i].model,\n        threshold: $scope.validations[i].threshold,\n        value: $scope.currentThreshold\n      });\n    }\n\n    return vals;\n  };\n\n  $scope.recDetails = function (rec) {\n    $scope.selected = rec;\n    $scope.showValidationsTable = false;\n  };\n\n  $scope.closeRecValidationsDetails = function () {\n    $scope.showValidationsTable = true;\n    $scope.selected = null;\n  };\n\n  $scope.gotoRec = function () {\n    var rurl = \"/visualizer/rec/\" + $scope.selected.id;\n    $location.path(rurl);\n  };\n});","angular.module('a2.citizen-scientist.admin.classification-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.classification-stats', {\n    url: '/classification-stats/:speciesId?',\n    controller: 'A2CitizenScientistAdminClassificationStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/classification-stats/index.html'\n  });\n}).controller('A2CitizenScientistAdminClassificationStatsCtrl', function ($scope, a2CitizenScientistAdminService, $stateParams, $state, Species) {\n  this.setSpecies = function (speciesId) {\n    this.speciesId = speciesId;\n    $state.transitionTo($state.current.name, {\n      speciesId: speciesId\n    }, {\n      notify: false\n    });\n\n    if (this.speciesId) {\n      this.loadForSpecies();\n    }\n  };\n\n  this.speciesId = $stateParams.speciesId;\n\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getClassificationStats().then(function (data) {\n      this.loading = false;\n      this.stats = data.stats;\n    }.bind(this));\n  };\n\n  this.loadForSpecies = function () {\n    this.loadingForSpecies = true;\n    Species.findById(this.speciesId).then(function (species) {\n      this.species = species;\n    }.bind(this));\n    a2CitizenScientistAdminService.getClassificationStats(this.speciesId).then(function (data) {\n      this.loadingForSpecies = false;\n      this.speciesStats = data.stats;\n    }.bind(this));\n  };\n\n  this.patternMatchingExportUrl = function (row, per_user) {\n    return a2CitizenScientistAdminService.getCSExportUrl(row.pattern_matching_id, per_user);\n  };\n\n  this.loadPage();\n\n  if (this.speciesId) {\n    this.loadForSpecies();\n  }\n});","angular.module('a2.citizen-scientist.admin.settings', ['a2.services', 'a2.srv.citizen-scientist-admin', 'a2.directives', 'ui.bootstrap', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.settings', {\n    url: '/settings',\n    controller: 'A2CitizenScientistAdminSettingsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/settings/index.html'\n  });\n}).controller('A2CitizenScientistAdminSettingsCtrl', function ($scope, a2CitizenScientistAdminService, notify) {\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getSettings().then(function (data) {\n      this.loading = false;\n      this.patternmatchings = data;\n    }.bind(this));\n  };\n\n  this.save = function () {\n    this.saving = true;\n    var settings = this.patternmatchings.filter(function (pm) {\n      return pm.citizen_scientist || pm.cs_expert;\n    }).map(function (pm) {\n      return {\n        id: pm.id,\n        consensus_number: pm.consensus_number,\n        citizen_scientist: pm.citizen_scientist,\n        cs_expert: pm.cs_expert\n      };\n    });\n    return a2CitizenScientistAdminService.setSettings(settings).then(function (data) {\n      this.saving = false;\n      notify.log(\"Settings Saved.\");\n    }.bind(this)).catch(function () {\n      this.saving = false;\n      notify.error(\"An error occured.\");\n    }.bind(this));\n  };\n\n  this.loadPage();\n});","angular.module('a2.citizen-scientist.admin.user-stats', ['a2.services', 'a2.directives', 'ui.bootstrap', 'a2.srv.citizen-scientist-admin', 'angularFileUpload', 'humane']).config(function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('citizen-scientist.admin.user-stats', {\n    url: '/user-stats/:userId?',\n    controller: 'A2CitizenScientistAdminUserStatsCtrl as controller',\n    templateUrl: '/app/citizen-scientist/admin/user-stats/index.html'\n  });\n}).controller('A2CitizenScientistAdminUserStatsCtrl', function ($scope, a2CitizenScientistAdminService, $stateParams, $state, Users) {\n  this.userStatsExportUrl = a2CitizenScientistAdminService.getUserStatsExportUrl();\n\n  this.setUser = function (userId) {\n    this.userId = userId;\n    $state.transitionTo($state.current.name, {\n      userId: userId\n    }, {\n      notify: false\n    });\n\n    if (this.userId) {\n      this.loadForUser();\n    }\n  };\n\n  this.userId = $stateParams.userId;\n\n  this.loadPage = function () {\n    this.loading = true;\n    a2CitizenScientistAdminService.getUserStats().then(function (data) {\n      this.loading = false;\n      this.stats = data.stats.filter(function (item) {\n        return !!item.user_id;\n      });\n    }.bind(this));\n  };\n\n  this.loadForUser = function () {\n    this.loadingForUser = true;\n    Users.getInfoForId(this.userId).then(function (user) {\n      this.user = user;\n    }.bind(this));\n    a2CitizenScientistAdminService.getUserStats(this.userId).then(function (data) {\n      this.loadingForUser = false;\n      this.userStats = data.stats;\n    }.bind(this));\n  };\n\n  this.loadPage();\n\n  if (this.userId) {\n    this.loadForUser();\n  }\n});","angular.module('a2.browser_audio-event-detections', ['a2.browser_common', 'a2.filter.as-csv']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'audio-event-detection',\n    cardTemplate: '/app/visualizer/browser/audio-event-detections/card.html'\n  });\n  BrowserLOVOsProvider.add({\n    name: 'audio-event-detection',\n    group: 'audio-event-detections',\n    vobject_type: 'audio-event-detection',\n    icon: 'fa fa-object-group',\n    tooltip: \"Show Audio Event Detections\",\n    controller: 'a2BrowserAudioEventDetectionsController',\n    template: '/app/visualizer/browser/audio-event-detections/audio-event-detections.html'\n  });\n}).controller('a2BrowserAudioEventDetectionsController', function (a2Browser, AudioEventDetectionService, a2ArrayLOVO, $timeout, $q) {\n  var self = this;\n  this.audioEventDetections = [];\n  this.active = false;\n  this.loading = {\n    audioEventDetections: false\n  };\n  this.audioEventDetection = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    var defer = $q.defer();\n    AudioEventDetectionService.getList({\n      show: 'thumbnail-path'\n    }).then(function (audioEventDetections) {\n      console.log(\"audioEventDetections\", audioEventDetections);\n      self.loading.audioEventDetections = false;\n      self.audioEventDetections = audioEventDetections;\n\n      if (!self.audioEventDetections_lovo) {\n        self.audioEventDetections_lovo = new a2ArrayLOVO();\n      }\n\n      self.audioEventDetections_lovo.setArray(self.audioEventDetections, 'audio-event-detection');\n\n      self.audioEventDetections_lovo.update = function () {\n        self.activate();\n      };\n\n      if (!self.lovo) {\n        self.lovo = self.audioEventDetections_lovo;\n        a2Browser.setLOVO(self.lovo);\n      }\n\n      defer.resolve(false);\n\n      if (self.resolve.scd) {\n        self.resolve.scd.resolve(self.audioEventDetections);\n      }\n    });\n    self.loading.audioEventDetections = true;\n    return defer.promise;\n  };\n\n  this.resolve = {};\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    var defer = $q.defer();\n\n    if (m) {\n      var scid = m[1] | 0,\n          regionid = m[3] | 0;\n      var scd = $q.defer();\n\n      if (self.loading.audioEventDetections) {\n        self.resolve = {\n          scd: scd\n        };\n      } else {\n        scd.resolve(self.audioEventDetections);\n      }\n\n      scd.promise.then(function (audioEventDetections) {\n        var audioEventDetection = self.audioEventDetections.filter(function (audioEventDetection) {\n          return audioEventDetection.id == scid;\n        }).shift();\n\n        if (audioEventDetection) {\n          self.audioEventDetection = audioEventDetection;\n\n          if (regionid) {\n            if (!self.audioEventDetection.extra) {\n              self.audioEventDetection.extra = {};\n            }\n\n            self.audioEventDetection.extra.region = regionid;\n          }\n        }\n\n        defer.resolve(audioEventDetection);\n      });\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (audioEventDetection) {\n    return 'audio-event-detection/' + audioEventDetection.id + (audioEventDetection.extra && audioEventDetection.extra.region ? '/' + audioEventDetection.extra.region : '');\n  };\n});","angular.module('a2.browser_recordings', ['a2.browser_common', 'a2.browser_recordings_by_site', 'a2.browser_recordings_by_playlist']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'recording',\n    cardTemplate: '/app/visualizer/browser/recordings/card.html'\n  });\n});","angular.module('a2.browser_soundscapes', ['a2.browser_common']).config(function (BrowserVisObjectsProvider, BrowserLOVOsProvider) {\n  BrowserVisObjectsProvider.add({\n    type: 'soundscape',\n    cardTemplate: '/app/visualizer/browser/soundscapes/card.html'\n  });\n  BrowserLOVOsProvider.add({\n    name: 'soundscape',\n    group: 'soundscapes',\n    vobject_type: 'soundscape',\n    icon: 'fa fa-area-chart',\n    tooltip: \"Show Soundscapes\",\n    controller: 'a2BrowserSoundscapesController',\n    template: '/app/visualizer/browser/soundscapes/soundscapes.html'\n  });\n}).controller('a2BrowserSoundscapesController', function (a2Browser, a2Soundscapes, a2ArrayLOVO, a2UrlUpdate, Project, $q) {\n  var self = this;\n  this.soundscapes = [];\n  this.active = false;\n  this.loading = {\n    soundscapes: false\n  };\n  this.soundscape = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    var defer = $q.defer();\n    a2Soundscapes.getList({\n      show: 'thumbnail-path'\n    }, function (soundscapes) {\n      self.loading.soundscapes = false;\n      self.soundscapes = soundscapes;\n      self.soundscapes.forEach(function (soundscape) {\n        a2UrlUpdate.update(soundscape.thumbnail);\n        soundscape.caption2 = soundscape.normalized ? 'normalized' : 'scale:' + (soundscape.visual_max_value !== null ? soundscape.visual_max_value : soundscape.max_value);\n      });\n\n      if (!self.soundscapes_lovo) {\n        self.soundscapes_lovo = new a2ArrayLOVO();\n      }\n\n      self.soundscapes_lovo.setArray(self.soundscapes, 'soundscape');\n\n      self.soundscapes_lovo.update = function () {\n        self.activate();\n      };\n\n      if (!self.lovo) {\n        self.lovo = self.soundscapes_lovo;\n        a2Browser.setLOVO(self.lovo);\n      }\n\n      defer.resolve(false);\n\n      if (self.resolve.scd) {\n        self.resolve.scd.resolve(self.soundscapes);\n      }\n    });\n    self.loading.soundscapes = true;\n    return defer.promise;\n  };\n\n  this.resolve = {};\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    var defer = $q.defer();\n\n    if (m) {\n      var scid = m[1] | 0,\n          regionid = m[3] | 0;\n      var scd = $q.defer();\n\n      if (self.loading.soundscapes) {\n        self.resolve = {\n          scd: scd\n        };\n      } else {\n        scd.resolve(self.soundscapes);\n      }\n\n      scd.promise.then(function (soundscapes) {\n        var soundscape = self.soundscapes.filter(function (soundscape) {\n          return soundscape.id == scid;\n        }).shift();\n\n        if (soundscape) {\n          self.soundscape = soundscape;\n\n          if (regionid) {\n            if (!self.soundscape.extra) {\n              self.soundscape.extra = {};\n            }\n\n            self.soundscape.extra.region = regionid;\n          }\n        }\n\n        defer.resolve(soundscape);\n      });\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (soundscape) {\n    return 'soundscape/' + soundscape.id + (soundscape.extra && soundscape.extra.region ? '/' + soundscape.extra.region : '');\n  };\n});","angular.module('a2.visualizer.layers.annotation-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.annotation-layer.object:annotation-layer\n   * @description base image layer.\n   * adds the annotation-layer layer_type to layer_types. This layer shows a set of images\n   * associated to the visobject (such as the spectrogram or a soundscape's rendering).\n   * The layer only has a spectrogram component.\n   * The layer requires a selected visobject of recording or soundscape type.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"annotation-layer\",\n    title: \"\",\n    controller: 'a2VisualizerAnnotationController as controller',\n    require: {\n      type: ['recording'],\n      selection: true\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n}).controller('a2VisualizerAnnotationController', function ($scope) {});","angular.module('a2.visualizer.layers.audio-events-layer', []).config(function (layer_typesProvider) {\n  layer_typesProvider.addLayerType({\n    type: \"audio-events-layer\",\n    title: \"\",\n    controller: 'a2VisualizerAudioEventsController as audio_events',\n    require: {\n      type: ['recording'],\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerAudioEventsController', function ($scope, a2AudioEventDetectionsClustering, a2ClusteringJobs, $localStorage) {\n  var self = this;\n  const colors = ['#5340ff33', '#008000', '#ffcd00', '#1F57CC', '#53ff40', '#5bc0de', '#5340ff33'];\n  self.audioEvents = null;\n  self.clusteringEvents = null;\n  self.isAudioEventsPlaylist = null;\n  self.selectedAudioEventJob = null;\n  self.clusterPlaylists = null;\n  self.isPlaylist = false;\n\n  self.toggleAudioEvents = function (isJobsBoxes, id, opacity) {\n    (isJobsBoxes ? self.audioEvents : self.clusteringEvents).forEach(function (item) {\n      if ((isJobsBoxes ? item.job_id : item.playlist_id) === id) {\n        item.opacity = opacity === false ? 0 : 1;\n\n        if (isJobsBoxes) {\n          const index = Object.keys(self.audioEventJobs).findIndex(function (job) {\n            return Number(job) === item.job_id;\n          });\n          const color = colors[index] || colors[0];\n          item.borderColor = self.hexToRGB(color, 0.6);\n          item.backgroundColor = self.hexToRGB(color, 0.2);\n        }\n      }\n    }); // Remove default/selected job from the audio events details page.\n\n    if (isJobsBoxes) {\n      $localStorage.setItem('analysis.audioEventJob', null);\n    }\n  };\n\n  self.hexToRGB = function (hex, opacity) {\n    var r = parseInt(hex.slice(1, 3), 16),\n        g = parseInt(hex.slice(3, 5), 16),\n        b = parseInt(hex.slice(5, 7), 16);\n    return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + opacity + ')';\n  };\n\n  self.isHighlightTitle = function () {\n    return !isNaN($localStorage.getItem('analysis.audioEventJob'));\n  };\n\n  self.fetchAudioEvents = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (rec) {\n      self.isPlaylist = $scope.visobject.extra && $scope.visobject.extra.playlist; // Check local storage on selected job from the audio events details page.\n\n      try {\n        self.selectedAudioEventJob = $localStorage.getItem('analysis.audioEventJob');\n        self.isAudioEventsPlaylist = !isNaN(self.selectedAudioEventJob);\n      } catch (e) {} // Get Detections Jobs data.\n\n\n      a2AudioEventDetectionsClustering.list({\n        rec_id: rec,\n        completed: true\n      }).then(function (audioEvents) {\n        if (audioEvents) {\n          self.audioEventJobs = {}; // Collect detections jobs data for audio events layer.\n\n          if (audioEvents.length) {\n            audioEvents.forEach(function (event) {\n              if (!self.audioEventJobs[event.job_id]) {\n                self.audioEventJobs[event.job_id] = {\n                  job_id: event.job_id,\n                  name: event.name,\n                  count: 1,\n                  parameters: event.parameters,\n                  visible: self.isAudioEventsPlaylist ? Number(self.selectedAudioEventJob) === event.job_id : false // Job not visible by default, except selected job from the audio events details page.\n\n                };\n              }\n\n              ;\n              self.audioEventJobs[event.job_id].count += 1;\n            });\n          }\n\n          self.audioEvents = audioEvents.map(function (event) {\n            return {\n              rec_id: event.rec_id,\n              x1: event.time_min,\n              x2: event.time_max,\n              y1: event.freq_min,\n              y2: event.freq_max,\n              job_id: event.job_id || null,\n              display: event.rec_id === rec ? \"block\" : \"none\",\n              opacity: self.isAudioEventsPlaylist ? Number(self.selectedAudioEventJob) === event.job_id ? 1 : 0 : 0 // Boxes not visible by default, except selected job from the audio events details page.\n\n            };\n          });\n          a2ClusteringJobs.getRoisDetails({\n            rec_id: $scope.visobject.id\n          }).then(function (clusteringEvents) {\n            if (clusteringEvents) {\n              // Collect clustering playlists for audio events layer.\n              self.clusterPlaylists = {};\n              clusteringEvents.forEach(function (event) {\n                if (!self.clusterPlaylists[event.playlist_id]) {\n                  self.clusterPlaylists[event.playlist_id] = {\n                    rec_id: event.recording_id,\n                    playlist_name: event.playlist_name,\n                    playlist_id: event.playlist_id,\n                    count: 1,\n                    visible: false // Playlist is hidden by default.\n\n                  };\n                }\n\n                ;\n                self.clusterPlaylists[event.playlist_id].count += 1;\n              });\n              self.clusteringEvents = clusteringEvents.map(function (event) {\n                return {\n                  rec_id: event.recording_id,\n                  x1: event.time_min,\n                  x2: event.time_max,\n                  y1: event.frequency_min,\n                  y2: event.frequency_max,\n                  playlist_id: event.playlist_id || null,\n                  display: event.recording_id === rec ? \"block\" : \"none\",\n                  opacity: 0 // Boxes not visible by default.\n\n                };\n              });\n            }\n          });\n        }\n      });\n    }\n  };\n\n  $scope.$watch('visobject', self.fetchAudioEvents);\n});","angular.module('a2.visualizer.layers.data-plot-layer', ['a2.directive.plotly-plotter', 'arbimon2.directive.a2-dropdown']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.data-plot-layer.object:data-plot-layer\n   * @description base image layer. \n   * adds the data-plot-layer layer_type to layer_types. This layer shows a set of plots\n   * related to the visobject.\n   * The layer only has a spectrogram component.\n   * The layer requires a visobject of type audio-event-detection.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"data-plot-layer\",\n    title: \"\",\n    controller: 'a2VisualizerDataPlotLayerController as controller',\n    require: {\n      type: ['audio-event-detection'],\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerDataPlotLayerController', function ($scope) {});","angular.module('a2.visualizer.layers.base-image-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.base-image-layer.object:base-image-layer\n   * @description base image layer. \n   * adds the base-image-layer layer_type to layer_types. This layer shows a set of images\n   * associated to the visobject (such as the spectrogram or a soundscape's rendering).\n   * The layer only has a spectrogram component.\n   * The layer requires a selected visobject of recording or soundscape type.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"base-image-layer\",\n    title: \"\",\n    require: {\n      type: ['recording', 'soundscape'],\n      selection: true\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n});","angular.module('a2.visualizer.layers.recording-soundscape-region-tags', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.recordings.object:recordings-layer\n   * @description Recordings layer. \n   * adds the recordings-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.recordings.controller:a2VisualizerRecordingLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-soundscape-region-tags\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingSoundscapeRegionTagsLayerController as ctrl',\n    require: {\n      type: 'recording',\n      selection: true,\n      that: function (scope) {\n        var pl = scope.visobject && scope.visobject.extra && scope.visobject.extra.playlist;\n        return pl && pl.soundscape && pl.region;\n      }\n    },\n    sidebar_only: true,\n    visible: true,\n    hide_visibility: false\n  });\n}).controller('a2VisualizerRecordingSoundscapeRegionTagsLayerController', function ($scope, a2Soundscapes) {\n  var self = this;\n  self.loading = {};\n  self.tag = {\n    name: null,\n    add: function () {\n      var tag = this.name;\n      this.name = null;\n      a2Soundscapes.addRecordingTag(self.soundscape.id, self.region.id, self.recording.id, tag, function (tag) {\n        var tagid = tag.id | 0;\n\n        if (!self.tags.filter(function (t) {\n          return t.id == tagid;\n        }).length) {\n          self.tags.push(tag);\n        }\n      });\n    },\n    remove: function (tag) {\n      var tagid = tag.id | 0;\n      a2Soundscapes.removeRecordingTag(self.soundscape.id, self.region.id, self.recording.id, tagid, function () {\n        self.tags = self.tags.filter(function (t) {\n          return t.id != tagid;\n        });\n      });\n    }\n  };\n  $scope.$watch('visobject', function (visobject) {\n    self.recording = null;\n    self.playlist = null;\n    self.soundscape = null;\n    self.region = null;\n    self.tags = null;\n\n    if (visobject && visobject.type == 'recording' && visobject.id && visobject.extra && visobject.extra.playlist && visobject.extra.playlist.soundscape && visobject.extra.playlist.region) {\n      self.recording = visobject;\n      self.playlist = visobject.extra.playlist;\n      self.loading.soundscape = true;\n      self.loading.region = true;\n      self.loading.tags = true;\n      a2Soundscapes.get(self.playlist.soundscape, function (soundscape) {\n        self.loading.soundscape = false;\n        self.soundscape = soundscape;\n        a2Soundscapes.getRegion(soundscape.id, self.playlist.region, function (region) {\n          self.loading.region = false;\n          self.region = region;\n          a2Soundscapes.getRecordingTags(soundscape.id, region.id, self.recording.id, function (tags) {\n            self.loading.tags = false;\n            self.tags = tags;\n          });\n        });\n      });\n    }\n  });\n});","angular.module('a2.visualizer.layers.recordings', ['a2.filter.round', 'a2.directive.frequency_filter_range_control']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.recordings.object:recordings-layer\n   * @description Recordings layer.\n   * adds the recordings-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.recordings.controller:a2VisualizerRecordingLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   * The layer has no visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"recording-layer\",\n    title: \"\",\n    controller: 'a2VisualizerRecordingLayerController as controller',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerRecordingLayerController', function ($scope, $modal, $location, $window) {\n  this.setGain = function (gain) {\n    $scope.audio_player.setGain(gain).then(function () {\n      var gain = $scope.audio_player.gain;\n      $scope.location.updateParams({\n        gain: gain >= 1 ? gain : undefined\n      });\n    });\n  };\n\n  this.explorerUrl = function () {\n    if (!$scope.visobject) return null;\n    return $scope.visobject.explorerUrl;\n  };\n\n  this.openFreqFilterModal = function () {\n    if (!$scope.visobject) {\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/recordings/frequency_filter_modal.html',\n      controller: 'a2VisualizerFrequencyFilterModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            recording: $scope.visobject,\n            filter: $scope.audio_player.freq_filter\n          };\n        }\n      }\n    }).result.then($scope.audio_player.setFrequencyFilter.bind($scope.audio_player)).then(function () {\n      var filter = $scope.audio_player.freq_filter;\n      $scope.location.updateParams({\n        filter: filter ? filter.min + '-' + filter.max : undefined\n      });\n    });\n  };\n}).controller('a2VisualizerFrequencyFilterModalController', function ($scope, $modalInstance, data) {\n  $scope.recording = data.recording;\n  $scope.max_freq = data.recording.sample_rate / 2;\n  $scope.has_previous_filter = true; //!!data.filter;\n\n  $scope.filter = data.filter ? angular.copy(data.filter) : {\n    min: 0,\n    max: $scope.max_freq\n  };\n\n  $scope.remove_filter = function () {\n    $modalInstance.close();\n  };\n\n  $scope.apply_filter = function () {\n    $modalInstance.close($scope.filter);\n  };\n});","angular.module('a2.visualizer.layers.soundscapes', ['a2.visualizer.layers.soundscapes.info', 'a2.visualizer.layers.soundscapes.regions']);","angular.module('a2.visualizer.layers.zoom-input-layer', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.zoom-input-layer.object:zoom-input-layer\n   * @description base image layer. \n   * adds the zoom-input-layer layer_type to layer_types. This layer collects input forEach\n   * performin zoom actions on the spectrogram.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"zoom-input-layer\",\n    title: \"\",\n    require: {\n      type: ['recording', 'soundscape'],\n      selection: true,\n      that: function (scope) {\n        return scope.visobject && scope.visobject.zoomable;\n      }\n    },\n    display: {\n      sidebar: false\n    },\n    visible: true\n  });\n});","angular.module('a2.visualizer.layers.training-sets.roi_set', ['visualizer-services', 'a2.permissions', 'humane']).config(function (training_set_typesProvider) {\n  training_set_typesProvider.add({\n    type: 'roi_set',\n    has_layout: true,\n    templates: {\n      layer_item: '/app/visualizer/layer-item/training-sets/roi_set.html',\n      new_modal: '/app/visualizer/modal/new_roi_set_tset_partial.html'\n    },\n    action: {\n      collect_new_tset_data: function (sdata, tset_data, sval) {\n        if (sdata.class) {\n          tset_data.class = sdata.class.id;\n        } else {\n          sval.class = \"Please select a project class.\";\n          sval.count++;\n        }\n      }\n    },\n    controller: 'a2VisualizerSpectrogramTrainingSetRoiSetData'\n  });\n}).controller('a2VisualizerTrainingSetLayerRoiSetDataController', function ($scope, $timeout, a2TrainingSets, training_set_types, a22PointBBoxEditor, a2UserPermit, notify) {\n  var self = this;\n  self.type = 'roi_set';\n  self.typedef = training_set_types.roi_set;\n\n  $scope.getXCoord = function (x1, x2) {\n    return $scope.getXSide(x1, x2) == 'left' ? x1 : x2;\n  };\n\n  $scope.getXSide = function (x1, x2) {\n    var px = Math.max(0, Math.min($scope.layout.sec2x(x2, 1) / $scope.layout.spectrogram.width, 1));\n    return px > .5 ? 'left' : 'right';\n  };\n\n  $scope.getTransform = function (x1, x2, y1, y2) {\n    var tx = $scope.getXSide(x1, x2) == 'left' ? '-100%' : '0';\n    var ty = $scope.getYTranslation((y1 + y2) / 2, true);\n    return 'translate(' + tx + ', ' + ty + ')';\n  };\n\n  $scope.getYTranslation = function (y, asrelativeoffset) {\n    var py = Math.max(0.1, Math.min($scope.layout.hz2y(y, 1) / $scope.layout.spectrogram.height, .9));\n\n    if (asrelativeoffset) {\n      py = -py;\n    }\n\n    return (100 * py | 0) + '%';\n  };\n\n  self.fetchData = function (tsetId, rec) {\n    self.tsetId = tsetId;\n    self.recording = rec;\n    a2TrainingSets.getData(tsetId, rec, function (data) {\n      $timeout(function () {\n        self.rois = data;\n      });\n    });\n  };\n\n  self.editor = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.roi = null;\n    },\n    make_new_bbox: function () {\n      this.super.make_new_bbox.call(this);\n      this.roi = this.bbox;\n    },\n    make_new_roi: function () {\n      this.make_new_bbox();\n    },\n    add_tracer_point: function (point) {\n      this.super.add_tracer_point.call(this, point.sec, point.hz);\n    },\n    add_point: function (point, min_eps) {\n      this.super.add_point.call(this, point.sec, point.hz, min_eps);\n    },\n    submit: function () {\n      if (!a2UserPermit.can('manage training sets')) {\n        notify.error('You do not have permission to add ROIs to training set');\n        return;\n      }\n\n      a2TrainingSets.addData(self.tsetId, {\n        recording: self.recording,\n        roi: this.roi\n      }, function (new_tset_data) {\n        $timeout(function () {\n          this.reset();\n          self.rois.push(new_tset_data);\n        }.bind(this));\n      }.bind(this));\n    }\n  });\n});","angular.module('a2.visualizer.layers.training-sets', ['visualizer-services', 'a2.visualizer.layers.training-sets.roi_set', 'a2.utils']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.training-sets.object:training-data\n   * @description Training Data layer.\n   * adds the training-data layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.training-sets.controller:a2VisualizerTrainingSetLayerController as controller,\n   * and requires a visobject of type recording to be selected.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"training-data\",\n    title: \"\",\n    controller: 'a2VisualizerTrainingSetLayerController as training_data',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerTrainingSetLayerController', function ($scope, $modal, $controller, $timeout, a2TrainingSets, a2UserPermit, notify) {\n  var self = this;\n  self.tset = null;\n  self.tset_type = null;\n  self.tset_list = [];\n  self.data = null;\n  a2TrainingSets.getList(function (training_sets) {\n    self.tset_list = training_sets;\n\n    if (!self.tset && training_sets && training_sets.length > 0) {\n      self.tset = training_sets[0];\n    }\n  });\n\n  self.add_new_tset = function () {\n    if (!a2UserPermit.can('manage training sets')) {\n      notify.error('You do not have permission to create training sets');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/training-data/add_tset_modal.html',\n      controller: 'a2VisualizerAddTrainingSetModalController'\n    }).result.then(function (new_tset) {\n      if (new_tset && new_tset.id) {\n        self.tset_list.push(new_tset);\n\n        if (!self.tset) {\n          self.tset = new_tset;\n        }\n      }\n    });\n  };\n\n  var fetchTsetData = function () {\n    var tset = self.tset && self.tset.id;\n    var tset_type = self.tset && self.tset.type;\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (tset && rec) {\n      if (!self.data || self.data.type != tset_type) {\n        var cont_name = tset_type.replace(/(^|-|_)(\\w)/g, function (_, _1, _2, _3) {\n          return _2.toUpperCase();\n        });\n        cont_name = 'a2VisualizerTrainingSetLayer' + cont_name + 'DataController';\n        self.data = $controller(cont_name, {\n          $scope: $scope\n        });\n      }\n\n      self.data.fetchData(tset, rec);\n    }\n  };\n\n  $scope.$watch(function () {\n    return self.tset;\n  }, fetchTsetData);\n  $scope.$watch('visobject', fetchTsetData);\n}).directive('a2VisualizerSpectrogramTrainingSetData', function (training_set_types, $compile, $controller, $templateFetch) {\n  return {\n    restrict: 'A',\n    template: '<div class=\"training-set-data\"></div>',\n    replace: true,\n    link: function (scope, element, attrs) {\n      scope.$watch(attrs.a2VisualizerSpectrogramTrainingSetData, function (tset_type) {\n        var type_def = training_set_types[tset_type];\n        element.attr('data-tset-type', tset_type);\n\n        if (type_def) {\n          if (type_def.has_layout) {\n            var tmp_url = '/app/visualizer/spectrogram-layer/training-sets/' + tset_type + '.html';\n            $templateFetch(tmp_url, function (tmp) {\n              element.empty().append($compile(tmp)(scope));\n            });\n          }\n        }\n      });\n    }\n  };\n}).controller('a2VisualizerAddTrainingSetModalController', function ($scope, $modalInstance, Project, a2TrainingSets, $state) {\n  $scope.data = {\n    name: '',\n    type: null\n  };\n  $scope.loadingClasses = true;\n  Project.getClasses(function (project_classes) {\n    $scope.project_classes = project_classes;\n    $scope.loadingClasses = false;\n  });\n  $scope.loadingTypes = true;\n  a2TrainingSets.getTypes(function (tset_types) {\n    $scope.tset_types = tset_types;\n\n    if (tset_types && tset_types.length == 1) {\n      $scope.data.type = tset_types[0];\n      $scope.loadingTypes = false;\n    }\n  });\n\n  $scope.goToSpeciesPage = function () {\n    $state.go('audiodata.species', {});\n  };\n\n  $scope.ok = function () {\n    $scope.creating = true;\n    $scope.validation = {\n      count: 0\n    };\n    var tset_data = {};\n\n    if ($scope.data.name) {\n      tset_data.name = $scope.data.name;\n    } else {\n      $scope.validation.name = \"Training set name is required.\";\n      $scope.validation.count++;\n    }\n\n    if ($scope.data.type && $scope.data.type.id) {\n      tset_data.type = $scope.data.type.identifier;\n    } else {\n      $scope.validation.type = \"Training set type is required.\";\n      $scope.validation.count++;\n    }\n\n    if ($scope.data.class) {\n      tset_data.class = $scope.data.class.id;\n    } else {\n      $scope.validation.class = \"Species sound is required.\";\n      $scope.validation.count++;\n    } // $scope.form_data=tset_data;\n\n\n    if ($scope.validation.count === 0) {\n      a2TrainingSets.add(tset_data, function (new_tset) {\n        if (new_tset.error) {\n          var field = new_tset.field || 'error';\n          $scope.validation[field] = new_tset.error;\n          return;\n        }\n\n        $modalInstance.close(new_tset);\n      });\n    } else {\n      $scope.creating = false;\n    }\n  };\n});","angular.module('a2.visualizer.layers.species-presence', []).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.species-presence.object:species-presence\n   * @description species presence validation layer.\n   * Adds the species-presence layer_type to layer_types. This layer shows a\n   * species presence validation interface.\n   * The layer has spectrogram component.\n   * The layer requires a selected visobject of recording type.\n   * The layer has visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"species-presence\",\n    title: \"\",\n    controller: 'a2VisualizerSpeciesPresenceController as species_presence',\n    require: {\n      type: 'recording',\n      selection: true\n    },\n    visible: true\n  });\n}).controller('a2VisualizerSpeciesPresenceController', function ($scope, a2PatternMatching, a2AudioEventDetectionsClustering) {\n  var self = this;\n  self.speciesPresence = null;\n  self.isRemoving = false;\n\n  self.checkSpectroWidth = function (leftBox, widthBox, widthSpectro) {\n    return leftBox + widthBox + 200 < widthSpectro;\n  };\n\n  self.togglePopup = function (roi) {\n    roi.isPopupOpened = !roi.isPopupOpened;\n  };\n\n  self.confirmPopup = function (roi) {\n    self.isRemoving = true;\n\n    if (roi.aed_id) {\n      return a2AudioEventDetectionsClustering.unvalidate({\n        aed: [roi.aed_id]\n      }).then(function () {\n        self.closePopup(roi);\n        roi.name = '';\n      });\n    } else return a2PatternMatching.validateRois(roi.pattern_matching_id, roi.pattern_matching_roi_id, null).then(function () {\n      self.closePopup(roi);\n      roi.display = \"none\";\n    });\n  };\n\n  self.closePopup = function (roi) {\n    self.isRemoving = false;\n    roi.isPopupOpened = false;\n  };\n\n  self.fetchSpeciesPresence = function () {\n    var rec = $scope.visobject && $scope.visobject_type == 'recording' && $scope.visobject.id;\n\n    if (rec) {\n      a2PatternMatching.list({\n        rec_id: rec,\n        validated: 1\n      }).then(function (rois) {\n        self.speciesPresence = rois.map(function (roi) {\n          return {\n            rec_id: roi.recording_id,\n            pattern_matching_id: roi.pattern_matching_id,\n            pattern_matching_roi_id: roi.pattern_matching_roi_id,\n            name: roi.species_name + ' ' + roi.songtype_name,\n            x1: roi.x1,\n            x2: roi.x2,\n            y1: roi.y1,\n            y2: roi.y2,\n            display: roi.recording_id === rec ? \"block\" : \"none\",\n            isPopupOpened: false\n          };\n        }); // Add validated aed species boxes\n\n        if ($scope.visobject && $scope.visobject.aedValidations && $scope.visobject.aedValidations.length) {\n          self.speciesPresence = self.speciesPresence.concat($scope.visobject.aedValidations);\n        }\n      });\n    }\n  };\n\n  $scope.$watch('visobject', self.fetchSpeciesPresence);\n});","angular.module('a2.browser_recordings_by_playlist', ['a2.classy', 'a2.browser_common']).config(function (BrowserLOVOsProvider) {\n  BrowserLOVOsProvider.add({\n    name: 'playlist',\n    group: 'recordings',\n    vobject_type: 'recording',\n    icon: 'fa fa-list',\n    tooltip: \"Browse Recordings by Playlist\",\n    controller: 'a2BrowserRecordingsByPlaylistController',\n    template: '/app/visualizer/browser/recordings/by-playlist/recordings-by-playlist.html'\n  });\n}).service('a2PlaylistLOVO', function ($q, makeClass, a2Playlists, a2Pager, $state, $localStorage, Project) {\n  return makeClass({\n    static: {\n      PageSize: 10,\n      BlockSize: 7\n    },\n    constructor: function (playlist) {\n      this.loading = false;\n      this.playlist = playlist;\n      this.object_type = \"recording\";\n      this.offset = 0;\n      this.count = 0;\n      this.list = [];\n      this.whole_list = [];\n      var self = this;\n      this.paging = new a2Pager({\n        item_count: playlist.count,\n        page_size: this.constructor.PageSize,\n        block_size: this.constructor.BlockSize,\n        block_tracks_page: true,\n        on_page: function (e) {\n          return self.load_page(e.offset, e.count);\n        }\n      });\n    },\n    initialize: function () {\n      var self = this,\n          d = $q.defer();\n\n      if (this.initialized) {\n        d.resolve(true);\n      } else {\n        this.paging.set_page(0).then(function () {\n          d.resolve(false);\n        });\n      }\n\n      if (self.playlist && self.playlist.id === 0) {\n        d.resolve(true);\n        return d.promise;\n      }\n\n      ;\n      return d.promise.then(function () {\n        a2Playlists.getInfo(self.playlist.id, function (playlist_info) {\n          self.playlist = playlist_info;\n        });\n      }).then(function () {\n        if (self.whole_list) {\n          self.whole_list.forEach(self.append_extras.bind(self));\n        }\n      });\n    },\n    load_page: function (offset, count) {\n      var self = this,\n          d = $q.defer();\n      var opts = {\n        offset: offset,\n        limit: count,\n        show: 'thumbnail-path'\n      }; // get recordings data for temporary clusters playlist\n\n      if ($state.params.clusters) {\n        var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n\n        if (clustersData && clustersData.playlist && clustersData.playlist.recordings) {\n          opts.recordings = clustersData.playlist.recordings.filter(function (id, i, a) {\n            return i >= opts.offset && i < opts.offset + opts.limit;\n          });\n          self.count = clustersData.playlist.recordings.length;\n        }\n      }\n\n      ;\n      self.loading = true;\n      a2Playlists.getData(self.playlist.id, opts, function (recordings) {\n        self.list = recordings;\n        recordings.forEach(function (recording) {\n          recording.caption = [recording.site, moment.utc(recording.datetime).format('lll')].join(', ');\n          recording.vaxis = {\n            font: '7px',\n            color: '#333333',\n            range: [0, recording.sample_rate / 2000],\n            count: 5,\n            unit: ''\n          };\n          self.append_extras(recording);\n        });\n        self.loading = false;\n        d.resolve(recordings);\n      });\n      return d.promise;\n    },\n    append_extras: function (recording) {\n      if (recording) {\n        recording.extra = {\n          playlist: this.playlist\n        };\n      }\n\n      return recording;\n    },\n    find_local: function (recording) {\n      var self = this;\n      var id = recording && recording.id || recording | 0; // console.log(\":: find : \", id);\n\n      return $q.resolve(this.append_extras(this.list && this.list.filter(function (r) {\n        // if(r.id == id){\n        // console.log(\"     :: found\", r.id, r);\n        // }\n        return r.id == id;\n      }).shift()));\n    },\n    find: function (recording) {\n      var self = this;\n      var d = $q.defer();\n      var id = recording && recording.id || recording | 0;\n      self.find_local(recording).then(function (found_rec) {\n        if (found_rec) {\n          d.resolve(found_rec);\n        } else {\n          a2Playlists.getRecordingPosition(self.playlist.id, id).then(function (response) {\n            return self.paging.set_page(self.paging.page_for(response.data));\n          }).then(function (recordings) {\n            return self.find_local(recording);\n          }).then(function (found_rec) {\n            d.resolve(found_rec);\n          });\n        }\n      });\n      return d.promise;\n    },\n    previous: function (recording) {\n      var self = this;\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      a2Playlists.getPreviousRecording(this.playlist.id, id, function (r) {\n        d.resolve(self.append_extras(r));\n      });\n      return d.promise;\n    },\n    next: function (recording) {\n      var self = this;\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      a2Playlists.getNextRecording(this.playlist.id, id, function (r) {\n        d.resolve(self.append_extras(r));\n      });\n      return d.promise;\n    }\n  });\n}).factory('a2Pager', function (makeClass) {\n  return makeClass({\n    constructor: function (options) {\n      this.block_size = 10;\n      this.last_page = 0;\n      this.set_options(options);\n    },\n    resolve_value: function (value, current, first, last) {\n      switch (value) {\n        case 'first':\n          value = first;\n          break;\n\n        case 'previous':\n          value = current - 1;\n          break;\n\n        case 'next':\n          value = current + 1;\n          break;\n\n        case 'last':\n          value = last;\n          break;\n      }\n\n      return Math.max(first, Math.min(+value, last));\n    },\n    set_options: function (options) {\n      if (options.item_count) {\n        this.item_count = options.item_count;\n      }\n\n      if (options.page_size) {\n        this.page_size = options.page_size;\n      }\n\n      if (options.block_size) {\n        this.block_size = options.block_size;\n      }\n\n      if (options.last_page) {\n        this.last_page = options.last_page;\n      }\n\n      if (options.block_tracks_page !== undefined) {\n        this.block_tracks_page = !!options.block_tracks_page;\n      }\n\n      if (options.on_page !== undefined) {\n        this.on_page = options.on_page;\n      }\n\n      this.update();\n    },\n    page_for: function (item) {\n      var page = item / this.page_size | 0;\n      console.log(\"page_for(%s) :: %s\", item, page);\n      return page;\n    },\n    set_page: function (page) {\n      this.current_page = this.resolve_value(page, this.current_page, 0, this.last_page) | 0;\n      this.is_at_first_page = this.current_page === 0;\n      this.is_at_last_page = this.current_page === this.last_page;\n\n      if (this.block_tracks_page) {\n        this.show_block((this.current_page - this.block_size / 2 + this.block_size % 2) / this.block_size);\n      } else {\n        this.show_block(this.current_page / this.block_size);\n      }\n\n      if (this.on_page instanceof Function) {\n        var offset = this.current_page * this.page_size;\n        return this.on_page({\n          page: this.current_page,\n          offset: offset,\n          count: Math.min(this.page_size, this.item_count - offset + 1)\n        });\n      }\n    },\n    update: function () {\n      this.is_at_first_page = this.current_page <= 0;\n      this.last_page = (this.item_count - 1) / this.page_size | 0;\n      this.last_page_block = this.last_page / this.block_size | 0;\n      this.is_at_last_page = this.current_page >= this.last_page;\n      this.show_block(this.block);\n    },\n    show_block: function (block) {\n      if (this.block_tracks_page) {\n        this.current_page_block = this.resolve_value(block, this.current_page_block, 0, this.last_page_block);\n      } else {\n        this.current_page_block = this.resolve_value(block, this.current_page_block, 0, this.last_page_block) | 0;\n      }\n\n      this.is_at_first_page_block = this.current_page_block <= 0;\n      this.is_at_last_page_block = this.current_page_block >= this.last_page_block;\n      this.current_page_block_first_page = this.current_page_block * this.block_size | 0;\n      this.current_page_block_last_page = Math.min((this.current_page_block + 1) * this.block_size - 1 | 0, this.last_page);\n      this.block = [];\n\n      for (var i = this.current_page_block_first_page, e = this.current_page_block_last_page; i <= e; ++i) {\n        this.block.push(i);\n      }\n    },\n    has_page: function (page) {\n      return 0 <= page && page <= this.last_page;\n    }\n  });\n}).controller('a2BrowserRecordingsByPlaylistController', function ($scope, a2Browser, a2Playlists, $q, a2PlaylistLOVO, $state, $localStorage) {\n  var self = this;\n  this.playlists = [];\n  this.active = false;\n  this.loading = {\n    playlists: false\n  };\n  this.playlist = null;\n  this.lovo = null;\n  this.auto = {};\n\n  this.activate = function () {\n    self.loading.playlists = true;\n    this.getPlaylists = a2Playlists.getList().then(function (playlists) {\n      // add temporary clusters playlist to playlists' array\n      if ($state.params.clusters) {\n        var clustersData = JSON.parse($localStorage.getItem('analysis.clusters'));\n\n        if (clustersData && clustersData.playlist) {\n          playlists.push(clustersData.playlist);\n        }\n      }\n\n      self.playlists = playlists;\n      self.loading.playlists = false;\n    }).then(function () {\n      self.active = true;\n\n      if (self.resolve.pld) {\n        self.resolve.pld.resolve(playlists);\n        delete self.resolve.pld;\n      }\n    }).then(function () {\n      return self.playlists;\n    });\n    return this.getPlaylists;\n  };\n\n  this.deactivate = function () {\n    self.active = false;\n  };\n\n  this.resolve = {};\n\n  this.resolve_link = function (link) {\n    if (link.location) {\n      a2Browser.set_location(link.location);\n    }\n  };\n\n  this.resolve_location = function (location) {\n    var m = /(\\d+)(\\/(\\d+))?/.exec(location);\n    return m ? $q.resolve().then(function () {\n      var plid = m[1] | 0,\n          recid = m[3] | 0;\n      return self.getPlaylists.then(function (playlists) {\n        var playlist = self.playlists.filter(function (playlist) {\n          return playlist.id == plid;\n        }).shift();\n\n        if (playlist) {\n          self.playlist = playlist;\n          self.lovo = new a2PlaylistLOVO(playlist);\n          return self.lovo.initialize().then(function () {\n            return a2Browser.setLOVO(self.lovo);\n          }).then(function () {\n            return self.lovo.find(recid);\n          }).then(function (recording) {\n            return recording;\n          });\n        }\n      });\n    }) : $q.resolve();\n  };\n\n  this.get_location = function (recording) {\n    return 'playlist/' + (this.lovo ? this.lovo.playlist.id + (recording ? \"/\" + recording.id : '') : '');\n  };\n\n  this.set_playlist = function (playlist) {\n    this.playlist = playlist;\n\n    if (!self.active) {\n      return;\n    }\n\n    if (self.lovo && self.lovo.playlist.id != playlist.id) {\n      $scope.removeFromLocalStorage();\n    }\n\n    if (playlist && (self.lovo ? self.lovo.playlist != playlist : true)) {\n      self.lovo = new a2PlaylistLOVO(playlist);\n    }\n\n    a2Browser.setLOVO(self.lovo, self.lovo ? \"playlist/\" + self.lovo.playlist.id : '');\n  };\n\n  $scope.removeFromLocalStorage = function () {\n    $localStorage.setItem('analysis.clusters', null);\n    $localStorage.setItem('analysis.clusters.playlist', null);\n    $state.params.clusters = '';\n  };\n});","angular.module('a2.browser_recordings_by_site', ['a2.browser_common']).config(function (BrowserLOVOsProvider) {\n  BrowserLOVOsProvider.add({\n    name: 'rec',\n    group: 'recordings',\n    vobject_type: 'recording',\n    default: true,\n    icon: 'fa fa-map-marker',\n    tooltip: 'Browse Recordings by Site',\n    controller: 'a2BrowserRecordingsBySiteController',\n    template: '/app/visualizer/browser/recordings/by-site/recordings-by-site.html'\n  });\n}).factory('rbDateAvailabilityCache', function ($cacheFactory) {\n  return $cacheFactory('recordingsBrowserDateAvailabilityCache');\n}).service('a2RecordingsBySiteLOVO', function ($q, Project, $filter) {\n  var lovo = function (site, date, limit, offset, recording_id) {\n    this.loading = false;\n    this.initialized = false;\n    this.site = site;\n    this.date = date;\n    this.object_type = \"recording\";\n    this.recordingsBySite = true;\n    this.offset = offset || 0;\n    this.limit = limit;\n    this.order = 'datetime';\n    this.count = 0;\n    this.list = [];\n    this.page = 0;\n    this.recording_id = recording_id;\n    this.finished = false;\n  };\n\n  lovo.prototype = {\n    initialize: function () {\n      var d = $q.defer();\n\n      if (this.initialized) {\n        d.resolve(true);\n      } else {\n        return this.loadNext();\n      }\n\n      return d.promise;\n    },\n    updateRecording: function (recording_id) {\n      this.recording_id = recording_id;\n    },\n    getRecordings: function (limit, offset, recording_id) {\n      var d = $q.defer();\n      this.limit = limit, this.offset = offset;\n      var site = this.site,\n          date = this.date;\n      var key = ['!q:' + site.id, date.getFullYear(), date.getMonth() + 1, date.getDate()].join('-');\n      var opts = {\n        show: 'thumbnail-path'\n      };\n\n      if (recording_id === undefined) {\n        opts.limit = limit;\n        opts.offset = offset;\n      }\n\n      ;\n\n      if (recording_id !== undefined) {\n        opts.recording_id = recording_id;\n      }\n\n      ;\n      this.loading = true;\n      Project.getRecordings(key, opts, function (recordings) {\n        recordings = $filter('orderBy')(recordings, 'datetime');\n        recordings.forEach(function (recording) {\n          recording.caption = [recording.site, moment.utc(recording.datetime).format('lll')].join(', ');\n          recording.vaxis = {\n            font: '7px',\n            color: '#333333',\n            range: [0, recording.sample_rate / 2000],\n            count: 5,\n            unit: ''\n          };\n        });\n\n        if (recordings && recordings.length) {\n          // not use infinite-scroll functionality for navigating recording\n          if (recording_id) {\n            if (angular.equals(this.list, recordings)) {\n              this.finished = true;\n            }\n\n            ;\n            this.list = [];\n            this.list = recordings;\n          } else {\n            this.list.push.apply(this.list, recordings);\n            this.page++;\n          }\n        } else {\n          this.finished = true;\n        }\n\n        this.count += recordings.length;\n        this.loading = false;\n        d.resolve(false);\n      }.bind(this));\n      return d.promise;\n    },\n    loadNext: function () {\n      if (this.finished) {\n        return $q.defer().resolve(false);\n      }\n\n      return this.getRecordings(this.limit, this.page * this.limit, this.recording_id);\n    },\n    find: function (recording) {\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      d.resolve(this.list.filter(function (r) {\n        return r.id == id;\n      }).shift());\n      return d.promise;\n    },\n    previous: function (recording) {\n      console.log(\"previous : function(recording){ :: \", recording);\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      Project.getPreviousRecording(id, d.resolve);\n      return d.promise;\n    },\n    next: function (recording) {\n      var d = $q.defer(),\n          id = recording && recording.id || recording | 0;\n      Project.getNextRecording(id, d.resolve);\n      return d.promise;\n    }\n  };\n  return lovo;\n}).controller('a2BrowserRecordingsBySiteController', function ($scope, a2Browser, rbDateAvailabilityCache, Project, $timeout, $q, a2RecordingsBySiteLOVO) {\n  var project = Project;\n  var self = this;\n  $scope.siteInfo = {};\n  this.sites = [];\n  this.dates = {\n    refreshing: false,\n    max_date: null,\n    min_date: null,\n    display_year: null,\n    date_counts: [],\n    datepickerMode: 'year',\n    cache: rbDateAvailabilityCache,\n    get_counts_for: function (year) {\n      var site = self.site;\n      var site_id = site && site.id;\n\n      if (!site_id) {\n        return true;\n      }\n\n      var key = ['!q:' + site_id, year, '[1:12]'].join('-');\n      var availability = self.dates.cache.get(key);\n\n      if (!availability) {\n        self.dates.fetch_counts(key);\n      } else if (availability.data) {\n        self.dates.date_counts = availability.data;\n      }\n    },\n    fetch_counts: function (key) {\n      self.dates.cache.put(key, {\n        fetching: true\n      });\n      self.loading.dates = true;\n      Project.getRecordingAvailability(key, function (data) {\n        $timeout(function () {\n          var avail = {};\n\n          for (var site in data) {\n            var site_years = data[site];\n\n            for (var year in site_years) {\n              var year_months = site_years[year];\n\n              for (var month in year_months) {\n                var month_days = year_months[month];\n\n                for (var day in month_days) {\n                  var akey = year + '-' + (month < 10 ? '0' : '') + month + '-' + (day < 10 ? '0' : '') + day;\n                  avail[akey] = (avail[akey] | 0) + month_days[day];\n                }\n              }\n            }\n          }\n\n          self.dates.cache.get(key).data = avail || {};\n          self.dates.date_counts = avail;\n          self.loading.dates = false;\n        });\n      });\n    },\n    fetch_year_range: function (site, callback) {\n      var site_id = site && site.id;\n\n      if (!site_id) {\n        return;\n      }\n\n      Project.getRecordingAvailability('!q:' + site_id, function (data) {\n        $timeout(function () {\n          var range = {\n            max: -1 / 0,\n            min: 1 / 0,\n            count: 0\n          };\n\n          for (var site in data) {\n            var site_years = data[site];\n\n            for (var year in site_years) {\n              range.count++;\n              range.min = Math.min(year, range.min);\n              range.max = Math.max(year, range.max);\n            }\n          }\n\n          if (!range.count) {\n            range.max = range.min = new Date().getFullYear();\n          }\n\n          self.dates.min_date = new Date(range.min, 0, 1, 0, 0, 0, 0);\n          self.dates.max_date = new Date(range.max, 11, 31, 23, 59, 59, 999);\n          self.loading.dates = false;\n          callback(range);\n        });\n      });\n    },\n    fetching: false,\n    available: {}\n  };\n  this.loading = {\n    sites: false,\n    dates: false,\n    records: false\n  };\n  this.auto = {};\n  this.site = null;\n  this.date = null;\n  this.lovo = null;\n  $scope.limit = 10;\n\n  this.activate = function () {\n    var defer = $q.defer();\n    self.loading.sites = true;\n    project.getSites({\n      count: true,\n      logs: true\n    }, function (sites) {\n      self.sites = sites;\n      self.loading.sites = false;\n      $timeout(function () {\n        self.active = true;\n        defer.resolve(sites);\n      });\n    });\n    return defer.promise;\n  };\n\n  this.deactivate = function () {\n    var defer = $q.defer();\n    defer.resolve();\n    self.active = false;\n    return defer.promise;\n  }; // Preselect of a site and a date from navigation URL\n\n\n  this.auto_select = function (recording) {\n    if (recording) {\n      var utcdateaslocal = new Date(recording.datetime);\n      var recdate = new Date(utcdateaslocal.getTime() + utcdateaslocal.getTimezoneOffset() * 60 * 1000);\n      self.auto = {\n        site: self.sites.filter(function (s) {\n          return s.name == recording.site;\n        }).pop(),\n        date: new Date(recdate.getFullYear(), recdate.getMonth(), recdate.getDate(), 0, 0, 0, 0)\n      };\n\n      if (self.site != self.auto.site) {\n        self.set_site(self.auto.site);\n      } else if (self.date != self.auto.date) {\n        self.set_date(self.auto.date);\n      } else {\n        a2Browser.setLOVO(make_lovo());\n      }\n    }\n  };\n\n  this.resolve_location = function (location) {\n    var defer = $q.defer();\n\n    if (location) {\n      var site_match = /^site(\\/(\\d+)(\\/([^/]+))?)?/.exec(location);\n\n      if (site_match) {\n        var site = site_match[2] | 0,\n            query = site_match[4];\n\n        if (site) {\n          var key = '!q:' + site + (query ? '-' + query : '');\n          Project.getRecordings(key, function (recordings) {\n            defer.resolve(recordings && recordings.pop());\n          }.bind(this));\n        } else {\n          defer.resolve();\n        }\n      } else {\n        Project.getOneRecording(location, function (recording) {\n          defer.resolve(recording);\n        });\n      }\n    } else {\n      defer.resolve();\n    }\n\n    return defer.promise;\n  };\n\n  this.get_location = function (recording) {\n    return 'rec/' + recording.id;\n  };\n\n  var make_lovo = function () {\n    var site = self.site;\n    var date = self.date;\n\n    if (site && date) {\n      // Create current browser state for the one recording in the list of recordings\n      if ($scope.browser.currentRecording) {\n        self.lovo = new a2RecordingsBySiteLOVO(site, date, null, null, Number($scope.browser.currentRecording));\n      } else {\n        self.lovo = new a2RecordingsBySiteLOVO(site, date, $scope.limit);\n      }\n    }\n\n    return self.lovo;\n  };\n\n  $scope.onScroll = function ($event, $controller) {\n    $scope.scrollElement = $controller.scrollElement;\n    var scrollTop = $controller.scrollElement.scrollTop();\n    var scrollHeight = $controller.scrollElement[0].scrollHeight;\n    var elementHeight = $controller.scrollElement.height();\n    var diff = scrollTop + elementHeight > scrollHeight * 0.9;\n\n    if (diff) {\n      if (!self.lovo) return;\n      if (self.lovo && self.lovo.loading === true) return;\n      if ($scope.browser.currentRecording && $scope.browser.annotations) return;\n      if (self.lovo.list && self.lovo.list.length < 7) return;\n      self.lovo.loadNext();\n    }\n  };\n\n  this.set_dates_display_year = function (new_display_year) {\n    this.dates.display_year = new_display_year;\n\n    if (!this.active) {\n      return;\n    }\n\n    this.dates.get_counts_for(new_display_year);\n  };\n\n  this.set_site = function (newValue) {\n    this.site = $scope.siteInfo.site = newValue;\n\n    if (!this.active) {\n      return;\n    }\n\n    this.recordings = []; // reset the selections and stuff\n\n    this.date = null;\n    a2Browser.recording = null; // setup auto-selection\n\n    var auto_select = this.auto && this.auto.date;\n\n    if (auto_select) {\n      this.auto.date = null;\n      this.set_date(auto_select);\n    } // reset date picker year range and counts\n\n\n    this.dates.fetch_year_range(newValue, function (year_range) {\n      $timeout(function () {\n        self.dates.display_year = year_range.max;\n        self.dates.get_counts_for(self.dates.display_year);\n      });\n    });\n  };\n\n  this.set_date = function (date) {\n    if (!self.active) {\n      return;\n    }\n\n    this.yearpickOpen = false;\n    var site = this.site;\n    this.date = $scope.siteInfo.date = date;\n\n    if (site && date) {\n      var isNewSiteAndDate = function () {\n        return this.lovo && date && this.lovo.date && date.getTime() === this.lovo.date.getTime() && site.id === this.lovo.site.id;\n      };\n\n      if (isNewSiteAndDate()) {\n        a2Browser.setLOVO(self.lovo);\n      } else {\n        a2Browser.setLOVO(make_lovo()).then(function () {\n          $scope.browser.currentRecording = null;\n          $scope.browser.annotations = null;\n        });\n      }\n    }\n  };\n});","angular.module('a2.visualizer.layers.soundscapes.info', ['visualizer-services', 'a2.utils', 'a2.soundscapeRegionTags', 'a2.url-update-service', 'a2.directives', 'a2.directive.a2-palette-drawer', 'a2.service.colorscale-gradients']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.soundscapes.info.object:soundscape-info-layer\n   * @description Soundscape Info layer. \n   * adds the soundscape-info-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.soundscapes.info.controller:a2VisualizerSoundscapeInfoLayerController as controller,\n   * and requires a visobject of type soundscape to be selected.\n   * The layer has a visibility button.\n   * The layer does not have an associated spectrogram layer.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-info-layer\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeInfoLayerController as info',\n    require: {\n      type: 'soundscape',\n      browsetype: 'soundscape',\n      selection: true\n    },\n    display: {\n      spectrogram: false\n    },\n    visible: true,\n    hide_visibility: true\n  });\n}).controller('a2VisualizerSoundscapeInfoLayerController', function ($scope, $modal, $location, a2Soundscapes, a2UserPermit, notify) {\n  var self = this;\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, item) {\n      _[item.value] = item;\n      return _;\n    }, {});\n  }.bind(this));\n\n  this.edit_visual_scale = function (soundscape) {\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to edit soundscapes');\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/soundscapes/info/edit_soundscape_visual_scale_modal.html',\n      controller: 'a2VisualizerSampleSoundscapeInfoEditVisualScaleModalController as controller',\n      // size        : 'sm',\n      resolve: {\n        amplitudeReferences: function (a2Soundscapes) {\n          return a2Soundscapes.getAmplitudeReferences();\n        },\n        data: function () {\n          return {\n            soundscape: soundscape\n          };\n        }\n      }\n    }).result.then(function () {/// TODO::: aaa\n    });\n  };\n}).controller('a2VisualizerSampleSoundscapeInfoEditVisualScaleModalController', function ($scope, $modalInstance, a2Soundscapes, amplitudeReferences, data, a2UrlUpdate, ColorscaleGradients) {\n  var soundscape = data.soundscape;\n  $scope.soundscape = soundscape;\n  $scope.palettes = ColorscaleGradients.gradients;\n  $scope.data = {\n    palette: soundscape.visual_palette,\n    visual_max: soundscape.visual_max_value || soundscape.max_value,\n    normalized: !!soundscape.normalized,\n    amplitudeThreshold: soundscape.threshold,\n    amplitudeReference: amplitudeReferences.reduce(function (_, item) {\n      return _ || (item.value == soundscape.threshold_type ? item : null);\n    }, null)\n  };\n  this.amplitudeReferences = amplitudeReferences;\n\n  $scope.ok = function () {\n    a2Soundscapes.setVisualizationOptions(soundscape.id, {\n      max: $scope.data.visual_max,\n      palette: $scope.data.palette,\n      normalized: $scope.data.normalized,\n      amplitude: $scope.data.amplitudeThreshold,\n      amplitudeReference: $scope.data.amplitudeReference.value\n    }, function (sc) {\n      if (soundscape.update) {\n        soundscape.update(sc);\n      }\n\n      a2UrlUpdate.update(soundscape.thumbnail);\n      $modalInstance.close();\n    });\n  };\n\n  console.log($scope);\n}).directive('a2SoundscapeDrawer', function (a2Soundscapes) {\n  return {\n    restrict: 'E',\n    template: '<canvas class=\"soundscape\"></canvas>',\n    scope: {\n      soundscape: '&',\n      normalized: '&',\n      amplitudeThreshold: '&',\n      amplitudeThresholdType: '&',\n      palette: '&',\n      visualMax: '&'\n    },\n    replace: true,\n    link: function ($scope, $element, $attrs) {\n      var scidx;\n      var soundscape;\n      var norm_vector;\n\n      var draw = function () {\n        if (!soundscape || !scidx) {\n          return;\n        }\n\n        var vmax = $scope.visualMax() || soundscape.max_value;\n        var ampTh = $scope.amplitudeThreshold && $scope.amplitudeThreshold() || 0;\n\n        if ($scope.amplitudeThresholdType() == 'relative-to-peak-maximum') {\n          var maxAmp = getMaxAmplitude();\n          ampTh *= maxAmp;\n        }\n\n        var pal = $scope.palette();\n\n        if (!pal || !pal.length) {\n          return;\n        }\n\n        var pallen1 = 1.0 * (pal.length - 1);\n\n        var color = function (v) {\n          var i = Math.max(0, Math.min(v * pallen1 / vmax | 0, pallen1));\n          return pal[i];\n        };\n\n        if (norm_vector) {\n          vmax = 1;\n          var _cl = color;\n\n          color = function (v, j) {\n            var n = norm_vector[j] || 1;\n            return _cl(v / n);\n          };\n        }\n\n        var w = scidx.width,\n            h = scidx.height;\n        $element.attr('width', w);\n        $element.attr('height', h);\n        var ctx = $element[0].getContext('2d');\n        ctx.fillStyle = color(0);\n        ctx.fillRect(0, 0, w, h);\n\n        for (var i in scidx.index) {\n          var row = scidx.index[i];\n\n          for (var j in row) {\n            var cell = row[j];\n\n            if (ampTh && cell[1]) {\n              var act = 0;\n\n              for (var al = cell[1], ali = 0, ale = al.length; ali < ale; ++ali) {\n                if (al[ali] > ampTh) {\n                  ++act;\n                }\n              }\n\n              ctx.fillStyle = color(act, j);\n            } else {\n              ctx.fillStyle = color(cell[0], j);\n            }\n\n            ctx.fillRect(j, h - i - 1, 1, 1);\n          }\n        }\n      };\n\n      var getMaxAmplitude = function () {\n        if (scidx.__maxAmplitude === undefined) {\n          scidx.__maxAmplitude = Object.keys(scidx.index).reduce(function (maxAmp, i) {\n            var row = scidx.index[i];\n            return Object.keys(row).reduce(function (maxAmp, j) {\n              var cellMax = Math.max.apply(Math, row[j][1] || [0]);\n              return Math.max(cellMax, maxAmp);\n            }, maxAmp);\n          }, 0);\n          console.log(\"scidx.__maxAmplitude\", scidx.__maxAmplitude);\n        }\n\n        return scidx.__maxAmplitude;\n      };\n\n      $scope.$watch('soundscape()', function (_soundscape) {\n        soundscape = _soundscape;\n        if (soundscape) a2Soundscapes.getSCIdx(soundscape.id, {\n          count: 1\n        }).then(function (_scidx) {\n          scidx = _scidx;\n          draw();\n        });\n      });\n      $scope.$watch('normalized()', function (_normalized) {\n        if (!_normalized) {\n          norm_vector = null;\n          draw();\n        } else {\n          if (norm_vector) {\n            draw();\n          } else {\n            a2Soundscapes.getNormVector(soundscape.id).then(function (_norm_vector) {\n              norm_vector = _norm_vector;\n              draw();\n            });\n          }\n        }\n      });\n      $scope.$watch('palette()', draw);\n      $scope.$watch('amplitudeThreshold()', draw);\n      $scope.$watch('amplitudeThresholdType()', draw);\n      $scope.$watch('visualMax()', draw);\n    }\n  };\n});","angular.module('a2.visualizer.layers.soundscapes.regions', ['visualizer-services', 'a2.utils', 'a2.soundscapeRegionTags']).config(function (layer_typesProvider) {\n  /**\n   * @ngdoc object\n   * @name a2.visualizer.layers.soundscapes.regions.object:soundscape-regions-layer\n   * @description Soundscape Regions layer. \n   * adds the soundscape-regions-layer layer_type to layer_types. This layer uses\n   * a2.visualizer.layers.soundscapes.regions.controller:a2VisualizerSoundscapeRegionsLayerController as controller,\n   * and requires a visobject of type soundscape to be selected.\n   * The layer has a visibility button.\n   */\n  layer_typesProvider.addLayerType({\n    type: \"soundscape-regions-layer\",\n    title: \"\",\n    controller: 'a2VisualizerSoundscapeRegionsLayerController as soundscape',\n    require: {\n      type: 'soundscape',\n      browsetype: 'soundscape',\n      selection: true\n    },\n    visible: true // hide_visibility : true\n\n  });\n}).controller('a2VisualizerSoundscapeRegionsLayerController', function ($scope, $modal, $location, a2Soundscapes, a22PointBBoxEditor, a2UserPermit, notify) {\n  var self = this;\n\n  var bbox2string = function (bbox) {\n    var x1 = bbox.x1 | 0;\n    var y1 = bbox.y1 | 0;\n    var x2 = bbox.x2 | 0;\n    var y2 = bbox.y2 | 0;\n    return x1 + ',' + y1 + '-' + x2 + ',' + y2;\n  };\n\n  a2Soundscapes.getAmplitudeReferences().then(function (amplitudeReferences) {\n    this.amplitudeReferences = amplitudeReferences.reduce(function (_, item) {\n      _[item.value] = item;\n      return _;\n    }, {});\n  }.bind(this));\n  this.show = {\n    names: true,\n    tags: true\n  };\n\n  this.view_playlist = function (region) {\n    console.log(\"this.view_playlist = function(region){\", region);\n\n    if (region.playlist) {\n      $scope.set_location(\"playlist/\" + region.playlist);\n    }\n  };\n\n  this.query = function (bbox) {\n    if (!self.selection.valid) {\n      return;\n    }\n\n    a2Soundscapes.getRecordings(self.soundscape, bbox2string(bbox), {\n      count: 1,\n      threshold: 1\n    }, function (data) {\n      bbox.q = data;\n    });\n  };\n\n  this.submit = function (bbox, name) {\n    if (!self.selection.valid) {\n      return;\n    }\n\n    if (!a2UserPermit.can('manage soundscapes')) {\n      notify.error('You do not have permission to annotate soundscapes');\n      return;\n    }\n\n    a2Soundscapes.addRegion(self.soundscape, bbox2string(bbox), {\n      name: name,\n      threshold: 1\n    }, function (data) {\n      self.regions.push(data);\n      self.selection.bbox = data;\n    });\n  };\n\n  this.sample = function (bbox, percent) {\n    if (!bbox.id) {\n      return;\n    }\n\n    $modal.open({\n      templateUrl: '/app/visualizer/layers/soundscapes/regions/sample_soundscape_region_modal.html',\n      controller: 'a2VisualizerSampleSoundscapeRegionModalController',\n      size: 'sm',\n      resolve: {\n        data: function () {\n          return {\n            soundscape: self.soundscape,\n            region: bbox\n          };\n        }\n      }\n    }).result.then(function (region) {\n      if (region && region.id) {\n        self.regions.forEach(function (r, idx) {\n          if (r.id == region.id) {\n            self.regions[idx] = region;\n          }\n        });\n        self.selection.bbox = region;\n      }\n    });\n  };\n\n  this.selection = angular.extend(new a22PointBBoxEditor(), {\n    reset: function () {\n      this.super.reset.call(this);\n      this.percent = 100;\n      return this;\n    },\n    quantize: function (x, y, ceil) {\n      var q = ceil ? Math.ceil : Math.floor;\n      var xi = $scope.visobject.domain.x.unit_interval;\n      var yi = $scope.visobject.domain.y.unit_interval;\n      return [q(x / xi) * xi, q(y / yi) * yi];\n    },\n    add_tracer_point: function (x, y) {\n      this.super.add_tracer_point.apply(this, this.quantize(x, y));\n      return this;\n    },\n    add_point: function (x, y) {\n      this.super.add_point.apply(this, this.quantize(x, y));\n      return this;\n    },\n    validate: function (tmp_points) {\n      this.super.validate.call(this, tmp_points);\n      var q = this.quantize(this.bbox.x2 + 0.1, this.bbox.y2 + 0.1, true);\n      this.bbox.y2 = q[1];\n      this.selbox = {\n        x1: this.bbox.x1,\n        y1: this.bbox.y1,\n        x2: q[0],\n        y2: q[1]\n      };\n    },\n    query: function () {\n      self.query(this.bbox);\n    },\n    submit: function () {\n      self.submit(this.bbox, this.bbox.name);\n    },\n    sample: function () {\n      self.sample(this.bbox, this.percent);\n    },\n    view_samples: function () {\n      self.view_playlist(this.bbox);\n    },\n    select: function (region) {\n      this.bbox = region;\n\n      if ($scope.visobject && $scope.visobject.id && region && region.id) {\n        $scope.set_location('soundscape/' + $scope.visobject.id + '/' + region.id, true);\n      }\n    }\n  });\n  $scope.$watch('visobject', function (visobject) {\n    var sc = visobject && visobject.type == 'soundscape' && visobject.id;\n\n    if (sc) {\n      self.soundscape = sc;\n      self.selection.reset();\n      a2Soundscapes.getRegions(sc, {\n        view: 'tags'\n      }, function (regions) {\n        self.regions = regions;\n\n        if (visobject.extra && visobject.extra.region) {\n          self.selection.bbox = self.regions.filter(function (r) {\n            return r.id == visobject.extra.region;\n          }).pop();\n        }\n      });\n    } else {\n      self.soundscape = 0;\n    }\n  });\n}).controller('a2VisualizerSampleSoundscapeRegionModalController', function ($scope, $modalInstance, a2Soundscapes, data) {\n  $scope.soundscape = data.soundscape;\n  $scope.region = data.region;\n  $scope.data = {\n    percent: 100\n  };\n\n  $scope.ok = function () {\n    $scope.validation = {\n      count: 0\n    };\n    var sdata = $scope.data,\n        sval = $scope.validation;\n    var vdata = {};\n    var tst;\n\n    if (sdata.percent > 100) {\n      sval.percent = \"Percent must be between 0% and 100%.\";\n      sval.count++;\n    } else if ((sdata.percent * $scope.region.count | 0) < 1) {\n      sval.percent = \"You must sample at least 1 recording.\";\n      sval.count++;\n    } else {\n      vdata.percent = sdata.percent;\n    }\n\n    $scope.form_data = vdata;\n\n    if (sval.count === 0) {\n      a2Soundscapes.sampleRegion($scope.soundscape, $scope.region.id, vdata, function (region) {\n        $modalInstance.close(region);\n      });\n    }\n  };\n});"]}